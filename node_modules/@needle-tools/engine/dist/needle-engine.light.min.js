var J6=Object.defineProperty,q6=(n,e,i)=>e in n?J6(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,p=(n,e,i)=>(q6(n,typeof e!="symbol"?e+"":e,i),i),UT=(n,e,i)=>{if(!e.has(n))throw TypeError("Cannot "+i)},Ai=(n,e,i)=>(UT(n,e,"read from private field"),i?i.call(n):e.get(n)),Ea=(n,e,i)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,i)},ql=(n,e,i,s)=>(UT(n,e,"write to private field"),s?s.call(n,i):e.set(n,i),i),Mf=(n,e,i)=>(UT(n,e,"access private method"),i);/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const sh="162",yp={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},vp={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},O3=0,VT=1,G3=2,$6=3,e8=0,XT=1,WT=2,$l=3,Un=0,un=1,xi=2,dn=0,xu=1,bp=2,HT=3,jT=4,QT=5,wu=100,z3=101,F3=102,ZT=103,w1=104,N3=200,U3=201,V3=202,X3=203,_1=204,S1=205,W3=206,H3=207,j3=208,Q3=209,Z3=210,Y3=211,K3=212,J3=213,q3=214,YT=0,C1=1,jy=2,Ap=3,Ef=4,M1=5,E1=6,Qy=7,Zy=0,$3=1,ez=2,Yr=0,Tf=1,Yy=2,tz=3,Ky=4,iz=5,Rf=6,xp=7,KT="attached",nz="detached",T1=300,rh=301,_u=302,Kr=303,If=304,Lf=306,_o=1e3,qn=1001,oh=1002,Dt=1003,Pf=1004,t8=1004,ah=1005,i8=1005,Ot=1006,wp=1007,n8=1007,So=1008,s8=1008,pn=1009,R1=1010,JT=1011,Jy=1012,_p=1013,_r=1014,Hi=1015,ms=1016,qT=1017,$T=1018,lh=1020,sz=1021,_i=1023,I1=1024,rz=1025,Su=1026,Cu=1027,Sp=1028,L1=1029,P1=1030,qy=1031,Bf=1033,B1=33776,k1=33777,D1=33778,O1=33779,eR=35840,tR=35841,iR=35842,nR=35843,sR=36196,rR=37492,oR=37496,aR=37808,lR=37809,cR=37810,hR=37811,uR=37812,dR=37813,pR=37814,mR=37815,fR=37816,gR=37817,yR=37818,vR=37819,bR=37820,AR=37821,G1=36492,xR=36494,wR=36495,oz=36283,_R=36284,SR=36285,CR=36286,$y=2200,MR=2201,az=2202,Mu=2300,ec=2301,z1=2302,Cp=2400,Mp=2401,ev=2402,F1=2500,ER=2501,lz=0,TR=1,N1=2,cz=3e3,RR=3001,Ys=3200,U1=3201,Eu=0,hz=1,Co="",vt="srgb",Bi="srgb-linear",V1="display-p3",tv="display-p3-linear",iv="linear",ji="srgb",nv="rec709",sv="p3",uz=0,Tu=7680,dz=7681,pz=7682,mz=7683,fz=34055,gz=34056,yz=5386,IR=512,vz=513,bz=514,Az=515,xz=516,wz=517,_z=518,X1=519,Sz=512,Cz=513,Mz=514,LR=515,Ez=516,Tz=517,Rz=518,Iz=519,rv=35044,Sr=35048,r8=35040,o8=35045,a8=35049,l8=35041,c8=35046,h8=35050,u8=35042,d8="100",W1="300 es",H1=1035,tc=2e3,ov=2001;let Rs=class{addEventListener(n,e){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[n]===void 0&&(i[n]=[]),i[n].indexOf(e)===-1&&i[n].push(e)}hasEventListener(n,e){if(this._listeners===void 0)return!1;const i=this._listeners;return i[n]!==void 0&&i[n].indexOf(e)!==-1}removeEventListener(n,e){if(this._listeners===void 0)return;const i=this._listeners[n];if(i!==void 0){const s=i.indexOf(e);s!==-1&&i.splice(s,1)}}dispatchEvent(n){if(this._listeners===void 0)return;const e=this._listeners[n.type];if(e!==void 0){n.target=this;const i=e.slice(0);for(let s=0,r=i.length;s<r;s++)i[s].call(this,n);n.target=null}}};const Cr=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Lz=1234567;const Ep=Math.PI/180,kf=180/Math.PI;function Vo(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,s=Math.random()*4294967295|0;return(Cr[n&255]+Cr[n>>8&255]+Cr[n>>16&255]+Cr[n>>24&255]+"-"+Cr[e&255]+Cr[e>>8&255]+"-"+Cr[e>>16&15|64]+Cr[e>>24&255]+"-"+Cr[i&63|128]+Cr[i>>8&255]+"-"+Cr[i>>16&255]+Cr[i>>24&255]+Cr[s&255]+Cr[s>>8&255]+Cr[s>>16&255]+Cr[s>>24&255]).toLowerCase()}function Pn(n,e,i){return Math.max(e,Math.min(i,n))}function PR(n,e){return(n%e+e)%e}function p8(n,e,i,s,r){return s+(n-e)*(r-s)/(i-e)}function m8(n,e,i){return n!==e?(i-n)/(e-n):0}function av(n,e,i){return(1-i)*n+i*e}function f8(n,e,i,s){return av(n,e,1-Math.exp(-i*s))}function g8(n,e=1){return e-Math.abs(PR(n,e*2)-e)}function y8(n,e,i){return n<=e?0:n>=i?1:(n=(n-e)/(i-e),n*n*(3-2*n))}function v8(n,e,i){return n<=e?0:n>=i?1:(n=(n-e)/(i-e),n*n*n*(n*(n*6-15)+10))}function b8(n,e){return n+Math.floor(Math.random()*(e-n+1))}function A8(n,e){return n+Math.random()*(e-n)}function x8(n){return n*(.5-Math.random())}function w8(n){n!==void 0&&(Lz=n);let e=Lz+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function _8(n){return n*Ep}function S8(n){return n*kf}function BR(n){return(n&n-1)===0&&n!==0}function C8(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function j1(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function M8(n,e,i,s,r){const o=Math.cos,a=Math.sin,l=o(i/2),c=a(i/2),h=o((e+s)/2),u=a((e+s)/2),d=o((e-s)/2),m=a((e-s)/2),f=o((s-e)/2),g=a((s-e)/2);switch(r){case"XYX":n.set(l*u,c*d,c*m,l*h);break;case"YZY":n.set(c*m,l*u,c*d,l*h);break;case"ZXZ":n.set(c*d,c*m,l*u,l*h);break;case"XZX":n.set(l*u,c*g,c*f,l*h);break;case"YXY":n.set(c*f,l*u,c*g,l*h);break;case"ZYZ":n.set(c*g,c*f,l*u,l*h);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function Jr(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function Kt(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const oi={DEG2RAD:Ep,RAD2DEG:kf,generateUUID:Vo,clamp:Pn,euclideanModulo:PR,mapLinear:p8,inverseLerp:m8,lerp:av,damp:f8,pingpong:g8,smoothstep:y8,smootherstep:v8,randInt:b8,randFloat:A8,randFloatSpread:x8,seededRandom:w8,degToRad:_8,radToDeg:S8,isPowerOfTwo:BR,ceilPowerOfTwo:C8,floorPowerOfTwo:j1,setQuaternionFromProperEuler:M8,normalize:Kt,denormalize:Jr};let Y=class U6{constructor(e=0,i=0){U6.prototype.isVector2=!0,this.x=e,this.y=i}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,i){return this.x=e,this.y=i,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const i=this.x,s=this.y,r=e.elements;return this.x=r[0]*i+r[3]*s+r[6],this.y=r[1]*i+r[4]*s+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this}clampLength(e,i){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(e,Math.min(i,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const s=this.dot(e)/i;return Math.acos(Pn(s,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,s=this.y-e.y;return i*i+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this}lerpVectors(e,i,s){return this.x=e.x+(i.x-e.x)*s,this.y=e.y+(i.y-e.y)*s,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this}rotateAround(e,i){const s=Math.cos(i),r=Math.sin(i),o=this.x-e.x,a=this.y-e.y;return this.x=o*s-a*r+e.x,this.y=o*r+a*s+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},Gt=class V6{constructor(e,i,s,r,o,a,l,c,h){V6.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,i,s,r,o,a,l,c,h)}set(e,i,s,r,o,a,l,c,h){const u=this.elements;return u[0]=e,u[1]=r,u[2]=l,u[3]=i,u[4]=o,u[5]=c,u[6]=s,u[7]=a,u[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const i=this.elements,s=e.elements;return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=s[7],i[8]=s[8],this}extractBasis(e,i,s){return e.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),s.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const i=e.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const s=e.elements,r=i.elements,o=this.elements,a=s[0],l=s[3],c=s[6],h=s[1],u=s[4],d=s[7],m=s[2],f=s[5],g=s[8],y=r[0],v=r[3],b=r[6],A=r[1],x=r[4],w=r[7],_=r[2],S=r[5],M=r[8];return o[0]=a*y+l*A+c*_,o[3]=a*v+l*x+c*S,o[6]=a*b+l*w+c*M,o[1]=h*y+u*A+d*_,o[4]=h*v+u*x+d*S,o[7]=h*b+u*w+d*M,o[2]=m*y+f*A+g*_,o[5]=m*v+f*x+g*S,o[8]=m*b+f*w+g*M,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=e,i[4]*=e,i[7]*=e,i[2]*=e,i[5]*=e,i[8]*=e,this}determinant(){const e=this.elements,i=e[0],s=e[1],r=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],u=e[8];return i*a*u-i*l*h-s*o*u+s*l*c+r*o*h-r*a*c}invert(){const e=this.elements,i=e[0],s=e[1],r=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],u=e[8],d=u*a-l*h,m=l*c-u*o,f=h*o-a*c,g=i*d+s*m+r*f;if(g===0)return this.set(0,0,0,0,0,0,0,0,0);const y=1/g;return e[0]=d*y,e[1]=(r*h-u*s)*y,e[2]=(l*s-r*a)*y,e[3]=m*y,e[4]=(u*i-r*c)*y,e[5]=(r*o-l*i)*y,e[6]=f*y,e[7]=(s*c-h*i)*y,e[8]=(a*i-s*o)*y,this}transpose(){let e;const i=this.elements;return e=i[1],i[1]=i[3],i[3]=e,e=i[2],i[2]=i[6],i[6]=e,e=i[5],i[5]=i[7],i[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const i=this.elements;return e[0]=i[0],e[1]=i[3],e[2]=i[6],e[3]=i[1],e[4]=i[4],e[5]=i[7],e[6]=i[2],e[7]=i[5],e[8]=i[8],this}setUvTransform(e,i,s,r,o,a,l){const c=Math.cos(o),h=Math.sin(o);return this.set(s*c,s*h,-s*(c*a+h*l)+a+e,-r*h,r*c,-r*(-h*a+c*l)+l+i,0,0,1),this}scale(e,i){return this.premultiply(kR.makeScale(e,i)),this}rotate(e){return this.premultiply(kR.makeRotation(-e)),this}translate(e,i){return this.premultiply(kR.makeTranslation(e,i)),this}makeTranslation(e,i){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,i,0,0,1),this}makeRotation(e){const i=Math.cos(e),s=Math.sin(e);return this.set(i,-s,0,s,i,0,0,0,1),this}makeScale(e,i){return this.set(e,0,0,0,i,0,0,0,1),this}equals(e){const i=this.elements,s=e.elements;for(let r=0;r<9;r++)if(i[r]!==s[r])return!1;return!0}fromArray(e,i=0){for(let s=0;s<9;s++)this.elements[s]=e[s+i];return this}toArray(e=[],i=0){const s=this.elements;return e[i]=s[0],e[i+1]=s[1],e[i+2]=s[2],e[i+3]=s[3],e[i+4]=s[4],e[i+5]=s[5],e[i+6]=s[6],e[i+7]=s[7],e[i+8]=s[8],e}clone(){return new this.constructor().fromArray(this.elements)}};const kR=new Gt;function Pz(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}const E8={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Df(n,e){return new E8[n](e)}function lv(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function Bz(){const n=lv("canvas");return n.style.display="block",n}const kz={};function Dz(n){n in kz||(kz[n]=!0,console.warn(n))}const Oz=new Gt().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),Gz=new Gt().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),Q1={[Bi]:{transfer:iv,primaries:nv,toReference:n=>n,fromReference:n=>n},[vt]:{transfer:ji,primaries:nv,toReference:n=>n.convertSRGBToLinear(),fromReference:n=>n.convertLinearToSRGB()},[tv]:{transfer:iv,primaries:sv,toReference:n=>n.applyMatrix3(Gz),fromReference:n=>n.applyMatrix3(Oz)},[V1]:{transfer:ji,primaries:sv,toReference:n=>n.convertSRGBToLinear().applyMatrix3(Gz),fromReference:n=>n.applyMatrix3(Oz).convertLinearToSRGB()}},T8=new Set([Bi,tv]),Ci={enabled:!0,_workingColorSpace:Bi,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(n){if(!T8.has(n))throw new Error(`Unsupported working color space, "${n}".`);this._workingColorSpace=n},convert:function(n,e,i){if(this.enabled===!1||e===i||!e||!i)return n;const s=Q1[e].toReference,r=Q1[i].fromReference;return r(s(n))},fromWorkingColorSpace:function(n,e){return this.convert(n,this._workingColorSpace,e)},toWorkingColorSpace:function(n,e){return this.convert(n,e,this._workingColorSpace)},getPrimaries:function(n){return Q1[n].primaries},getTransfer:function(n){return n===Co?iv:Q1[n].transfer}};function Of(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function DR(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}let Gf,OR=class{static getDataURL(n){if(/^data:/i.test(n.src)||typeof HTMLCanvasElement>"u")return n.src;let e;if(n instanceof HTMLCanvasElement)e=n;else{Gf===void 0&&(Gf=lv("canvas")),Gf.width=n.width,Gf.height=n.height;const i=Gf.getContext("2d");n instanceof ImageData?i.putImageData(n,0,0):i.drawImage(n,0,0,n.width,n.height),e=Gf}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",n),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(n){if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap){const e=lv("canvas");e.width=n.width,e.height=n.height;const i=e.getContext("2d");i.drawImage(n,0,0,n.width,n.height);const s=i.getImageData(0,0,n.width,n.height),r=s.data;for(let o=0;o<r.length;o++)r[o]=Of(r[o]/255)*255;return i.putImageData(s,0,0),e}else if(n.data){const e=n.data.slice(0);for(let i=0;i<e.length;i++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[i]=Math.floor(Of(e[i]/255)*255):e[i]=Of(e[i]);return{data:e,width:n.width,height:n.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),n}},R8=0,ch=class{constructor(n=null){this.isSource=!0,Object.defineProperty(this,"id",{value:R8++}),this.uuid=Vo(),this.data=n,this.dataReady=!0,this.version=0}set needsUpdate(n){n===!0&&this.version++}toJSON(n){const e=n===void 0||typeof n=="string";if(!e&&n.images[this.uuid]!==void 0)return n.images[this.uuid];const i={uuid:this.uuid,url:""},s=this.data;if(s!==null){let r;if(Array.isArray(s)){r=[];for(let o=0,a=s.length;o<a;o++)s[o].isDataTexture?r.push(GR(s[o].image)):r.push(GR(s[o]))}else r=GR(s);i.url=r}return e||(n.images[this.uuid]=i),i}};function GR(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?OR.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let I8=0,Vt=class bT extends Rs{constructor(e=bT.DEFAULT_IMAGE,i=bT.DEFAULT_MAPPING,s=qn,r=qn,o=Ot,a=So,l=_i,c=pn,h=bT.DEFAULT_ANISOTROPY,u=Co){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:I8++}),this.uuid=Vo(),this.name="",this.source=new ch(e),this.mipmaps=[],this.mapping=i,this.channel=0,this.wrapS=s,this.wrapT=r,this.magFilter=o,this.minFilter=a,this.anisotropy=h,this.format=l,this.internalFormat=null,this.type=c,this.offset=new Y(0,0),this.repeat=new Y(1,1),this.center=new Y(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Gt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const s={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(s.userData=this.userData),i||(e.textures[this.uuid]=s),s}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==T1)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case _o:e.x=e.x-Math.floor(e.x);break;case qn:e.x=e.x<0?0:1;break;case oh:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case _o:e.y=e.y-Math.floor(e.y);break;case qn:e.y=e.y<0?0:1;break;case oh:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}};Vt.DEFAULT_IMAGE=null,Vt.DEFAULT_MAPPING=T1,Vt.DEFAULT_ANISOTROPY=1;let Ze=class X6{constructor(e=0,i=0,s=0,r=1){X6.prototype.isVector4=!0,this.x=e,this.y=i,this.z=s,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,i,s,r){return this.x=e,this.y=i,this.z=s,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this.w=e.w+i.w,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this.w+=e.w*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this.w=e.w-i.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const i=this.x,s=this.y,r=this.z,o=this.w,a=e.elements;return this.x=a[0]*i+a[4]*s+a[8]*r+a[12]*o,this.y=a[1]*i+a[5]*s+a[9]*r+a[13]*o,this.z=a[2]*i+a[6]*s+a[10]*r+a[14]*o,this.w=a[3]*i+a[7]*s+a[11]*r+a[15]*o,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const i=Math.sqrt(1-e.w*e.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/i,this.y=e.y/i,this.z=e.z/i),this}setAxisAngleFromRotationMatrix(e){let i,s,r,o;const a=e.elements,l=a[0],c=a[4],h=a[8],u=a[1],d=a[5],m=a[9],f=a[2],g=a[6],y=a[10];if(Math.abs(c-u)<.01&&Math.abs(h-f)<.01&&Math.abs(m-g)<.01){if(Math.abs(c+u)<.1&&Math.abs(h+f)<.1&&Math.abs(m+g)<.1&&Math.abs(l+d+y-3)<.1)return this.set(1,0,0,0),this;i=Math.PI;const b=(l+1)/2,A=(d+1)/2,x=(y+1)/2,w=(c+u)/4,_=(h+f)/4,S=(m+g)/4;return b>A&&b>x?b<.01?(s=0,r=.707106781,o=.707106781):(s=Math.sqrt(b),r=w/s,o=_/s):A>x?A<.01?(s=.707106781,r=0,o=.707106781):(r=Math.sqrt(A),s=w/r,o=S/r):x<.01?(s=.707106781,r=.707106781,o=0):(o=Math.sqrt(x),s=_/o,r=S/o),this.set(s,r,o,i),this}let v=Math.sqrt((g-m)*(g-m)+(h-f)*(h-f)+(u-c)*(u-c));return Math.abs(v)<.001&&(v=1),this.x=(g-m)/v,this.y=(h-f)/v,this.z=(u-c)/v,this.w=Math.acos((l+d+y-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this.w=Math.max(e.w,Math.min(i.w,this.w)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this.w=Math.max(e,Math.min(i,this.w)),this}clampLength(e,i){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(e,Math.min(i,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this.w+=(e.w-this.w)*i,this}lerpVectors(e,i,s){return this.x=e.x+(i.x-e.x)*s,this.y=e.y+(i.y-e.y)*s,this.z=e.z+(i.z-e.z)*s,this.w=e.w+(i.w-e.w)*s,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this.w=e[i+3],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e[i+3]=this.w,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this.w=e.getW(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}};class zz extends Rs{constructor(e=1,i=1,s={}){super(),this.isRenderTarget=!0,this.width=e,this.height=i,this.depth=1,this.scissor=new Ze(0,0,e,i),this.scissorTest=!1,this.viewport=new Ze(0,0,e,i);const r={width:e,height:i,depth:1};s=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Ot,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0,count:1},s);const o=new Vt(r,s.mapping,s.wrapS,s.wrapT,s.magFilter,s.minFilter,s.format,s.type,s.anisotropy,s.colorSpace);o.flipY=!1,o.generateMipmaps=s.generateMipmaps,o.internalFormat=s.internalFormat,this.textures=[];const a=s.count;for(let l=0;l<a;l++)this.textures[l]=o.clone(),this.textures[l].isRenderTargetTexture=!0;this.depthBuffer=s.depthBuffer,this.stencilBuffer=s.stencilBuffer,this.depthTexture=s.depthTexture,this.samples=s.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,i,s=1){if(this.width!==e||this.height!==i||this.depth!==s){this.width=e,this.height=i,this.depth=s;for(let r=0,o=this.textures.length;r<o;r++)this.textures[r].image.width=e,this.textures[r].image.height=i,this.textures[r].image.depth=s;this.dispose()}this.viewport.set(0,0,e,i),this.scissor.set(0,0,e,i)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let s=0,r=e.textures.length;s<r;s++)this.textures[s]=e.textures[s].clone(),this.textures[s].isRenderTargetTexture=!0;const i=Object.assign({},e.texture.image);return this.texture.source=new ch(i),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Zt extends zz{constructor(e=1,i=1,s={}){super(e,i,s),this.isWebGLRenderTarget=!0}}class Z1 extends Vt{constructor(e=null,i=1,s=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:i,height:s,depth:r},this.magFilter=Dt,this.minFilter=Dt,this.wrapR=qn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class L8 extends Zt{constructor(e=1,i=1,s=1,r={}){super(e,i,r),this.isWebGLArrayRenderTarget=!0,this.depth=s,this.texture=new Z1(null,e,i,s),this.texture.isRenderTargetTexture=!0}}let zR=class extends Vt{constructor(n=null,e=1,i=1,s=1){super(null),this.isData3DTexture=!0,this.image={data:n,width:e,height:i,depth:s},this.magFilter=Dt,this.minFilter=Dt,this.wrapR=qn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};class P8 extends Zt{constructor(e=1,i=1,s=1,r={}){super(e,i,r),this.isWebGL3DRenderTarget=!0,this.depth=s,this.texture=new zR(null,e,i,s),this.texture.isRenderTargetTexture=!0}}let Se=class{constructor(n=0,e=0,i=0,s=1){this.isQuaternion=!0,this._x=n,this._y=e,this._z=i,this._w=s}static slerpFlat(n,e,i,s,r,o,a){let l=i[s+0],c=i[s+1],h=i[s+2],u=i[s+3];const d=r[o+0],m=r[o+1],f=r[o+2],g=r[o+3];if(a===0){n[e+0]=l,n[e+1]=c,n[e+2]=h,n[e+3]=u;return}if(a===1){n[e+0]=d,n[e+1]=m,n[e+2]=f,n[e+3]=g;return}if(u!==g||l!==d||c!==m||h!==f){let y=1-a;const v=l*d+c*m+h*f+u*g,b=v>=0?1:-1,A=1-v*v;if(A>Number.EPSILON){const w=Math.sqrt(A),_=Math.atan2(w,v*b);y=Math.sin(y*_)/w,a=Math.sin(a*_)/w}const x=a*b;if(l=l*y+d*x,c=c*y+m*x,h=h*y+f*x,u=u*y+g*x,y===1-a){const w=1/Math.sqrt(l*l+c*c+h*h+u*u);l*=w,c*=w,h*=w,u*=w}}n[e]=l,n[e+1]=c,n[e+2]=h,n[e+3]=u}static multiplyQuaternionsFlat(n,e,i,s,r,o){const a=i[s],l=i[s+1],c=i[s+2],h=i[s+3],u=r[o],d=r[o+1],m=r[o+2],f=r[o+3];return n[e]=a*f+h*u+l*m-c*d,n[e+1]=l*f+h*d+c*u-a*m,n[e+2]=c*f+h*m+a*d-l*u,n[e+3]=h*f-a*u-l*d-c*m,n}get x(){return this._x}set x(n){this._x=n,this._onChangeCallback()}get y(){return this._y}set y(n){this._y=n,this._onChangeCallback()}get z(){return this._z}set z(n){this._z=n,this._onChangeCallback()}get w(){return this._w}set w(n){this._w=n,this._onChangeCallback()}set(n,e,i,s){return this._x=n,this._y=e,this._z=i,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(n){return this._x=n.x,this._y=n.y,this._z=n.z,this._w=n.w,this._onChangeCallback(),this}setFromEuler(n,e=!0){const i=n._x,s=n._y,r=n._z,o=n._order,a=Math.cos,l=Math.sin,c=a(i/2),h=a(s/2),u=a(r/2),d=l(i/2),m=l(s/2),f=l(r/2);switch(o){case"XYZ":this._x=d*h*u+c*m*f,this._y=c*m*u-d*h*f,this._z=c*h*f+d*m*u,this._w=c*h*u-d*m*f;break;case"YXZ":this._x=d*h*u+c*m*f,this._y=c*m*u-d*h*f,this._z=c*h*f-d*m*u,this._w=c*h*u+d*m*f;break;case"ZXY":this._x=d*h*u-c*m*f,this._y=c*m*u+d*h*f,this._z=c*h*f+d*m*u,this._w=c*h*u-d*m*f;break;case"ZYX":this._x=d*h*u-c*m*f,this._y=c*m*u+d*h*f,this._z=c*h*f-d*m*u,this._w=c*h*u+d*m*f;break;case"YZX":this._x=d*h*u+c*m*f,this._y=c*m*u+d*h*f,this._z=c*h*f-d*m*u,this._w=c*h*u-d*m*f;break;case"XZY":this._x=d*h*u-c*m*f,this._y=c*m*u-d*h*f,this._z=c*h*f+d*m*u,this._w=c*h*u+d*m*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return e===!0&&this._onChangeCallback(),this}setFromAxisAngle(n,e){const i=e/2,s=Math.sin(i);return this._x=n.x*s,this._y=n.y*s,this._z=n.z*s,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(n){const e=n.elements,i=e[0],s=e[4],r=e[8],o=e[1],a=e[5],l=e[9],c=e[2],h=e[6],u=e[10],d=i+a+u;if(d>0){const m=.5/Math.sqrt(d+1);this._w=.25/m,this._x=(h-l)*m,this._y=(r-c)*m,this._z=(o-s)*m}else if(i>a&&i>u){const m=2*Math.sqrt(1+i-a-u);this._w=(h-l)/m,this._x=.25*m,this._y=(s+o)/m,this._z=(r+c)/m}else if(a>u){const m=2*Math.sqrt(1+a-i-u);this._w=(r-c)/m,this._x=(s+o)/m,this._y=.25*m,this._z=(l+h)/m}else{const m=2*Math.sqrt(1+u-i-a);this._w=(o-s)/m,this._x=(r+c)/m,this._y=(l+h)/m,this._z=.25*m}return this._onChangeCallback(),this}setFromUnitVectors(n,e){let i=n.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(n.x)>Math.abs(n.z)?(this._x=-n.y,this._y=n.x,this._z=0,this._w=i):(this._x=0,this._y=-n.z,this._z=n.y,this._w=i)):(this._x=n.y*e.z-n.z*e.y,this._y=n.z*e.x-n.x*e.z,this._z=n.x*e.y-n.y*e.x,this._w=i),this.normalize()}angleTo(n){return 2*Math.acos(Math.abs(Pn(this.dot(n),-1,1)))}rotateTowards(n,e){const i=this.angleTo(n);if(i===0)return this;const s=Math.min(1,e/i);return this.slerp(n,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(n){return this._x*n._x+this._y*n._y+this._z*n._z+this._w*n._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let n=this.length();return n===0?(this._x=0,this._y=0,this._z=0,this._w=1):(n=1/n,this._x=this._x*n,this._y=this._y*n,this._z=this._z*n,this._w=this._w*n),this._onChangeCallback(),this}multiply(n){return this.multiplyQuaternions(this,n)}premultiply(n){return this.multiplyQuaternions(n,this)}multiplyQuaternions(n,e){const i=n._x,s=n._y,r=n._z,o=n._w,a=e._x,l=e._y,c=e._z,h=e._w;return this._x=i*h+o*a+s*c-r*l,this._y=s*h+o*l+r*a-i*c,this._z=r*h+o*c+i*l-s*a,this._w=o*h-i*a-s*l-r*c,this._onChangeCallback(),this}slerp(n,e){if(e===0)return this;if(e===1)return this.copy(n);const i=this._x,s=this._y,r=this._z,o=this._w;let a=o*n._w+i*n._x+s*n._y+r*n._z;if(a<0?(this._w=-n._w,this._x=-n._x,this._y=-n._y,this._z=-n._z,a=-a):this.copy(n),a>=1)return this._w=o,this._x=i,this._y=s,this._z=r,this;const l=1-a*a;if(l<=Number.EPSILON){const m=1-e;return this._w=m*o+e*this._w,this._x=m*i+e*this._x,this._y=m*s+e*this._y,this._z=m*r+e*this._z,this.normalize(),this}const c=Math.sqrt(l),h=Math.atan2(c,a),u=Math.sin((1-e)*h)/c,d=Math.sin(e*h)/c;return this._w=o*u+this._w*d,this._x=i*u+this._x*d,this._y=s*u+this._y*d,this._z=r*u+this._z*d,this._onChangeCallback(),this}slerpQuaternions(n,e,i){return this.copy(n).slerp(e,i)}random(){const n=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),i=Math.random(),s=Math.sqrt(1-i),r=Math.sqrt(i);return this.set(s*Math.sin(n),s*Math.cos(n),r*Math.sin(e),r*Math.cos(e))}equals(n){return n._x===this._x&&n._y===this._y&&n._z===this._z&&n._w===this._w}fromArray(n,e=0){return this._x=n[e],this._y=n[e+1],this._z=n[e+2],this._w=n[e+3],this._onChangeCallback(),this}toArray(n=[],e=0){return n[e]=this._x,n[e+1]=this._y,n[e+2]=this._z,n[e+3]=this._w,n}fromBufferAttribute(n,e){return this._x=n.getX(e),this._y=n.getY(e),this._z=n.getZ(e),this._w=n.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(n){return this._onChangeCallback=n,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},E=class W6{constructor(e=0,i=0,s=0){W6.prototype.isVector3=!0,this.x=e,this.y=i,this.z=s}set(e,i,s){return s===void 0&&(s=this.z),this.x=e,this.y=i,this.z=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,i){return this.x=e.x*i.x,this.y=e.y*i.y,this.z=e.z*i.z,this}applyEuler(e){return this.applyQuaternion(Fz.setFromEuler(e))}applyAxisAngle(e,i){return this.applyQuaternion(Fz.setFromAxisAngle(e,i))}applyMatrix3(e){const i=this.x,s=this.y,r=this.z,o=e.elements;return this.x=o[0]*i+o[3]*s+o[6]*r,this.y=o[1]*i+o[4]*s+o[7]*r,this.z=o[2]*i+o[5]*s+o[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const i=this.x,s=this.y,r=this.z,o=e.elements,a=1/(o[3]*i+o[7]*s+o[11]*r+o[15]);return this.x=(o[0]*i+o[4]*s+o[8]*r+o[12])*a,this.y=(o[1]*i+o[5]*s+o[9]*r+o[13])*a,this.z=(o[2]*i+o[6]*s+o[10]*r+o[14])*a,this}applyQuaternion(e){const i=this.x,s=this.y,r=this.z,o=e.x,a=e.y,l=e.z,c=e.w,h=2*(a*r-l*s),u=2*(l*i-o*r),d=2*(o*s-a*i);return this.x=i+c*h+a*d-l*u,this.y=s+c*u+l*h-o*d,this.z=r+c*d+o*u-a*h,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const i=this.x,s=this.y,r=this.z,o=e.elements;return this.x=o[0]*i+o[4]*s+o[8]*r,this.y=o[1]*i+o[5]*s+o[9]*r,this.z=o[2]*i+o[6]*s+o[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this}clampLength(e,i){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(e,Math.min(i,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this}lerpVectors(e,i,s){return this.x=e.x+(i.x-e.x)*s,this.y=e.y+(i.y-e.y)*s,this.z=e.z+(i.z-e.z)*s,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,i){const s=e.x,r=e.y,o=e.z,a=i.x,l=i.y,c=i.z;return this.x=r*c-o*l,this.y=o*a-s*c,this.z=s*l-r*a,this}projectOnVector(e){const i=e.lengthSq();if(i===0)return this.set(0,0,0);const s=e.dot(this)/i;return this.copy(e).multiplyScalar(s)}projectOnPlane(e){return FR.copy(this).projectOnVector(e),this.sub(FR)}reflect(e){return this.sub(FR.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const s=this.dot(e)/i;return Math.acos(Pn(s,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,s=this.y-e.y,r=this.z-e.z;return i*i+s*s+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,i,s){const r=Math.sin(i)*e;return this.x=r*Math.sin(s),this.y=Math.cos(i)*e,this.z=r*Math.cos(s),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,i,s){return this.x=e*Math.sin(i),this.y=s,this.z=e*Math.cos(i),this}setFromMatrixPosition(e){const i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(e){const i=this.setFromMatrixColumn(e,0).length(),s=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=i,this.y=s,this.z=r,this}setFromMatrixColumn(e,i){return this.fromArray(e.elements,i*4)}setFromMatrix3Column(e,i){return this.fromArray(e.elements,i*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,i=Math.random()*2-1,s=Math.sqrt(1-i*i);return this.x=s*Math.cos(e),this.y=i,this.z=s*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};const FR=new E,Fz=new Se;let Wt=class{constructor(n=new E(1/0,1/0,1/0),e=new E(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=n,this.max=e}set(n,e){return this.min.copy(n),this.max.copy(e),this}setFromArray(n){this.makeEmpty();for(let e=0,i=n.length;e<i;e+=3)this.expandByPoint(dl.fromArray(n,e));return this}setFromBufferAttribute(n){this.makeEmpty();for(let e=0,i=n.count;e<i;e++)this.expandByPoint(dl.fromBufferAttribute(n,e));return this}setFromPoints(n){this.makeEmpty();for(let e=0,i=n.length;e<i;e++)this.expandByPoint(n[e]);return this}setFromCenterAndSize(n,e){const i=dl.copy(e).multiplyScalar(.5);return this.min.copy(n).sub(i),this.max.copy(n).add(i),this}setFromObject(n,e=!1){return this.makeEmpty(),this.expandByObject(n,e)}clone(){return new this.constructor().copy(this)}copy(n){return this.min.copy(n.min),this.max.copy(n.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(n){return this.isEmpty()?n.set(0,0,0):n.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(n){return this.isEmpty()?n.set(0,0,0):n.subVectors(this.max,this.min)}expandByPoint(n){return this.min.min(n),this.max.max(n),this}expandByVector(n){return this.min.sub(n),this.max.add(n),this}expandByScalar(n){return this.min.addScalar(-n),this.max.addScalar(n),this}expandByObject(n,e=!1){n.updateWorldMatrix(!1,!1);const i=n.geometry;if(i!==void 0){const r=i.getAttribute("position");if(e===!0&&r!==void 0&&n.isInstancedMesh!==!0)for(let o=0,a=r.count;o<a;o++)n.isMesh===!0?n.getVertexPosition(o,dl):dl.fromBufferAttribute(r,o),dl.applyMatrix4(n.matrixWorld),this.expandByPoint(dl);else n.boundingBox!==void 0?(n.boundingBox===null&&n.computeBoundingBox(),Y1.copy(n.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),Y1.copy(i.boundingBox)),Y1.applyMatrix4(n.matrixWorld),this.union(Y1)}const s=n.children;for(let r=0,o=s.length;r<o;r++)this.expandByObject(s[r],e);return this}containsPoint(n){return!(n.x<this.min.x||n.x>this.max.x||n.y<this.min.y||n.y>this.max.y||n.z<this.min.z||n.z>this.max.z)}containsBox(n){return this.min.x<=n.min.x&&n.max.x<=this.max.x&&this.min.y<=n.min.y&&n.max.y<=this.max.y&&this.min.z<=n.min.z&&n.max.z<=this.max.z}getParameter(n,e){return e.set((n.x-this.min.x)/(this.max.x-this.min.x),(n.y-this.min.y)/(this.max.y-this.min.y),(n.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(n){return!(n.max.x<this.min.x||n.min.x>this.max.x||n.max.y<this.min.y||n.min.y>this.max.y||n.max.z<this.min.z||n.min.z>this.max.z)}intersectsSphere(n){return this.clampPoint(n.center,dl),dl.distanceToSquared(n.center)<=n.radius*n.radius}intersectsPlane(n){let e,i;return n.normal.x>0?(e=n.normal.x*this.min.x,i=n.normal.x*this.max.x):(e=n.normal.x*this.max.x,i=n.normal.x*this.min.x),n.normal.y>0?(e+=n.normal.y*this.min.y,i+=n.normal.y*this.max.y):(e+=n.normal.y*this.max.y,i+=n.normal.y*this.min.y),n.normal.z>0?(e+=n.normal.z*this.min.z,i+=n.normal.z*this.max.z):(e+=n.normal.z*this.max.z,i+=n.normal.z*this.min.z),e<=-n.constant&&i>=-n.constant}intersectsTriangle(n){if(this.isEmpty())return!1;this.getCenter(cv),K1.subVectors(this.max,cv),zf.subVectors(n.a,cv),Ff.subVectors(n.b,cv),Nf.subVectors(n.c,cv),Ru.subVectors(Ff,zf),Iu.subVectors(Nf,Ff),Tp.subVectors(zf,Nf);let e=[0,-Ru.z,Ru.y,0,-Iu.z,Iu.y,0,-Tp.z,Tp.y,Ru.z,0,-Ru.x,Iu.z,0,-Iu.x,Tp.z,0,-Tp.x,-Ru.y,Ru.x,0,-Iu.y,Iu.x,0,-Tp.y,Tp.x,0];return!NR(e,zf,Ff,Nf,K1)||(e=[1,0,0,0,1,0,0,0,1],!NR(e,zf,Ff,Nf,K1))?!1:(J1.crossVectors(Ru,Iu),e=[J1.x,J1.y,J1.z],NR(e,zf,Ff,Nf,K1))}clampPoint(n,e){return e.copy(n).clamp(this.min,this.max)}distanceToPoint(n){return this.clampPoint(n,dl).distanceTo(n)}getBoundingSphere(n){return this.isEmpty()?n.makeEmpty():(this.getCenter(n.center),n.radius=this.getSize(dl).length()*.5),n}intersect(n){return this.min.max(n.min),this.max.min(n.max),this.isEmpty()&&this.makeEmpty(),this}union(n){return this.min.min(n.min),this.max.max(n.max),this}applyMatrix4(n){return this.isEmpty()?this:(hh[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(n),hh[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(n),hh[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(n),hh[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(n),hh[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(n),hh[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(n),hh[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(n),hh[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(n),this.setFromPoints(hh),this)}translate(n){return this.min.add(n),this.max.add(n),this}equals(n){return n.min.equals(this.min)&&n.max.equals(this.max)}};const hh=[new E,new E,new E,new E,new E,new E,new E,new E],dl=new E,Y1=new Wt,zf=new E,Ff=new E,Nf=new E,Ru=new E,Iu=new E,Tp=new E,cv=new E,K1=new E,J1=new E,Rp=new E;function NR(n,e,i,s,r){for(let o=0,a=n.length-3;o<=a;o+=3){Rp.fromArray(n,o);const l=r.x*Math.abs(Rp.x)+r.y*Math.abs(Rp.y)+r.z*Math.abs(Rp.z),c=e.dot(Rp),h=i.dot(Rp),u=s.dot(Rp);if(Math.max(-Math.max(c,h,u),Math.min(c,h,u))>l)return!1}return!0}const B8=new Wt,hv=new E,UR=new E;let tn=class{constructor(n=new E,e=-1){this.isSphere=!0,this.center=n,this.radius=e}set(n,e){return this.center.copy(n),this.radius=e,this}setFromPoints(n,e){const i=this.center;e!==void 0?i.copy(e):B8.setFromPoints(n).getCenter(i);let s=0;for(let r=0,o=n.length;r<o;r++)s=Math.max(s,i.distanceToSquared(n[r]));return this.radius=Math.sqrt(s),this}copy(n){return this.center.copy(n.center),this.radius=n.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(n){return n.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(n){return n.distanceTo(this.center)-this.radius}intersectsSphere(n){const e=this.radius+n.radius;return n.center.distanceToSquared(this.center)<=e*e}intersectsBox(n){return n.intersectsSphere(this)}intersectsPlane(n){return Math.abs(n.distanceToPoint(this.center))<=this.radius}clampPoint(n,e){const i=this.center.distanceToSquared(n);return e.copy(n),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(n){return this.isEmpty()?(n.makeEmpty(),n):(n.set(this.center,this.center),n.expandByScalar(this.radius),n)}applyMatrix4(n){return this.center.applyMatrix4(n),this.radius=this.radius*n.getMaxScaleOnAxis(),this}translate(n){return this.center.add(n),this}expandByPoint(n){if(this.isEmpty())return this.center.copy(n),this.radius=0,this;hv.subVectors(n,this.center);const e=hv.lengthSq();if(e>this.radius*this.radius){const i=Math.sqrt(e),s=(i-this.radius)*.5;this.center.addScaledVector(hv,s/i),this.radius+=s}return this}union(n){return n.isEmpty()?this:this.isEmpty()?(this.copy(n),this):(this.center.equals(n.center)===!0?this.radius=Math.max(this.radius,n.radius):(UR.subVectors(n.center,this.center).setLength(n.radius),this.expandByPoint(hv.copy(n.center).add(UR)),this.expandByPoint(hv.copy(n.center).sub(UR))),this)}equals(n){return n.center.equals(this.center)&&n.radius===this.radius}clone(){return new this.constructor().copy(this)}};const uh=new E,VR=new E,q1=new E,Lu=new E,XR=new E,$1=new E,WR=new E;let qr=class{constructor(n=new E,e=new E(0,0,-1)){this.origin=n,this.direction=e}set(n,e){return this.origin.copy(n),this.direction.copy(e),this}copy(n){return this.origin.copy(n.origin),this.direction.copy(n.direction),this}at(n,e){return e.copy(this.origin).addScaledVector(this.direction,n)}lookAt(n){return this.direction.copy(n).sub(this.origin).normalize(),this}recast(n){return this.origin.copy(this.at(n,uh)),this}closestPointToPoint(n,e){e.subVectors(n,this.origin);const i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(n){return Math.sqrt(this.distanceSqToPoint(n))}distanceSqToPoint(n){const e=uh.subVectors(n,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(n):(uh.copy(this.origin).addScaledVector(this.direction,e),uh.distanceToSquared(n))}distanceSqToSegment(n,e,i,s){VR.copy(n).add(e).multiplyScalar(.5),q1.copy(e).sub(n).normalize(),Lu.copy(this.origin).sub(VR);const r=n.distanceTo(e)*.5,o=-this.direction.dot(q1),a=Lu.dot(this.direction),l=-Lu.dot(q1),c=Lu.lengthSq(),h=Math.abs(1-o*o);let u,d,m,f;if(h>0)if(u=o*l-a,d=o*a-l,f=r*h,u>=0)if(d>=-f)if(d<=f){const g=1/h;u*=g,d*=g,m=u*(u+o*d+2*a)+d*(o*u+d+2*l)+c}else d=r,u=Math.max(0,-(o*d+a)),m=-u*u+d*(d+2*l)+c;else d=-r,u=Math.max(0,-(o*d+a)),m=-u*u+d*(d+2*l)+c;else d<=-f?(u=Math.max(0,-(-o*r+a)),d=u>0?-r:Math.min(Math.max(-r,-l),r),m=-u*u+d*(d+2*l)+c):d<=f?(u=0,d=Math.min(Math.max(-r,-l),r),m=d*(d+2*l)+c):(u=Math.max(0,-(o*r+a)),d=u>0?r:Math.min(Math.max(-r,-l),r),m=-u*u+d*(d+2*l)+c);else d=o>0?-r:r,u=Math.max(0,-(o*d+a)),m=-u*u+d*(d+2*l)+c;return i&&i.copy(this.origin).addScaledVector(this.direction,u),s&&s.copy(VR).addScaledVector(q1,d),m}intersectSphere(n,e){uh.subVectors(n.center,this.origin);const i=uh.dot(this.direction),s=uh.dot(uh)-i*i,r=n.radius*n.radius;if(s>r)return null;const o=Math.sqrt(r-s),a=i-o,l=i+o;return l<0?null:a<0?this.at(l,e):this.at(a,e)}intersectsSphere(n){return this.distanceSqToPoint(n.center)<=n.radius*n.radius}distanceToPlane(n){const e=n.normal.dot(this.direction);if(e===0)return n.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(n.normal)+n.constant)/e;return i>=0?i:null}intersectPlane(n,e){const i=this.distanceToPlane(n);return i===null?null:this.at(i,e)}intersectsPlane(n){const e=n.distanceToPoint(this.origin);return e===0||n.normal.dot(this.direction)*e<0}intersectBox(n,e){let i,s,r,o,a,l;const c=1/this.direction.x,h=1/this.direction.y,u=1/this.direction.z,d=this.origin;return c>=0?(i=(n.min.x-d.x)*c,s=(n.max.x-d.x)*c):(i=(n.max.x-d.x)*c,s=(n.min.x-d.x)*c),h>=0?(r=(n.min.y-d.y)*h,o=(n.max.y-d.y)*h):(r=(n.max.y-d.y)*h,o=(n.min.y-d.y)*h),i>o||r>s||((r>i||isNaN(i))&&(i=r),(o<s||isNaN(s))&&(s=o),u>=0?(a=(n.min.z-d.z)*u,l=(n.max.z-d.z)*u):(a=(n.max.z-d.z)*u,l=(n.min.z-d.z)*u),i>l||a>s)||((a>i||i!==i)&&(i=a),(l<s||s!==s)&&(s=l),s<0)?null:this.at(i>=0?i:s,e)}intersectsBox(n){return this.intersectBox(n,uh)!==null}intersectTriangle(n,e,i,s,r){XR.subVectors(e,n),$1.subVectors(i,n),WR.crossVectors(XR,$1);let o=this.direction.dot(WR),a;if(o>0){if(s)return null;a=1}else if(o<0)a=-1,o=-o;else return null;Lu.subVectors(this.origin,n);const l=a*this.direction.dot($1.crossVectors(Lu,$1));if(l<0)return null;const c=a*this.direction.dot(XR.cross(Lu));if(c<0||l+c>o)return null;const h=-a*Lu.dot(WR);return h<0?null:this.at(h/o,r)}applyMatrix4(n){return this.origin.applyMatrix4(n),this.direction.transformDirection(n),this}equals(n){return n.origin.equals(this.origin)&&n.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},he=class _3{constructor(e,i,s,r,o,a,l,c,h,u,d,m,f,g,y,v){_3.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,i,s,r,o,a,l,c,h,u,d,m,f,g,y,v)}set(e,i,s,r,o,a,l,c,h,u,d,m,f,g,y,v){const b=this.elements;return b[0]=e,b[4]=i,b[8]=s,b[12]=r,b[1]=o,b[5]=a,b[9]=l,b[13]=c,b[2]=h,b[6]=u,b[10]=d,b[14]=m,b[3]=f,b[7]=g,b[11]=y,b[15]=v,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new _3().fromArray(this.elements)}copy(e){const i=this.elements,s=e.elements;return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=s[7],i[8]=s[8],i[9]=s[9],i[10]=s[10],i[11]=s[11],i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15],this}copyPosition(e){const i=this.elements,s=e.elements;return i[12]=s[12],i[13]=s[13],i[14]=s[14],this}setFromMatrix3(e){const i=e.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(e,i,s){return e.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),s.setFromMatrixColumn(this,2),this}makeBasis(e,i,s){return this.set(e.x,i.x,s.x,0,e.y,i.y,s.y,0,e.z,i.z,s.z,0,0,0,0,1),this}extractRotation(e){const i=this.elements,s=e.elements,r=1/Uf.setFromMatrixColumn(e,0).length(),o=1/Uf.setFromMatrixColumn(e,1).length(),a=1/Uf.setFromMatrixColumn(e,2).length();return i[0]=s[0]*r,i[1]=s[1]*r,i[2]=s[2]*r,i[3]=0,i[4]=s[4]*o,i[5]=s[5]*o,i[6]=s[6]*o,i[7]=0,i[8]=s[8]*a,i[9]=s[9]*a,i[10]=s[10]*a,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(e){const i=this.elements,s=e.x,r=e.y,o=e.z,a=Math.cos(s),l=Math.sin(s),c=Math.cos(r),h=Math.sin(r),u=Math.cos(o),d=Math.sin(o);if(e.order==="XYZ"){const m=a*u,f=a*d,g=l*u,y=l*d;i[0]=c*u,i[4]=-c*d,i[8]=h,i[1]=f+g*h,i[5]=m-y*h,i[9]=-l*c,i[2]=y-m*h,i[6]=g+f*h,i[10]=a*c}else if(e.order==="YXZ"){const m=c*u,f=c*d,g=h*u,y=h*d;i[0]=m+y*l,i[4]=g*l-f,i[8]=a*h,i[1]=a*d,i[5]=a*u,i[9]=-l,i[2]=f*l-g,i[6]=y+m*l,i[10]=a*c}else if(e.order==="ZXY"){const m=c*u,f=c*d,g=h*u,y=h*d;i[0]=m-y*l,i[4]=-a*d,i[8]=g+f*l,i[1]=f+g*l,i[5]=a*u,i[9]=y-m*l,i[2]=-a*h,i[6]=l,i[10]=a*c}else if(e.order==="ZYX"){const m=a*u,f=a*d,g=l*u,y=l*d;i[0]=c*u,i[4]=g*h-f,i[8]=m*h+y,i[1]=c*d,i[5]=y*h+m,i[9]=f*h-g,i[2]=-h,i[6]=l*c,i[10]=a*c}else if(e.order==="YZX"){const m=a*c,f=a*h,g=l*c,y=l*h;i[0]=c*u,i[4]=y-m*d,i[8]=g*d+f,i[1]=d,i[5]=a*u,i[9]=-l*u,i[2]=-h*u,i[6]=f*d+g,i[10]=m-y*d}else if(e.order==="XZY"){const m=a*c,f=a*h,g=l*c,y=l*h;i[0]=c*u,i[4]=-d,i[8]=h*u,i[1]=m*d+y,i[5]=a*u,i[9]=f*d-g,i[2]=g*d-f,i[6]=l*u,i[10]=y*d+m}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(e){return this.compose(k8,e,D8)}lookAt(e,i,s){const r=this.elements;return Xo.subVectors(e,i),Xo.lengthSq()===0&&(Xo.z=1),Xo.normalize(),Pu.crossVectors(s,Xo),Pu.lengthSq()===0&&(Math.abs(s.z)===1?Xo.x+=1e-4:Xo.z+=1e-4,Xo.normalize(),Pu.crossVectors(s,Xo)),Pu.normalize(),ew.crossVectors(Xo,Pu),r[0]=Pu.x,r[4]=ew.x,r[8]=Xo.x,r[1]=Pu.y,r[5]=ew.y,r[9]=Xo.y,r[2]=Pu.z,r[6]=ew.z,r[10]=Xo.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const s=e.elements,r=i.elements,o=this.elements,a=s[0],l=s[4],c=s[8],h=s[12],u=s[1],d=s[5],m=s[9],f=s[13],g=s[2],y=s[6],v=s[10],b=s[14],A=s[3],x=s[7],w=s[11],_=s[15],S=r[0],M=r[4],R=r[8],P=r[12],C=r[1],L=r[5],B=r[9],z=r[13],D=r[2],W=r[6],O=r[10],F=r[14],X=r[3],J=r[7],q=r[11],oe=r[15];return o[0]=a*S+l*C+c*D+h*X,o[4]=a*M+l*L+c*W+h*J,o[8]=a*R+l*B+c*O+h*q,o[12]=a*P+l*z+c*F+h*oe,o[1]=u*S+d*C+m*D+f*X,o[5]=u*M+d*L+m*W+f*J,o[9]=u*R+d*B+m*O+f*q,o[13]=u*P+d*z+m*F+f*oe,o[2]=g*S+y*C+v*D+b*X,o[6]=g*M+y*L+v*W+b*J,o[10]=g*R+y*B+v*O+b*q,o[14]=g*P+y*z+v*F+b*oe,o[3]=A*S+x*C+w*D+_*X,o[7]=A*M+x*L+w*W+_*J,o[11]=A*R+x*B+w*O+_*q,o[15]=A*P+x*z+w*F+_*oe,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[4]*=e,i[8]*=e,i[12]*=e,i[1]*=e,i[5]*=e,i[9]*=e,i[13]*=e,i[2]*=e,i[6]*=e,i[10]*=e,i[14]*=e,i[3]*=e,i[7]*=e,i[11]*=e,i[15]*=e,this}determinant(){const e=this.elements,i=e[0],s=e[4],r=e[8],o=e[12],a=e[1],l=e[5],c=e[9],h=e[13],u=e[2],d=e[6],m=e[10],f=e[14],g=e[3],y=e[7],v=e[11],b=e[15];return g*(+o*c*d-r*h*d-o*l*m+s*h*m+r*l*f-s*c*f)+y*(+i*c*f-i*h*m+o*a*m-r*a*f+r*h*u-o*c*u)+v*(+i*h*d-i*l*f-o*a*d+s*a*f+o*l*u-s*h*u)+b*(-r*l*u-i*c*d+i*l*m+r*a*d-s*a*m+s*c*u)}transpose(){const e=this.elements;let i;return i=e[1],e[1]=e[4],e[4]=i,i=e[2],e[2]=e[8],e[8]=i,i=e[6],e[6]=e[9],e[9]=i,i=e[3],e[3]=e[12],e[12]=i,i=e[7],e[7]=e[13],e[13]=i,i=e[11],e[11]=e[14],e[14]=i,this}setPosition(e,i,s){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=i,r[14]=s),this}invert(){const e=this.elements,i=e[0],s=e[1],r=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],u=e[8],d=e[9],m=e[10],f=e[11],g=e[12],y=e[13],v=e[14],b=e[15],A=d*v*h-y*m*h+y*c*f-l*v*f-d*c*b+l*m*b,x=g*m*h-u*v*h-g*c*f+a*v*f+u*c*b-a*m*b,w=u*y*h-g*d*h+g*l*f-a*y*f-u*l*b+a*d*b,_=g*d*c-u*y*c-g*l*m+a*y*m+u*l*v-a*d*v,S=i*A+s*x+r*w+o*_;if(S===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const M=1/S;return e[0]=A*M,e[1]=(y*m*o-d*v*o-y*r*f+s*v*f+d*r*b-s*m*b)*M,e[2]=(l*v*o-y*c*o+y*r*h-s*v*h-l*r*b+s*c*b)*M,e[3]=(d*c*o-l*m*o-d*r*h+s*m*h+l*r*f-s*c*f)*M,e[4]=x*M,e[5]=(u*v*o-g*m*o+g*r*f-i*v*f-u*r*b+i*m*b)*M,e[6]=(g*c*o-a*v*o-g*r*h+i*v*h+a*r*b-i*c*b)*M,e[7]=(a*m*o-u*c*o+u*r*h-i*m*h-a*r*f+i*c*f)*M,e[8]=w*M,e[9]=(g*d*o-u*y*o-g*s*f+i*y*f+u*s*b-i*d*b)*M,e[10]=(a*y*o-g*l*o+g*s*h-i*y*h-a*s*b+i*l*b)*M,e[11]=(u*l*o-a*d*o-u*s*h+i*d*h+a*s*f-i*l*f)*M,e[12]=_*M,e[13]=(u*y*r-g*d*r+g*s*m-i*y*m-u*s*v+i*d*v)*M,e[14]=(g*l*r-a*y*r-g*s*c+i*y*c+a*s*v-i*l*v)*M,e[15]=(a*d*r-u*l*r+u*s*c-i*d*c-a*s*m+i*l*m)*M,this}scale(e){const i=this.elements,s=e.x,r=e.y,o=e.z;return i[0]*=s,i[4]*=r,i[8]*=o,i[1]*=s,i[5]*=r,i[9]*=o,i[2]*=s,i[6]*=r,i[10]*=o,i[3]*=s,i[7]*=r,i[11]*=o,this}getMaxScaleOnAxis(){const e=this.elements,i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],s=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(i,s,r))}makeTranslation(e,i,s){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,i,0,0,1,s,0,0,0,1),this}makeRotationX(e){const i=Math.cos(e),s=Math.sin(e);return this.set(1,0,0,0,0,i,-s,0,0,s,i,0,0,0,0,1),this}makeRotationY(e){const i=Math.cos(e),s=Math.sin(e);return this.set(i,0,s,0,0,1,0,0,-s,0,i,0,0,0,0,1),this}makeRotationZ(e){const i=Math.cos(e),s=Math.sin(e);return this.set(i,-s,0,0,s,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,i){const s=Math.cos(i),r=Math.sin(i),o=1-s,a=e.x,l=e.y,c=e.z,h=o*a,u=o*l;return this.set(h*a+s,h*l-r*c,h*c+r*l,0,h*l+r*c,u*l+s,u*c-r*a,0,h*c-r*l,u*c+r*a,o*c*c+s,0,0,0,0,1),this}makeScale(e,i,s){return this.set(e,0,0,0,0,i,0,0,0,0,s,0,0,0,0,1),this}makeShear(e,i,s,r,o,a){return this.set(1,s,o,0,e,1,a,0,i,r,1,0,0,0,0,1),this}compose(e,i,s){const r=this.elements,o=i._x,a=i._y,l=i._z,c=i._w,h=o+o,u=a+a,d=l+l,m=o*h,f=o*u,g=o*d,y=a*u,v=a*d,b=l*d,A=c*h,x=c*u,w=c*d,_=s.x,S=s.y,M=s.z;return r[0]=(1-(y+b))*_,r[1]=(f+w)*_,r[2]=(g-x)*_,r[3]=0,r[4]=(f-w)*S,r[5]=(1-(m+b))*S,r[6]=(v+A)*S,r[7]=0,r[8]=(g+x)*M,r[9]=(v-A)*M,r[10]=(1-(m+y))*M,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,i,s){const r=this.elements;let o=Uf.set(r[0],r[1],r[2]).length();const a=Uf.set(r[4],r[5],r[6]).length(),l=Uf.set(r[8],r[9],r[10]).length();this.determinant()<0&&(o=-o),e.x=r[12],e.y=r[13],e.z=r[14],pl.copy(this);const c=1/o,h=1/a,u=1/l;return pl.elements[0]*=c,pl.elements[1]*=c,pl.elements[2]*=c,pl.elements[4]*=h,pl.elements[5]*=h,pl.elements[6]*=h,pl.elements[8]*=u,pl.elements[9]*=u,pl.elements[10]*=u,i.setFromRotationMatrix(pl),s.x=o,s.y=a,s.z=l,this}makePerspective(e,i,s,r,o,a,l=tc){const c=this.elements,h=2*o/(i-e),u=2*o/(s-r),d=(i+e)/(i-e),m=(s+r)/(s-r);let f,g;if(l===tc)f=-(a+o)/(a-o),g=-2*a*o/(a-o);else if(l===ov)f=-a/(a-o),g=-a*o/(a-o);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+l);return c[0]=h,c[4]=0,c[8]=d,c[12]=0,c[1]=0,c[5]=u,c[9]=m,c[13]=0,c[2]=0,c[6]=0,c[10]=f,c[14]=g,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,i,s,r,o,a,l=tc){const c=this.elements,h=1/(i-e),u=1/(s-r),d=1/(a-o),m=(i+e)*h,f=(s+r)*u;let g,y;if(l===tc)g=(a+o)*d,y=-2*d;else if(l===ov)g=o*d,y=-1*d;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+l);return c[0]=2*h,c[4]=0,c[8]=0,c[12]=-m,c[1]=0,c[5]=2*u,c[9]=0,c[13]=-f,c[2]=0,c[6]=0,c[10]=y,c[14]=-g,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const i=this.elements,s=e.elements;for(let r=0;r<16;r++)if(i[r]!==s[r])return!1;return!0}fromArray(e,i=0){for(let s=0;s<16;s++)this.elements[s]=e[s+i];return this}toArray(e=[],i=0){const s=this.elements;return e[i]=s[0],e[i+1]=s[1],e[i+2]=s[2],e[i+3]=s[3],e[i+4]=s[4],e[i+5]=s[5],e[i+6]=s[6],e[i+7]=s[7],e[i+8]=s[8],e[i+9]=s[9],e[i+10]=s[10],e[i+11]=s[11],e[i+12]=s[12],e[i+13]=s[13],e[i+14]=s[14],e[i+15]=s[15],e}};const Uf=new E,pl=new he,k8=new E(0,0,0),D8=new E(1,1,1),Pu=new E,ew=new E,Xo=new E,Nz=new he,Uz=new Se;let si=class H6{constructor(e=0,i=0,s=0,r=H6.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=i,this._z=s,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,i,s,r=this._order){return this._x=e,this._y=i,this._z=s,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,i=this._order,s=!0){const r=e.elements,o=r[0],a=r[4],l=r[8],c=r[1],h=r[5],u=r[9],d=r[2],m=r[6],f=r[10];switch(i){case"XYZ":this._y=Math.asin(Pn(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,f),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(m,h),this._z=0);break;case"YXZ":this._x=Math.asin(-Pn(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(l,f),this._z=Math.atan2(c,h)):(this._y=Math.atan2(-d,o),this._z=0);break;case"ZXY":this._x=Math.asin(Pn(m,-1,1)),Math.abs(m)<.9999999?(this._y=Math.atan2(-d,f),this._z=Math.atan2(-a,h)):(this._y=0,this._z=Math.atan2(c,o));break;case"ZYX":this._y=Math.asin(-Pn(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(m,f),this._z=Math.atan2(c,o)):(this._x=0,this._z=Math.atan2(-a,h));break;case"YZX":this._z=Math.asin(Pn(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-u,h),this._y=Math.atan2(-d,o)):(this._x=0,this._y=Math.atan2(l,f));break;case"XZY":this._z=Math.asin(-Pn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(m,h),this._y=Math.atan2(l,o)):(this._x=Math.atan2(-u,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,s===!0&&this._onChangeCallback(),this}setFromQuaternion(e,i,s){return Nz.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Nz,i,s)}setFromVector3(e,i=this._order){return this.set(e.x,e.y,e.z,i)}reorder(e){return Uz.setFromEuler(this),this.setFromQuaternion(Uz,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};si.DEFAULT_ORDER="XYZ";let Mr=class{constructor(){this.mask=1}set(n){this.mask=(1<<n|0)>>>0}enable(n){this.mask|=1<<n|0}enableAll(){this.mask=-1}toggle(n){this.mask^=1<<n|0}disable(n){this.mask&=~(1<<n|0)}disableAll(){this.mask=0}test(n){return(this.mask&n.mask)!==0}isEnabled(n){return(this.mask&(1<<n|0))!==0}},O8=0;const Vz=new E,Vf=new Se,dh=new he,tw=new E,uv=new E,G8=new E,z8=new Se,Xz=new E(1,0,0),Wz=new E(0,1,0),Hz=new E(0,0,1),F8={type:"added"},N8={type:"removed"},HR={type:"childadded",child:null},jR={type:"childremoved",child:null};let ye=class AT extends Rs{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:O8++}),this.uuid=Vo(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=AT.DEFAULT_UP.clone();const e=new E,i=new si,s=new Se,r=new E(1,1,1);function o(){s.setFromEuler(i,!1)}function a(){i.setFromQuaternion(s,void 0,!1)}i._onChange(o),s._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:s},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new he},normalMatrix:{value:new Gt}}),this.matrix=new he,this.matrixWorld=new he,this.matrixAutoUpdate=AT.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=AT.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Mr,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,i){this.quaternion.setFromAxisAngle(e,i)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,i){return Vf.setFromAxisAngle(e,i),this.quaternion.multiply(Vf),this}rotateOnWorldAxis(e,i){return Vf.setFromAxisAngle(e,i),this.quaternion.premultiply(Vf),this}rotateX(e){return this.rotateOnAxis(Xz,e)}rotateY(e){return this.rotateOnAxis(Wz,e)}rotateZ(e){return this.rotateOnAxis(Hz,e)}translateOnAxis(e,i){return Vz.copy(e).applyQuaternion(this.quaternion),this.position.add(Vz.multiplyScalar(i)),this}translateX(e){return this.translateOnAxis(Xz,e)}translateY(e){return this.translateOnAxis(Wz,e)}translateZ(e){return this.translateOnAxis(Hz,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(dh.copy(this.matrixWorld).invert())}lookAt(e,i,s){e.isVector3?tw.copy(e):tw.set(e,i,s);const r=this.parent;this.updateWorldMatrix(!0,!1),uv.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?dh.lookAt(uv,tw,this.up):dh.lookAt(tw,uv,this.up),this.quaternion.setFromRotationMatrix(dh),r&&(dh.extractRotation(r.matrixWorld),Vf.setFromRotationMatrix(dh),this.quaternion.premultiply(Vf.invert()))}add(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(F8),HR.child=e,this.dispatchEvent(HR),HR.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let s=0;s<arguments.length;s++)this.remove(arguments[s]);return this}const i=this.children.indexOf(e);return i!==-1&&(e.parent=null,this.children.splice(i,1),e.dispatchEvent(N8),jR.child=e,this.dispatchEvent(jR),jR.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),dh.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),dh.multiply(e.parent.matrixWorld)),e.applyMatrix4(dh),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,i){if(this[e]===i)return this;for(let s=0,r=this.children.length;s<r;s++){const o=this.children[s].getObjectByProperty(e,i);if(o!==void 0)return o}}getObjectsByProperty(e,i,s=[]){this[e]===i&&s.push(this);const r=this.children;for(let o=0,a=r.length;o<a;o++)r[o].getObjectsByProperty(e,i,s);return s}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(uv,e,G8),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(uv,z8,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return e.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(e){e(this);const i=this.children;for(let s=0,r=i.length;s<r;s++)i[s].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const i=this.children;for(let s=0,r=i.length;s<r;s++)i[s].traverseVisible(e)}traverseAncestors(e){const i=this.parent;i!==null&&(e(i),i.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const i=this.children;for(let s=0,r=i.length;s<r;s++){const o=i[s];(o.matrixWorldAutoUpdate===!0||e===!0)&&o.updateMatrixWorld(e)}}updateWorldMatrix(e,i){const s=this.parent;if(e===!0&&s!==null&&s.matrixWorldAutoUpdate===!0&&s.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),i===!0){const r=this.children;for(let o=0,a=r.length;o<a;o++){const l=r[o];l.matrixWorldAutoUpdate===!0&&l.updateWorldMatrix(!1,!0)}}}toJSON(e){const i=e===void 0||typeof e=="string",s={};i&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},s.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.visibility=this._visibility,r.active=this._active,r.bounds=this._bounds.map(l=>({boxInitialized:l.boxInitialized,boxMin:l.box.min.toArray(),boxMax:l.box.max.toArray(),sphereInitialized:l.sphereInitialized,sphereRadius:l.sphere.radius,sphereCenter:l.sphere.center.toArray()})),r.maxGeometryCount=this._maxGeometryCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.geometryCount=this._geometryCount,r.matricesTexture=this._matricesTexture.toJSON(e),this.boundingSphere!==null&&(r.boundingSphere={center:r.boundingSphere.center.toArray(),radius:r.boundingSphere.radius}),this.boundingBox!==null&&(r.boundingBox={min:r.boundingBox.min.toArray(),max:r.boundingBox.max.toArray()}));function o(l,c){return l[c.uuid]===void 0&&(l[c.uuid]=c.toJSON(e)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=o(e.geometries,this.geometry);const l=this.geometry.parameters;if(l!==void 0&&l.shapes!==void 0){const c=l.shapes;if(Array.isArray(c))for(let h=0,u=c.length;h<u;h++){const d=c[h];o(e.shapes,d)}else o(e.shapes,c)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(o(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const l=[];for(let c=0,h=this.material.length;c<h;c++)l.push(o(e.materials,this.material[c]));r.material=l}else r.material=o(e.materials,this.material);if(this.children.length>0){r.children=[];for(let l=0;l<this.children.length;l++)r.children.push(this.children[l].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let l=0;l<this.animations.length;l++){const c=this.animations[l];r.animations.push(o(e.animations,c))}}if(i){const l=a(e.geometries),c=a(e.materials),h=a(e.textures),u=a(e.images),d=a(e.shapes),m=a(e.skeletons),f=a(e.animations),g=a(e.nodes);l.length>0&&(s.geometries=l),c.length>0&&(s.materials=c),h.length>0&&(s.textures=h),u.length>0&&(s.images=u),d.length>0&&(s.shapes=d),m.length>0&&(s.skeletons=m),f.length>0&&(s.animations=f),g.length>0&&(s.nodes=g)}return s.object=r,s;function a(l){const c=[];for(const h in l){const u=l[h];delete u.metadata,c.push(u)}return c}}clone(e){return new this.constructor().copy(this,e)}copy(e,i=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),i===!0)for(let s=0;s<e.children.length;s++){const r=e.children[s];this.add(r.clone())}return this}};ye.DEFAULT_UP=new E(0,1,0),ye.DEFAULT_MATRIX_AUTO_UPDATE=!0,ye.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const ml=new E,ph=new E,QR=new E,mh=new E,Xf=new E,Wf=new E,jz=new E,ZR=new E,YR=new E,KR=new E;let Ks=class Oy{constructor(e=new E,i=new E,s=new E){this.a=e,this.b=i,this.c=s}static getNormal(e,i,s,r){r.subVectors(s,i),ml.subVectors(e,i),r.cross(ml);const o=r.lengthSq();return o>0?r.multiplyScalar(1/Math.sqrt(o)):r.set(0,0,0)}static getBarycoord(e,i,s,r,o){ml.subVectors(r,i),ph.subVectors(s,i),QR.subVectors(e,i);const a=ml.dot(ml),l=ml.dot(ph),c=ml.dot(QR),h=ph.dot(ph),u=ph.dot(QR),d=a*h-l*l;if(d===0)return o.set(0,0,0),null;const m=1/d,f=(h*c-l*u)*m,g=(a*u-l*c)*m;return o.set(1-f-g,g,f)}static containsPoint(e,i,s,r){return this.getBarycoord(e,i,s,r,mh)===null?!1:mh.x>=0&&mh.y>=0&&mh.x+mh.y<=1}static getInterpolation(e,i,s,r,o,a,l,c){return this.getBarycoord(e,i,s,r,mh)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(o,mh.x),c.addScaledVector(a,mh.y),c.addScaledVector(l,mh.z),c)}static isFrontFacing(e,i,s,r){return ml.subVectors(s,i),ph.subVectors(e,i),ml.cross(ph).dot(r)<0}set(e,i,s){return this.a.copy(e),this.b.copy(i),this.c.copy(s),this}setFromPointsAndIndices(e,i,s,r){return this.a.copy(e[i]),this.b.copy(e[s]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,i,s,r){return this.a.fromBufferAttribute(e,i),this.b.fromBufferAttribute(e,s),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return ml.subVectors(this.c,this.b),ph.subVectors(this.a,this.b),ml.cross(ph).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Oy.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,i){return Oy.getBarycoord(e,this.a,this.b,this.c,i)}getInterpolation(e,i,s,r,o){return Oy.getInterpolation(e,this.a,this.b,this.c,i,s,r,o)}containsPoint(e){return Oy.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Oy.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,i){const s=this.a,r=this.b,o=this.c;let a,l;Xf.subVectors(r,s),Wf.subVectors(o,s),ZR.subVectors(e,s);const c=Xf.dot(ZR),h=Wf.dot(ZR);if(c<=0&&h<=0)return i.copy(s);YR.subVectors(e,r);const u=Xf.dot(YR),d=Wf.dot(YR);if(u>=0&&d<=u)return i.copy(r);const m=c*d-u*h;if(m<=0&&c>=0&&u<=0)return a=c/(c-u),i.copy(s).addScaledVector(Xf,a);KR.subVectors(e,o);const f=Xf.dot(KR),g=Wf.dot(KR);if(g>=0&&f<=g)return i.copy(o);const y=f*h-c*g;if(y<=0&&h>=0&&g<=0)return l=h/(h-g),i.copy(s).addScaledVector(Wf,l);const v=u*g-f*d;if(v<=0&&d-u>=0&&f-g>=0)return jz.subVectors(o,r),l=(d-u)/(d-u+(f-g)),i.copy(r).addScaledVector(jz,l);const b=1/(v+y+m);return a=y*b,l=m*b,i.copy(s).addScaledVector(Xf,a).addScaledVector(Wf,l)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}};const Qz={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Bu={h:0,s:0,l:0},iw={h:0,s:0,l:0};function JR(n,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?n+(e-n)*6*i:i<1/2?e:i<2/3?n+(e-n)*6*(2/3-i):n}let Ae=class{constructor(n,e,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(n,e,i)}set(n,e,i){if(e===void 0&&i===void 0){const s=n;s&&s.isColor?this.copy(s):typeof s=="number"?this.setHex(s):typeof s=="string"&&this.setStyle(s)}else this.setRGB(n,e,i);return this}setScalar(n){return this.r=n,this.g=n,this.b=n,this}setHex(n,e=vt){return n=Math.floor(n),this.r=(n>>16&255)/255,this.g=(n>>8&255)/255,this.b=(n&255)/255,Ci.toWorkingColorSpace(this,e),this}setRGB(n,e,i,s=Ci.workingColorSpace){return this.r=n,this.g=e,this.b=i,Ci.toWorkingColorSpace(this,s),this}setHSL(n,e,i,s=Ci.workingColorSpace){if(n=PR(n,1),e=Pn(e,0,1),i=Pn(i,0,1),e===0)this.r=this.g=this.b=i;else{const r=i<=.5?i*(1+e):i+e-i*e,o=2*i-r;this.r=JR(o,r,n+1/3),this.g=JR(o,r,n),this.b=JR(o,r,n-1/3)}return Ci.toWorkingColorSpace(this,s),this}setStyle(n,e=vt){function i(r){r!==void 0&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+n+" will be ignored.")}let s;if(s=/^(\w+)\(([^\)]*)\)/.exec(n)){let r;const o=s[1],a=s[2];switch(o){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,e);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,e);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+n)}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(n)){const r=s[1],o=r.length;if(o===3)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,e);if(o===6)return this.setHex(parseInt(r,16),e);console.warn("THREE.Color: Invalid hex color "+n)}else if(n&&n.length>0)return this.setColorName(n,e);return this}setColorName(n,e=vt){const i=Qz[n.toLowerCase()];return i!==void 0?this.setHex(i,e):console.warn("THREE.Color: Unknown color "+n),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(n){return this.r=n.r,this.g=n.g,this.b=n.b,this}copySRGBToLinear(n){return this.r=Of(n.r),this.g=Of(n.g),this.b=Of(n.b),this}copyLinearToSRGB(n){return this.r=DR(n.r),this.g=DR(n.g),this.b=DR(n.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(n=vt){return Ci.fromWorkingColorSpace(Er.copy(this),n),Math.round(Pn(Er.r*255,0,255))*65536+Math.round(Pn(Er.g*255,0,255))*256+Math.round(Pn(Er.b*255,0,255))}getHexString(n=vt){return("000000"+this.getHex(n).toString(16)).slice(-6)}getHSL(n,e=Ci.workingColorSpace){Ci.fromWorkingColorSpace(Er.copy(this),e);const i=Er.r,s=Er.g,r=Er.b,o=Math.max(i,s,r),a=Math.min(i,s,r);let l,c;const h=(a+o)/2;if(a===o)l=0,c=0;else{const u=o-a;switch(c=h<=.5?u/(o+a):u/(2-o-a),o){case i:l=(s-r)/u+(s<r?6:0);break;case s:l=(r-i)/u+2;break;case r:l=(i-s)/u+4;break}l/=6}return n.h=l,n.s=c,n.l=h,n}getRGB(n,e=Ci.workingColorSpace){return Ci.fromWorkingColorSpace(Er.copy(this),e),n.r=Er.r,n.g=Er.g,n.b=Er.b,n}getStyle(n=vt){Ci.fromWorkingColorSpace(Er.copy(this),n);const e=Er.r,i=Er.g,s=Er.b;return n!==vt?`color(${n} ${e.toFixed(3)} ${i.toFixed(3)} ${s.toFixed(3)})`:`rgb(${Math.round(e*255)},${Math.round(i*255)},${Math.round(s*255)})`}offsetHSL(n,e,i){return this.getHSL(Bu),this.setHSL(Bu.h+n,Bu.s+e,Bu.l+i)}add(n){return this.r+=n.r,this.g+=n.g,this.b+=n.b,this}addColors(n,e){return this.r=n.r+e.r,this.g=n.g+e.g,this.b=n.b+e.b,this}addScalar(n){return this.r+=n,this.g+=n,this.b+=n,this}sub(n){return this.r=Math.max(0,this.r-n.r),this.g=Math.max(0,this.g-n.g),this.b=Math.max(0,this.b-n.b),this}multiply(n){return this.r*=n.r,this.g*=n.g,this.b*=n.b,this}multiplyScalar(n){return this.r*=n,this.g*=n,this.b*=n,this}lerp(n,e){return this.r+=(n.r-this.r)*e,this.g+=(n.g-this.g)*e,this.b+=(n.b-this.b)*e,this}lerpColors(n,e,i){return this.r=n.r+(e.r-n.r)*i,this.g=n.g+(e.g-n.g)*i,this.b=n.b+(e.b-n.b)*i,this}lerpHSL(n,e){this.getHSL(Bu),n.getHSL(iw);const i=av(Bu.h,iw.h,e),s=av(Bu.s,iw.s,e),r=av(Bu.l,iw.l,e);return this.setHSL(i,s,r),this}setFromVector3(n){return this.r=n.x,this.g=n.y,this.b=n.z,this}applyMatrix3(n){const e=this.r,i=this.g,s=this.b,r=n.elements;return this.r=r[0]*e+r[3]*i+r[6]*s,this.g=r[1]*e+r[4]*i+r[7]*s,this.b=r[2]*e+r[5]*i+r[8]*s,this}equals(n){return n.r===this.r&&n.g===this.g&&n.b===this.b}fromArray(n,e=0){return this.r=n[e],this.g=n[e+1],this.b=n[e+2],this}toArray(n=[],e=0){return n[e]=this.r,n[e+1]=this.g,n[e+2]=this.b,n}fromBufferAttribute(n,e){return this.r=n.getX(e),this.g=n.getY(e),this.b=n.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const Er=new Ae;Ae.NAMES=Qz;let U8=0,Ft=class extends Rs{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:U8++}),this.uuid=Vo(),this.name="",this.type="Material",this.blending=xu,this.side=Un,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=_1,this.blendDst=S1,this.blendEquation=wu,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Ae(0,0,0),this.blendAlpha=0,this.depthFunc=Ap,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=X1,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Tu,this.stencilZFail=Tu,this.stencilZPass=Tu,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(n){this._alphaTest>0!=n>0&&this.version++,this._alphaTest=n}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(n){if(n!==void 0)for(const e in n){const i=n[e];if(i===void 0){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}const s=this[e];if(s===void 0){console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`);continue}s&&s.isColor?s.set(i):s&&s.isVector3&&i&&i.isVector3?s.copy(i):this[e]=i}}toJSON(n){const e=n===void 0||typeof n=="string";e&&(n={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(n).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(n).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(n).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(n).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(n).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(n).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(n).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(n).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(n).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(n).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(n).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(n).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(n).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(n).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(n).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(n).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(n).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(n).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(n).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(n).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(n).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(n).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(n).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(n).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==xu&&(i.blending=this.blending),this.side!==Un&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==_1&&(i.blendSrc=this.blendSrc),this.blendDst!==S1&&(i.blendDst=this.blendDst),this.blendEquation!==wu&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==Ap&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==X1&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Tu&&(i.stencilFail=this.stencilFail),this.stencilZFail!==Tu&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==Tu&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function s(r){const o=[];for(const a in r){const l=r[a];delete l.metadata,o.push(l)}return o}if(e){const r=s(n.textures),o=s(n.images);r.length>0&&(i.textures=r),o.length>0&&(i.images=o)}return i}clone(){return new this.constructor().copy(this)}copy(n){this.name=n.name,this.blending=n.blending,this.side=n.side,this.vertexColors=n.vertexColors,this.opacity=n.opacity,this.transparent=n.transparent,this.blendSrc=n.blendSrc,this.blendDst=n.blendDst,this.blendEquation=n.blendEquation,this.blendSrcAlpha=n.blendSrcAlpha,this.blendDstAlpha=n.blendDstAlpha,this.blendEquationAlpha=n.blendEquationAlpha,this.blendColor.copy(n.blendColor),this.blendAlpha=n.blendAlpha,this.depthFunc=n.depthFunc,this.depthTest=n.depthTest,this.depthWrite=n.depthWrite,this.stencilWriteMask=n.stencilWriteMask,this.stencilFunc=n.stencilFunc,this.stencilRef=n.stencilRef,this.stencilFuncMask=n.stencilFuncMask,this.stencilFail=n.stencilFail,this.stencilZFail=n.stencilZFail,this.stencilZPass=n.stencilZPass,this.stencilWrite=n.stencilWrite;const e=n.clippingPlanes;let i=null;if(e!==null){const s=e.length;i=new Array(s);for(let r=0;r!==s;++r)i[r]=e[r].clone()}return this.clippingPlanes=i,this.clipIntersection=n.clipIntersection,this.clipShadows=n.clipShadows,this.shadowSide=n.shadowSide,this.colorWrite=n.colorWrite,this.precision=n.precision,this.polygonOffset=n.polygonOffset,this.polygonOffsetFactor=n.polygonOffsetFactor,this.polygonOffsetUnits=n.polygonOffsetUnits,this.dithering=n.dithering,this.alphaTest=n.alphaTest,this.alphaHash=n.alphaHash,this.alphaToCoverage=n.alphaToCoverage,this.premultipliedAlpha=n.premultipliedAlpha,this.forceSinglePass=n.forceSinglePass,this.visible=n.visible,this.toneMapped=n.toneMapped,this.userData=JSON.parse(JSON.stringify(n.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(n){n===!0&&this.version++}},Qt=class extends Ft{constructor(n){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Ae(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new si,this.combine=Zy,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.map=n.map,this.lightMap=n.lightMap,this.lightMapIntensity=n.lightMapIntensity,this.aoMap=n.aoMap,this.aoMapIntensity=n.aoMapIntensity,this.specularMap=n.specularMap,this.alphaMap=n.alphaMap,this.envMap=n.envMap,this.envMapRotation.copy(n.envMapRotation),this.combine=n.combine,this.reflectivity=n.reflectivity,this.refractionRatio=n.refractionRatio,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.wireframeLinecap=n.wireframeLinecap,this.wireframeLinejoin=n.wireframeLinejoin,this.fog=n.fog,this}};const fh=V8();function V8(){const n=new ArrayBuffer(4),e=new Float32Array(n),i=new Uint32Array(n),s=new Uint32Array(512),r=new Uint32Array(512);for(let c=0;c<256;++c){const h=c-127;h<-27?(s[c]=0,s[c|256]=32768,r[c]=24,r[c|256]=24):h<-14?(s[c]=1024>>-h-14,s[c|256]=1024>>-h-14|32768,r[c]=-h-1,r[c|256]=-h-1):h<=15?(s[c]=h+15<<10,s[c|256]=h+15<<10|32768,r[c]=13,r[c|256]=13):h<128?(s[c]=31744,s[c|256]=64512,r[c]=24,r[c|256]=24):(s[c]=31744,s[c|256]=64512,r[c]=13,r[c|256]=13)}const o=new Uint32Array(2048),a=new Uint32Array(64),l=new Uint32Array(64);for(let c=1;c<1024;++c){let h=c<<13,u=0;for(;!(h&8388608);)h<<=1,u-=8388608;h&=-8388609,u+=947912704,o[c]=h|u}for(let c=1024;c<2048;++c)o[c]=939524096+(c-1024<<13);for(let c=1;c<31;++c)a[c]=c<<23;a[31]=1199570944,a[32]=2147483648;for(let c=33;c<63;++c)a[c]=2147483648+(c-32<<23);a[63]=3347054592;for(let c=1;c<64;++c)c!==32&&(l[c]=1024);return{floatView:e,uint32View:i,baseTable:s,shiftTable:r,mantissaTable:o,exponentTable:a,offsetTable:l}}function Mo(n){Math.abs(n)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),n=Pn(n,-65504,65504),fh.floatView[0]=n;const e=fh.uint32View[0],i=e>>23&511;return fh.baseTable[i]+((e&8388607)>>fh.shiftTable[i])}function dv(n){const e=n>>10;return fh.uint32View[0]=fh.mantissaTable[fh.offsetTable[e]+(n&1023)]+fh.exponentTable[e],fh.floatView[0]}const Ip={toHalfFloat:Mo,fromHalfFloat:dv},$n=new E,nw=new Y;let qe=class{constructor(n,e,i=!1){if(Array.isArray(n))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=n,this.itemSize=e,this.count=n!==void 0?n.length/e:0,this.normalized=i,this.usage=rv,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=Hi,this.version=0}onUploadCallback(){}set needsUpdate(n){n===!0&&this.version++}get updateRange(){return Dz("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(n){return this.usage=n,this}addUpdateRange(n,e){this.updateRanges.push({start:n,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(n){return this.name=n.name,this.array=new n.array.constructor(n.array),this.itemSize=n.itemSize,this.count=n.count,this.normalized=n.normalized,this.usage=n.usage,this.gpuType=n.gpuType,this}copyAt(n,e,i){n*=this.itemSize,i*=e.itemSize;for(let s=0,r=this.itemSize;s<r;s++)this.array[n+s]=e.array[i+s];return this}copyArray(n){return this.array.set(n),this}applyMatrix3(n){if(this.itemSize===2)for(let e=0,i=this.count;e<i;e++)nw.fromBufferAttribute(this,e),nw.applyMatrix3(n),this.setXY(e,nw.x,nw.y);else if(this.itemSize===3)for(let e=0,i=this.count;e<i;e++)$n.fromBufferAttribute(this,e),$n.applyMatrix3(n),this.setXYZ(e,$n.x,$n.y,$n.z);return this}applyMatrix4(n){for(let e=0,i=this.count;e<i;e++)$n.fromBufferAttribute(this,e),$n.applyMatrix4(n),this.setXYZ(e,$n.x,$n.y,$n.z);return this}applyNormalMatrix(n){for(let e=0,i=this.count;e<i;e++)$n.fromBufferAttribute(this,e),$n.applyNormalMatrix(n),this.setXYZ(e,$n.x,$n.y,$n.z);return this}transformDirection(n){for(let e=0,i=this.count;e<i;e++)$n.fromBufferAttribute(this,e),$n.transformDirection(n),this.setXYZ(e,$n.x,$n.y,$n.z);return this}set(n,e=0){return this.array.set(n,e),this}getComponent(n,e){let i=this.array[n*this.itemSize+e];return this.normalized&&(i=Jr(i,this.array)),i}setComponent(n,e,i){return this.normalized&&(i=Kt(i,this.array)),this.array[n*this.itemSize+e]=i,this}getX(n){let e=this.array[n*this.itemSize];return this.normalized&&(e=Jr(e,this.array)),e}setX(n,e){return this.normalized&&(e=Kt(e,this.array)),this.array[n*this.itemSize]=e,this}getY(n){let e=this.array[n*this.itemSize+1];return this.normalized&&(e=Jr(e,this.array)),e}setY(n,e){return this.normalized&&(e=Kt(e,this.array)),this.array[n*this.itemSize+1]=e,this}getZ(n){let e=this.array[n*this.itemSize+2];return this.normalized&&(e=Jr(e,this.array)),e}setZ(n,e){return this.normalized&&(e=Kt(e,this.array)),this.array[n*this.itemSize+2]=e,this}getW(n){let e=this.array[n*this.itemSize+3];return this.normalized&&(e=Jr(e,this.array)),e}setW(n,e){return this.normalized&&(e=Kt(e,this.array)),this.array[n*this.itemSize+3]=e,this}setXY(n,e,i){return n*=this.itemSize,this.normalized&&(e=Kt(e,this.array),i=Kt(i,this.array)),this.array[n+0]=e,this.array[n+1]=i,this}setXYZ(n,e,i,s){return n*=this.itemSize,this.normalized&&(e=Kt(e,this.array),i=Kt(i,this.array),s=Kt(s,this.array)),this.array[n+0]=e,this.array[n+1]=i,this.array[n+2]=s,this}setXYZW(n,e,i,s,r){return n*=this.itemSize,this.normalized&&(e=Kt(e,this.array),i=Kt(i,this.array),s=Kt(s,this.array),r=Kt(r,this.array)),this.array[n+0]=e,this.array[n+1]=i,this.array[n+2]=s,this.array[n+3]=r,this}onUpload(n){return this.onUploadCallback=n,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const n={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(n.name=this.name),this.usage!==rv&&(n.usage=this.usage),n}};class X8 extends qe{constructor(e,i,s){super(new Int8Array(e),i,s)}}class W8 extends qe{constructor(e,i,s){super(new Uint8Array(e),i,s)}}class H8 extends qe{constructor(e,i,s){super(new Uint8ClampedArray(e),i,s)}}class j8 extends qe{constructor(e,i,s){super(new Int16Array(e),i,s)}}let sw=class extends qe{constructor(n,e,i){super(new Uint16Array(n),e,i)}};class Q8 extends qe{constructor(e,i,s){super(new Int32Array(e),i,s)}}let qR=class extends qe{constructor(n,e,i){super(new Uint32Array(n),e,i)}};class Z8 extends qe{constructor(e,i,s){super(new Uint16Array(e),i,s),this.isFloat16BufferAttribute=!0}getX(e){let i=dv(this.array[e*this.itemSize]);return this.normalized&&(i=Jr(i,this.array)),i}setX(e,i){return this.normalized&&(i=Kt(i,this.array)),this.array[e*this.itemSize]=Mo(i),this}getY(e){let i=dv(this.array[e*this.itemSize+1]);return this.normalized&&(i=Jr(i,this.array)),i}setY(e,i){return this.normalized&&(i=Kt(i,this.array)),this.array[e*this.itemSize+1]=Mo(i),this}getZ(e){let i=dv(this.array[e*this.itemSize+2]);return this.normalized&&(i=Jr(i,this.array)),i}setZ(e,i){return this.normalized&&(i=Kt(i,this.array)),this.array[e*this.itemSize+2]=Mo(i),this}getW(e){let i=dv(this.array[e*this.itemSize+3]);return this.normalized&&(i=Jr(i,this.array)),i}setW(e,i){return this.normalized&&(i=Kt(i,this.array)),this.array[e*this.itemSize+3]=Mo(i),this}setXY(e,i,s){return e*=this.itemSize,this.normalized&&(i=Kt(i,this.array),s=Kt(s,this.array)),this.array[e+0]=Mo(i),this.array[e+1]=Mo(s),this}setXYZ(e,i,s,r){return e*=this.itemSize,this.normalized&&(i=Kt(i,this.array),s=Kt(s,this.array),r=Kt(r,this.array)),this.array[e+0]=Mo(i),this.array[e+1]=Mo(s),this.array[e+2]=Mo(r),this}setXYZW(e,i,s,r,o){return e*=this.itemSize,this.normalized&&(i=Kt(i,this.array),s=Kt(s,this.array),r=Kt(r,this.array),o=Kt(o,this.array)),this.array[e+0]=Mo(i),this.array[e+1]=Mo(s),this.array[e+2]=Mo(r),this.array[e+3]=Mo(o),this}}let st=class extends qe{constructor(n,e,i){super(new Float32Array(n),e,i)}},Y8=0;const Ta=new he,$R=new ye,Hf=new E,Wo=new Wt,pv=new Wt,Is=new E;let dt=class j6 extends Rs{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Y8++}),this.uuid=Vo(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Pz(e)?qR:sw)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,i){return this.attributes[e]=i,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,i,s=0){this.groups.push({start:e,count:i,materialIndex:s})}clearGroups(){this.groups=[]}setDrawRange(e,i){this.drawRange.start=e,this.drawRange.count=i}applyMatrix4(e){const i=this.attributes.position;i!==void 0&&(i.applyMatrix4(e),i.needsUpdate=!0);const s=this.attributes.normal;if(s!==void 0){const o=new Gt().getNormalMatrix(e);s.applyNormalMatrix(o),s.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Ta.makeRotationFromQuaternion(e),this.applyMatrix4(Ta),this}rotateX(e){return Ta.makeRotationX(e),this.applyMatrix4(Ta),this}rotateY(e){return Ta.makeRotationY(e),this.applyMatrix4(Ta),this}rotateZ(e){return Ta.makeRotationZ(e),this.applyMatrix4(Ta),this}translate(e,i,s){return Ta.makeTranslation(e,i,s),this.applyMatrix4(Ta),this}scale(e,i,s){return Ta.makeScale(e,i,s),this.applyMatrix4(Ta),this}lookAt(e){return $R.lookAt(e),$R.updateMatrix(),this.applyMatrix4($R.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Hf).negate(),this.translate(Hf.x,Hf.y,Hf.z),this}setFromPoints(e){const i=[];for(let s=0,r=e.length;s<r;s++){const o=e[s];i.push(o.x,o.y,o.z||0)}return this.setAttribute("position",new st(i,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Wt);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new E(-1/0,-1/0,-1/0),new E(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),i)for(let s=0,r=i.length;s<r;s++){const o=i[s];Wo.setFromBufferAttribute(o),this.morphTargetsRelative?(Is.addVectors(this.boundingBox.min,Wo.min),this.boundingBox.expandByPoint(Is),Is.addVectors(this.boundingBox.max,Wo.max),this.boundingBox.expandByPoint(Is)):(this.boundingBox.expandByPoint(Wo.min),this.boundingBox.expandByPoint(Wo.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new tn);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new E,1/0);return}if(e){const s=this.boundingSphere.center;if(Wo.setFromBufferAttribute(e),i)for(let o=0,a=i.length;o<a;o++){const l=i[o];pv.setFromBufferAttribute(l),this.morphTargetsRelative?(Is.addVectors(Wo.min,pv.min),Wo.expandByPoint(Is),Is.addVectors(Wo.max,pv.max),Wo.expandByPoint(Is)):(Wo.expandByPoint(pv.min),Wo.expandByPoint(pv.max))}Wo.getCenter(s);let r=0;for(let o=0,a=e.count;o<a;o++)Is.fromBufferAttribute(e,o),r=Math.max(r,s.distanceToSquared(Is));if(i)for(let o=0,a=i.length;o<a;o++){const l=i[o],c=this.morphTargetsRelative;for(let h=0,u=l.count;h<u;h++)Is.fromBufferAttribute(l,h),c&&(Hf.fromBufferAttribute(e,h),Is.add(Hf)),r=Math.max(r,s.distanceToSquared(Is))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,i=this.attributes;if(e===null||i.position===void 0||i.normal===void 0||i.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const s=i.position,r=i.normal,o=i.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new qe(new Float32Array(4*s.count),4));const a=this.getAttribute("tangent"),l=[],c=[];for(let R=0;R<s.count;R++)l[R]=new E,c[R]=new E;const h=new E,u=new E,d=new E,m=new Y,f=new Y,g=new Y,y=new E,v=new E;function b(R,P,C){h.fromBufferAttribute(s,R),u.fromBufferAttribute(s,P),d.fromBufferAttribute(s,C),m.fromBufferAttribute(o,R),f.fromBufferAttribute(o,P),g.fromBufferAttribute(o,C),u.sub(h),d.sub(h),f.sub(m),g.sub(m);const L=1/(f.x*g.y-g.x*f.y);isFinite(L)&&(y.copy(u).multiplyScalar(g.y).addScaledVector(d,-f.y).multiplyScalar(L),v.copy(d).multiplyScalar(f.x).addScaledVector(u,-g.x).multiplyScalar(L),l[R].add(y),l[P].add(y),l[C].add(y),c[R].add(v),c[P].add(v),c[C].add(v))}let A=this.groups;A.length===0&&(A=[{start:0,count:e.count}]);for(let R=0,P=A.length;R<P;++R){const C=A[R],L=C.start,B=C.count;for(let z=L,D=L+B;z<D;z+=3)b(e.getX(z+0),e.getX(z+1),e.getX(z+2))}const x=new E,w=new E,_=new E,S=new E;function M(R){_.fromBufferAttribute(r,R),S.copy(_);const P=l[R];x.copy(P),x.sub(_.multiplyScalar(_.dot(P))).normalize(),w.crossVectors(S,P);const C=w.dot(c[R])<0?-1:1;a.setXYZW(R,x.x,x.y,x.z,C)}for(let R=0,P=A.length;R<P;++R){const C=A[R],L=C.start,B=C.count;for(let z=L,D=L+B;z<D;z+=3)M(e.getX(z+0)),M(e.getX(z+1)),M(e.getX(z+2))}}computeVertexNormals(){const e=this.index,i=this.getAttribute("position");if(i!==void 0){let s=this.getAttribute("normal");if(s===void 0)s=new qe(new Float32Array(i.count*3),3),this.setAttribute("normal",s);else for(let m=0,f=s.count;m<f;m++)s.setXYZ(m,0,0,0);const r=new E,o=new E,a=new E,l=new E,c=new E,h=new E,u=new E,d=new E;if(e)for(let m=0,f=e.count;m<f;m+=3){const g=e.getX(m+0),y=e.getX(m+1),v=e.getX(m+2);r.fromBufferAttribute(i,g),o.fromBufferAttribute(i,y),a.fromBufferAttribute(i,v),u.subVectors(a,o),d.subVectors(r,o),u.cross(d),l.fromBufferAttribute(s,g),c.fromBufferAttribute(s,y),h.fromBufferAttribute(s,v),l.add(u),c.add(u),h.add(u),s.setXYZ(g,l.x,l.y,l.z),s.setXYZ(y,c.x,c.y,c.z),s.setXYZ(v,h.x,h.y,h.z)}else for(let m=0,f=i.count;m<f;m+=3)r.fromBufferAttribute(i,m+0),o.fromBufferAttribute(i,m+1),a.fromBufferAttribute(i,m+2),u.subVectors(a,o),d.subVectors(r,o),u.cross(d),s.setXYZ(m+0,u.x,u.y,u.z),s.setXYZ(m+1,u.x,u.y,u.z),s.setXYZ(m+2,u.x,u.y,u.z);this.normalizeNormals(),s.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let i=0,s=e.count;i<s;i++)Is.fromBufferAttribute(e,i),Is.normalize(),e.setXYZ(i,Is.x,Is.y,Is.z)}toNonIndexed(){function e(l,c){const h=l.array,u=l.itemSize,d=l.normalized,m=new h.constructor(c.length*u);let f=0,g=0;for(let y=0,v=c.length;y<v;y++){l.isInterleavedBufferAttribute?f=c[y]*l.data.stride+l.offset:f=c[y]*u;for(let b=0;b<u;b++)m[g++]=h[f++]}return new qe(m,u,d)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const i=new j6,s=this.index.array,r=this.attributes;for(const l in r){const c=r[l],h=e(c,s);i.setAttribute(l,h)}const o=this.morphAttributes;for(const l in o){const c=[],h=o[l];for(let u=0,d=h.length;u<d;u++){const m=h[u],f=e(m,s);c.push(f)}i.morphAttributes[l]=c}i.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let l=0,c=a.length;l<c;l++){const h=a[l];i.addGroup(h.start,h.count,h.materialIndex)}return i}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const h in c)c[h]!==void 0&&(e[h]=c[h]);return e}e.data={attributes:{}};const i=this.index;i!==null&&(e.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});const s=this.attributes;for(const c in s){const h=s[c];e.data.attributes[c]=h.toJSON(e.data)}const r={};let o=!1;for(const c in this.morphAttributes){const h=this.morphAttributes[c],u=[];for(let d=0,m=h.length;d<m;d++){const f=h[d];u.push(f.toJSON(e.data))}u.length>0&&(r[c]=u,o=!0)}o&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const l=this.boundingSphere;return l!==null&&(e.data.boundingSphere={center:l.center.toArray(),radius:l.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const i={};this.name=e.name;const s=e.index;s!==null&&this.setIndex(s.clone(i));const r=e.attributes;for(const h in r){const u=r[h];this.setAttribute(h,u.clone(i))}const o=e.morphAttributes;for(const h in o){const u=[],d=o[h];for(let m=0,f=d.length;m<f;m++)u.push(d[m].clone(i));this.morphAttributes[h]=u}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let h=0,u=a.length;h<u;h++){const d=a[h];this.addGroup(d.start,d.count,d.materialIndex)}const l=e.boundingBox;l!==null&&(this.boundingBox=l.clone());const c=e.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}};const Zz=new he,Lp=new qr,rw=new tn,Yz=new E,jf=new E,Qf=new E,Zf=new E,e2=new E,ow=new E,aw=new Y,lw=new Y,cw=new Y,Kz=new E,Jz=new E,qz=new E,hw=new E,uw=new E;let pe=class extends ye{constructor(n=new dt,e=new Qt){super(),this.isMesh=!0,this.type="Mesh",this.geometry=n,this.material=e,this.updateMorphTargets()}copy(n,e){return super.copy(n,e),n.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=n.morphTargetInfluences.slice()),n.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},n.morphTargetDictionary)),this.material=Array.isArray(n.material)?n.material.slice():n.material,this.geometry=n.geometry,this}updateMorphTargets(){const n=this.geometry.morphAttributes,e=Object.keys(n);if(e.length>0){const i=n[e[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,r=i.length;s<r;s++){const o=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}getVertexPosition(n,e){const i=this.geometry,s=i.attributes.position,r=i.morphAttributes.position,o=i.morphTargetsRelative;e.fromBufferAttribute(s,n);const a=this.morphTargetInfluences;if(r&&a){ow.set(0,0,0);for(let l=0,c=r.length;l<c;l++){const h=a[l],u=r[l];h!==0&&(e2.fromBufferAttribute(u,n),o?ow.addScaledVector(e2,h):ow.addScaledVector(e2.sub(e),h))}e.add(ow)}return e}raycast(n,e){const i=this.geometry,s=this.material,r=this.matrixWorld;s!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),rw.copy(i.boundingSphere),rw.applyMatrix4(r),Lp.copy(n.ray).recast(n.near),!(rw.containsPoint(Lp.origin)===!1&&(Lp.intersectSphere(rw,Yz)===null||Lp.origin.distanceToSquared(Yz)>(n.far-n.near)**2))&&(Zz.copy(r).invert(),Lp.copy(n.ray).applyMatrix4(Zz),!(i.boundingBox!==null&&Lp.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(n,e,Lp)))}_computeIntersections(n,e,i){let s;const r=this.geometry,o=this.material,a=r.index,l=r.attributes.position,c=r.attributes.uv,h=r.attributes.uv1,u=r.attributes.normal,d=r.groups,m=r.drawRange;if(a!==null)if(Array.isArray(o))for(let f=0,g=d.length;f<g;f++){const y=d[f],v=o[y.materialIndex],b=Math.max(y.start,m.start),A=Math.min(a.count,Math.min(y.start+y.count,m.start+m.count));for(let x=b,w=A;x<w;x+=3){const _=a.getX(x),S=a.getX(x+1),M=a.getX(x+2);s=dw(this,v,n,i,c,h,u,_,S,M),s&&(s.faceIndex=Math.floor(x/3),s.face.materialIndex=y.materialIndex,e.push(s))}}else{const f=Math.max(0,m.start),g=Math.min(a.count,m.start+m.count);for(let y=f,v=g;y<v;y+=3){const b=a.getX(y),A=a.getX(y+1),x=a.getX(y+2);s=dw(this,o,n,i,c,h,u,b,A,x),s&&(s.faceIndex=Math.floor(y/3),e.push(s))}}else if(l!==void 0)if(Array.isArray(o))for(let f=0,g=d.length;f<g;f++){const y=d[f],v=o[y.materialIndex],b=Math.max(y.start,m.start),A=Math.min(l.count,Math.min(y.start+y.count,m.start+m.count));for(let x=b,w=A;x<w;x+=3){const _=x,S=x+1,M=x+2;s=dw(this,v,n,i,c,h,u,_,S,M),s&&(s.faceIndex=Math.floor(x/3),s.face.materialIndex=y.materialIndex,e.push(s))}}else{const f=Math.max(0,m.start),g=Math.min(l.count,m.start+m.count);for(let y=f,v=g;y<v;y+=3){const b=y,A=y+1,x=y+2;s=dw(this,o,n,i,c,h,u,b,A,x),s&&(s.faceIndex=Math.floor(y/3),e.push(s))}}}};function K8(n,e,i,s,r,o,a,l){let c;if(e.side===un?c=s.intersectTriangle(a,o,r,!0,l):c=s.intersectTriangle(r,o,a,e.side===Un,l),c===null)return null;uw.copy(l),uw.applyMatrix4(n.matrixWorld);const h=i.ray.origin.distanceTo(uw);return h<i.near||h>i.far?null:{distance:h,point:uw.clone(),object:n}}function dw(n,e,i,s,r,o,a,l,c,h){n.getVertexPosition(l,jf),n.getVertexPosition(c,Qf),n.getVertexPosition(h,Zf);const u=K8(n,e,i,s,jf,Qf,Zf,hw);if(u){r&&(aw.fromBufferAttribute(r,l),lw.fromBufferAttribute(r,c),cw.fromBufferAttribute(r,h),u.uv=Ks.getInterpolation(hw,jf,Qf,Zf,aw,lw,cw,new Y)),o&&(aw.fromBufferAttribute(o,l),lw.fromBufferAttribute(o,c),cw.fromBufferAttribute(o,h),u.uv1=Ks.getInterpolation(hw,jf,Qf,Zf,aw,lw,cw,new Y)),a&&(Kz.fromBufferAttribute(a,l),Jz.fromBufferAttribute(a,c),qz.fromBufferAttribute(a,h),u.normal=Ks.getInterpolation(hw,jf,Qf,Zf,Kz,Jz,qz,new E),u.normal.dot(s.direction)>0&&u.normal.multiplyScalar(-1));const d={a:l,b:c,c:h,normal:new E,materialIndex:0};Ks.getNormal(jf,Qf,Zf,d.normal),u.face=d}return u}class $i extends dt{constructor(e=1,i=1,s=1,r=1,o=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:i,depth:s,widthSegments:r,heightSegments:o,depthSegments:a};const l=this;r=Math.floor(r),o=Math.floor(o),a=Math.floor(a);const c=[],h=[],u=[],d=[];let m=0,f=0;g("z","y","x",-1,-1,s,i,e,a,o,0),g("z","y","x",1,-1,s,i,-e,a,o,1),g("x","z","y",1,1,e,s,i,r,a,2),g("x","z","y",1,-1,e,s,-i,r,a,3),g("x","y","z",1,-1,e,i,s,r,o,4),g("x","y","z",-1,-1,e,i,-s,r,o,5),this.setIndex(c),this.setAttribute("position",new st(h,3)),this.setAttribute("normal",new st(u,3)),this.setAttribute("uv",new st(d,2));function g(y,v,b,A,x,w,_,S,M,R,P){const C=w/M,L=_/R,B=w/2,z=_/2,D=S/2,W=M+1,O=R+1;let F=0,X=0;const J=new E;for(let q=0;q<O;q++){const oe=q*L-z;for(let _e=0;_e<W;_e++){const ke=_e*C-B;J[y]=ke*A,J[v]=oe*x,J[b]=D,h.push(J.x,J.y,J.z),J[y]=0,J[v]=0,J[b]=S>0?1:-1,u.push(J.x,J.y,J.z),d.push(_e/M),d.push(1-q/R),F+=1}}for(let q=0;q<R;q++)for(let oe=0;oe<M;oe++){const _e=m+oe+W*q,ke=m+oe+W*(q+1),re=m+(oe+1)+W*(q+1),we=m+(oe+1)+W*q;c.push(_e,ke,we),c.push(ke,re,we),X+=6}l.addGroup(f,X,P),f+=X,m+=F}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new $i(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Yf(n){const e={};for(const i in n){e[i]={};for(const s in n[i]){const r=n[i][s];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[i][s]=null):e[i][s]=r.clone():Array.isArray(r)?e[i][s]=r.slice():e[i][s]=r}}return e}function $r(n){const e={};for(let i=0;i<n.length;i++){const s=Yf(n[i]);for(const r in s)e[r]=s[r]}return e}function J8(n){const e=[];for(let i=0;i<n.length;i++)e.push(n[i].clone());return e}function $z(n){return n.getRenderTarget()===null?n.outputColorSpace:Ci.workingColorSpace}const Kf={clone:Yf,merge:$r};var q8=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,$8=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class kt extends Ft{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=q8,this.fragmentShader=$8,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1,clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Yf(e.uniforms),this.uniformsGroups=J8(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const i=super.toJSON(e);i.glslVersion=this.glslVersion,i.uniforms={};for(const r in this.uniforms){const o=this.uniforms[r].value;o&&o.isTexture?i.uniforms[r]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?i.uniforms[r]={type:"c",value:o.getHex()}:o&&o.isVector2?i.uniforms[r]={type:"v2",value:o.toArray()}:o&&o.isVector3?i.uniforms[r]={type:"v3",value:o.toArray()}:o&&o.isVector4?i.uniforms[r]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?i.uniforms[r]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?i.uniforms[r]={type:"m4",value:o.toArray()}:i.uniforms[r]={value:o}}Object.keys(this.defines).length>0&&(i.defines=this.defines),i.vertexShader=this.vertexShader,i.fragmentShader=this.fragmentShader,i.lights=this.lights,i.clipping=this.clipping;const s={};for(const r in this.extensions)this.extensions[r]===!0&&(s[r]=!0);return Object.keys(s).length>0&&(i.extensions=s),i}}let mv=class extends ye{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new he,this.projectionMatrix=new he,this.projectionMatrixInverse=new he,this.coordinateSystem=tc}copy(n,e){return super.copy(n,e),this.matrixWorldInverse.copy(n.matrixWorldInverse),this.projectionMatrix.copy(n.projectionMatrix),this.projectionMatrixInverse.copy(n.projectionMatrixInverse),this.coordinateSystem=n.coordinateSystem,this}getWorldDirection(n){return super.getWorldDirection(n).negate()}updateMatrixWorld(n){super.updateMatrixWorld(n),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(n,e){super.updateWorldMatrix(n,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}};const ku=new E,eF=new Y,tF=new Y;let Lt=class extends mv{constructor(n=50,e=1,i=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=n,this.zoom=1,this.near=i,this.far=s,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(n,e){return super.copy(n,e),this.fov=n.fov,this.zoom=n.zoom,this.near=n.near,this.far=n.far,this.focus=n.focus,this.aspect=n.aspect,this.view=n.view===null?null:Object.assign({},n.view),this.filmGauge=n.filmGauge,this.filmOffset=n.filmOffset,this}setFocalLength(n){const e=.5*this.getFilmHeight()/n;this.fov=kf*2*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const n=Math.tan(Ep*.5*this.fov);return .5*this.getFilmHeight()/n}getEffectiveFOV(){return kf*2*Math.atan(Math.tan(Ep*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(n,e,i){ku.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),e.set(ku.x,ku.y).multiplyScalar(-n/ku.z),ku.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(ku.x,ku.y).multiplyScalar(-n/ku.z)}getViewSize(n,e){return this.getViewBounds(n,eF,tF),e.subVectors(tF,eF)}setViewOffset(n,e,i,s,r,o){this.aspect=n/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=n,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const n=this.near;let e=n*Math.tan(Ep*.5*this.fov)/this.zoom,i=2*e,s=this.aspect*i,r=-.5*s;const o=this.view;if(this.view!==null&&this.view.enabled){const l=o.fullWidth,c=o.fullHeight;r+=o.offsetX*s/l,e-=o.offsetY*i/c,s*=o.width/l,i*=o.height/c}const a=this.filmOffset;a!==0&&(r+=n*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+s,e,e-i,n,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(n){const e=super.toJSON(n);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}};const Jf=-90,qf=1;class t2 extends ye{constructor(e,i,s){super(),this.type="CubeCamera",this.renderTarget=s,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new Lt(Jf,qf,e,i);r.layers=this.layers,this.add(r);const o=new Lt(Jf,qf,e,i);o.layers=this.layers,this.add(o);const a=new Lt(Jf,qf,e,i);a.layers=this.layers,this.add(a);const l=new Lt(Jf,qf,e,i);l.layers=this.layers,this.add(l);const c=new Lt(Jf,qf,e,i);c.layers=this.layers,this.add(c);const h=new Lt(Jf,qf,e,i);h.layers=this.layers,this.add(h)}updateCoordinateSystem(){const e=this.coordinateSystem,i=this.children.concat(),[s,r,o,a,l,c]=i;for(const h of i)this.remove(h);if(e===tc)s.up.set(0,1,0),s.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),o.up.set(0,0,-1),o.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),l.up.set(0,1,0),l.lookAt(0,0,1),c.up.set(0,1,0),c.lookAt(0,0,-1);else if(e===ov)s.up.set(0,-1,0),s.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),o.up.set(0,0,1),o.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),l.up.set(0,-1,0),l.lookAt(0,0,1),c.up.set(0,-1,0),c.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const h of i)this.add(h),h.updateMatrixWorld()}update(e,i){this.parent===null&&this.updateMatrixWorld();const{renderTarget:s,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[o,a,l,c,h,u]=this.children,d=e.getRenderTarget(),m=e.getActiveCubeFace(),f=e.getActiveMipmapLevel(),g=e.xr.enabled;e.xr.enabled=!1;const y=s.texture.generateMipmaps;s.texture.generateMipmaps=!1,e.setRenderTarget(s,0,r),e.render(i,o),e.setRenderTarget(s,1,r),e.render(i,a),e.setRenderTarget(s,2,r),e.render(i,l),e.setRenderTarget(s,3,r),e.render(i,c),e.setRenderTarget(s,4,r),e.render(i,h),s.texture.generateMipmaps=y,e.setRenderTarget(s,5,r),e.render(i,u),e.setRenderTarget(d,m,f),e.xr.enabled=g,s.texture.needsPMREMUpdate=!0}}class fv extends Vt{constructor(e,i,s,r,o,a,l,c,h,u){e=e!==void 0?e:[],i=i!==void 0?i:rh,super(e,i,s,r,o,a,l,c,h,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class i2 extends Zt{constructor(e=1,i={}){super(e,e,i),this.isWebGLCubeRenderTarget=!0;const s={width:e,height:e,depth:1},r=[s,s,s,s,s,s];this.texture=new fv(r,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:Ot}fromEquirectangularTexture(e,i){this.texture.type=i.type,this.texture.colorSpace=i.colorSpace,this.texture.generateMipmaps=i.generateMipmaps,this.texture.minFilter=i.minFilter,this.texture.magFilter=i.magFilter;const s={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new $i(5,5,5),o=new kt({name:"CubemapFromEquirect",uniforms:Yf(s.uniforms),vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,side:un,blending:dn});o.uniforms.tEquirect.value=i;const a=new pe(r,o),l=i.minFilter;return i.minFilter===So&&(i.minFilter=Ot),new t2(1,10,this).update(e,a),i.minFilter=l,a.geometry.dispose(),a.material.dispose(),this}clear(e,i,s,r){const o=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(i,s,r);e.setRenderTarget(o)}}const n2=new E,eJ=new E,tJ=new Gt;let fs=class{constructor(n=new E(1,0,0),e=0){this.isPlane=!0,this.normal=n,this.constant=e}set(n,e){return this.normal.copy(n),this.constant=e,this}setComponents(n,e,i,s){return this.normal.set(n,e,i),this.constant=s,this}setFromNormalAndCoplanarPoint(n,e){return this.normal.copy(n),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(n,e,i){const s=n2.subVectors(i,e).cross(eJ.subVectors(n,e)).normalize();return this.setFromNormalAndCoplanarPoint(s,n),this}copy(n){return this.normal.copy(n.normal),this.constant=n.constant,this}normalize(){const n=1/this.normal.length();return this.normal.multiplyScalar(n),this.constant*=n,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(n){return this.normal.dot(n)+this.constant}distanceToSphere(n){return this.distanceToPoint(n.center)-n.radius}projectPoint(n,e){return e.copy(n).addScaledVector(this.normal,-this.distanceToPoint(n))}intersectLine(n,e){const i=n.delta(n2),s=this.normal.dot(i);if(s===0)return this.distanceToPoint(n.start)===0?e.copy(n.start):null;const r=-(n.start.dot(this.normal)+this.constant)/s;return r<0||r>1?null:e.copy(n.start).addScaledVector(i,r)}intersectsLine(n){const e=this.distanceToPoint(n.start),i=this.distanceToPoint(n.end);return e<0&&i>0||i<0&&e>0}intersectsBox(n){return n.intersectsPlane(this)}intersectsSphere(n){return n.intersectsPlane(this)}coplanarPoint(n){return n.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(n,e){const i=e||tJ.getNormalMatrix(n),s=this.coplanarPoint(n2).applyMatrix4(n),r=this.normal.applyMatrix3(i).normalize();return this.constant=-s.dot(r),this}translate(n){return this.constant-=n.dot(this.normal),this}equals(n){return n.normal.equals(this.normal)&&n.constant===this.constant}clone(){return new this.constructor().copy(this)}};const Pp=new tn,pw=new E;let Bp=class{constructor(n=new fs,e=new fs,i=new fs,s=new fs,r=new fs,o=new fs){this.planes=[n,e,i,s,r,o]}set(n,e,i,s,r,o){const a=this.planes;return a[0].copy(n),a[1].copy(e),a[2].copy(i),a[3].copy(s),a[4].copy(r),a[5].copy(o),this}copy(n){const e=this.planes;for(let i=0;i<6;i++)e[i].copy(n.planes[i]);return this}setFromProjectionMatrix(n,e=tc){const i=this.planes,s=n.elements,r=s[0],o=s[1],a=s[2],l=s[3],c=s[4],h=s[5],u=s[6],d=s[7],m=s[8],f=s[9],g=s[10],y=s[11],v=s[12],b=s[13],A=s[14],x=s[15];if(i[0].setComponents(l-r,d-c,y-m,x-v).normalize(),i[1].setComponents(l+r,d+c,y+m,x+v).normalize(),i[2].setComponents(l+o,d+h,y+f,x+b).normalize(),i[3].setComponents(l-o,d-h,y-f,x-b).normalize(),i[4].setComponents(l-a,d-u,y-g,x-A).normalize(),e===tc)i[5].setComponents(l+a,d+u,y+g,x+A).normalize();else if(e===ov)i[5].setComponents(a,u,g,A).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);return this}intersectsObject(n){if(n.boundingSphere!==void 0)n.boundingSphere===null&&n.computeBoundingSphere(),Pp.copy(n.boundingSphere).applyMatrix4(n.matrixWorld);else{const e=n.geometry;e.boundingSphere===null&&e.computeBoundingSphere(),Pp.copy(e.boundingSphere).applyMatrix4(n.matrixWorld)}return this.intersectsSphere(Pp)}intersectsSprite(n){return Pp.center.set(0,0,0),Pp.radius=.7071067811865476,Pp.applyMatrix4(n.matrixWorld),this.intersectsSphere(Pp)}intersectsSphere(n){const e=this.planes,i=n.center,s=-n.radius;for(let r=0;r<6;r++)if(e[r].distanceToPoint(i)<s)return!1;return!0}intersectsBox(n){const e=this.planes;for(let i=0;i<6;i++){const s=e[i];if(pw.x=s.normal.x>0?n.max.x:n.min.x,pw.y=s.normal.y>0?n.max.y:n.min.y,pw.z=s.normal.z>0?n.max.z:n.min.z,s.distanceToPoint(pw)<0)return!1}return!0}containsPoint(n){const e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(n)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}};function iF(){let n=null,e=!1,i=null,s=null;function r(o,a){i(o,a),s=n.requestAnimationFrame(r)}return{start:function(){e!==!0&&i!==null&&(s=n.requestAnimationFrame(r),e=!0)},stop:function(){n.cancelAnimationFrame(s),e=!1},setAnimationLoop:function(o){i=o},setContext:function(o){n=o}}}function iJ(n,e){const i=e.isWebGL2,s=new WeakMap;function r(h,u){const d=h.array,m=h.usage,f=d.byteLength,g=n.createBuffer();n.bindBuffer(u,g),n.bufferData(u,d,m),h.onUploadCallback();let y;if(d instanceof Float32Array)y=n.FLOAT;else if(d instanceof Uint16Array)if(h.isFloat16BufferAttribute)if(i)y=n.HALF_FLOAT;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else y=n.UNSIGNED_SHORT;else if(d instanceof Int16Array)y=n.SHORT;else if(d instanceof Uint32Array)y=n.UNSIGNED_INT;else if(d instanceof Int32Array)y=n.INT;else if(d instanceof Int8Array)y=n.BYTE;else if(d instanceof Uint8Array)y=n.UNSIGNED_BYTE;else if(d instanceof Uint8ClampedArray)y=n.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+d);return{buffer:g,type:y,bytesPerElement:d.BYTES_PER_ELEMENT,version:h.version,size:f}}function o(h,u,d){const m=u.array,f=u._updateRange,g=u.updateRanges;if(n.bindBuffer(d,h),f.count===-1&&g.length===0&&n.bufferSubData(d,0,m),g.length!==0){for(let y=0,v=g.length;y<v;y++){const b=g[y];i?n.bufferSubData(d,b.start*m.BYTES_PER_ELEMENT,m,b.start,b.count):n.bufferSubData(d,b.start*m.BYTES_PER_ELEMENT,m.subarray(b.start,b.start+b.count))}u.clearUpdateRanges()}f.count!==-1&&(i?n.bufferSubData(d,f.offset*m.BYTES_PER_ELEMENT,m,f.offset,f.count):n.bufferSubData(d,f.offset*m.BYTES_PER_ELEMENT,m.subarray(f.offset,f.offset+f.count)),f.count=-1),u.onUploadCallback()}function a(h){return h.isInterleavedBufferAttribute&&(h=h.data),s.get(h)}function l(h){h.isInterleavedBufferAttribute&&(h=h.data);const u=s.get(h);u&&(n.deleteBuffer(u.buffer),s.delete(h))}function c(h,u){if(h.isGLBufferAttribute){const m=s.get(h);(!m||m.version<h.version)&&s.set(h,{buffer:h.buffer,type:h.type,bytesPerElement:h.elementSize,version:h.version});return}h.isInterleavedBufferAttribute&&(h=h.data);const d=s.get(h);if(d===void 0)s.set(h,r(h,u));else if(d.version<h.version){if(d.size!==h.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");o(d.buffer,h,u),d.version=h.version}}return{get:a,remove:l,update:c}}class ds extends dt{constructor(e=1,i=1,s=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:i,widthSegments:s,heightSegments:r};const o=e/2,a=i/2,l=Math.floor(s),c=Math.floor(r),h=l+1,u=c+1,d=e/l,m=i/c,f=[],g=[],y=[],v=[];for(let b=0;b<u;b++){const A=b*m-a;for(let x=0;x<h;x++){const w=x*d-o;g.push(w,-A,0),y.push(0,0,1),v.push(x/l),v.push(1-b/c)}}for(let b=0;b<c;b++)for(let A=0;A<l;A++){const x=A+h*b,w=A+h*(b+1),_=A+1+h*(b+1),S=A+1+h*b;f.push(x,w,S),f.push(w,_,S)}this.setIndex(f),this.setAttribute("position",new st(g,3)),this.setAttribute("normal",new st(y,3)),this.setAttribute("uv",new st(v,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ds(e.width,e.height,e.widthSegments,e.heightSegments)}}var nJ=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,sJ=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,rJ=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,oJ=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,aJ=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,lJ=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,cJ=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,hJ=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,uJ=`#ifdef USE_BATCHING
	attribute float batchId;
	uniform highp sampler2D batchingTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,dJ=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( batchId );
#endif`,pJ=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,mJ=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,fJ=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,gJ=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,yJ=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,vJ=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,bJ=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,AJ=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,xJ=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,wJ=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,_J=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,SJ=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,CJ=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,MJ=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,EJ=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,TJ=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,RJ=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,IJ=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,LJ=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,PJ=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,BJ="gl_FragColor = linearToOutputTexel( gl_FragColor );",kJ=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return sRGBTransferOETF( value );
}`,DJ=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,OJ=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,GJ=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,zJ=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,FJ=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,NJ=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,UJ=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,VJ=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,XJ=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,WJ=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,HJ=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,jJ=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,QJ=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,ZJ=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,YJ=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,KJ=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,JJ=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,qJ=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,$J=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,e7=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,t7=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,i7=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,n7=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,s7=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,r7=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,o7=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,a7=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,l7=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,c7=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,h7=`#ifdef USE_MAP
#ifdef USE_MIPMAP_BIAS
    vec4 sampledDiffuseColor = texture2D( map, vMapUv, mipmapBias );
#else
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
#endif
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,u7=`#ifdef USE_MAP
	uniform sampler2D map;
        
#ifdef USE_MIPMAP_BIAS
    uniform float mipmapBias;
#endif
#endif`,d7=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,p7=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,m7=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,f7=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,g7=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[MORPHTARGETS_COUNT];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,y7=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,v7=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,b7=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
	#endif
	#ifdef MORPHTARGETS_TEXTURE
		#ifndef USE_INSTANCING_MORPH
			uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		#endif
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,A7=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,x7=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,w7=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,_7=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,S7=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,C7=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,M7=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,E7=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,T7=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,R7=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,I7=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,L7=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,P7=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,B7=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,k7=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,D7=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,O7=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,G7=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,z7=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,F7=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,N7=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,U7=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,V7=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,X7=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,W7=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,H7=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,j7=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,Q7=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,Z7=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,Y7=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,K7=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	float startCompression = 0.8 - 0.04;
	float desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min(color.r, min(color.g, color.b));
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max(color.r, max(color.g, color.b));
	if (peak < startCompression) return color;
	float d = 1. - startCompression;
	float newPeak = 1. - d * d / (peak + d - startCompression);
	color *= newPeak / peak;
	float g = 1. - 1. / (desaturation * (peak - newPeak) + 1.);
	return mix(color, vec3(1, 1, 1), g);
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,J7=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,q7=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,$7=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,eq=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,tq=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,iq=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const nq=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,sq=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,rq=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,oq=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,aq=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,lq=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,cq=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,hq=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,uq=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,dq=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,pq=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,mq=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,fq=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,gq=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,yq=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,vq=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,bq=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Aq=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,xq=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,wq=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,_q=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,Sq=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,Cq=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Mq=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Eq=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,Tq=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Rq=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Iq=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Lq=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,Pq=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Bq=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,kq=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Dq=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Oq=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Mt={alphahash_fragment:nJ,alphahash_pars_fragment:sJ,alphamap_fragment:rJ,alphamap_pars_fragment:oJ,alphatest_fragment:aJ,alphatest_pars_fragment:lJ,aomap_fragment:cJ,aomap_pars_fragment:hJ,batching_pars_vertex:uJ,batching_vertex:dJ,begin_vertex:pJ,beginnormal_vertex:mJ,bsdfs:fJ,iridescence_fragment:gJ,bumpmap_pars_fragment:yJ,clipping_planes_fragment:vJ,clipping_planes_pars_fragment:bJ,clipping_planes_pars_vertex:AJ,clipping_planes_vertex:xJ,color_fragment:wJ,color_pars_fragment:_J,color_pars_vertex:SJ,color_vertex:CJ,common:MJ,cube_uv_reflection_fragment:EJ,defaultnormal_vertex:TJ,displacementmap_pars_vertex:RJ,displacementmap_vertex:IJ,emissivemap_fragment:LJ,emissivemap_pars_fragment:PJ,colorspace_fragment:BJ,colorspace_pars_fragment:kJ,envmap_fragment:DJ,envmap_common_pars_fragment:OJ,envmap_pars_fragment:GJ,envmap_pars_vertex:zJ,envmap_physical_pars_fragment:KJ,envmap_vertex:FJ,fog_vertex:NJ,fog_pars_vertex:UJ,fog_fragment:VJ,fog_pars_fragment:XJ,gradientmap_pars_fragment:WJ,lightmap_fragment:HJ,lightmap_pars_fragment:jJ,lights_lambert_fragment:QJ,lights_lambert_pars_fragment:ZJ,lights_pars_begin:YJ,lights_toon_fragment:JJ,lights_toon_pars_fragment:qJ,lights_phong_fragment:$J,lights_phong_pars_fragment:e7,lights_physical_fragment:t7,lights_physical_pars_fragment:i7,lights_fragment_begin:n7,lights_fragment_maps:s7,lights_fragment_end:r7,logdepthbuf_fragment:o7,logdepthbuf_pars_fragment:a7,logdepthbuf_pars_vertex:l7,logdepthbuf_vertex:c7,map_fragment:h7,map_pars_fragment:u7,map_particle_fragment:d7,map_particle_pars_fragment:p7,metalnessmap_fragment:m7,metalnessmap_pars_fragment:f7,morphinstance_vertex:g7,morphcolor_vertex:y7,morphnormal_vertex:v7,morphtarget_pars_vertex:b7,morphtarget_vertex:A7,normal_fragment_begin:x7,normal_fragment_maps:w7,normal_pars_fragment:_7,normal_pars_vertex:S7,normal_vertex:C7,normalmap_pars_fragment:M7,clearcoat_normal_fragment_begin:E7,clearcoat_normal_fragment_maps:T7,clearcoat_pars_fragment:R7,iridescence_pars_fragment:I7,opaque_fragment:L7,packing:P7,premultiplied_alpha_fragment:B7,project_vertex:k7,dithering_fragment:D7,dithering_pars_fragment:O7,roughnessmap_fragment:G7,roughnessmap_pars_fragment:z7,shadowmap_pars_fragment:F7,shadowmap_pars_vertex:N7,shadowmap_vertex:U7,shadowmask_pars_fragment:V7,skinbase_vertex:X7,skinning_pars_vertex:W7,skinning_vertex:H7,skinnormal_vertex:j7,specularmap_fragment:Q7,specularmap_pars_fragment:Z7,tonemapping_fragment:Y7,tonemapping_pars_fragment:K7,transmission_fragment:J7,transmission_pars_fragment:q7,uv_pars_fragment:$7,uv_pars_vertex:eq,uv_vertex:tq,worldpos_vertex:iq,background_vert:nq,background_frag:sq,backgroundCube_vert:rq,backgroundCube_frag:oq,cube_vert:aq,cube_frag:lq,depth_vert:cq,depth_frag:hq,distanceRGBA_vert:uq,distanceRGBA_frag:dq,equirect_vert:pq,equirect_frag:mq,linedashed_vert:fq,linedashed_frag:gq,meshbasic_vert:yq,meshbasic_frag:vq,meshlambert_vert:bq,meshlambert_frag:Aq,meshmatcap_vert:xq,meshmatcap_frag:wq,meshnormal_vert:_q,meshnormal_frag:Sq,meshphong_vert:Cq,meshphong_frag:Mq,meshphysical_vert:Eq,meshphysical_frag:Tq,meshtoon_vert:Rq,meshtoon_frag:Iq,points_vert:Lq,points_frag:Pq,shadow_vert:Bq,shadow_frag:kq,sprite_vert:Dq,sprite_frag:Oq},Ve={common:{diffuse:{value:new Ae(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Gt},alphaMap:{value:null},alphaMapTransform:{value:new Gt},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Gt}},envmap:{envMap:{value:null},envMapRotation:{value:new Gt},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Gt}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Gt}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Gt},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Gt},normalScale:{value:new Y(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Gt},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Gt}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Gt}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Gt}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ae(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ae(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Gt},alphaTest:{value:0},uvTransform:{value:new Gt}},sprite:{diffuse:{value:new Ae(16777215)},opacity:{value:1},center:{value:new Y(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Gt},alphaMap:{value:null},alphaMapTransform:{value:new Gt},alphaTest:{value:0}}},Js={basic:{uniforms:$r([Ve.common,Ve.specularmap,Ve.envmap,Ve.aomap,Ve.lightmap,Ve.fog]),vertexShader:Mt.meshbasic_vert,fragmentShader:Mt.meshbasic_frag},lambert:{uniforms:$r([Ve.common,Ve.specularmap,Ve.envmap,Ve.aomap,Ve.lightmap,Ve.emissivemap,Ve.bumpmap,Ve.normalmap,Ve.displacementmap,Ve.fog,Ve.lights,{emissive:{value:new Ae(0)}}]),vertexShader:Mt.meshlambert_vert,fragmentShader:Mt.meshlambert_frag},phong:{uniforms:$r([Ve.common,Ve.specularmap,Ve.envmap,Ve.aomap,Ve.lightmap,Ve.emissivemap,Ve.bumpmap,Ve.normalmap,Ve.displacementmap,Ve.fog,Ve.lights,{emissive:{value:new Ae(0)},specular:{value:new Ae(1118481)},shininess:{value:30}}]),vertexShader:Mt.meshphong_vert,fragmentShader:Mt.meshphong_frag},standard:{uniforms:$r([Ve.common,Ve.envmap,Ve.aomap,Ve.lightmap,Ve.emissivemap,Ve.bumpmap,Ve.normalmap,Ve.displacementmap,Ve.roughnessmap,Ve.metalnessmap,Ve.fog,Ve.lights,{emissive:{value:new Ae(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Mt.meshphysical_vert,fragmentShader:Mt.meshphysical_frag},toon:{uniforms:$r([Ve.common,Ve.aomap,Ve.lightmap,Ve.emissivemap,Ve.bumpmap,Ve.normalmap,Ve.displacementmap,Ve.gradientmap,Ve.fog,Ve.lights,{emissive:{value:new Ae(0)}}]),vertexShader:Mt.meshtoon_vert,fragmentShader:Mt.meshtoon_frag},matcap:{uniforms:$r([Ve.common,Ve.bumpmap,Ve.normalmap,Ve.displacementmap,Ve.fog,{matcap:{value:null}}]),vertexShader:Mt.meshmatcap_vert,fragmentShader:Mt.meshmatcap_frag},points:{uniforms:$r([Ve.points,Ve.fog]),vertexShader:Mt.points_vert,fragmentShader:Mt.points_frag},dashed:{uniforms:$r([Ve.common,Ve.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Mt.linedashed_vert,fragmentShader:Mt.linedashed_frag},depth:{uniforms:$r([Ve.common,Ve.displacementmap]),vertexShader:Mt.depth_vert,fragmentShader:Mt.depth_frag},normal:{uniforms:$r([Ve.common,Ve.bumpmap,Ve.normalmap,Ve.displacementmap,{opacity:{value:1}}]),vertexShader:Mt.meshnormal_vert,fragmentShader:Mt.meshnormal_frag},sprite:{uniforms:$r([Ve.sprite,Ve.fog]),vertexShader:Mt.sprite_vert,fragmentShader:Mt.sprite_frag},background:{uniforms:{uvTransform:{value:new Gt},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Mt.background_vert,fragmentShader:Mt.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Gt}},vertexShader:Mt.backgroundCube_vert,fragmentShader:Mt.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Mt.cube_vert,fragmentShader:Mt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Mt.equirect_vert,fragmentShader:Mt.equirect_frag},distanceRGBA:{uniforms:$r([Ve.common,Ve.displacementmap,{referencePosition:{value:new E},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Mt.distanceRGBA_vert,fragmentShader:Mt.distanceRGBA_frag},shadow:{uniforms:$r([Ve.lights,Ve.fog,{color:{value:new Ae(0)},opacity:{value:1}}]),vertexShader:Mt.shadow_vert,fragmentShader:Mt.shadow_frag}};Js.physical={uniforms:$r([Js.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Gt},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Gt},clearcoatNormalScale:{value:new Y(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Gt},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Gt},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Gt},sheen:{value:0},sheenColor:{value:new Ae(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Gt},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Gt},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Gt},transmissionSamplerSize:{value:new Y},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Gt},attenuationDistance:{value:0},attenuationColor:{value:new Ae(0)},specularColor:{value:new Ae(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Gt},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Gt},anisotropyVector:{value:new Y},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Gt}}]),vertexShader:Mt.meshphysical_vert,fragmentShader:Mt.meshphysical_frag};const mw={r:0,b:0,g:0},kp=new si,Gq=new he;function zq(n,e,i,s,r,o,a){const l=new Ae(0);let c=o===!0?0:1,h,u,d=null,m=0,f=null;function g(v,b){let A=!1,x=b.isScene===!0?b.background:null;x&&x.isTexture&&(x=(b.backgroundBlurriness>0?i:e).get(x)),x===null?y(l,c):x&&x.isColor&&(y(x,1),A=!0);const w=n.xr.getEnvironmentBlendMode();w==="additive"?s.buffers.color.setClear(0,0,0,1,a):w==="alpha-blend"&&s.buffers.color.setClear(0,0,0,0,a),(n.autoClear||A)&&n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil),x&&(x.isCubeTexture||x.mapping===Lf)?(u===void 0&&(u=new pe(new $i(1,1,1),new kt({name:"BackgroundCubeMaterial",uniforms:Yf(Js.backgroundCube.uniforms),vertexShader:Js.backgroundCube.vertexShader,fragmentShader:Js.backgroundCube.fragmentShader,side:un,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(_,S,M){this.matrixWorld.copyPosition(M.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(u)),kp.copy(b.backgroundRotation),kp.x*=-1,kp.y*=-1,kp.z*=-1,x.isCubeTexture&&x.isRenderTargetTexture===!1&&(kp.y*=-1,kp.z*=-1),u.material.uniforms.envMap.value=x,u.material.uniforms.flipEnvMap.value=x.isCubeTexture&&x.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=b.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=b.backgroundIntensity,u.material.uniforms.backgroundRotation.value.setFromMatrix4(Gq.makeRotationFromEuler(kp)),u.material.toneMapped=Ci.getTransfer(x.colorSpace)!==ji,(d!==x||m!==x.version||f!==n.toneMapping)&&(u.material.needsUpdate=!0,d=x,m=x.version,f=n.toneMapping),u.layers.enableAll(),v.unshift(u,u.geometry,u.material,0,0,null)):x&&x.isTexture&&(h===void 0&&(h=new pe(new ds(2,2),new kt({name:"BackgroundMaterial",uniforms:Yf(Js.background.uniforms),vertexShader:Js.background.vertexShader,fragmentShader:Js.background.fragmentShader,side:Un,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),Object.defineProperty(h.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(h)),h.material.uniforms.t2D.value=x,h.material.uniforms.backgroundIntensity.value=b.backgroundIntensity,h.material.toneMapped=Ci.getTransfer(x.colorSpace)!==ji,x.matrixAutoUpdate===!0&&x.updateMatrix(),h.material.uniforms.uvTransform.value.copy(x.matrix),(d!==x||m!==x.version||f!==n.toneMapping)&&(h.material.needsUpdate=!0,d=x,m=x.version,f=n.toneMapping),h.layers.enableAll(),v.unshift(h,h.geometry,h.material,0,0,null))}function y(v,b){v.getRGB(mw,$z(n)),s.buffers.color.setClear(mw.r,mw.g,mw.b,b,a)}return{getClearColor:function(){return l},setClearColor:function(v,b=1){l.set(v),c=b,y(l,c)},getClearAlpha:function(){return c},setClearAlpha:function(v){c=v,y(l,c)},render:g}}function Fq(n,e,i,s){const r=n.getParameter(n.MAX_VERTEX_ATTRIBS),o=s.isWebGL2?null:e.get("OES_vertex_array_object"),a=s.isWebGL2||o!==null,l={},c=v(null);let h=c,u=!1;function d(D,W,O,F,X){let J=!1;if(a){const q=y(F,O,W);h!==q&&(h=q,f(h.object)),J=b(D,F,O,X),J&&A(D,F,O,X)}else{const q=W.wireframe===!0;(h.geometry!==F.id||h.program!==O.id||h.wireframe!==q)&&(h.geometry=F.id,h.program=O.id,h.wireframe=q,J=!0)}X!==null&&i.update(X,n.ELEMENT_ARRAY_BUFFER),(J||u)&&(u=!1,R(D,W,O,F),X!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,i.get(X).buffer))}function m(){return s.isWebGL2?n.createVertexArray():o.createVertexArrayOES()}function f(D){return s.isWebGL2?n.bindVertexArray(D):o.bindVertexArrayOES(D)}function g(D){return s.isWebGL2?n.deleteVertexArray(D):o.deleteVertexArrayOES(D)}function y(D,W,O){const F=O.wireframe===!0;let X=l[D.id];X===void 0&&(X={},l[D.id]=X);let J=X[W.id];J===void 0&&(J={},X[W.id]=J);let q=J[F];return q===void 0&&(q=v(m()),J[F]=q),q}function v(D){const W=[],O=[],F=[];for(let X=0;X<r;X++)W[X]=0,O[X]=0,F[X]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:W,enabledAttributes:O,attributeDivisors:F,object:D,attributes:{},index:null}}function b(D,W,O,F){const X=h.attributes,J=W.attributes;let q=0;const oe=O.getAttributes();for(const _e in oe)if(oe[_e].location>=0){const ke=X[_e];let re=J[_e];if(re===void 0&&(_e==="instanceMatrix"&&D.instanceMatrix&&(re=D.instanceMatrix),_e==="instanceColor"&&D.instanceColor&&(re=D.instanceColor)),ke===void 0||ke.attribute!==re||re&&ke.data!==re.data)return!0;q++}return h.attributesNum!==q||h.index!==F}function A(D,W,O,F){const X={},J=W.attributes;let q=0;const oe=O.getAttributes();for(const _e in oe)if(oe[_e].location>=0){let ke=J[_e];ke===void 0&&(_e==="instanceMatrix"&&D.instanceMatrix&&(ke=D.instanceMatrix),_e==="instanceColor"&&D.instanceColor&&(ke=D.instanceColor));const re={};re.attribute=ke,ke&&ke.data&&(re.data=ke.data),X[_e]=re,q++}h.attributes=X,h.attributesNum=q,h.index=F}function x(){const D=h.newAttributes;for(let W=0,O=D.length;W<O;W++)D[W]=0}function w(D){_(D,0)}function _(D,W){const O=h.newAttributes,F=h.enabledAttributes,X=h.attributeDivisors;O[D]=1,F[D]===0&&(n.enableVertexAttribArray(D),F[D]=1),X[D]!==W&&((s.isWebGL2?n:e.get("ANGLE_instanced_arrays"))[s.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](D,W),X[D]=W)}function S(){const D=h.newAttributes,W=h.enabledAttributes;for(let O=0,F=W.length;O<F;O++)W[O]!==D[O]&&(n.disableVertexAttribArray(O),W[O]=0)}function M(D,W,O,F,X,J,q){q===!0?n.vertexAttribIPointer(D,W,O,X,J):n.vertexAttribPointer(D,W,O,F,X,J)}function R(D,W,O,F){if(s.isWebGL2===!1&&(D.isInstancedMesh||F.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;x();const X=F.attributes,J=O.getAttributes(),q=W.defaultAttributeValues;for(const oe in J){const _e=J[oe];if(_e.location>=0){let ke=X[oe];if(ke===void 0&&(oe==="instanceMatrix"&&D.instanceMatrix&&(ke=D.instanceMatrix),oe==="instanceColor"&&D.instanceColor&&(ke=D.instanceColor)),ke!==void 0){const re=ke.normalized,we=ke.itemSize,Me=i.get(ke);if(Me===void 0)continue;const it=Me.buffer,je=Me.type,Ge=Me.bytesPerElement,rt=s.isWebGL2===!0&&(je===n.INT||je===n.UNSIGNED_INT||ke.gpuType===_p);if(ke.isInterleavedBufferAttribute){const ge=ke.data,Q=ge.stride,Ne=ke.offset;if(ge.isInstancedInterleavedBuffer){for(let Re=0;Re<_e.locationSize;Re++)_(_e.location+Re,ge.meshPerAttribute);D.isInstancedMesh!==!0&&F._maxInstanceCount===void 0&&(F._maxInstanceCount=ge.meshPerAttribute*ge.count)}else for(let Re=0;Re<_e.locationSize;Re++)w(_e.location+Re);n.bindBuffer(n.ARRAY_BUFFER,it);for(let Re=0;Re<_e.locationSize;Re++)M(_e.location+Re,we/_e.locationSize,je,re,Q*Ge,(Ne+we/_e.locationSize*Re)*Ge,rt)}else{if(ke.isInstancedBufferAttribute){for(let ge=0;ge<_e.locationSize;ge++)_(_e.location+ge,ke.meshPerAttribute);D.isInstancedMesh!==!0&&F._maxInstanceCount===void 0&&(F._maxInstanceCount=ke.meshPerAttribute*ke.count)}else for(let ge=0;ge<_e.locationSize;ge++)w(_e.location+ge);n.bindBuffer(n.ARRAY_BUFFER,it);for(let ge=0;ge<_e.locationSize;ge++)M(_e.location+ge,we/_e.locationSize,je,re,we*Ge,we/_e.locationSize*ge*Ge,rt)}}else if(q!==void 0){const re=q[oe];if(re!==void 0)switch(re.length){case 2:n.vertexAttrib2fv(_e.location,re);break;case 3:n.vertexAttrib3fv(_e.location,re);break;case 4:n.vertexAttrib4fv(_e.location,re);break;default:n.vertexAttrib1fv(_e.location,re)}}}}S()}function P(){B();for(const D in l){const W=l[D];for(const O in W){const F=W[O];for(const X in F)g(F[X].object),delete F[X];delete W[O]}delete l[D]}}function C(D){if(l[D.id]===void 0)return;const W=l[D.id];for(const O in W){const F=W[O];for(const X in F)g(F[X].object),delete F[X];delete W[O]}delete l[D.id]}function L(D){for(const W in l){const O=l[W];if(O[D.id]===void 0)continue;const F=O[D.id];for(const X in F)g(F[X].object),delete F[X];delete O[D.id]}}function B(){z(),u=!0,h!==c&&(h=c,f(h.object))}function z(){c.geometry=null,c.program=null,c.wireframe=!1}return{setup:d,reset:B,resetDefaultState:z,dispose:P,releaseStatesOfGeometry:C,releaseStatesOfProgram:L,initAttributes:x,enableAttribute:w,disableUnusedAttributes:S}}function Nq(n,e,i,s){const r=s.isWebGL2;let o;function a(u){o=u}function l(u,d){n.drawArrays(o,u,d),i.update(d,o,1)}function c(u,d,m){if(m===0)return;let f,g;if(r)f=n,g="drawArraysInstanced";else if(f=e.get("ANGLE_instanced_arrays"),g="drawArraysInstancedANGLE",f===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}f[g](o,u,d,m),i.update(d,o,m)}function h(u,d,m){if(m===0)return;const f=e.get("WEBGL_multi_draw");if(f===null)for(let g=0;g<m;g++)this.render(u[g],d[g]);else{f.multiDrawArraysWEBGL(o,u,0,d,0,m);let g=0;for(let y=0;y<m;y++)g+=d[y];i.update(g,o,1)}}this.setMode=a,this.render=l,this.renderInstances=c,this.renderMultiDraw=h}function Uq(n,e,i){let s;function r(){if(s!==void 0)return s;if(e.has("EXT_texture_filter_anisotropic")===!0){const M=e.get("EXT_texture_filter_anisotropic");s=n.getParameter(M.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else s=0;return s}function o(M){if(M==="highp"){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";M="mediump"}return M==="mediump"&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const a=typeof WebGL2RenderingContext<"u"&&n.constructor.name==="WebGL2RenderingContext";let l=i.precision!==void 0?i.precision:"highp";const c=o(l);c!==l&&(console.warn("THREE.WebGLRenderer:",l,"not supported, using",c,"instead."),l=c);const h=a||e.has("WEBGL_draw_buffers"),u=i.logarithmicDepthBuffer===!0,d=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),m=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),f=n.getParameter(n.MAX_TEXTURE_SIZE),g=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),y=n.getParameter(n.MAX_VERTEX_ATTRIBS),v=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),b=n.getParameter(n.MAX_VARYING_VECTORS),A=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),x=m>0,w=a||e.has("OES_texture_float"),_=x&&w,S=a?n.getParameter(n.MAX_SAMPLES):0;return{isWebGL2:a,drawBuffers:h,getMaxAnisotropy:r,getMaxPrecision:o,precision:l,logarithmicDepthBuffer:u,maxTextures:d,maxVertexTextures:m,maxTextureSize:f,maxCubemapSize:g,maxAttributes:y,maxVertexUniforms:v,maxVaryings:b,maxFragmentUniforms:A,vertexTextures:x,floatFragmentTextures:w,floatVertexTextures:_,maxSamples:S}}function Vq(n){const e=this;let i=null,s=0,r=!1,o=!1;const a=new fs,l=new Gt,c={value:null,needsUpdate:!1};this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(d,m){const f=d.length!==0||m||s!==0||r;return r=m,s=d.length,f},this.beginShadows=function(){o=!0,u(null)},this.endShadows=function(){o=!1},this.setGlobalState=function(d,m){i=u(d,m,0)},this.setState=function(d,m,f){const g=d.clippingPlanes,y=d.clipIntersection,v=d.clipShadows,b=n.get(d);if(!r||g===null||g.length===0||o&&!v)o?u(null):h();else{const A=o?0:s,x=A*4;let w=b.clippingState||null;c.value=w,w=u(g,m,x,f);for(let _=0;_!==x;++_)w[_]=i[_];b.clippingState=w,this.numIntersection=y?this.numPlanes:0,this.numPlanes+=A}};function h(){c.value!==i&&(c.value=i,c.needsUpdate=s>0),e.numPlanes=s,e.numIntersection=0}function u(d,m,f,g){const y=d!==null?d.length:0;let v=null;if(y!==0){if(v=c.value,g!==!0||v===null){const b=f+y*4,A=m.matrixWorldInverse;l.getNormalMatrix(A),(v===null||v.length<b)&&(v=new Float32Array(b));for(let x=0,w=f;x!==y;++x,w+=4)a.copy(d[x]).applyMatrix4(A,l),a.normal.toArray(v,w),v[w+3]=a.constant}c.value=v,c.needsUpdate=!0}return e.numPlanes=y,e.numIntersection=0,v}}function Xq(n){let e=new WeakMap;function i(a,l){return l===Kr?a.mapping=rh:l===If&&(a.mapping=_u),a}function s(a){if(a&&a.isTexture){const l=a.mapping;if(l===Kr||l===If)if(e.has(a)){const c=e.get(a).texture;return i(c,a.mapping)}else{const c=a.image;if(c&&c.height>0){const h=new i2(c.height);return h.fromEquirectangularTexture(n,a),e.set(a,h),a.addEventListener("dispose",r),i(h.texture,a.mapping)}else return null}}return a}function r(a){const l=a.target;l.removeEventListener("dispose",r);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function o(){e=new WeakMap}return{get:s,dispose:o}}let ic=class extends mv{constructor(n=-1,e=1,i=1,s=-1,r=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=n,this.right=e,this.top=i,this.bottom=s,this.near=r,this.far=o,this.updateProjectionMatrix()}copy(n,e){return super.copy(n,e),this.left=n.left,this.right=n.right,this.top=n.top,this.bottom=n.bottom,this.near=n.near,this.far=n.far,this.zoom=n.zoom,this.view=n.view===null?null:Object.assign({},n.view),this}setViewOffset(n,e,i,s,r,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=n,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const n=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let r=i-n,o=i+n,a=s+e,l=s-e;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=c*this.view.offsetX,o=r+c*this.view.width,a-=h*this.view.offsetY,l=a-h*this.view.height}this.projectionMatrix.makeOrthographic(r,o,a,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(n){const e=super.toJSON(n);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,this.view!==null&&(e.object.view=Object.assign({},this.view)),e}};const $f=4,nF=[.125,.215,.35,.446,.526,.582],Dp=20,s2=new ic,sF=new Ae;let r2=null,o2=0,a2=0,l2=!1;const Op=(1+Math.sqrt(5))/2,eg=1/Op,rF=[new E(1,1,1),new E(-1,1,1),new E(1,1,-1),new E(-1,1,-1),new E(0,Op,eg),new E(0,Op,-eg),new E(eg,0,Op),new E(-eg,0,Op),new E(Op,eg,0),new E(-Op,eg,0)];class c2{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,i=0,s=.1,r=100){r2=this._renderer.getRenderTarget(),o2=this._renderer.getActiveCubeFace(),a2=this._renderer.getActiveMipmapLevel(),l2=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const o=this._allocateTargets();return o.depthBuffer=!0,this._sceneToCubeUV(e,s,r,o),i>0&&this._blur(o,0,0,i),this._applyPMREM(o),this._cleanup(o),o}fromEquirectangular(e,i=null){return this._fromTexture(e,i)}fromCubemap(e,i=null){return this._fromTexture(e,i)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=cF(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=lF(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(r2,o2,a2),this._renderer.xr.enabled=l2,e.scissorTest=!1,fw(e,0,0,e.width,e.height)}_fromTexture(e,i){e.mapping===rh||e.mapping===_u?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),r2=this._renderer.getRenderTarget(),o2=this._renderer.getActiveCubeFace(),a2=this._renderer.getActiveMipmapLevel(),l2=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const s=i||this._allocateTargets();return this._textureToCubeUV(e,s),this._applyPMREM(s),this._cleanup(s),s}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),i=4*this._cubeSize,s={magFilter:Ot,minFilter:Ot,generateMipmaps:!1,type:ms,format:_i,colorSpace:Bi,depthBuffer:!1},r=aF(e,i,s),{_lodMax:o}=this;if({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=oF(o),this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==i){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=aF(e,i,s);const{_lodMax:a}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=oF(a)),this._blurMaterial=Wq(a,e,i)}return r}_compileMaterial(e){const i=new pe(this._lodPlanes[0],e);this._renderer.compile(i,s2)}_sceneToCubeUV(e,i,s,r){const o=new Lt(90,1,i,s),a=[1,-1,1,1,1,1],l=[1,1,1,-1,-1,-1],c=this._renderer,h=c.autoClear,u=c.toneMapping;c.getClearColor(sF),c.toneMapping=Yr,c.autoClear=!1;const d=new Qt({name:"PMREM.Background",side:un,depthWrite:!1,depthTest:!1}),m=new pe(new $i,d);let f=!1;const g=e.background;g?g.isColor&&(d.color.copy(g),e.background=null,f=!0):(d.color.copy(sF),f=!0);for(let y=0;y<6;y++){const v=y%3;v===0?(o.up.set(0,a[y],0),o.lookAt(l[y],0,0)):v===1?(o.up.set(0,0,a[y]),o.lookAt(0,l[y],0)):(o.up.set(0,a[y],0),o.lookAt(0,0,l[y]));const b=this._cubeSize;fw(r,v*b,y>2?b:0,b,b),c.setRenderTarget(r),f&&c.render(m,o),c.render(e,o)}m.geometry.dispose(),m.material.dispose(),c.toneMapping=u,c.autoClear=h,e.background=g}_textureToCubeUV(e,i){const s=this._renderer,r=e.mapping===rh||e.mapping===_u;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=cF()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=lF());const o=r?this._cubemapMaterial:this._equirectMaterial,a=new pe(this._lodPlanes[0],o),l=o.uniforms;l.envMap.value=e;const c=this._cubeSize;fw(i,0,0,3*c,2*c),s.setRenderTarget(i),s.render(a,s2)}_applyPMREM(e){const i=this._renderer,s=i.autoClear;i.autoClear=!1;for(let r=1;r<this._lodPlanes.length;r++){const o=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),a=rF[(r-1)%rF.length];this._blur(e,r-1,r,o,a)}i.autoClear=s}_blur(e,i,s,r,o){const a=this._pingPongRenderTarget;this._halfBlur(e,a,i,s,r,"latitudinal",o),this._halfBlur(a,e,s,s,r,"longitudinal",o)}_halfBlur(e,i,s,r,o,a,l){const c=this._renderer,h=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,d=new pe(this._lodPlanes[r],h),m=h.uniforms,f=this._sizeLods[s]-1,g=isFinite(o)?Math.PI/(2*f):2*Math.PI/(2*Dp-1),y=o/g,v=isFinite(o)?1+Math.floor(u*y):Dp;v>Dp&&console.warn(`sigmaRadians, ${o}, is too large and will clip, as it requested ${v} samples when the maximum is set to ${Dp}`);const b=[];let A=0;for(let M=0;M<Dp;++M){const R=M/y,P=Math.exp(-R*R/2);b.push(P),M===0?A+=P:M<v&&(A+=2*P)}for(let M=0;M<b.length;M++)b[M]=b[M]/A;m.envMap.value=e.texture,m.samples.value=v,m.weights.value=b,m.latitudinal.value=a==="latitudinal",l&&(m.poleAxis.value=l);const{_lodMax:x}=this;m.dTheta.value=g,m.mipInt.value=x-s;const w=this._sizeLods[r],_=3*w*(r>x-$f?r-x+$f:0),S=4*(this._cubeSize-w);fw(i,_,S,3*w,2*w),c.setRenderTarget(i),c.render(d,s2)}}function oF(n){const e=[],i=[],s=[];let r=n;const o=n-$f+1+nF.length;for(let a=0;a<o;a++){const l=Math.pow(2,r);i.push(l);let c=1/l;a>n-$f?c=nF[a-n+$f-1]:a===0&&(c=0),s.push(c);const h=1/(l-2),u=-h,d=1+h,m=[u,u,d,u,d,d,u,u,d,d,u,d],f=6,g=6,y=3,v=2,b=1,A=new Float32Array(y*g*f),x=new Float32Array(v*g*f),w=new Float32Array(b*g*f);for(let S=0;S<f;S++){const M=S%3*2/3-1,R=S>2?0:-1,P=[M,R,0,M+2/3,R,0,M+2/3,R+1,0,M,R,0,M+2/3,R+1,0,M,R+1,0];A.set(P,y*g*S),x.set(m,v*g*S);const C=[S,S,S,S,S,S];w.set(C,b*g*S)}const _=new dt;_.setAttribute("position",new qe(A,y)),_.setAttribute("uv",new qe(x,v)),_.setAttribute("faceIndex",new qe(w,b)),e.push(_),r>$f&&r--}return{lodPlanes:e,sizeLods:i,sigmas:s}}function aF(n,e,i){const s=new Zt(n,e,i);return s.texture.mapping=Lf,s.texture.name="PMREM.cubeUv",s.scissorTest=!0,s}function fw(n,e,i,s,r){n.viewport.set(e,i,s,r),n.scissor.set(e,i,s,r)}function Wq(n,e,i){const s=new Float32Array(Dp),r=new E(0,1,0);return new kt({name:"SphericalGaussianBlur",defines:{n:Dp,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:s},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:h2(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:dn,depthTest:!1,depthWrite:!1})}function lF(){return new kt({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:h2(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:dn,depthTest:!1,depthWrite:!1})}function cF(){return new kt({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:h2(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:dn,depthTest:!1,depthWrite:!1})}function h2(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function Hq(n){let e=new WeakMap,i=null;function s(l){if(l&&l.isTexture){const c=l.mapping,h=c===Kr||c===If,u=c===rh||c===_u;if(h||u)if(l.isRenderTargetTexture&&l.needsPMREMUpdate===!0){l.needsPMREMUpdate=!1;let d=e.get(l);return i===null&&(i=new c2(n)),d=h?i.fromEquirectangular(l,d):i.fromCubemap(l,d),e.set(l,d),d.texture}else{if(e.has(l))return e.get(l).texture;{const d=l.image;if(h&&d&&d.height>0||u&&d&&r(d)){i=new c2(n);const m=h?i.fromEquirectangular(l):i.fromCubemap(l);return e.set(l,m),l.addEventListener("dispose",o),m.texture}else return null}}}return l}function r(l){let c=0;const h=6;for(let u=0;u<h;u++)l[u]!==void 0&&c++;return c===h}function o(l){const c=l.target;c.removeEventListener("dispose",o);const h=e.get(c);h!==void 0&&(e.delete(c),h.dispose())}function a(){e=new WeakMap,i!==null&&(i.dispose(),i=null)}return{get:s,dispose:a}}function jq(n){const e={};function i(s){if(e[s]!==void 0)return e[s];let r;switch(s){case"WEBGL_depth_texture":r=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=n.getExtension(s)}return e[s]=r,r}return{has:function(s){return i(s)!==null},init:function(s){s.isWebGL2?(i("EXT_color_buffer_float"),i("WEBGL_clip_cull_distance")):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(s){const r=i(s);return r===null&&console.warn("THREE.WebGLRenderer: "+s+" extension not supported."),r}}}function Qq(n,e,i,s){const r={},o=new WeakMap;function a(d){const m=d.target;m.index!==null&&e.remove(m.index);for(const g in m.attributes)e.remove(m.attributes[g]);for(const g in m.morphAttributes){const y=m.morphAttributes[g];for(let v=0,b=y.length;v<b;v++)e.remove(y[v])}m.removeEventListener("dispose",a),delete r[m.id];const f=o.get(m);f&&(e.remove(f),o.delete(m)),s.releaseStatesOfGeometry(m),m.isInstancedBufferGeometry===!0&&delete m._maxInstanceCount,i.memory.geometries--}function l(d,m){return r[m.id]===!0||(m.addEventListener("dispose",a),r[m.id]=!0,i.memory.geometries++),m}function c(d){const m=d.attributes;for(const g in m)e.update(m[g],n.ARRAY_BUFFER);const f=d.morphAttributes;for(const g in f){const y=f[g];for(let v=0,b=y.length;v<b;v++)e.update(y[v],n.ARRAY_BUFFER)}}function h(d){const m=[],f=d.index,g=d.attributes.position;let y=0;if(f!==null){const A=f.array;y=f.version;for(let x=0,w=A.length;x<w;x+=3){const _=A[x+0],S=A[x+1],M=A[x+2];m.push(_,S,S,M,M,_)}}else if(g!==void 0){const A=g.array;y=g.version;for(let x=0,w=A.length/3-1;x<w;x+=3){const _=x+0,S=x+1,M=x+2;m.push(_,S,S,M,M,_)}}else return;const v=new(Pz(m)?qR:sw)(m,1);v.version=y;const b=o.get(d);b&&e.remove(b),o.set(d,v)}function u(d){const m=o.get(d);if(m){const f=d.index;f!==null&&m.version<f.version&&h(d)}else h(d);return o.get(d)}return{get:l,update:c,getWireframeAttribute:u}}function Zq(n,e,i,s){const r=s.isWebGL2;let o;function a(f){o=f}let l,c;function h(f){l=f.type,c=f.bytesPerElement}function u(f,g){n.drawElements(o,g,l,f*c),i.update(g,o,1)}function d(f,g,y){if(y===0)return;let v,b;if(r)v=n,b="drawElementsInstanced";else if(v=e.get("ANGLE_instanced_arrays"),b="drawElementsInstancedANGLE",v===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}v[b](o,g,l,f*c,y),i.update(g,o,y)}function m(f,g,y){if(y===0)return;const v=e.get("WEBGL_multi_draw");if(v===null)for(let b=0;b<y;b++)this.render(f[b]/c,g[b]);else{v.multiDrawElementsWEBGL(o,g,0,l,f,0,y);let b=0;for(let A=0;A<y;A++)b+=g[A];i.update(b,o,1)}}this.setMode=a,this.setIndex=h,this.render=u,this.renderInstances=d,this.renderMultiDraw=m}function Yq(n){const e={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function s(o,a,l){switch(i.calls++,a){case n.TRIANGLES:i.triangles+=l*(o/3);break;case n.LINES:i.lines+=l*(o/2);break;case n.LINE_STRIP:i.lines+=l*(o-1);break;case n.LINE_LOOP:i.lines+=l*o;break;case n.POINTS:i.points+=l*o;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function r(){i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:e,render:i,programs:null,autoReset:!0,reset:r,update:s}}function Kq(n,e){return n[0]-e[0]}function Jq(n,e){return Math.abs(e[1])-Math.abs(n[1])}function qq(n,e,i){const s={},r=new Float32Array(8),o=new WeakMap,a=new Ze,l=[];for(let h=0;h<8;h++)l[h]=[h,0];function c(h,u,d){const m=h.morphTargetInfluences;if(e.isWebGL2===!0){const f=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,g=f!==void 0?f.length:0;let y=o.get(u);if(y===void 0||y.count!==g){let v=function(){L.dispose(),o.delete(u),u.removeEventListener("dispose",v)};y!==void 0&&y.texture.dispose();const b=u.morphAttributes.position!==void 0,A=u.morphAttributes.normal!==void 0,x=u.morphAttributes.color!==void 0,w=u.morphAttributes.position||[],_=u.morphAttributes.normal||[],S=u.morphAttributes.color||[];let M=0;b===!0&&(M=1),A===!0&&(M=2),x===!0&&(M=3);let R=u.attributes.position.count*M,P=1;R>e.maxTextureSize&&(P=Math.ceil(R/e.maxTextureSize),R=e.maxTextureSize);const C=new Float32Array(R*P*4*g),L=new Z1(C,R,P,g);L.type=Hi,L.needsUpdate=!0;const B=M*4;for(let z=0;z<g;z++){const D=w[z],W=_[z],O=S[z],F=R*P*4*z;for(let X=0;X<D.count;X++){const J=X*B;b===!0&&(a.fromBufferAttribute(D,X),C[F+J+0]=a.x,C[F+J+1]=a.y,C[F+J+2]=a.z,C[F+J+3]=0),A===!0&&(a.fromBufferAttribute(W,X),C[F+J+4]=a.x,C[F+J+5]=a.y,C[F+J+6]=a.z,C[F+J+7]=0),x===!0&&(a.fromBufferAttribute(O,X),C[F+J+8]=a.x,C[F+J+9]=a.y,C[F+J+10]=a.z,C[F+J+11]=O.itemSize===4?a.w:1)}}y={count:g,texture:L,size:new Y(R,P)},o.set(u,y),u.addEventListener("dispose",v)}if(h.isInstancedMesh===!0&&h.morphTexture!==null)d.getUniforms().setValue(n,"morphTexture",h.morphTexture,i);else{let v=0;for(let A=0;A<m.length;A++)v+=m[A];const b=u.morphTargetsRelative?1:1-v;d.getUniforms().setValue(n,"morphTargetBaseInfluence",b),d.getUniforms().setValue(n,"morphTargetInfluences",m)}d.getUniforms().setValue(n,"morphTargetsTexture",y.texture,i),d.getUniforms().setValue(n,"morphTargetsTextureSize",y.size)}else{const f=m===void 0?0:m.length;let g=s[u.id];if(g===void 0||g.length!==f){g=[];for(let x=0;x<f;x++)g[x]=[x,0];s[u.id]=g}for(let x=0;x<f;x++){const w=g[x];w[0]=x,w[1]=m[x]}g.sort(Jq);for(let x=0;x<8;x++)x<f&&g[x][1]?(l[x][0]=g[x][0],l[x][1]=g[x][1]):(l[x][0]=Number.MAX_SAFE_INTEGER,l[x][1]=0);l.sort(Kq);const y=u.morphAttributes.position,v=u.morphAttributes.normal;let b=0;for(let x=0;x<8;x++){const w=l[x],_=w[0],S=w[1];_!==Number.MAX_SAFE_INTEGER&&S?(y&&u.getAttribute("morphTarget"+x)!==y[_]&&u.setAttribute("morphTarget"+x,y[_]),v&&u.getAttribute("morphNormal"+x)!==v[_]&&u.setAttribute("morphNormal"+x,v[_]),r[x]=S,b+=S):(y&&u.hasAttribute("morphTarget"+x)===!0&&u.deleteAttribute("morphTarget"+x),v&&u.hasAttribute("morphNormal"+x)===!0&&u.deleteAttribute("morphNormal"+x),r[x]=0)}const A=u.morphTargetsRelative?1:1-b;d.getUniforms().setValue(n,"morphTargetBaseInfluence",A),d.getUniforms().setValue(n,"morphTargetInfluences",r)}}return{update:c}}function $q(n,e,i,s){let r=new WeakMap;function o(c){const h=s.render.frame,u=c.geometry,d=e.get(c,u);if(r.get(d)!==h&&(e.update(d),r.set(d,h)),c.isInstancedMesh&&(c.hasEventListener("dispose",l)===!1&&c.addEventListener("dispose",l),r.get(c)!==h&&(i.update(c.instanceMatrix,n.ARRAY_BUFFER),c.instanceColor!==null&&i.update(c.instanceColor,n.ARRAY_BUFFER),r.set(c,h))),c.isSkinnedMesh){const m=c.skeleton;r.get(m)!==h&&(m.update(),r.set(m,h))}return d}function a(){r=new WeakMap}function l(c){const h=c.target;h.removeEventListener("dispose",l),i.remove(h.instanceMatrix),h.instanceColor!==null&&i.remove(h.instanceColor)}return{update:o,dispose:a}}class tg extends Vt{constructor(e,i,s,r,o,a,l,c,h,u){if(u=u!==void 0?u:Su,u!==Su&&u!==Cu)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");s===void 0&&u===Su&&(s=_r),s===void 0&&u===Cu&&(s=lh),super(null,r,o,a,l,c,u,s,h),this.isDepthTexture=!0,this.image={width:e,height:i},this.magFilter=l!==void 0?l:Dt,this.minFilter=c!==void 0?c:Dt,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const i=super.toJSON(e);return this.compareFunction!==null&&(i.compareFunction=this.compareFunction),i}}const hF=new Vt,uF=new tg(1,1);uF.compareFunction=LR;const dF=new Z1,pF=new zR,mF=new fv,fF=[],gF=[],yF=new Float32Array(16),vF=new Float32Array(9),bF=new Float32Array(4);function ig(n,e,i){const s=n[0];if(s<=0||s>0)return n;const r=e*i;let o=fF[r];if(o===void 0&&(o=new Float32Array(r),fF[r]=o),e!==0){s.toArray(o,0);for(let a=1,l=0;a!==e;++a)l+=i,n[a].toArray(o,l)}return o}function gs(n,e){if(n.length!==e.length)return!1;for(let i=0,s=n.length;i<s;i++)if(n[i]!==e[i])return!1;return!0}function ys(n,e){for(let i=0,s=e.length;i<s;i++)n[i]=e[i]}function gw(n,e){let i=gF[e];i===void 0&&(i=new Int32Array(e),gF[e]=i);for(let s=0;s!==e;++s)i[s]=n.allocateTextureUnit();return i}function e$(n,e){const i=this.cache;i[0]!==e&&(n.uniform1f(this.addr,e),i[0]=e)}function t$(n,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(gs(i,e))return;n.uniform2fv(this.addr,e),ys(i,e)}}function i$(n,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else if(e.r!==void 0)(i[0]!==e.r||i[1]!==e.g||i[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b);else{if(gs(i,e))return;n.uniform3fv(this.addr,e),ys(i,e)}}function n$(n,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(gs(i,e))return;n.uniform4fv(this.addr,e),ys(i,e)}}function s$(n,e){const i=this.cache,s=e.elements;if(s===void 0){if(gs(i,e))return;n.uniformMatrix2fv(this.addr,!1,e),ys(i,e)}else{if(gs(i,s))return;bF.set(s),n.uniformMatrix2fv(this.addr,!1,bF),ys(i,s)}}function r$(n,e){const i=this.cache,s=e.elements;if(s===void 0){if(gs(i,e))return;n.uniformMatrix3fv(this.addr,!1,e),ys(i,e)}else{if(gs(i,s))return;vF.set(s),n.uniformMatrix3fv(this.addr,!1,vF),ys(i,s)}}function o$(n,e){const i=this.cache,s=e.elements;if(s===void 0){if(gs(i,e))return;n.uniformMatrix4fv(this.addr,!1,e),ys(i,e)}else{if(gs(i,s))return;yF.set(s),n.uniformMatrix4fv(this.addr,!1,yF),ys(i,s)}}function a$(n,e){const i=this.cache;i[0]!==e&&(n.uniform1i(this.addr,e),i[0]=e)}function l$(n,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(gs(i,e))return;n.uniform2iv(this.addr,e),ys(i,e)}}function c$(n,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(gs(i,e))return;n.uniform3iv(this.addr,e),ys(i,e)}}function h$(n,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(gs(i,e))return;n.uniform4iv(this.addr,e),ys(i,e)}}function u$(n,e){const i=this.cache;i[0]!==e&&(n.uniform1ui(this.addr,e),i[0]=e)}function d$(n,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(gs(i,e))return;n.uniform2uiv(this.addr,e),ys(i,e)}}function p$(n,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(gs(i,e))return;n.uniform3uiv(this.addr,e),ys(i,e)}}function m$(n,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(gs(i,e))return;n.uniform4uiv(this.addr,e),ys(i,e)}}function f$(n,e,i){const s=this.cache,r=i.allocateTextureUnit();s[0]!==r&&(n.uniform1i(this.addr,r),s[0]=r);const o=this.type===n.SAMPLER_2D_SHADOW?uF:hF;i.setTexture2D(e||o,r)}function g$(n,e,i){const s=this.cache,r=i.allocateTextureUnit();s[0]!==r&&(n.uniform1i(this.addr,r),s[0]=r),i.setTexture3D(e||pF,r)}function y$(n,e,i){const s=this.cache,r=i.allocateTextureUnit();s[0]!==r&&(n.uniform1i(this.addr,r),s[0]=r),i.setTextureCube(e||mF,r)}function v$(n,e,i){const s=this.cache,r=i.allocateTextureUnit();s[0]!==r&&(n.uniform1i(this.addr,r),s[0]=r),i.setTexture2DArray(e||dF,r)}function b$(n){switch(n){case 5126:return e$;case 35664:return t$;case 35665:return i$;case 35666:return n$;case 35674:return s$;case 35675:return r$;case 35676:return o$;case 5124:case 35670:return a$;case 35667:case 35671:return l$;case 35668:case 35672:return c$;case 35669:case 35673:return h$;case 5125:return u$;case 36294:return d$;case 36295:return p$;case 36296:return m$;case 35678:case 36198:case 36298:case 36306:case 35682:return f$;case 35679:case 36299:case 36307:return g$;case 35680:case 36300:case 36308:case 36293:return y$;case 36289:case 36303:case 36311:case 36292:return v$}}function A$(n,e){n.uniform1fv(this.addr,e)}function x$(n,e){const i=ig(e,this.size,2);n.uniform2fv(this.addr,i)}function w$(n,e){const i=ig(e,this.size,3);n.uniform3fv(this.addr,i)}function _$(n,e){const i=ig(e,this.size,4);n.uniform4fv(this.addr,i)}function S$(n,e){const i=ig(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,i)}function C$(n,e){const i=ig(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,i)}function M$(n,e){const i=ig(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,i)}function E$(n,e){n.uniform1iv(this.addr,e)}function T$(n,e){n.uniform2iv(this.addr,e)}function R$(n,e){n.uniform3iv(this.addr,e)}function I$(n,e){n.uniform4iv(this.addr,e)}function L$(n,e){n.uniform1uiv(this.addr,e)}function P$(n,e){n.uniform2uiv(this.addr,e)}function B$(n,e){n.uniform3uiv(this.addr,e)}function k$(n,e){n.uniform4uiv(this.addr,e)}function D$(n,e,i){const s=this.cache,r=e.length,o=gw(i,r);gs(s,o)||(n.uniform1iv(this.addr,o),ys(s,o));for(let a=0;a!==r;++a)i.setTexture2D(e[a]||hF,o[a])}function O$(n,e,i){const s=this.cache,r=e.length,o=gw(i,r);gs(s,o)||(n.uniform1iv(this.addr,o),ys(s,o));for(let a=0;a!==r;++a)i.setTexture3D(e[a]||pF,o[a])}function G$(n,e,i){const s=this.cache,r=e.length,o=gw(i,r);gs(s,o)||(n.uniform1iv(this.addr,o),ys(s,o));for(let a=0;a!==r;++a)i.setTextureCube(e[a]||mF,o[a])}function z$(n,e,i){const s=this.cache,r=e.length,o=gw(i,r);gs(s,o)||(n.uniform1iv(this.addr,o),ys(s,o));for(let a=0;a!==r;++a)i.setTexture2DArray(e[a]||dF,o[a])}function F$(n){switch(n){case 5126:return A$;case 35664:return x$;case 35665:return w$;case 35666:return _$;case 35674:return S$;case 35675:return C$;case 35676:return M$;case 5124:case 35670:return E$;case 35667:case 35671:return T$;case 35668:case 35672:return R$;case 35669:case 35673:return I$;case 5125:return L$;case 36294:return P$;case 36295:return B$;case 36296:return k$;case 35678:case 36198:case 36298:case 36306:case 35682:return D$;case 35679:case 36299:case 36307:return O$;case 35680:case 36300:case 36308:case 36293:return G$;case 36289:case 36303:case 36311:case 36292:return z$}}class N${constructor(e,i,s){this.id=e,this.addr=s,this.cache=[],this.type=i.type,this.setValue=b$(i.type)}}class U${constructor(e,i,s){this.id=e,this.addr=s,this.cache=[],this.type=i.type,this.size=i.size,this.setValue=F$(i.type)}}class V${constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,i,s){const r=this.seq;for(let o=0,a=r.length;o!==a;++o){const l=r[o];l.setValue(e,i[l.id],s)}}}const u2=/(\w+)(\])?(\[|\.)?/g;function AF(n,e){n.seq.push(e),n.map[e.id]=e}function X$(n,e,i){const s=n.name,r=s.length;for(u2.lastIndex=0;;){const o=u2.exec(s),a=u2.lastIndex;let l=o[1];const c=o[2]==="]",h=o[3];if(c&&(l=l|0),h===void 0||h==="["&&a+2===r){AF(i,h===void 0?new N$(l,n,e):new U$(l,n,e));break}else{let u=i.map[l];u===void 0&&(u=new V$(l),AF(i,u)),i=u}}}class yw{constructor(e,i){this.seq=[],this.map={};const s=e.getProgramParameter(i,e.ACTIVE_UNIFORMS);for(let r=0;r<s;++r){const o=e.getActiveUniform(i,r),a=e.getUniformLocation(i,o.name);X$(o,a,this)}}setValue(e,i,s,r){const o=this.map[i];o!==void 0&&o.setValue(e,s,r)}setOptional(e,i,s){const r=i[s];r!==void 0&&this.setValue(e,s,r)}static upload(e,i,s,r){for(let o=0,a=i.length;o!==a;++o){const l=i[o],c=s[l.id];c.needsUpdate!==!1&&l.setValue(e,c.value,r)}}static seqWithValue(e,i){const s=[];for(let r=0,o=e.length;r!==o;++r){const a=e[r];a.id in i&&s.push(a)}return s}}function xF(n,e,i){const s=n.createShader(e);return n.shaderSource(s,i),n.compileShader(s),s}const W$=37297;let H$=0;function j$(n,e){const i=n.split(`
`),s=[],r=Math.max(e-6,0),o=Math.min(e+6,i.length);for(let a=r;a<o;a++){const l=a+1;s.push(`${l===e?">":" "} ${l}: ${i[a]}`)}return s.join(`
`)}function Q$(n){const e=Ci.getPrimaries(Ci.workingColorSpace),i=Ci.getPrimaries(n);let s;switch(e===i?s="":e===sv&&i===nv?s="LinearDisplayP3ToLinearSRGB":e===nv&&i===sv&&(s="LinearSRGBToLinearDisplayP3"),n){case Bi:case tv:return[s,"LinearTransferOETF"];case vt:case V1:return[s,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",n),[s,"LinearTransferOETF"]}}function wF(n,e,i){const s=n.getShaderParameter(e,n.COMPILE_STATUS),r=n.getShaderInfoLog(e).trim();if(s&&r==="")return"";const o=/ERROR: 0:(\d+)/.exec(r);if(o){const a=parseInt(o[1]);return i.toUpperCase()+`

`+r+`

`+j$(n.getShaderSource(e),a)}else return r}function Z$(n,e){const i=Q$(e);return`vec4 ${n}( vec4 value ) { return ${i[0]}( ${i[1]}( value ) ); }`}function Y$(n,e){let i;switch(e){case Tf:i="Linear";break;case Yy:i="Reinhard";break;case tz:i="OptimizedCineon";break;case Ky:i="ACESFilmic";break;case Rf:i="AgX";break;case xp:i="Neutral";break;case iz:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),i="Linear"}return"vec3 "+n+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function K$(n){return[n.extensionDerivatives||n.envMapCubeUVHeight||n.bumpMap||n.normalMapTangentSpace||n.clearcoatNormalMap||n.flatShading||n.alphaToCoverage||n.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(n.extensionFragDepth||n.logarithmicDepthBuffer)&&n.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",n.extensionDrawBuffers&&n.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(n.extensionShaderTextureLOD||n.envMap||n.transmission)&&n.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(ng).join(`
`)}function J$(n){return[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",n.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(ng).join(`
`)}function q$(n){const e=[];for(const i in n){const s=n[i];s!==!1&&e.push("#define "+i+" "+s)}return e.join(`
`)}function $$(n,e){const i={},s=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let r=0;r<s;r++){const o=n.getActiveAttrib(e,r),a=o.name;let l=1;o.type===n.FLOAT_MAT2&&(l=2),o.type===n.FLOAT_MAT3&&(l=3),o.type===n.FLOAT_MAT4&&(l=4),i[a]={type:o.type,location:n.getAttribLocation(e,a),locationSize:l}}return i}function ng(n){return n!==""}function _F(n,e){const i=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function SF(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const eee=/^[ \t]*#include +<([\w\d./]+)>/gm;function d2(n){return n.replace(eee,iee)}const tee=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function iee(n,e){let i=Mt[e];if(i===void 0){const s=tee.get(e);if(s!==void 0)i=Mt[s],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,s);else throw new Error("Can not resolve #include <"+e+">")}return d2(i)}const nee=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function CF(n){return n.replace(nee,see)}function see(n,e,i,s){let r="";for(let o=parseInt(e);o<parseInt(i);o++)r+=s.replace(/\[\s*i\s*\]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return r}function MF(n){let e=`precision ${n.precision} float;
	precision ${n.precision} int;
	precision ${n.precision} sampler2D;
	precision ${n.precision} samplerCube;
	`;return n.isWebGL2&&(e+=`precision ${n.precision} sampler3D;
		precision ${n.precision} sampler2DArray;
		precision ${n.precision} sampler2DShadow;
		precision ${n.precision} samplerCubeShadow;
		precision ${n.precision} sampler2DArrayShadow;
		precision ${n.precision} isampler2D;
		precision ${n.precision} isampler3D;
		precision ${n.precision} isamplerCube;
		precision ${n.precision} isampler2DArray;
		precision ${n.precision} usampler2D;
		precision ${n.precision} usampler3D;
		precision ${n.precision} usamplerCube;
		precision ${n.precision} usampler2DArray;
		`),n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function ree(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===XT?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===WT?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===$l&&(e="SHADOWMAP_TYPE_VSM"),e}function oee(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case rh:case _u:e="ENVMAP_TYPE_CUBE";break;case Lf:e="ENVMAP_TYPE_CUBE_UV";break}return e}function aee(n){let e="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case _u:e="ENVMAP_MODE_REFRACTION";break}return e}function lee(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case Zy:e="ENVMAP_BLENDING_MULTIPLY";break;case $3:e="ENVMAP_BLENDING_MIX";break;case ez:e="ENVMAP_BLENDING_ADD";break}return e}function cee(n){const e=n.envMapCubeUVHeight;if(e===null)return null;const i=Math.log2(e)-2,s=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,i),7*16)),texelHeight:s,maxMip:i}}function hee(n,e,i,s){const r=n.getContext(),o=i.defines;let a=i.vertexShader,l=i.fragmentShader;const c=ree(i),h=oee(i),u=aee(i),d=lee(i),m=cee(i),f=i.isWebGL2?"":K$(i),g=J$(i),y=q$(o),v=r.createProgram();let b,A,x=i.glslVersion?"#version "+i.glslVersion+`
`:"";i.isRawShaderMaterial?(b=["#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,y].filter(ng).join(`
`),b.length>0&&(b+=`
`),A=[f,"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,y].filter(ng).join(`
`),A.length>0&&(A+=`
`)):(b=[MF(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,y,i.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",i.batching?"#define USE_BATCHING":"",i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.instancingMorph?"#define USE_INSTANCING_MORPH":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+u:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.displacementMap?"#define USE_DISPLACEMENTMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.mapUv?"#define MAP_UV "+i.mapUv:"",i.alphaMapUv?"#define ALPHAMAP_UV "+i.alphaMapUv:"",i.lightMapUv?"#define LIGHTMAP_UV "+i.lightMapUv:"",i.aoMapUv?"#define AOMAP_UV "+i.aoMapUv:"",i.emissiveMapUv?"#define EMISSIVEMAP_UV "+i.emissiveMapUv:"",i.bumpMapUv?"#define BUMPMAP_UV "+i.bumpMapUv:"",i.normalMapUv?"#define NORMALMAP_UV "+i.normalMapUv:"",i.displacementMapUv?"#define DISPLACEMENTMAP_UV "+i.displacementMapUv:"",i.metalnessMapUv?"#define METALNESSMAP_UV "+i.metalnessMapUv:"",i.roughnessMapUv?"#define ROUGHNESSMAP_UV "+i.roughnessMapUv:"",i.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+i.anisotropyMapUv:"",i.clearcoatMapUv?"#define CLEARCOATMAP_UV "+i.clearcoatMapUv:"",i.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+i.clearcoatNormalMapUv:"",i.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+i.clearcoatRoughnessMapUv:"",i.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+i.iridescenceMapUv:"",i.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+i.iridescenceThicknessMapUv:"",i.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+i.sheenColorMapUv:"",i.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+i.sheenRoughnessMapUv:"",i.specularMapUv?"#define SPECULARMAP_UV "+i.specularMapUv:"",i.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+i.specularColorMapUv:"",i.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+i.specularIntensityMapUv:"",i.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+i.transmissionMapUv:"",i.thicknessMapUv?"#define THICKNESSMAP_UV "+i.thicknessMapUv:"",i.vertexTangents&&i.flatShading===!1?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+c:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.useLegacyLights?"#define LEGACY_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(ng).join(`
`),A=[f,MF(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,y,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+h:"",i.envMap?"#define "+u:"",i.envMap?"#define "+d:"",m?"#define CUBEUV_TEXEL_WIDTH "+m.texelWidth:"",m?"#define CUBEUV_TEXEL_HEIGHT "+m.texelHeight:"",m?"#define CUBEUV_MAX_MIP "+m.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.vertexTangents&&i.flatShading===!1?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+c:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.useLegacyLights?"#define LEGACY_LIGHTS":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==Yr?"#define TONE_MAPPING":"",i.toneMapping!==Yr?Mt.tonemapping_pars_fragment:"",i.toneMapping!==Yr?Y$("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",Mt.colorspace_pars_fragment,Z$("linearToOutputTexel",i.outputColorSpace),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(ng).join(`
`)),a=d2(a),a=_F(a,i),a=SF(a,i),l=d2(l),l=_F(l,i),l=SF(l,i),a=CF(a),l=CF(l),i.isWebGL2&&i.isRawShaderMaterial!==!0&&(x=`#version 300 es
`,b=[g,"precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+b,A=["precision mediump sampler2DArray;","#define varying in",i.glslVersion===W1?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===W1?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+A);const w=x+b+a,_=x+A+l,S=xF(r,r.VERTEX_SHADER,w),M=xF(r,r.FRAGMENT_SHADER,_);r.attachShader(v,S),r.attachShader(v,M),i.index0AttributeName!==void 0?r.bindAttribLocation(v,0,i.index0AttributeName):i.morphTargets===!0&&r.bindAttribLocation(v,0,"position"),r.linkProgram(v);function R(B){if(n.debug.checkShaderErrors){const z=r.getProgramInfoLog(v).trim(),D=r.getShaderInfoLog(S).trim(),W=r.getShaderInfoLog(M).trim();let O=!0,F=!0;if(r.getProgramParameter(v,r.LINK_STATUS)===!1)if(O=!1,typeof n.debug.onShaderError=="function")n.debug.onShaderError(r,v,S,M);else{const X=wF(r,S,"vertex"),J=wF(r,M,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(v,r.VALIDATE_STATUS)+`

Material Name: `+B.name+`
Material Type: `+B.type+`

Program Info Log: `+z+`
`+X+`
`+J)}else z!==""?console.warn("THREE.WebGLProgram: Program Info Log:",z):(D===""||W==="")&&(F=!1);F&&(B.diagnostics={runnable:O,programLog:z,vertexShader:{log:D,prefix:b},fragmentShader:{log:W,prefix:A}})}r.deleteShader(S),r.deleteShader(M),P=new yw(r,v),C=$$(r,v)}let P;this.getUniforms=function(){return P===void 0&&R(this),P};let C;this.getAttributes=function(){return C===void 0&&R(this),C};let L=i.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return L===!1&&(L=r.getProgramParameter(v,W$)),L},this.destroy=function(){s.releaseStatesOfProgram(this),r.deleteProgram(v),this.program=void 0},this.type=i.shaderType,this.name=i.shaderName,this.id=H$++,this.cacheKey=e,this.usedTimes=1,this.program=v,this.vertexShader=S,this.fragmentShader=M,this}let uee=0;class dee{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const i=e.vertexShader,s=e.fragmentShader,r=this._getShaderStage(i),o=this._getShaderStage(s),a=this._getShaderCacheForMaterial(e);return a.has(r)===!1&&(a.add(r),r.usedTimes++),a.has(o)===!1&&(a.add(o),o.usedTimes++),this}remove(e){const i=this.materialCache.get(e);for(const s of i)s.usedTimes--,s.usedTimes===0&&this.shaderCache.delete(s.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const i=this.materialCache;let s=i.get(e);return s===void 0&&(s=new Set,i.set(e,s)),s}_getShaderStage(e){const i=this.shaderCache;let s=i.get(e);return s===void 0&&(s=new pee(e),i.set(e,s)),s}}class pee{constructor(e){this.id=uee++,this.code=e,this.usedTimes=0}}function mee(n,e,i,s,r,o,a){const l=new Mr,c=new dee,h=new Set,u=[],d=r.isWebGL2,m=r.logarithmicDepthBuffer,f=r.vertexTextures;let g=r.precision;const y={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function v(C){return h.add(C),C===0?"uv":`uv${C}`}function b(C,L,B,z,D){const W=z.fog,O=D.geometry,F=C.isMeshStandardMaterial?z.environment:null,X=(C.isMeshStandardMaterial?i:e).get(C.envMap||F),J=X&&X.mapping===Lf?X.image.height:null,q=y[C.type];C.precision!==null&&(g=r.getMaxPrecision(C.precision),g!==C.precision&&console.warn("THREE.WebGLProgram.getParameters:",C.precision,"not supported, using",g,"instead."));const oe=O.morphAttributes.position||O.morphAttributes.normal||O.morphAttributes.color,_e=oe!==void 0?oe.length:0;let ke=0;O.morphAttributes.position!==void 0&&(ke=1),O.morphAttributes.normal!==void 0&&(ke=2),O.morphAttributes.color!==void 0&&(ke=3);let re,we,Me,it;if(q){const Ie=Js[q];re=Ie.vertexShader,we=Ie.fragmentShader}else re=C.vertexShader,we=C.fragmentShader,c.update(C),Me=c.getVertexShaderID(C),it=c.getFragmentShaderID(C);const je=n.getRenderTarget(),Ge=D.isInstancedMesh===!0,rt=D.isBatchedMesh===!0,ge=!!C.map,Q=!!C.matcap,Ne=!!X,Re=!!C.aoMap,Te=!!C.lightMap,We=!!C.bumpMap,be=!!C.normalMap,nt=!!C.displacementMap,ct=!!C.emissiveMap,It=!!C.metalnessMap,H=!!C.roughnessMap,G=C.anisotropy>0,ue=C.clearcoat>0,Ee=C.iridescence>0,De=C.sheen>0,Le=C.transmission>0,At=G&&!!C.anisotropyMap,ht=ue&&!!C.clearcoatMap,Ue=ue&&!!C.clearcoatNormalMap,Xe=ue&&!!C.clearcoatRoughnessMap,Ct=Ee&&!!C.iridescenceMap,ze=Ee&&!!C.iridescenceThicknessMap,qt=De&&!!C.sheenColorMap,Oe=De&&!!C.sheenRoughnessMap,_t=!!C.specularMap,ut=!!C.specularColorMap,I=!!C.specularIntensityMap,k=Le&&!!C.transmissionMap,V=Le&&!!C.thicknessMap,ee=!!C.gradientMap,U=!!C.alphaMap,K=C.alphaTest>0,j=!!C.alphaHash,ae=!!C.extensions;let ce=Yr;C.toneMapped&&(je===null||je.isXRRenderTarget===!0)&&(ce=n.toneMapping);const xe={isWebGL2:d,shaderID:q,shaderType:C.type,shaderName:C.name,vertexShader:re,fragmentShader:we,defines:C.defines,customVertexShaderID:Me,customFragmentShaderID:it,isRawShaderMaterial:C.isRawShaderMaterial===!0,glslVersion:C.glslVersion,precision:g,batching:rt,instancing:Ge,instancingColor:Ge&&D.instanceColor!==null,instancingMorph:Ge&&D.morphTexture!==null,supportsVertexTextures:f,outputColorSpace:je===null?n.outputColorSpace:je.isXRRenderTarget===!0?je.texture.colorSpace:Bi,alphaToCoverage:!!C.alphaToCoverage,map:ge,matcap:Q,envMap:Ne,envMapMode:Ne&&X.mapping,envMapCubeUVHeight:J,aoMap:Re,lightMap:Te,bumpMap:We,normalMap:be,displacementMap:f&&nt,emissiveMap:ct,normalMapObjectSpace:be&&C.normalMapType===hz,normalMapTangentSpace:be&&C.normalMapType===Eu,metalnessMap:It,roughnessMap:H,anisotropy:G,anisotropyMap:At,clearcoat:ue,clearcoatMap:ht,clearcoatNormalMap:Ue,clearcoatRoughnessMap:Xe,iridescence:Ee,iridescenceMap:Ct,iridescenceThicknessMap:ze,sheen:De,sheenColorMap:qt,sheenRoughnessMap:Oe,specularMap:_t,specularColorMap:ut,specularIntensityMap:I,transmission:Le,transmissionMap:k,thicknessMap:V,gradientMap:ee,opaque:C.transparent===!1&&C.blending===xu&&C.alphaToCoverage===!1,alphaMap:U,alphaTest:K,alphaHash:j,combine:C.combine,mapUv:ge&&v(C.map.channel),aoMapUv:Re&&v(C.aoMap.channel),lightMapUv:Te&&v(C.lightMap.channel),bumpMapUv:We&&v(C.bumpMap.channel),normalMapUv:be&&v(C.normalMap.channel),displacementMapUv:nt&&v(C.displacementMap.channel),emissiveMapUv:ct&&v(C.emissiveMap.channel),metalnessMapUv:It&&v(C.metalnessMap.channel),roughnessMapUv:H&&v(C.roughnessMap.channel),anisotropyMapUv:At&&v(C.anisotropyMap.channel),clearcoatMapUv:ht&&v(C.clearcoatMap.channel),clearcoatNormalMapUv:Ue&&v(C.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Xe&&v(C.clearcoatRoughnessMap.channel),iridescenceMapUv:Ct&&v(C.iridescenceMap.channel),iridescenceThicknessMapUv:ze&&v(C.iridescenceThicknessMap.channel),sheenColorMapUv:qt&&v(C.sheenColorMap.channel),sheenRoughnessMapUv:Oe&&v(C.sheenRoughnessMap.channel),specularMapUv:_t&&v(C.specularMap.channel),specularColorMapUv:ut&&v(C.specularColorMap.channel),specularIntensityMapUv:I&&v(C.specularIntensityMap.channel),transmissionMapUv:k&&v(C.transmissionMap.channel),thicknessMapUv:V&&v(C.thicknessMap.channel),alphaMapUv:U&&v(C.alphaMap.channel),vertexTangents:!!O.attributes.tangent&&(be||G),vertexColors:C.vertexColors,vertexAlphas:C.vertexColors===!0&&!!O.attributes.color&&O.attributes.color.itemSize===4,pointsUvs:D.isPoints===!0&&!!O.attributes.uv&&(ge||U),fog:!!W,useFog:C.fog===!0,fogExp2:!!W&&W.isFogExp2,flatShading:C.flatShading===!0,sizeAttenuation:C.sizeAttenuation===!0,logarithmicDepthBuffer:m,skinning:D.isSkinnedMesh===!0,morphTargets:O.morphAttributes.position!==void 0,morphNormals:O.morphAttributes.normal!==void 0,morphColors:O.morphAttributes.color!==void 0,morphTargetsCount:_e,morphTextureStride:ke,numDirLights:L.directional.length,numPointLights:L.point.length,numSpotLights:L.spot.length,numSpotLightMaps:L.spotLightMap.length,numRectAreaLights:L.rectArea.length,numHemiLights:L.hemi.length,numDirLightShadows:L.directionalShadowMap.length,numPointLightShadows:L.pointShadowMap.length,numSpotLightShadows:L.spotShadowMap.length,numSpotLightShadowsWithMaps:L.numSpotLightShadowsWithMaps,numLightProbes:L.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:C.dithering,shadowMapEnabled:n.shadowMap.enabled&&B.length>0,shadowMapType:n.shadowMap.type,toneMapping:ce,useLegacyLights:n._useLegacyLights,decodeVideoTexture:ge&&C.map.isVideoTexture===!0&&Ci.getTransfer(C.map.colorSpace)===ji,premultipliedAlpha:C.premultipliedAlpha,doubleSided:C.side===xi,flipSided:C.side===un,useDepthPacking:C.depthPacking>=0,depthPacking:C.depthPacking||0,index0AttributeName:C.index0AttributeName,extensionDerivatives:ae&&C.extensions.derivatives===!0,extensionFragDepth:ae&&C.extensions.fragDepth===!0,extensionDrawBuffers:ae&&C.extensions.drawBuffers===!0,extensionShaderTextureLOD:ae&&C.extensions.shaderTextureLOD===!0,extensionClipCullDistance:ae&&C.extensions.clipCullDistance===!0&&s.has("WEBGL_clip_cull_distance"),extensionMultiDraw:ae&&C.extensions.multiDraw===!0&&s.has("WEBGL_multi_draw"),rendererExtensionFragDepth:d||s.has("EXT_frag_depth"),rendererExtensionDrawBuffers:d||s.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:d||s.has("EXT_shader_texture_lod"),rendererExtensionParallelShaderCompile:s.has("KHR_parallel_shader_compile"),customProgramCacheKey:C.customProgramCacheKey()};return xe.vertexUv1s=h.has(1),xe.vertexUv2s=h.has(2),xe.vertexUv3s=h.has(3),h.clear(),xe}function A(C){const L=[];if(C.shaderID?L.push(C.shaderID):(L.push(C.customVertexShaderID),L.push(C.customFragmentShaderID)),C.defines!==void 0)for(const B in C.defines)L.push(B),L.push(C.defines[B]);return C.isRawShaderMaterial===!1&&(x(L,C),w(L,C),L.push(n.outputColorSpace)),L.push(C.customProgramCacheKey),L.join()}function x(C,L){C.push(L.precision),C.push(L.outputColorSpace),C.push(L.envMapMode),C.push(L.envMapCubeUVHeight),C.push(L.mapUv),C.push(L.alphaMapUv),C.push(L.lightMapUv),C.push(L.aoMapUv),C.push(L.bumpMapUv),C.push(L.normalMapUv),C.push(L.displacementMapUv),C.push(L.emissiveMapUv),C.push(L.metalnessMapUv),C.push(L.roughnessMapUv),C.push(L.anisotropyMapUv),C.push(L.clearcoatMapUv),C.push(L.clearcoatNormalMapUv),C.push(L.clearcoatRoughnessMapUv),C.push(L.iridescenceMapUv),C.push(L.iridescenceThicknessMapUv),C.push(L.sheenColorMapUv),C.push(L.sheenRoughnessMapUv),C.push(L.specularMapUv),C.push(L.specularColorMapUv),C.push(L.specularIntensityMapUv),C.push(L.transmissionMapUv),C.push(L.thicknessMapUv),C.push(L.combine),C.push(L.fogExp2),C.push(L.sizeAttenuation),C.push(L.morphTargetsCount),C.push(L.morphAttributeCount),C.push(L.numDirLights),C.push(L.numPointLights),C.push(L.numSpotLights),C.push(L.numSpotLightMaps),C.push(L.numHemiLights),C.push(L.numRectAreaLights),C.push(L.numDirLightShadows),C.push(L.numPointLightShadows),C.push(L.numSpotLightShadows),C.push(L.numSpotLightShadowsWithMaps),C.push(L.numLightProbes),C.push(L.shadowMapType),C.push(L.toneMapping),C.push(L.numClippingPlanes),C.push(L.numClipIntersection),C.push(L.depthPacking)}function w(C,L){l.disableAll(),L.isWebGL2&&l.enable(0),L.supportsVertexTextures&&l.enable(1),L.instancing&&l.enable(2),L.instancingColor&&l.enable(3),L.instancingMorph&&l.enable(4),L.matcap&&l.enable(5),L.envMap&&l.enable(6),L.normalMapObjectSpace&&l.enable(7),L.normalMapTangentSpace&&l.enable(8),L.clearcoat&&l.enable(9),L.iridescence&&l.enable(10),L.alphaTest&&l.enable(11),L.vertexColors&&l.enable(12),L.vertexAlphas&&l.enable(13),L.vertexUv1s&&l.enable(14),L.vertexUv2s&&l.enable(15),L.vertexUv3s&&l.enable(16),L.vertexTangents&&l.enable(17),L.anisotropy&&l.enable(18),L.alphaHash&&l.enable(19),L.batching&&l.enable(20),C.push(l.mask),l.disableAll(),L.fog&&l.enable(0),L.useFog&&l.enable(1),L.flatShading&&l.enable(2),L.logarithmicDepthBuffer&&l.enable(3),L.skinning&&l.enable(4),L.morphTargets&&l.enable(5),L.morphNormals&&l.enable(6),L.morphColors&&l.enable(7),L.premultipliedAlpha&&l.enable(8),L.shadowMapEnabled&&l.enable(9),L.useLegacyLights&&l.enable(10),L.doubleSided&&l.enable(11),L.flipSided&&l.enable(12),L.useDepthPacking&&l.enable(13),L.dithering&&l.enable(14),L.transmission&&l.enable(15),L.sheen&&l.enable(16),L.opaque&&l.enable(17),L.pointsUvs&&l.enable(18),L.decodeVideoTexture&&l.enable(19),L.alphaToCoverage&&l.enable(20),C.push(l.mask)}function _(C){const L=y[C.type];let B;if(L){const z=Js[L];B=Kf.clone(z.uniforms)}else B=C.uniforms;return B}function S(C,L){let B;for(let z=0,D=u.length;z<D;z++){const W=u[z];if(W.cacheKey===L){B=W,++B.usedTimes;break}}return B===void 0&&(B=new hee(n,L,C,o),u.push(B)),B}function M(C){if(--C.usedTimes===0){const L=u.indexOf(C);u[L]=u[u.length-1],u.pop(),C.destroy()}}function R(C){c.remove(C)}function P(){c.dispose()}return{getParameters:b,getProgramCacheKey:A,getUniforms:_,acquireProgram:S,releaseProgram:M,releaseShaderCache:R,programs:u,dispose:P}}function fee(){let n=new WeakMap;function e(o){let a=n.get(o);return a===void 0&&(a={},n.set(o,a)),a}function i(o){n.delete(o)}function s(o,a,l){n.get(o)[a]=l}function r(){n=new WeakMap}return{get:e,remove:i,update:s,dispose:r}}function gee(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function EF(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function TF(){const n=[];let e=0;const i=[],s=[],r=[];function o(){e=0,i.length=0,s.length=0,r.length=0}function a(d,m,f,g,y,v){let b=n[e];return b===void 0?(b={id:d.id,object:d,geometry:m,material:f,groupOrder:g,renderOrder:d.renderOrder,z:y,group:v},n[e]=b):(b.id=d.id,b.object=d,b.geometry=m,b.material=f,b.groupOrder=g,b.renderOrder=d.renderOrder,b.z=y,b.group=v),e++,b}function l(d,m,f,g,y,v){const b=a(d,m,f,g,y,v);f.transmission>0?s.push(b):f.transparent===!0?r.push(b):i.push(b)}function c(d,m,f,g,y,v){const b=a(d,m,f,g,y,v);f.transmission>0?s.unshift(b):f.transparent===!0?r.unshift(b):i.unshift(b)}function h(d,m){i.length>1&&i.sort(d||gee),s.length>1&&s.sort(m||EF),r.length>1&&r.sort(m||EF)}function u(){for(let d=e,m=n.length;d<m;d++){const f=n[d];if(f.id===null)break;f.id=null,f.object=null,f.geometry=null,f.material=null,f.group=null}}return{opaque:i,transmissive:s,transparent:r,init:o,push:l,unshift:c,finish:u,sort:h}}function yee(){let n=new WeakMap;function e(s,r){const o=n.get(s);let a;return o===void 0?(a=new TF,n.set(s,[a])):r>=o.length?(a=new TF,o.push(a)):a=o[r],a}function i(){n=new WeakMap}return{get:e,dispose:i}}function vee(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let i;switch(e.type){case"DirectionalLight":i={direction:new E,color:new Ae};break;case"SpotLight":i={position:new E,direction:new E,color:new Ae,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new E,color:new Ae,distance:0,decay:0};break;case"HemisphereLight":i={direction:new E,skyColor:new Ae,groundColor:new Ae};break;case"RectAreaLight":i={color:new Ae,position:new E,halfWidth:new E,halfHeight:new E};break}return n[e.id]=i,i}}}function bee(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let i;switch(e.type){case"DirectionalLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Y};break;case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Y};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Y,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=i,i}}}let Aee=0;function xee(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function wee(n,e){const i=new vee,s=bee(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let u=0;u<9;u++)r.probe.push(new E);const o=new E,a=new he,l=new he;function c(u,d){let m=0,f=0,g=0;for(let B=0;B<9;B++)r.probe[B].set(0,0,0);let y=0,v=0,b=0,A=0,x=0,w=0,_=0,S=0,M=0,R=0,P=0;u.sort(xee);const C=d===!0?Math.PI:1;for(let B=0,z=u.length;B<z;B++){const D=u[B],W=D.color,O=D.intensity,F=D.distance,X=D.shadow&&D.shadow.map?D.shadow.map.texture:null;if(D.isAmbientLight)m+=W.r*O*C,f+=W.g*O*C,g+=W.b*O*C;else if(D.isLightProbe){for(let J=0;J<9;J++)r.probe[J].addScaledVector(D.sh.coefficients[J],O);P++}else if(D.isDirectionalLight){const J=i.get(D);if(J.color.copy(D.color).multiplyScalar(D.intensity*C),D.castShadow){const q=D.shadow,oe=s.get(D);oe.shadowBias=q.bias,oe.shadowNormalBias=q.normalBias,oe.shadowRadius=q.radius,oe.shadowMapSize=q.mapSize,r.directionalShadow[y]=oe,r.directionalShadowMap[y]=X,r.directionalShadowMatrix[y]=D.shadow.matrix,w++}r.directional[y]=J,y++}else if(D.isSpotLight){const J=i.get(D);J.position.setFromMatrixPosition(D.matrixWorld),J.color.copy(W).multiplyScalar(O*C),J.distance=F,J.coneCos=Math.cos(D.angle),J.penumbraCos=Math.cos(D.angle*(1-D.penumbra)),J.decay=D.decay,r.spot[b]=J;const q=D.shadow;if(D.map&&(r.spotLightMap[M]=D.map,M++,q.updateMatrices(D),D.castShadow&&R++),r.spotLightMatrix[b]=q.matrix,D.castShadow){const oe=s.get(D);oe.shadowBias=q.bias,oe.shadowNormalBias=q.normalBias,oe.shadowRadius=q.radius,oe.shadowMapSize=q.mapSize,r.spotShadow[b]=oe,r.spotShadowMap[b]=X,S++}b++}else if(D.isRectAreaLight){const J=i.get(D);J.color.copy(W).multiplyScalar(O),J.halfWidth.set(D.width*.5,0,0),J.halfHeight.set(0,D.height*.5,0),r.rectArea[A]=J,A++}else if(D.isPointLight){const J=i.get(D);if(J.color.copy(D.color).multiplyScalar(D.intensity*C),J.distance=D.distance,J.decay=D.decay,D.castShadow){const q=D.shadow,oe=s.get(D);oe.shadowBias=q.bias,oe.shadowNormalBias=q.normalBias,oe.shadowRadius=q.radius,oe.shadowMapSize=q.mapSize,oe.shadowCameraNear=q.camera.near,oe.shadowCameraFar=q.camera.far,r.pointShadow[v]=oe,r.pointShadowMap[v]=X,r.pointShadowMatrix[v]=D.shadow.matrix,_++}r.point[v]=J,v++}else if(D.isHemisphereLight){const J=i.get(D);J.skyColor.copy(D.color).multiplyScalar(O*C),J.groundColor.copy(D.groundColor).multiplyScalar(O*C),r.hemi[x]=J,x++}}A>0&&(e.isWebGL2?n.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=Ve.LTC_FLOAT_1,r.rectAreaLTC2=Ve.LTC_FLOAT_2):(r.rectAreaLTC1=Ve.LTC_HALF_1,r.rectAreaLTC2=Ve.LTC_HALF_2):n.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=Ve.LTC_FLOAT_1,r.rectAreaLTC2=Ve.LTC_FLOAT_2):n.has("OES_texture_half_float_linear")===!0?(r.rectAreaLTC1=Ve.LTC_HALF_1,r.rectAreaLTC2=Ve.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=m,r.ambient[1]=f,r.ambient[2]=g;const L=r.hash;(L.directionalLength!==y||L.pointLength!==v||L.spotLength!==b||L.rectAreaLength!==A||L.hemiLength!==x||L.numDirectionalShadows!==w||L.numPointShadows!==_||L.numSpotShadows!==S||L.numSpotMaps!==M||L.numLightProbes!==P)&&(r.directional.length=y,r.spot.length=b,r.rectArea.length=A,r.point.length=v,r.hemi.length=x,r.directionalShadow.length=w,r.directionalShadowMap.length=w,r.pointShadow.length=_,r.pointShadowMap.length=_,r.spotShadow.length=S,r.spotShadowMap.length=S,r.directionalShadowMatrix.length=w,r.pointShadowMatrix.length=_,r.spotLightMatrix.length=S+M-R,r.spotLightMap.length=M,r.numSpotLightShadowsWithMaps=R,r.numLightProbes=P,L.directionalLength=y,L.pointLength=v,L.spotLength=b,L.rectAreaLength=A,L.hemiLength=x,L.numDirectionalShadows=w,L.numPointShadows=_,L.numSpotShadows=S,L.numSpotMaps=M,L.numLightProbes=P,r.version=Aee++)}function h(u,d){let m=0,f=0,g=0,y=0,v=0;const b=d.matrixWorldInverse;for(let A=0,x=u.length;A<x;A++){const w=u[A];if(w.isDirectionalLight){const _=r.directional[m];_.direction.setFromMatrixPosition(w.matrixWorld),o.setFromMatrixPosition(w.target.matrixWorld),_.direction.sub(o),_.direction.transformDirection(b),m++}else if(w.isSpotLight){const _=r.spot[g];_.position.setFromMatrixPosition(w.matrixWorld),_.position.applyMatrix4(b),_.direction.setFromMatrixPosition(w.matrixWorld),o.setFromMatrixPosition(w.target.matrixWorld),_.direction.sub(o),_.direction.transformDirection(b),g++}else if(w.isRectAreaLight){const _=r.rectArea[y];_.position.setFromMatrixPosition(w.matrixWorld),_.position.applyMatrix4(b),l.identity(),a.copy(w.matrixWorld),a.premultiply(b),l.extractRotation(a),_.halfWidth.set(w.width*.5,0,0),_.halfHeight.set(0,w.height*.5,0),_.halfWidth.applyMatrix4(l),_.halfHeight.applyMatrix4(l),y++}else if(w.isPointLight){const _=r.point[f];_.position.setFromMatrixPosition(w.matrixWorld),_.position.applyMatrix4(b),f++}else if(w.isHemisphereLight){const _=r.hemi[v];_.direction.setFromMatrixPosition(w.matrixWorld),_.direction.transformDirection(b),v++}}}return{setup:c,setupView:h,state:r}}function RF(n,e){const i=new wee(n,e),s=[],r=[];function o(){s.length=0,r.length=0}function a(u){s.push(u)}function l(u){r.push(u)}function c(u){i.setup(s,u)}function h(u){i.setupView(s,u)}return{init:o,state:{lightsArray:s,shadowsArray:r,lights:i},setupLights:c,setupLightsView:h,pushLight:a,pushShadow:l}}function _ee(n,e){let i=new WeakMap;function s(o,a=0){const l=i.get(o);let c;return l===void 0?(c=new RF(n,e),i.set(o,[c])):a>=l.length?(c=new RF(n,e),l.push(c)):c=l[a],c}function r(){i=new WeakMap}return{get:s,dispose:r}}class gv extends Ft{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Ys,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class p2 extends Ft{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const See=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,Cee=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function Mee(n,e,i){let s=new Bp;const r=new Y,o=new Y,a=new Ze,l=new gv({depthPacking:U1}),c=new p2,h={},u=i.maxTextureSize,d={[Un]:un,[un]:Un,[xi]:xi},m=new kt({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Y},radius:{value:4}},vertexShader:See,fragmentShader:Cee}),f=m.clone();f.defines.HORIZONTAL_PASS=1;const g=new dt;g.setAttribute("position",new qe(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const y=new pe(g,m),v=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=XT;let b=this.type;this.render=function(S,M,R){if(v.enabled===!1||v.autoUpdate===!1&&v.needsUpdate===!1||S.length===0)return;const P=n.getRenderTarget(),C=n.getActiveCubeFace(),L=n.getActiveMipmapLevel(),B=n.state;B.setBlending(dn),B.buffers.color.setClear(1,1,1,1),B.buffers.depth.setTest(!0),B.setScissorTest(!1);const z=b!==$l&&this.type===$l,D=b===$l&&this.type!==$l;for(let W=0,O=S.length;W<O;W++){const F=S[W],X=F.shadow;if(X===void 0){console.warn("THREE.WebGLShadowMap:",F,"has no shadow.");continue}if(X.autoUpdate===!1&&X.needsUpdate===!1)continue;r.copy(X.mapSize);const J=X.getFrameExtents();if(r.multiply(J),o.copy(X.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(o.x=Math.floor(u/J.x),r.x=o.x*J.x,X.mapSize.x=o.x),r.y>u&&(o.y=Math.floor(u/J.y),r.y=o.y*J.y,X.mapSize.y=o.y)),X.map===null||z===!0||D===!0){const oe=this.type!==$l?{minFilter:Dt,magFilter:Dt}:{};X.map!==null&&X.map.dispose(),X.map=new Zt(r.x,r.y,oe),X.map.texture.name=F.name+".shadowMap",X.camera.updateProjectionMatrix()}n.setRenderTarget(X.map),n.clear();const q=X.getViewportCount();for(let oe=0;oe<q;oe++){const _e=X.getViewport(oe);a.set(o.x*_e.x,o.y*_e.y,o.x*_e.z,o.y*_e.w),B.viewport(a),X.updateMatrices(F,oe),s=X.getFrustum(),w(M,R,X.camera,F,this.type)}X.isPointLightShadow!==!0&&this.type===$l&&A(X,R),X.needsUpdate=!1}b=this.type,v.needsUpdate=!1,n.setRenderTarget(P,C,L)};function A(S,M){const R=e.update(y);m.defines.VSM_SAMPLES!==S.blurSamples&&(m.defines.VSM_SAMPLES=S.blurSamples,f.defines.VSM_SAMPLES=S.blurSamples,m.needsUpdate=!0,f.needsUpdate=!0),S.mapPass===null&&(S.mapPass=new Zt(r.x,r.y)),m.uniforms.shadow_pass.value=S.map.texture,m.uniforms.resolution.value=S.mapSize,m.uniforms.radius.value=S.radius,n.setRenderTarget(S.mapPass),n.clear(),n.renderBufferDirect(M,null,R,m,y,null),f.uniforms.shadow_pass.value=S.mapPass.texture,f.uniforms.resolution.value=S.mapSize,f.uniforms.radius.value=S.radius,n.setRenderTarget(S.map),n.clear(),n.renderBufferDirect(M,null,R,f,y,null)}function x(S,M,R,P){let C=null;const L=R.isPointLight===!0?S.customDistanceMaterial:S.customDepthMaterial;if(L!==void 0)C=L;else if(C=R.isPointLight===!0?c:l,n.localClippingEnabled&&M.clipShadows===!0&&Array.isArray(M.clippingPlanes)&&M.clippingPlanes.length!==0||M.displacementMap&&M.displacementScale!==0||M.alphaMap&&M.alphaTest>0||M.map&&M.alphaTest>0){const B=C.uuid,z=M.uuid;let D=h[B];D===void 0&&(D={},h[B]=D);let W=D[z];W===void 0&&(W=C.clone(),D[z]=W,M.addEventListener("dispose",_)),C=W}if(C.visible=M.visible,C.wireframe=M.wireframe,P===$l?C.side=M.shadowSide!==null?M.shadowSide:M.side:C.side=M.shadowSide!==null?M.shadowSide:d[M.side],C.alphaMap=M.alphaMap,C.alphaTest=M.alphaTest,C.map=M.map,C.clipShadows=M.clipShadows,C.clippingPlanes=M.clippingPlanes,C.clipIntersection=M.clipIntersection,C.displacementMap=M.displacementMap,C.displacementScale=M.displacementScale,C.displacementBias=M.displacementBias,C.wireframeLinewidth=M.wireframeLinewidth,C.linewidth=M.linewidth,R.isPointLight===!0&&C.isMeshDistanceMaterial===!0){const B=n.properties.get(C);B.light=R}return C}function w(S,M,R,P,C){if(S.visible===!1)return;if(S.layers.test(M.layers)&&(S.isMesh||S.isLine||S.isPoints)&&(S.castShadow||S.receiveShadow&&C===$l)&&(!S.frustumCulled||s.intersectsObject(S))){S.modelViewMatrix.multiplyMatrices(R.matrixWorldInverse,S.matrixWorld);const B=e.update(S),z=S.material;if(Array.isArray(z)){const D=B.groups;for(let W=0,O=D.length;W<O;W++){const F=D[W],X=z[F.materialIndex];if(X&&X.visible){const J=x(S,X,P,C);S.onBeforeShadow(n,S,M,R,B,J,F),n.renderBufferDirect(R,null,B,J,S,F),S.onAfterShadow(n,S,M,R,B,J,F)}}}else if(z.visible){const D=x(S,z,P,C);S.onBeforeShadow(n,S,M,R,B,D,null),n.renderBufferDirect(R,null,B,D,S,null),S.onAfterShadow(n,S,M,R,B,D,null)}}const L=S.children;for(let B=0,z=L.length;B<z;B++)w(L[B],M,R,P,C)}function _(S){S.target.removeEventListener("dispose",_);for(const M in h){const R=h[M],P=S.target.uuid;P in R&&(R[P].dispose(),delete R[P])}}}function Eee(n,e,i){const s=i.isWebGL2;function r(){let U=!1;const K=new Ze;let j=null;const ae=new Ze(0,0,0,0);return{setMask:function(ce){j!==ce&&!U&&(n.colorMask(ce,ce,ce,ce),j=ce)},setLocked:function(ce){U=ce},setClear:function(ce,xe,Ie,Ke,Qe){Qe===!0&&(ce*=Ke,xe*=Ke,Ie*=Ke),K.set(ce,xe,Ie,Ke),ae.equals(K)===!1&&(n.clearColor(ce,xe,Ie,Ke),ae.copy(K))},reset:function(){U=!1,j=null,ae.set(-1,0,0,0)}}}function o(){let U=!1,K=null,j=null,ae=null;return{setTest:function(ce){ce?Ge(n.DEPTH_TEST):rt(n.DEPTH_TEST)},setMask:function(ce){K!==ce&&!U&&(n.depthMask(ce),K=ce)},setFunc:function(ce){if(j!==ce){switch(ce){case YT:n.depthFunc(n.NEVER);break;case C1:n.depthFunc(n.ALWAYS);break;case jy:n.depthFunc(n.LESS);break;case Ap:n.depthFunc(n.LEQUAL);break;case Ef:n.depthFunc(n.EQUAL);break;case M1:n.depthFunc(n.GEQUAL);break;case E1:n.depthFunc(n.GREATER);break;case Qy:n.depthFunc(n.NOTEQUAL);break;default:n.depthFunc(n.LEQUAL)}j=ce}},setLocked:function(ce){U=ce},setClear:function(ce){ae!==ce&&(n.clearDepth(ce),ae=ce)},reset:function(){U=!1,K=null,j=null,ae=null}}}function a(){let U=!1,K=null,j=null,ae=null,ce=null,xe=null,Ie=null,Ke=null,Qe=null;return{setTest:function($e){U||($e?Ge(n.STENCIL_TEST):rt(n.STENCIL_TEST))},setMask:function($e){K!==$e&&!U&&(n.stencilMask($e),K=$e)},setFunc:function($e,bt,ot){(j!==$e||ae!==bt||ce!==ot)&&(n.stencilFunc($e,bt,ot),j=$e,ae=bt,ce=ot)},setOp:function($e,bt,ot){(xe!==$e||Ie!==bt||Ke!==ot)&&(n.stencilOp($e,bt,ot),xe=$e,Ie=bt,Ke=ot)},setLocked:function($e){U=$e},setClear:function($e){Qe!==$e&&(n.clearStencil($e),Qe=$e)},reset:function(){U=!1,K=null,j=null,ae=null,ce=null,xe=null,Ie=null,Ke=null,Qe=null}}}const l=new r,c=new o,h=new a,u=new WeakMap,d=new WeakMap;let m={},f={},g=new WeakMap,y=[],v=null,b=!1,A=null,x=null,w=null,_=null,S=null,M=null,R=null,P=new Ae(0,0,0),C=0,L=!1,B=null,z=null,D=null,W=null,O=null;const F=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let X=!1,J=0;const q=n.getParameter(n.VERSION);q.indexOf("WebGL")!==-1?(J=parseFloat(/^WebGL (\d)/.exec(q)[1]),X=J>=1):q.indexOf("OpenGL ES")!==-1&&(J=parseFloat(/^OpenGL ES (\d)/.exec(q)[1]),X=J>=2);let oe=null,_e={};const ke=n.getParameter(n.SCISSOR_BOX),re=n.getParameter(n.VIEWPORT),we=new Ze().fromArray(ke),Me=new Ze().fromArray(re);function it(U,K,j,ae){const ce=new Uint8Array(4),xe=n.createTexture();n.bindTexture(U,xe),n.texParameteri(U,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(U,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let Ie=0;Ie<j;Ie++)s&&(U===n.TEXTURE_3D||U===n.TEXTURE_2D_ARRAY)?n.texImage3D(K,0,n.RGBA,1,1,ae,0,n.RGBA,n.UNSIGNED_BYTE,ce):n.texImage2D(K+Ie,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,ce);return xe}const je={};je[n.TEXTURE_2D]=it(n.TEXTURE_2D,n.TEXTURE_2D,1),je[n.TEXTURE_CUBE_MAP]=it(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),s&&(je[n.TEXTURE_2D_ARRAY]=it(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),je[n.TEXTURE_3D]=it(n.TEXTURE_3D,n.TEXTURE_3D,1,1)),l.setClear(0,0,0,1),c.setClear(1),h.setClear(0),Ge(n.DEPTH_TEST),c.setFunc(Ap),nt(!1),ct(VT),Ge(n.CULL_FACE),We(dn);function Ge(U){m[U]!==!0&&(n.enable(U),m[U]=!0)}function rt(U){m[U]!==!1&&(n.disable(U),m[U]=!1)}function ge(U,K){return f[U]!==K?(n.bindFramebuffer(U,K),f[U]=K,s&&(U===n.DRAW_FRAMEBUFFER&&(f[n.FRAMEBUFFER]=K),U===n.FRAMEBUFFER&&(f[n.DRAW_FRAMEBUFFER]=K)),!0):!1}function Q(U,K){let j=y,ae=!1;if(U){j=g.get(K),j===void 0&&(j=[],g.set(K,j));const ce=U.textures;if(j.length!==ce.length||j[0]!==n.COLOR_ATTACHMENT0){for(let xe=0,Ie=ce.length;xe<Ie;xe++)j[xe]=n.COLOR_ATTACHMENT0+xe;j.length=ce.length,ae=!0}}else j[0]!==n.BACK&&(j[0]=n.BACK,ae=!0);if(ae)if(i.isWebGL2)n.drawBuffers(j);else if(e.has("WEBGL_draw_buffers")===!0)e.get("WEBGL_draw_buffers").drawBuffersWEBGL(j);else throw new Error("THREE.WebGLState: Usage of gl.drawBuffers() require WebGL2 or WEBGL_draw_buffers extension")}function Ne(U){return v!==U?(n.useProgram(U),v=U,!0):!1}const Re={[wu]:n.FUNC_ADD,[z3]:n.FUNC_SUBTRACT,[F3]:n.FUNC_REVERSE_SUBTRACT};if(s)Re[ZT]=n.MIN,Re[w1]=n.MAX;else{const U=e.get("EXT_blend_minmax");U!==null&&(Re[ZT]=U.MIN_EXT,Re[w1]=U.MAX_EXT)}const Te={[N3]:n.ZERO,[U3]:n.ONE,[V3]:n.SRC_COLOR,[_1]:n.SRC_ALPHA,[Z3]:n.SRC_ALPHA_SATURATE,[j3]:n.DST_COLOR,[W3]:n.DST_ALPHA,[X3]:n.ONE_MINUS_SRC_COLOR,[S1]:n.ONE_MINUS_SRC_ALPHA,[Q3]:n.ONE_MINUS_DST_COLOR,[H3]:n.ONE_MINUS_DST_ALPHA,[Y3]:n.CONSTANT_COLOR,[K3]:n.ONE_MINUS_CONSTANT_COLOR,[J3]:n.CONSTANT_ALPHA,[q3]:n.ONE_MINUS_CONSTANT_ALPHA};function We(U,K,j,ae,ce,xe,Ie,Ke,Qe,$e){if(U===dn){b===!0&&(rt(n.BLEND),b=!1);return}if(b===!1&&(Ge(n.BLEND),b=!0),U!==QT){if(U!==A||$e!==L){if((x!==wu||S!==wu)&&(n.blendEquation(n.FUNC_ADD),x=wu,S=wu),$e)switch(U){case xu:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case bp:n.blendFunc(n.ONE,n.ONE);break;case HT:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case jT:n.blendFuncSeparate(n.ZERO,n.SRC_COLOR,n.ZERO,n.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",U);break}else switch(U){case xu:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case bp:n.blendFunc(n.SRC_ALPHA,n.ONE);break;case HT:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case jT:n.blendFunc(n.ZERO,n.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",U);break}w=null,_=null,M=null,R=null,P.set(0,0,0),C=0,A=U,L=$e}return}ce=ce||K,xe=xe||j,Ie=Ie||ae,(K!==x||ce!==S)&&(n.blendEquationSeparate(Re[K],Re[ce]),x=K,S=ce),(j!==w||ae!==_||xe!==M||Ie!==R)&&(n.blendFuncSeparate(Te[j],Te[ae],Te[xe],Te[Ie]),w=j,_=ae,M=xe,R=Ie),(Ke.equals(P)===!1||Qe!==C)&&(n.blendColor(Ke.r,Ke.g,Ke.b,Qe),P.copy(Ke),C=Qe),A=U,L=!1}function be(U,K){U.side===xi?rt(n.CULL_FACE):Ge(n.CULL_FACE);let j=U.side===un;K&&(j=!j),nt(j),U.blending===xu&&U.transparent===!1?We(dn):We(U.blending,U.blendEquation,U.blendSrc,U.blendDst,U.blendEquationAlpha,U.blendSrcAlpha,U.blendDstAlpha,U.blendColor,U.blendAlpha,U.premultipliedAlpha),c.setFunc(U.depthFunc),c.setTest(U.depthTest),c.setMask(U.depthWrite),l.setMask(U.colorWrite);const ae=U.stencilWrite;h.setTest(ae),ae&&(h.setMask(U.stencilWriteMask),h.setFunc(U.stencilFunc,U.stencilRef,U.stencilFuncMask),h.setOp(U.stencilFail,U.stencilZFail,U.stencilZPass)),H(U.polygonOffset,U.polygonOffsetFactor,U.polygonOffsetUnits),U.alphaToCoverage===!0?Ge(n.SAMPLE_ALPHA_TO_COVERAGE):rt(n.SAMPLE_ALPHA_TO_COVERAGE)}function nt(U){B!==U&&(U?n.frontFace(n.CW):n.frontFace(n.CCW),B=U)}function ct(U){U!==O3?(Ge(n.CULL_FACE),U!==z&&(U===VT?n.cullFace(n.BACK):U===G3?n.cullFace(n.FRONT):n.cullFace(n.FRONT_AND_BACK))):rt(n.CULL_FACE),z=U}function It(U){U!==D&&(X&&n.lineWidth(U),D=U)}function H(U,K,j){U?(Ge(n.POLYGON_OFFSET_FILL),(W!==K||O!==j)&&(n.polygonOffset(K,j),W=K,O=j)):rt(n.POLYGON_OFFSET_FILL)}function G(U){U?Ge(n.SCISSOR_TEST):rt(n.SCISSOR_TEST)}function ue(U){U===void 0&&(U=n.TEXTURE0+F-1),oe!==U&&(n.activeTexture(U),oe=U)}function Ee(U,K,j){j===void 0&&(oe===null?j=n.TEXTURE0+F-1:j=oe);let ae=_e[j];ae===void 0&&(ae={type:void 0,texture:void 0},_e[j]=ae),(ae.type!==U||ae.texture!==K)&&(oe!==j&&(n.activeTexture(j),oe=j),n.bindTexture(U,K||je[U]),ae.type=U,ae.texture=K)}function De(){const U=_e[oe];U!==void 0&&U.type!==void 0&&(n.bindTexture(U.type,null),U.type=void 0,U.texture=void 0)}function Le(){try{n.compressedTexImage2D.apply(n,arguments)}catch(U){console.error("THREE.WebGLState:",U)}}function At(){try{n.compressedTexImage3D.apply(n,arguments)}catch(U){console.error("THREE.WebGLState:",U)}}function ht(){try{n.texSubImage2D.apply(n,arguments)}catch(U){console.error("THREE.WebGLState:",U)}}function Ue(){try{n.texSubImage3D.apply(n,arguments)}catch(U){console.error("THREE.WebGLState:",U)}}function Xe(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(U){console.error("THREE.WebGLState:",U)}}function Ct(){try{n.compressedTexSubImage3D.apply(n,arguments)}catch(U){console.error("THREE.WebGLState:",U)}}function ze(){try{n.texStorage2D.apply(n,arguments)}catch(U){console.error("THREE.WebGLState:",U)}}function qt(){try{n.texStorage3D.apply(n,arguments)}catch(U){console.error("THREE.WebGLState:",U)}}function Oe(){try{n.texImage2D.apply(n,arguments)}catch(U){console.error("THREE.WebGLState:",U)}}function _t(){try{n.texImage3D.apply(n,arguments)}catch(U){console.error("THREE.WebGLState:",U)}}function ut(U){we.equals(U)===!1&&(n.scissor(U.x,U.y,U.z,U.w),we.copy(U))}function I(U){Me.equals(U)===!1&&(n.viewport(U.x,U.y,U.z,U.w),Me.copy(U))}function k(U,K){let j=d.get(K);j===void 0&&(j=new WeakMap,d.set(K,j));let ae=j.get(U);ae===void 0&&(ae=n.getUniformBlockIndex(K,U.name),j.set(U,ae))}function V(U,K){const j=d.get(K).get(U);u.get(K)!==j&&(n.uniformBlockBinding(K,j,U.__bindingPointIndex),u.set(K,j))}function ee(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.blendColor(0,0,0,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),s===!0&&(n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null)),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),m={},oe=null,_e={},f={},g=new WeakMap,y=[],v=null,b=!1,A=null,x=null,w=null,_=null,S=null,M=null,R=null,P=new Ae(0,0,0),C=0,L=!1,B=null,z=null,D=null,W=null,O=null,we.set(0,0,n.canvas.width,n.canvas.height),Me.set(0,0,n.canvas.width,n.canvas.height),l.reset(),c.reset(),h.reset()}return{buffers:{color:l,depth:c,stencil:h},enable:Ge,disable:rt,bindFramebuffer:ge,drawBuffers:Q,useProgram:Ne,setBlending:We,setMaterial:be,setFlipSided:nt,setCullFace:ct,setLineWidth:It,setPolygonOffset:H,setScissorTest:G,activeTexture:ue,bindTexture:Ee,unbindTexture:De,compressedTexImage2D:Le,compressedTexImage3D:At,texImage2D:Oe,texImage3D:_t,updateUBOMapping:k,uniformBlockBinding:V,texStorage2D:ze,texStorage3D:qt,texSubImage2D:ht,texSubImage3D:Ue,compressedTexSubImage2D:Xe,compressedTexSubImage3D:Ct,scissor:ut,viewport:I,reset:ee}}function Tee(n,e,i,s,r,o,a){const l=r.isWebGL2,c=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,h=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),u=new Y,d=new WeakMap;let m;const f=new WeakMap;let g=!1;try{g=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function y(H,G){return g?new OffscreenCanvas(H,G):lv("canvas")}function v(H,G,ue,Ee){let De=1;const Le=It(H);if((Le.width>Ee||Le.height>Ee)&&(De=Ee/Math.max(Le.width,Le.height)),De<1||G===!0)if(typeof HTMLImageElement<"u"&&H instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&H instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&H instanceof ImageBitmap||typeof VideoFrame<"u"&&H instanceof VideoFrame){const At=G?j1:Math.floor,ht=At(De*Le.width),Ue=At(De*Le.height);m===void 0&&(m=y(ht,Ue));const Xe=ue?y(ht,Ue):m;return Xe.width=ht,Xe.height=Ue,Xe.getContext("2d").drawImage(H,0,0,ht,Ue),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Le.width+"x"+Le.height+") to ("+ht+"x"+Ue+")."),Xe}else return"data"in H&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Le.width+"x"+Le.height+")."),H;return H}function b(H){const G=It(H);return BR(G.width)&&BR(G.height)}function A(H){return l?!1:H.wrapS!==qn||H.wrapT!==qn||H.minFilter!==Dt&&H.minFilter!==Ot}function x(H,G){return H.generateMipmaps&&G&&H.minFilter!==Dt&&H.minFilter!==Ot}function w(H){n.generateMipmap(H)}function _(H,G,ue,Ee,De=!1){if(l===!1)return G;if(H!==null){if(n[H]!==void 0)return n[H];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+H+"'")}let Le=G;if(G===n.RED&&(ue===n.FLOAT&&(Le=n.R32F),ue===n.HALF_FLOAT&&(Le=n.R16F),ue===n.UNSIGNED_BYTE&&(Le=n.R8)),G===n.RED_INTEGER&&(ue===n.UNSIGNED_BYTE&&(Le=n.R8UI),ue===n.UNSIGNED_SHORT&&(Le=n.R16UI),ue===n.UNSIGNED_INT&&(Le=n.R32UI),ue===n.BYTE&&(Le=n.R8I),ue===n.SHORT&&(Le=n.R16I),ue===n.INT&&(Le=n.R32I)),G===n.RG&&(ue===n.FLOAT&&(Le=n.RG32F),ue===n.HALF_FLOAT&&(Le=n.RG16F),ue===n.UNSIGNED_BYTE&&(Le=n.RG8)),G===n.RG_INTEGER&&(ue===n.UNSIGNED_BYTE&&(Le=n.RG8UI),ue===n.UNSIGNED_SHORT&&(Le=n.RG16UI),ue===n.UNSIGNED_INT&&(Le=n.RG32UI),ue===n.BYTE&&(Le=n.RG8I),ue===n.SHORT&&(Le=n.RG16I),ue===n.INT&&(Le=n.RG32I)),G===n.RGBA){const At=De?iv:Ci.getTransfer(Ee);ue===n.FLOAT&&(Le=n.RGBA32F),ue===n.HALF_FLOAT&&(Le=n.RGBA16F),ue===n.UNSIGNED_BYTE&&(Le=At===ji?n.SRGB8_ALPHA8:n.RGBA8),ue===n.UNSIGNED_SHORT_4_4_4_4&&(Le=n.RGBA4),ue===n.UNSIGNED_SHORT_5_5_5_1&&(Le=n.RGB5_A1)}return(Le===n.R16F||Le===n.R32F||Le===n.RG16F||Le===n.RG32F||Le===n.RGBA16F||Le===n.RGBA32F)&&e.get("EXT_color_buffer_float"),Le}function S(H,G,ue){return x(H,ue)===!0||H.isFramebufferTexture&&H.minFilter!==Dt&&H.minFilter!==Ot?Math.log2(Math.max(G.width,G.height))+1:H.mipmaps!==void 0&&H.mipmaps.length>0?H.mipmaps.length:H.isCompressedTexture&&Array.isArray(H.image)?G.mipmaps.length:1}function M(H){return H===Dt||H===Pf||H===ah?n.NEAREST:n.LINEAR}function R(H){const G=H.target;G.removeEventListener("dispose",R),C(G),G.isVideoTexture&&d.delete(G)}function P(H){const G=H.target;G.removeEventListener("dispose",P),B(G)}function C(H){const G=s.get(H);if(G.__webglInit===void 0)return;const ue=H.source,Ee=f.get(ue);if(Ee){const De=Ee[G.__cacheKey];De.usedTimes--,De.usedTimes===0&&L(H),Object.keys(Ee).length===0&&f.delete(ue)}s.remove(H)}function L(H){const G=s.get(H);n.deleteTexture(G.__webglTexture);const ue=H.source,Ee=f.get(ue);delete Ee[G.__cacheKey],a.memory.textures--}function B(H){const G=s.get(H);if(H.depthTexture&&H.depthTexture.dispose(),H.isWebGLCubeRenderTarget)for(let Ee=0;Ee<6;Ee++){if(Array.isArray(G.__webglFramebuffer[Ee]))for(let De=0;De<G.__webglFramebuffer[Ee].length;De++)n.deleteFramebuffer(G.__webglFramebuffer[Ee][De]);else n.deleteFramebuffer(G.__webglFramebuffer[Ee]);G.__webglDepthbuffer&&n.deleteRenderbuffer(G.__webglDepthbuffer[Ee])}else{if(Array.isArray(G.__webglFramebuffer))for(let Ee=0;Ee<G.__webglFramebuffer.length;Ee++)n.deleteFramebuffer(G.__webglFramebuffer[Ee]);else n.deleteFramebuffer(G.__webglFramebuffer);if(G.__webglDepthbuffer&&n.deleteRenderbuffer(G.__webglDepthbuffer),G.__webglMultisampledFramebuffer&&n.deleteFramebuffer(G.__webglMultisampledFramebuffer),G.__webglColorRenderbuffer)for(let Ee=0;Ee<G.__webglColorRenderbuffer.length;Ee++)G.__webglColorRenderbuffer[Ee]&&n.deleteRenderbuffer(G.__webglColorRenderbuffer[Ee]);G.__webglDepthRenderbuffer&&n.deleteRenderbuffer(G.__webglDepthRenderbuffer)}const ue=H.textures;for(let Ee=0,De=ue.length;Ee<De;Ee++){const Le=s.get(ue[Ee]);Le.__webglTexture&&(n.deleteTexture(Le.__webglTexture),a.memory.textures--),s.remove(ue[Ee])}s.remove(H)}let z=0;function D(){z=0}function W(){const H=z;return H>=r.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+H+" texture units while this GPU supports only "+r.maxTextures),z+=1,H}function O(H){const G=[];return G.push(H.wrapS),G.push(H.wrapT),G.push(H.wrapR||0),G.push(H.magFilter),G.push(H.minFilter),G.push(H.anisotropy),G.push(H.internalFormat),G.push(H.format),G.push(H.type),G.push(H.generateMipmaps),G.push(H.premultiplyAlpha),G.push(H.flipY),G.push(H.unpackAlignment),G.push(H.colorSpace),G.join()}function F(H,G){const ue=s.get(H);if(H.isVideoTexture&&nt(H),H.isRenderTargetTexture===!1&&H.version>0&&ue.__version!==H.version){const Ee=H.image;if(Ee===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Ee.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Me(ue,H,G);return}}i.bindTexture(n.TEXTURE_2D,ue.__webglTexture,n.TEXTURE0+G)}function X(H,G){const ue=s.get(H);if(H.version>0&&ue.__version!==H.version){Me(ue,H,G);return}i.bindTexture(n.TEXTURE_2D_ARRAY,ue.__webglTexture,n.TEXTURE0+G)}function J(H,G){const ue=s.get(H);if(H.version>0&&ue.__version!==H.version){Me(ue,H,G);return}i.bindTexture(n.TEXTURE_3D,ue.__webglTexture,n.TEXTURE0+G)}function q(H,G){const ue=s.get(H);if(H.version>0&&ue.__version!==H.version){it(ue,H,G);return}i.bindTexture(n.TEXTURE_CUBE_MAP,ue.__webglTexture,n.TEXTURE0+G)}const oe={[_o]:n.REPEAT,[qn]:n.CLAMP_TO_EDGE,[oh]:n.MIRRORED_REPEAT},_e={[Dt]:n.NEAREST,[Pf]:n.NEAREST_MIPMAP_NEAREST,[ah]:n.NEAREST_MIPMAP_LINEAR,[Ot]:n.LINEAR,[wp]:n.LINEAR_MIPMAP_NEAREST,[So]:n.LINEAR_MIPMAP_LINEAR},ke={[Sz]:n.NEVER,[Iz]:n.ALWAYS,[Cz]:n.LESS,[LR]:n.LEQUAL,[Mz]:n.EQUAL,[Rz]:n.GEQUAL,[Ez]:n.GREATER,[Tz]:n.NOTEQUAL};function re(H,G,ue){if(G.type===Hi&&e.has("OES_texture_float_linear")===!1&&(G.magFilter===Ot||G.magFilter===wp||G.magFilter===ah||G.magFilter===So||G.minFilter===Ot||G.minFilter===wp||G.minFilter===ah||G.minFilter===So)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),ue?(n.texParameteri(H,n.TEXTURE_WRAP_S,oe[G.wrapS]),n.texParameteri(H,n.TEXTURE_WRAP_T,oe[G.wrapT]),(H===n.TEXTURE_3D||H===n.TEXTURE_2D_ARRAY)&&n.texParameteri(H,n.TEXTURE_WRAP_R,oe[G.wrapR]),n.texParameteri(H,n.TEXTURE_MAG_FILTER,_e[G.magFilter]),n.texParameteri(H,n.TEXTURE_MIN_FILTER,_e[G.minFilter])):(n.texParameteri(H,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(H,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),(H===n.TEXTURE_3D||H===n.TEXTURE_2D_ARRAY)&&n.texParameteri(H,n.TEXTURE_WRAP_R,n.CLAMP_TO_EDGE),(G.wrapS!==qn||G.wrapT!==qn)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),n.texParameteri(H,n.TEXTURE_MAG_FILTER,M(G.magFilter)),n.texParameteri(H,n.TEXTURE_MIN_FILTER,M(G.minFilter)),G.minFilter!==Dt&&G.minFilter!==Ot&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),G.compareFunction&&(n.texParameteri(H,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(H,n.TEXTURE_COMPARE_FUNC,ke[G.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(G.magFilter===Dt||G.minFilter!==ah&&G.minFilter!==So||G.type===Hi&&e.has("OES_texture_float_linear")===!1||l===!1&&G.type===ms&&e.has("OES_texture_half_float_linear")===!1)return;if(G.anisotropy>1||s.get(G).__currentAnisotropy){const Ee=e.get("EXT_texture_filter_anisotropic");n.texParameterf(H,Ee.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(G.anisotropy,r.getMaxAnisotropy())),s.get(G).__currentAnisotropy=G.anisotropy}}}function we(H,G){let ue=!1;H.__webglInit===void 0&&(H.__webglInit=!0,G.addEventListener("dispose",R));const Ee=G.source;let De=f.get(Ee);De===void 0&&(De={},f.set(Ee,De));const Le=O(G);if(Le!==H.__cacheKey){De[Le]===void 0&&(De[Le]={texture:n.createTexture(),usedTimes:0},a.memory.textures++,ue=!0),De[Le].usedTimes++;const At=De[H.__cacheKey];At!==void 0&&(De[H.__cacheKey].usedTimes--,At.usedTimes===0&&L(G)),H.__cacheKey=Le,H.__webglTexture=De[Le].texture}return ue}function Me(H,G,ue){let Ee=n.TEXTURE_2D;(G.isDataArrayTexture||G.isCompressedArrayTexture)&&(Ee=n.TEXTURE_2D_ARRAY),G.isData3DTexture&&(Ee=n.TEXTURE_3D);const De=we(H,G),Le=G.source;i.bindTexture(Ee,H.__webglTexture,n.TEXTURE0+ue);const At=s.get(Le);if(Le.version!==At.__version||De===!0){i.activeTexture(n.TEXTURE0+ue);const ht=Ci.getPrimaries(Ci.workingColorSpace),Ue=G.colorSpace===Co?null:Ci.getPrimaries(G.colorSpace),Xe=G.colorSpace===Co||ht===Ue?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,G.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,G.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,G.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,Xe);const Ct=A(G)&&b(G.image)===!1;let ze=v(G.image,Ct,!1,r.maxTextureSize);ze=ct(G,ze);const qt=b(ze)||l,Oe=o.convert(G.format,G.colorSpace);let _t=o.convert(G.type),ut=_(G.internalFormat,Oe,_t,G.colorSpace,G.isVideoTexture);re(Ee,G,qt);let I;const k=G.mipmaps,V=l&&G.isVideoTexture!==!0&&ut!==sR,ee=At.__version===void 0||De===!0,U=Le.dataReady,K=S(G,ze,qt);if(G.isDepthTexture)ut=n.DEPTH_COMPONENT,l?G.type===Hi?ut=n.DEPTH_COMPONENT32F:G.type===_r?ut=n.DEPTH_COMPONENT24:G.type===lh?ut=n.DEPTH24_STENCIL8:ut=n.DEPTH_COMPONENT16:G.type===Hi&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),G.format===Su&&ut===n.DEPTH_COMPONENT&&G.type!==Jy&&G.type!==_r&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),G.type=_r,_t=o.convert(G.type)),G.format===Cu&&ut===n.DEPTH_COMPONENT&&(ut=n.DEPTH_STENCIL,G.type!==lh&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),G.type=lh,_t=o.convert(G.type))),ee&&(V?i.texStorage2D(n.TEXTURE_2D,1,ut,ze.width,ze.height):i.texImage2D(n.TEXTURE_2D,0,ut,ze.width,ze.height,0,Oe,_t,null));else if(G.isDataTexture)if(k.length>0&&qt){V&&ee&&i.texStorage2D(n.TEXTURE_2D,K,ut,k[0].width,k[0].height);for(let j=0,ae=k.length;j<ae;j++)I=k[j],V?U&&i.texSubImage2D(n.TEXTURE_2D,j,0,0,I.width,I.height,Oe,_t,I.data):i.texImage2D(n.TEXTURE_2D,j,ut,I.width,I.height,0,Oe,_t,I.data);G.generateMipmaps=!1}else V?(ee&&i.texStorage2D(n.TEXTURE_2D,K,ut,ze.width,ze.height),U&&i.texSubImage2D(n.TEXTURE_2D,0,0,0,ze.width,ze.height,Oe,_t,ze.data)):i.texImage2D(n.TEXTURE_2D,0,ut,ze.width,ze.height,0,Oe,_t,ze.data);else if(G.isCompressedTexture)if(G.isCompressedArrayTexture){V&&ee&&i.texStorage3D(n.TEXTURE_2D_ARRAY,K,ut,k[0].width,k[0].height,ze.depth);for(let j=0,ae=k.length;j<ae;j++)I=k[j],G.format!==_i?Oe!==null?V?U&&i.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,j,0,0,0,I.width,I.height,ze.depth,Oe,I.data,0,0):i.compressedTexImage3D(n.TEXTURE_2D_ARRAY,j,ut,I.width,I.height,ze.depth,0,I.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):V?U&&i.texSubImage3D(n.TEXTURE_2D_ARRAY,j,0,0,0,I.width,I.height,ze.depth,Oe,_t,I.data):i.texImage3D(n.TEXTURE_2D_ARRAY,j,ut,I.width,I.height,ze.depth,0,Oe,_t,I.data)}else{V&&ee&&i.texStorage2D(n.TEXTURE_2D,K,ut,k[0].width,k[0].height);for(let j=0,ae=k.length;j<ae;j++)I=k[j],G.format!==_i?Oe!==null?V?U&&i.compressedTexSubImage2D(n.TEXTURE_2D,j,0,0,I.width,I.height,Oe,I.data):i.compressedTexImage2D(n.TEXTURE_2D,j,ut,I.width,I.height,0,I.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):V?U&&i.texSubImage2D(n.TEXTURE_2D,j,0,0,I.width,I.height,Oe,_t,I.data):i.texImage2D(n.TEXTURE_2D,j,ut,I.width,I.height,0,Oe,_t,I.data)}else if(G.isDataArrayTexture)V?(ee&&i.texStorage3D(n.TEXTURE_2D_ARRAY,K,ut,ze.width,ze.height,ze.depth),U&&i.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,ze.width,ze.height,ze.depth,Oe,_t,ze.data)):i.texImage3D(n.TEXTURE_2D_ARRAY,0,ut,ze.width,ze.height,ze.depth,0,Oe,_t,ze.data);else if(G.isData3DTexture)V?(ee&&i.texStorage3D(n.TEXTURE_3D,K,ut,ze.width,ze.height,ze.depth),U&&i.texSubImage3D(n.TEXTURE_3D,0,0,0,0,ze.width,ze.height,ze.depth,Oe,_t,ze.data)):i.texImage3D(n.TEXTURE_3D,0,ut,ze.width,ze.height,ze.depth,0,Oe,_t,ze.data);else if(G.isFramebufferTexture){if(ee)if(V)i.texStorage2D(n.TEXTURE_2D,K,ut,ze.width,ze.height);else{let j=ze.width,ae=ze.height;for(let ce=0;ce<K;ce++)i.texImage2D(n.TEXTURE_2D,ce,ut,j,ae,0,Oe,_t,null),j>>=1,ae>>=1}}else if(k.length>0&&qt){if(V&&ee){const j=It(k[0]);i.texStorage2D(n.TEXTURE_2D,K,ut,j.width,j.height)}for(let j=0,ae=k.length;j<ae;j++)I=k[j],V?U&&i.texSubImage2D(n.TEXTURE_2D,j,0,0,Oe,_t,I):i.texImage2D(n.TEXTURE_2D,j,ut,Oe,_t,I);G.generateMipmaps=!1}else if(V){if(ee){const j=It(ze);i.texStorage2D(n.TEXTURE_2D,K,ut,j.width,j.height)}U&&i.texSubImage2D(n.TEXTURE_2D,0,0,0,Oe,_t,ze)}else i.texImage2D(n.TEXTURE_2D,0,ut,Oe,_t,ze);x(G,qt)&&w(Ee),At.__version=Le.version,G.onUpdate&&G.onUpdate(G)}H.__version=G.version}function it(H,G,ue){if(G.image.length!==6)return;const Ee=we(H,G),De=G.source;i.bindTexture(n.TEXTURE_CUBE_MAP,H.__webglTexture,n.TEXTURE0+ue);const Le=s.get(De);if(De.version!==Le.__version||Ee===!0){i.activeTexture(n.TEXTURE0+ue);const At=Ci.getPrimaries(Ci.workingColorSpace),ht=G.colorSpace===Co?null:Ci.getPrimaries(G.colorSpace),Ue=G.colorSpace===Co||At===ht?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,G.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,G.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,G.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,Ue);const Xe=G.isCompressedTexture||G.image[0].isCompressedTexture,Ct=G.image[0]&&G.image[0].isDataTexture,ze=[];for(let j=0;j<6;j++)!Xe&&!Ct?ze[j]=v(G.image[j],!1,!0,r.maxCubemapSize):ze[j]=Ct?G.image[j].image:G.image[j],ze[j]=ct(G,ze[j]);const qt=ze[0],Oe=b(qt)||l,_t=o.convert(G.format,G.colorSpace),ut=o.convert(G.type),I=_(G.internalFormat,_t,ut,G.colorSpace),k=l&&G.isVideoTexture!==!0,V=Le.__version===void 0||Ee===!0,ee=De.dataReady;let U=S(G,qt,Oe);re(n.TEXTURE_CUBE_MAP,G,Oe);let K;if(Xe){k&&V&&i.texStorage2D(n.TEXTURE_CUBE_MAP,U,I,qt.width,qt.height);for(let j=0;j<6;j++){K=ze[j].mipmaps;for(let ae=0;ae<K.length;ae++){const ce=K[ae];G.format!==_i?_t!==null?k?ee&&i.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+j,ae,0,0,ce.width,ce.height,_t,ce.data):i.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+j,ae,I,ce.width,ce.height,0,ce.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):k?ee&&i.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+j,ae,0,0,ce.width,ce.height,_t,ut,ce.data):i.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+j,ae,I,ce.width,ce.height,0,_t,ut,ce.data)}}}else{if(K=G.mipmaps,k&&V){K.length>0&&U++;const j=It(ze[0]);i.texStorage2D(n.TEXTURE_CUBE_MAP,U,I,j.width,j.height)}for(let j=0;j<6;j++)if(Ct){k?ee&&i.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+j,0,0,0,ze[j].width,ze[j].height,_t,ut,ze[j].data):i.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+j,0,I,ze[j].width,ze[j].height,0,_t,ut,ze[j].data);for(let ae=0;ae<K.length;ae++){const ce=K[ae].image[j].image;k?ee&&i.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+j,ae+1,0,0,ce.width,ce.height,_t,ut,ce.data):i.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+j,ae+1,I,ce.width,ce.height,0,_t,ut,ce.data)}}else{k?ee&&i.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+j,0,0,0,_t,ut,ze[j]):i.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+j,0,I,_t,ut,ze[j]);for(let ae=0;ae<K.length;ae++){const ce=K[ae];k?ee&&i.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+j,ae+1,0,0,_t,ut,ce.image[j]):i.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+j,ae+1,I,_t,ut,ce.image[j])}}}x(G,Oe)&&w(n.TEXTURE_CUBE_MAP),Le.__version=De.version,G.onUpdate&&G.onUpdate(G)}H.__version=G.version}function je(H,G,ue,Ee,De,Le){const At=o.convert(ue.format,ue.colorSpace),ht=o.convert(ue.type),Ue=_(ue.internalFormat,At,ht,ue.colorSpace);if(!s.get(G).__hasExternalTextures){const Xe=Math.max(1,G.width>>Le),Ct=Math.max(1,G.height>>Le);De===n.TEXTURE_3D||De===n.TEXTURE_2D_ARRAY?i.texImage3D(De,Le,Ue,Xe,Ct,G.depth,0,At,ht,null):i.texImage2D(De,Le,Ue,Xe,Ct,0,At,ht,null)}i.bindFramebuffer(n.FRAMEBUFFER,H),be(G)?c.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,Ee,De,s.get(ue).__webglTexture,0,We(G)):(De===n.TEXTURE_2D||De>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&De<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,Ee,De,s.get(ue).__webglTexture,Le),i.bindFramebuffer(n.FRAMEBUFFER,null)}function Ge(H,G,ue){if(n.bindRenderbuffer(n.RENDERBUFFER,H),G.depthBuffer&&!G.stencilBuffer){let Ee=l===!0?n.DEPTH_COMPONENT24:n.DEPTH_COMPONENT16;if(ue||be(G)){const De=G.depthTexture;De&&De.isDepthTexture&&(De.type===Hi?Ee=n.DEPTH_COMPONENT32F:De.type===_r&&(Ee=n.DEPTH_COMPONENT24));const Le=We(G);be(G)?c.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,Le,Ee,G.width,G.height):n.renderbufferStorageMultisample(n.RENDERBUFFER,Le,Ee,G.width,G.height)}else n.renderbufferStorage(n.RENDERBUFFER,Ee,G.width,G.height);n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,H)}else if(G.depthBuffer&&G.stencilBuffer){const Ee=We(G);ue&&be(G)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,Ee,n.DEPTH24_STENCIL8,G.width,G.height):be(G)?c.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,Ee,n.DEPTH24_STENCIL8,G.width,G.height):n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,G.width,G.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,H)}else{const Ee=G.textures;for(let De=0;De<Ee.length;De++){const Le=Ee[De],At=o.convert(Le.format,Le.colorSpace),ht=o.convert(Le.type),Ue=_(Le.internalFormat,At,ht,Le.colorSpace),Xe=We(G);ue&&be(G)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,Xe,Ue,G.width,G.height):be(G)?c.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,Xe,Ue,G.width,G.height):n.renderbufferStorage(n.RENDERBUFFER,Ue,G.width,G.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function rt(H,G){if(G&&G.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(n.FRAMEBUFFER,H),!(G.depthTexture&&G.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!s.get(G.depthTexture).__webglTexture||G.depthTexture.image.width!==G.width||G.depthTexture.image.height!==G.height)&&(G.depthTexture.image.width=G.width,G.depthTexture.image.height=G.height,G.depthTexture.needsUpdate=!0),F(G.depthTexture,0);const ue=s.get(G.depthTexture).__webglTexture,Ee=We(G);if(G.depthTexture.format===Su)be(G)?c.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,ue,0,Ee):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,ue,0);else if(G.depthTexture.format===Cu)be(G)?c.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,ue,0,Ee):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,ue,0);else throw new Error("Unknown depthTexture format")}function ge(H){const G=s.get(H),ue=H.isWebGLCubeRenderTarget===!0;if(H.depthTexture&&!G.__autoAllocateDepthBuffer){if(ue)throw new Error("target.depthTexture not supported in Cube render targets");rt(G.__webglFramebuffer,H)}else if(ue){G.__webglDepthbuffer=[];for(let Ee=0;Ee<6;Ee++)i.bindFramebuffer(n.FRAMEBUFFER,G.__webglFramebuffer[Ee]),G.__webglDepthbuffer[Ee]=n.createRenderbuffer(),Ge(G.__webglDepthbuffer[Ee],H,!1)}else i.bindFramebuffer(n.FRAMEBUFFER,G.__webglFramebuffer),G.__webglDepthbuffer=n.createRenderbuffer(),Ge(G.__webglDepthbuffer,H,!1);i.bindFramebuffer(n.FRAMEBUFFER,null)}function Q(H,G,ue){const Ee=s.get(H);G!==void 0&&je(Ee.__webglFramebuffer,H,H.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),ue!==void 0&&ge(H)}function Ne(H){const G=H.texture,ue=s.get(H),Ee=s.get(G);H.addEventListener("dispose",P);const De=H.textures,Le=H.isWebGLCubeRenderTarget===!0,At=De.length>1,ht=b(H)||l;if(At||(Ee.__webglTexture===void 0&&(Ee.__webglTexture=n.createTexture()),Ee.__version=G.version,a.memory.textures++),Le){ue.__webglFramebuffer=[];for(let Ue=0;Ue<6;Ue++)if(l&&G.mipmaps&&G.mipmaps.length>0){ue.__webglFramebuffer[Ue]=[];for(let Xe=0;Xe<G.mipmaps.length;Xe++)ue.__webglFramebuffer[Ue][Xe]=n.createFramebuffer()}else ue.__webglFramebuffer[Ue]=n.createFramebuffer()}else{if(l&&G.mipmaps&&G.mipmaps.length>0){ue.__webglFramebuffer=[];for(let Ue=0;Ue<G.mipmaps.length;Ue++)ue.__webglFramebuffer[Ue]=n.createFramebuffer()}else ue.__webglFramebuffer=n.createFramebuffer();if(At)if(r.drawBuffers)for(let Ue=0,Xe=De.length;Ue<Xe;Ue++){const Ct=s.get(De[Ue]);Ct.__webglTexture===void 0&&(Ct.__webglTexture=n.createTexture(),a.memory.textures++)}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(l&&H.samples>0&&be(H)===!1){ue.__webglMultisampledFramebuffer=n.createFramebuffer(),ue.__webglColorRenderbuffer=[],i.bindFramebuffer(n.FRAMEBUFFER,ue.__webglMultisampledFramebuffer);for(let Ue=0;Ue<De.length;Ue++){const Xe=De[Ue];ue.__webglColorRenderbuffer[Ue]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,ue.__webglColorRenderbuffer[Ue]);const Ct=o.convert(Xe.format,Xe.colorSpace),ze=o.convert(Xe.type),qt=_(Xe.internalFormat,Ct,ze,Xe.colorSpace,H.isXRRenderTarget===!0),Oe=We(H);n.renderbufferStorageMultisample(n.RENDERBUFFER,Oe,qt,H.width,H.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Ue,n.RENDERBUFFER,ue.__webglColorRenderbuffer[Ue])}n.bindRenderbuffer(n.RENDERBUFFER,null),H.depthBuffer&&(ue.__webglDepthRenderbuffer=n.createRenderbuffer(),Ge(ue.__webglDepthRenderbuffer,H,!0)),i.bindFramebuffer(n.FRAMEBUFFER,null)}}if(Le){i.bindTexture(n.TEXTURE_CUBE_MAP,Ee.__webglTexture),re(n.TEXTURE_CUBE_MAP,G,ht);for(let Ue=0;Ue<6;Ue++)if(l&&G.mipmaps&&G.mipmaps.length>0)for(let Xe=0;Xe<G.mipmaps.length;Xe++)je(ue.__webglFramebuffer[Ue][Xe],H,G,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+Ue,Xe);else je(ue.__webglFramebuffer[Ue],H,G,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+Ue,0);x(G,ht)&&w(n.TEXTURE_CUBE_MAP),i.unbindTexture()}else if(At){for(let Ue=0,Xe=De.length;Ue<Xe;Ue++){const Ct=De[Ue],ze=s.get(Ct);i.bindTexture(n.TEXTURE_2D,ze.__webglTexture),re(n.TEXTURE_2D,Ct,ht),je(ue.__webglFramebuffer,H,Ct,n.COLOR_ATTACHMENT0+Ue,n.TEXTURE_2D,0),x(Ct,ht)&&w(n.TEXTURE_2D)}i.unbindTexture()}else{let Ue=n.TEXTURE_2D;if((H.isWebGL3DRenderTarget||H.isWebGLArrayRenderTarget)&&(l?Ue=H.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(Ue,Ee.__webglTexture),re(Ue,G,ht),l&&G.mipmaps&&G.mipmaps.length>0)for(let Xe=0;Xe<G.mipmaps.length;Xe++)je(ue.__webglFramebuffer[Xe],H,G,n.COLOR_ATTACHMENT0,Ue,Xe);else je(ue.__webglFramebuffer,H,G,n.COLOR_ATTACHMENT0,Ue,0);x(G,ht)&&w(Ue),i.unbindTexture()}H.depthBuffer&&ge(H)}function Re(H){const G=b(H)||l,ue=H.textures;for(let Ee=0,De=ue.length;Ee<De;Ee++){const Le=ue[Ee];if(x(Le,G)){const At=H.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D,ht=s.get(Le).__webglTexture;i.bindTexture(At,ht),w(At),i.unbindTexture()}}}function Te(H){if(l&&H.samples>0&&be(H)===!1){const G=H.textures,ue=H.width,Ee=H.height;let De=n.COLOR_BUFFER_BIT;const Le=[],At=H.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,ht=s.get(H),Ue=G.length>1;if(Ue)for(let Xe=0;Xe<G.length;Xe++)i.bindFramebuffer(n.FRAMEBUFFER,ht.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Xe,n.RENDERBUFFER,null),i.bindFramebuffer(n.FRAMEBUFFER,ht.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Xe,n.TEXTURE_2D,null,0);i.bindFramebuffer(n.READ_FRAMEBUFFER,ht.__webglMultisampledFramebuffer),i.bindFramebuffer(n.DRAW_FRAMEBUFFER,ht.__webglFramebuffer);for(let Xe=0;Xe<G.length;Xe++){Le.push(n.COLOR_ATTACHMENT0+Xe),H.depthBuffer&&Le.push(At);const Ct=ht.__ignoreDepthValues!==void 0?ht.__ignoreDepthValues:!1;if(Ct===!1&&(H.depthBuffer&&(De|=n.DEPTH_BUFFER_BIT),H.stencilBuffer&&(De|=n.STENCIL_BUFFER_BIT)),Ue&&n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,ht.__webglColorRenderbuffer[Xe]),Ct===!0&&(n.invalidateFramebuffer(n.READ_FRAMEBUFFER,[At]),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[At])),Ue){const ze=s.get(G[Xe]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,ze,0)}n.blitFramebuffer(0,0,ue,Ee,0,0,ue,Ee,De,n.NEAREST),h&&n.invalidateFramebuffer(n.READ_FRAMEBUFFER,Le)}if(i.bindFramebuffer(n.READ_FRAMEBUFFER,null),i.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),Ue)for(let Xe=0;Xe<G.length;Xe++){i.bindFramebuffer(n.FRAMEBUFFER,ht.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Xe,n.RENDERBUFFER,ht.__webglColorRenderbuffer[Xe]);const Ct=s.get(G[Xe]).__webglTexture;i.bindFramebuffer(n.FRAMEBUFFER,ht.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Xe,n.TEXTURE_2D,Ct,0)}i.bindFramebuffer(n.DRAW_FRAMEBUFFER,ht.__webglMultisampledFramebuffer)}}function We(H){return Math.min(r.maxSamples,H.samples)}function be(H){const G=s.get(H);return l&&H.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&G.__useRenderToTexture!==!1}function nt(H){const G=a.render.frame;d.get(H)!==G&&(d.set(H,G),H.update())}function ct(H,G){const ue=H.colorSpace,Ee=H.format,De=H.type;return H.isCompressedTexture===!0||H.isVideoTexture===!0||H.format===H1||ue!==Bi&&ue!==Co&&(Ci.getTransfer(ue)===ji?l===!1?e.has("EXT_sRGB")===!0&&Ee===_i?(H.format=H1,H.minFilter=Ot,H.generateMipmaps=!1):G=OR.sRGBToLinear(G):(Ee!==_i||De!==pn)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",ue)),G}function It(H){return typeof HTMLImageElement<"u"&&H instanceof HTMLImageElement?(u.width=H.naturalWidth||H.width,u.height=H.naturalHeight||H.height):typeof VideoFrame<"u"&&H instanceof VideoFrame?(u.width=H.displayWidth,u.height=H.displayHeight):(u.width=H.width,u.height=H.height),u}this.allocateTextureUnit=W,this.resetTextureUnits=D,this.setTexture2D=F,this.setTexture2DArray=X,this.setTexture3D=J,this.setTextureCube=q,this.rebindTextures=Q,this.setupRenderTarget=Ne,this.updateRenderTargetMipmap=Re,this.updateMultisampleRenderTarget=Te,this.setupDepthRenderbuffer=ge,this.setupFrameBufferTexture=je,this.useMultisampledRTT=be}function IF(n,e,i){const s=i.isWebGL2;function r(o,a=Co){let l;const c=Ci.getTransfer(a);if(o===pn)return n.UNSIGNED_BYTE;if(o===qT)return n.UNSIGNED_SHORT_4_4_4_4;if(o===$T)return n.UNSIGNED_SHORT_5_5_5_1;if(o===R1)return n.BYTE;if(o===JT)return n.SHORT;if(o===Jy)return n.UNSIGNED_SHORT;if(o===_p)return n.INT;if(o===_r)return n.UNSIGNED_INT;if(o===Hi)return n.FLOAT;if(o===ms)return s?n.HALF_FLOAT:(l=e.get("OES_texture_half_float"),l!==null?l.HALF_FLOAT_OES:null);if(o===sz)return n.ALPHA;if(o===_i)return n.RGBA;if(o===I1)return n.LUMINANCE;if(o===rz)return n.LUMINANCE_ALPHA;if(o===Su)return n.DEPTH_COMPONENT;if(o===Cu)return n.DEPTH_STENCIL;if(o===H1)return l=e.get("EXT_sRGB"),l!==null?l.SRGB_ALPHA_EXT:null;if(o===Sp)return n.RED;if(o===L1)return n.RED_INTEGER;if(o===P1)return n.RG;if(o===qy)return n.RG_INTEGER;if(o===Bf)return n.RGBA_INTEGER;if(o===B1||o===k1||o===D1||o===O1)if(c===ji)if(l=e.get("WEBGL_compressed_texture_s3tc_srgb"),l!==null){if(o===B1)return l.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(o===k1)return l.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(o===D1)return l.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(o===O1)return l.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(l=e.get("WEBGL_compressed_texture_s3tc"),l!==null){if(o===B1)return l.COMPRESSED_RGB_S3TC_DXT1_EXT;if(o===k1)return l.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(o===D1)return l.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(o===O1)return l.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(o===eR||o===tR||o===iR||o===nR)if(l=e.get("WEBGL_compressed_texture_pvrtc"),l!==null){if(o===eR)return l.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(o===tR)return l.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(o===iR)return l.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(o===nR)return l.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(o===sR)return l=e.get("WEBGL_compressed_texture_etc1"),l!==null?l.COMPRESSED_RGB_ETC1_WEBGL:null;if(o===rR||o===oR)if(l=e.get("WEBGL_compressed_texture_etc"),l!==null){if(o===rR)return c===ji?l.COMPRESSED_SRGB8_ETC2:l.COMPRESSED_RGB8_ETC2;if(o===oR)return c===ji?l.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:l.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(o===aR||o===lR||o===cR||o===hR||o===uR||o===dR||o===pR||o===mR||o===fR||o===gR||o===yR||o===vR||o===bR||o===AR)if(l=e.get("WEBGL_compressed_texture_astc"),l!==null){if(o===aR)return c===ji?l.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:l.COMPRESSED_RGBA_ASTC_4x4_KHR;if(o===lR)return c===ji?l.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:l.COMPRESSED_RGBA_ASTC_5x4_KHR;if(o===cR)return c===ji?l.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:l.COMPRESSED_RGBA_ASTC_5x5_KHR;if(o===hR)return c===ji?l.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:l.COMPRESSED_RGBA_ASTC_6x5_KHR;if(o===uR)return c===ji?l.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:l.COMPRESSED_RGBA_ASTC_6x6_KHR;if(o===dR)return c===ji?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:l.COMPRESSED_RGBA_ASTC_8x5_KHR;if(o===pR)return c===ji?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:l.COMPRESSED_RGBA_ASTC_8x6_KHR;if(o===mR)return c===ji?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:l.COMPRESSED_RGBA_ASTC_8x8_KHR;if(o===fR)return c===ji?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:l.COMPRESSED_RGBA_ASTC_10x5_KHR;if(o===gR)return c===ji?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:l.COMPRESSED_RGBA_ASTC_10x6_KHR;if(o===yR)return c===ji?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:l.COMPRESSED_RGBA_ASTC_10x8_KHR;if(o===vR)return c===ji?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:l.COMPRESSED_RGBA_ASTC_10x10_KHR;if(o===bR)return c===ji?l.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:l.COMPRESSED_RGBA_ASTC_12x10_KHR;if(o===AR)return c===ji?l.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:l.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(o===G1||o===xR||o===wR)if(l=e.get("EXT_texture_compression_bptc"),l!==null){if(o===G1)return c===ji?l.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:l.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(o===xR)return l.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(o===wR)return l.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(o===oz||o===_R||o===SR||o===CR)if(l=e.get("EXT_texture_compression_rgtc"),l!==null){if(o===G1)return l.COMPRESSED_RED_RGTC1_EXT;if(o===_R)return l.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(o===SR)return l.COMPRESSED_RED_GREEN_RGTC2_EXT;if(o===CR)return l.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return o===lh?s?n.UNSIGNED_INT_24_8:(l=e.get("WEBGL_depth_texture"),l!==null?l.UNSIGNED_INT_24_8_WEBGL:null):n[o]!==void 0?n[o]:null}return{convert:r}}class m2 extends Lt{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}let Vn=class extends ye{constructor(){super(),this.isGroup=!0,this.type="Group"}};const Ree={type:"move"};class f2{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Vn,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Vn,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new E,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new E),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Vn,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new E,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new E),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const i=this._hand;if(i)for(const s of e.hand.values())this._getHandJoint(i,s)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,i,s){let r=null,o=null,a=null;const l=this._targetRay,c=this._grip,h=this._hand;if(e&&i.session.visibilityState!=="visible-blurred"){if(h&&e.hand){a=!0;for(const y of e.hand.values()){const v=i.getJointPose(y,s),b=this._getHandJoint(h,y);v!==null&&(b.matrix.fromArray(v.transform.matrix),b.matrix.decompose(b.position,b.rotation,b.scale),b.matrixWorldNeedsUpdate=!0,b.jointRadius=v.radius),b.visible=v!==null}const u=h.joints["index-finger-tip"],d=h.joints["thumb-tip"],m=u.position.distanceTo(d.position),f=.02,g=.005;h.inputState.pinching&&m>f+g?(h.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!h.inputState.pinching&&m<=f-g&&(h.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else c!==null&&e.gripSpace&&(o=i.getPose(e.gripSpace,s),o!==null&&(c.matrix.fromArray(o.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),c.matrixWorldNeedsUpdate=!0,o.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(o.linearVelocity)):c.hasLinearVelocity=!1,o.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(o.angularVelocity)):c.hasAngularVelocity=!1));l!==null&&(r=i.getPose(e.targetRaySpace,s),r===null&&o!==null&&(r=o),r!==null&&(l.matrix.fromArray(r.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,r.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(r.linearVelocity)):l.hasLinearVelocity=!1,r.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(r.angularVelocity)):l.hasAngularVelocity=!1,this.dispatchEvent(Ree)))}return l!==null&&(l.visible=r!==null),c!==null&&(c.visible=o!==null),h!==null&&(h.visible=a!==null),this}_getHandJoint(e,i){if(e.joints[i.jointName]===void 0){const s=new Vn;s.matrixAutoUpdate=!1,s.visible=!1,e.joints[i.jointName]=s,e.add(s)}return e.joints[i.jointName]}}const Iee=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,Lee=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepthEXT = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepthEXT = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class Pee{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,i,s){if(this.texture===null){const r=new Vt,o=e.properties.get(r);o.__webglTexture=i.texture,(i.depthNear!=s.depthNear||i.depthFar!=s.depthFar)&&(this.depthNear=i.depthNear,this.depthFar=i.depthFar),this.texture=r}}render(e,i){if(this.texture!==null){if(this.mesh===null){const s=i.cameras[0].viewport,r=new kt({extensions:{fragDepth:!0},vertexShader:Iee,fragmentShader:Lee,uniforms:{depthColor:{value:this.texture},depthWidth:{value:s.z},depthHeight:{value:s.w}}});this.mesh=new pe(new ds(20,20),r)}e.render(this.mesh,i)}}reset(){this.texture=null,this.mesh=null}}class Bee extends Rs{constructor(e,i){super();const s=this;let r=null,o=1,a=null,l="local-floor",c=1,h=null,u=null,d=null,m=null,f=null,g=null;const y=new Pee,v=i.getContextAttributes();let b=null,A=null;const x=[],w=[],_=new Y;let S=null;const M=new Lt;M.layers.enable(1),M.viewport=new Ze;const R=new Lt;R.layers.enable(2),R.viewport=new Ze;const P=[M,R],C=new m2;C.layers.enable(1),C.layers.enable(2);let L=null,B=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.controllerAutoUpdate=!0,this.getController=function(re){let we=x[re];return we===void 0&&(we=new f2,x[re]=we),we.getTargetRaySpace()},this.getControllerGrip=function(re){let we=x[re];return we===void 0&&(we=new f2,x[re]=we),we.getGripSpace()},this.getHand=function(re){let we=x[re];return we===void 0&&(we=new f2,x[re]=we),we.getHandSpace()};function z(re){const we=w.indexOf(re.inputSource);if(we===-1)return;const Me=x[we];Me!==void 0&&(Me.update(re.inputSource,re.frame,h||a),Me.dispatchEvent({type:re.type,data:re.inputSource}))}function D(){var re;r.removeEventListener("select",z),r.removeEventListener("selectstart",z),r.removeEventListener("selectend",z),r.removeEventListener("squeeze",z),r.removeEventListener("squeezestart",z),r.removeEventListener("squeezeend",z),r.removeEventListener("end",D),r.removeEventListener("inputsourceschange",W);for(let we=0;we<x.length;we++){const Me=w[we];Me!==null&&(w[we]=null,(re=x[we])==null||re.disconnect(Me))}L=null,B=null,y.reset(),e.setRenderTarget(b),f=null,m=null,d=null,r=null,A=null,ke.stop(),s.isPresenting=!1,e.setPixelRatio(S),e.setSize(_.width,_.height,!1),s.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(re){o=re,s.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(re){l=re,s.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return h||a},this.setReferenceSpace=function(re){h=re},this.getBaseLayer=function(){return m!==null?m:f},this.getBinding=function(){return d},this.getFrame=function(){return g},this.getSession=function(){return r},this.setSession=async function(re){if(r=re,r!==null){if(b=e.getRenderTarget(),r.addEventListener("select",z),r.addEventListener("selectstart",z),r.addEventListener("selectend",z),r.addEventListener("squeeze",z),r.addEventListener("squeezestart",z),r.addEventListener("squeezeend",z),r.addEventListener("end",D),r.addEventListener("inputsourceschange",W),v.xrCompatible!==!0&&await i.makeXRCompatible(),S=e.getPixelRatio(),e.getSize(_),r.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const we={antialias:r.renderState.layers===void 0?v.antialias:!0,alpha:!0,depth:v.depth,stencil:v.stencil,framebufferScaleFactor:o};f=new XRWebGLLayer(r,i,we),r.updateRenderState({baseLayer:f}),e.setPixelRatio(1),e.setSize(f.framebufferWidth,f.framebufferHeight,!1),A=new Zt(f.framebufferWidth,f.framebufferHeight,{format:_i,type:pn,colorSpace:e.outputColorSpace,stencilBuffer:v.stencil})}else{let we=null,Me=null,it=null;v.depth&&(it=v.stencil?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24,we=v.stencil?Cu:Su,Me=v.stencil?lh:_r);const je={colorFormat:i.RGBA8,depthFormat:it,scaleFactor:o};d=new XRWebGLBinding(r,i),m=d.createProjectionLayer(je),r.updateRenderState({layers:[m]}),e.setPixelRatio(1),e.setSize(m.textureWidth,m.textureHeight,!1),A=new Zt(m.textureWidth,m.textureHeight,{format:_i,type:pn,depthTexture:new tg(m.textureWidth,m.textureHeight,Me,void 0,void 0,void 0,void 0,void 0,void 0,we),stencilBuffer:v.stencil,colorSpace:e.outputColorSpace,samples:v.antialias?4:0});const Ge=e.properties.get(A);Ge.__ignoreDepthValues=m.ignoreDepthValues}A.isXRRenderTarget=!0,this.setFoveation(c),h=null,a=await r.requestReferenceSpace(l),ke.setContext(r),ke.start(),s.isPresenting=!0,s.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(r!==null)return r.environmentBlendMode};function W(re){var we;for(let Me=0;Me<re.removed.length;Me++){const it=re.removed[Me],je=w.indexOf(it);je>=0&&(w[je]=null,(we=x[je])==null||we.disconnect(it))}for(let Me=0;Me<re.added.length;Me++){const it=re.added[Me];let je=w.indexOf(it);if(je===-1){for(let rt=0;rt<x.length;rt++)if(rt>=w.length){w.push(it),je=rt;break}else if(w[rt]===null){w[rt]=it,je=rt;break}if(je===-1)break}const Ge=x[je];Ge&&Ge.connect(it)}}const O=new E,F=new E;function X(re,we,Me){O.setFromMatrixPosition(we.matrixWorld),F.setFromMatrixPosition(Me.matrixWorld);const it=O.distanceTo(F),je=we.projectionMatrix.elements,Ge=Me.projectionMatrix.elements,rt=je[14]/(je[10]-1),ge=je[14]/(je[10]+1),Q=(je[9]+1)/je[5],Ne=(je[9]-1)/je[5],Re=(je[8]-1)/je[0],Te=(Ge[8]+1)/Ge[0],We=rt*Re,be=rt*Te,nt=it/(-Re+Te),ct=nt*-Re;we.matrixWorld.decompose(re.position,re.quaternion,re.scale),re.translateX(ct),re.translateZ(nt),re.matrixWorld.compose(re.position,re.quaternion,re.scale),re.matrixWorldInverse.copy(re.matrixWorld).invert();const It=rt+nt,H=ge+nt,G=We-ct,ue=be+(it-ct),Ee=Q*ge/H*It,De=Ne*ge/H*It;re.projectionMatrix.makePerspective(G,ue,Ee,De,It,H),re.projectionMatrixInverse.copy(re.projectionMatrix).invert()}function J(re,we){we===null?re.matrixWorld.copy(re.matrix):re.matrixWorld.multiplyMatrices(we.matrixWorld,re.matrix),re.matrixWorldInverse.copy(re.matrixWorld).invert()}this.updateCamera=function(re){if(r===null)return;y.texture!==null&&(y.depthNear>0&&(re.near=y.depthNear),y.depthFar>0&&(re.far=y.depthFar)),C.near=R.near=M.near=re.near,C.far=R.far=M.far=re.far,(L!==C.near||B!==C.far)&&(r.updateRenderState({depthNear:C.near,depthFar:C.far}),L=C.near,B=C.far,M.near=L,M.far=B,R.near=L,R.far=B,M.updateProjectionMatrix(),R.updateProjectionMatrix(),re.updateProjectionMatrix());const we=re.parent,Me=C.cameras;J(C,we);for(let it=0;it<Me.length;it++)J(Me[it],we);Me.length===2?X(C,M,R):C.projectionMatrix.copy(M.projectionMatrix),q(re,C,we)};function q(re,we,Me){Me===null?re.matrix.copy(we.matrixWorld):(re.matrix.copy(Me.matrixWorld),re.matrix.invert(),re.matrix.multiply(we.matrixWorld)),re.matrix.decompose(re.position,re.quaternion,re.scale),re.updateMatrixWorld(!0),re.projectionMatrix.copy(we.projectionMatrix),re.projectionMatrixInverse.copy(we.projectionMatrixInverse),re.isPerspectiveCamera&&(re.fov=kf*2*Math.atan(1/re.projectionMatrix.elements[5]),re.zoom=1)}this.getCamera=function(){return C},this.getFoveation=function(){if(!(m===null&&f===null))return c},this.setFoveation=function(re){c=re,m!==null&&(m.fixedFoveation=re),f!==null&&f.fixedFoveation!==void 0&&(f.fixedFoveation=re)},this.hasDepthSensing=function(){return y.texture!==null};let oe=null;function _e(re,we){if(u=we.getViewerPose(h||a),g=we,u!==null){const Me=u.views;f!==null&&(e.setRenderTargetFramebuffer(A,f.framebuffer),e.setRenderTarget(A));let it=!1;Me.length!==C.cameras.length&&(C.cameras.length=0,it=!0);for(let Ge=0;Ge<Me.length;Ge++){const rt=Me[Ge];let ge=null;if(f!==null)ge=f.getViewport(rt);else{const Ne=d.getViewSubImage(m,rt);ge=Ne.viewport,Ge===0&&(e.setRenderTargetTextures(A,Ne.colorTexture,m.ignoreDepthValues?void 0:Ne.depthStencilTexture),e.setRenderTarget(A))}let Q=P[Ge];Q===void 0&&(Q=new Lt,Q.layers.enable(Ge),Q.viewport=new Ze,P[Ge]=Q),Q.matrix.fromArray(rt.transform.matrix),Q.matrix.decompose(Q.position,Q.quaternion,Q.scale),Q.projectionMatrix.fromArray(rt.projectionMatrix),Q.projectionMatrixInverse.copy(Q.projectionMatrix).invert(),Q.viewport.set(ge.x,ge.y,ge.width,ge.height),Ge===0&&(C.matrix.copy(Q.matrix),C.matrix.decompose(C.position,C.quaternion,C.scale)),it===!0&&C.cameras.push(Q)}const je=r.enabledFeatures;if(je&&je.includes("depth-sensing")){const Ge=d.getDepthInformation(Me[0]);Ge&&Ge.isValid&&Ge.texture&&y.init(e,Ge,r.renderState)}}if(s.controllerAutoUpdate)for(let Me=0;Me<x.length;Me++){const it=w[Me],je=x[Me];it!==null&&je!==void 0&&je.update(it,we,h||a)}y.render(e,C),oe&&oe(re,we),we.detectedPlanes&&s.dispatchEvent({type:"planesdetected",data:we}),g=null}const ke=new iF;ke.setAnimationLoop(_e),this.setAnimationLoop=function(re){oe=re},this.dispose=function(){}}}const Gp=new si,kee=new he;function Dee(n,e){function i(v,b){v.matrixAutoUpdate===!0&&v.updateMatrix(),b.value.copy(v.matrix)}function s(v,b){b.color.getRGB(v.fogColor.value,$z(n)),b.isFog?(v.fogNear.value=b.near,v.fogFar.value=b.far):b.isFogExp2&&(v.fogDensity.value=b.density)}function r(v,b,A,x,w){b.isMeshBasicMaterial||b.isMeshLambertMaterial?o(v,b):b.isMeshToonMaterial?(o(v,b),d(v,b)):b.isMeshPhongMaterial?(o(v,b),u(v,b)):b.isMeshStandardMaterial?(o(v,b),m(v,b),b.isMeshPhysicalMaterial&&f(v,b,w)):b.isMeshMatcapMaterial?(o(v,b),g(v,b)):b.isMeshDepthMaterial?o(v,b):b.isMeshDistanceMaterial?(o(v,b),y(v,b)):b.isMeshNormalMaterial?o(v,b):b.isLineBasicMaterial?(a(v,b),b.isLineDashedMaterial&&l(v,b)):b.isPointsMaterial?c(v,b,A,x):b.isSpriteMaterial?h(v,b):b.isShadowMaterial?(v.color.value.copy(b.color),v.opacity.value=b.opacity):b.isShaderMaterial&&(b.uniformsNeedUpdate=!1)}function o(v,b){v.opacity.value=b.opacity,b.color&&v.diffuse.value.copy(b.color),b.emissive&&v.emissive.value.copy(b.emissive).multiplyScalar(b.emissiveIntensity),b.map&&(v.map.value=b.map,i(b.map,v.mapTransform)),b.alphaMap&&(v.alphaMap.value=b.alphaMap,i(b.alphaMap,v.alphaMapTransform)),b.bumpMap&&(v.bumpMap.value=b.bumpMap,i(b.bumpMap,v.bumpMapTransform),v.bumpScale.value=b.bumpScale,b.side===un&&(v.bumpScale.value*=-1)),b.normalMap&&(v.normalMap.value=b.normalMap,i(b.normalMap,v.normalMapTransform),v.normalScale.value.copy(b.normalScale),b.side===un&&v.normalScale.value.negate()),b.displacementMap&&(v.displacementMap.value=b.displacementMap,i(b.displacementMap,v.displacementMapTransform),v.displacementScale.value=b.displacementScale,v.displacementBias.value=b.displacementBias),b.emissiveMap&&(v.emissiveMap.value=b.emissiveMap,i(b.emissiveMap,v.emissiveMapTransform)),b.specularMap&&(v.specularMap.value=b.specularMap,i(b.specularMap,v.specularMapTransform)),b.alphaTest>0&&(v.alphaTest.value=b.alphaTest);const A=e.get(b),x=A.envMap,w=A.envMapRotation;if(x&&(v.envMap.value=x,Gp.copy(w),Gp.x*=-1,Gp.y*=-1,Gp.z*=-1,x.isCubeTexture&&x.isRenderTargetTexture===!1&&(Gp.y*=-1,Gp.z*=-1),v.envMapRotation.value.setFromMatrix4(kee.makeRotationFromEuler(Gp)),v.flipEnvMap.value=x.isCubeTexture&&x.isRenderTargetTexture===!1?-1:1,v.reflectivity.value=b.reflectivity,v.ior.value=b.ior,v.refractionRatio.value=b.refractionRatio),b.lightMap){v.lightMap.value=b.lightMap;const _=n._useLegacyLights===!0?Math.PI:1;v.lightMapIntensity.value=b.lightMapIntensity*_,i(b.lightMap,v.lightMapTransform)}b.aoMap&&(v.aoMap.value=b.aoMap,v.aoMapIntensity.value=b.aoMapIntensity,i(b.aoMap,v.aoMapTransform))}function a(v,b){v.diffuse.value.copy(b.color),v.opacity.value=b.opacity,b.map&&(v.map.value=b.map,i(b.map,v.mapTransform))}function l(v,b){v.dashSize.value=b.dashSize,v.totalSize.value=b.dashSize+b.gapSize,v.scale.value=b.scale}function c(v,b,A,x){v.diffuse.value.copy(b.color),v.opacity.value=b.opacity,v.size.value=b.size*A,v.scale.value=x*.5,b.map&&(v.map.value=b.map,i(b.map,v.uvTransform)),b.alphaMap&&(v.alphaMap.value=b.alphaMap,i(b.alphaMap,v.alphaMapTransform)),b.alphaTest>0&&(v.alphaTest.value=b.alphaTest)}function h(v,b){v.diffuse.value.copy(b.color),v.opacity.value=b.opacity,v.rotation.value=b.rotation,b.map&&(v.map.value=b.map,i(b.map,v.mapTransform)),b.alphaMap&&(v.alphaMap.value=b.alphaMap,i(b.alphaMap,v.alphaMapTransform)),b.alphaTest>0&&(v.alphaTest.value=b.alphaTest)}function u(v,b){v.specular.value.copy(b.specular),v.shininess.value=Math.max(b.shininess,1e-4)}function d(v,b){b.gradientMap&&(v.gradientMap.value=b.gradientMap)}function m(v,b){v.metalness.value=b.metalness,b.metalnessMap&&(v.metalnessMap.value=b.metalnessMap,i(b.metalnessMap,v.metalnessMapTransform)),v.roughness.value=b.roughness,b.roughnessMap&&(v.roughnessMap.value=b.roughnessMap,i(b.roughnessMap,v.roughnessMapTransform)),e.get(b).envMap&&(v.envMapIntensity.value=b.envMapIntensity)}function f(v,b,A){v.ior.value=b.ior,b.sheen>0&&(v.sheenColor.value.copy(b.sheenColor).multiplyScalar(b.sheen),v.sheenRoughness.value=b.sheenRoughness,b.sheenColorMap&&(v.sheenColorMap.value=b.sheenColorMap,i(b.sheenColorMap,v.sheenColorMapTransform)),b.sheenRoughnessMap&&(v.sheenRoughnessMap.value=b.sheenRoughnessMap,i(b.sheenRoughnessMap,v.sheenRoughnessMapTransform))),b.clearcoat>0&&(v.clearcoat.value=b.clearcoat,v.clearcoatRoughness.value=b.clearcoatRoughness,b.clearcoatMap&&(v.clearcoatMap.value=b.clearcoatMap,i(b.clearcoatMap,v.clearcoatMapTransform)),b.clearcoatRoughnessMap&&(v.clearcoatRoughnessMap.value=b.clearcoatRoughnessMap,i(b.clearcoatRoughnessMap,v.clearcoatRoughnessMapTransform)),b.clearcoatNormalMap&&(v.clearcoatNormalMap.value=b.clearcoatNormalMap,i(b.clearcoatNormalMap,v.clearcoatNormalMapTransform),v.clearcoatNormalScale.value.copy(b.clearcoatNormalScale),b.side===un&&v.clearcoatNormalScale.value.negate())),b.iridescence>0&&(v.iridescence.value=b.iridescence,v.iridescenceIOR.value=b.iridescenceIOR,v.iridescenceThicknessMinimum.value=b.iridescenceThicknessRange[0],v.iridescenceThicknessMaximum.value=b.iridescenceThicknessRange[1],b.iridescenceMap&&(v.iridescenceMap.value=b.iridescenceMap,i(b.iridescenceMap,v.iridescenceMapTransform)),b.iridescenceThicknessMap&&(v.iridescenceThicknessMap.value=b.iridescenceThicknessMap,i(b.iridescenceThicknessMap,v.iridescenceThicknessMapTransform))),b.transmission>0&&(v.transmission.value=b.transmission,v.transmissionSamplerMap.value=A.texture,v.transmissionSamplerSize.value.set(A.width,A.height),b.transmissionMap&&(v.transmissionMap.value=b.transmissionMap,i(b.transmissionMap,v.transmissionMapTransform)),v.thickness.value=b.thickness,b.thicknessMap&&(v.thicknessMap.value=b.thicknessMap,i(b.thicknessMap,v.thicknessMapTransform)),v.attenuationDistance.value=b.attenuationDistance,v.attenuationColor.value.copy(b.attenuationColor)),b.anisotropy>0&&(v.anisotropyVector.value.set(b.anisotropy*Math.cos(b.anisotropyRotation),b.anisotropy*Math.sin(b.anisotropyRotation)),b.anisotropyMap&&(v.anisotropyMap.value=b.anisotropyMap,i(b.anisotropyMap,v.anisotropyMapTransform))),v.specularIntensity.value=b.specularIntensity,v.specularColor.value.copy(b.specularColor),b.specularColorMap&&(v.specularColorMap.value=b.specularColorMap,i(b.specularColorMap,v.specularColorMapTransform)),b.specularIntensityMap&&(v.specularIntensityMap.value=b.specularIntensityMap,i(b.specularIntensityMap,v.specularIntensityMapTransform))}function g(v,b){b.matcap&&(v.matcap.value=b.matcap)}function y(v,b){const A=e.get(b).light;v.referencePosition.value.setFromMatrixPosition(A.matrixWorld),v.nearDistance.value=A.shadow.camera.near,v.farDistance.value=A.shadow.camera.far}return{refreshFogUniforms:s,refreshMaterialUniforms:r}}function Oee(n,e,i,s){let r={},o={},a=[];const l=i.isWebGL2?n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS):0;function c(A,x){const w=x.program;s.uniformBlockBinding(A,w)}function h(A,x){let w=r[A.id];w===void 0&&(g(A),w=u(A),r[A.id]=w,A.addEventListener("dispose",v));const _=x.program;s.updateUBOMapping(A,_);const S=e.render.frame;o[A.id]!==S&&(m(A),o[A.id]=S)}function u(A){const x=d();A.__bindingPointIndex=x;const w=n.createBuffer(),_=A.__size,S=A.usage;return n.bindBuffer(n.UNIFORM_BUFFER,w),n.bufferData(n.UNIFORM_BUFFER,_,S),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,x,w),w}function d(){for(let A=0;A<l;A++)if(a.indexOf(A)===-1)return a.push(A),A;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function m(A){const x=r[A.id],w=A.uniforms,_=A.__cache;n.bindBuffer(n.UNIFORM_BUFFER,x);for(let S=0,M=w.length;S<M;S++){const R=Array.isArray(w[S])?w[S]:[w[S]];for(let P=0,C=R.length;P<C;P++){const L=R[P];if(f(L,S,P,_)===!0){const B=L.__offset,z=Array.isArray(L.value)?L.value:[L.value];let D=0;for(let W=0;W<z.length;W++){const O=z[W],F=y(O);typeof O=="number"||typeof O=="boolean"?(L.__data[0]=O,n.bufferSubData(n.UNIFORM_BUFFER,B+D,L.__data)):O.isMatrix3?(L.__data[0]=O.elements[0],L.__data[1]=O.elements[1],L.__data[2]=O.elements[2],L.__data[3]=0,L.__data[4]=O.elements[3],L.__data[5]=O.elements[4],L.__data[6]=O.elements[5],L.__data[7]=0,L.__data[8]=O.elements[6],L.__data[9]=O.elements[7],L.__data[10]=O.elements[8],L.__data[11]=0):(O.toArray(L.__data,D),D+=F.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,B,L.__data)}}}n.bindBuffer(n.UNIFORM_BUFFER,null)}function f(A,x,w,_){const S=A.value,M=x+"_"+w;if(_[M]===void 0)return typeof S=="number"||typeof S=="boolean"?_[M]=S:_[M]=S.clone(),!0;{const R=_[M];if(typeof S=="number"||typeof S=="boolean"){if(R!==S)return _[M]=S,!0}else if(R.equals(S)===!1)return R.copy(S),!0}return!1}function g(A){const x=A.uniforms;let w=0;const _=16;for(let M=0,R=x.length;M<R;M++){const P=Array.isArray(x[M])?x[M]:[x[M]];for(let C=0,L=P.length;C<L;C++){const B=P[C],z=Array.isArray(B.value)?B.value:[B.value];for(let D=0,W=z.length;D<W;D++){const O=z[D],F=y(O),X=w%_;X!==0&&_-X<F.boundary&&(w+=_-X),B.__data=new Float32Array(F.storage/Float32Array.BYTES_PER_ELEMENT),B.__offset=w,w+=F.storage}}}const S=w%_;return S>0&&(w+=_-S),A.__size=w,A.__cache={},this}function y(A){const x={boundary:0,storage:0};return typeof A=="number"||typeof A=="boolean"?(x.boundary=4,x.storage=4):A.isVector2?(x.boundary=8,x.storage=8):A.isVector3||A.isColor?(x.boundary=16,x.storage=12):A.isVector4?(x.boundary=16,x.storage=16):A.isMatrix3?(x.boundary=48,x.storage=48):A.isMatrix4?(x.boundary=64,x.storage=64):A.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",A),x}function v(A){const x=A.target;x.removeEventListener("dispose",v);const w=a.indexOf(x.__bindingPointIndex);a.splice(w,1),n.deleteBuffer(r[x.id]),delete r[x.id],delete o[x.id]}function b(){for(const A in r)n.deleteBuffer(r[A]);a=[],r={},o={}}return{bind:c,update:h,dispose:b}}class gh{constructor(e={}){const{canvas:i=Bz(),context:s=null,depth:r=!0,stencil:o=!0,alpha:a=!1,antialias:l=!1,premultipliedAlpha:c=!0,preserveDrawingBuffer:h=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:d=!1}=e;this.isWebGLRenderer=!0;let m;s!==null?m=s.getContextAttributes().alpha:m=a;const f=new Uint32Array(4),g=new Int32Array(4);let y=null,v=null;const b=[],A=[];this.domElement=i,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=vt,this._useLegacyLights=!1,this.toneMapping=Yr,this.toneMappingExposure=1;const x=this;let w=!1,_=0,S=0,M=null,R=-1,P=null;const C=new Ze,L=new Ze;let B=null;const z=new Ae(0);let D=0,W=i.width,O=i.height,F=1,X=null,J=null;const q=new Ze(0,0,W,O),oe=new Ze(0,0,W,O);let _e=!1;const ke=new Bp;let re=!1,we=!1,Me=null;const it=new he,je=new Y,Ge=new E,rt={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function ge(){return M===null?F:1}let Q=s;function Ne(N,ne){for(let fe=0;fe<N.length;fe++){const ve=N[fe],le=i.getContext(ve,ne);if(le!==null)return le}return null}try{const N={alpha:!0,depth:r,stencil:o,antialias:l,premultipliedAlpha:c,preserveDrawingBuffer:h,powerPreference:u,failIfMajorPerformanceCaveat:d};if("setAttribute"in i&&i.setAttribute("data-engine",`three.js r${sh}`),i.addEventListener("webglcontextlost",ee,!1),i.addEventListener("webglcontextrestored",U,!1),i.addEventListener("webglcontextcreationerror",K,!1),Q===null){const ne=["webgl2","webgl","experimental-webgl"];if(x.isWebGL1Renderer===!0&&ne.shift(),Q=Ne(ne,N),Q===null)throw Ne(ne)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}typeof WebGLRenderingContext<"u"&&Q instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),Q.getShaderPrecisionFormat===void 0&&(Q.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(N){throw console.error("THREE.WebGLRenderer: "+N.message),N}let Re,Te,We,be,nt,ct,It,H,G,ue,Ee,De,Le,At,ht,Ue,Xe,Ct,ze,qt,Oe,_t,ut,I;function k(){Re=new jq(Q),Te=new Uq(Q,Re,e),Re.init(Te),_t=new IF(Q,Re,Te),We=new Eee(Q,Re,Te),be=new Yq(Q),nt=new fee,ct=new Tee(Q,Re,We,nt,Te,_t,be),It=new Xq(x),H=new Hq(x),G=new iJ(Q,Te),ut=new Fq(Q,Re,G,Te),ue=new Qq(Q,G,be,ut),Ee=new $q(Q,ue,G,be),ze=new qq(Q,Te,ct),Ue=new Vq(nt),De=new mee(x,It,H,Re,Te,ut,Ue),Le=new Dee(x,nt),At=new yee,ht=new _ee(Re,Te),Ct=new zq(x,It,H,We,Ee,m,c),Xe=new Mee(x,Ee,Te),I=new Oee(Q,be,Te,We),qt=new Nq(Q,Re,be,Te),Oe=new Zq(Q,Re,be,Te),be.programs=De.programs,x.capabilities=Te,x.extensions=Re,x.properties=nt,x.renderLists=At,x.shadowMap=Xe,x.state=We,x.info=be}k();const V=new Bee(x,Q);this.xr=V,this.getContext=function(){return Q},this.getContextAttributes=function(){return Q.getContextAttributes()},this.forceContextLoss=function(){const N=Re.get("WEBGL_lose_context");N&&N.loseContext()},this.forceContextRestore=function(){const N=Re.get("WEBGL_lose_context");N&&N.restoreContext()},this.getPixelRatio=function(){return F},this.setPixelRatio=function(N){N!==void 0&&(F=N,this.setSize(W,O,!1))},this.getSize=function(N){return N.set(W,O)},this.setSize=function(N,ne,fe=!0){if(V.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}W=N,O=ne,i.width=Math.floor(N*F),i.height=Math.floor(ne*F),fe===!0&&(i.style.width=N+"px",i.style.height=ne+"px"),this.setViewport(0,0,N,ne)},this.getDrawingBufferSize=function(N){return N.set(W*F,O*F).floor()},this.setDrawingBufferSize=function(N,ne,fe){W=N,O=ne,F=fe,i.width=Math.floor(N*fe),i.height=Math.floor(ne*fe),this.setViewport(0,0,N,ne)},this.getCurrentViewport=function(N){return N.copy(C)},this.getViewport=function(N){return N.copy(q)},this.setViewport=function(N,ne,fe,ve){N.isVector4?q.set(N.x,N.y,N.z,N.w):q.set(N,ne,fe,ve),We.viewport(C.copy(q).multiplyScalar(F).round())},this.getScissor=function(N){return N.copy(oe)},this.setScissor=function(N,ne,fe,ve){N.isVector4?oe.set(N.x,N.y,N.z,N.w):oe.set(N,ne,fe,ve),We.scissor(L.copy(oe).multiplyScalar(F).round())},this.getScissorTest=function(){return _e},this.setScissorTest=function(N){We.setScissorTest(_e=N)},this.setOpaqueSort=function(N){X=N},this.setTransparentSort=function(N){J=N},this.getClearColor=function(N){return N.copy(Ct.getClearColor())},this.setClearColor=function(){Ct.setClearColor.apply(Ct,arguments)},this.getClearAlpha=function(){return Ct.getClearAlpha()},this.setClearAlpha=function(){Ct.setClearAlpha.apply(Ct,arguments)},this.clear=function(N=!0,ne=!0,fe=!0){let ve=0;if(N){let le=!1;if(M!==null){const et=M.texture.format;le=et===Bf||et===qy||et===L1}if(le){const et=M.texture.type,Bt=et===pn||et===_r||et===Jy||et===lh||et===qT||et===$T,Ut=Ct.getClearColor(),jt=Ct.getClearAlpha(),pi=Ut.r,ii=Ut.g,ni=Ut.b;Bt?(f[0]=pi,f[1]=ii,f[2]=ni,f[3]=jt,Q.clearBufferuiv(Q.COLOR,0,f)):(g[0]=pi,g[1]=ii,g[2]=ni,g[3]=jt,Q.clearBufferiv(Q.COLOR,0,g))}else ve|=Q.COLOR_BUFFER_BIT}ne&&(ve|=Q.DEPTH_BUFFER_BIT),fe&&(ve|=Q.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),Q.clear(ve)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){i.removeEventListener("webglcontextlost",ee,!1),i.removeEventListener("webglcontextrestored",U,!1),i.removeEventListener("webglcontextcreationerror",K,!1),At.dispose(),ht.dispose(),nt.dispose(),It.dispose(),H.dispose(),Ee.dispose(),ut.dispose(),I.dispose(),De.dispose(),V.dispose(),V.removeEventListener("sessionstart",Qe),V.removeEventListener("sessionend",$e),Me&&(Me.dispose(),Me=null),bt.stop()};function ee(N){N.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),w=!0}function U(){console.log("THREE.WebGLRenderer: Context Restored."),w=!1;const N=be.autoReset,ne=Xe.enabled,fe=Xe.autoUpdate,ve=Xe.needsUpdate,le=Xe.type;k(),be.autoReset=N,Xe.enabled=ne,Xe.autoUpdate=fe,Xe.needsUpdate=ve,Xe.type=le}function K(N){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",N.statusMessage)}function j(N){const ne=N.target;ne.removeEventListener("dispose",j),ae(ne)}function ae(N){ce(N),nt.remove(N)}function ce(N){const ne=nt.get(N).programs;ne!==void 0&&(ne.forEach(function(fe){De.releaseProgram(fe)}),N.isShaderMaterial&&De.releaseShaderCache(N))}this.renderBufferDirect=function(N,ne,fe,ve,le,et){ne===null&&(ne=rt);const Bt=le.isMesh&&le.matrixWorld.determinant()<0,Ut=Fn(N,ne,fe,ve,le);We.setMaterial(ve,Bt);let jt=fe.index,pi=1;if(ve.wireframe===!0){if(jt=ue.getWireframeAttribute(fe),jt===void 0)return;pi=2}const ii=fe.drawRange,ni=fe.attributes.position;let xr=ii.start*pi,ps=(ii.start+ii.count)*pi;et!==null&&(xr=Math.max(xr,et.start*pi),ps=Math.min(ps,(et.start+et.count)*pi)),jt!==null?(xr=Math.max(xr,0),ps=Math.min(ps,jt.count)):ni!=null&&(xr=Math.max(xr,0),ps=Math.min(ps,ni.count));const Ca=ps-xr;if(Ca<0||Ca===1/0)return;ut.setup(le,ve,Ut,fe,jt);let nh,Nn=qt;if(jt!==null&&(nh=G.get(jt),Nn=Oe,Nn.setIndex(nh)),le.isMesh)ve.wireframe===!0?(We.setLineWidth(ve.wireframeLinewidth*ge()),Nn.setMode(Q.LINES)):Nn.setMode(Q.TRIANGLES);else if(le.isLine){let $t=ve.linewidth;$t===void 0&&($t=1),We.setLineWidth($t*ge()),le.isLineSegments?Nn.setMode(Q.LINES):le.isLineLoop?Nn.setMode(Q.LINE_LOOP):Nn.setMode(Q.LINE_STRIP)}else le.isPoints?Nn.setMode(Q.POINTS):le.isSprite&&Nn.setMode(Q.TRIANGLES);if(le.isBatchedMesh)Nn.renderMultiDraw(le._multiDrawStarts,le._multiDrawCounts,le._multiDrawCount);else if(le.isInstancedMesh)Nn.renderInstances(xr,Ca,le.count);else if(fe.isInstancedBufferGeometry){const $t=fe._maxInstanceCount!==void 0?fe._maxInstanceCount:1/0,OT=Math.min(fe.instanceCount,$t);Nn.renderInstances(xr,Ca,OT)}else Nn.render(xr,Ca)};function xe(N,ne,fe){N.transparent===!0&&N.side===xi&&N.forceSinglePass===!1?(N.side=un,N.needsUpdate=!0,Ts(N,ne,fe),N.side=Un,N.needsUpdate=!0,Ts(N,ne,fe),N.side=xi):Ts(N,ne,fe)}this.compile=function(N,ne,fe=null){fe===null&&(fe=N),v=ht.get(fe),v.init(),A.push(v),fe.traverseVisible(function(le){le.isLight&&le.layers.test(ne.layers)&&(v.pushLight(le),le.castShadow&&v.pushShadow(le))}),N!==fe&&N.traverseVisible(function(le){le.isLight&&le.layers.test(ne.layers)&&(v.pushLight(le),le.castShadow&&v.pushShadow(le))}),v.setupLights(x._useLegacyLights);const ve=new Set;return N.traverse(function(le){const et=le.material;if(et)if(Array.isArray(et))for(let Bt=0;Bt<et.length;Bt++){const Ut=et[Bt];xe(Ut,fe,le),ve.add(Ut)}else xe(et,fe,le),ve.add(et)}),A.pop(),v=null,ve},this.compileAsync=function(N,ne,fe=null){const ve=this.compile(N,ne,fe);return new Promise(le=>{function et(){if(ve.forEach(function(Bt){nt.get(Bt).currentProgram.isReady()&&ve.delete(Bt)}),ve.size===0){le(N);return}setTimeout(et,10)}Re.get("KHR_parallel_shader_compile")!==null?et():setTimeout(et,10)})};let Ie=null;function Ke(N){Ie&&Ie(N)}function Qe(){bt.stop()}function $e(){bt.start()}const bt=new iF;bt.setAnimationLoop(Ke),typeof self<"u"&&bt.setContext(self),this.setAnimationLoop=function(N){Ie=N,V.setAnimationLoop(N),N===null?bt.stop():bt.start()},V.addEventListener("sessionstart",Qe),V.addEventListener("sessionend",$e),this.render=function(N,ne){if(ne!==void 0&&ne.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(w===!0)return;N.matrixWorldAutoUpdate===!0&&N.updateMatrixWorld(),ne.parent===null&&ne.matrixWorldAutoUpdate===!0&&ne.updateMatrixWorld(),V.enabled===!0&&V.isPresenting===!0&&(V.cameraAutoUpdate===!0&&V.updateCamera(ne),ne=V.getCamera()),N.isScene===!0&&N.onBeforeRender(x,N,ne,M),v=ht.get(N,A.length),v.init(),A.push(v),it.multiplyMatrices(ne.projectionMatrix,ne.matrixWorldInverse),ke.setFromProjectionMatrix(it),we=this.localClippingEnabled,re=Ue.init(this.clippingPlanes,we),y=At.get(N,b.length),y.init(),b.push(y),ot(N,ne,0,x.sortObjects),y.finish(),x.sortObjects===!0&&y.sort(X,J),this.info.render.frame++,re===!0&&Ue.beginShadows();const fe=v.state.shadowsArray;if(Xe.render(fe,N,ne),re===!0&&Ue.endShadows(),this.info.autoReset===!0&&this.info.reset(),(V.enabled===!1||V.isPresenting===!1||V.hasDepthSensing()===!1)&&Ct.render(y,N),v.setupLights(x._useLegacyLights),ne.isArrayCamera){const ve=ne.cameras;for(let le=0,et=ve.length;le<et;le++){const Bt=ve[le];St(y,N,Bt,Bt.viewport)}}else St(y,N,ne);M!==null&&(ct.updateMultisampleRenderTarget(M),ct.updateRenderTargetMipmap(M)),N.isScene===!0&&N.onAfterRender(x,N,ne),ut.resetDefaultState(),R=-1,P=null,A.pop(),A.length>0?v=A[A.length-1]:v=null,b.pop(),b.length>0?y=b[b.length-1]:y=null};function ot(N,ne,fe,ve){if(N.visible===!1)return;if(N.layers.test(ne.layers)){if(N.isGroup)fe=N.renderOrder;else if(N.isLOD)N.autoUpdate===!0&&N.update(ne);else if(N.isLight)v.pushLight(N),N.castShadow&&v.pushShadow(N);else if(N.isSprite){if(!N.frustumCulled||ke.intersectsSprite(N)){ve&&Ge.setFromMatrixPosition(N.matrixWorld).applyMatrix4(it);const et=Ee.update(N),Bt=N.material;Bt.visible&&y.push(N,et,Bt,fe,Ge.z,null)}}else if((N.isMesh||N.isLine||N.isPoints)&&(!N.frustumCulled||ke.intersectsObject(N))){const et=Ee.update(N),Bt=N.material;if(ve&&(N.boundingSphere!==void 0?(N.boundingSphere===null&&N.computeBoundingSphere(),Ge.copy(N.boundingSphere.center)):(et.boundingSphere===null&&et.computeBoundingSphere(),Ge.copy(et.boundingSphere.center)),Ge.applyMatrix4(N.matrixWorld).applyMatrix4(it)),Array.isArray(Bt)){const Ut=et.groups;for(let jt=0,pi=Ut.length;jt<pi;jt++){const ii=Ut[jt],ni=Bt[ii.materialIndex];ni&&ni.visible&&y.push(N,et,ni,fe,Ge.z,ii)}}else Bt.visible&&y.push(N,et,Bt,fe,Ge.z,null)}}const le=N.children;for(let et=0,Bt=le.length;et<Bt;et++)ot(le[et],ne,fe,ve)}function St(N,ne,fe,ve){const le=N.opaque,et=N.transmissive,Bt=N.transparent;v.setupLightsView(fe),re===!0&&Ue.setGlobalState(x.clippingPlanes,fe),et.length>0&&ti(le,et,ne,fe),ve&&We.viewport(C.copy(ve)),le.length>0&&Ui(le,ne,fe),et.length>0&&Ui(et,ne,fe),Bt.length>0&&Ui(Bt,ne,fe),We.buffers.depth.setTest(!0),We.buffers.depth.setMask(!0),We.buffers.color.setMask(!0),We.setPolygonOffset(!1)}function ti(N,ne,fe,ve){if((fe.isScene===!0?fe.overrideMaterial:null)!==null)return;const le=Te.isWebGL2;Me===null&&(Me=new Zt(1,1,{generateMipmaps:!0,type:Re.has("EXT_color_buffer_half_float")?ms:pn,minFilter:So,samples:le?4:0})),x.getDrawingBufferSize(je),le?Me.setSize(je.x,je.y):Me.setSize(j1(je.x),j1(je.y));const et=x.getRenderTarget();x.setRenderTarget(Me),x.getClearColor(z),D=x.getClearAlpha(),D<1&&x.setClearColor(16777215,.5),x.clear();const Bt=x.toneMapping;x.toneMapping=Yr,Ui(N,fe,ve),ct.updateMultisampleRenderTarget(Me),ct.updateRenderTargetMipmap(Me);let Ut=!1;for(let jt=0,pi=ne.length;jt<pi;jt++){const ii=ne[jt],ni=ii.object,xr=ii.geometry,ps=ii.material,Ca=ii.group;if(ps.side===xi&&ni.layers.test(ve.layers)){const nh=ps.side;ps.side=un,ps.needsUpdate=!0,hn(ni,fe,ve,xr,ps,Ca),ps.side=nh,ps.needsUpdate=!0,Ut=!0}}Ut===!0&&(ct.updateMultisampleRenderTarget(Me),ct.updateRenderTargetMipmap(Me)),x.setRenderTarget(et),x.setClearColor(z,D),x.toneMapping=Bt}function Ui(N,ne,fe){const ve=ne.isScene===!0?ne.overrideMaterial:null;for(let le=0,et=N.length;le<et;le++){const Bt=N[le],Ut=Bt.object,jt=Bt.geometry,pi=ve===null?Bt.material:ve,ii=Bt.group;Ut.layers.test(fe.layers)&&hn(Ut,ne,fe,jt,pi,ii)}}function hn(N,ne,fe,ve,le,et){N.onBeforeRender(x,ne,fe,ve,le,et),N.modelViewMatrix.multiplyMatrices(fe.matrixWorldInverse,N.matrixWorld),N.normalMatrix.getNormalMatrix(N.modelViewMatrix),le.onBeforeRender(x,ne,fe,ve,N,et),le.transparent===!0&&le.side===xi&&le.forceSinglePass===!1?(le.side=un,le.needsUpdate=!0,x.renderBufferDirect(fe,ne,ve,le,N,et),le.side=Un,le.needsUpdate=!0,x.renderBufferDirect(fe,ne,ve,le,N,et),le.side=xi):x.renderBufferDirect(fe,ne,ve,le,N,et),N.onAfterRender(x,ne,fe,ve,le,et)}function Ts(N,ne,fe){ne.isScene!==!0&&(ne=rt);const ve=nt.get(N),le=v.state.lights,et=v.state.shadowsArray,Bt=le.state.version,Ut=De.getParameters(N,le.state,et,ne,fe),jt=De.getProgramCacheKey(Ut);let pi=ve.programs;ve.environment=N.isMeshStandardMaterial?ne.environment:null,ve.fog=ne.fog,ve.envMap=(N.isMeshStandardMaterial?H:It).get(N.envMap||ve.environment),ve.envMapRotation=ve.environment!==null&&N.envMap===null?ne.environmentRotation:N.envMapRotation,pi===void 0&&(N.addEventListener("dispose",j),pi=new Map,ve.programs=pi);let ii=pi.get(jt);if(ii!==void 0){if(ve.currentProgram===ii&&ve.lightsStateVersion===Bt)return di(N,Ut),ii}else Ut.uniforms=De.getUniforms(N),N.onBuild(fe,Ut,x),N.onBeforeCompile(Ut,x),ii=De.acquireProgram(Ut,jt),pi.set(jt,ii),ve.uniforms=Ut.uniforms;const ni=ve.uniforms;return(!N.isShaderMaterial&&!N.isRawShaderMaterial||N.clipping===!0)&&(ni.clippingPlanes=Ue.uniform),di(N,Ut),ve.needsLights=Jn(N),ve.lightsStateVersion=Bt,ve.needsLights&&(ni.ambientLightColor.value=le.state.ambient,ni.lightProbe.value=le.state.probe,ni.directionalLights.value=le.state.directional,ni.directionalLightShadows.value=le.state.directionalShadow,ni.spotLights.value=le.state.spot,ni.spotLightShadows.value=le.state.spotShadow,ni.rectAreaLights.value=le.state.rectArea,ni.ltc_1.value=le.state.rectAreaLTC1,ni.ltc_2.value=le.state.rectAreaLTC2,ni.pointLights.value=le.state.point,ni.pointLightShadows.value=le.state.pointShadow,ni.hemisphereLights.value=le.state.hemi,ni.directionalShadowMap.value=le.state.directionalShadowMap,ni.directionalShadowMatrix.value=le.state.directionalShadowMatrix,ni.spotShadowMap.value=le.state.spotShadowMap,ni.spotLightMatrix.value=le.state.spotLightMatrix,ni.spotLightMap.value=le.state.spotLightMap,ni.pointShadowMap.value=le.state.pointShadowMap,ni.pointShadowMatrix.value=le.state.pointShadowMatrix),ve.currentProgram=ii,ve.uniformsList=null,ii}function Gi(N){if(N.uniformsList===null){const ne=N.currentProgram.getUniforms();N.uniformsList=yw.seqWithValue(ne.seq,N.uniforms)}return N.uniformsList}function di(N,ne){const fe=nt.get(N);fe.outputColorSpace=ne.outputColorSpace,fe.batching=ne.batching,fe.instancing=ne.instancing,fe.instancingColor=ne.instancingColor,fe.instancingMorph=ne.instancingMorph,fe.skinning=ne.skinning,fe.morphTargets=ne.morphTargets,fe.morphNormals=ne.morphNormals,fe.morphColors=ne.morphColors,fe.morphTargetsCount=ne.morphTargetsCount,fe.numClippingPlanes=ne.numClippingPlanes,fe.numIntersection=ne.numClipIntersection,fe.vertexAlphas=ne.vertexAlphas,fe.vertexTangents=ne.vertexTangents,fe.toneMapping=ne.toneMapping}function Fn(N,ne,fe,ve,le){ne.isScene!==!0&&(ne=rt),ct.resetTextureUnits();const et=ne.fog,Bt=ve.isMeshStandardMaterial?ne.environment:null,Ut=M===null?x.outputColorSpace:M.isXRRenderTarget===!0?M.texture.colorSpace:Bi,jt=(ve.isMeshStandardMaterial?H:It).get(ve.envMap||Bt),pi=ve.vertexColors===!0&&!!fe.attributes.color&&fe.attributes.color.itemSize===4,ii=!!fe.attributes.tangent&&(!!ve.normalMap||ve.anisotropy>0),ni=!!fe.morphAttributes.position,xr=!!fe.morphAttributes.normal,ps=!!fe.morphAttributes.color;let Ca=Yr;ve.toneMapped&&(M===null||M.isXRRenderTarget===!0)&&(Ca=x.toneMapping);const nh=fe.morphAttributes.position||fe.morphAttributes.normal||fe.morphAttributes.color,Nn=nh!==void 0?nh.length:0,$t=nt.get(ve),OT=v.state.lights;if(re===!0&&(we===!0||N!==P)){const Ma=N===P&&ve.id===R;Ue.setState(ve,N,Ma)}let GT=!1;ve.version===$t.__version?($t.needsLights&&$t.lightsStateVersion!==OT.state.version||$t.outputColorSpace!==Ut||le.isBatchedMesh&&$t.batching===!1||!le.isBatchedMesh&&$t.batching===!0||le.isInstancedMesh&&$t.instancing===!1||!le.isInstancedMesh&&$t.instancing===!0||le.isSkinnedMesh&&$t.skinning===!1||!le.isSkinnedMesh&&$t.skinning===!0||le.isInstancedMesh&&$t.instancingColor===!0&&le.instanceColor===null||le.isInstancedMesh&&$t.instancingColor===!1&&le.instanceColor!==null||le.isInstancedMesh&&$t.instancingMorph===!0&&le.morphTexture===null||le.isInstancedMesh&&$t.instancingMorph===!1&&le.morphTexture!==null||$t.envMap!==jt||ve.fog===!0&&$t.fog!==et||$t.numClippingPlanes!==void 0&&($t.numClippingPlanes!==Ue.numPlanes||$t.numIntersection!==Ue.numIntersection)||$t.vertexAlphas!==pi||$t.vertexTangents!==ii||$t.morphTargets!==ni||$t.morphNormals!==xr||$t.morphColors!==ps||$t.toneMapping!==Ca||Te.isWebGL2===!0&&$t.morphTargetsCount!==Nn)&&(GT=!0):(GT=!0,$t.__version=ve.version);let fp=$t.currentProgram;GT===!0&&(fp=Ts(ve,ne,le));let k3=!1,Hy=!1,zT=!1;const wr=fp.getUniforms(),gp=$t.uniforms;if(We.useProgram(fp.program)&&(k3=!0,Hy=!0,zT=!0),ve.id!==R&&(R=ve.id,Hy=!0),k3||P!==N){wr.setValue(Q,"projectionMatrix",N.projectionMatrix),wr.setValue(Q,"viewMatrix",N.matrixWorldInverse);const Ma=wr.map.cameraPosition;Ma!==void 0&&Ma.setValue(Q,Ge.setFromMatrixPosition(N.matrixWorld)),Te.logarithmicDepthBuffer&&wr.setValue(Q,"logDepthBufFC",2/(Math.log(N.far+1)/Math.LN2)),(ve.isMeshPhongMaterial||ve.isMeshToonMaterial||ve.isMeshLambertMaterial||ve.isMeshBasicMaterial||ve.isMeshStandardMaterial||ve.isShaderMaterial)&&wr.setValue(Q,"isOrthographic",N.isOrthographicCamera===!0),P!==N&&(P=N,Hy=!0,zT=!0)}if(le.isSkinnedMesh){wr.setOptional(Q,le,"bindMatrix"),wr.setOptional(Q,le,"bindMatrixInverse");const Ma=le.skeleton;Ma&&(Te.floatVertexTextures?(Ma.boneTexture===null&&Ma.computeBoneTexture(),wr.setValue(Q,"boneTexture",Ma.boneTexture,ct)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}le.isBatchedMesh&&(wr.setOptional(Q,le,"batchingTexture"),wr.setValue(Q,"batchingTexture",le._matricesTexture,ct));const FT=fe.morphAttributes;if((FT.position!==void 0||FT.normal!==void 0||FT.color!==void 0&&Te.isWebGL2===!0)&&ze.update(le,fe,fp),(Hy||$t.receiveShadow!==le.receiveShadow)&&($t.receiveShadow=le.receiveShadow,wr.setValue(Q,"receiveShadow",le.receiveShadow)),ve.isMeshGouraudMaterial&&ve.envMap!==null&&(gp.envMap.value=jt,gp.flipEnvMap.value=jt.isCubeTexture&&jt.isRenderTargetTexture===!1?-1:1),Hy&&(wr.setValue(Q,"toneMappingExposure",x.toneMappingExposure),$t.needsLights&&wo(gp,zT),et&&ve.fog===!0&&Le.refreshFogUniforms(gp,et),Le.refreshMaterialUniforms(gp,ve,F,O,Me),yw.upload(Q,Gi($t),gp,ct)),ve.isShaderMaterial&&ve.uniformsNeedUpdate===!0&&(yw.upload(Q,Gi($t),gp,ct),ve.uniformsNeedUpdate=!1),ve.isSpriteMaterial&&wr.setValue(Q,"center",le.center),wr.setValue(Q,"modelViewMatrix",le.modelViewMatrix),wr.setValue(Q,"normalMatrix",le.normalMatrix),wr.setValue(Q,"modelMatrix",le.matrixWorld),ve.isShaderMaterial||ve.isRawShaderMaterial){const Ma=ve.uniformsGroups;for(let NT=0,K6=Ma.length;NT<K6;NT++)if(Te.isWebGL2){const D3=Ma[NT];I.update(D3,fp),I.bind(D3,fp)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return fp}function wo(N,ne){N.ambientLightColor.needsUpdate=ne,N.lightProbe.needsUpdate=ne,N.directionalLights.needsUpdate=ne,N.directionalLightShadows.needsUpdate=ne,N.pointLights.needsUpdate=ne,N.pointLightShadows.needsUpdate=ne,N.spotLights.needsUpdate=ne,N.spotLightShadows.needsUpdate=ne,N.rectAreaLights.needsUpdate=ne,N.hemisphereLights.needsUpdate=ne}function Jn(N){return N.isMeshLambertMaterial||N.isMeshToonMaterial||N.isMeshPhongMaterial||N.isMeshStandardMaterial||N.isShadowMaterial||N.isShaderMaterial&&N.lights===!0}this.getActiveCubeFace=function(){return _},this.getActiveMipmapLevel=function(){return S},this.getRenderTarget=function(){return M},this.setRenderTargetTextures=function(N,ne,fe){nt.get(N.texture).__webglTexture=ne,nt.get(N.depthTexture).__webglTexture=fe;const ve=nt.get(N);ve.__hasExternalTextures=!0,ve.__autoAllocateDepthBuffer=fe===void 0,ve.__autoAllocateDepthBuffer||Re.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),ve.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(N,ne){const fe=nt.get(N);fe.__webglFramebuffer=ne,fe.__useDefaultFramebuffer=ne===void 0},this.setRenderTarget=function(N,ne=0,fe=0){M=N,_=ne,S=fe;let ve=!0,le=null,et=!1,Bt=!1;if(N){const Ut=nt.get(N);Ut.__useDefaultFramebuffer!==void 0?(We.bindFramebuffer(Q.FRAMEBUFFER,null),ve=!1):Ut.__webglFramebuffer===void 0?ct.setupRenderTarget(N):Ut.__hasExternalTextures&&ct.rebindTextures(N,nt.get(N.texture).__webglTexture,nt.get(N.depthTexture).__webglTexture);const jt=N.texture;(jt.isData3DTexture||jt.isDataArrayTexture||jt.isCompressedArrayTexture)&&(Bt=!0);const pi=nt.get(N).__webglFramebuffer;N.isWebGLCubeRenderTarget?(Array.isArray(pi[ne])?le=pi[ne][fe]:le=pi[ne],et=!0):Te.isWebGL2&&N.samples>0&&ct.useMultisampledRTT(N)===!1?le=nt.get(N).__webglMultisampledFramebuffer:Array.isArray(pi)?le=pi[fe]:le=pi,C.copy(N.viewport),L.copy(N.scissor),B=N.scissorTest}else C.copy(q).multiplyScalar(F).floor(),L.copy(oe).multiplyScalar(F).floor(),B=_e;if(We.bindFramebuffer(Q.FRAMEBUFFER,le)&&Te.drawBuffers&&ve&&We.drawBuffers(N,le),We.viewport(C),We.scissor(L),We.setScissorTest(B),et){const Ut=nt.get(N.texture);Q.framebufferTexture2D(Q.FRAMEBUFFER,Q.COLOR_ATTACHMENT0,Q.TEXTURE_CUBE_MAP_POSITIVE_X+ne,Ut.__webglTexture,fe)}else if(Bt){const Ut=nt.get(N.texture),jt=ne||0;Q.framebufferTextureLayer(Q.FRAMEBUFFER,Q.COLOR_ATTACHMENT0,Ut.__webglTexture,fe||0,jt)}R=-1},this.readRenderTargetPixels=function(N,ne,fe,ve,le,et,Bt){if(!(N&&N.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Ut=nt.get(N).__webglFramebuffer;if(N.isWebGLCubeRenderTarget&&Bt!==void 0&&(Ut=Ut[Bt]),Ut){We.bindFramebuffer(Q.FRAMEBUFFER,Ut);try{const jt=N.texture,pi=jt.format,ii=jt.type;if(pi!==_i&&_t.convert(pi)!==Q.getParameter(Q.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const ni=ii===ms&&(Re.has("EXT_color_buffer_half_float")||Te.isWebGL2&&Re.has("EXT_color_buffer_float"));if(ii!==pn&&_t.convert(ii)!==Q.getParameter(Q.IMPLEMENTATION_COLOR_READ_TYPE)&&!(ii===Hi&&(Te.isWebGL2||Re.has("OES_texture_float")||Re.has("WEBGL_color_buffer_float")))&&!ni){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}ne>=0&&ne<=N.width-ve&&fe>=0&&fe<=N.height-le&&Q.readPixels(ne,fe,ve,le,_t.convert(pi),_t.convert(ii),et)}finally{const jt=M!==null?nt.get(M).__webglFramebuffer:null;We.bindFramebuffer(Q.FRAMEBUFFER,jt)}}},this.copyFramebufferToTexture=function(N,ne,fe=0){const ve=Math.pow(2,-fe),le=Math.floor(ne.image.width*ve),et=Math.floor(ne.image.height*ve);ct.setTexture2D(ne,0),Q.copyTexSubImage2D(Q.TEXTURE_2D,fe,0,0,N.x,N.y,le,et),We.unbindTexture()},this.copyTextureToTexture=function(N,ne,fe,ve=0){const le=ne.image.width,et=ne.image.height,Bt=_t.convert(fe.format),Ut=_t.convert(fe.type);ct.setTexture2D(fe,0),Q.pixelStorei(Q.UNPACK_FLIP_Y_WEBGL,fe.flipY),Q.pixelStorei(Q.UNPACK_PREMULTIPLY_ALPHA_WEBGL,fe.premultiplyAlpha),Q.pixelStorei(Q.UNPACK_ALIGNMENT,fe.unpackAlignment),ne.isDataTexture?Q.texSubImage2D(Q.TEXTURE_2D,ve,N.x,N.y,le,et,Bt,Ut,ne.image.data):ne.isCompressedTexture?Q.compressedTexSubImage2D(Q.TEXTURE_2D,ve,N.x,N.y,ne.mipmaps[0].width,ne.mipmaps[0].height,Bt,ne.mipmaps[0].data):Q.texSubImage2D(Q.TEXTURE_2D,ve,N.x,N.y,Bt,Ut,ne.image),ve===0&&fe.generateMipmaps&&Q.generateMipmap(Q.TEXTURE_2D),We.unbindTexture()},this.copyTextureToTexture3D=function(N,ne,fe,ve,le=0){if(x.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const et=Math.round(N.max.x-N.min.x),Bt=Math.round(N.max.y-N.min.y),Ut=N.max.z-N.min.z+1,jt=_t.convert(ve.format),pi=_t.convert(ve.type);let ii;if(ve.isData3DTexture)ct.setTexture3D(ve,0),ii=Q.TEXTURE_3D;else if(ve.isDataArrayTexture||ve.isCompressedArrayTexture)ct.setTexture2DArray(ve,0),ii=Q.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}Q.pixelStorei(Q.UNPACK_FLIP_Y_WEBGL,ve.flipY),Q.pixelStorei(Q.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ve.premultiplyAlpha),Q.pixelStorei(Q.UNPACK_ALIGNMENT,ve.unpackAlignment);const ni=Q.getParameter(Q.UNPACK_ROW_LENGTH),xr=Q.getParameter(Q.UNPACK_IMAGE_HEIGHT),ps=Q.getParameter(Q.UNPACK_SKIP_PIXELS),Ca=Q.getParameter(Q.UNPACK_SKIP_ROWS),nh=Q.getParameter(Q.UNPACK_SKIP_IMAGES),Nn=fe.isCompressedTexture?fe.mipmaps[le]:fe.image;Q.pixelStorei(Q.UNPACK_ROW_LENGTH,Nn.width),Q.pixelStorei(Q.UNPACK_IMAGE_HEIGHT,Nn.height),Q.pixelStorei(Q.UNPACK_SKIP_PIXELS,N.min.x),Q.pixelStorei(Q.UNPACK_SKIP_ROWS,N.min.y),Q.pixelStorei(Q.UNPACK_SKIP_IMAGES,N.min.z),fe.isDataTexture||fe.isData3DTexture?Q.texSubImage3D(ii,le,ne.x,ne.y,ne.z,et,Bt,Ut,jt,pi,Nn.data):ve.isCompressedArrayTexture?Q.compressedTexSubImage3D(ii,le,ne.x,ne.y,ne.z,et,Bt,Ut,jt,Nn.data):Q.texSubImage3D(ii,le,ne.x,ne.y,ne.z,et,Bt,Ut,jt,pi,Nn),Q.pixelStorei(Q.UNPACK_ROW_LENGTH,ni),Q.pixelStorei(Q.UNPACK_IMAGE_HEIGHT,xr),Q.pixelStorei(Q.UNPACK_SKIP_PIXELS,ps),Q.pixelStorei(Q.UNPACK_SKIP_ROWS,Ca),Q.pixelStorei(Q.UNPACK_SKIP_IMAGES,nh),le===0&&ve.generateMipmaps&&Q.generateMipmap(ii),We.unbindTexture()},this.initTexture=function(N){N.isCubeTexture?ct.setTextureCube(N,0):N.isData3DTexture?ct.setTexture3D(N,0):N.isDataArrayTexture||N.isCompressedArrayTexture?ct.setTexture2DArray(N,0):ct.setTexture2D(N,0),We.unbindTexture()},this.resetState=function(){_=0,S=0,M=null,We.reset(),ut.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return tc}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const i=this.getContext();i.drawingBufferColorSpace=e===V1?"display-p3":"srgb",i.unpackColorSpace=Ci.workingColorSpace===tv?"display-p3":"srgb"}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===vt?RR:cz}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===RR?vt:Bi}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}}class LF extends gh{}LF.prototype.isWebGL1Renderer=!0;class xT{constructor(e,i=25e-5){this.isFogExp2=!0,this.name="",this.color=new Ae(e),this.density=i}clone(){return new xT(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}let vw=class Q6{constructor(e,i=1,s=1e3){this.isFog=!0,this.name="",this.color=new Ae(e),this.near=i,this.far=s}clone(){return new Q6(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}};class Ls extends ye{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new si,this.environmentRotation=new si,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,i){return super.copy(e,i),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const i=super.toJSON(e);return this.fog!==null&&(i.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(i.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(i.object.backgroundIntensity=this.backgroundIntensity),i.object.backgroundRotation=this.backgroundRotation.toArray(),i.object.environmentRotation=this.environmentRotation.toArray(),i}}let yv=class{constructor(n,e){this.isInterleavedBuffer=!0,this.array=n,this.stride=e,this.count=n!==void 0?n.length/e:0,this.usage=rv,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=Vo()}onUploadCallback(){}set needsUpdate(n){n===!0&&this.version++}get updateRange(){return Dz("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(n){return this.usage=n,this}addUpdateRange(n,e){this.updateRanges.push({start:n,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(n){return this.array=new n.array.constructor(n.array),this.count=n.count,this.stride=n.stride,this.usage=n.usage,this}copyAt(n,e,i){n*=this.stride,i*=e.stride;for(let s=0,r=this.stride;s<r;s++)this.array[n+s]=e.array[i+s];return this}set(n,e=0){return this.array.set(n,e),this}clone(n){n.arrayBuffers===void 0&&(n.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Vo()),n.arrayBuffers[this.array.buffer._uuid]===void 0&&(n.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(n.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(e,this.stride);return i.setUsage(this.usage),i}onUpload(n){return this.onUploadCallback=n,this}toJSON(n){return n.arrayBuffers===void 0&&(n.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Vo()),n.arrayBuffers[this.array.buffer._uuid]===void 0&&(n.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}};const eo=new E;let Ho=class Z6{constructor(e,i,s,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=i,this.offset=s,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let i=0,s=this.data.count;i<s;i++)eo.fromBufferAttribute(this,i),eo.applyMatrix4(e),this.setXYZ(i,eo.x,eo.y,eo.z);return this}applyNormalMatrix(e){for(let i=0,s=this.count;i<s;i++)eo.fromBufferAttribute(this,i),eo.applyNormalMatrix(e),this.setXYZ(i,eo.x,eo.y,eo.z);return this}transformDirection(e){for(let i=0,s=this.count;i<s;i++)eo.fromBufferAttribute(this,i),eo.transformDirection(e),this.setXYZ(i,eo.x,eo.y,eo.z);return this}getComponent(e,i){let s=this.array[e*this.data.stride+this.offset+i];return this.normalized&&(s=Jr(s,this.array)),s}setComponent(e,i,s){return this.normalized&&(s=Kt(s,this.array)),this.data.array[e*this.data.stride+this.offset+i]=s,this}setX(e,i){return this.normalized&&(i=Kt(i,this.array)),this.data.array[e*this.data.stride+this.offset]=i,this}setY(e,i){return this.normalized&&(i=Kt(i,this.array)),this.data.array[e*this.data.stride+this.offset+1]=i,this}setZ(e,i){return this.normalized&&(i=Kt(i,this.array)),this.data.array[e*this.data.stride+this.offset+2]=i,this}setW(e,i){return this.normalized&&(i=Kt(i,this.array)),this.data.array[e*this.data.stride+this.offset+3]=i,this}getX(e){let i=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(i=Jr(i,this.array)),i}getY(e){let i=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(i=Jr(i,this.array)),i}getZ(e){let i=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(i=Jr(i,this.array)),i}getW(e){let i=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(i=Jr(i,this.array)),i}setXY(e,i,s){return e=e*this.data.stride+this.offset,this.normalized&&(i=Kt(i,this.array),s=Kt(s,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=s,this}setXYZ(e,i,s,r){return e=e*this.data.stride+this.offset,this.normalized&&(i=Kt(i,this.array),s=Kt(s,this.array),r=Kt(r,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=s,this.data.array[e+2]=r,this}setXYZW(e,i,s,r,o){return e=e*this.data.stride+this.offset,this.normalized&&(i=Kt(i,this.array),s=Kt(s,this.array),r=Kt(r,this.array),o=Kt(o,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=s,this.data.array[e+2]=r,this.data.array[e+3]=o,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let s=0;s<this.count;s++){const r=s*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)i.push(this.data.array[r+o])}return new qe(new this.array.constructor(i),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Z6(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let s=0;s<this.count;s++){const r=s*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)i.push(this.data.array[r+o])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:i,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}};class bw extends Ft{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Ae(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let sg;const vv=new E,rg=new E,og=new E,ag=new Y,bv=new Y,PF=new he,Aw=new E,Av=new E,xw=new E,BF=new Y,g2=new Y,kF=new Y;let y2=class extends ye{constructor(n=new bw){if(super(),this.isSprite=!0,this.type="Sprite",sg===void 0){sg=new dt;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new yv(e,5);sg.setIndex([0,1,2,0,2,3]),sg.setAttribute("position",new Ho(i,3,0,!1)),sg.setAttribute("uv",new Ho(i,2,3,!1))}this.geometry=sg,this.material=n,this.center=new Y(.5,.5)}raycast(n,e){n.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),rg.setFromMatrixScale(this.matrixWorld),PF.copy(n.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(n.camera.matrixWorldInverse,this.matrixWorld),og.setFromMatrixPosition(this.modelViewMatrix),n.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&rg.multiplyScalar(-og.z);const i=this.material.rotation;let s,r;i!==0&&(r=Math.cos(i),s=Math.sin(i));const o=this.center;ww(Aw.set(-.5,-.5,0),og,o,rg,s,r),ww(Av.set(.5,-.5,0),og,o,rg,s,r),ww(xw.set(.5,.5,0),og,o,rg,s,r),BF.set(0,0),g2.set(1,0),kF.set(1,1);let a=n.ray.intersectTriangle(Aw,Av,xw,!1,vv);if(a===null&&(ww(Av.set(-.5,.5,0),og,o,rg,s,r),g2.set(0,1),a=n.ray.intersectTriangle(Aw,xw,Av,!1,vv),a===null))return;const l=n.ray.origin.distanceTo(vv);l<n.near||l>n.far||e.push({distance:l,point:vv.clone(),uv:Ks.getInterpolation(vv,Aw,Av,xw,BF,g2,kF,new Y),face:null,object:this})}copy(n,e){return super.copy(n,e),n.center!==void 0&&this.center.copy(n.center),this.material=n.material,this}};function ww(n,e,i,s,r,o){ag.subVectors(n,i).addScalar(.5).multiply(s),r!==void 0?(bv.x=o*ag.x-r*ag.y,bv.y=r*ag.x+o*ag.y):bv.copy(ag),n.copy(e),n.x+=bv.x,n.y+=bv.y,n.applyMatrix4(PF)}const _w=new E,DF=new E;let v2=class extends ye{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(n){super.copy(n,!1);const e=n.levels;for(let i=0,s=e.length;i<s;i++){const r=e[i];this.addLevel(r.object.clone(),r.distance,r.hysteresis)}return this.autoUpdate=n.autoUpdate,this}addLevel(n,e=0,i=0){e=Math.abs(e);const s=this.levels;let r;for(r=0;r<s.length&&!(e<s[r].distance);r++);return s.splice(r,0,{distance:e,hysteresis:i,object:n}),this.add(n),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(n){const e=this.levels;if(e.length>0){let i,s;for(i=1,s=e.length;i<s;i++){let r=e[i].distance;if(e[i].object.visible&&(r-=r*e[i].hysteresis),n<r)break}return e[i-1].object}return null}raycast(n,e){if(this.levels.length>0){_w.setFromMatrixPosition(this.matrixWorld);const i=n.ray.origin.distanceTo(_w);this.getObjectForDistance(i).raycast(n,e)}}update(n){const e=this.levels;if(e.length>1){_w.setFromMatrixPosition(n.matrixWorld),DF.setFromMatrixPosition(this.matrixWorld);const i=_w.distanceTo(DF)/n.zoom;e[0].object.visible=!0;let s,r;for(s=1,r=e.length;s<r;s++){let o=e[s].distance;if(e[s].object.visible&&(o-=o*e[s].hysteresis),i>=o)e[s-1].object.visible=!1,e[s].object.visible=!0;else break}for(this._currentLevel=s-1;s<r;s++)e[s].object.visible=!1}}toJSON(n){const e=super.toJSON(n);this.autoUpdate===!1&&(e.object.autoUpdate=!1),e.object.levels=[];const i=this.levels;for(let s=0,r=i.length;s<r;s++){const o=i[s];e.object.levels.push({object:o.object.uuid,distance:o.distance,hysteresis:o.hysteresis})}return e}};const OF=new E,GF=new Ze,zF=new Ze,Gee=new E,FF=new he,Sw=new E,b2=new tn,NF=new he,A2=new qr;let Eo=class extends pe{constructor(n,e){super(n,e),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=KT,this.bindMatrix=new he,this.bindMatrixInverse=new he,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const n=this.geometry;this.boundingBox===null&&(this.boundingBox=new Wt),this.boundingBox.makeEmpty();const e=n.getAttribute("position");for(let i=0;i<e.count;i++)this.getVertexPosition(i,Sw),this.boundingBox.expandByPoint(Sw)}computeBoundingSphere(){const n=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new tn),this.boundingSphere.makeEmpty();const e=n.getAttribute("position");for(let i=0;i<e.count;i++)this.getVertexPosition(i,Sw),this.boundingSphere.expandByPoint(Sw)}copy(n,e){return super.copy(n,e),this.bindMode=n.bindMode,this.bindMatrix.copy(n.bindMatrix),this.bindMatrixInverse.copy(n.bindMatrixInverse),this.skeleton=n.skeleton,n.boundingBox!==null&&(this.boundingBox=n.boundingBox.clone()),n.boundingSphere!==null&&(this.boundingSphere=n.boundingSphere.clone()),this}raycast(n,e){const i=this.material,s=this.matrixWorld;i!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),b2.copy(this.boundingSphere),b2.applyMatrix4(s),n.ray.intersectsSphere(b2)!==!1&&(NF.copy(s).invert(),A2.copy(n.ray).applyMatrix4(NF),!(this.boundingBox!==null&&A2.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(n,e,A2)))}getVertexPosition(n,e){return super.getVertexPosition(n,e),this.applyBoneTransform(n,e),e}bind(n,e){this.skeleton=n,e===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const n=new Ze,e=this.geometry.attributes.skinWeight;for(let i=0,s=e.count;i<s;i++){n.fromBufferAttribute(e,i);const r=1/n.manhattanLength();r!==1/0?n.multiplyScalar(r):n.set(1,0,0,0),e.setXYZW(i,n.x,n.y,n.z,n.w)}}updateMatrixWorld(n){super.updateMatrixWorld(n),this.bindMode===KT?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===nz?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(n,e){const i=this.skeleton,s=this.geometry;GF.fromBufferAttribute(s.attributes.skinIndex,n),zF.fromBufferAttribute(s.attributes.skinWeight,n),OF.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let r=0;r<4;r++){const o=zF.getComponent(r);if(o!==0){const a=GF.getComponent(r);FF.multiplyMatrices(i.bones[a].matrixWorld,i.boneInverses[a]),e.addScaledVector(Gee.copy(OF).applyMatrix4(FF),o)}}return e.applyMatrix4(this.bindMatrixInverse)}},zp=class extends ye{constructor(){super(),this.isBone=!0,this.type="Bone"}},Tr=class extends Vt{constructor(n=null,e=1,i=1,s,r,o,a,l,c=Dt,h=Dt,u,d){super(null,o,a,l,c,h,s,r,u,d),this.isDataTexture=!0,this.image={data:n,width:e,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};const UF=new he,zee=new he;let xv=class Y6{constructor(e=[],i=[]){this.uuid=Vo(),this.bones=e.slice(0),this.boneInverses=i,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,i=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),i.length===0)this.calculateInverses();else if(e.length!==i.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let s=0,r=this.bones.length;s<r;s++)this.boneInverses.push(new he)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,i=this.bones.length;e<i;e++){const s=new he;this.bones[e]&&s.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(s)}}pose(){for(let e=0,i=this.bones.length;e<i;e++){const s=this.bones[e];s&&s.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,i=this.bones.length;e<i;e++){const s=this.bones[e];s&&(s.parent&&s.parent.isBone?(s.matrix.copy(s.parent.matrixWorld).invert(),s.matrix.multiply(s.matrixWorld)):s.matrix.copy(s.matrixWorld),s.matrix.decompose(s.position,s.quaternion,s.scale))}}update(){const e=this.bones,i=this.boneInverses,s=this.boneMatrices,r=this.boneTexture;for(let o=0,a=e.length;o<a;o++){const l=e[o]?e[o].matrixWorld:zee;UF.multiplyMatrices(l,i[o]),UF.toArray(s,o*16)}r!==null&&(r.needsUpdate=!0)}clone(){return new Y6(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const i=new Float32Array(e*e*4);i.set(this.boneMatrices);const s=new Tr(i,e,e,_i,Hi);return s.needsUpdate=!0,this.boneMatrices=i,this.boneTexture=s,this}getBoneByName(e){for(let i=0,s=this.bones.length;i<s;i++){const r=this.bones[i];if(r.name===e)return r}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,i){this.uuid=e.uuid;for(let s=0,r=e.bones.length;s<r;s++){const o=e.bones[s];let a=i[o];a===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",o),a=new zp),this.bones.push(a),this.boneInverses.push(new he().fromArray(e.boneInverses[s]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const i=this.bones,s=this.boneInverses;for(let r=0,o=i.length;r<o;r++){const a=i[r];e.bones.push(a.uuid);const l=s[r];e.boneInverses.push(l.toArray())}return e}},To=class extends qe{constructor(n,e,i,s=1){super(n,e,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=s}copy(n){return super.copy(n),this.meshPerAttribute=n.meshPerAttribute,this}toJSON(){const n=super.toJSON();return n.meshPerAttribute=this.meshPerAttribute,n.isInstancedBufferAttribute=!0,n}};const lg=new he,VF=new he,Cw=[],XF=new Wt,Fee=new he,wv=new pe,_v=new tn;let x2=class extends pe{constructor(n,e,i){super(n,e),this.isInstancedMesh=!0,this.instanceMatrix=new To(new Float32Array(i*16),16),this.instanceColor=null,this.morphTexture=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let s=0;s<i;s++)this.setMatrixAt(s,Fee)}computeBoundingBox(){const n=this.geometry,e=this.count;this.boundingBox===null&&(this.boundingBox=new Wt),n.boundingBox===null&&n.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<e;i++)this.getMatrixAt(i,lg),XF.copy(n.boundingBox).applyMatrix4(lg),this.boundingBox.union(XF)}computeBoundingSphere(){const n=this.geometry,e=this.count;this.boundingSphere===null&&(this.boundingSphere=new tn),n.boundingSphere===null&&n.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<e;i++)this.getMatrixAt(i,lg),_v.copy(n.boundingSphere).applyMatrix4(lg),this.boundingSphere.union(_v)}copy(n,e){return super.copy(n,e),this.instanceMatrix.copy(n.instanceMatrix),n.instanceColor!==null&&(this.instanceColor=n.instanceColor.clone()),this.count=n.count,n.boundingBox!==null&&(this.boundingBox=n.boundingBox.clone()),n.boundingSphere!==null&&(this.boundingSphere=n.boundingSphere.clone()),this}getColorAt(n,e){e.fromArray(this.instanceColor.array,n*3)}getMatrixAt(n,e){e.fromArray(this.instanceMatrix.array,n*16)}getMorphAt(n,e){const i=e.morphTargetInfluences,s=this.morphTexture.source.data.data,r=i.length+1,o=n*r+1;for(let a=0;a<i.length;a++)i[a]=s[o+a]}raycast(n,e){const i=this.matrixWorld,s=this.count;if(wv.geometry=this.geometry,wv.material=this.material,wv.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),_v.copy(this.boundingSphere),_v.applyMatrix4(i),n.ray.intersectsSphere(_v)!==!1))for(let r=0;r<s;r++){this.getMatrixAt(r,lg),VF.multiplyMatrices(i,lg),wv.matrixWorld=VF,wv.raycast(n,Cw);for(let o=0,a=Cw.length;o<a;o++){const l=Cw[o];l.instanceId=r,l.object=this,e.push(l)}Cw.length=0}}setColorAt(n,e){this.instanceColor===null&&(this.instanceColor=new To(new Float32Array(this.instanceMatrix.count*3),3)),e.toArray(this.instanceColor.array,n*3)}setMatrixAt(n,e){e.toArray(this.instanceMatrix.array,n*16)}setMorphAt(n,e){const i=e.morphTargetInfluences,s=i.length+1;this.morphTexture===null&&(this.morphTexture=new Tr(new Float32Array(s*this.count),s,this.count,Sp,Hi));const r=this.morphTexture.source.data.data;let o=0;for(let c=0;c<i.length;c++)o+=i[c];const a=this.geometry.morphTargetsRelative?1:1-o,l=s*n;r[l]=a,r.set(i,l+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}};function Nee(n,e){return n.z-e.z}function Uee(n,e){return e.z-n.z}class Vee{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,i){const s=this.pool,r=this.list;this.index>=s.length&&s.push({start:-1,count:-1,z:-1});const o=s[this.index];r.push(o),this.index++,o.start=e.start,o.count=e.count,o.z=i}reset(){this.list.length=0,this.index=0}}const cg="batchId",Du=new he,WF=new he,Xee=new he,HF=new he,w2=new Bp,Mw=new Wt,Fp=new tn,Sv=new E,_2=new Vee,Rr=new pe,Ew=[];function Wee(n,e,i=0){const s=e.itemSize;if(n.isInterleavedBufferAttribute||n.array.constructor!==e.array.constructor){const r=n.count;for(let o=0;o<r;o++)for(let a=0;a<s;a++)e.setComponent(o+i,a,n.getComponent(o,a))}else e.array.set(n.array,i*s);e.needsUpdate=!0}class Tw extends pe{get maxGeometryCount(){return this._maxGeometryCount}constructor(e,i,s=i*2,r){super(new dt,r),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._drawRanges=[],this._reservedRanges=[],this._visibility=[],this._active=[],this._bounds=[],this._maxGeometryCount=e,this._maxVertexCount=i,this._maxIndexCount=s,this._geometryInitialized=!1,this._geometryCount=0,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._visibilityChanged=!0,this._matricesTexture=null,this._initMatricesTexture()}_initMatricesTexture(){let e=Math.sqrt(this._maxGeometryCount*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const i=new Float32Array(e*e*4),s=new Tr(i,e,e,_i,Hi);this._matricesTexture=s}_initializeGeometry(e){const i=this.geometry,s=this._maxVertexCount,r=this._maxGeometryCount,o=this._maxIndexCount;if(this._geometryInitialized===!1){for(const l in e.attributes){const c=e.getAttribute(l),{array:h,itemSize:u,normalized:d}=c,m=new h.constructor(s*u),f=new qe(m,u,d);i.setAttribute(l,f)}if(e.getIndex()!==null){const l=s>65536?new Uint32Array(o):new Uint16Array(o);i.setIndex(new qe(l,1))}const a=r>65536?new Uint32Array(s):new Uint16Array(s);i.setAttribute(cg,new qe(a,1)),this._geometryInitialized=!0}}_validateGeometry(e){if(e.getAttribute(cg))throw new Error(`BatchedMesh: Geometry cannot use attribute "${cg}"`);const i=this.geometry;if(!!e.getIndex()!=!!i.getIndex())throw new Error('BatchedMesh: All geometries must consistently have "index".');for(const s in i.attributes){if(s===cg)continue;if(!e.hasAttribute(s))throw new Error(`BatchedMesh: Added geometry missing "${s}". All geometries must have consistent attributes.`);const r=e.getAttribute(s),o=i.getAttribute(s);if(r.itemSize!==o.itemSize||r.normalized!==o.normalized)throw new Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Wt);const e=this._geometryCount,i=this.boundingBox,s=this._active;i.makeEmpty();for(let r=0;r<e;r++)s[r]!==!1&&(this.getMatrixAt(r,Du),this.getBoundingBoxAt(r,Mw).applyMatrix4(Du),i.union(Mw))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new tn);const e=this._geometryCount,i=this.boundingSphere,s=this._active;i.makeEmpty();for(let r=0;r<e;r++)s[r]!==!1&&(this.getMatrixAt(r,Du),this.getBoundingSphereAt(r,Fp).applyMatrix4(Du),i.union(Fp))}addGeometry(e,i=-1,s=-1){if(this._initializeGeometry(e),this._validateGeometry(e),this._geometryCount>=this._maxGeometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");const r={vertexStart:-1,vertexCount:-1,indexStart:-1,indexCount:-1};let o=null;const a=this._reservedRanges,l=this._drawRanges,c=this._bounds;this._geometryCount!==0&&(o=a[a.length-1]),i===-1?r.vertexCount=e.getAttribute("position").count:r.vertexCount=i,o===null?r.vertexStart=0:r.vertexStart=o.vertexStart+o.vertexCount;const h=e.getIndex(),u=h!==null;if(u&&(s===-1?r.indexCount=h.count:r.indexCount=s,o===null?r.indexStart=0:r.indexStart=o.indexStart+o.indexCount),r.indexStart!==-1&&r.indexStart+r.indexCount>this._maxIndexCount||r.vertexStart+r.vertexCount>this._maxVertexCount)throw new Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");const d=this._visibility,m=this._active,f=this._matricesTexture,g=this._matricesTexture.image.data;d.push(!0),m.push(!0);const y=this._geometryCount;this._geometryCount++,Xee.toArray(g,y*16),f.needsUpdate=!0,a.push(r),l.push({start:u?r.indexStart:r.vertexStart,count:-1}),c.push({boxInitialized:!1,box:new Wt,sphereInitialized:!1,sphere:new tn});const v=this.geometry.getAttribute(cg);for(let b=0;b<r.vertexCount;b++)v.setX(r.vertexStart+b,y);return v.needsUpdate=!0,this.setGeometryAt(y,e),y}setGeometryAt(e,i){if(e>=this._geometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(i);const s=this.geometry,r=s.getIndex()!==null,o=s.getIndex(),a=i.getIndex(),l=this._reservedRanges[e];if(r&&a.count>l.indexCount||i.attributes.position.count>l.vertexCount)throw new Error("BatchedMesh: Reserved space not large enough for provided geometry.");const c=l.vertexStart,h=l.vertexCount;for(const f in s.attributes){if(f===cg)continue;const g=i.getAttribute(f),y=s.getAttribute(f);Wee(g,y,c);const v=g.itemSize;for(let b=g.count,A=h;b<A;b++){const x=c+b;for(let w=0;w<v;w++)y.setComponent(x,w,0)}y.needsUpdate=!0,y.addUpdateRange(c*v,h*v)}if(r){const f=l.indexStart;for(let g=0;g<a.count;g++)o.setX(f+g,c+a.getX(g));for(let g=a.count,y=l.indexCount;g<y;g++)o.setX(f+g,c);o.needsUpdate=!0,o.addUpdateRange(f,l.indexCount)}const u=this._bounds[e];i.boundingBox!==null?(u.box.copy(i.boundingBox),u.boxInitialized=!0):u.boxInitialized=!1,i.boundingSphere!==null?(u.sphere.copy(i.boundingSphere),u.sphereInitialized=!0):u.sphereInitialized=!1;const d=this._drawRanges[e],m=i.getAttribute("position");return d.count=r?a.count:m.count,this._visibilityChanged=!0,e}deleteGeometry(e){const i=this._active;return e>=i.length||i[e]===!1?this:(i[e]=!1,this._visibilityChanged=!0,this)}getBoundingBoxAt(e,i){if(this._active[e]===!1)return null;const s=this._bounds[e],r=s.box,o=this.geometry;if(s.boxInitialized===!1){r.makeEmpty();const a=o.index,l=o.attributes.position,c=this._drawRanges[e];for(let h=c.start,u=c.start+c.count;h<u;h++){let d=h;a&&(d=a.getX(d)),r.expandByPoint(Sv.fromBufferAttribute(l,d))}s.boxInitialized=!0}return i.copy(r),i}getBoundingSphereAt(e,i){if(this._active[e]===!1)return null;const s=this._bounds[e],r=s.sphere,o=this.geometry;if(s.sphereInitialized===!1){r.makeEmpty(),this.getBoundingBoxAt(e,Mw),Mw.getCenter(r.center);const a=o.index,l=o.attributes.position,c=this._drawRanges[e];let h=0;for(let u=c.start,d=c.start+c.count;u<d;u++){let m=u;a&&(m=a.getX(m)),Sv.fromBufferAttribute(l,m),h=Math.max(h,r.center.distanceToSquared(Sv))}r.radius=Math.sqrt(h),s.sphereInitialized=!0}return i.copy(r),i}setMatrixAt(e,i){const s=this._active,r=this._matricesTexture,o=this._matricesTexture.image.data,a=this._geometryCount;return e>=a||s[e]===!1?this:(i.toArray(o,e*16),r.needsUpdate=!0,this)}getMatrixAt(e,i){const s=this._active,r=this._matricesTexture.image.data,o=this._geometryCount;return e>=o||s[e]===!1?null:i.fromArray(r,e*16)}setVisibleAt(e,i){const s=this._visibility,r=this._active,o=this._geometryCount;return e>=o||r[e]===!1||s[e]===i?this:(s[e]=i,this._visibilityChanged=!0,this)}getVisibleAt(e){const i=this._visibility,s=this._active,r=this._geometryCount;return e>=r||s[e]===!1?!1:i[e]}raycast(e,i){const s=this._visibility,r=this._active,o=this._drawRanges,a=this._geometryCount,l=this.matrixWorld,c=this.geometry;Rr.material=this.material,Rr.geometry.index=c.index,Rr.geometry.attributes=c.attributes,Rr.geometry.boundingBox===null&&(Rr.geometry.boundingBox=new Wt),Rr.geometry.boundingSphere===null&&(Rr.geometry.boundingSphere=new tn);for(let h=0;h<a;h++){if(!s[h]||!r[h])continue;const u=o[h];Rr.geometry.setDrawRange(u.start,u.count),this.getMatrixAt(h,Rr.matrixWorld).premultiply(l),this.getBoundingBoxAt(h,Rr.geometry.boundingBox),this.getBoundingSphereAt(h,Rr.geometry.boundingSphere),Rr.raycast(e,Ew);for(let d=0,m=Ew.length;d<m;d++){const f=Ew[d];f.object=this,f.batchId=h,i.push(f)}Ew.length=0}Rr.material=null,Rr.geometry.index=null,Rr.geometry.attributes={},Rr.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._drawRanges=e._drawRanges.map(i=>({...i})),this._reservedRanges=e._reservedRanges.map(i=>({...i})),this._visibility=e._visibility.slice(),this._active=e._active.slice(),this._bounds=e._bounds.map(i=>({boxInitialized:i.boxInitialized,box:i.box.clone(),sphereInitialized:i.sphereInitialized,sphere:i.sphere.clone()})),this._maxGeometryCount=e._maxGeometryCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._geometryCount=e._geometryCount,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.slice(),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this}onBeforeRender(e,i,s,r,o){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const a=r.getIndex(),l=a===null?1:a.array.BYTES_PER_ELEMENT,c=this._active,h=this._visibility,u=this._multiDrawStarts,d=this._multiDrawCounts,m=this._drawRanges,f=this.perObjectFrustumCulled;f&&(HF.multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse).multiply(this.matrixWorld),w2.setFromProjectionMatrix(HF,e.coordinateSystem));let g=0;if(this.sortObjects){WF.copy(this.matrixWorld).invert(),Sv.setFromMatrixPosition(s.matrixWorld).applyMatrix4(WF);for(let b=0,A=h.length;b<A;b++)if(h[b]&&c[b]){this.getMatrixAt(b,Du),this.getBoundingSphereAt(b,Fp).applyMatrix4(Du);let x=!1;if(f&&(x=!w2.intersectsSphere(Fp)),!x){const w=Sv.distanceTo(Fp.center);_2.push(m[b],w)}}const y=_2.list,v=this.customSort;v===null?y.sort(o.transparent?Uee:Nee):v.call(this,y,s);for(let b=0,A=y.length;b<A;b++){const x=y[b];u[g]=x.start*l,d[g]=x.count,g++}_2.reset()}else for(let y=0,v=h.length;y<v;y++)if(h[y]&&c[y]){let b=!1;if(f&&(this.getMatrixAt(y,Du),this.getBoundingSphereAt(y,Fp).applyMatrix4(Du),b=!w2.intersectsSphere(Fp)),!b){const A=m[y];u[g]=A.start*l,d[g]=A.count,g++}}this._multiDrawCount=g,this._visibilityChanged=!1}onBeforeShadow(e,i,s,r,o,a){this.onBeforeRender(e,null,r,o,a)}}let Vi=class extends Ft{constructor(n){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Ae(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.map=n.map,this.linewidth=n.linewidth,this.linecap=n.linecap,this.linejoin=n.linejoin,this.fog=n.fog,this}};const jF=new E,QF=new E,ZF=new he,S2=new qr,Rw=new tn;let mn=class extends ye{constructor(n=new dt,e=new Vi){super(),this.isLine=!0,this.type="Line",this.geometry=n,this.material=e,this.updateMorphTargets()}copy(n,e){return super.copy(n,e),this.material=Array.isArray(n.material)?n.material.slice():n.material,this.geometry=n.geometry,this}computeLineDistances(){const n=this.geometry;if(n.index===null){const e=n.attributes.position,i=[0];for(let s=1,r=e.count;s<r;s++)jF.fromBufferAttribute(e,s-1),QF.fromBufferAttribute(e,s),i[s]=i[s-1],i[s]+=jF.distanceTo(QF);n.setAttribute("lineDistance",new st(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(n,e){const i=this.geometry,s=this.matrixWorld,r=n.params.Line.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),Rw.copy(i.boundingSphere),Rw.applyMatrix4(s),Rw.radius+=r,n.ray.intersectsSphere(Rw)===!1)return;ZF.copy(s).invert(),S2.copy(n.ray).applyMatrix4(ZF);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=new E,h=new E,u=new E,d=new E,m=this.isLineSegments?2:1,f=i.index,g=i.attributes.position;if(f!==null){const y=Math.max(0,o.start),v=Math.min(f.count,o.start+o.count);for(let b=y,A=v-1;b<A;b+=m){const x=f.getX(b),w=f.getX(b+1);if(c.fromBufferAttribute(g,x),h.fromBufferAttribute(g,w),S2.distanceSqToSegment(c,h,d,u)>l)continue;d.applyMatrix4(this.matrixWorld);const _=n.ray.origin.distanceTo(d);_<n.near||_>n.far||e.push({distance:_,point:u.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this})}}else{const y=Math.max(0,o.start),v=Math.min(g.count,o.start+o.count);for(let b=y,A=v-1;b<A;b+=m){if(c.fromBufferAttribute(g,b),h.fromBufferAttribute(g,b+1),S2.distanceSqToSegment(c,h,d,u)>l)continue;d.applyMatrix4(this.matrixWorld);const x=n.ray.origin.distanceTo(d);x<n.near||x>n.far||e.push({distance:x,point:u.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const n=this.geometry.morphAttributes,e=Object.keys(n);if(e.length>0){const i=n[e[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,r=i.length;s<r;s++){const o=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}};const YF=new E,KF=new E;let Ir=class extends mn{constructor(n,e){super(n,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const n=this.geometry;if(n.index===null){const e=n.attributes.position,i=[];for(let s=0,r=e.count;s<r;s+=2)YF.fromBufferAttribute(e,s),KF.fromBufferAttribute(e,s+1),i[s]=s===0?0:i[s-1],i[s+1]=i[s]+YF.distanceTo(KF);n.setAttribute("lineDistance",new st(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}},C2=class extends mn{constructor(n,e){super(n,e),this.isLineLoop=!0,this.type="LineLoop"}},Ou=class extends Ft{constructor(n){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Ae(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.map=n.map,this.alphaMap=n.alphaMap,this.size=n.size,this.sizeAttenuation=n.sizeAttenuation,this.fog=n.fog,this}};const JF=new he,M2=new qr,Iw=new tn,Lw=new E;let hg=class extends ye{constructor(n=new dt,e=new Ou){super(),this.isPoints=!0,this.type="Points",this.geometry=n,this.material=e,this.updateMorphTargets()}copy(n,e){return super.copy(n,e),this.material=Array.isArray(n.material)?n.material.slice():n.material,this.geometry=n.geometry,this}raycast(n,e){const i=this.geometry,s=this.matrixWorld,r=n.params.Points.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),Iw.copy(i.boundingSphere),Iw.applyMatrix4(s),Iw.radius+=r,n.ray.intersectsSphere(Iw)===!1)return;JF.copy(s).invert(),M2.copy(n.ray).applyMatrix4(JF);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=i.index,h=i.attributes.position;if(c!==null){const u=Math.max(0,o.start),d=Math.min(c.count,o.start+o.count);for(let m=u,f=d;m<f;m++){const g=c.getX(m);Lw.fromBufferAttribute(h,g),qF(Lw,g,l,s,n,e,this)}}else{const u=Math.max(0,o.start),d=Math.min(h.count,o.start+o.count);for(let m=u,f=d;m<f;m++)Lw.fromBufferAttribute(h,m),qF(Lw,m,l,s,n,e,this)}}updateMorphTargets(){const n=this.geometry.morphAttributes,e=Object.keys(n);if(e.length>0){const i=n[e[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,r=i.length;s<r;s++){const o=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}};function qF(n,e,i,s,r,o,a){const l=M2.distanceSqToPoint(n);if(l<i){const c=new E;M2.closestPointToPoint(n,c),c.applyMatrix4(s);const h=r.ray.origin.distanceTo(c);if(h<r.near||h>r.far)return;o.push({distance:h,distanceToRay:Math.sqrt(l),point:c,index:e,face:null,object:a})}}class $F extends Vt{constructor(e,i,s,r,o,a,l,c,h){super(e,i,s,r,o,a,l,c,h),this.isVideoTexture=!0,this.minFilter=a!==void 0?a:Ot,this.magFilter=o!==void 0?o:Ot,this.generateMipmaps=!1;const u=this;function d(){u.needsUpdate=!0,e.requestVideoFrameCallback(d)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(d)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!("requestVideoFrameCallback"in e)&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class Hee extends Vt{constructor(e,i){super({width:e,height:i}),this.isFramebufferTexture=!0,this.magFilter=Dt,this.minFilter=Dt,this.generateMipmaps=!1,this.needsUpdate=!0}}let Gu=class extends Vt{constructor(n,e,i,s,r,o,a,l,c,h,u,d){super(null,o,a,l,c,h,s,r,u,d),this.isCompressedTexture=!0,this.image={width:e,height:i},this.mipmaps=n,this.flipY=!1,this.generateMipmaps=!1}},jee=class extends Gu{constructor(n,e,i,s,r,o){super(n,e,i,r,o),this.isCompressedArrayTexture=!0,this.image.depth=s,this.wrapR=qn}},Qee=class extends Gu{constructor(n,e,i){super(void 0,n[0].width,n[0].height,e,i,rh),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=n}};class E2 extends Vt{constructor(e,i,s,r,o,a,l,c,h){super(e,i,s,r,o,a,l,c,h),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Ra{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,i){const s=this.getUtoTmapping(e);return this.getPoint(s,i)}getPoints(e=5){const i=[];for(let s=0;s<=e;s++)i.push(this.getPoint(s/e));return i}getSpacedPoints(e=5){const i=[];for(let s=0;s<=e;s++)i.push(this.getPointAt(s/e));return i}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const i=[];let s,r=this.getPoint(0),o=0;i.push(0);for(let a=1;a<=e;a++)s=this.getPoint(a/e),o+=s.distanceTo(r),i.push(o),r=s;return this.cacheArcLengths=i,i}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,i){const s=this.getLengths();let r=0;const o=s.length;let a;i?a=i:a=e*s[o-1];let l=0,c=o-1,h;for(;l<=c;)if(r=Math.floor(l+(c-l)/2),h=s[r]-a,h<0)l=r+1;else if(h>0)c=r-1;else{c=r;break}if(r=c,s[r]===a)return r/(o-1);const u=s[r],d=s[r+1]-u,m=(a-u)/d;return(r+m)/(o-1)}getTangent(e,i){let s=e-1e-4,r=e+1e-4;s<0&&(s=0),r>1&&(r=1);const o=this.getPoint(s),a=this.getPoint(r),l=i||(o.isVector2?new Y:new E);return l.copy(a).sub(o).normalize(),l}getTangentAt(e,i){const s=this.getUtoTmapping(e);return this.getTangent(s,i)}computeFrenetFrames(e,i){const s=new E,r=[],o=[],a=[],l=new E,c=new he;for(let f=0;f<=e;f++){const g=f/e;r[f]=this.getTangentAt(g,new E)}o[0]=new E,a[0]=new E;let h=Number.MAX_VALUE;const u=Math.abs(r[0].x),d=Math.abs(r[0].y),m=Math.abs(r[0].z);u<=h&&(h=u,s.set(1,0,0)),d<=h&&(h=d,s.set(0,1,0)),m<=h&&s.set(0,0,1),l.crossVectors(r[0],s).normalize(),o[0].crossVectors(r[0],l),a[0].crossVectors(r[0],o[0]);for(let f=1;f<=e;f++){if(o[f]=o[f-1].clone(),a[f]=a[f-1].clone(),l.crossVectors(r[f-1],r[f]),l.length()>Number.EPSILON){l.normalize();const g=Math.acos(Pn(r[f-1].dot(r[f]),-1,1));o[f].applyMatrix4(c.makeRotationAxis(l,g))}a[f].crossVectors(r[f],o[f])}if(i===!0){let f=Math.acos(Pn(o[0].dot(o[e]),-1,1));f/=e,r[0].dot(l.crossVectors(o[0],o[e]))>0&&(f=-f);for(let g=1;g<=e;g++)o[g].applyMatrix4(c.makeRotationAxis(r[g],f*g)),a[g].crossVectors(r[g],o[g])}return{tangents:r,normals:o,binormals:a}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Pw extends Ra{constructor(e=0,i=0,s=1,r=1,o=0,a=Math.PI*2,l=!1,c=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=i,this.xRadius=s,this.yRadius=r,this.aStartAngle=o,this.aEndAngle=a,this.aClockwise=l,this.aRotation=c}getPoint(e,i=new Y){const s=i,r=Math.PI*2;let o=this.aEndAngle-this.aStartAngle;const a=Math.abs(o)<Number.EPSILON;for(;o<0;)o+=r;for(;o>r;)o-=r;o<Number.EPSILON&&(a?o=0:o=r),this.aClockwise===!0&&!a&&(o===r?o=-r:o=o-r);const l=this.aStartAngle+e*o;let c=this.aX+this.xRadius*Math.cos(l),h=this.aY+this.yRadius*Math.sin(l);if(this.aRotation!==0){const u=Math.cos(this.aRotation),d=Math.sin(this.aRotation),m=c-this.aX,f=h-this.aY;c=m*u-f*d+this.aX,h=m*d+f*u+this.aY}return s.set(c,h)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class eN extends Pw{constructor(e,i,s,r,o,a){super(e,i,s,s,r,o,a),this.isArcCurve=!0,this.type="ArcCurve"}}function T2(){let n=0,e=0,i=0,s=0;function r(o,a,l,c){n=o,e=l,i=-3*o+3*a-2*l-c,s=2*o-2*a+l+c}return{initCatmullRom:function(o,a,l,c,h){r(a,l,h*(l-o),h*(c-a))},initNonuniformCatmullRom:function(o,a,l,c,h,u,d){let m=(a-o)/h-(l-o)/(h+u)+(l-a)/u,f=(l-a)/u-(c-a)/(u+d)+(c-l)/d;m*=u,f*=u,r(a,l,m,f)},calc:function(o){const a=o*o,l=a*o;return n+e*o+i*a+s*l}}}const Bw=new E,R2=new T2,I2=new T2,L2=new T2;class tN extends Ra{constructor(e=[],i=!1,s="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=i,this.curveType=s,this.tension=r}getPoint(e,i=new E){const s=i,r=this.points,o=r.length,a=(o-(this.closed?0:1))*e;let l=Math.floor(a),c=a-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/o)+1)*o:c===0&&l===o-1&&(l=o-2,c=1);let h,u;this.closed||l>0?h=r[(l-1)%o]:(Bw.subVectors(r[0],r[1]).add(r[0]),h=Bw);const d=r[l%o],m=r[(l+1)%o];if(this.closed||l+2<o?u=r[(l+2)%o]:(Bw.subVectors(r[o-1],r[o-2]).add(r[o-1]),u=Bw),this.curveType==="centripetal"||this.curveType==="chordal"){const f=this.curveType==="chordal"?.5:.25;let g=Math.pow(h.distanceToSquared(d),f),y=Math.pow(d.distanceToSquared(m),f),v=Math.pow(m.distanceToSquared(u),f);y<1e-4&&(y=1),g<1e-4&&(g=y),v<1e-4&&(v=y),R2.initNonuniformCatmullRom(h.x,d.x,m.x,u.x,g,y,v),I2.initNonuniformCatmullRom(h.y,d.y,m.y,u.y,g,y,v),L2.initNonuniformCatmullRom(h.z,d.z,m.z,u.z,g,y,v)}else this.curveType==="catmullrom"&&(R2.initCatmullRom(h.x,d.x,m.x,u.x,this.tension),I2.initCatmullRom(h.y,d.y,m.y,u.y,this.tension),L2.initCatmullRom(h.z,d.z,m.z,u.z,this.tension));return s.set(R2.calc(c),I2.calc(c),L2.calc(c)),s}copy(e){super.copy(e),this.points=[];for(let i=0,s=e.points.length;i<s;i++){const r=e.points[i];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let i=0,s=this.points.length;i<s;i++){const r=this.points[i];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let i=0,s=e.points.length;i<s;i++){const r=e.points[i];this.points.push(new E().fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function iN(n,e,i,s,r){const o=(s-e)*.5,a=(r-i)*.5,l=n*n,c=n*l;return(2*i-2*s+o+a)*c+(-3*i+3*s-2*o-a)*l+o*n+i}function Zee(n,e){const i=1-n;return i*i*e}function Yee(n,e){return 2*(1-n)*n*e}function Kee(n,e){return n*n*e}function Cv(n,e,i,s){return Zee(n,e)+Yee(n,i)+Kee(n,s)}function Jee(n,e){const i=1-n;return i*i*i*e}function qee(n,e){const i=1-n;return 3*i*i*n*e}function $ee(n,e){return 3*(1-n)*n*n*e}function ete(n,e){return n*n*n*e}function Mv(n,e,i,s,r){return Jee(n,e)+qee(n,i)+$ee(n,s)+ete(n,r)}class P2 extends Ra{constructor(e=new Y,i=new Y,s=new Y,r=new Y){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=i,this.v2=s,this.v3=r}getPoint(e,i=new Y){const s=i,r=this.v0,o=this.v1,a=this.v2,l=this.v3;return s.set(Mv(e,r.x,o.x,a.x,l.x),Mv(e,r.y,o.y,a.y,l.y)),s}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class nN extends Ra{constructor(e=new E,i=new E,s=new E,r=new E){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=i,this.v2=s,this.v3=r}getPoint(e,i=new E){const s=i,r=this.v0,o=this.v1,a=this.v2,l=this.v3;return s.set(Mv(e,r.x,o.x,a.x,l.x),Mv(e,r.y,o.y,a.y,l.y),Mv(e,r.z,o.z,a.z,l.z)),s}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class B2 extends Ra{constructor(e=new Y,i=new Y){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=i}getPoint(e,i=new Y){const s=i;return e===1?s.copy(this.v2):(s.copy(this.v2).sub(this.v1),s.multiplyScalar(e).add(this.v1)),s}getPointAt(e,i){return this.getPoint(e,i)}getTangent(e,i=new Y){return i.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,i){return this.getTangent(e,i)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class sN extends Ra{constructor(e=new E,i=new E){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=i}getPoint(e,i=new E){const s=i;return e===1?s.copy(this.v2):(s.copy(this.v2).sub(this.v1),s.multiplyScalar(e).add(this.v1)),s}getPointAt(e,i){return this.getPoint(e,i)}getTangent(e,i=new E){return i.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,i){return this.getTangent(e,i)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class k2 extends Ra{constructor(e=new Y,i=new Y,s=new Y){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=i,this.v2=s}getPoint(e,i=new Y){const s=i,r=this.v0,o=this.v1,a=this.v2;return s.set(Cv(e,r.x,o.x,a.x),Cv(e,r.y,o.y,a.y)),s}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class D2 extends Ra{constructor(e=new E,i=new E,s=new E){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=i,this.v2=s}getPoint(e,i=new E){const s=i,r=this.v0,o=this.v1,a=this.v2;return s.set(Cv(e,r.x,o.x,a.x),Cv(e,r.y,o.y,a.y),Cv(e,r.z,o.z,a.z)),s}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class O2 extends Ra{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,i=new Y){const s=i,r=this.points,o=(r.length-1)*e,a=Math.floor(o),l=o-a,c=r[a===0?a:a-1],h=r[a],u=r[a>r.length-2?r.length-1:a+1],d=r[a>r.length-3?r.length-1:a+2];return s.set(iN(l,c.x,h.x,u.x,d.x),iN(l,c.y,h.y,u.y,d.y)),s}copy(e){super.copy(e),this.points=[];for(let i=0,s=e.points.length;i<s;i++){const r=e.points[i];this.points.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let i=0,s=this.points.length;i<s;i++){const r=this.points[i];e.points.push(r.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let i=0,s=e.points.length;i<s;i++){const r=e.points[i];this.points.push(new Y().fromArray(r))}return this}}var kw=Object.freeze({__proto__:null,ArcCurve:eN,CatmullRomCurve3:tN,CubicBezierCurve:P2,CubicBezierCurve3:nN,EllipseCurve:Pw,LineCurve:B2,LineCurve3:sN,QuadraticBezierCurve:k2,QuadraticBezierCurve3:D2,SplineCurve:O2});class rN extends Ra{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),i=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(i)){const s=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new kw[s](i,e))}return this}getPoint(e,i){const s=e*this.getLength(),r=this.getCurveLengths();let o=0;for(;o<r.length;){if(r[o]>=s){const a=r[o]-s,l=this.curves[o],c=l.getLength(),h=c===0?0:1-a/c;return l.getPointAt(h,i)}o++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let i=0;for(let s=0,r=this.curves.length;s<r;s++)i+=this.curves[s].getLength(),e.push(i);return this.cacheLengths=e,e}getSpacedPoints(e=40){const i=[];for(let s=0;s<=e;s++)i.push(this.getPoint(s/e));return this.autoClose&&i.push(i[0]),i}getPoints(e=12){const i=[];let s;for(let r=0,o=this.curves;r<o.length;r++){const a=o[r],l=a.isEllipseCurve?e*2:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?e*a.points.length:e,c=a.getPoints(l);for(let h=0;h<c.length;h++){const u=c[h];s&&s.equals(u)||(i.push(u),s=u)}}return this.autoClose&&i.length>1&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i}copy(e){super.copy(e),this.curves=[];for(let i=0,s=e.curves.length;i<s;i++){const r=e.curves[i];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let i=0,s=this.curves.length;i<s;i++){const r=this.curves[i];e.curves.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let i=0,s=e.curves.length;i<s;i++){const r=e.curves[i];this.curves.push(new kw[r.type]().fromJSON(r))}return this}}class Ev extends rN{constructor(e){super(),this.type="Path",this.currentPoint=new Y,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let i=1,s=e.length;i<s;i++)this.lineTo(e[i].x,e[i].y);return this}moveTo(e,i){return this.currentPoint.set(e,i),this}lineTo(e,i){const s=new B2(this.currentPoint.clone(),new Y(e,i));return this.curves.push(s),this.currentPoint.set(e,i),this}quadraticCurveTo(e,i,s,r){const o=new k2(this.currentPoint.clone(),new Y(e,i),new Y(s,r));return this.curves.push(o),this.currentPoint.set(s,r),this}bezierCurveTo(e,i,s,r,o,a){const l=new P2(this.currentPoint.clone(),new Y(e,i),new Y(s,r),new Y(o,a));return this.curves.push(l),this.currentPoint.set(o,a),this}splineThru(e){const i=[this.currentPoint.clone()].concat(e),s=new O2(i);return this.curves.push(s),this.currentPoint.copy(e[e.length-1]),this}arc(e,i,s,r,o,a){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absarc(e+l,i+c,s,r,o,a),this}absarc(e,i,s,r,o,a){return this.absellipse(e,i,s,s,r,o,a),this}ellipse(e,i,s,r,o,a,l,c){const h=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+h,i+u,s,r,o,a,l,c),this}absellipse(e,i,s,r,o,a,l,c){const h=new Pw(e,i,s,r,o,a,l,c);if(this.curves.length>0){const d=h.getPoint(0);d.equals(this.currentPoint)||this.lineTo(d.x,d.y)}this.curves.push(h);const u=h.getPoint(1);return this.currentPoint.copy(u),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class u1 extends dt{constructor(e=[new Y(0,-.5),new Y(.5,0),new Y(0,.5)],i=12,s=0,r=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:i,phiStart:s,phiLength:r},i=Math.floor(i),r=Pn(r,0,Math.PI*2);const o=[],a=[],l=[],c=[],h=[],u=1/i,d=new E,m=new Y,f=new E,g=new E,y=new E;let v=0,b=0;for(let A=0;A<=e.length-1;A++)switch(A){case 0:v=e[A+1].x-e[A].x,b=e[A+1].y-e[A].y,f.x=b*1,f.y=-v,f.z=b*0,y.copy(f),f.normalize(),c.push(f.x,f.y,f.z);break;case e.length-1:c.push(y.x,y.y,y.z);break;default:v=e[A+1].x-e[A].x,b=e[A+1].y-e[A].y,f.x=b*1,f.y=-v,f.z=b*0,g.copy(f),f.x+=y.x,f.y+=y.y,f.z+=y.z,f.normalize(),c.push(f.x,f.y,f.z),y.copy(g)}for(let A=0;A<=i;A++){const x=s+A*u*r,w=Math.sin(x),_=Math.cos(x);for(let S=0;S<=e.length-1;S++){d.x=e[S].x*w,d.y=e[S].y,d.z=e[S].x*_,a.push(d.x,d.y,d.z),m.x=A/i,m.y=S/(e.length-1),l.push(m.x,m.y);const M=c[3*S+0]*w,R=c[3*S+1],P=c[3*S+0]*_;h.push(M,R,P)}}for(let A=0;A<i;A++)for(let x=0;x<e.length-1;x++){const w=x+A*e.length,_=w,S=w+e.length,M=w+e.length+1,R=w+1;o.push(_,S,R),o.push(M,R,S)}this.setIndex(o),this.setAttribute("position",new st(a,3)),this.setAttribute("uv",new st(l,2)),this.setAttribute("normal",new st(h,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new u1(e.points,e.segments,e.phiStart,e.phiLength)}}class wT extends u1{constructor(e=1,i=1,s=4,r=8){const o=new Ev;o.absarc(0,-i/2,e,Math.PI*1.5,0),o.absarc(0,i/2,e,0,Math.PI*.5),super(o.getPoints(s),r),this.type="CapsuleGeometry",this.parameters={radius:e,length:i,capSegments:s,radialSegments:r}}static fromJSON(e){return new wT(e.radius,e.length,e.capSegments,e.radialSegments)}}class _T extends dt{constructor(e=1,i=32,s=0,r=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:i,thetaStart:s,thetaLength:r},i=Math.max(3,i);const o=[],a=[],l=[],c=[],h=new E,u=new Y;a.push(0,0,0),l.push(0,0,1),c.push(.5,.5);for(let d=0,m=3;d<=i;d++,m+=3){const f=s+d/i*r;h.x=e*Math.cos(f),h.y=e*Math.sin(f),a.push(h.x,h.y,h.z),l.push(0,0,1),u.x=(a[m]/e+1)/2,u.y=(a[m+1]/e+1)/2,c.push(u.x,u.y)}for(let d=1;d<=i;d++)o.push(d,d+1,0);this.setIndex(o),this.setAttribute("position",new st(a,3)),this.setAttribute("normal",new st(l,3)),this.setAttribute("uv",new st(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new _T(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class Yn extends dt{constructor(e=1,i=1,s=1,r=32,o=1,a=!1,l=0,c=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:i,height:s,radialSegments:r,heightSegments:o,openEnded:a,thetaStart:l,thetaLength:c};const h=this;r=Math.floor(r),o=Math.floor(o);const u=[],d=[],m=[],f=[];let g=0;const y=[],v=s/2;let b=0;A(),a===!1&&(e>0&&x(!0),i>0&&x(!1)),this.setIndex(u),this.setAttribute("position",new st(d,3)),this.setAttribute("normal",new st(m,3)),this.setAttribute("uv",new st(f,2));function A(){const w=new E,_=new E;let S=0;const M=(i-e)/s;for(let R=0;R<=o;R++){const P=[],C=R/o,L=C*(i-e)+e;for(let B=0;B<=r;B++){const z=B/r,D=z*c+l,W=Math.sin(D),O=Math.cos(D);_.x=L*W,_.y=-C*s+v,_.z=L*O,d.push(_.x,_.y,_.z),w.set(W,M,O).normalize(),m.push(w.x,w.y,w.z),f.push(z,1-C),P.push(g++)}y.push(P)}for(let R=0;R<r;R++)for(let P=0;P<o;P++){const C=y[P][R],L=y[P+1][R],B=y[P+1][R+1],z=y[P][R+1];u.push(C,L,z),u.push(L,B,z),S+=6}h.addGroup(b,S,0),b+=S}function x(w){const _=g,S=new Y,M=new E;let R=0;const P=w===!0?e:i,C=w===!0?1:-1;for(let B=1;B<=r;B++)d.push(0,v*C,0),m.push(0,C,0),f.push(.5,.5),g++;const L=g;for(let B=0;B<=r;B++){const z=B/r*c+l,D=Math.cos(z),W=Math.sin(z);M.x=P*W,M.y=v*C,M.z=P*D,d.push(M.x,M.y,M.z),m.push(0,C,0),S.x=D*.5+.5,S.y=W*.5*C+.5,f.push(S.x,S.y),g++}for(let B=0;B<r;B++){const z=_+B,D=L+B;w===!0?u.push(D,D+1,z):u.push(D+1,D,z),R+=3}h.addGroup(b,R,w===!0?1:2),b+=R}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Yn(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class ST extends Yn{constructor(e=1,i=1,s=32,r=1,o=!1,a=0,l=Math.PI*2){super(0,e,i,s,r,o,a,l),this.type="ConeGeometry",this.parameters={radius:e,height:i,radialSegments:s,heightSegments:r,openEnded:o,thetaStart:a,thetaLength:l}}static fromJSON(e){return new ST(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class pp extends dt{constructor(e=[],i=[],s=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:i,radius:s,detail:r};const o=[],a=[];l(r),h(s),u(),this.setAttribute("position",new st(o,3)),this.setAttribute("normal",new st(o.slice(),3)),this.setAttribute("uv",new st(a,2)),r===0?this.computeVertexNormals():this.normalizeNormals();function l(A){const x=new E,w=new E,_=new E;for(let S=0;S<i.length;S+=3)f(i[S+0],x),f(i[S+1],w),f(i[S+2],_),c(x,w,_,A)}function c(A,x,w,_){const S=_+1,M=[];for(let R=0;R<=S;R++){M[R]=[];const P=A.clone().lerp(w,R/S),C=x.clone().lerp(w,R/S),L=S-R;for(let B=0;B<=L;B++)B===0&&R===S?M[R][B]=P:M[R][B]=P.clone().lerp(C,B/L)}for(let R=0;R<S;R++)for(let P=0;P<2*(S-R)-1;P++){const C=Math.floor(P/2);P%2===0?(m(M[R][C+1]),m(M[R+1][C]),m(M[R][C])):(m(M[R][C+1]),m(M[R+1][C+1]),m(M[R+1][C]))}}function h(A){const x=new E;for(let w=0;w<o.length;w+=3)x.x=o[w+0],x.y=o[w+1],x.z=o[w+2],x.normalize().multiplyScalar(A),o[w+0]=x.x,o[w+1]=x.y,o[w+2]=x.z}function u(){const A=new E;for(let x=0;x<o.length;x+=3){A.x=o[x+0],A.y=o[x+1],A.z=o[x+2];const w=v(A)/2/Math.PI+.5,_=b(A)/Math.PI+.5;a.push(w,1-_)}g(),d()}function d(){for(let A=0;A<a.length;A+=6){const x=a[A+0],w=a[A+2],_=a[A+4],S=Math.max(x,w,_),M=Math.min(x,w,_);S>.9&&M<.1&&(x<.2&&(a[A+0]+=1),w<.2&&(a[A+2]+=1),_<.2&&(a[A+4]+=1))}}function m(A){o.push(A.x,A.y,A.z)}function f(A,x){const w=A*3;x.x=e[w+0],x.y=e[w+1],x.z=e[w+2]}function g(){const A=new E,x=new E,w=new E,_=new E,S=new Y,M=new Y,R=new Y;for(let P=0,C=0;P<o.length;P+=9,C+=6){A.set(o[P+0],o[P+1],o[P+2]),x.set(o[P+3],o[P+4],o[P+5]),w.set(o[P+6],o[P+7],o[P+8]),S.set(a[C+0],a[C+1]),M.set(a[C+2],a[C+3]),R.set(a[C+4],a[C+5]),_.copy(A).add(x).add(w).divideScalar(3);const L=v(_);y(S,C+0,A,L),y(M,C+2,x,L),y(R,C+4,w,L)}}function y(A,x,w,_){_<0&&A.x===1&&(a[x]=A.x-1),w.x===0&&w.z===0&&(a[x]=_/2/Math.PI+.5)}function v(A){return Math.atan2(A.z,-A.x)}function b(A){return Math.atan2(-A.y,Math.sqrt(A.x*A.x+A.z*A.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new pp(e.vertices,e.indices,e.radius,e.details)}}class CT extends pp{constructor(e=1,i=0){const s=(1+Math.sqrt(5))/2,r=1/s,o=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-s,0,-r,s,0,r,-s,0,r,s,-r,-s,0,-r,s,0,r,-s,0,r,s,0,-s,0,-r,s,0,-r,-s,0,r,s,0,r],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(o,a,e,i),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new CT(e.radius,e.detail)}}const Dw=new E,Ow=new E,G2=new E,Gw=new Ks;class z2 extends dt{constructor(e=null,i=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:i},e!==null){const s=Math.pow(10,4),r=Math.cos(Ep*i),o=e.getIndex(),a=e.getAttribute("position"),l=o?o.count:a.count,c=[0,0,0],h=["a","b","c"],u=new Array(3),d={},m=[];for(let f=0;f<l;f+=3){o?(c[0]=o.getX(f),c[1]=o.getX(f+1),c[2]=o.getX(f+2)):(c[0]=f,c[1]=f+1,c[2]=f+2);const{a:g,b:y,c:v}=Gw;if(g.fromBufferAttribute(a,c[0]),y.fromBufferAttribute(a,c[1]),v.fromBufferAttribute(a,c[2]),Gw.getNormal(G2),u[0]=`${Math.round(g.x*s)},${Math.round(g.y*s)},${Math.round(g.z*s)}`,u[1]=`${Math.round(y.x*s)},${Math.round(y.y*s)},${Math.round(y.z*s)}`,u[2]=`${Math.round(v.x*s)},${Math.round(v.y*s)},${Math.round(v.z*s)}`,!(u[0]===u[1]||u[1]===u[2]||u[2]===u[0]))for(let b=0;b<3;b++){const A=(b+1)%3,x=u[b],w=u[A],_=Gw[h[b]],S=Gw[h[A]],M=`${x}_${w}`,R=`${w}_${x}`;R in d&&d[R]?(G2.dot(d[R].normal)<=r&&(m.push(_.x,_.y,_.z),m.push(S.x,S.y,S.z)),d[R]=null):M in d||(d[M]={index0:c[b],index1:c[A],normal:G2.clone()})}}for(const f in d)if(d[f]){const{index0:g,index1:y}=d[f];Dw.fromBufferAttribute(a,g),Ow.fromBufferAttribute(a,y),m.push(Dw.x,Dw.y,Dw.z),m.push(Ow.x,Ow.y,Ow.z)}this.setAttribute("position",new st(m,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class zu extends Ev{constructor(e){super(e),this.uuid=Vo(),this.type="Shape",this.holes=[]}getPointsHoles(e){const i=[];for(let s=0,r=this.holes.length;s<r;s++)i[s]=this.holes[s].getPoints(e);return i}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let i=0,s=e.holes.length;i<s;i++){const r=e.holes[i];this.holes.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let i=0,s=this.holes.length;i<s;i++){const r=this.holes[i];e.holes.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let i=0,s=e.holes.length;i<s;i++){const r=e.holes[i];this.holes.push(new Ev().fromJSON(r))}return this}}const tte={triangulate:function(n,e,i=2){const s=e&&e.length,r=s?e[0]*i:n.length;let o=oN(n,0,r,i,!0);const a=[];if(!o||o.next===o.prev)return a;let l,c,h,u,d,m,f;if(s&&(o=ote(n,e,o,i)),n.length>80*i){l=h=n[0],c=u=n[1];for(let g=i;g<r;g+=i)d=n[g],m=n[g+1],d<l&&(l=d),m<c&&(c=m),d>h&&(h=d),m>u&&(u=m);f=Math.max(h-l,u-c),f=f!==0?32767/f:0}return Tv(o,a,i,l,c,f,0),a}};function oN(n,e,i,s,r){let o,a;if(r===yte(n,e,i,s)>0)for(o=e;o<i;o+=s)a=cN(o,n[o],n[o+1],a);else for(o=i-s;o>=e;o-=s)a=cN(o,n[o],n[o+1],a);return a&&zw(a,a.next)&&(Iv(a),a=a.next),a}function Np(n,e){if(!n)return n;e||(e=n);let i=n,s;do if(s=!1,!i.steiner&&(zw(i,i.next)||_n(i.prev,i,i.next)===0)){if(Iv(i),i=e=i.prev,i===i.next)break;s=!0}else i=i.next;while(s||i!==e);return e}function Tv(n,e,i,s,r,o,a){if(!n)return;!a&&o&&ute(n,s,r,o);let l=n,c,h;for(;n.prev!==n.next;){if(c=n.prev,h=n.next,o?nte(n,s,r,o):ite(n)){e.push(c.i/i|0),e.push(n.i/i|0),e.push(h.i/i|0),Iv(n),n=h.next,l=h.next;continue}if(n=h,n===l){a?a===1?(n=ste(Np(n),e,i),Tv(n,e,i,s,r,o,2)):a===2&&rte(n,e,i,s,r,o):Tv(Np(n),e,i,s,r,o,1);break}}}function ite(n){const e=n.prev,i=n,s=n.next;if(_n(e,i,s)>=0)return!1;const r=e.x,o=i.x,a=s.x,l=e.y,c=i.y,h=s.y,u=r<o?r<a?r:a:o<a?o:a,d=l<c?l<h?l:h:c<h?c:h,m=r>o?r>a?r:a:o>a?o:a,f=l>c?l>h?l:h:c>h?c:h;let g=s.next;for(;g!==e;){if(g.x>=u&&g.x<=m&&g.y>=d&&g.y<=f&&ug(r,l,o,c,a,h,g.x,g.y)&&_n(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function nte(n,e,i,s){const r=n.prev,o=n,a=n.next;if(_n(r,o,a)>=0)return!1;const l=r.x,c=o.x,h=a.x,u=r.y,d=o.y,m=a.y,f=l<c?l<h?l:h:c<h?c:h,g=u<d?u<m?u:m:d<m?d:m,y=l>c?l>h?l:h:c>h?c:h,v=u>d?u>m?u:m:d>m?d:m,b=F2(f,g,e,i,s),A=F2(y,v,e,i,s);let x=n.prevZ,w=n.nextZ;for(;x&&x.z>=b&&w&&w.z<=A;){if(x.x>=f&&x.x<=y&&x.y>=g&&x.y<=v&&x!==r&&x!==a&&ug(l,u,c,d,h,m,x.x,x.y)&&_n(x.prev,x,x.next)>=0||(x=x.prevZ,w.x>=f&&w.x<=y&&w.y>=g&&w.y<=v&&w!==r&&w!==a&&ug(l,u,c,d,h,m,w.x,w.y)&&_n(w.prev,w,w.next)>=0))return!1;w=w.nextZ}for(;x&&x.z>=b;){if(x.x>=f&&x.x<=y&&x.y>=g&&x.y<=v&&x!==r&&x!==a&&ug(l,u,c,d,h,m,x.x,x.y)&&_n(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;w&&w.z<=A;){if(w.x>=f&&w.x<=y&&w.y>=g&&w.y<=v&&w!==r&&w!==a&&ug(l,u,c,d,h,m,w.x,w.y)&&_n(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function ste(n,e,i){let s=n;do{const r=s.prev,o=s.next.next;!zw(r,o)&&aN(r,s,s.next,o)&&Rv(r,o)&&Rv(o,r)&&(e.push(r.i/i|0),e.push(s.i/i|0),e.push(o.i/i|0),Iv(s),Iv(s.next),s=n=o),s=s.next}while(s!==n);return Np(s)}function rte(n,e,i,s,r,o){let a=n;do{let l=a.next.next;for(;l!==a.prev;){if(a.i!==l.i&&mte(a,l)){let c=lN(a,l);a=Np(a,a.next),c=Np(c,c.next),Tv(a,e,i,s,r,o,0),Tv(c,e,i,s,r,o,0);return}l=l.next}a=a.next}while(a!==n)}function ote(n,e,i,s){const r=[];let o,a,l,c,h;for(o=0,a=e.length;o<a;o++)l=e[o]*s,c=o<a-1?e[o+1]*s:n.length,h=oN(n,l,c,s,!1),h===h.next&&(h.steiner=!0),r.push(pte(h));for(r.sort(ate),o=0;o<r.length;o++)i=lte(r[o],i);return i}function ate(n,e){return n.x-e.x}function lte(n,e){const i=cte(n,e);if(!i)return e;const s=lN(i,n);return Np(s,s.next),Np(i,i.next)}function cte(n,e){let i=e,s=-1/0,r;const o=n.x,a=n.y;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){const m=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(m<=o&&m>s&&(s=m,r=i.x<i.next.x?i:i.next,m===o))return r}i=i.next}while(i!==e);if(!r)return null;const l=r,c=r.x,h=r.y;let u=1/0,d;i=r;do o>=i.x&&i.x>=c&&o!==i.x&&ug(a<h?o:s,a,c,h,a<h?s:o,a,i.x,i.y)&&(d=Math.abs(a-i.y)/(o-i.x),Rv(i,n)&&(d<u||d===u&&(i.x>r.x||i.x===r.x&&hte(r,i)))&&(r=i,u=d)),i=i.next;while(i!==l);return r}function hte(n,e){return _n(n.prev,n,e.prev)<0&&_n(e.next,n,n.next)<0}function ute(n,e,i,s){let r=n;do r.z===0&&(r.z=F2(r.x,r.y,e,i,s)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==n);r.prevZ.nextZ=null,r.prevZ=null,dte(r)}function dte(n){let e,i,s,r,o,a,l,c,h=1;do{for(i=n,n=null,o=null,a=0;i;){for(a++,s=i,l=0,e=0;e<h&&(l++,s=s.nextZ,!!s);e++);for(c=h;l>0||c>0&&s;)l!==0&&(c===0||!s||i.z<=s.z)?(r=i,i=i.nextZ,l--):(r=s,s=s.nextZ,c--),o?o.nextZ=r:n=r,r.prevZ=o,o=r;i=s}o.nextZ=null,h*=2}while(a>1);return n}function F2(n,e,i,s,r){return n=(n-i)*r|0,e=(e-s)*r|0,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,n|e<<1}function pte(n){let e=n,i=n;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==n);return i}function ug(n,e,i,s,r,o,a,l){return(r-a)*(e-l)>=(n-a)*(o-l)&&(n-a)*(s-l)>=(i-a)*(e-l)&&(i-a)*(o-l)>=(r-a)*(s-l)}function mte(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!fte(n,e)&&(Rv(n,e)&&Rv(e,n)&&gte(n,e)&&(_n(n.prev,n,e.prev)||_n(n,e.prev,e))||zw(n,e)&&_n(n.prev,n,n.next)>0&&_n(e.prev,e,e.next)>0)}function _n(n,e,i){return(e.y-n.y)*(i.x-e.x)-(e.x-n.x)*(i.y-e.y)}function zw(n,e){return n.x===e.x&&n.y===e.y}function aN(n,e,i,s){const r=Nw(_n(n,e,i)),o=Nw(_n(n,e,s)),a=Nw(_n(i,s,n)),l=Nw(_n(i,s,e));return!!(r!==o&&a!==l||r===0&&Fw(n,i,e)||o===0&&Fw(n,s,e)||a===0&&Fw(i,n,s)||l===0&&Fw(i,e,s))}function Fw(n,e,i){return e.x<=Math.max(n.x,i.x)&&e.x>=Math.min(n.x,i.x)&&e.y<=Math.max(n.y,i.y)&&e.y>=Math.min(n.y,i.y)}function Nw(n){return n>0?1:n<0?-1:0}function fte(n,e){let i=n;do{if(i.i!==n.i&&i.next.i!==n.i&&i.i!==e.i&&i.next.i!==e.i&&aN(i,i.next,n,e))return!0;i=i.next}while(i!==n);return!1}function Rv(n,e){return _n(n.prev,n,n.next)<0?_n(n,e,n.next)>=0&&_n(n,n.prev,e)>=0:_n(n,e,n.prev)<0||_n(n,n.next,e)<0}function gte(n,e){let i=n,s=!1;const r=(n.x+e.x)/2,o=(n.y+e.y)/2;do i.y>o!=i.next.y>o&&i.next.y!==i.y&&r<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(s=!s),i=i.next;while(i!==n);return s}function lN(n,e){const i=new N2(n.i,n.x,n.y),s=new N2(e.i,e.x,e.y),r=n.next,o=e.prev;return n.next=e,e.prev=n,i.next=r,r.prev=i,s.next=i,i.prev=s,o.next=s,s.prev=o,s}function cN(n,e,i,s){const r=new N2(n,e,i);return s?(r.next=s.next,r.prev=s,s.next.prev=r,s.next=r):(r.prev=r,r.next=r),r}function Iv(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function N2(n,e,i){this.i=n,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function yte(n,e,i,s){let r=0;for(let o=e,a=i-s;o<i;o+=s)r+=(n[a]-n[o])*(n[o+1]+n[a+1]),a=o;return r}class Yl{static area(e){const i=e.length;let s=0;for(let r=i-1,o=0;o<i;r=o++)s+=e[r].x*e[o].y-e[o].x*e[r].y;return s*.5}static isClockWise(e){return Yl.area(e)<0}static triangulateShape(e,i){const s=[],r=[],o=[];hN(e),uN(s,e);let a=e.length;i.forEach(hN);for(let c=0;c<i.length;c++)r.push(a),a+=i[c].length,uN(s,i[c]);const l=tte.triangulate(s,r);for(let c=0;c<l.length;c+=3)o.push(l.slice(c,c+3));return o}}function hN(n){const e=n.length;e>2&&n[e-1].equals(n[0])&&n.pop()}function uN(n,e){for(let i=0;i<e.length;i++)n.push(e[i].x),n.push(e[i].y)}class Fy extends dt{constructor(e=new zu([new Y(.5,.5),new Y(-.5,.5),new Y(-.5,-.5),new Y(.5,-.5)]),i={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:i},e=Array.isArray(e)?e:[e];const s=this,r=[],o=[];for(let l=0,c=e.length;l<c;l++){const h=e[l];a(h)}this.setAttribute("position",new st(r,3)),this.setAttribute("uv",new st(o,2)),this.computeVertexNormals();function a(l){const c=[],h=i.curveSegments!==void 0?i.curveSegments:12,u=i.steps!==void 0?i.steps:1,d=i.depth!==void 0?i.depth:1;let m=i.bevelEnabled!==void 0?i.bevelEnabled:!0,f=i.bevelThickness!==void 0?i.bevelThickness:.2,g=i.bevelSize!==void 0?i.bevelSize:f-.1,y=i.bevelOffset!==void 0?i.bevelOffset:0,v=i.bevelSegments!==void 0?i.bevelSegments:3;const b=i.extrudePath,A=i.UVGenerator!==void 0?i.UVGenerator:vte;let x,w=!1,_,S,M,R;b&&(x=b.getSpacedPoints(u),w=!0,m=!1,_=b.computeFrenetFrames(u,!1),S=new E,M=new E,R=new E),m||(v=0,f=0,g=0,y=0);const P=l.extractPoints(h);let C=P.shape;const L=P.holes;if(!Yl.isClockWise(C)){C=C.reverse();for(let ge=0,Q=L.length;ge<Q;ge++){const Ne=L[ge];Yl.isClockWise(Ne)&&(L[ge]=Ne.reverse())}}const B=Yl.triangulateShape(C,L),z=C;for(let ge=0,Q=L.length;ge<Q;ge++){const Ne=L[ge];C=C.concat(Ne)}function D(ge,Q,Ne){return Q||console.error("THREE.ExtrudeGeometry: vec does not exist"),ge.clone().addScaledVector(Q,Ne)}const W=C.length,O=B.length;function F(ge,Q,Ne){let Re,Te,We;const be=ge.x-Q.x,nt=ge.y-Q.y,ct=Ne.x-ge.x,It=Ne.y-ge.y,H=be*be+nt*nt,G=be*It-nt*ct;if(Math.abs(G)>Number.EPSILON){const ue=Math.sqrt(H),Ee=Math.sqrt(ct*ct+It*It),De=Q.x-nt/ue,Le=Q.y+be/ue,At=Ne.x-It/Ee,ht=Ne.y+ct/Ee,Ue=((At-De)*It-(ht-Le)*ct)/(be*It-nt*ct);Re=De+be*Ue-ge.x,Te=Le+nt*Ue-ge.y;const Xe=Re*Re+Te*Te;if(Xe<=2)return new Y(Re,Te);We=Math.sqrt(Xe/2)}else{let ue=!1;be>Number.EPSILON?ct>Number.EPSILON&&(ue=!0):be<-Number.EPSILON?ct<-Number.EPSILON&&(ue=!0):Math.sign(nt)===Math.sign(It)&&(ue=!0),ue?(Re=-nt,Te=be,We=Math.sqrt(H)):(Re=be,Te=nt,We=Math.sqrt(H/2))}return new Y(Re/We,Te/We)}const X=[];for(let ge=0,Q=z.length,Ne=Q-1,Re=ge+1;ge<Q;ge++,Ne++,Re++)Ne===Q&&(Ne=0),Re===Q&&(Re=0),X[ge]=F(z[ge],z[Ne],z[Re]);const J=[];let q,oe=X.concat();for(let ge=0,Q=L.length;ge<Q;ge++){const Ne=L[ge];q=[];for(let Re=0,Te=Ne.length,We=Te-1,be=Re+1;Re<Te;Re++,We++,be++)We===Te&&(We=0),be===Te&&(be=0),q[Re]=F(Ne[Re],Ne[We],Ne[be]);J.push(q),oe=oe.concat(q)}for(let ge=0;ge<v;ge++){const Q=ge/v,Ne=f*Math.cos(Q*Math.PI/2),Re=g*Math.sin(Q*Math.PI/2)+y;for(let Te=0,We=z.length;Te<We;Te++){const be=D(z[Te],X[Te],Re);Me(be.x,be.y,-Ne)}for(let Te=0,We=L.length;Te<We;Te++){const be=L[Te];q=J[Te];for(let nt=0,ct=be.length;nt<ct;nt++){const It=D(be[nt],q[nt],Re);Me(It.x,It.y,-Ne)}}}const _e=g+y;for(let ge=0;ge<W;ge++){const Q=m?D(C[ge],oe[ge],_e):C[ge];w?(M.copy(_.normals[0]).multiplyScalar(Q.x),S.copy(_.binormals[0]).multiplyScalar(Q.y),R.copy(x[0]).add(M).add(S),Me(R.x,R.y,R.z)):Me(Q.x,Q.y,0)}for(let ge=1;ge<=u;ge++)for(let Q=0;Q<W;Q++){const Ne=m?D(C[Q],oe[Q],_e):C[Q];w?(M.copy(_.normals[ge]).multiplyScalar(Ne.x),S.copy(_.binormals[ge]).multiplyScalar(Ne.y),R.copy(x[ge]).add(M).add(S),Me(R.x,R.y,R.z)):Me(Ne.x,Ne.y,d/u*ge)}for(let ge=v-1;ge>=0;ge--){const Q=ge/v,Ne=f*Math.cos(Q*Math.PI/2),Re=g*Math.sin(Q*Math.PI/2)+y;for(let Te=0,We=z.length;Te<We;Te++){const be=D(z[Te],X[Te],Re);Me(be.x,be.y,d+Ne)}for(let Te=0,We=L.length;Te<We;Te++){const be=L[Te];q=J[Te];for(let nt=0,ct=be.length;nt<ct;nt++){const It=D(be[nt],q[nt],Re);w?Me(It.x,It.y+x[u-1].y,x[u-1].x+Ne):Me(It.x,It.y,d+Ne)}}}ke(),re();function ke(){const ge=r.length/3;if(m){let Q=0,Ne=W*Q;for(let Re=0;Re<O;Re++){const Te=B[Re];it(Te[2]+Ne,Te[1]+Ne,Te[0]+Ne)}Q=u+v*2,Ne=W*Q;for(let Re=0;Re<O;Re++){const Te=B[Re];it(Te[0]+Ne,Te[1]+Ne,Te[2]+Ne)}}else{for(let Q=0;Q<O;Q++){const Ne=B[Q];it(Ne[2],Ne[1],Ne[0])}for(let Q=0;Q<O;Q++){const Ne=B[Q];it(Ne[0]+W*u,Ne[1]+W*u,Ne[2]+W*u)}}s.addGroup(ge,r.length/3-ge,0)}function re(){const ge=r.length/3;let Q=0;we(z,Q),Q+=z.length;for(let Ne=0,Re=L.length;Ne<Re;Ne++){const Te=L[Ne];we(Te,Q),Q+=Te.length}s.addGroup(ge,r.length/3-ge,1)}function we(ge,Q){let Ne=ge.length;for(;--Ne>=0;){const Re=Ne;let Te=Ne-1;Te<0&&(Te=ge.length-1);for(let We=0,be=u+v*2;We<be;We++){const nt=W*We,ct=W*(We+1),It=Q+Re+nt,H=Q+Te+nt,G=Q+Te+ct,ue=Q+Re+ct;je(It,H,G,ue)}}}function Me(ge,Q,Ne){c.push(ge),c.push(Q),c.push(Ne)}function it(ge,Q,Ne){Ge(ge),Ge(Q),Ge(Ne);const Re=r.length/3,Te=A.generateTopUV(s,r,Re-3,Re-2,Re-1);rt(Te[0]),rt(Te[1]),rt(Te[2])}function je(ge,Q,Ne,Re){Ge(ge),Ge(Q),Ge(Re),Ge(Q),Ge(Ne),Ge(Re);const Te=r.length/3,We=A.generateSideWallUV(s,r,Te-6,Te-3,Te-2,Te-1);rt(We[0]),rt(We[1]),rt(We[3]),rt(We[1]),rt(We[2]),rt(We[3])}function Ge(ge){r.push(c[ge*3+0]),r.push(c[ge*3+1]),r.push(c[ge*3+2])}function rt(ge){o.push(ge.x),o.push(ge.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),i=this.parameters.shapes,s=this.parameters.options;return bte(i,s,e)}static fromJSON(e,i){const s=[];for(let o=0,a=e.shapes.length;o<a;o++){const l=i[e.shapes[o]];s.push(l)}const r=e.options.extrudePath;return r!==void 0&&(e.options.extrudePath=new kw[r.type]().fromJSON(r)),new Fy(s,e.options)}}const vte={generateTopUV:function(n,e,i,s,r){const o=e[i*3],a=e[i*3+1],l=e[s*3],c=e[s*3+1],h=e[r*3],u=e[r*3+1];return[new Y(o,a),new Y(l,c),new Y(h,u)]},generateSideWallUV:function(n,e,i,s,r,o){const a=e[i*3],l=e[i*3+1],c=e[i*3+2],h=e[s*3],u=e[s*3+1],d=e[s*3+2],m=e[r*3],f=e[r*3+1],g=e[r*3+2],y=e[o*3],v=e[o*3+1],b=e[o*3+2];return Math.abs(l-u)<Math.abs(a-h)?[new Y(a,1-c),new Y(h,1-d),new Y(m,1-g),new Y(y,1-b)]:[new Y(l,1-c),new Y(u,1-d),new Y(f,1-g),new Y(v,1-b)]}};function bte(n,e,i){if(i.shapes=[],Array.isArray(n))for(let s=0,r=n.length;s<r;s++){const o=n[s];i.shapes.push(o.uuid)}else i.shapes.push(n.uuid);return i.options=Object.assign({},e),e.extrudePath!==void 0&&(i.options.extrudePath=e.extrudePath.toJSON()),i}class MT extends pp{constructor(e=1,i=0){const s=(1+Math.sqrt(5))/2,r=[-1,s,0,1,s,0,-1,-s,0,1,-s,0,0,-1,s,0,1,s,0,-1,-s,0,1,-s,s,0,-1,s,0,1,-s,0,-1,-s,0,1],o=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(r,o,e,i),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new MT(e.radius,e.detail)}}class mu extends pp{constructor(e=1,i=0){const s=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],r=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(s,r,e,i),this.type="OctahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new mu(e.radius,e.detail)}}class d1 extends dt{constructor(e=.5,i=1,s=32,r=1,o=0,a=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:i,thetaSegments:s,phiSegments:r,thetaStart:o,thetaLength:a},s=Math.max(3,s),r=Math.max(1,r);const l=[],c=[],h=[],u=[];let d=e;const m=(i-e)/r,f=new E,g=new Y;for(let y=0;y<=r;y++){for(let v=0;v<=s;v++){const b=o+v/s*a;f.x=d*Math.cos(b),f.y=d*Math.sin(b),c.push(f.x,f.y,f.z),h.push(0,0,1),g.x=(f.x/i+1)/2,g.y=(f.y/i+1)/2,u.push(g.x,g.y)}d+=m}for(let y=0;y<r;y++){const v=y*(s+1);for(let b=0;b<s;b++){const A=b+v,x=A,w=A+s+1,_=A+s+2,S=A+1;l.push(x,w,S),l.push(w,_,S)}}this.setIndex(l),this.setAttribute("position",new st(c,3)),this.setAttribute("normal",new st(h,3)),this.setAttribute("uv",new st(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new d1(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class ET extends dt{constructor(e=new zu([new Y(0,.5),new Y(-.5,-.5),new Y(.5,-.5)]),i=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:i};const s=[],r=[],o=[],a=[];let l=0,c=0;if(Array.isArray(e)===!1)h(e);else for(let u=0;u<e.length;u++)h(e[u]),this.addGroup(l,c,u),l+=c,c=0;this.setIndex(s),this.setAttribute("position",new st(r,3)),this.setAttribute("normal",new st(o,3)),this.setAttribute("uv",new st(a,2));function h(u){const d=r.length/3,m=u.extractPoints(i);let f=m.shape;const g=m.holes;Yl.isClockWise(f)===!1&&(f=f.reverse());for(let v=0,b=g.length;v<b;v++){const A=g[v];Yl.isClockWise(A)===!0&&(g[v]=A.reverse())}const y=Yl.triangulateShape(f,g);for(let v=0,b=g.length;v<b;v++){const A=g[v];f=f.concat(A)}for(let v=0,b=f.length;v<b;v++){const A=f[v];r.push(A.x,A.y,0),o.push(0,0,1),a.push(A.x,A.y)}for(let v=0,b=y.length;v<b;v++){const A=y[v],x=A[0]+d,w=A[1]+d,_=A[2]+d;s.push(x,w,_),c+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),i=this.parameters.shapes;return Ate(i,e)}static fromJSON(e,i){const s=[];for(let r=0,o=e.shapes.length;r<o;r++){const a=i[e.shapes[r]];s.push(a)}return new ET(s,e.curveSegments)}}function Ate(n,e){if(e.shapes=[],Array.isArray(n))for(let i=0,s=n.length;i<s;i++){const r=n[i];e.shapes.push(r.uuid)}else e.shapes.push(n.uuid);return e}class al extends dt{constructor(e=1,i=32,s=16,r=0,o=Math.PI*2,a=0,l=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:i,heightSegments:s,phiStart:r,phiLength:o,thetaStart:a,thetaLength:l},i=Math.max(3,Math.floor(i)),s=Math.max(2,Math.floor(s));const c=Math.min(a+l,Math.PI);let h=0;const u=[],d=new E,m=new E,f=[],g=[],y=[],v=[];for(let b=0;b<=s;b++){const A=[],x=b/s;let w=0;b===0&&a===0?w=.5/i:b===s&&c===Math.PI&&(w=-.5/i);for(let _=0;_<=i;_++){const S=_/i;d.x=-e*Math.cos(r+S*o)*Math.sin(a+x*l),d.y=e*Math.cos(a+x*l),d.z=e*Math.sin(r+S*o)*Math.sin(a+x*l),g.push(d.x,d.y,d.z),m.copy(d).normalize(),y.push(m.x,m.y,m.z),v.push(S+w,1-x),A.push(h++)}u.push(A)}for(let b=0;b<s;b++)for(let A=0;A<i;A++){const x=u[b][A+1],w=u[b][A],_=u[b+1][A],S=u[b+1][A+1];(b!==0||a>0)&&f.push(x,w,S),(b!==s-1||c<Math.PI)&&f.push(w,_,S)}this.setIndex(f),this.setAttribute("position",new st(g,3)),this.setAttribute("normal",new st(y,3)),this.setAttribute("uv",new st(v,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new al(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class TT extends pp{constructor(e=1,i=0){const s=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],r=[2,1,0,0,3,2,1,3,0,2,3,1];super(s,r,e,i),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new TT(e.radius,e.detail)}}class fu extends dt{constructor(e=1,i=.4,s=12,r=48,o=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:i,radialSegments:s,tubularSegments:r,arc:o},s=Math.floor(s),r=Math.floor(r);const a=[],l=[],c=[],h=[],u=new E,d=new E,m=new E;for(let f=0;f<=s;f++)for(let g=0;g<=r;g++){const y=g/r*o,v=f/s*Math.PI*2;d.x=(e+i*Math.cos(v))*Math.cos(y),d.y=(e+i*Math.cos(v))*Math.sin(y),d.z=i*Math.sin(v),l.push(d.x,d.y,d.z),u.x=e*Math.cos(y),u.y=e*Math.sin(y),m.subVectors(d,u).normalize(),c.push(m.x,m.y,m.z),h.push(g/r),h.push(f/s)}for(let f=1;f<=s;f++)for(let g=1;g<=r;g++){const y=(r+1)*f+g-1,v=(r+1)*(f-1)+g-1,b=(r+1)*(f-1)+g,A=(r+1)*f+g;a.push(y,v,A),a.push(v,b,A)}this.setIndex(a),this.setAttribute("position",new st(l,3)),this.setAttribute("normal",new st(c,3)),this.setAttribute("uv",new st(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new fu(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class RT extends dt{constructor(e=1,i=.4,s=64,r=8,o=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:i,tubularSegments:s,radialSegments:r,p:o,q:a},s=Math.floor(s),r=Math.floor(r);const l=[],c=[],h=[],u=[],d=new E,m=new E,f=new E,g=new E,y=new E,v=new E,b=new E;for(let x=0;x<=s;++x){const w=x/s*o*Math.PI*2;A(w,o,a,e,f),A(w+.01,o,a,e,g),v.subVectors(g,f),b.addVectors(g,f),y.crossVectors(v,b),b.crossVectors(y,v),y.normalize(),b.normalize();for(let _=0;_<=r;++_){const S=_/r*Math.PI*2,M=-i*Math.cos(S),R=i*Math.sin(S);d.x=f.x+(M*b.x+R*y.x),d.y=f.y+(M*b.y+R*y.y),d.z=f.z+(M*b.z+R*y.z),c.push(d.x,d.y,d.z),m.subVectors(d,f).normalize(),h.push(m.x,m.y,m.z),u.push(x/s),u.push(_/r)}}for(let x=1;x<=s;x++)for(let w=1;w<=r;w++){const _=(r+1)*(x-1)+(w-1),S=(r+1)*x+(w-1),M=(r+1)*x+w,R=(r+1)*(x-1)+w;l.push(_,S,R),l.push(S,M,R)}this.setIndex(l),this.setAttribute("position",new st(c,3)),this.setAttribute("normal",new st(h,3)),this.setAttribute("uv",new st(u,2));function A(x,w,_,S,M){const R=Math.cos(x),P=Math.sin(x),C=_/w*x,L=Math.cos(C);M.x=S*(2+L)*.5*R,M.y=S*(2+L)*P*.5,M.z=S*Math.sin(C)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new RT(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class IT extends dt{constructor(e=new D2(new E(-1,-1,0),new E(-1,1,0),new E(1,1,0)),i=64,s=1,r=8,o=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:i,radius:s,radialSegments:r,closed:o};const a=e.computeFrenetFrames(i,o);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const l=new E,c=new E,h=new Y;let u=new E;const d=[],m=[],f=[],g=[];y(),this.setIndex(g),this.setAttribute("position",new st(d,3)),this.setAttribute("normal",new st(m,3)),this.setAttribute("uv",new st(f,2));function y(){for(let x=0;x<i;x++)v(x);v(o===!1?i:0),A(),b()}function v(x){u=e.getPointAt(x/i,u);const w=a.normals[x],_=a.binormals[x];for(let S=0;S<=r;S++){const M=S/r*Math.PI*2,R=Math.sin(M),P=-Math.cos(M);c.x=P*w.x+R*_.x,c.y=P*w.y+R*_.y,c.z=P*w.z+R*_.z,c.normalize(),m.push(c.x,c.y,c.z),l.x=u.x+s*c.x,l.y=u.y+s*c.y,l.z=u.z+s*c.z,d.push(l.x,l.y,l.z)}}function b(){for(let x=1;x<=i;x++)for(let w=1;w<=r;w++){const _=(r+1)*(x-1)+(w-1),S=(r+1)*x+(w-1),M=(r+1)*x+w,R=(r+1)*(x-1)+w;g.push(_,S,R),g.push(S,M,R)}}function A(){for(let x=0;x<=i;x++)for(let w=0;w<=r;w++)h.x=x/i,h.y=w/r,f.push(h.x,h.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new IT(new kw[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class U2 extends dt{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const i=[],s=new Set,r=new E,o=new E;if(e.index!==null){const a=e.attributes.position,l=e.index;let c=e.groups;c.length===0&&(c=[{start:0,count:l.count,materialIndex:0}]);for(let h=0,u=c.length;h<u;++h){const d=c[h],m=d.start,f=d.count;for(let g=m,y=m+f;g<y;g+=3)for(let v=0;v<3;v++){const b=l.getX(g+v),A=l.getX(g+(v+1)%3);r.fromBufferAttribute(a,b),o.fromBufferAttribute(a,A),dN(r,o,s)===!0&&(i.push(r.x,r.y,r.z),i.push(o.x,o.y,o.z))}}}else{const a=e.attributes.position;for(let l=0,c=a.count/3;l<c;l++)for(let h=0;h<3;h++){const u=3*l+h,d=3*l+(h+1)%3;r.fromBufferAttribute(a,u),o.fromBufferAttribute(a,d),dN(r,o,s)===!0&&(i.push(r.x,r.y,r.z),i.push(o.x,o.y,o.z))}}this.setAttribute("position",new st(i,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function dN(n,e,i){const s=`${n.x},${n.y},${n.z}-${e.x},${e.y},${e.z}`,r=`${e.x},${e.y},${e.z}-${n.x},${n.y},${n.z}`;return i.has(s)===!0||i.has(r)===!0?!1:(i.add(s),i.add(r),!0)}var pN=Object.freeze({__proto__:null,BoxGeometry:$i,CapsuleGeometry:wT,CircleGeometry:_T,ConeGeometry:ST,CylinderGeometry:Yn,DodecahedronGeometry:CT,EdgesGeometry:z2,ExtrudeGeometry:Fy,IcosahedronGeometry:MT,LatheGeometry:u1,OctahedronGeometry:mu,PlaneGeometry:ds,PolyhedronGeometry:pp,RingGeometry:d1,ShapeGeometry:ET,SphereGeometry:al,TetrahedronGeometry:TT,TorusGeometry:fu,TorusKnotGeometry:RT,TubeGeometry:IT,WireframeGeometry:U2});class Uw extends Ft{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Ae(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class Vw extends kt{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}let vs=class extends Ft{constructor(n){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Ae(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ae(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Eu,this.normalScale=new Y(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new si,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(n)}copy(n){return super.copy(n),this.defines={STANDARD:""},this.color.copy(n.color),this.roughness=n.roughness,this.metalness=n.metalness,this.map=n.map,this.lightMap=n.lightMap,this.lightMapIntensity=n.lightMapIntensity,this.aoMap=n.aoMap,this.aoMapIntensity=n.aoMapIntensity,this.emissive.copy(n.emissive),this.emissiveMap=n.emissiveMap,this.emissiveIntensity=n.emissiveIntensity,this.bumpMap=n.bumpMap,this.bumpScale=n.bumpScale,this.normalMap=n.normalMap,this.normalMapType=n.normalMapType,this.normalScale.copy(n.normalScale),this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this.roughnessMap=n.roughnessMap,this.metalnessMap=n.metalnessMap,this.alphaMap=n.alphaMap,this.envMap=n.envMap,this.envMapRotation.copy(n.envMapRotation),this.envMapIntensity=n.envMapIntensity,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.wireframeLinecap=n.wireframeLinecap,this.wireframeLinejoin=n.wireframeLinejoin,this.flatShading=n.flatShading,this.fog=n.fog,this}},Ro=class extends vs{constructor(n){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Y(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Pn(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Ae(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Ae(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Ae(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(n)}get anisotropy(){return this._anisotropy}set anisotropy(n){this._anisotropy>0!=n>0&&this.version++,this._anisotropy=n}get clearcoat(){return this._clearcoat}set clearcoat(n){this._clearcoat>0!=n>0&&this.version++,this._clearcoat=n}get iridescence(){return this._iridescence}set iridescence(n){this._iridescence>0!=n>0&&this.version++,this._iridescence=n}get sheen(){return this._sheen}set sheen(n){this._sheen>0!=n>0&&this.version++,this._sheen=n}get transmission(){return this._transmission}set transmission(n){this._transmission>0!=n>0&&this.version++,this._transmission=n}copy(n){return super.copy(n),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=n.anisotropy,this.anisotropyRotation=n.anisotropyRotation,this.anisotropyMap=n.anisotropyMap,this.clearcoat=n.clearcoat,this.clearcoatMap=n.clearcoatMap,this.clearcoatRoughness=n.clearcoatRoughness,this.clearcoatRoughnessMap=n.clearcoatRoughnessMap,this.clearcoatNormalMap=n.clearcoatNormalMap,this.clearcoatNormalScale.copy(n.clearcoatNormalScale),this.ior=n.ior,this.iridescence=n.iridescence,this.iridescenceMap=n.iridescenceMap,this.iridescenceIOR=n.iridescenceIOR,this.iridescenceThicknessRange=[...n.iridescenceThicknessRange],this.iridescenceThicknessMap=n.iridescenceThicknessMap,this.sheen=n.sheen,this.sheenColor.copy(n.sheenColor),this.sheenColorMap=n.sheenColorMap,this.sheenRoughness=n.sheenRoughness,this.sheenRoughnessMap=n.sheenRoughnessMap,this.transmission=n.transmission,this.transmissionMap=n.transmissionMap,this.thickness=n.thickness,this.thicknessMap=n.thicknessMap,this.attenuationDistance=n.attenuationDistance,this.attenuationColor.copy(n.attenuationColor),this.specularIntensity=n.specularIntensity,this.specularIntensityMap=n.specularIntensityMap,this.specularColor.copy(n.specularColor),this.specularColorMap=n.specularColorMap,this}};class dg extends Ft{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Ae(16777215),this.specular=new Ae(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ae(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Eu,this.normalScale=new Y(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new si,this.combine=Zy,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class mN extends Ft{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Ae(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ae(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Eu,this.normalScale=new Y(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class Xw extends Ft{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Eu,this.normalScale=new Y(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class V2 extends Ft{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Ae(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ae(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Eu,this.normalScale=new Y(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new si,this.combine=Zy,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class fN extends Ft{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Ae(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Eu,this.normalScale=new Y(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class gN extends Vi{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function Up(n,e,i){return!n||!i&&n.constructor===e?n:typeof e.BYTES_PER_ELEMENT=="number"?new e(n):Array.prototype.slice.call(n)}function yN(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function vN(n){function e(r,o){return n[r]-n[o]}const i=n.length,s=new Array(i);for(let r=0;r!==i;++r)s[r]=r;return s.sort(e),s}function X2(n,e,i){const s=n.length,r=new n.constructor(s);for(let o=0,a=0;a!==s;++o){const l=i[o]*e;for(let c=0;c!==e;++c)r[a++]=n[l+c]}return r}function W2(n,e,i,s){let r=1,o=n[0];for(;o!==void 0&&o[s]===void 0;)o=n[r++];if(o===void 0)return;let a=o[s];if(a!==void 0)if(Array.isArray(a))do a=o[s],a!==void 0&&(e.push(o.time),i.push.apply(i,a)),o=n[r++];while(o!==void 0);else if(a.toArray!==void 0)do a=o[s],a!==void 0&&(e.push(o.time),a.toArray(i,i.length)),o=n[r++];while(o!==void 0);else do a=o[s],a!==void 0&&(e.push(o.time),i.push(a)),o=n[r++];while(o!==void 0)}function xte(n,e,i,s,r=30){const o=n.clone();o.name=e;const a=[];for(let c=0;c<o.tracks.length;++c){const h=o.tracks[c],u=h.getValueSize(),d=[],m=[];for(let f=0;f<h.times.length;++f){const g=h.times[f]*r;if(!(g<i||g>=s)){d.push(h.times[f]);for(let y=0;y<u;++y)m.push(h.values[f*u+y])}}d.length!==0&&(h.times=Up(d,h.times.constructor),h.values=Up(m,h.values.constructor),a.push(h))}o.tracks=a;let l=1/0;for(let c=0;c<o.tracks.length;++c)l>o.tracks[c].times[0]&&(l=o.tracks[c].times[0]);for(let c=0;c<o.tracks.length;++c)o.tracks[c].shift(-1*l);return o.resetDuration(),o}function wte(n,e=0,i=n,s=30){s<=0&&(s=30);const r=i.tracks.length,o=e/s;for(let a=0;a<r;++a){const l=i.tracks[a],c=l.ValueTypeName;if(c==="bool"||c==="string")continue;const h=n.tracks.find(function(b){return b.name===l.name&&b.ValueTypeName===c});if(h===void 0)continue;let u=0;const d=l.getValueSize();l.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=d/3);let m=0;const f=h.getValueSize();h.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(m=f/3);const g=l.times.length-1;let y;if(o<=l.times[0]){const b=u,A=d-u;y=l.values.slice(b,A)}else if(o>=l.times[g]){const b=g*d+u,A=b+d-u;y=l.values.slice(b,A)}else{const b=l.createInterpolant(),A=u,x=d-u;b.evaluate(o),y=b.resultBuffer.slice(A,x)}c==="quaternion"&&new Se().fromArray(y).normalize().conjugate().toArray(y);const v=h.times.length;for(let b=0;b<v;++b){const A=b*f+m;if(c==="quaternion")Se.multiplyQuaternionsFlat(h.values,A,y,0,h.values,A);else{const x=f-m*2;for(let w=0;w<x;++w)h.values[A+w]-=y[w]}}}return n.blendMode=ER,n}const _te={convertArray:Up,isTypedArray:yN,getKeyframeOrder:vN,sortedArray:X2,flattenJSON:W2,subclip:xte,makeClipAdditive:wte};let pg=class{constructor(n,e,i,s){this.parameterPositions=n,this._cachedIndex=0,this.resultBuffer=s!==void 0?s:new e.constructor(i),this.sampleValues=e,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(n){const e=this.parameterPositions;let i=this._cachedIndex,s=e[i],r=e[i-1];e:{t:{let o;i:{n:if(!(n<s)){for(let a=i+2;;){if(s===void 0){if(n<r)break n;return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(r=s,s=e[++i],n<s)break t}o=e.length;break i}if(!(n>=r)){const a=e[1];n<a&&(i=2,r=a);for(let l=i-2;;){if(r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===l)break;if(s=r,r=e[--i-1],n>=r)break t}o=i,i=0;break i}break e}for(;i<o;){const a=i+o>>>1;n<e[a]?o=a:i=a+1}if(s=e[i],r=e[i-1],r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(s===void 0)return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,r,s)}return this.interpolate_(i,r,n,s)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(n){const e=this.resultBuffer,i=this.sampleValues,s=this.valueSize,r=n*s;for(let o=0;o!==s;++o)e[o]=i[r+o];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}},bN=class extends pg{constructor(n,e,i,s){super(n,e,i,s),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Cp,endingEnd:Cp}}intervalChanged_(n,e,i){const s=this.parameterPositions;let r=n-2,o=n+1,a=s[r],l=s[o];if(a===void 0)switch(this.getSettings_().endingStart){case Mp:r=n,a=2*e-i;break;case ev:r=s.length-2,a=e+s[r]-s[r+1];break;default:r=n,a=i}if(l===void 0)switch(this.getSettings_().endingEnd){case Mp:o=n,l=2*i-e;break;case ev:o=1,l=i+s[1]-s[0];break;default:o=n-1,l=e}const c=(i-e)*.5,h=this.valueSize;this._weightPrev=c/(e-a),this._weightNext=c/(l-i),this._offsetPrev=r*h,this._offsetNext=o*h}interpolate_(n,e,i,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=n*a,c=l-a,h=this._offsetPrev,u=this._offsetNext,d=this._weightPrev,m=this._weightNext,f=(i-e)/(s-e),g=f*f,y=g*f,v=-d*y+2*d*g-d*f,b=(1+d)*y+(-1.5-2*d)*g+(-.5+d)*f+1,A=(-1-m)*y+(1.5+m)*g+.5*f,x=m*y-m*g;for(let w=0;w!==a;++w)r[w]=v*o[h+w]+b*o[c+w]+A*o[l+w]+x*o[u+w];return r}},H2=class extends pg{constructor(n,e,i,s){super(n,e,i,s)}interpolate_(n,e,i,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=n*a,c=l-a,h=(i-e)/(s-e),u=1-h;for(let d=0;d!==a;++d)r[d]=o[c+d]*u+o[l+d]*h;return r}},AN=class extends pg{constructor(n,e,i,s){super(n,e,i,s)}interpolate_(n){return this.copySampleValue_(n-1)}},fl=class{constructor(n,e,i,s){if(n===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(e===void 0||e.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+n);this.name=n,this.times=Up(e,this.TimeBufferType),this.values=Up(i,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}static toJSON(n){const e=n.constructor;let i;if(e.toJSON!==this.toJSON)i=e.toJSON(n);else{i={name:n.name,times:Up(n.times,Array),values:Up(n.values,Array)};const s=n.getInterpolation();s!==n.DefaultInterpolation&&(i.interpolation=s)}return i.type=n.ValueTypeName,i}InterpolantFactoryMethodDiscrete(n){return new AN(this.times,this.values,this.getValueSize(),n)}InterpolantFactoryMethodLinear(n){return new H2(this.times,this.values,this.getValueSize(),n)}InterpolantFactoryMethodSmooth(n){return new bN(this.times,this.values,this.getValueSize(),n)}setInterpolation(n){let e;switch(n){case Mu:e=this.InterpolantFactoryMethodDiscrete;break;case ec:e=this.InterpolantFactoryMethodLinear;break;case z1:e=this.InterpolantFactoryMethodSmooth;break}if(e===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(n!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Mu;case this.InterpolantFactoryMethodLinear:return ec;case this.InterpolantFactoryMethodSmooth:return z1}}getValueSize(){return this.values.length/this.times.length}shift(n){if(n!==0){const e=this.times;for(let i=0,s=e.length;i!==s;++i)e[i]+=n}return this}scale(n){if(n!==1){const e=this.times;for(let i=0,s=e.length;i!==s;++i)e[i]*=n}return this}trim(n,e){const i=this.times,s=i.length;let r=0,o=s-1;for(;r!==s&&i[r]<n;)++r;for(;o!==-1&&i[o]>e;)--o;if(++o,r!==0||o!==s){r>=o&&(o=Math.max(o,1),r=o-1);const a=this.getValueSize();this.times=i.slice(r,o),this.values=this.values.slice(r*a,o*a)}return this}validate(){let n=!0;const e=this.getValueSize();e-Math.floor(e)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),n=!1);const i=this.times,s=this.values,r=i.length;r===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),n=!1);let o=null;for(let a=0;a!==r;a++){const l=i[a];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,l),n=!1;break}if(o!==null&&o>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,l,o),n=!1;break}o=l}if(s!==void 0&&yN(s))for(let a=0,l=s.length;a!==l;++a){const c=s[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),n=!1;break}}return n}optimize(){const n=this.times.slice(),e=this.values.slice(),i=this.getValueSize(),s=this.getInterpolation()===z1,r=n.length-1;let o=1;for(let a=1;a<r;++a){let l=!1;const c=n[a],h=n[a+1];if(c!==h&&(a!==1||c!==n[0]))if(s)l=!0;else{const u=a*i,d=u-i,m=u+i;for(let f=0;f!==i;++f){const g=e[u+f];if(g!==e[d+f]||g!==e[m+f]){l=!0;break}}}if(l){if(a!==o){n[o]=n[a];const u=a*i,d=o*i;for(let m=0;m!==i;++m)e[d+m]=e[u+m]}++o}}if(r>0){n[o]=n[r];for(let a=r*i,l=o*i,c=0;c!==i;++c)e[l+c]=e[a+c];++o}return o!==n.length?(this.times=n.slice(0,o),this.values=e.slice(0,o*i)):(this.times=n,this.values=e),this}clone(){const n=this.times.slice(),e=this.values.slice(),i=this.constructor,s=new i(this.name,n,e);return s.createInterpolant=this.createInterpolant,s}};fl.prototype.TimeBufferType=Float32Array,fl.prototype.ValueBufferType=Float32Array,fl.prototype.DefaultInterpolation=ec;let Vp=class extends fl{};Vp.prototype.ValueTypeName="bool",Vp.prototype.ValueBufferType=Array,Vp.prototype.DefaultInterpolation=Mu,Vp.prototype.InterpolantFactoryMethodLinear=void 0,Vp.prototype.InterpolantFactoryMethodSmooth=void 0;let Ww=class extends fl{};Ww.prototype.ValueTypeName="color";let yh=class extends fl{};yh.prototype.ValueTypeName="number";let xN=class extends pg{constructor(n,e,i,s){super(n,e,i,s)}interpolate_(n,e,i,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=(i-e)/(s-e);let c=n*a;for(let h=c+a;c!==h;c+=4)Se.slerpFlat(r,0,o,c-a,o,c,l);return r}},gl=class extends fl{InterpolantFactoryMethodLinear(n){return new xN(this.times,this.values,this.getValueSize(),n)}};gl.prototype.ValueTypeName="quaternion",gl.prototype.DefaultInterpolation=ec,gl.prototype.InterpolantFactoryMethodSmooth=void 0;let Xp=class extends fl{};Xp.prototype.ValueTypeName="string",Xp.prototype.ValueBufferType=Array,Xp.prototype.DefaultInterpolation=Mu,Xp.prototype.InterpolantFactoryMethodLinear=void 0,Xp.prototype.InterpolantFactoryMethodSmooth=void 0;let nc=class extends fl{};nc.prototype.ValueTypeName="vector";let to=class{constructor(n,e=-1,i,s=F1){this.name=n,this.tracks=i,this.duration=e,this.blendMode=s,this.uuid=Vo(),this.duration<0&&this.resetDuration()}static parse(n){const e=[],i=n.tracks,s=1/(n.fps||1);for(let o=0,a=i.length;o!==a;++o)e.push(Cte(i[o]).scale(s));const r=new this(n.name,n.duration,e,n.blendMode);return r.uuid=n.uuid,r}static toJSON(n){const e=[],i=n.tracks,s={name:n.name,duration:n.duration,tracks:e,uuid:n.uuid,blendMode:n.blendMode};for(let r=0,o=i.length;r!==o;++r)e.push(fl.toJSON(i[r]));return s}static CreateFromMorphTargetSequence(n,e,i,s){const r=e.length,o=[];for(let a=0;a<r;a++){let l=[],c=[];l.push((a+r-1)%r,a,(a+1)%r),c.push(0,1,0);const h=vN(l);l=X2(l,1,h),c=X2(c,1,h),!s&&l[0]===0&&(l.push(r),c.push(c[0])),o.push(new yh(".morphTargetInfluences["+e[a].name+"]",l,c).scale(1/i))}return new this(n,-1,o)}static findByName(n,e){let i=n;if(!Array.isArray(n)){const s=n;i=s.geometry&&s.geometry.animations||s.animations}for(let s=0;s<i.length;s++)if(i[s].name===e)return i[s];return null}static CreateClipsFromMorphTargetSequences(n,e,i){const s={},r=/^([\w-]*?)([\d]+)$/;for(let a=0,l=n.length;a<l;a++){const c=n[a],h=c.name.match(r);if(h&&h.length>1){const u=h[1];let d=s[u];d||(s[u]=d=[]),d.push(c)}}const o=[];for(const a in s)o.push(this.CreateFromMorphTargetSequence(a,s[a],e,i));return o}static parseAnimation(n,e){if(!n)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(h,u,d,m,f){if(d.length!==0){const g=[],y=[];W2(d,g,y,m),g.length!==0&&f.push(new h(u,g,y))}},s=[],r=n.name||"default",o=n.fps||30,a=n.blendMode;let l=n.length||-1;const c=n.hierarchy||[];for(let h=0;h<c.length;h++){const u=c[h].keys;if(!(!u||u.length===0))if(u[0].morphTargets){const d={};let m;for(m=0;m<u.length;m++)if(u[m].morphTargets)for(let f=0;f<u[m].morphTargets.length;f++)d[u[m].morphTargets[f]]=-1;for(const f in d){const g=[],y=[];for(let v=0;v!==u[m].morphTargets.length;++v){const b=u[m];g.push(b.time),y.push(b.morphTarget===f?1:0)}s.push(new yh(".morphTargetInfluence["+f+"]",g,y))}l=d.length*o}else{const d=".bones["+e[h].name+"]";i(nc,d+".position",u,"pos",s),i(gl,d+".quaternion",u,"rot",s),i(nc,d+".scale",u,"scl",s)}}return s.length===0?null:new this(r,l,s,a)}resetDuration(){const n=this.tracks;let e=0;for(let i=0,s=n.length;i!==s;++i){const r=this.tracks[i];e=Math.max(e,r.times[r.times.length-1])}return this.duration=e,this}trim(){for(let n=0;n<this.tracks.length;n++)this.tracks[n].trim(0,this.duration);return this}validate(){let n=!0;for(let e=0;e<this.tracks.length;e++)n=n&&this.tracks[e].validate();return n}optimize(){for(let n=0;n<this.tracks.length;n++)this.tracks[n].optimize();return this}clone(){const n=[];for(let e=0;e<this.tracks.length;e++)n.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,n,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}};function Ste(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return yh;case"vector":case"vector2":case"vector3":case"vector4":return nc;case"color":return Ww;case"quaternion":return gl;case"bool":case"boolean":return Vp;case"string":return Xp}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}function Cte(n){if(n.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=Ste(n.type);if(n.times===void 0){const i=[],s=[];W2(n.keys,i,s,"value"),n.times=i,n.values=s}return e.parse!==void 0?e.parse(n):new e(n.name,n.times,n.values,n.interpolation)}const vh={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};let Hw=class{constructor(n,e,i){const s=this;let r=!1,o=0,a=0,l;const c=[];this.onStart=void 0,this.onLoad=n,this.onProgress=e,this.onError=i,this.itemStart=function(h){a++,r===!1&&s.onStart!==void 0&&s.onStart(h,o,a),r=!0},this.itemEnd=function(h){o++,s.onProgress!==void 0&&s.onProgress(h,o,a),o===a&&(r=!1,s.onLoad!==void 0&&s.onLoad())},this.itemError=function(h){s.onError!==void 0&&s.onError(h)},this.resolveURL=function(h){return l?l(h):h},this.setURLModifier=function(h){return l=h,this},this.addHandler=function(h,u){return c.push(h,u),this},this.removeHandler=function(h){const u=c.indexOf(h);return u!==-1&&c.splice(u,2),this},this.getHandler=function(h){for(let u=0,d=c.length;u<d;u+=2){const m=c[u],f=c[u+1];if(m.global&&(m.lastIndex=0),m.test(h))return f}return null}}};const wN=new Hw;let es=class{constructor(n){this.manager=n!==void 0?n:wN,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(n,e){const i=this;return new Promise(function(s,r){i.load(n,s,e,r)})}parse(){}setCrossOrigin(n){return this.crossOrigin=n,this}setWithCredentials(n){return this.withCredentials=n,this}setPath(n){return this.path=n,this}setResourcePath(n){return this.resourcePath=n,this}setRequestHeader(n){return this.requestHeader=n,this}};es.DEFAULT_MATERIAL_NAME="__DEFAULT";const bh={};let Mte=class extends Error{constructor(n,e){super(n),this.response=e}},qs=class extends es{constructor(n){super(n)}load(n,e,i,s){n===void 0&&(n=""),this.path!==void 0&&(n=this.path+n),n=this.manager.resolveURL(n);const r=vh.get(n);if(r!==void 0)return this.manager.itemStart(n),setTimeout(()=>{e&&e(r),this.manager.itemEnd(n)},0),r;if(bh[n]!==void 0){bh[n].push({onLoad:e,onProgress:i,onError:s});return}bh[n]=[],bh[n].push({onLoad:e,onProgress:i,onError:s});const o=new Request(n,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,l=this.responseType;fetch(o).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const h=bh[n],u=c.body.getReader(),d=c.headers.get("Content-Length")||c.headers.get("X-File-Size"),m=d?parseInt(d):0,f=m!==0;let g=0;const y=new ReadableStream({start(v){b();function b(){u.read().then(({done:A,value:x})=>{if(A)v.close();else{g+=x.byteLength;const w=new ProgressEvent("progress",{lengthComputable:f,loaded:g,total:m});for(let _=0,S=h.length;_<S;_++){const M=h[_];M.onProgress&&M.onProgress(w)}v.enqueue(x),b()}})}}});return new Response(y)}else throw new Mte(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(h=>new DOMParser().parseFromString(h,a));case"json":return c.json();default:if(a===void 0)return c.text();{const h=/charset="?([^;"\s]*)"?/i.exec(a),u=h&&h[1]?h[1].toLowerCase():void 0,d=new TextDecoder(u);return c.arrayBuffer().then(m=>d.decode(m))}}}).then(c=>{vh.add(n,c);const h=bh[n];delete bh[n];for(let u=0,d=h.length;u<d;u++){const m=h[u];m.onLoad&&m.onLoad(c)}}).catch(c=>{const h=bh[n];if(h===void 0)throw this.manager.itemError(n),c;delete bh[n];for(let u=0,d=h.length;u<d;u++){const m=h[u];m.onError&&m.onError(c)}this.manager.itemError(n)}).finally(()=>{this.manager.itemEnd(n)}),this.manager.itemStart(n)}setResponseType(n){return this.responseType=n,this}setMimeType(n){return this.mimeType=n,this}};class Ete extends es{constructor(e){super(e)}load(e,i,s,r){const o=this,a=new qs(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){try{i(o.parse(JSON.parse(l)))}catch(c){r?r(c):console.error(c),o.manager.itemError(e)}},s,r)}parse(e){const i=[];for(let s=0;s<e.length;s++){const r=to.parse(e[s]);i.push(r)}return i}}class Tte extends es{constructor(e){super(e)}load(e,i,s,r){const o=this,a=[],l=new Gu,c=new qs(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(o.withCredentials);let h=0;function u(d){c.load(e[d],function(m){const f=o.parse(m,!0);a[d]={width:f.width,height:f.height,format:f.format,mipmaps:f.mipmaps},h+=1,h===6&&(f.mipmapCount===1&&(l.minFilter=Ot),l.image=a,l.format=f.format,l.needsUpdate=!0,i&&i(l))},s,r)}if(Array.isArray(e))for(let d=0,m=e.length;d<m;++d)u(d);else c.load(e,function(d){const m=o.parse(d,!0);if(m.isCubemap){const f=m.mipmaps.length/m.mipmapCount;for(let g=0;g<f;g++){a[g]={mipmaps:[]};for(let y=0;y<m.mipmapCount;y++)a[g].mipmaps.push(m.mipmaps[g*m.mipmapCount+y]),a[g].format=m.format,a[g].width=m.width,a[g].height=m.height}l.image=a}else l.image.width=m.width,l.image.height=m.height,l.mipmaps=m.mipmaps;m.mipmapCount===1&&(l.minFilter=Ot),l.format=m.format,l.needsUpdate=!0,i&&i(l)},s,r);return l}}let Lv=class extends es{constructor(n){super(n)}load(n,e,i,s){this.path!==void 0&&(n=this.path+n),n=this.manager.resolveURL(n);const r=this,o=vh.get(n);if(o!==void 0)return r.manager.itemStart(n),setTimeout(function(){e&&e(o),r.manager.itemEnd(n)},0),o;const a=lv("img");function l(){h(),vh.add(n,this),e&&e(this),r.manager.itemEnd(n)}function c(u){h(),s&&s(u),r.manager.itemError(n),r.manager.itemEnd(n)}function h(){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1)}return a.addEventListener("load",l,!1),a.addEventListener("error",c,!1),n.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(n),a.src=n,a}};class Rte extends es{constructor(e){super(e)}load(e,i,s,r){const o=new fv;o.colorSpace=vt;const a=new Lv(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let l=0;function c(h){a.load(e[h],function(u){o.images[h]=u,l++,l===6&&(o.needsUpdate=!0,i&&i(o))},void 0,r)}for(let h=0;h<e.length;++h)c(h);return o}}class j2 extends es{constructor(e){super(e)}load(e,i,s,r){const o=this,a=new Tr,l=new qs(this.manager);return l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setPath(this.path),l.setWithCredentials(o.withCredentials),l.load(e,function(c){let h;try{h=o.parse(c)}catch(u){if(r!==void 0)r(u);else{console.error(u);return}}h.image!==void 0?a.image=h.image:h.data!==void 0&&(a.image.width=h.width,a.image.height=h.height,a.image.data=h.data),a.wrapS=h.wrapS!==void 0?h.wrapS:qn,a.wrapT=h.wrapT!==void 0?h.wrapT:qn,a.magFilter=h.magFilter!==void 0?h.magFilter:Ot,a.minFilter=h.minFilter!==void 0?h.minFilter:Ot,a.anisotropy=h.anisotropy!==void 0?h.anisotropy:1,h.colorSpace!==void 0&&(a.colorSpace=h.colorSpace),h.flipY!==void 0&&(a.flipY=h.flipY),h.format!==void 0&&(a.format=h.format),h.type!==void 0&&(a.type=h.type),h.mipmaps!==void 0&&(a.mipmaps=h.mipmaps,a.minFilter=So),h.mipmapCount===1&&(a.minFilter=Ot),h.generateMipmaps!==void 0&&(a.generateMipmaps=h.generateMipmaps),a.needsUpdate=!0,i&&i(a,h)},s,r),a}}let sc=class extends es{constructor(n){super(n)}load(n,e,i,s){const r=new Vt,o=new Lv(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(n,function(a){r.image=a,r.needsUpdate=!0,e!==void 0&&e(r)},i,s),r}},Fu=class extends ye{constructor(n,e=1){super(),this.isLight=!0,this.type="Light",this.color=new Ae(n),this.intensity=e}dispose(){}copy(n,e){return super.copy(n,e),this.color.copy(n.color),this.intensity=n.intensity,this}toJSON(n){const e=super.toJSON(n);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,this.groundColor!==void 0&&(e.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(e.object.distance=this.distance),this.angle!==void 0&&(e.object.angle=this.angle),this.decay!==void 0&&(e.object.decay=this.decay),this.penumbra!==void 0&&(e.object.penumbra=this.penumbra),this.shadow!==void 0&&(e.object.shadow=this.shadow.toJSON()),e}};class Q2 extends Fu{constructor(e,i,s){super(e,s),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(ye.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Ae(i)}copy(e,i){return super.copy(e,i),this.groundColor.copy(e.groundColor),this}}const Z2=new he,_N=new E,SN=new E;let Y2=class{constructor(n){this.camera=n,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Y(512,512),this.map=null,this.mapPass=null,this.matrix=new he,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Bp,this._frameExtents=new Y(1,1),this._viewportCount=1,this._viewports=[new Ze(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(n){const e=this.camera,i=this.matrix;_N.setFromMatrixPosition(n.matrixWorld),e.position.copy(_N),SN.setFromMatrixPosition(n.target.matrixWorld),e.lookAt(SN),e.updateMatrixWorld(),Z2.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Z2),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(Z2)}getViewport(n){return this._viewports[n]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(n){return this.camera=n.camera.clone(),this.bias=n.bias,this.radius=n.radius,this.mapSize.copy(n.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const n={};return this.bias!==0&&(n.bias=this.bias),this.normalBias!==0&&(n.normalBias=this.normalBias),this.radius!==1&&(n.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(n.mapSize=this.mapSize.toArray()),n.camera=this.camera.toJSON(!1).object,delete n.camera.matrix,n}},Ite=class extends Y2{constructor(){super(new Lt(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(n){const e=this.camera,i=kf*2*n.angle*this.focus,s=this.mapSize.width/this.mapSize.height,r=n.distance||e.far;(i!==e.fov||s!==e.aspect||r!==e.far)&&(e.fov=i,e.aspect=s,e.far=r,e.updateProjectionMatrix()),super.updateMatrices(n)}copy(n){return super.copy(n),this.focus=n.focus,this}},Pv=class extends Fu{constructor(n,e,i=0,s=Math.PI/3,r=0,o=2){super(n,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(ye.DEFAULT_UP),this.updateMatrix(),this.target=new ye,this.distance=i,this.angle=s,this.penumbra=r,this.decay=o,this.map=null,this.shadow=new Ite}get power(){return this.intensity*Math.PI}set power(n){this.intensity=n/Math.PI}dispose(){this.shadow.dispose()}copy(n,e){return super.copy(n,e),this.distance=n.distance,this.angle=n.angle,this.penumbra=n.penumbra,this.decay=n.decay,this.target=n.target.clone(),this.shadow=n.shadow.clone(),this}};const CN=new he,Bv=new E,K2=new E;let Lte=class extends Y2{constructor(){super(new Lt(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Y(4,2),this._viewportCount=6,this._viewports=[new Ze(2,1,1,1),new Ze(0,1,1,1),new Ze(3,1,1,1),new Ze(1,1,1,1),new Ze(3,0,1,1),new Ze(1,0,1,1)],this._cubeDirections=[new E(1,0,0),new E(-1,0,0),new E(0,0,1),new E(0,0,-1),new E(0,1,0),new E(0,-1,0)],this._cubeUps=[new E(0,1,0),new E(0,1,0),new E(0,1,0),new E(0,1,0),new E(0,0,1),new E(0,0,-1)]}updateMatrices(n,e=0){const i=this.camera,s=this.matrix,r=n.distance||i.far;r!==i.far&&(i.far=r,i.updateProjectionMatrix()),Bv.setFromMatrixPosition(n.matrixWorld),i.position.copy(Bv),K2.copy(i.position),K2.add(this._cubeDirections[e]),i.up.copy(this._cubeUps[e]),i.lookAt(K2),i.updateMatrixWorld(),s.makeTranslation(-Bv.x,-Bv.y,-Bv.z),CN.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(CN)}},Wp=class extends Fu{constructor(n,e,i=0,s=2){super(n,e),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=s,this.shadow=new Lte}get power(){return this.intensity*4*Math.PI}set power(n){this.intensity=n/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(n,e){return super.copy(n,e),this.distance=n.distance,this.decay=n.decay,this.shadow=n.shadow.clone(),this}},Pte=class extends Y2{constructor(){super(new ic(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}},Hp=class extends Fu{constructor(n,e){super(n,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(ye.DEFAULT_UP),this.updateMatrix(),this.target=new ye,this.shadow=new Pte}dispose(){this.shadow.dispose()}copy(n){return super.copy(n),this.target=n.target.clone(),this.shadow=n.shadow.clone(),this}};class jw extends Fu{constructor(e,i){super(e,i),this.isAmbientLight=!0,this.type="AmbientLight"}}class MN extends Fu{constructor(e,i,s=10,r=10){super(e,i),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=s,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const i=super.toJSON(e);return i.object.width=this.width,i.object.height=this.height,i}}class EN{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new E)}set(e){for(let i=0;i<9;i++)this.coefficients[i].copy(e[i]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,i){const s=e.x,r=e.y,o=e.z,a=this.coefficients;return i.copy(a[0]).multiplyScalar(.282095),i.addScaledVector(a[1],.488603*r),i.addScaledVector(a[2],.488603*o),i.addScaledVector(a[3],.488603*s),i.addScaledVector(a[4],1.092548*(s*r)),i.addScaledVector(a[5],1.092548*(r*o)),i.addScaledVector(a[6],.315392*(3*o*o-1)),i.addScaledVector(a[7],1.092548*(s*o)),i.addScaledVector(a[8],.546274*(s*s-r*r)),i}getIrradianceAt(e,i){const s=e.x,r=e.y,o=e.z,a=this.coefficients;return i.copy(a[0]).multiplyScalar(.886227),i.addScaledVector(a[1],2*.511664*r),i.addScaledVector(a[2],2*.511664*o),i.addScaledVector(a[3],2*.511664*s),i.addScaledVector(a[4],2*.429043*s*r),i.addScaledVector(a[5],2*.429043*r*o),i.addScaledVector(a[6],.743125*o*o-.247708),i.addScaledVector(a[7],2*.429043*s*o),i.addScaledVector(a[8],.429043*(s*s-r*r)),i}add(e){for(let i=0;i<9;i++)this.coefficients[i].add(e.coefficients[i]);return this}addScaledSH(e,i){for(let s=0;s<9;s++)this.coefficients[s].addScaledVector(e.coefficients[s],i);return this}scale(e){for(let i=0;i<9;i++)this.coefficients[i].multiplyScalar(e);return this}lerp(e,i){for(let s=0;s<9;s++)this.coefficients[s].lerp(e.coefficients[s],i);return this}equals(e){for(let i=0;i<9;i++)if(!this.coefficients[i].equals(e.coefficients[i]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,i=0){const s=this.coefficients;for(let r=0;r<9;r++)s[r].fromArray(e,i+r*3);return this}toArray(e=[],i=0){const s=this.coefficients;for(let r=0;r<9;r++)s[r].toArray(e,i+r*3);return e}static getBasisAt(e,i){const s=e.x,r=e.y,o=e.z;i[0]=.282095,i[1]=.488603*r,i[2]=.488603*o,i[3]=.488603*s,i[4]=1.092548*s*r,i[5]=1.092548*r*o,i[6]=.315392*(3*o*o-1),i[7]=1.092548*s*o,i[8]=.546274*(s*s-r*r)}}class TN extends Fu{constructor(e=new EN,i=1){super(void 0,i),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const i=super.toJSON(e);return i.object.sh=this.sh.toArray(),i}}class LT extends es{constructor(e){super(e),this.textures={}}load(e,i,s,r){const o=this,a=new qs(o.manager);a.setPath(o.path),a.setRequestHeader(o.requestHeader),a.setWithCredentials(o.withCredentials),a.load(e,function(l){try{i(o.parse(JSON.parse(l)))}catch(c){r?r(c):console.error(c),o.manager.itemError(e)}},s,r)}parse(e){const i=this.textures;function s(o){return i[o]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",o),i[o]}const r=LT.createMaterialFromType(e.type);if(e.uuid!==void 0&&(r.uuid=e.uuid),e.name!==void 0&&(r.name=e.name),e.color!==void 0&&r.color!==void 0&&r.color.setHex(e.color),e.roughness!==void 0&&(r.roughness=e.roughness),e.metalness!==void 0&&(r.metalness=e.metalness),e.sheen!==void 0&&(r.sheen=e.sheen),e.sheenColor!==void 0&&(r.sheenColor=new Ae().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(r.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&r.emissive!==void 0&&r.emissive.setHex(e.emissive),e.specular!==void 0&&r.specular!==void 0&&r.specular.setHex(e.specular),e.specularIntensity!==void 0&&(r.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&r.specularColor!==void 0&&r.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(r.shininess=e.shininess),e.clearcoat!==void 0&&(r.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=e.clearcoatRoughness),e.iridescence!==void 0&&(r.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(r.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(r.transmission=e.transmission),e.thickness!==void 0&&(r.thickness=e.thickness),e.attenuationDistance!==void 0&&(r.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&r.attenuationColor!==void 0&&r.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(r.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(r.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(r.fog=e.fog),e.flatShading!==void 0&&(r.flatShading=e.flatShading),e.blending!==void 0&&(r.blending=e.blending),e.combine!==void 0&&(r.combine=e.combine),e.side!==void 0&&(r.side=e.side),e.shadowSide!==void 0&&(r.shadowSide=e.shadowSide),e.opacity!==void 0&&(r.opacity=e.opacity),e.transparent!==void 0&&(r.transparent=e.transparent),e.alphaTest!==void 0&&(r.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(r.alphaHash=e.alphaHash),e.depthFunc!==void 0&&(r.depthFunc=e.depthFunc),e.depthTest!==void 0&&(r.depthTest=e.depthTest),e.depthWrite!==void 0&&(r.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(r.colorWrite=e.colorWrite),e.blendSrc!==void 0&&(r.blendSrc=e.blendSrc),e.blendDst!==void 0&&(r.blendDst=e.blendDst),e.blendEquation!==void 0&&(r.blendEquation=e.blendEquation),e.blendSrcAlpha!==void 0&&(r.blendSrcAlpha=e.blendSrcAlpha),e.blendDstAlpha!==void 0&&(r.blendDstAlpha=e.blendDstAlpha),e.blendEquationAlpha!==void 0&&(r.blendEquationAlpha=e.blendEquationAlpha),e.blendColor!==void 0&&r.blendColor!==void 0&&r.blendColor.setHex(e.blendColor),e.blendAlpha!==void 0&&(r.blendAlpha=e.blendAlpha),e.stencilWriteMask!==void 0&&(r.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(r.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(r.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(r.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(r.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(r.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(r.stencilZPass=e.stencilZPass),e.stencilWrite!==void 0&&(r.stencilWrite=e.stencilWrite),e.wireframe!==void 0&&(r.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(r.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(r.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(r.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(r.rotation=e.rotation),e.linewidth!==void 0&&(r.linewidth=e.linewidth),e.dashSize!==void 0&&(r.dashSize=e.dashSize),e.gapSize!==void 0&&(r.gapSize=e.gapSize),e.scale!==void 0&&(r.scale=e.scale),e.polygonOffset!==void 0&&(r.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(r.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(r.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(r.dithering=e.dithering),e.alphaToCoverage!==void 0&&(r.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(r.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(r.forceSinglePass=e.forceSinglePass),e.visible!==void 0&&(r.visible=e.visible),e.toneMapped!==void 0&&(r.toneMapped=e.toneMapped),e.userData!==void 0&&(r.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?r.vertexColors=e.vertexColors>0:r.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const o in e.uniforms){const a=e.uniforms[o];switch(r.uniforms[o]={},a.type){case"t":r.uniforms[o].value=s(a.value);break;case"c":r.uniforms[o].value=new Ae().setHex(a.value);break;case"v2":r.uniforms[o].value=new Y().fromArray(a.value);break;case"v3":r.uniforms[o].value=new E().fromArray(a.value);break;case"v4":r.uniforms[o].value=new Ze().fromArray(a.value);break;case"m3":r.uniforms[o].value=new Gt().fromArray(a.value);break;case"m4":r.uniforms[o].value=new he().fromArray(a.value);break;default:r.uniforms[o].value=a.value}}if(e.defines!==void 0&&(r.defines=e.defines),e.vertexShader!==void 0&&(r.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(r.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(r.glslVersion=e.glslVersion),e.extensions!==void 0)for(const o in e.extensions)r.extensions[o]=e.extensions[o];if(e.lights!==void 0&&(r.lights=e.lights),e.clipping!==void 0&&(r.clipping=e.clipping),e.size!==void 0&&(r.size=e.size),e.sizeAttenuation!==void 0&&(r.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(r.map=s(e.map)),e.matcap!==void 0&&(r.matcap=s(e.matcap)),e.alphaMap!==void 0&&(r.alphaMap=s(e.alphaMap)),e.bumpMap!==void 0&&(r.bumpMap=s(e.bumpMap)),e.bumpScale!==void 0&&(r.bumpScale=e.bumpScale),e.normalMap!==void 0&&(r.normalMap=s(e.normalMap)),e.normalMapType!==void 0&&(r.normalMapType=e.normalMapType),e.normalScale!==void 0){let o=e.normalScale;Array.isArray(o)===!1&&(o=[o,o]),r.normalScale=new Y().fromArray(o)}return e.displacementMap!==void 0&&(r.displacementMap=s(e.displacementMap)),e.displacementScale!==void 0&&(r.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(r.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(r.roughnessMap=s(e.roughnessMap)),e.metalnessMap!==void 0&&(r.metalnessMap=s(e.metalnessMap)),e.emissiveMap!==void 0&&(r.emissiveMap=s(e.emissiveMap)),e.emissiveIntensity!==void 0&&(r.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(r.specularMap=s(e.specularMap)),e.specularIntensityMap!==void 0&&(r.specularIntensityMap=s(e.specularIntensityMap)),e.specularColorMap!==void 0&&(r.specularColorMap=s(e.specularColorMap)),e.envMap!==void 0&&(r.envMap=s(e.envMap)),e.envMapRotation!==void 0&&r.envMapRotation.fromArray(e.envMapRotation),e.envMapIntensity!==void 0&&(r.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(r.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(r.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(r.lightMap=s(e.lightMap)),e.lightMapIntensity!==void 0&&(r.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(r.aoMap=s(e.aoMap)),e.aoMapIntensity!==void 0&&(r.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(r.gradientMap=s(e.gradientMap)),e.clearcoatMap!==void 0&&(r.clearcoatMap=s(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(r.clearcoatRoughnessMap=s(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(r.clearcoatNormalMap=s(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(r.clearcoatNormalScale=new Y().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(r.iridescenceMap=s(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(r.iridescenceThicknessMap=s(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(r.transmissionMap=s(e.transmissionMap)),e.thicknessMap!==void 0&&(r.thicknessMap=s(e.thicknessMap)),e.anisotropyMap!==void 0&&(r.anisotropyMap=s(e.anisotropyMap)),e.sheenColorMap!==void 0&&(r.sheenColorMap=s(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(r.sheenRoughnessMap=s(e.sheenRoughnessMap)),r}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){const i={ShadowMaterial:Uw,SpriteMaterial:bw,RawShaderMaterial:Vw,ShaderMaterial:kt,PointsMaterial:Ou,MeshPhysicalMaterial:Ro,MeshStandardMaterial:vs,MeshPhongMaterial:dg,MeshToonMaterial:mN,MeshNormalMaterial:Xw,MeshLambertMaterial:V2,MeshDepthMaterial:gv,MeshDistanceMaterial:p2,MeshBasicMaterial:Qt,MeshMatcapMaterial:fN,LineDashedMaterial:gN,LineBasicMaterial:Vi,Material:Ft};return new i[e]}}let Ah=class{static decodeText(n){if(typeof TextDecoder<"u")return new TextDecoder().decode(n);let e="";for(let i=0,s=n.length;i<s;i++)e+=String.fromCharCode(n[i]);try{return decodeURIComponent(escape(e))}catch{return e}}static extractUrlBase(n){const e=n.lastIndexOf("/");return e===-1?"./":n.slice(0,e+1)}static resolveURL(n,e){return typeof n!="string"||n===""?"":(/^https?:\/\//i.test(e)&&/^\//.test(n)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(n)||/^data:.*,.*$/i.test(n)||/^blob:.*$/i.test(n)?n:e+n)}};class Qw extends dt{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class RN extends es{constructor(e){super(e)}load(e,i,s,r){const o=this,a=new qs(o.manager);a.setPath(o.path),a.setRequestHeader(o.requestHeader),a.setWithCredentials(o.withCredentials),a.load(e,function(l){try{i(o.parse(JSON.parse(l)))}catch(c){r?r(c):console.error(c),o.manager.itemError(e)}},s,r)}parse(e){const i={},s={};function r(m,f){if(i[f]!==void 0)return i[f];const g=m.interleavedBuffers[f],y=o(m,g.buffer),v=Df(g.type,y),b=new yv(v,g.stride);return b.uuid=g.uuid,i[f]=b,b}function o(m,f){if(s[f]!==void 0)return s[f];const g=m.arrayBuffers[f],y=new Uint32Array(g).buffer;return s[f]=y,y}const a=e.isInstancedBufferGeometry?new Qw:new dt,l=e.data.index;if(l!==void 0){const m=Df(l.type,l.array);a.setIndex(new qe(m,1))}const c=e.data.attributes;for(const m in c){const f=c[m];let g;if(f.isInterleavedBufferAttribute){const y=r(e.data,f.data);g=new Ho(y,f.itemSize,f.offset,f.normalized)}else{const y=Df(f.type,f.array),v=f.isInstancedBufferAttribute?To:qe;g=new v(y,f.itemSize,f.normalized)}f.name!==void 0&&(g.name=f.name),f.usage!==void 0&&g.setUsage(f.usage),a.setAttribute(m,g)}const h=e.data.morphAttributes;if(h)for(const m in h){const f=h[m],g=[];for(let y=0,v=f.length;y<v;y++){const b=f[y];let A;if(b.isInterleavedBufferAttribute){const x=r(e.data,b.data);A=new Ho(x,b.itemSize,b.offset,b.normalized)}else{const x=Df(b.type,b.array);A=new qe(x,b.itemSize,b.normalized)}b.name!==void 0&&(A.name=b.name),g.push(A)}a.morphAttributes[m]=g}e.data.morphTargetsRelative&&(a.morphTargetsRelative=!0);const u=e.data.groups||e.data.drawcalls||e.data.offsets;if(u!==void 0)for(let m=0,f=u.length;m!==f;++m){const g=u[m];a.addGroup(g.start,g.count,g.materialIndex)}const d=e.data.boundingSphere;if(d!==void 0){const m=new E;d.center!==void 0&&m.fromArray(d.center),a.boundingSphere=new tn(m,d.radius)}return e.name&&(a.name=e.name),e.userData&&(a.userData=e.userData),a}}class Bte extends es{constructor(e){super(e)}load(e,i,s,r){const o=this,a=this.path===""?Ah.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a;const l=new qs(this.manager);l.setPath(this.path),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){let h=null;try{h=JSON.parse(c)}catch(d){r!==void 0&&r(d),console.error("THREE:ObjectLoader: Can't parse "+e+".",d.message);return}const u=h.metadata;if(u===void 0||u.type===void 0||u.type.toLowerCase()==="geometry"){r!==void 0&&r(new Error("THREE.ObjectLoader: Can't load "+e)),console.error("THREE.ObjectLoader: Can't load "+e);return}o.parse(h,i)},s,r)}async loadAsync(e,i){const s=this,r=this.path===""?Ah.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||r;const o=new qs(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials);const a=await o.loadAsync(e,i),l=JSON.parse(a),c=l.metadata;if(c===void 0||c.type===void 0||c.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await s.parseAsync(l)}parse(e,i){const s=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),o=this.parseGeometries(e.geometries,r),a=this.parseImages(e.images,function(){i!==void 0&&i(h)}),l=this.parseTextures(e.textures,a),c=this.parseMaterials(e.materials,l),h=this.parseObject(e.object,o,c,l,s),u=this.parseSkeletons(e.skeletons,h);if(this.bindSkeletons(h,u),i!==void 0){let d=!1;for(const m in a)if(a[m].data instanceof HTMLImageElement){d=!0;break}d===!1&&i(h)}return h}async parseAsync(e){const i=this.parseAnimations(e.animations),s=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,s),o=await this.parseImagesAsync(e.images),a=this.parseTextures(e.textures,o),l=this.parseMaterials(e.materials,a),c=this.parseObject(e.object,r,l,a,i),h=this.parseSkeletons(e.skeletons,c);return this.bindSkeletons(c,h),c}parseShapes(e){const i={};if(e!==void 0)for(let s=0,r=e.length;s<r;s++){const o=new zu().fromJSON(e[s]);i[o.uuid]=o}return i}parseSkeletons(e,i){const s={},r={};if(i.traverse(function(o){o.isBone&&(r[o.uuid]=o)}),e!==void 0)for(let o=0,a=e.length;o<a;o++){const l=new xv().fromJSON(e[o],r);s[l.uuid]=l}return s}parseGeometries(e,i){const s={};if(e!==void 0){const r=new RN;for(let o=0,a=e.length;o<a;o++){let l;const c=e[o];switch(c.type){case"BufferGeometry":case"InstancedBufferGeometry":l=r.parse(c);break;default:c.type in pN?l=pN[c.type].fromJSON(c,i):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${c.type}"`)}l.uuid=c.uuid,c.name!==void 0&&(l.name=c.name),c.userData!==void 0&&(l.userData=c.userData),s[c.uuid]=l}}return s}parseMaterials(e,i){const s={},r={};if(e!==void 0){const o=new LT;o.setTextures(i);for(let a=0,l=e.length;a<l;a++){const c=e[a];s[c.uuid]===void 0&&(s[c.uuid]=o.parse(c)),r[c.uuid]=s[c.uuid]}}return r}parseAnimations(e){const i={};if(e!==void 0)for(let s=0;s<e.length;s++){const r=e[s],o=to.parse(r);i[o.uuid]=o}return i}parseImages(e,i){const s=this,r={};let o;function a(c){return s.manager.itemStart(c),o.load(c,function(){s.manager.itemEnd(c)},void 0,function(){s.manager.itemError(c),s.manager.itemEnd(c)})}function l(c){if(typeof c=="string"){const h=c,u=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(h)?h:s.resourcePath+h;return a(u)}else return c.data?{data:Df(c.type,c.data),width:c.width,height:c.height}:null}if(e!==void 0&&e.length>0){const c=new Hw(i);o=new Lv(c),o.setCrossOrigin(this.crossOrigin);for(let h=0,u=e.length;h<u;h++){const d=e[h],m=d.url;if(Array.isArray(m)){const f=[];for(let g=0,y=m.length;g<y;g++){const v=m[g],b=l(v);b!==null&&(b instanceof HTMLImageElement?f.push(b):f.push(new Tr(b.data,b.width,b.height)))}r[d.uuid]=new ch(f)}else{const f=l(d.url);r[d.uuid]=new ch(f)}}}return r}async parseImagesAsync(e){const i=this,s={};let r;async function o(a){if(typeof a=="string"){const l=a,c=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l)?l:i.resourcePath+l;return await r.loadAsync(c)}else return a.data?{data:Df(a.type,a.data),width:a.width,height:a.height}:null}if(e!==void 0&&e.length>0){r=new Lv(this.manager),r.setCrossOrigin(this.crossOrigin);for(let a=0,l=e.length;a<l;a++){const c=e[a],h=c.url;if(Array.isArray(h)){const u=[];for(let d=0,m=h.length;d<m;d++){const f=h[d],g=await o(f);g!==null&&(g instanceof HTMLImageElement?u.push(g):u.push(new Tr(g.data,g.width,g.height)))}s[c.uuid]=new ch(u)}else{const u=await o(c.url);s[c.uuid]=new ch(u)}}}return s}parseTextures(e,i){function s(o,a){return typeof o=="number"?o:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",o),a[o])}const r={};if(e!==void 0)for(let o=0,a=e.length;o<a;o++){const l=e[o];l.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',l.uuid),i[l.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",l.image);const c=i[l.image],h=c.data;let u;Array.isArray(h)?(u=new fv,h.length===6&&(u.needsUpdate=!0)):(h&&h.data?u=new Tr:u=new Vt,h&&(u.needsUpdate=!0)),u.source=c,u.uuid=l.uuid,l.name!==void 0&&(u.name=l.name),l.mapping!==void 0&&(u.mapping=s(l.mapping,kte)),l.channel!==void 0&&(u.channel=l.channel),l.offset!==void 0&&u.offset.fromArray(l.offset),l.repeat!==void 0&&u.repeat.fromArray(l.repeat),l.center!==void 0&&u.center.fromArray(l.center),l.rotation!==void 0&&(u.rotation=l.rotation),l.wrap!==void 0&&(u.wrapS=s(l.wrap[0],IN),u.wrapT=s(l.wrap[1],IN)),l.format!==void 0&&(u.format=l.format),l.internalFormat!==void 0&&(u.internalFormat=l.internalFormat),l.type!==void 0&&(u.type=l.type),l.colorSpace!==void 0&&(u.colorSpace=l.colorSpace),l.minFilter!==void 0&&(u.minFilter=s(l.minFilter,LN)),l.magFilter!==void 0&&(u.magFilter=s(l.magFilter,LN)),l.anisotropy!==void 0&&(u.anisotropy=l.anisotropy),l.flipY!==void 0&&(u.flipY=l.flipY),l.generateMipmaps!==void 0&&(u.generateMipmaps=l.generateMipmaps),l.premultiplyAlpha!==void 0&&(u.premultiplyAlpha=l.premultiplyAlpha),l.unpackAlignment!==void 0&&(u.unpackAlignment=l.unpackAlignment),l.compareFunction!==void 0&&(u.compareFunction=l.compareFunction),l.userData!==void 0&&(u.userData=l.userData),r[l.uuid]=u}return r}parseObject(e,i,s,r,o){let a;function l(m){return i[m]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",m),i[m]}function c(m){if(m!==void 0){if(Array.isArray(m)){const f=[];for(let g=0,y=m.length;g<y;g++){const v=m[g];s[v]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",v),f.push(s[v])}return f}return s[m]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",m),s[m]}}function h(m){return r[m]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",m),r[m]}let u,d;switch(e.type){case"Scene":a=new Ls,e.background!==void 0&&(Number.isInteger(e.background)?a.background=new Ae(e.background):a.background=h(e.background)),e.environment!==void 0&&(a.environment=h(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?a.fog=new vw(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(a.fog=new xT(e.fog.color,e.fog.density)),e.fog.name!==""&&(a.fog.name=e.fog.name)),e.backgroundBlurriness!==void 0&&(a.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(a.backgroundIntensity=e.backgroundIntensity),e.backgroundRotation!==void 0&&a.backgroundRotation.fromArray(e.backgroundRotation),e.environmentRotation!==void 0&&a.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":a=new Lt(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(a.focus=e.focus),e.zoom!==void 0&&(a.zoom=e.zoom),e.filmGauge!==void 0&&(a.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(a.filmOffset=e.filmOffset),e.view!==void 0&&(a.view=Object.assign({},e.view));break;case"OrthographicCamera":a=new ic(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(a.zoom=e.zoom),e.view!==void 0&&(a.view=Object.assign({},e.view));break;case"AmbientLight":a=new jw(e.color,e.intensity);break;case"DirectionalLight":a=new Hp(e.color,e.intensity);break;case"PointLight":a=new Wp(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":a=new MN(e.color,e.intensity,e.width,e.height);break;case"SpotLight":a=new Pv(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":a=new Q2(e.color,e.groundColor,e.intensity);break;case"LightProbe":a=new TN().fromJSON(e);break;case"SkinnedMesh":u=l(e.geometry),d=c(e.material),a=new Eo(u,d),e.bindMode!==void 0&&(a.bindMode=e.bindMode),e.bindMatrix!==void 0&&a.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(a.skeleton=e.skeleton);break;case"Mesh":u=l(e.geometry),d=c(e.material),a=new pe(u,d);break;case"InstancedMesh":u=l(e.geometry),d=c(e.material);const m=e.count,f=e.instanceMatrix,g=e.instanceColor;a=new x2(u,d,m),a.instanceMatrix=new To(new Float32Array(f.array),16),g!==void 0&&(a.instanceColor=new To(new Float32Array(g.array),g.itemSize));break;case"BatchedMesh":u=l(e.geometry),d=c(e.material),a=new Tw(e.maxGeometryCount,e.maxVertexCount,e.maxIndexCount,d),a.geometry=u,a.perObjectFrustumCulled=e.perObjectFrustumCulled,a.sortObjects=e.sortObjects,a._drawRanges=e.drawRanges,a._reservedRanges=e.reservedRanges,a._visibility=e.visibility,a._active=e.active,a._bounds=e.bounds.map(y=>{const v=new Wt;v.min.fromArray(y.boxMin),v.max.fromArray(y.boxMax);const b=new tn;return b.radius=y.sphereRadius,b.center.fromArray(y.sphereCenter),{boxInitialized:y.boxInitialized,box:v,sphereInitialized:y.sphereInitialized,sphere:b}}),a._maxGeometryCount=e.maxGeometryCount,a._maxVertexCount=e.maxVertexCount,a._maxIndexCount=e.maxIndexCount,a._geometryInitialized=e.geometryInitialized,a._geometryCount=e.geometryCount,a._matricesTexture=h(e.matricesTexture.uuid);break;case"LOD":a=new v2;break;case"Line":a=new mn(l(e.geometry),c(e.material));break;case"LineLoop":a=new C2(l(e.geometry),c(e.material));break;case"LineSegments":a=new Ir(l(e.geometry),c(e.material));break;case"PointCloud":case"Points":a=new hg(l(e.geometry),c(e.material));break;case"Sprite":a=new y2(c(e.material));break;case"Group":a=new Vn;break;case"Bone":a=new zp;break;default:a=new ye}if(a.uuid=e.uuid,e.name!==void 0&&(a.name=e.name),e.matrix!==void 0?(a.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(a.matrixAutoUpdate=e.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(e.position!==void 0&&a.position.fromArray(e.position),e.rotation!==void 0&&a.rotation.fromArray(e.rotation),e.quaternion!==void 0&&a.quaternion.fromArray(e.quaternion),e.scale!==void 0&&a.scale.fromArray(e.scale)),e.up!==void 0&&a.up.fromArray(e.up),e.castShadow!==void 0&&(a.castShadow=e.castShadow),e.receiveShadow!==void 0&&(a.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.bias!==void 0&&(a.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(a.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(a.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&a.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(a.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(a.visible=e.visible),e.frustumCulled!==void 0&&(a.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(a.renderOrder=e.renderOrder),e.userData!==void 0&&(a.userData=e.userData),e.layers!==void 0&&(a.layers.mask=e.layers),e.children!==void 0){const m=e.children;for(let f=0;f<m.length;f++)a.add(this.parseObject(m[f],i,s,r,o))}if(e.animations!==void 0){const m=e.animations;for(let f=0;f<m.length;f++){const g=m[f];a.animations.push(o[g])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(a.autoUpdate=e.autoUpdate);const m=e.levels;for(let f=0;f<m.length;f++){const g=m[f],y=a.getObjectByProperty("uuid",g.object);y!==void 0&&a.addLevel(y,g.distance,g.hysteresis)}}return a}bindSkeletons(e,i){Object.keys(i).length!==0&&e.traverse(function(s){if(s.isSkinnedMesh===!0&&s.skeleton!==void 0){const r=i[s.skeleton];r===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",s.skeleton):s.bind(r,s.bindMatrix)}})}}const kte={UVMapping:T1,CubeReflectionMapping:rh,CubeRefractionMapping:_u,EquirectangularReflectionMapping:Kr,EquirectangularRefractionMapping:If,CubeUVReflectionMapping:Lf},IN={RepeatWrapping:_o,ClampToEdgeWrapping:qn,MirroredRepeatWrapping:oh},LN={NearestFilter:Dt,NearestMipmapNearestFilter:Pf,NearestMipmapLinearFilter:ah,LinearFilter:Ot,LinearMipmapNearestFilter:wp,LinearMipmapLinearFilter:So};let PN=class extends es{constructor(n){super(n),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(n){return this.options=n,this}load(n,e,i,s){n===void 0&&(n=""),this.path!==void 0&&(n=this.path+n),n=this.manager.resolveURL(n);const r=this,o=vh.get(n);if(o!==void 0){if(r.manager.itemStart(n),o.then){o.then(c=>{e&&e(c),r.manager.itemEnd(n)}).catch(c=>{s&&s(c)});return}return setTimeout(function(){e&&e(o),r.manager.itemEnd(n)},0),o}const a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader;const l=fetch(n,a).then(function(c){return c.blob()}).then(function(c){return createImageBitmap(c,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(c){return vh.add(n,c),e&&e(c),r.manager.itemEnd(n),c}).catch(function(c){s&&s(c),vh.remove(n),r.manager.itemError(n),r.manager.itemEnd(n)});vh.add(n,l),r.manager.itemStart(n)}},Zw;class Yw{static getContext(){return Zw===void 0&&(Zw=new(window.AudioContext||window.webkitAudioContext)),Zw}static setContext(e){Zw=e}}class Kw extends es{constructor(e){super(e)}load(e,i,s,r){const o=this,a=new qs(this.manager);a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(c){try{const h=c.slice(0);Yw.getContext().decodeAudioData(h,function(u){i(u)}).catch(l)}catch(h){l(h)}},s,r);function l(c){r?r(c):console.error(c),o.manager.itemError(e)}}}const BN=new he,kN=new he,jp=new he;class Dte{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Lt,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Lt,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const i=this._cache;if(i.focus!==e.focus||i.fov!==e.fov||i.aspect!==e.aspect*this.aspect||i.near!==e.near||i.far!==e.far||i.zoom!==e.zoom||i.eyeSep!==this.eyeSep){i.focus=e.focus,i.fov=e.fov,i.aspect=e.aspect*this.aspect,i.near=e.near,i.far=e.far,i.zoom=e.zoom,i.eyeSep=this.eyeSep,jp.copy(e.projectionMatrix);const s=i.eyeSep/2,r=s*i.near/i.focus,o=i.near*Math.tan(Ep*i.fov*.5)/i.zoom;let a,l;kN.elements[12]=-s,BN.elements[12]=s,a=-o*i.aspect+r,l=o*i.aspect+r,jp.elements[0]=2*i.near/(l-a),jp.elements[8]=(l+a)/(l-a),this.cameraL.projectionMatrix.copy(jp),a=-o*i.aspect-r,l=o*i.aspect-r,jp.elements[0]=2*i.near/(l-a),jp.elements[8]=(l+a)/(l-a),this.cameraR.projectionMatrix.copy(jp)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(kN),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(BN)}}let J2=class{constructor(n=!0){this.autoStart=n,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=DN(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let n=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=DN();n=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=n}return n}};function DN(){return(typeof performance>"u"?Date:performance).now()}const rc=new E,ON=new Se,Ote=new E,Qp=new E;let GN=class extends ye{constructor(){super(),this.type="AudioListener",this.context=Yw.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new J2}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(n){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=n,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(n){return this.gain.gain.setTargetAtTime(n,this.context.currentTime,.01),this}updateMatrixWorld(n){super.updateMatrixWorld(n);const e=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(rc,ON,Ote),!(!Number.isFinite(rc.x)||!Number.isFinite(rc.y)||!Number.isFinite(rc.z)))if(Qp.set(0,0,-1).applyQuaternion(ON),e.positionX){const s=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(rc.x,s),e.positionY.linearRampToValueAtTime(rc.y,s),e.positionZ.linearRampToValueAtTime(rc.z,s),e.forwardX.linearRampToValueAtTime(Qp.x,s),e.forwardY.linearRampToValueAtTime(Qp.y,s),e.forwardZ.linearRampToValueAtTime(Qp.z,s),e.upX.linearRampToValueAtTime(i.x,s),e.upY.linearRampToValueAtTime(i.y,s),e.upZ.linearRampToValueAtTime(i.z,s)}else e.setPosition(rc.x,rc.y,rc.z),e.setOrientation(Qp.x,Qp.y,Qp.z,i.x,i.y,i.z)}},q2=class extends ye{constructor(n){super(),this.type="Audio",this.listener=n,this.context=n.context,this.gain=this.context.createGain(),this.gain.connect(n.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(n){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=n,this.connect(),this}setMediaElementSource(n){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(n),this.connect(),this}setMediaStreamSource(n){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(n),this.connect(),this}setBuffer(n){return this.buffer=n,this.sourceType="buffer",this.autoplay&&this.play(),this}play(n=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+n;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||(this.buffer?this.buffer.duration:Number.MAX_VALUE))),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let n=1,e=this.filters.length;n<e;n++)this.filters[n-1].connect(this.filters[n]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let n=1,e=this.filters.length;n<e;n++)this.filters[n-1].disconnect(this.filters[n]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(n){return n||(n=[]),this._connected===!0?(this.disconnect(),this.filters=n.slice(),this.connect()):this.filters=n.slice(),this}setDetune(n){return this.detune=n,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(n){return this.setFilters(n?[n]:[])}setPlaybackRate(n){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=n,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(n){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=n,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(n){return this.loopStart=n,this}setLoopEnd(n){return this.loopEnd=n,this}getVolume(){return this.gain.gain.value}setVolume(n){return this.gain.gain.setTargetAtTime(n,this.context.currentTime,.01),this}};const Zp=new E,zN=new Se,Gte=new E,Yp=new E;class FN extends q2{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,i,s){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=i,this.panner.coneOuterGain=s,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Zp,zN,Gte),Yp.set(0,0,1).applyQuaternion(zN);const i=this.panner;if(i.positionX){const s=this.context.currentTime+this.listener.timeDelta;i.positionX.linearRampToValueAtTime(Zp.x,s),i.positionY.linearRampToValueAtTime(Zp.y,s),i.positionZ.linearRampToValueAtTime(Zp.z,s),i.orientationX.linearRampToValueAtTime(Yp.x,s),i.orientationY.linearRampToValueAtTime(Yp.y,s),i.orientationZ.linearRampToValueAtTime(Yp.z,s)}else i.setPosition(Zp.x,Zp.y,Zp.z),i.setOrientation(Yp.x,Yp.y,Yp.z)}}class zte{constructor(e,i=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=i,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const i=this.getFrequencyData();for(let s=0;s<i.length;s++)e+=i[s];return e/i.length}}class NN{constructor(e,i,s){this.binding=e,this.valueSize=s;let r,o,a;switch(i){case"quaternion":r=this._slerp,o=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(s*6),this._workIndex=5;break;case"string":case"bool":r=this._select,o=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(s*5);break;default:r=this._lerp,o=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(s*5)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=o,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,i){const s=this.buffer,r=this.valueSize,o=e*r+r;let a=this.cumulativeWeight;if(a===0){for(let l=0;l!==r;++l)s[o+l]=s[l];a=i}else{a+=i;const l=i/a;this._mixBufferRegion(s,o,0,l,r)}this.cumulativeWeight=a}accumulateAdditive(e){const i=this.buffer,s=this.valueSize,r=s*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(i,r,0,e,s),this.cumulativeWeightAdditive+=e}apply(e){const i=this.valueSize,s=this.buffer,r=e*i+i,o=this.cumulativeWeight,a=this.cumulativeWeightAdditive,l=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,o<1){const c=i*this._origIndex;this._mixBufferRegion(s,r,c,1-o,i)}a>0&&this._mixBufferRegionAdditive(s,r,this._addIndex*i,1,i);for(let c=i,h=i+i;c!==h;++c)if(s[c]!==s[c+i]){l.setValue(s,r);break}}saveOriginalState(){const e=this.binding,i=this.buffer,s=this.valueSize,r=s*this._origIndex;e.getValue(i,r);for(let o=s,a=r;o!==a;++o)i[o]=i[r+o%s];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,i=e+this.valueSize;for(let s=e;s<i;s++)this.buffer[s]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,i=this._addIndex*this.valueSize;for(let s=0;s<this.valueSize;s++)this.buffer[i+s]=this.buffer[e+s]}_select(e,i,s,r,o){if(r>=.5)for(let a=0;a!==o;++a)e[i+a]=e[s+a]}_slerp(e,i,s,r){Se.slerpFlat(e,i,e,i,e,s,r)}_slerpAdditive(e,i,s,r,o){const a=this._workIndex*o;Se.multiplyQuaternionsFlat(e,a,e,i,e,s),Se.slerpFlat(e,i,e,i,e,a,r)}_lerp(e,i,s,r,o){const a=1-r;for(let l=0;l!==o;++l){const c=i+l;e[c]=e[c]*a+e[s+l]*r}}_lerpAdditive(e,i,s,r,o){for(let a=0;a!==o;++a){const l=i+a;e[l]=e[l]+e[s+a]*r}}}const $2="\\[\\]\\.:\\/",Fte=new RegExp("["+$2+"]","g"),eI="[^"+$2+"]",Nte="[^"+$2.replace("\\.","")+"]",Ute=/((?:WC+[\/:])*)/.source.replace("WC",eI),Vte=/(WCOD+)?/.source.replace("WCOD",Nte),Xte=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",eI),Wte=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",eI),Hte=new RegExp("^"+Ute+Vte+Xte+Wte+"$"),jte=["material","materials","bones","map"];let Qte=class{constructor(n,e,i){const s=i||Jt.parseTrackName(e);this._targetGroup=n,this._bindings=n.subscribe_(e,s)}getValue(n,e){this.bind();const i=this._targetGroup.nCachedObjects_,s=this._bindings[i];s!==void 0&&s.getValue(n,e)}setValue(n,e){const i=this._bindings;for(let s=this._targetGroup.nCachedObjects_,r=i.length;s!==r;++s)i[s].setValue(n,e)}bind(){const n=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=n.length;e!==i;++e)n[e].bind()}unbind(){const n=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=n.length;e!==i;++e)n[e].unbind()}},Jt=class Gy{constructor(e,i,s){this.path=i,this.parsedPath=s||Gy.parseTrackName(i),this.node=Gy.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,i,s){return e&&e.isAnimationObjectGroup?new Gy.Composite(e,i,s):new Gy(e,i,s)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Fte,"")}static parseTrackName(e){const i=Hte.exec(e);if(i===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const s={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]},r=s.nodeName&&s.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){const o=s.nodeName.substring(r+1);jte.indexOf(o)!==-1&&(s.nodeName=s.nodeName.substring(0,r),s.objectName=o)}if(s.propertyName===null||s.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return s}static findNode(e,i){if(i===void 0||i===""||i==="."||i===-1||i===e.name||i===e.uuid)return e;if(e.skeleton){const s=e.skeleton.getBoneByName(i);if(s!==void 0)return s}if(e.children){const s=function(o,a){for(let l=0;l<o.length;l++){const c=o[l];if(!a&&(c.name===i||c.uuid===i)||a&&c.userData&&c.userData.name===i)return c;const h=s(c.children,a);if(h)return h}return null},r=s(e.children);if(r)return r;{const o=s(e.children,!0);if(o)return o}}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,i){e[i]=this.targetObject[this.propertyName]}_getValue_array(e,i){const s=this.resolvedProperty;for(let r=0,o=s.length;r!==o;++r)e[i++]=s[r]}_getValue_arrayElement(e,i){e[i]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,i){this.resolvedProperty.toArray(e,i)}_setValue_direct(e,i){this.targetObject[this.propertyName]=e[i]}_setValue_direct_setNeedsUpdate(e,i){this.targetObject[this.propertyName]=e[i],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,i){this.targetObject[this.propertyName]=e[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,i){const s=this.resolvedProperty;for(let r=0,o=s.length;r!==o;++r)s[r]=e[i++]}_setValue_array_setNeedsUpdate(e,i){const s=this.resolvedProperty;for(let r=0,o=s.length;r!==o;++r)s[r]=e[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,i){const s=this.resolvedProperty;for(let r=0,o=s.length;r!==o;++r)s[r]=e[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,i){this.resolvedProperty[this.propertyIndex]=e[i]}_setValue_arrayElement_setNeedsUpdate(e,i){this.resolvedProperty[this.propertyIndex]=e[i],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,i){this.resolvedProperty[this.propertyIndex]=e[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,i){this.resolvedProperty.fromArray(e,i)}_setValue_fromArray_setNeedsUpdate(e,i){this.resolvedProperty.fromArray(e,i),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,i){this.resolvedProperty.fromArray(e,i),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,i){this.bind(),this.getValue(e,i)}_setValue_unbound(e,i){this.bind(),this.setValue(e,i)}bind(){let e=this.node;const i=this.parsedPath,s=i.objectName,r=i.propertyName;let o=i.propertyIndex;if(e||(e=Gy.findNode(this.rootNode,i.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(s){let h=i.objectIndex;switch(s){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let u=0;u<e.length;u++)if(e[u].name===h){h=u;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[s]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[s]}if(h!==void 0){if(e[h]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[h]}}const a=e[r];if(a===void 0){const h=i.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+h+"."+r+" but it wasn't found.",e);return}let l=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?l=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(l=this.Versioning.MatrixWorldNeedsUpdate);let c=this.BindingType.Direct;if(o!==void 0){if(r==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[o]!==void 0&&(o=e.morphTargetDictionary[o])}c=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=o}else a.fromArray!==void 0&&a.toArray!==void 0?(c=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(c=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=r;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][l]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};Jt.Composite=Qte,Jt.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Jt.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Jt.prototype.GetterByBindingType=[Jt.prototype._getValue_direct,Jt.prototype._getValue_array,Jt.prototype._getValue_arrayElement,Jt.prototype._getValue_toArray],Jt.prototype.SetterByBindingTypeAndVersioning=[[Jt.prototype._setValue_direct,Jt.prototype._setValue_direct_setNeedsUpdate,Jt.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Jt.prototype._setValue_array,Jt.prototype._setValue_array_setNeedsUpdate,Jt.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Jt.prototype._setValue_arrayElement,Jt.prototype._setValue_arrayElement_setNeedsUpdate,Jt.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Jt.prototype._setValue_fromArray,Jt.prototype._setValue_fromArray_setNeedsUpdate,Jt.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Zte{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Vo(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let s=0,r=arguments.length;s!==r;++s)e[arguments[s].uuid]=s;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const i=this;this.stats={objects:{get total(){return i._objects.length},get inUse(){return this.total-i.nCachedObjects_}},get bindingsPerObject(){return i._bindings.length}}}add(){const e=this._objects,i=this._indicesByUUID,s=this._paths,r=this._parsedPaths,o=this._bindings,a=o.length;let l,c=e.length,h=this.nCachedObjects_;for(let u=0,d=arguments.length;u!==d;++u){const m=arguments[u],f=m.uuid;let g=i[f];if(g===void 0){g=c++,i[f]=g,e.push(m);for(let y=0,v=a;y!==v;++y)o[y].push(new Jt(m,s[y],r[y]))}else if(g<h){l=e[g];const y=--h,v=e[y];i[v.uuid]=g,e[g]=v,i[f]=y,e[y]=m;for(let b=0,A=a;b!==A;++b){const x=o[b],w=x[y];let _=x[g];x[g]=w,_===void 0&&(_=new Jt(m,s[b],r[b])),x[y]=_}}else e[g]!==l&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=h}remove(){const e=this._objects,i=this._indicesByUUID,s=this._bindings,r=s.length;let o=this.nCachedObjects_;for(let a=0,l=arguments.length;a!==l;++a){const c=arguments[a],h=c.uuid,u=i[h];if(u!==void 0&&u>=o){const d=o++,m=e[d];i[m.uuid]=u,e[u]=m,i[h]=d,e[d]=c;for(let f=0,g=r;f!==g;++f){const y=s[f],v=y[d],b=y[u];y[u]=v,y[d]=b}}}this.nCachedObjects_=o}uncache(){const e=this._objects,i=this._indicesByUUID,s=this._bindings,r=s.length;let o=this.nCachedObjects_,a=e.length;for(let l=0,c=arguments.length;l!==c;++l){const h=arguments[l],u=h.uuid,d=i[u];if(d!==void 0)if(delete i[u],d<o){const m=--o,f=e[m],g=--a,y=e[g];i[f.uuid]=d,e[d]=f,i[y.uuid]=m,e[m]=y,e.pop();for(let v=0,b=r;v!==b;++v){const A=s[v],x=A[m],w=A[g];A[d]=x,A[m]=w,A.pop()}}else{const m=--a,f=e[m];m>0&&(i[f.uuid]=d),e[d]=f,e.pop();for(let g=0,y=r;g!==y;++g){const v=s[g];v[d]=v[m],v.pop()}}}this.nCachedObjects_=o}subscribe_(e,i){const s=this._bindingsIndicesByPath;let r=s[e];const o=this._bindings;if(r!==void 0)return o[r];const a=this._paths,l=this._parsedPaths,c=this._objects,h=c.length,u=this.nCachedObjects_,d=new Array(h);r=o.length,s[e]=r,a.push(e),l.push(i),o.push(d);for(let m=u,f=c.length;m!==f;++m){const g=c[m];d[m]=new Jt(g,e,i)}return d}unsubscribe_(e){const i=this._bindingsIndicesByPath,s=i[e];if(s!==void 0){const r=this._paths,o=this._parsedPaths,a=this._bindings,l=a.length-1,c=a[l],h=e[l];i[h]=s,a[s]=c,a.pop(),o[s]=o[l],o.pop(),r[s]=r[l],r.pop()}}}class UN{constructor(e,i,s=null,r=i.blendMode){this._mixer=e,this._clip=i,this._localRoot=s,this.blendMode=r;const o=i.tracks,a=o.length,l=new Array(a),c={endingStart:Cp,endingEnd:Cp};for(let h=0;h!==a;++h){const u=o[h].createInterpolant(null);l[h]=u,u.settings=c}this._interpolantSettings=c,this._interpolants=l,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=MR,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,i){return this.loop=e,this.repetitions=i,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,i,s){if(e.fadeOut(i),this.fadeIn(i),s){const r=this._clip.duration,o=e._clip.duration,a=o/r,l=r/o;e.warp(1,a,i),this.warp(l,1,i)}return this}crossFadeTo(e,i,s){return e.crossFadeFrom(this,i,s)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,i,s){const r=this._mixer,o=r.time,a=this.timeScale;let l=this._timeScaleInterpolant;l===null&&(l=r._lendControlInterpolant(),this._timeScaleInterpolant=l);const c=l.parameterPositions,h=l.sampleValues;return c[0]=o,c[1]=o+s,h[0]=e/a,h[1]=i/a,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,i,s,r){if(!this.enabled){this._updateWeight(e);return}const o=this._startTime;if(o!==null){const c=(e-o)*s;c<0||s===0?i=0:(this._startTime=null,i=s*c)}i*=this._updateTimeScale(e);const a=this._updateTime(i),l=this._updateWeight(e);if(l>0){const c=this._interpolants,h=this._propertyBindings;switch(this.blendMode){case ER:for(let u=0,d=c.length;u!==d;++u)c[u].evaluate(a),h[u].accumulateAdditive(l);break;case F1:default:for(let u=0,d=c.length;u!==d;++u)c[u].evaluate(a),h[u].accumulate(r,l)}}}_updateWeight(e){let i=0;if(this.enabled){i=this.weight;const s=this._weightInterpolant;if(s!==null){const r=s.evaluate(e)[0];i*=r,e>s.parameterPositions[1]&&(this.stopFading(),r===0&&(this.enabled=!1))}}return this._effectiveWeight=i,i}_updateTimeScale(e){let i=0;if(!this.paused){i=this.timeScale;const s=this._timeScaleInterpolant;if(s!==null){const r=s.evaluate(e)[0];i*=r,e>s.parameterPositions[1]&&(this.stopWarping(),i===0?this.paused=!0:this.timeScale=i)}}return this._effectiveTimeScale=i,i}_updateTime(e){const i=this._clip.duration,s=this.loop;let r=this.time+e,o=this._loopCount;const a=s===az;if(e===0)return o===-1?r:a&&(o&1)===1?i-r:r;if(s===$y){o===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=i)r=i;else if(r<0)r=0;else{this.time=r;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(o===-1&&(e>=0?(o=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),r>=i||r<0){const l=Math.floor(r/i);r-=i*l,o+=Math.abs(l);const c=this.repetitions-o;if(c<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?i:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(c===1){const h=e<0;this._setEndings(h,!h,a)}else this._setEndings(!1,!1,a);this._loopCount=o,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:l})}}else this.time=r;if(a&&(o&1)===1)return i-r}return r}_setEndings(e,i,s){const r=this._interpolantSettings;s?(r.endingStart=Mp,r.endingEnd=Mp):(e?r.endingStart=this.zeroSlopeAtStart?Mp:Cp:r.endingStart=ev,i?r.endingEnd=this.zeroSlopeAtEnd?Mp:Cp:r.endingEnd=ev)}_scheduleFading(e,i,s){const r=this._mixer,o=r.time;let a=this._weightInterpolant;a===null&&(a=r._lendControlInterpolant(),this._weightInterpolant=a);const l=a.parameterPositions,c=a.sampleValues;return l[0]=o,c[0]=i,l[1]=o+e,c[1]=s,this}}const Yte=new Float32Array(1);class Jw extends Rs{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,i){const s=e._localRoot||this._root,r=e._clip.tracks,o=r.length,a=e._propertyBindings,l=e._interpolants,c=s.uuid,h=this._bindingsByRootAndName;let u=h[c];u===void 0&&(u={},h[c]=u);for(let d=0;d!==o;++d){const m=r[d],f=m.name;let g=u[f];if(g!==void 0)++g.referenceCount,a[d]=g;else{if(g=a[d],g!==void 0){g._cacheIndex===null&&(++g.referenceCount,this._addInactiveBinding(g,c,f));continue}const y=i&&i._propertyBindings[d].binding.parsedPath;g=new NN(Jt.create(s,f,y),m.ValueTypeName,m.getValueSize()),++g.referenceCount,this._addInactiveBinding(g,c,f),a[d]=g}l[d].resultBuffer=g.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const s=(e._localRoot||this._root).uuid,r=e._clip.uuid,o=this._actionsByClip[r];this._bindAction(e,o&&o.knownActions[0]),this._addInactiveAction(e,r,s)}const i=e._propertyBindings;for(let s=0,r=i.length;s!==r;++s){const o=i[s];o.useCount++===0&&(this._lendBinding(o),o.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const i=e._propertyBindings;for(let s=0,r=i.length;s!==r;++s){const o=i[s];--o.useCount===0&&(o.restoreOriginalState(),this._takeBackBinding(o))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const i=e._cacheIndex;return i!==null&&i<this._nActiveActions}_addInactiveAction(e,i,s){const r=this._actions,o=this._actionsByClip;let a=o[i];if(a===void 0)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,o[i]=a;else{const l=a.knownActions;e._byClipCacheIndex=l.length,l.push(e)}e._cacheIndex=r.length,r.push(e),a.actionByRoot[s]=e}_removeInactiveAction(e){const i=this._actions,s=i[i.length-1],r=e._cacheIndex;s._cacheIndex=r,i[r]=s,i.pop(),e._cacheIndex=null;const o=e._clip.uuid,a=this._actionsByClip,l=a[o],c=l.knownActions,h=c[c.length-1],u=e._byClipCacheIndex;h._byClipCacheIndex=u,c[u]=h,c.pop(),e._byClipCacheIndex=null;const d=l.actionByRoot,m=(e._localRoot||this._root).uuid;delete d[m],c.length===0&&delete a[o],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const i=e._propertyBindings;for(let s=0,r=i.length;s!==r;++s){const o=i[s];--o.referenceCount===0&&this._removeInactiveBinding(o)}}_lendAction(e){const i=this._actions,s=e._cacheIndex,r=this._nActiveActions++,o=i[r];e._cacheIndex=r,i[r]=e,o._cacheIndex=s,i[s]=o}_takeBackAction(e){const i=this._actions,s=e._cacheIndex,r=--this._nActiveActions,o=i[r];e._cacheIndex=r,i[r]=e,o._cacheIndex=s,i[s]=o}_addInactiveBinding(e,i,s){const r=this._bindingsByRootAndName,o=this._bindings;let a=r[i];a===void 0&&(a={},r[i]=a),a[s]=e,e._cacheIndex=o.length,o.push(e)}_removeInactiveBinding(e){const i=this._bindings,s=e.binding,r=s.rootNode.uuid,o=s.path,a=this._bindingsByRootAndName,l=a[r],c=i[i.length-1],h=e._cacheIndex;c._cacheIndex=h,i[h]=c,i.pop(),delete l[o],Object.keys(l).length===0&&delete a[r]}_lendBinding(e){const i=this._bindings,s=e._cacheIndex,r=this._nActiveBindings++,o=i[r];e._cacheIndex=r,i[r]=e,o._cacheIndex=s,i[s]=o}_takeBackBinding(e){const i=this._bindings,s=e._cacheIndex,r=--this._nActiveBindings,o=i[r];e._cacheIndex=r,i[r]=e,o._cacheIndex=s,i[s]=o}_lendControlInterpolant(){const e=this._controlInterpolants,i=this._nActiveControlInterpolants++;let s=e[i];return s===void 0&&(s=new H2(new Float32Array(2),new Float32Array(2),1,Yte),s.__cacheIndex=i,e[i]=s),s}_takeBackControlInterpolant(e){const i=this._controlInterpolants,s=e.__cacheIndex,r=--this._nActiveControlInterpolants,o=i[r];e.__cacheIndex=r,i[r]=e,o.__cacheIndex=s,i[s]=o}clipAction(e,i,s){const r=i||this._root,o=r.uuid;let a=typeof e=="string"?to.findByName(r,e):e;const l=a!==null?a.uuid:e,c=this._actionsByClip[l];let h=null;if(s===void 0&&(a!==null?s=a.blendMode:s=F1),c!==void 0){const d=c.actionByRoot[o];if(d!==void 0&&d.blendMode===s)return d;h=c.knownActions[0],a===null&&(a=h._clip)}if(a===null)return null;const u=new UN(this,a,i,s);return this._bindAction(u,h),this._addInactiveAction(u,l,o),u}existingAction(e,i){const s=i||this._root,r=s.uuid,o=typeof e=="string"?to.findByName(s,e):e,a=o?o.uuid:e,l=this._actionsByClip[a];return l!==void 0&&l.actionByRoot[r]||null}stopAllAction(){const e=this._actions,i=this._nActiveActions;for(let s=i-1;s>=0;--s)e[s].stop();return this}update(e){e*=this.timeScale;const i=this._actions,s=this._nActiveActions,r=this.time+=e,o=Math.sign(e),a=this._accuIndex^=1;for(let h=0;h!==s;++h)i[h]._update(r,e,o,a);const l=this._bindings,c=this._nActiveBindings;for(let h=0;h!==c;++h)l[h].apply(a);return this}setTime(e){this.time=0;for(let i=0;i<this._actions.length;i++)this._actions[i].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const i=this._actions,s=e.uuid,r=this._actionsByClip,o=r[s];if(o!==void 0){const a=o.knownActions;for(let l=0,c=a.length;l!==c;++l){const h=a[l];this._deactivateAction(h);const u=h._cacheIndex,d=i[i.length-1];h._cacheIndex=null,h._byClipCacheIndex=null,d._cacheIndex=u,i[u]=d,i.pop(),this._removeInactiveBindingsForAction(h)}delete r[s]}}uncacheRoot(e){const i=e.uuid,s=this._actionsByClip;for(const a in s){const l=s[a].actionByRoot,c=l[i];c!==void 0&&(this._deactivateAction(c),this._removeInactiveAction(c))}const r=this._bindingsByRootAndName,o=r[i];if(o!==void 0)for(const a in o){const l=o[a];l.restoreOriginalState(),this._removeInactiveBinding(l)}}uncacheAction(e,i){const s=this.existingAction(e,i);s!==null&&(this._deactivateAction(s),this._removeInactiveAction(s))}}class Ce{constructor(e){this.value=e}clone(){return new Ce(this.value.clone===void 0?this.value:this.value.clone())}}let Kte=0;class Jte extends Rs{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:Kte++}),this.name="",this.usage=rv,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const i=this.uniforms.indexOf(e);return i!==-1&&this.uniforms.splice(i,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const i=e.uniforms;this.uniforms.length=0;for(let s=0,r=i.length;s<r;s++){const o=Array.isArray(i[s])?i[s]:[i[s]];for(let a=0;a<o.length;a++)this.uniforms.push(o[a].clone())}return this}clone(){return new this.constructor().copy(this)}}class qw extends yv{constructor(e,i,s=1){super(e,i),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=s}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const i=super.clone(e);return i.meshPerAttribute=this.meshPerAttribute,i}toJSON(e){const i=super.toJSON(e);return i.isInstancedInterleavedBuffer=!0,i.meshPerAttribute=this.meshPerAttribute,i}}class qte{constructor(e,i,s,r,o){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=i,this.itemSize=s,this.elementSize=r,this.count=o,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,i){return this.type=e,this.elementSize=i,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}const VN=new he;let Nu=class{constructor(n,e,i=0,s=1/0){this.ray=new qr(n,e),this.near=i,this.far=s,this.camera=null,this.layers=new Mr,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(n,e){this.ray.set(n,e)}setFromCamera(n,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(n.x,n.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(n.x,n.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}setFromXRController(n){return VN.identity().extractRotation(n.matrixWorld),this.ray.origin.setFromMatrixPosition(n.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(VN),this}intersectObject(n,e=!0,i=[]){return tI(n,this,i,e),i.sort(XN),i}intersectObjects(n,e=!0,i=[]){for(let s=0,r=n.length;s<r;s++)tI(n[s],this,i,e);return i.sort(XN),i}};function XN(n,e){return n.distance-e.distance}function tI(n,e,i,s){if(n.layers.test(e.layers)&&n.raycast(e,i),s===!0){const r=n.children;for(let o=0,a=r.length;o<a;o++)tI(r[o],e,i,!0)}}class iI{constructor(e=1,i=0,s=0){return this.radius=e,this.phi=i,this.theta=s,this}set(e,i,s){return this.radius=e,this.phi=i,this.theta=s,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,i,s){return this.radius=Math.sqrt(e*e+i*i+s*s),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,s),this.phi=Math.acos(Pn(i/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class $te{constructor(e=1,i=0,s=0){return this.radius=e,this.theta=i,this.y=s,this}set(e,i,s){return this.radius=e,this.theta=i,this.y=s,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,i,s){return this.radius=Math.sqrt(e*e+s*s),this.theta=Math.atan2(e,s),this.y=i,this}clone(){return new this.constructor().copy(this)}}const WN=new Y;class eie{constructor(e=new Y(1/0,1/0),i=new Y(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=i}set(e,i){return this.min.copy(e),this.max.copy(i),this}setFromPoints(e){this.makeEmpty();for(let i=0,s=e.length;i<s;i++)this.expandByPoint(e[i]);return this}setFromCenterAndSize(e,i){const s=WN.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(s),this.max.copy(e).add(s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,i){return i.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,i){return i.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,WN).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const HN=new E,$w=new E;class jo{constructor(e=new E,i=new E){this.start=e,this.end=i}set(e,i){return this.start.copy(e),this.end.copy(i),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,i){return this.delta(i).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,i){HN.subVectors(e,this.start),$w.subVectors(this.end,this.start);const s=$w.dot($w);let r=$w.dot(HN)/s;return i&&(r=Pn(r,0,1)),r}closestPointToPoint(e,i,s){const r=this.closestPointToPointParameter(e,i);return this.delta(s).multiplyScalar(r).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const jN=new E;class tie extends ye{constructor(e,i){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=i,this.type="SpotLightHelper";const s=new dt,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let a=0,l=1,c=32;a<c;a++,l++){const h=a/c*Math.PI*2,u=l/c*Math.PI*2;r.push(Math.cos(h),Math.sin(h),1,Math.cos(u),Math.sin(u),1)}s.setAttribute("position",new st(r,3));const o=new Vi({fog:!1,toneMapped:!1});this.cone=new Ir(s,o),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,i=e*Math.tan(this.light.angle);this.cone.scale.set(i,i,e),jN.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(jN),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Uu=new E,e_=new he,nI=new he;class iie extends Ir{constructor(e){const i=QN(e),s=new dt,r=[],o=[],a=new Ae(0,0,1),l=new Ae(0,1,0);for(let h=0;h<i.length;h++){const u=i[h];u.parent&&u.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),o.push(a.r,a.g,a.b),o.push(l.r,l.g,l.b))}s.setAttribute("position",new st(r,3)),s.setAttribute("color",new st(o,3));const c=new Vi({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(s,c),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=i,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const i=this.bones,s=this.geometry,r=s.getAttribute("position");nI.copy(this.root.matrixWorld).invert();for(let o=0,a=0;o<i.length;o++){const l=i[o];l.parent&&l.parent.isBone&&(e_.multiplyMatrices(nI,l.matrixWorld),Uu.setFromMatrixPosition(e_),r.setXYZ(a,Uu.x,Uu.y,Uu.z),e_.multiplyMatrices(nI,l.parent.matrixWorld),Uu.setFromMatrixPosition(e_),r.setXYZ(a+1,Uu.x,Uu.y,Uu.z),a+=2)}s.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function QN(n){const e=[];n.isBone===!0&&e.push(n);for(let i=0;i<n.children.length;i++)e.push.apply(e,QN(n.children[i]));return e}class nie extends pe{constructor(e,i,s){const r=new al(i,4,2),o=new Qt({wireframe:!0,fog:!1,toneMapped:!1});super(r,o),this.light=e,this.color=s,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const sie=new E,ZN=new Ae,YN=new Ae;class rie extends ye{constructor(e,i,s){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=s,this.type="HemisphereLightHelper";const r=new mu(i);r.rotateY(Math.PI*.5),this.material=new Qt({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const o=r.getAttribute("position"),a=new Float32Array(o.count*3);r.setAttribute("color",new qe(a,3)),this.add(new pe(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const i=e.geometry.getAttribute("color");ZN.copy(this.light.color),YN.copy(this.light.groundColor);for(let s=0,r=i.count;s<r;s++){const o=s<r/2?ZN:YN;i.setXYZ(s,o.r,o.g,o.b)}i.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(sie.setFromMatrixPosition(this.light.matrixWorld).negate())}}let t_=class extends Ir{constructor(n=10,e=10,i=4473924,s=8947848){i=new Ae(i),s=new Ae(s);const r=e/2,o=n/e,a=n/2,l=[],c=[];for(let d=0,m=0,f=-a;d<=e;d++,f+=o){l.push(-a,0,f,a,0,f),l.push(f,0,-a,f,0,a);const g=d===r?i:s;g.toArray(c,m),m+=3,g.toArray(c,m),m+=3,g.toArray(c,m),m+=3,g.toArray(c,m),m+=3}const h=new dt;h.setAttribute("position",new st(l,3)),h.setAttribute("color",new st(c,3));const u=new Vi({vertexColors:!0,toneMapped:!1});super(h,u),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}};class oie extends Ir{constructor(e=10,i=16,s=8,r=64,o=4473924,a=8947848){o=new Ae(o),a=new Ae(a);const l=[],c=[];if(i>1)for(let d=0;d<i;d++){const m=d/i*(Math.PI*2),f=Math.sin(m)*e,g=Math.cos(m)*e;l.push(0,0,0),l.push(f,0,g);const y=d&1?o:a;c.push(y.r,y.g,y.b),c.push(y.r,y.g,y.b)}for(let d=0;d<s;d++){const m=d&1?o:a,f=e-e/s*d;for(let g=0;g<r;g++){let y=g/r*(Math.PI*2),v=Math.sin(y)*f,b=Math.cos(y)*f;l.push(v,0,b),c.push(m.r,m.g,m.b),y=(g+1)/r*(Math.PI*2),v=Math.sin(y)*f,b=Math.cos(y)*f,l.push(v,0,b),c.push(m.r,m.g,m.b)}}const h=new dt;h.setAttribute("position",new st(l,3)),h.setAttribute("color",new st(c,3));const u=new Vi({vertexColors:!0,toneMapped:!1});super(h,u),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const KN=new E,i_=new E,JN=new E;class qN extends ye{constructor(e,i,s){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=s,this.type="DirectionalLightHelper",i===void 0&&(i=1);let r=new dt;r.setAttribute("position",new st([-i,i,0,i,i,0,i,-i,0,-i,-i,0,-i,i,0],3));const o=new Vi({fog:!1,toneMapped:!1});this.lightPlane=new mn(r,o),this.add(this.lightPlane),r=new dt,r.setAttribute("position",new st([0,0,0,0,0,1],3)),this.targetLine=new mn(r,o),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),KN.setFromMatrixPosition(this.light.matrixWorld),i_.setFromMatrixPosition(this.light.target.matrixWorld),JN.subVectors(i_,KN),this.lightPlane.lookAt(i_),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(i_),this.targetLine.scale.z=JN.length()}}const n_=new E,Bn=new mv;class $N extends Ir{constructor(e){const i=new dt,s=new Vi({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],o=[],a={};l("n1","n2"),l("n2","n4"),l("n4","n3"),l("n3","n1"),l("f1","f2"),l("f2","f4"),l("f4","f3"),l("f3","f1"),l("n1","f1"),l("n2","f2"),l("n3","f3"),l("n4","f4"),l("p","n1"),l("p","n2"),l("p","n3"),l("p","n4"),l("u1","u2"),l("u2","u3"),l("u3","u1"),l("c","t"),l("p","c"),l("cn1","cn2"),l("cn3","cn4"),l("cf1","cf2"),l("cf3","cf4");function l(g,y){c(g),c(y)}function c(g){r.push(0,0,0),o.push(0,0,0),a[g]===void 0&&(a[g]=[]),a[g].push(r.length/3-1)}i.setAttribute("position",new st(r,3)),i.setAttribute("color",new st(o,3)),super(i,s),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update();const h=new Ae(16755200),u=new Ae(16711680),d=new Ae(43775),m=new Ae(16777215),f=new Ae(3355443);this.setColors(h,u,d,m,f)}setColors(e,i,s,r,o){const a=this.geometry.getAttribute("color");a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,i.r,i.g,i.b),a.setXYZ(25,i.r,i.g,i.b),a.setXYZ(26,i.r,i.g,i.b),a.setXYZ(27,i.r,i.g,i.b),a.setXYZ(28,i.r,i.g,i.b),a.setXYZ(29,i.r,i.g,i.b),a.setXYZ(30,i.r,i.g,i.b),a.setXYZ(31,i.r,i.g,i.b),a.setXYZ(32,s.r,s.g,s.b),a.setXYZ(33,s.r,s.g,s.b),a.setXYZ(34,s.r,s.g,s.b),a.setXYZ(35,s.r,s.g,s.b),a.setXYZ(36,s.r,s.g,s.b),a.setXYZ(37,s.r,s.g,s.b),a.setXYZ(38,r.r,r.g,r.b),a.setXYZ(39,r.r,r.g,r.b),a.setXYZ(40,o.r,o.g,o.b),a.setXYZ(41,o.r,o.g,o.b),a.setXYZ(42,o.r,o.g,o.b),a.setXYZ(43,o.r,o.g,o.b),a.setXYZ(44,o.r,o.g,o.b),a.setXYZ(45,o.r,o.g,o.b),a.setXYZ(46,o.r,o.g,o.b),a.setXYZ(47,o.r,o.g,o.b),a.setXYZ(48,o.r,o.g,o.b),a.setXYZ(49,o.r,o.g,o.b),a.needsUpdate=!0}update(){const e=this.geometry,i=this.pointMap,s=1,r=1;Bn.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Xn("c",i,e,Bn,0,0,-1),Xn("t",i,e,Bn,0,0,1),Xn("n1",i,e,Bn,-s,-r,-1),Xn("n2",i,e,Bn,s,-r,-1),Xn("n3",i,e,Bn,-s,r,-1),Xn("n4",i,e,Bn,s,r,-1),Xn("f1",i,e,Bn,-s,-r,1),Xn("f2",i,e,Bn,s,-r,1),Xn("f3",i,e,Bn,-s,r,1),Xn("f4",i,e,Bn,s,r,1),Xn("u1",i,e,Bn,s*.7,r*1.1,-1),Xn("u2",i,e,Bn,-s*.7,r*1.1,-1),Xn("u3",i,e,Bn,0,r*2,-1),Xn("cf1",i,e,Bn,-s,0,1),Xn("cf2",i,e,Bn,s,0,1),Xn("cf3",i,e,Bn,0,-r,1),Xn("cf4",i,e,Bn,0,r,1),Xn("cn1",i,e,Bn,-s,0,-1),Xn("cn2",i,e,Bn,s,0,-1),Xn("cn3",i,e,Bn,0,-r,-1),Xn("cn4",i,e,Bn,0,r,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Xn(n,e,i,s,r,o,a){n_.set(r,o,a).unproject(s);const l=e[n];if(l!==void 0){const c=i.getAttribute("position");for(let h=0,u=l.length;h<u;h++)c.setXYZ(l[h],n_.x,n_.y,n_.z)}}const s_=new Wt;class sI extends Ir{constructor(e,i=16776960){const s=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(8*3),o=new dt;o.setIndex(new qe(s,1)),o.setAttribute("position",new qe(r,3)),super(o,new Vi({color:i,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&s_.setFromObject(this.object),s_.isEmpty())return;const i=s_.min,s=s_.max,r=this.geometry.attributes.position,o=r.array;o[0]=s.x,o[1]=s.y,o[2]=s.z,o[3]=i.x,o[4]=s.y,o[5]=s.z,o[6]=i.x,o[7]=i.y,o[8]=s.z,o[9]=s.x,o[10]=i.y,o[11]=s.z,o[12]=s.x,o[13]=s.y,o[14]=i.z,o[15]=i.x,o[16]=s.y,o[17]=i.z,o[18]=i.x,o[19]=i.y,o[20]=i.z,o[21]=s.x,o[22]=i.y,o[23]=i.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,i){return super.copy(e,i),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class rI extends Ir{constructor(e,i=16776960){const s=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],o=new dt;o.setIndex(new qe(s,1)),o.setAttribute("position",new st(r,3)),super(o,new Vi({color:i,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const i=this.box;i.isEmpty()||(i.getCenter(this.position),i.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class aie extends mn{constructor(e,i=1,s=16776960){const r=s,o=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],a=new dt;a.setAttribute("position",new st(o,3)),a.computeBoundingSphere(),super(a,new Vi({color:r,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=i;const l=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],c=new dt;c.setAttribute("position",new st(l,3)),c.computeBoundingSphere(),this.add(new pe(c,new Qt({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const eU=new E;let r_,oI;class lie extends ye{constructor(e=new E(0,0,1),i=new E(0,0,0),s=1,r=16776960,o=s*.2,a=o*.2){super(),this.type="ArrowHelper",r_===void 0&&(r_=new dt,r_.setAttribute("position",new st([0,0,0,0,1,0],3)),oI=new Yn(0,.5,1,5,1),oI.translate(0,-.5,0)),this.position.copy(i),this.line=new mn(r_,new Vi({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new pe(oI,new Qt({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(s,o,a)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{eU.set(e.z,0,-e.x).normalize();const i=Math.acos(e.y);this.quaternion.setFromAxisAngle(eU,i)}}setLength(e,i=e*.2,s=i*.2){this.line.scale.set(1,Math.max(1e-4,e-i),1),this.line.updateMatrix(),this.cone.scale.set(s,i,s),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}let io=class extends Ir{constructor(n=1){const e=[0,0,0,n,0,0,0,0,0,0,n,0,0,0,0,0,0,n],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],s=new dt;s.setAttribute("position",new st(e,3)),s.setAttribute("color",new st(i,3));const r=new Vi({vertexColors:!0,toneMapped:!1});super(s,r),this.type="AxesHelper"}setColors(n,e,i){const s=new Ae,r=this.geometry.attributes.color.array;return s.set(n),s.toArray(r,0),s.toArray(r,3),s.set(e),s.toArray(r,6),s.toArray(r,9),s.set(i),s.toArray(r,12),s.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}};class tU{constructor(){this.type="ShapePath",this.color=new Ae,this.subPaths=[],this.currentPath=null}moveTo(e,i){return this.currentPath=new Ev,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,i),this}lineTo(e,i){return this.currentPath.lineTo(e,i),this}quadraticCurveTo(e,i,s,r){return this.currentPath.quadraticCurveTo(e,i,s,r),this}bezierCurveTo(e,i,s,r,o,a){return this.currentPath.bezierCurveTo(e,i,s,r,o,a),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function i(b){const A=[];for(let x=0,w=b.length;x<w;x++){const _=b[x],S=new zu;S.curves=_.curves,A.push(S)}return A}function s(b,A){const x=A.length;let w=!1;for(let _=x-1,S=0;S<x;_=S++){let M=A[_],R=A[S],P=R.x-M.x,C=R.y-M.y;if(Math.abs(C)>Number.EPSILON){if(C<0&&(M=A[S],P=-P,R=A[_],C=-C),b.y<M.y||b.y>R.y)continue;if(b.y===M.y){if(b.x===M.x)return!0}else{const L=C*(b.x-M.x)-P*(b.y-M.y);if(L===0)return!0;if(L<0)continue;w=!w}}else{if(b.y!==M.y)continue;if(R.x<=b.x&&b.x<=M.x||M.x<=b.x&&b.x<=R.x)return!0}}return w}const r=Yl.isClockWise,o=this.subPaths;if(o.length===0)return[];let a,l,c;const h=[];if(o.length===1)return l=o[0],c=new zu,c.curves=l.curves,h.push(c),h;let u=!r(o[0].getPoints());u=e?!u:u;const d=[],m=[];let f=[],g=0,y;m[g]=void 0,f[g]=[];for(let b=0,A=o.length;b<A;b++)l=o[b],y=l.getPoints(),a=r(y),a=e?!a:a,a?(!u&&m[g]&&g++,m[g]={s:new zu,p:y},m[g].s.curves=l.curves,u&&g++,f[g]=[]):f[g].push({h:l,p:y[0]});if(!m[0])return i(o);if(m.length>1){let b=!1,A=0;for(let x=0,w=m.length;x<w;x++)d[x]=[];for(let x=0,w=m.length;x<w;x++){const _=f[x];for(let S=0;S<_.length;S++){const M=_[S];let R=!0;for(let P=0;P<m.length;P++)s(M.p,m[P].p)&&(x!==P&&A++,R?(R=!1,d[P].push(M)):b=!0);R&&d[x].push(M)}}A>0&&b===!1&&(f=d)}let v;for(let b=0,A=m.length;b<A;b++){c=m[b].s,h.push(c),v=f[b];for(let x=0,w=v.length;x<w;x++)c.holes.push(v[x].h)}return h}}class cie extends Zt{constructor(e=1,i=1,s=1,r={}){console.warn('THREE.WebGLMultipleRenderTargets has been deprecated and will be removed in r172. Use THREE.WebGLRenderTarget and set the "count" parameter to enable MRT.'),super(e,i,{...r,count:s}),this.isWebGLMultipleRenderTargets=!0}get texture(){return this.textures}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:sh}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported. Existing: "+window.__THREE__+", new: "+sh):window.__THREE__=sh);const hie=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:Ky,AddEquation:wu,AddOperation:ez,AdditiveAnimationBlendMode:ER,AdditiveBlending:bp,AgXToneMapping:Rf,AlphaFormat:sz,AlwaysCompare:Iz,AlwaysDepth:C1,AlwaysStencilFunc:X1,AmbientLight:jw,AnimationAction:UN,AnimationClip:to,AnimationLoader:Ete,AnimationMixer:Jw,AnimationObjectGroup:Zte,AnimationUtils:_te,ArcCurve:eN,ArrayCamera:m2,ArrowHelper:lie,AttachedBindMode:KT,Audio:q2,AudioAnalyser:zte,AudioContext:Yw,AudioListener:GN,AudioLoader:Kw,AxesHelper:io,BackSide:un,BasicDepthPacking:Ys,BasicShadowMap:e8,BatchedMesh:Tw,Bone:zp,BooleanKeyframeTrack:Vp,Box2:eie,Box3:Wt,Box3Helper:rI,BoxGeometry:$i,BoxHelper:sI,BufferAttribute:qe,BufferGeometry:dt,BufferGeometryLoader:RN,ByteType:R1,Cache:vh,Camera:mv,CameraHelper:$N,CanvasTexture:E2,CapsuleGeometry:wT,CatmullRomCurve3:tN,CineonToneMapping:tz,CircleGeometry:_T,ClampToEdgeWrapping:qn,Clock:J2,Color:Ae,ColorKeyframeTrack:Ww,ColorManagement:Ci,CompressedArrayTexture:jee,CompressedCubeTexture:Qee,CompressedTexture:Gu,CompressedTextureLoader:Tte,ConeGeometry:ST,ConstantAlphaFactor:J3,ConstantColorFactor:Y3,CubeCamera:t2,CubeReflectionMapping:rh,CubeRefractionMapping:_u,CubeTexture:fv,CubeTextureLoader:Rte,CubeUVReflectionMapping:Lf,CubicBezierCurve:P2,CubicBezierCurve3:nN,CubicInterpolant:bN,CullFaceBack:VT,CullFaceFront:G3,CullFaceFrontBack:$6,CullFaceNone:O3,Curve:Ra,CurvePath:rN,CustomBlending:QT,CustomToneMapping:iz,CylinderGeometry:Yn,Cylindrical:$te,Data3DTexture:zR,DataArrayTexture:Z1,DataTexture:Tr,DataTextureLoader:j2,DataUtils:Ip,DecrementStencilOp:mz,DecrementWrapStencilOp:gz,DefaultLoadingManager:wN,DepthFormat:Su,DepthStencilFormat:Cu,DepthTexture:tg,DetachedBindMode:nz,DirectionalLight:Hp,DirectionalLightHelper:qN,DiscreteInterpolant:AN,DisplayP3ColorSpace:V1,DodecahedronGeometry:CT,DoubleSide:xi,DstAlphaFactor:W3,DstColorFactor:j3,DynamicCopyUsage:h8,DynamicDrawUsage:Sr,DynamicReadUsage:a8,EdgesGeometry:z2,EllipseCurve:Pw,EqualCompare:Mz,EqualDepth:Ef,EqualStencilFunc:bz,EquirectangularReflectionMapping:Kr,EquirectangularRefractionMapping:If,Euler:si,EventDispatcher:Rs,ExtrudeGeometry:Fy,FileLoader:qs,Float16BufferAttribute:Z8,Float32BufferAttribute:st,FloatType:Hi,Fog:vw,FogExp2:xT,FramebufferTexture:Hee,FrontSide:Un,Frustum:Bp,GLBufferAttribute:qte,GLSL1:d8,GLSL3:W1,GreaterCompare:Ez,GreaterDepth:E1,GreaterEqualCompare:Rz,GreaterEqualDepth:M1,GreaterEqualStencilFunc:_z,GreaterStencilFunc:xz,GridHelper:t_,Group:Vn,HalfFloatType:ms,HemisphereLight:Q2,HemisphereLightHelper:rie,IcosahedronGeometry:MT,ImageBitmapLoader:PN,ImageLoader:Lv,ImageUtils:OR,IncrementStencilOp:pz,IncrementWrapStencilOp:fz,InstancedBufferAttribute:To,InstancedBufferGeometry:Qw,InstancedInterleavedBuffer:qw,InstancedMesh:x2,Int16BufferAttribute:j8,Int32BufferAttribute:Q8,Int8BufferAttribute:X8,IntType:_p,InterleavedBuffer:yv,InterleavedBufferAttribute:Ho,Interpolant:pg,InterpolateDiscrete:Mu,InterpolateLinear:ec,InterpolateSmooth:z1,InvertStencilOp:yz,KeepStencilOp:Tu,KeyframeTrack:fl,LOD:v2,LatheGeometry:u1,Layers:Mr,LessCompare:Cz,LessDepth:jy,LessEqualCompare:LR,LessEqualDepth:Ap,LessEqualStencilFunc:Az,LessStencilFunc:vz,Light:Fu,LightProbe:TN,Line:mn,Line3:jo,LineBasicMaterial:Vi,LineCurve:B2,LineCurve3:sN,LineDashedMaterial:gN,LineLoop:C2,LineSegments:Ir,LinearDisplayP3ColorSpace:tv,LinearEncoding:cz,LinearFilter:Ot,LinearInterpolant:H2,LinearMipMapLinearFilter:s8,LinearMipMapNearestFilter:n8,LinearMipmapLinearFilter:So,LinearMipmapNearestFilter:wp,LinearSRGBColorSpace:Bi,LinearToneMapping:Tf,LinearTransfer:iv,Loader:es,LoaderUtils:Ah,LoadingManager:Hw,LoopOnce:$y,LoopPingPong:az,LoopRepeat:MR,LuminanceAlphaFormat:rz,LuminanceFormat:I1,MOUSE:yp,Material:Ft,MaterialLoader:LT,MathUtils:oi,Matrix3:Gt,Matrix4:he,MaxEquation:w1,Mesh:pe,MeshBasicMaterial:Qt,MeshDepthMaterial:gv,MeshDistanceMaterial:p2,MeshLambertMaterial:V2,MeshMatcapMaterial:fN,MeshNormalMaterial:Xw,MeshPhongMaterial:dg,MeshPhysicalMaterial:Ro,MeshStandardMaterial:vs,MeshToonMaterial:mN,MinEquation:ZT,MirroredRepeatWrapping:oh,MixOperation:$3,MultiplyBlending:jT,MultiplyOperation:Zy,NearestFilter:Dt,NearestMipMapLinearFilter:i8,NearestMipMapNearestFilter:t8,NearestMipmapLinearFilter:ah,NearestMipmapNearestFilter:Pf,NeutralToneMapping:xp,NeverCompare:Sz,NeverDepth:YT,NeverStencilFunc:IR,NoBlending:dn,NoColorSpace:Co,NoToneMapping:Yr,NormalAnimationBlendMode:F1,NormalBlending:xu,NotEqualCompare:Tz,NotEqualDepth:Qy,NotEqualStencilFunc:wz,NumberKeyframeTrack:yh,Object3D:ye,ObjectLoader:Bte,ObjectSpaceNormalMap:hz,OctahedronGeometry:mu,OneFactor:U3,OneMinusConstantAlphaFactor:q3,OneMinusConstantColorFactor:K3,OneMinusDstAlphaFactor:H3,OneMinusDstColorFactor:Q3,OneMinusSrcAlphaFactor:S1,OneMinusSrcColorFactor:X3,OrthographicCamera:ic,P3Primaries:sv,PCFShadowMap:XT,PCFSoftShadowMap:WT,PMREMGenerator:c2,Path:Ev,PerspectiveCamera:Lt,Plane:fs,PlaneGeometry:ds,PlaneHelper:aie,PointLight:Wp,PointLightHelper:nie,Points:hg,PointsMaterial:Ou,PolarGridHelper:oie,PolyhedronGeometry:pp,PositionalAudio:FN,PropertyBinding:Jt,PropertyMixer:NN,QuadraticBezierCurve:k2,QuadraticBezierCurve3:D2,Quaternion:Se,QuaternionKeyframeTrack:gl,QuaternionLinearInterpolant:xN,RED_GREEN_RGTC2_Format:SR,RED_RGTC1_Format:oz,REVISION:sh,RGBADepthPacking:U1,RGBAFormat:_i,RGBAIntegerFormat:Bf,RGBA_ASTC_10x10_Format:vR,RGBA_ASTC_10x5_Format:fR,RGBA_ASTC_10x6_Format:gR,RGBA_ASTC_10x8_Format:yR,RGBA_ASTC_12x10_Format:bR,RGBA_ASTC_12x12_Format:AR,RGBA_ASTC_4x4_Format:aR,RGBA_ASTC_5x4_Format:lR,RGBA_ASTC_5x5_Format:cR,RGBA_ASTC_6x5_Format:hR,RGBA_ASTC_6x6_Format:uR,RGBA_ASTC_8x5_Format:dR,RGBA_ASTC_8x6_Format:pR,RGBA_ASTC_8x8_Format:mR,RGBA_BPTC_Format:G1,RGBA_ETC2_EAC_Format:oR,RGBA_PVRTC_2BPPV1_Format:nR,RGBA_PVRTC_4BPPV1_Format:iR,RGBA_S3TC_DXT1_Format:k1,RGBA_S3TC_DXT3_Format:D1,RGBA_S3TC_DXT5_Format:O1,RGB_BPTC_SIGNED_Format:xR,RGB_BPTC_UNSIGNED_Format:wR,RGB_ETC1_Format:sR,RGB_ETC2_Format:rR,RGB_PVRTC_2BPPV1_Format:tR,RGB_PVRTC_4BPPV1_Format:eR,RGB_S3TC_DXT1_Format:B1,RGFormat:P1,RGIntegerFormat:qy,RawShaderMaterial:Vw,Ray:qr,Raycaster:Nu,Rec709Primaries:nv,RectAreaLight:MN,RedFormat:Sp,RedIntegerFormat:L1,ReinhardToneMapping:Yy,RenderTarget:zz,RepeatWrapping:_o,ReplaceStencilOp:dz,ReverseSubtractEquation:F3,RingGeometry:d1,SIGNED_RED_GREEN_RGTC2_Format:CR,SIGNED_RED_RGTC1_Format:_R,SRGBColorSpace:vt,SRGBTransfer:ji,Scene:Ls,ShaderChunk:Mt,ShaderLib:Js,ShaderMaterial:kt,ShadowMaterial:Uw,Shape:zu,ShapeGeometry:ET,ShapePath:tU,ShapeUtils:Yl,ShortType:JT,Skeleton:xv,SkeletonHelper:iie,SkinnedMesh:Eo,Source:ch,Sphere:tn,SphereGeometry:al,Spherical:iI,SphericalHarmonics3:EN,SplineCurve:O2,SpotLight:Pv,SpotLightHelper:tie,Sprite:y2,SpriteMaterial:bw,SrcAlphaFactor:_1,SrcAlphaSaturateFactor:Z3,SrcColorFactor:V3,StaticCopyUsage:c8,StaticDrawUsage:rv,StaticReadUsage:o8,StereoCamera:Dte,StreamCopyUsage:u8,StreamDrawUsage:r8,StreamReadUsage:l8,StringKeyframeTrack:Xp,SubtractEquation:z3,SubtractiveBlending:HT,TOUCH:vp,TangentSpaceNormalMap:Eu,TetrahedronGeometry:TT,Texture:Vt,TextureLoader:sc,TorusGeometry:fu,TorusKnotGeometry:RT,Triangle:Ks,TriangleFanDrawMode:N1,TriangleStripDrawMode:TR,TrianglesDrawMode:lz,TubeGeometry:IT,UVMapping:T1,Uint16BufferAttribute:sw,Uint32BufferAttribute:qR,Uint8BufferAttribute:W8,Uint8ClampedBufferAttribute:H8,Uniform:Ce,UniformsGroup:Jte,UniformsLib:Ve,UniformsUtils:Kf,UnsignedByteType:pn,UnsignedInt248Type:lh,UnsignedIntType:_r,UnsignedShort4444Type:qT,UnsignedShort5551Type:$T,UnsignedShortType:Jy,VSMShadowMap:$l,Vector2:Y,Vector3:E,Vector4:Ze,VectorKeyframeTrack:nc,VideoTexture:$F,WebGL1Renderer:LF,WebGL3DRenderTarget:P8,WebGLArrayRenderTarget:L8,WebGLCoordinateSystem:tc,WebGLCubeRenderTarget:i2,WebGLMultipleRenderTargets:cie,WebGLRenderTarget:Zt,WebGLRenderer:gh,WebGLUtils:IF,WebGPUCoordinateSystem:ov,WireframeGeometry:U2,WrapAroundEnding:ev,ZeroCurvatureEnding:Cp,ZeroFactor:N3,ZeroSlopeEnding:Mp,ZeroStencilOp:uz,_SRGBAFormat:H1,createCanvasElement:Bz,sRGBEncoding:RR},Symbol.toStringTag,{value:"Module"}));let iU,nU=null;function yl(){return iU}function aI(n){if(n==null){console.warn("Oh no: someone tried registering a non-existend gltf-loader. When you see this log it might mean that needle-engine is being imported multiple times. Please check your project setup.");return}nU!==n&&(nU=n,iU=new n)}const lI=new Map;function no(n=(e=>(e=globalThis.location)==null?void 0:e.hostname)()){if(lI.has(n))return lI.get(n);const e=/(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})|localhost/.test(n);return lI.set(n,e),e===!0}function sU(){return window.location.hostname.includes("glitch.me")}var wi=(n=>(n.ContextRegistered="ContextRegistered",n.ContextCreationStart="ContextCreationStart",n.ContextCreated="ContextCreated",n.ContextFirstFrameRendered="ContextFirstFrameRendered",n.ContextDestroying="ContextDestroying",n.ContextDestroyed="ContextDestroyed",n.MissingCamera="MissingCamera",n.ContextClearing="ContextClearing",n.ContextCleared="ContextCleared",n))(wi||{});class yi{static get Current(){return globalThis["NeedleEngine.Context.Current"]}static set Current(e){globalThis["NeedleEngine.Context.Current"]=e}static get All(){return this.Registered}static register(e){this.Registered.push(e),this.dispatchCallback("ContextRegistered",e)}static unregister(e){const i=this.Registered.indexOf(e);i!==-1&&this.Registered.splice(i,1)}static registerCallback(e,i){this._callbacks[e]||(this._callbacks[e]=[]),this._callbacks[e].push(i)}static unregisterCallback(e,i){if(!this._callbacks[e])return;const s=this._callbacks[e].indexOf(i);s!==-1&&this._callbacks[e].splice(s,1)}static dispatchCallback(e,i,s){if(!this._callbacks[e])return!0;const r={event:e,context:i};if(s)for(const a in s)r[a]=s[a];const o=new Array;return this._callbacks[e].forEach(a=>{const l=a(r);l instanceof Promise&&o.push(l)}),Promise.all(o)}static addContextCreatedCallback(e){this.registerCallback("ContextCreated",e)}static addContextDestroyedCallback(e){this.registerCallback("ContextDestroyed",e)}}p(yi,"Registered",[]),p(yi,"_callbacks",{});const rU=()=>n=>n;function uie(n){return rU()(n)}function die(){return!!te("debug")}class Qo{constructor(e,i){p(this,"_factory"),p(this,"_cache",[]),p(this,"_maxSize"),p(this,"_index",0),this._factory=e,this._maxSize=i}get(){const e=this._index%this._maxSize;return this._index++,this._cache.length<=e&&(this._cache[e]=this._factory()),this._cache[e]}}let Kp=!1;const cI=new Array;typeof window<"u"&&setTimeout(()=>{if(Kp){const n={},e=new URL(window.location.href),i=new URL(e);i.searchParams.append("console","");const s=i.toString().replace(/=$|=(?=&)/g,"");for(const o of cI){const a=new URL(e);a.searchParams.append(o,""),n[o]=a.toString().replace(/=$|=(?=&)/g,"")}console.log(`\u{1F335} ?help: Debug Options for Needle Engine.
Append any of these parameters to the URL to enable specific debug options.
Example: ${s} will show an onscreen console window.`);const r=Kp===!0?"":` (containing "${Kp}")`;console.group("Available URL parameters:"+r);for(const o in n)typeof Kp=="string"&&!o.toLowerCase().includes(Kp.toLowerCase())||(console.groupCollapsed(o),console.log("Reload with this flag enabled:"),console.log(n[o]),console.groupEnd());console.groupEnd()}},100);function kv(){var n;return new URLSearchParams((n=globalThis.location)==null?void 0:n.search)}function te(n){Kp&&!cI.includes(n)&&cI.push(n);const e=kv();if(e.has(n)){const i=e.get(n);if(i){const s=Number(i);return isNaN(s)?i:s}else return!0}return!1}Kp=te("help");function pie(n,e){const i=kv();i.has(n)?i.set(n,e):i.append(n,e),document.location.search=i.toString()}function o_(n,e,i=!0){const s=kv();s.has(n)?e===null?s.delete(n):s.set(n,e):e!==null&&s.append(n,e),i?oU(n,s):uI(n,s)}function hI(n,e,i){n.has(e)?n.set(e,i.toString()):n.append(e,i.toString())}function oU(n,e,i){window.history.pushState(i,n,"?"+e.toString())}function uI(n,e,i){window.history.replaceState(i,n,"?"+e.toString())}function mie(n){for(var e="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",s=i.length,r=0;r<n;r++)e+=i.charAt(Math.floor(Math.random()*s));return e}function fie(n,e){return Math.floor(Math.random()*(e-n+1))+n}const aU=["smol","tiny","giant","interesting","smart","bright","dull","extreme","beautiful","pretty","dark","epic","salty","silly","funny","lame","lazy","loud","lucky","mad","mean","mighty","mysterious","nasty","odd","old","powerful","quiet","rapid","scary","shiny","shy","silly","smooth","sour","spicy","stupid","sweet","tasty","terrible","ugly","unusual","vast","wet","wild","witty","wrong","zany","zealous","zippy","zombie","zorro"],lU=["cat","dog","mouse","pig","cow","horse","sheep","chicken","duck","goat","panda","tiger","lion","elephant","monkey","bird","fish","snake","frog","turtle","hamster","penguin","kangaroo","whale","dolphin","crocodile","snail","ant","bee","beetle","butterfly","dragon","eagle","fish","giraffe","lizard","panda","penguin","rabbit","snake","spider","tiger","zebra"];function cU(){const n=aU[Math.floor(Math.random()*aU.length)],e=lU[Math.floor(Math.random()*lU.length)];return n+"_"+e}function hU(n){return n=n.replace(/[^a-z0-9 \.,_-]/gim,""),n.trim()}function mg(n,e,i=!0,s=!1){var r;if(e==null)return null;if(e.userData&&e.userData.guid===n||e.guid==n)return e;if(s&&(r=e.userData)!=null&&r.components){for(const o of e.userData.components)if(o.guid===n)return o}if(i){if(e.scenes)for(const o in e.scenes){const a=e.scenes[o],l=mg(n,a,i,s);if(l)return l}if(e.children)for(const o in e.children){const a=e.children[o],l=mg(n,a,i,s);if(l)return l}}}function Dv(n,e){if(n!=null&&typeof n=="object"){let i;Array.isArray(n)?i=[]:(i=Object.create(n),Object.assign(i,n));for(const s of Object.keys(n)){const r=n[s];e&&!e(n,s,r)?i[s]=r:r?.clone!==void 0&&typeof r.clone=="function"?i[s]=r.clone():i[s]=Dv(r,e)}return i}return n}function oc(n){return new Promise((e,i)=>{setTimeout(e,n)})}function a_(n,e){if(n<=0)return Promise.resolve();if(e||(e=yi.Current),!e)return Promise.reject("No context");const i=e.time.frameCount+n;return new Promise((s,r)=>{if(!e)return r("No context");const o=()=>{e.time.frameCount>=i&&(e.pre_update_callbacks.splice(e.pre_update_callbacks.indexOf(o),1),s())};e.pre_update_callbacks.push(o)})}const l_=te("debugresolveurl"),uU="rel:";function gie(n,e){return Vu(n,e)}function Vu(n,e){if(e===void 0)return l_&&console.warn("getPath: uri is undefined, returning uri",e),e;if(e.startsWith("./"))return e;if(e.startsWith("http"))return l_&&console.warn("getPath: uri is absolute, returning uri",e),e;if(n===void 0)return l_&&console.warn("getPath: source is undefined, returning uri",e),e;e.startsWith(uU)&&(e=e.substring(4));const i=n.lastIndexOf("/");if(i>=0){const s=n.substring(0,i+1);for(;s.endsWith("/")&&e.startsWith("/");)e=e.substring(1);const r=s+e;return l_&&console.log("source:",n,`changed uri 
from`,e,`
to `,r,`
basePath: `+s),r}return e}class yie{constructor(e,i){p(this,"writeCallbacks",[]),p(this,"_applied",!1),p(this,"_object"),p(this,"_prop"),p(this,"_wrapperProp"),this._object=e,this._prop=i,this._wrapperProp=Symbol("$"+i),this.apply()}subscribeWrite(e){this.writeCallbacks.push(e)}unsubscribeWrite(e){const i=this.writeCallbacks.indexOf(e);i!==-1&&this.writeCallbacks.splice(i,1)}apply(){if(this._applied||!this._object)return;const e=this._object,i=this._prop;if(e[i]===void 0)return;this._applied=!0,e[this._wrapperProp]!==void 0&&console.warn("Watcher is being applied to an object that already has a wrapper property. This is not (yet) supported");const s=e[i];e[this._wrapperProp]=s,Object.defineProperty(e,i,{get:()=>e[this._wrapperProp],set:r=>{e[this._wrapperProp]=r;for(const o of this.writeCallbacks)o(r,this._prop)}})}revoke(){if(!this._applied||!this._object)return;this._applied=!1;const e=this._object,i=this._prop;Reflect.deleteProperty(e,i);const s=e[this._wrapperProp];e[i]=s,Reflect.deleteProperty(e,this._wrapperProp)}dispose(){this.revoke(),this.writeCallbacks.length=0,this._object=null}}class gu{constructor(e,i){if(p(this,"_watches",[]),Array.isArray(i))for(const s of i)this._watches.push(new gu(e,s));else this._watches.push(new yie(e,i))}subscribeWrite(e){for(const i of this._watches)i.subscribeWrite(e)}unsubscribeWrite(e){for(const i of this._watches)i.unsubscribeWrite(e)}apply(){for(const e of this._watches)e.apply()}revoke(){for(const e of this._watches)e.revoke()}dispose(){for(const e of this._watches)e.dispose();this._watches.length=0}}const fg=Symbol("needle:watches");function c_(n,e){if(!n[fg])if(n instanceof Y)n[fg]=new gu(n,["x","y"]);else if(n instanceof E)n[fg]=new gu(n,["x","y","z"]);else if(n instanceof Ze||n instanceof Se)n[fg]=new gu(n,["x","y","z","w"]);else return!1;return n[fg].subscribeWrite(e),!0}function dI(n,e){if(!n)return;const i=n[fg];i&&i.unsubscribeWrite(e)}var xt;(n=>{let e;function i(){if(e!==void 0)return e;const B=window.navigator.userAgent,z=/Windows|MacOS|Mac OS/.test(B),D=/Windows NT/.test(B)&&/Edg/.test(B)&&!/Win64/.test(B);return e=z&&!D&&!v()}n.isDesktop=i;let s;function r(){return s!==void 0?s:typeof window.orientation<"u"||navigator.userAgent.indexOf("IEMobile")!==-1?s=!0:s=/iPhone|iPad|iPod|Android|IEMobile/i.test(navigator.userAgent)}n.isMobileDevice=r;function o(){return l()}n.isIPad=o;let a;function l(){return a!==void 0?a:a=/iPad/.test(navigator.userAgent)}n.isiPad=l;let c;function h(){return c!==void 0?c:c=/Android/.test(navigator.userAgent)}n.isAndroidDevice=h;let u;function d(){return u!==void 0?u:u=/WebXRViewer\//i.test(navigator.userAgent)}n.isMozillaXR=d;let m;function f(){if(m!==void 0)return m;if(navigator.userAgentData)return m=navigator.userAgentData.platform==="macOS";{const B=navigator.userAgent.toLowerCase();return m=B.includes("mac os x")||B.includes("macintosh")}}n.isMacOS=f;let g;const y=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"];function v(){return g!==void 0?g:g=y.includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}n.isiOS=v;let b;function A(){return b!==void 0||(b=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),b}n.isSafari=A;let x;function w(){return x!==void 0?x:x=navigator.userAgent.includes("OculusBrowser")}n.isQuest=w;let _;function S(){return _!==void 0||(_=document.createElement("a").relList.supports("ar")),_}n.supportsQuickLookAR=S;async function M(){try{return(await navigator.permissions.query({name:"microphone"})).state!=="denied"}catch(B){return console.error("Error querying `microphone` permissions.",B),!1}}n.microphonePermissionsGranted=M;let R;function P(){if(R!==void 0)return R;const B=navigator.userAgent.match(/iPhone OS (\d+_\d+)/);if(B&&(R=B[1].replace("_",".")),!R){const z=navigator.userAgent.match(/(?:\(Macintosh;|iPhone;|iPad;).*Version\/(\d+\.\d+)/);z&&(R=z[1])}return R||(R=null),R}n.getiOSVersion=P;let C;function L(){if(C!==void 0)return C;const B=navigator.userAgent.match(/(?:CriOS|Chrome)\/(\d+\.\d+\.\d+\.\d+)/);return B?C=B[1].replace("_","."):C=null,C}n.getChromeVersion=L})(xt||(xt={}));function vie(){return xt.isDesktop()}function bie(){return xt.isMobileDevice()}function Aie(){return xt.isiPad()}function xie(){return xt.isiPad()}function wie(){return xt.isAndroidDevice()}function _ie(){return xt.isMozillaXR()}function Sie(){return xt.isMacOS()}function Cie(){return xt.isiOS()}function Mie(){return xt.isSafari()}function Eie(){return xt.isQuest()}async function Tie(){return xt.microphonePermissionsGranted()}const Rie=/ip=(?<ip>.+?)\n/s;async function Iie(){const n=await(await fetch("https://www.cloudflare.com/cdn-cgi/trace")).text(),e=Rie.exec(n);return e?e[1]:null}async function Lie(){const n=await fetch("https://api.db-ip.com/v2/free/self").catch(()=>null);return n?(await n.json()).ipAddress:void 0}async function Pie(){const n=await fetch("https://api.db-ip.com/v2/free/self").catch(()=>null);return n?await n.json():void 0}const Xu=new WeakMap;function dU(n,e,i){if(!Xu.get(n)){const r=new MutationObserver(o=>{Bie(n,o)});Xu.set(n,{observer:r,attributeChangedListeners:new Map}),r.observe(n,{attributes:!0})}const s=Xu.get(n).attributeChangedListeners;s.has(e)||s.set(e,[]),s.get(e).push(i)}function pU(n,e,i){if(!Xu.get(n))return;const s=Xu.get(n).attributeChangedListeners;if(!s.has(e))return;const r=s.get(e),o=r.indexOf(i);if(o!==-1&&(r.splice(o,1),r.length<=0)){s.delete(e);const a=Xu.get(n);a?.observer.disconnect(),Xu.delete(n)}}function Bie(n,e){const i=Xu.get(n).attributeChangedListeners;for(const s of e)if(s.type==="attributes"){const r=s.attributeName,o=n.getAttribute(r);if(i.has(r))for(const a of i.get(r))a(o)}}class pI{constructor(e){p(this,"reason"),this.reason=e}}async function h_(n){const e=await Promise.allSettled(n).catch(r=>[new pI(r.message)]);let i=!1;const s=e.map(r=>"value"in r?r.value:(i=!0,new pI(r.reason)));return{anyFailed:i,results:s}}async function mU(n){if(!globalThis.QRCode){const s="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js";let r=document.head.querySelector(`script[src="${s}"]`);r||(r=document.createElement("script"),r.src=s,document.head.appendChild(r)),await new Promise((o,a)=>{r.addEventListener("load",()=>{o(!0)})})}const e=globalThis.QRCode,i=n.domElement??document.createElement("div");return new e(i,{width:n.width??256,height:n.height??256,colorDark:"#000000",colorLight:"#ffffff",correctLevel:e.CorrectLevel.M,...n}),i}const fU=te("debugdebug");let Ov=!1;(te("noerrors")||te("nooverlaymessages"))&&(Ov=!0);const mI="needle_engine_global_error_container";var Zo=(n=>(n[n.Log=0]="Log",n[n.Warn=1]="Warn",n[n.Error=2]="Error",n))(Zo||{});function fI(){return bU}const gI=new Array;function kie(n){gI.push(n)}let yI=!1;function Die(...n){if(!yI){yI=!0;try{for(let e=0;e<gI.length;e++)gI[e](...n)}catch(e){console.error(e)}yI=!1}}const gU=console.error,yU=function(...n){gU.apply(console,n),zie(n),ac(2,n),vI(...n)};function vU(n){Ov=!n,n?console.error=yU:console.error=gU}function Oie(n){return vU(n)}function Gie(){Ov||(fU&&console.warn("Patch console",window.location.hostname),console.error=yU,window.addEventListener("error",n=>{if(!n)return;const e=n.error;if(e===void 0){no()&&console.warn("Received unknown error",n,n.target);return}ac(2,e,n.filename,n.lineno),vI(n)},!0),window.addEventListener("unhandledrejection",n=>{Ov||n&&(n.reason?ac(2,n.reason.message,n.reason.stack):ac(2,"unhandled rejection"),vI(n))}))}let bU=0;function vI(...n){bU+=1,Die(...n)}function zie(n){if(Array.isArray(n))for(let e=0;e<n.length;e++){const i=n[e];typeof i=="string"&&i.startsWith("THREE.PropertyBinding: Trying to update node for track:")&&(n[e]="Some animated objects couldn't be found: see console for details")}}function ac(n,e,i,s){if(Ov)return;const r=yi.Current,o=r?.domElement??document.querySelector("needle-engine");if(o){if(Array.isArray(e)){let a="";for(let l=0;l<e.length;l++){let c=e[l];c instanceof Error&&(c=c.message),typeof c!="object"&&(l>0&&(a+=" "),a+=c)}e=a}!e||e.length<=0||Fie(n,o,e)}}const Gv=new Map;function Fie(n,e,i){if(i==null)return;const s=Uie(e);if(s.childElementCount>=20){const l=s.lastElementChild;wU(l)}i.length>400&&(i=i.substring(0,400)+"...");const r=i;if(Gv.has(r))return;const o=Vie(n,i);s.prepend(o);const a=()=>{Gv.delete(r),wU(o)};Gv.set(r,a),setTimeout(a,1e4)}function AU(){fU&&console.log("Clearing messages");for(const n of Gv.values())n?.call(n);Gv.clear()}const Nie=`

@import url('https://fonts.googleapis.com/css2?family=Roboto+Flex:opsz,wght@8..144,100..1000&display=swap');

div[data-needle_engine_debug_overlay] {
    font-family: 'Roboto Flex', sans-serif;
    font-weight: 400;
    font-size: 16px;
}

div[data-needle_engine_debug_overlay] strong {
    font-weight: 700;
}

div[data-needle_engine_debug_overlay] a {
    color: white;
    text-decoration: none;
    border-bottom: 1px solid rgba(255, 255, 255, 0.3);
}

div[data-needle_engine_debug_overlay] a:hover {
    text-decoration: none;
    border: none;
}

div[data-needle_engine_debug_overlay] .log strong {
    color: rgba(200,200,200,.9);
}

div[data-needle_engine_debug_overlay] .warn strong {
    color: rgba(255,255,230, 1);
}

div[data-needle_engine_debug_overlay] .error strong {
    color: rgba(255,100,120, 1);
}
`;function Uie(n){globalThis[mI]||(globalThis[mI]=new Map);const e=globalThis[mI];if(e.has(n))return e.get(n);{const i=document.createElement("div");e.set(n,i),i.setAttribute("data-needle_engine_debug_overlay",""),i.classList.add("debug-container"),i.style.cssText=`
            position: absolute;
            top: 0;
            right: 5px;
            padding-top: 0px;
            max-width: 70%;
            max-height: calc(100% - 5px);
            z-index: 9999999999;
            pointer-events: scroll;
            display: flex;
            align-items: end;
            flex-direction: column;
            color: white;
            overflow: auto;
            word-break: break-word;
        `,n.shadowRoot?n.shadowRoot.appendChild(i):n.appendChild(i);const s=document.createElement("style");return s.innerHTML=Nie,i.appendChild(s),i}}const xU=Symbol("logtype"),u_=new Map;function wU(n){n.remove();const e=n[xU],i=u_.get(e)??[];i.push(n),u_.set(e,i)}function Vie(n,e){if(u_.has(n)){const s=u_.get(n);if(s.length>0){const r=s.pop();return r.innerHTML=e,r}}const i=document.createElement("div");switch(i.setAttribute("data-id","__needle_engine_debug_overlay"),i.style.marginRight="5px",i.style.padding=".5em",i.style.backgroundColor="rgba(0,0,0,.9)",i.style.marginTop="5px",i.style.marginBottom="3px",i.style.borderRadius="8px",i.style.pointerEvents="all",i.style.userSelect="text",i.style.maxWidth="250px",i.style.whiteSpace="pre-wrap",i.style["backdrop-filter"]="blur(10px)",i.style["-webkit-backdrop-filter"]="blur(10px)",i.style.backgroundColor="rgba(20,20,20,.8)",i.style.boxShadow="inset 0 0 80px rgba(0,0,0,.2), 0 0 5px rgba(0,0,0,.2)",i.style.border="1px solid rgba(160,160,160,.2)",i[xU]=n,n){case 0:i.classList.add("log"),i.style.color="rgba(200,200,200,.7)",i.style.backgroundColor="rgba(40,40,40,.7)";break;case 1:i.classList.add("warn"),i.style.color="rgb(255, 255, 150)",i.style.backgroundColor="rgba(50,50,20,.8)";break;case 2:i.classList.add("error"),i.style.color="rgb(255, 50, 50",i.style.backgroundColor="rgba(50,20,20,.8)";break}return i.title="Open the browser console (F12) for more information",i.innerHTML=e,i}var vl={};vl.d=(n,e)=>{for(var i in e)vl.o(e,i)&&!vl.o(n,i)&&Object.defineProperty(n,i,{enumerable:!0,get:e[i]})},vl.o=(n,e)=>Object.prototype.hasOwnProperty.call(n,e),vl.r=n=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})};var ts={};vl.d(ts,{ti:()=>Ti,nS:()=>f5,eB:()=>b1,Yp:()=>bI,VB:()=>qp,BC:()=>zv,zN:()=>Jp,cV:()=>Xy,hW:()=>x1,k2:()=>RU,K6:()=>ul,M7:()=>AI,ls:()=>Nv,Hi:()=>QU,EY:()=>A1,MR:()=>zU,zf:()=>TU,Ay:()=>noe,yo:()=>g5});var bI={};vl.r(bI),vl.d(bI,{get:()=>_U,set:()=>Xie});var AI={};vl.r(AI),vl.d(AI,{alphaTestTransformer:()=>g_,asPreprocessorValueTransformer:()=>FU,toPreprocessorTriggerTransformer:()=>kI,toUserDataTransformer:()=>ese,uniformOrUserDataTransformer:()=>Ia});const xI={fontFamily:null,fontSize:.05,fontKerning:"auto",fontStyle:"normal",fontWeight:"normal",offset:.005,lineHeight:1.2,lineBreak:`- ,.:?!
`,whiteSpace:"pre-line",flexDirection:"column",justifyContent:"start",alignItems:"start",backgroundImage:null,textAlign:"left",boxSizing:"content-box",position:"static",color:16777215,fontColor:16777215,fontOpacity:1,opacity:1,fontPXRange:4,fontSupersampling:!0,fontSmooth:"antialiased",borderRadius:0,borderWidth:0,borderColor:"black",borderOpacity:1,backgroundSize:"cover",backgroundColor:0,backgroundOpacity:0,overflow:"visible",letterSpacing:0,invertAlpha:!1,segments:1},Xie=function(n){for(const e in n)xI[e]=n[e]},_U=function(n){return Object.prototype.hasOwnProperty.call(xI,n)||console.warn(`ThreeMeshUI::DefaultValues is trying to retrieve non-existing property '${n}'`),xI[n]};class Ti{constructor(e,i=null,s=!0){this._id=e,this._value=i,this._needsUpdate=!0,this._needsProcess=!1,this._needsRender=!1,this._isPrimitive=s}get id(){return this._id}get value(){return this._value}set value(e){this.isValid(e)&&this._value!==e&&(this._value=e,this._needsUpdate=!0)}update(e,i){this.output(i)}output(e){}_outputValue(e){e[this._id]=this._value}process(e){}render(e){}getInheritedInput(e){if(this._value!=="inherit")return this._value;const i=e._parent._value;return i&&i[`_${this._id}`]?i[`_${this._id}`].getInheritedInput(i):this.getDefaultValue()}getDefaultValue(){return _U(this._id)}isValid(e){return!0}emptyStrategyLogic(){throw new Error(`ThreeMeshUI::${this.constructor.name} has empty strategy. Update has not been processed.`)}requestUpdate(){this._needsUpdate=!0}requestProcess(){this._needsProcess=!1}requestRender(){this._needsRender=!1}}class Wie extends Ti{constructor(){super("renderOrder","auto",!0),this.output=this._outputValue,this._actualValue=0}set value(e){this.isValid(e)&&(this._value=e,this._needsUpdate=!0)}update(e,i){if(this._value!=="auto")this._actualValue=this._value;else{const s=e._parent._value;if(s!==null){const r=s._renderOrder._actualValue,o=1+s._children._uis.indexOf(e);this._actualValue=r+o}}for(const s of e._children._uis)s._renderOrder._value==="auto"&&(s._renderOrder._needsUpdate=!0);this._outputValue(i)}_outputValue(e){e[this._id]=this._actualValue}get value(){return this._value}}class Jp extends Ti{constructor(e,i=null,s=!0){super(e,i,s),this.output=this._outputValue,this._notInheritedValue=null}update(e,i){this._notInheritedValue=this._value,this._notInheritedValue==="inherit"&&(this._notInheritedValue=this.getInheritedInput(e)),this.propagate(e),this._outputValue(i)}propagate(e){for(const i of e._children._uis){const s=i[`_${this._id}`];s!==void 0&&s._value==="inherit"&&(i[`_${this._id}`]._needsUpdate=!0)}}_outputValue(e){e[this._id]=this._notInheritedValue}set value(e){this.isValid(e)&&this._value!==e&&(this._value=e,this._needsUpdate=!0)}get value(){return this._value==="inherit"?this._notInheritedValue:this._value}}class Hie extends Jp{constructor(){super("offset","inherit",!1)}update(e,i){super.update(e,i),e._parent._value!==null&&(e.position.z=this._notInheritedValue)}}class jie extends Jp{constructor(){super("fontSmooth","inherit",!0),this._needsUpdate=!1,this.isValid=Zie,this.output=this._outputValue}}const Qie=["inherit","none","antialiased"];function Zie(n){return Qie.indexOf(n)===-1?(console.warn(`.fontSmoothing value '${n}' is not valid. Aborted`),!1):!0}var Yie=n=>{var e={};return vl.d(e,n),e};const He=Yie({BackSide:()=>un,BufferAttribute:()=>qe,BufferGeometry:()=>dt,Color:()=>Ae,DoubleSide:()=>xi,EventDispatcher:()=>Rs,FileLoader:()=>qs,FrontSide:()=>Un,LinearFilter:()=>Ot,Mesh:()=>pe,MeshBasicMaterial:()=>Qt,Object3D:()=>ye,Plane:()=>fs,PlaneGeometry:()=>ds,ShaderMaterial:()=>kt,Texture:()=>Vt,TextureLoader:()=>sc,Vector2:()=>Y,Vector3:()=>E,Vector4:()=>Ze});class fn extends Ti{constructor(e,i,s=!0){super(e,"unset",s),this._input="inherit",this._allowsInherit=!0,this._inheritedInput=void 0,this._inline=void 0}update(e,i){this._allowsInherit||(this._inheritedInput=this.getInheritedInput(e)),this.computeOutputValue(e);for(const s of e._children._uis){const r=s[`_${this._id}`];(r._input?r._input:r._value)==="inherit"&&(s[`_${this._id}`]._needsUpdate=!0)}this.output(i)}computeOutputValue(e){this._value=this._input}_computeFromInherited(e){this._value=this._inheritedInput}set value(e){console.warn(".(style) sub-property cannot be directly set. It must comes from inline or computed setter.")}set inline(e){this.isValidValue(e)&&e!==this._inline&&(this._input=this._inline=e,this._needsUpdate=!0)}get inline(){return this._inline}isValidValue(e){return!0}getInheritedInput(e){if(this._input!=="inherit")return this._input;const i=e._parent._value;return i?i[`_${this._id}`].getInheritedInput(i):this.getDefaultValue()}}class d_ extends fn{constructor(e,i){super(e,i,!1),this._input=new He.Vector4(0,0,0,0),this._inline=null,this._value=new He.Vector4(0,0,0,0)}get value(){return this._value}computeOutputValue(e){this._vector4ValueSetter(this._value,this._input)}set inline(e){this._vector4ValueSetter(this._input,e),!this._input.equals(this._value)&&(this._needsUpdate=!0)}set top(e){this._input.x!==e&&(this._input.x=e,this._needsUpdate=!0)}get top(){return this._input.x}set right(e){this._input.y!==e&&(this._input.y=e,this._needsUpdate=!0)}get right(){return this._input.y}set bottom(e){this._input.z!==e&&(this._input.z=e,this._needsUpdate=!0)}get bottom(){return this._input.z}set left(e){this._input.w!==e&&(this._input.w=e,this._needsUpdate=!0)}get left(){return this._input.w}dispose(){this._computed=null,this._inline=null,this._input=null,this._output=null}_vector4ValueSetter(e,i){if(i instanceof He.Vector4){e.copy(i);return}if((typeof i=="string"||i instanceof String)&&(i=i.split(" ")),Array.isArray(i))switch(i=i.map(s=>parseFloat(s)),i.length){case 1:e.setScalar(i[0]);return;case 2:e.x=e.z=i[0],e.y=e.w=i[1];return;case 3:e.x=i[0],e.y=i[1],e.z=i[2];return;case 4:e.x=i[0],e.y=i[1],e.z=i[2],e.w=i[3];return;default:console.error("StyleVector4Property::set() Four Dimension property had more than four values");return}isNaN(i)||e.setScalar(i)}}class Kie extends d_{constructor(){super("padding",new He.Vector4(0,0,0,0))}computeOutputValue(e){super.computeOutputValue(e),e._bounds._needsUpdate=!0,e._bounds._needsRender=!0,e._layouter._needsProcess=!0,e._renderer._needsRender=!0,e._parent._value&&(e._parent._value._layouter._needsProcess=!0)}}class Jie extends d_{constructor(){super("margin",new He.Vector4(0,0,0,0))}computeOutputValue(e){super.computeOutputValue(e),e._renderer._needsRender=!0,e._parent._value&&(e._parent._value._flexDirection._needsProcess=!0)}}const SU=function(n,e,i){n[e]=i},qie=function(n,e,i){i!==null&&(n[e]=i)};class p_{constructor(e){this._definition=e}set definition(e){this._definition=e}mediate(e,i,s,r=null){for(const o in this._definition){const a=this._definition[o];if(s[o]!==void 0){const l=a.t?a.t:SU;l(i,a.m,s[o]),r&&l(r,a.m,s[o])}}}static mediate(e,i,s,r,o=null){if(i)for(const a in r){const l=r[a];if(s[a]!==void 0){const c=l.t?l.t:SU;c(i,l.m,s[a]),o&&c(o,l.m,s[a])}}}}class $ie extends Ti{constructor(){super("parent",null,!1)}update(e,i){e.parent&&e.parent.isUI?this._value=e.parent:this._value=null}set value(e){console.warn("ParentProperty is readonly")}get value(){return this._value}find(e){return this._value?e(this._value)?this._value:this._value._parent.find(e):null}dispose(){this._value=null}}const wI=function(n,e,i=6){return n.toFixed(i)===e.toFixed(i)};class CU extends Ti{constructor(e,i){super(e,i,!0),this.output=this._outputValue}set value(e){this.isValid(e)&&(wI(this._value,e)||(this._value=e,this._needsUpdate=!0))}get value(){return this._value}}class MU extends Jp{constructor(e){super(e,"inherit",!0),this.isValid=tne}}const ene=[He.FrontSide,He.BackSide,He.DoubleSide];function tne(n){return ene.indexOf(n)===-1?(console.warn(`SideProperty value '${n}' is not valid. Abort`),!1):!0}class EU{constructor(){this._offsetX=0,this._offsetY=0,this._lineBreak=null,this._kerning=0,this._fontFactor=1,this._fontSize=0,this._cumulativeWidth=0,this._paddingLeft=0,this._paddingRight=0,this._marginLeft=0,this._marginRight=0}resetOffsets(){this._offsetX=this._offsetY=0,this._cumulativeWidth=0}get xadvance(){return 0}get xoffset(){return 0}get yoffset(){return 0}get width(){return 0}get height(){return 0}set lineBreak(e){this._lineBreak=e}get lineBreak(){return this._lineBreak}get anchor(){return 0}get kerning(){return this._kerning*this._fontFactor}set kerning(e){this._kerning=e}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize=e}get lineHeight(){return 0}get offsetX(){return this._offsetX}set offsetX(e){this._offsetX=e}get offsetY(){return this._offsetY}set offsetY(e){this._offsetY=e}get cumulativeWidth(){return this._cumulativeWidth}set cumulativeWidth(e){this._cumulativeWidth=e}get marginLeft(){return this._marginLeft}set marginLeft(e){this._marginLeft=e}get marginRight(){return this._marginRight}set marginRight(e){this._marginRight=e}get paddingLeft(){return this._paddingLeft}set paddingLeft(e){this._paddingLeft=e}get paddingRight(){return this._paddingRight}set paddingRight(e){this._paddingRight=e}get lineBase(){return 0}set fontFactor(e){this._fontFactor=e}get fontFactor(){return this._fontFactor}}class TU{constructor(e){this._char="",this._width=1,this._heigth=1,this._xadvance=1,this._xoffset=0,this._yoffset=0,this._font=e}get font(){return this._font}get char(){return this._char}get width(){return this._width}get height(){return this._heigth}get xadvance(){return this._xadvance}get xoffset(){return this._xoffset}get yoffset(){return this._yoffset}set yoffset(e){this._yoffset=e}clone(e){throw new Error("Abstract... Need to be implemented")}asInlineGlyph(){throw new Error("Abstract... Need to be implemented")}}class RU extends EU{constructor(e){super(),this._typographic=e}get typographic(){return this._typographic}get xadvance(){return this._typographic.xadvance*this._fontFactor}get xoffset(){return this._typographic.xoffset*this._fontFactor}get yoffset(){return this._typographic.yoffset*this._fontFactor}get width(){return this._typographic.width*this._fontFactor}get height(){return this._typographic.height*this._fontFactor}get char(){return this._typographic.char}get anchor(){return this.yoffset}get lineHeight(){return this._typographic.font.lineHeight*this._fontFactor}get lineBase(){return this._typographic.font.lineBase*this._fontFactor}}const ine={light:"100",normal:"400",bold:"700",bolder:"900"};function _I(n){return isNaN(n)?ine[n]||n:n.toString()}class nne extends He.EventDispatcher{constructor(e,i){super(),this._isReady=!1,this._weight=_I(e),this._style=i,this._size=42,this._lineHeight=42,this._lineBase=42,this._font=null}get typographic(){return this._font}get isReady(){return this._isReady}get weight(){return this._weight}get style(){return this._style}get texture(){return this._texture}set fontMaterial(e){throw Error(`FontVariant('${this.id}')::fontMaterial - is abstract.`)}get fontMaterial(){throw Error(`FontVariant('${this.id}')::fontMaterial - is abstract.`)}get id(){return`${this._name}(w:${this.weight},s:${this.style})`}getTypographicGlyph(e){let i=this._chars[e];if(i)return i;if(e.match(/\s/))return this._chars[" "];const s=this._getFallbackCharacter(e);if(s&&(i=this._chars[s],i))return i;throw Error(`FontVariant('${this.id}')::getTypographicGlyph() - character('${e}') and/or fallback character were not found in provided msdf charset.`)}_getFallbackCharacter(e){throw new Error(`FontVariant(${typeof this})::_getFallbackCharacter() is abstract and should therefore be overridden.`)}getGeometricGlyph(e,i){throw new Error(`FontVariant(${typeof this})::getGeometryCharacter() is abstract and should therefore be overridden.`)}getKerningAmount(e){return this._kernings[e]?this._kernings[e]:0}adjustTypographicGlyphs(e){for(const i in e){const s=this.getTypographicGlyph(i),r=e[i];for(const o in r)s["_"+o]=e[i][o]}}_checkReadiness(){this._readyCondition()&&rne(this)}_alterElementProperties(e){throw new Error(`FontVariant(${typeof this})::_alterElementProperties() is abstract and should therefore be overridden.`)}_readyCondition(){throw new Error(`FontVariant(${typeof this})::_readyCondition() is abstract and should therefore be overridden.`)}}const sne={type:"ready"};function rne(n){n._isReady=!0,n.dispatchEvent(sne)}const zv=nne;class one extends Ti{constructor(e=null){super("font",e,!1),this._needsUpdate=!1,this._fontVariant=null,this._handleFontReadyClosure=null,this.isValid=ane}output(e){e[this._id]=this._fontVariant}update(e,i){if(this._fontVariant&&!this._fontVariant.isReady&&this._fontVariant.removeEventListener("ready",this._handleFontReadyClosure),this._value&&this._value instanceof zv)this._fontVariant=this._value;else{const s=e._fontFamily._value;s&&(this._fontVariant=s.getVariant(e._fontWeight._value,e._fontStyle._value))}this._fontVariant&&(this._fontVariant._alterElementProperties(e),this._handleFontReadyClosure=lne(e,this),this._fontVariant.isReady?this._handleFontReadyClosure():this._fontVariant.addEventListener("ready",this._handleFontReadyClosure),(!e._fontMaterial._defaultMaterial||!(e._fontMaterial._defaultMaterial instanceof this._fontVariant.fontMaterial))&&(e._fontMaterial._defaultMaterial=new this._fontVariant.fontMaterial,e._fontMaterial._needsUpdate=!0))}set value(e){this.isValid(e)&&this._value!==e&&(this._value=e,this._needsUpdate=!0)}get value(){return this._value}get fontVariant(){return this._fontVariant}dispose(){this._handleFontReadyClosure&&(this._fontVariant.removeEventListener("ready",this._handleFontReadyClosure),this._handleFontReadyClosure=null),this._value=null,this._fontVariant=null}}function ane(n){return n instanceof zv?!0:(console.warn(`.font value '${n}' is not valid. It requires a FontVariant instance. Aborted`),!1)}function lne(n,e){return function(){e._needsUpdate=!0,n._glyphs._needsProcess=!0,e._fontVariant.removeEventListener("ready",e._handleFontReadyClosure),e._handleFontReadyClosure=null}}class cne extends fn{constructor(e){super("display",e),this._value="flex",this._allowsInherit=!1,this._needsUpdate=!1,this.isValidValue=une}computeOutputValue(e){e._visible._value=this._output!=="none"}}const hne=["none","flex"];function une(n){return hne.indexOf(n)===-1?(console.warn(`(.style) display value '${n}' is not valid. Aborted`),!1):!0}class dne extends fn{constructor(e){super("boxSizing",e),this._allowsInherit=!1,this.isValidValue=mne}computeOutputValue(e){this._value=this._inheritedInput,e._bounds._needsUpdate=!0}}const pne=["border-box","content-box"];function mne(n){return pne.indexOf(n)===-1?(console.warn(`(.style) boxSizing value '${n}' is not valid. Aborted`),!1):!0}class Fv extends fn{constructor(e,i){super(e,i,!1),this._value=new He.Color,this.output=this._outputValue}computeOutputValue(e){this._input!=="inherit"&&this._value.set(this._input)}set inline(e){this._input=this._inline=e,this._needsUpdate=!0}}class SI extends fn{constructor(e,i){super(e,i,!0),this.isValidValue=fne,this._allowsInherit=!1,this._input=i,this._value=i,this.output=this._outputValue,this.computeOutputValue=this._computeFromInherited}_outputValue(e){e[this._id]=this._inheritedInput}}function fne(n){return n<0&&n>1?(console.warn(`(.style) styleFactorProperty('${this.id}') value '${n}' is not valid)`),!1):!0}class gne extends fn{constructor(e){super("backgroundImage",e,!0),this._input=null,this._allowsInherit=!1,this._textureSize=new He.Vector2(1,1),this.isValidValue=yne}get value(){return this._value}output(e){e[this._id]=this._value,e.tSize=this._textureSize}computeOutputValue(e){if(this._value=this._inheritedInput,this._value instanceof He.Texture&&!this._value.image){console.warn("ThreeMeshUI - .backgroundImage :: Please provide preloaded texture in order to have accurate sizing.");return}this._needsProcess=!0}process(e){this._value?this._textureSize.set(this._value.image.width,this._value.image.height):this._textureSize.set(1,1)}}function yne(n){return!0}class vne extends fn{constructor(e){super("backgroundSize",e,!0),this.isValidValue=Ane,this.output=this._outputValue}}const bne=["cover","contain","stretch"];function Ane(n){return bne.indexOf(n)===-1?(console.warn(`(.style) backgroundSize value '${n}' is not valid. Aborted`),!1):!0}class xne extends fn{constructor(e){super("overflow",e,!0),this.isValidValue=_ne,this._clippingPlanes=null,this._renderStrategy=this._emptyRender}update(e,i){this._inline!==void 0&&this._inline!=="unset"?this._input=this._inline:this._computed!==void 0&&(this._input=this._computed),this._allowsInherit||(this._inheritedInput=this.getInheritedInput(e)),this.computeOutputValue(e);for(const s of e._children._uis)s._overflow._needsUpdate=!0;this.output(i)}output(e){e.clippingPlanes=this._clippingPlanes}computeOutputValue(e){super.computeOutputValue(e),this._value==="hidden"?this._renderStrategy=this._propagateRender:(this._renderStrategy=this._emptyRender,this._clippingPlanes=null);const i=e._parent._value;if(i!==null){const s=i._overflow;if((s._value==="hidden"||s._clippingPlanes!==null)&&!this._clippingPlanes){this._clippingPlanes=[new He.Plane(new He.Vector3(0,-1,0),1),new He.Plane(new He.Vector3(-1,0,0),1),new He.Plane(new He.Vector3(0,1,0),1),new He.Plane(new He.Vector3(1,0,0),1)];for(let r=0;r<this._clippingPlanes.length;r++)this._clippingPlanes[r].parent=i;s._clippingPlanes!==null&&this._clippingPlanes.push(...s._clippingPlanes),this._renderStrategy=this._hiddenRender,this._needsRender=!0}else(s._value==="visible"||s._clippingPlanes===null)&&this._clippingPlanes!==null&&(this._clippingPlanes=null,this._renderStrategy=this._emptyRender,this._needsRender=!0)}}render(e){this._renderStrategy(e)}_emptyRender(e){}_hiddenRender(e){const i=e._parent._value,s=i._bounds._offsetHeight,r=i._bounds._offsetWidth,o=i._padding._value,a=i._borderWidth._value;for(let l=0;l<4&&l<this._clippingPlanes.length;l++){const c=this._clippingPlanes[l];switch(l%4){case 0:c.constant=s/2-(o.x+a.x);break;case 1:c.constant=r/2-(o.y+a.y);break;case 2:c.constant=s/2-(o.z+a.z);break;case 3:c.constant=r/2-(o.w+a.w);break}c.applyMatrix4(i.matrixWorld)}for(let l=0;l<e._children._uis.length;l++){const c=e._children._uis[l];c._overflow._needsRender=!0}}_propagateRender(e){for(let i=0;i<e._children._uis.length;i++){const s=e._children._uis[i];s._overflow._needsRender=!0}}}const wne=["visible","hidden"];function _ne(n){return wne.indexOf(n)===-1?(console.warn(`(.style) overflow value '${n}' is not valid. Aborted`),!1):!0}const gg="rem",IU="em",m_="%",Sne=[gg,IU,m_],LU=function(n){return Sne.indexOf(n)===-1?gg:n};class Cne extends d_{constructor(e){super("borderRadius",e),this._valueUV=this._value.clone(),this._input=new He.Vector4(0,0,0,0),this._mediation=!0,this._cornerTL=new He.Vector2(0,1),this._cornerTR=new He.Vector2(1,1),this._cornerBR=new He.Vector2(1,0),this._cornerBL=new He.Vector2(0,0);const i=new f_(this._valueUV,["x","y"]),s=new f_(this._valueUV,["z","w"]),r=new f_(this._valueUV,["x","w"]),o=new f_(this._valueUV,["y","z"]);i.complementaryMediation=s,s.complementaryMediation=i,r.complementaryMediation=o,o.complementaryMediation=r,this._sideMediators=[i,s,r,o],this._units=gg}set units(e){this._units=LU(e),this._needsProcess=!0}get units(){return this._units}set mediation(e){e!==this._mediation&&(this._mediation=e,this._needsUpdate=!0)}get mediation(){return this._mediation}output(e){e.cornerTL=this._cornerTL,e.cornerTR=this._cornerTR,e.cornerBR=this._cornerBR,e.cornerBL=this._cornerBL}computeOutputValue(e){this._vector4ValueSetter(this._value,this._input),this._needsProcess=!0}process(e){this._needsRender=!0}render(e){this._valueUV.copy(this._value);const i=e._bounds._offsetWidth,s=e._bounds._offsetHeight;if(this._units===m_&&this._valueUV.divideScalar(100),this._units===gg&&this._valueUV.divideScalar(Math.min(i,s)),this._mediation)do this._sideMediators.forEach(a=>a.computeValue()),this._sideMediators.sort((a,l)=>a.value<l.value?1:-1),this._sideMediators[0].value>1&&this._sideMediators[0].mediate();while(this._sideMediators[0].value>1);let r=i>s?s/i:1,o=i<s?i/s:1;this._units===m_&&(r=o=1),this._cornerTL.x=this._valueUV.x*r,this._cornerTL.y=1-this._valueUV.x*o,this._cornerTR.x=1-this._valueUV.y*r,this._cornerTR.y=1-this._valueUV.y*o,this._cornerBR.x=1-this._valueUV.z*r,this._cornerBR.y=this._valueUV.z*o,this._cornerBL.x=this._valueUV.w*r,this._cornerBL.y=this._valueUV.w*o}dispose(){for(const e of this._sideMediators)e.dispose();this._sideMediators=null,this._cornerTL=null,this._cornerTR=null,this._cornerBR=null,this._cornerBL=null,super.dispose()}set topLeft(e){this._input.x!==e&&(this._input.x=e,this._needsUpdate=!0)}get topLeft(){return this._input.x}set topRight(e){this._input.y!==e&&(this._input.y=e,this._needsUpdate=!0)}get topRight(){return this._input.y}set bottomRight(e){this._input.z!==e&&(this._input.z=e,this._needsUpdate=!0)}get bottomRight(){return this._input.z}set bottomLeft(e){this._input.w!==e&&(this._input.w=e,this._needsUpdate=!0)}get bottomLeft(){return this._input.w}set top(e){this._input.x===e&&this._input.y===e||(this._input.x=this._input.y=e,this._needsUpdate=!0)}get top(){return(this._input.x+this._input.y)/2}set right(e){this._input.y===e&&this._input.z===e||(this._input.y=this._input.z=e,this._needsUpdate=!0)}get right(){return(this._input.y+this._input.z)/2}set bottom(e){this._input.z===e&&this._input.w===e||(this._input.z=this._input.w=e,this._needsUpdate=!0)}get bottom(){return(this._input.z+this._input.w)/2}set left(e){this._input.w===e&&this._input.x===e||(this._input.w=this._input.x=e,this._needsUpdate=!0)}get left(){return(this._input.w+this._input.x)/2}}class f_{constructor(e,i){this._borderRadiuses=e,this._sideProperties=i,this._complementaryMediation=null,this._value=0}get value(){return this._value}set complementaryMediation(e){this._complementaryMediation=e}computeValue(){let e=0;for(const i of this._sideProperties)e+=this._borderRadiuses[i];this._value=e}mediate(e=!0){if(!(this._value<1)){for(const i of this._sideProperties)this._borderRadiuses[i]/=this._value;e&&this._complementaryMediation.mediate(!1)}}dispose(){this._complementaryMediation=null,this._borderRadiuses=null}}class Mne extends d_{constructor(e){super("borderWidth",e,!1),this._valueUV=this._value.clone(),this.output=this._outputValue,this._units=gg}set units(e){this._units=LU(e),this._needsUpdate=!0}get units(){return this._units}computeOutputValue(e){this._vector4ValueSetter(this._value,this._input),this._needsProcess=!0,e._bounds._needsUpdate=!0,e._layouter._needsUpdate=!0}_outputValue(e){e[this._id]=this._valueUV}process(e){this._needsRender=!0,e._borderRadius._needsRender=!0}render(e){this._valueUV.copy(this._value);const i=e._bounds._offsetWidth,s=e._bounds._offsetHeight;if(this._units===m_&&(console.log("Percent"),console.log(this._valueUV)),this._units===gg)i!==0&&(this._valueUV.w/=i,this._valueUV.y/=i),s!==0&&(this._valueUV.x/=s,this._valueUV.z/=s);else if(this._units===IU){if(i!==0){const r=i>s?s/i:1;this._valueUV.y*=r,this._valueUV.w*=r}if(s!==0){const r=i<s?i/s:1;this._valueUV.x*=r,this._valueUV.z*=r}}}}class Ene extends Ti{constructor(e,i=!0){super("visible",i,!0),this._needsUpdate=!1}update(e,i){e.visible=this._value,e._parent._value&&(e._parent._value._children._needsUpdate=!0)}set value(e){this.isValid(e)&&this._value!==e&&(this._value=e,this._needsUpdate=!0)}get value(){return this._value}}class PU extends Fv{constructor(e){super("backgroundColor",e,!1),this._input="transparent",this._allowsInherit=!1}computeOutputValue(e){e._backgroundMesh.visible=!(this._input==="none"||this._input==="transparent"),this._input==="inherit"?this._value.set(this.getInheritedInput(e)):this._input==="transparent"||this._input==="none"||this._value.set(this._input)}}class xh extends Ti{constructor(e="untitled"){super(e,void 0,!1)}update(e,i){}output(e){}}class Tne extends Ti{constructor(){super("inlineJustificator",null,!1),this._value=null}update(e,i){}process(e){const i=e._bounds._innerHeight,s=e._layouter._value,r=Math.abs(s.height);let o=(()=>{switch(e._alignItems._value){case"inherit":case"start":return i/2;case"end":return r-i/2;case"stretch":case"center":return r/2}})();const a=e._padding._value,l=e._borderWidth._value;o+=(-a.x+a.z)/2+(-l.x+l.z)/2,s.forEach(c=>{c.y+=o,c.forEach(h=>{h.offsetY+=o})})}}const Rne=["start","center","end","stretch"],Ine=function(n){return Rne.indexOf(n)===-1?(console.warn(`(.style) alignItems value '${n}' is not valid. Aborted`),!1):!0};class CI extends fn{constructor(){super("alignItems","inherit",!0),this.isValidValue=Ine}}class MI extends fn{constructor(){super("textAlign","inherit",!0),this.isValidValue=Pne}}const Lne=["left","right","center","justify","justify-left","justify-right","justify-center"],Pne=function(n){return Lne.indexOf(n)===-1?(console.warn(`(.style) textAlign value '${n}' is not valid. Aborted`),!1):!0};class EI extends fn{constructor(){super("flexDirection","inherit",!0),this.isValid=kne}}const Bne=["row","row-reverse","column","column-reverse"];function kne(n){return Bne.indexOf(n)===-1?(console.warn(`(.style) flexDirection value '${n}' is not valid. Aborted`),!1):!0}class TI extends fn{constructor(){super("justifyContent","inherit",!0),this.isValidValue=One}}const Dne=["start","center","end","space-between","space-around","space-evenly"];function One(n){return Dne.indexOf(n)===-1?(console.warn(`(.style) justifyContent value '${n}' is not valid. Aborted`),!1):!0}class Gne extends fn{constructor(){super("order",0,!0),this._value=0,this._input=0,this._allowsInherit=!1}computeOutputValue(e){this._value=this._inheritedInput,e._parent._value&&(e._parent._value._children._needsProcess=!0)}}class BU extends fn{constructor(){super("position","static",!0),this._allowsInherit=!1,this._value="static",this._needsUpdate=!1,this.computeOutputValue=this._computeFromInherited,this.isValidValue=Fne}_computeFromInherited(e){super._computeFromInherited(e),e._parent._value&&(e._parent._value._children._needsProcess=!0)}}const zne=["static","absolute"];function Fne(n){return zne.indexOf(n)===-1?(console.warn(`(.style) position value '${n}' is not valid. Aborted`),!1):!0}class kU extends fn{constructor(e,i=null){super(e,i,!0),this._input="auto",this._auto=!0,this._relative=!1,this._updateRequired=!0}set inline(e){this.isValidValue(e)&&e!==this._inline&&(this._inline=e,this._input!==this._inline&&this._parseInput())}get inline(){return this._inline}_parseInput(){let e=!0;if(this._inline!==void 0&&this._inline!=="unset"?this._input=this._inline:this._computed!==void 0?(this._computed===this._input&&(e=!1),this._input=this._computed):e=this._input==="inherit",e){if(this._auto=!this._input||this._input==="auto",this._auto)this._relative=!1;else if((typeof this._input=="string"||this._input instanceof String)&&this._input.endsWith("%")){this._relative=!0,this._value=0;const i=parseFloat(this._input.replace("%","").trim());isNaN(i)||(this._value=i/100)}else this._relative=!1,this._value=this._input;this._needsUpdate=this._updateRequired=e}}update(e,i){if(this._updateRequired){this._updateRequired=!1,this._allowsInherit||(this._inheritedInput=this.getInheritedInput(e)),this.computeOutputValue(e);for(const s of e._children._uis)s[`_${this._id}`]._needsUpdate=!0;this.output(i),e._parent._value&&(e._parent._value._layouter._needsProcess=!0)}}computeOutputValue(e){e._bounds._needsUpdate=!0,e._renderer._needsRender=!0}getInheritedInput(e){if(this._input!=="inherit"&&!this._auto)return this._input;const i=e._parent._value;return i?i[`_${this._id}`].getInheritedInput(i):this.getDefaultValue()}getDefaultValue(){return 0}get value(){return this._value}}class Nne extends kU{constructor(){super("width")}}class Une extends kU{constructor(){super("height")}computeOutputValue(e){super.computeOutputValue(e)}}class DU extends xh{constructor(){super("textContent"),this._needsUpdate=!1}set value(e){}process(e){let i="";for(let s=0;s<e.children.length;s++){const r=e.children[s];r.isUI&&(i+=r.textContent)}this._value=i}}class OU extends fn{constructor(e){super("fontStyle",e,!0),this.isValidValue=Xne}}const Vne=["normal","italic"];function Xne(n){return Vne.indexOf(n)===-1?(console.warn(`(.style) fontStyle value '${n}' is not valid. Aborted`),!1):!0}class GU extends fn{constructor(){super("fontWeight","inherit",!0),this.isValid=Hne}}const Wne=["100","200","300","400","500","600","700","800","900","light","normal","bold","bolder"];function Hne(n){return Wne.indexOf(n.toString())===-1?(console.warn(`(.style) fontWeight value '${n}' is not valid. Aborted`),!1):!0}class zU{constructor(){this._size=42,this._lineHeight=42,this._lineBase=38,this._name="-",this._charset=""}get size(){return this._size}get lineHeight(){return this._lineHeight}get lineBase(){return this._lineBase}get name(){return this._name}get charset(){return this._charset}}class jne extends zU{constructor(e){super(),this._size=e.info.size,this._lineHeight=e.common.lineHeight,this._lineBase=e.common.base,this._name=e.info.face,this._textureWidth=e.common.scaleW,this._textureHeight=e.common.scaleH,this._charset=e.chars.map(i=>i.char).join("")}get textureWidth(){return this._textureWidth}get textureHeight(){return this._textureHeight}}class Qne extends RU{constructor(e){super(e)}get uv(){return this.typographic.uv}}class PT extends TU{constructor(e,i){super(e),this._char=i.char,this._width=i.width,this._heigth=i.height,this._xadvance=i.xadvance?i.xadvance:this._width,this._xoffset=i.xoffset?i.xoffset:0,this._yoffset=i.yoffset?i.yoffset:0,this._uv=i.uv?i.uv:null,isNaN(i.x)||(this._uv={left:i.x/e.textureWidth,right:(i.x+i.width)/e.textureWidth,top:1-(i.y+i.height)/e.textureHeight,bottom:1-i.y/e.textureHeight})}get uv(){return this._uv}clone(e){return new PT(this._font,{char:e,width:this._width,height:this._heigth,xadvance:this._xadvance,xoffset:this._xoffset,yoffset:this._yoffset,uv:null})}asInlineGlyph(){return new Qne(this)}}class Zne extends He.PlaneGeometry{constructor(e,i){let s=1,r=1;const o=e.typographic.font.size,a=i._segments.value;s=Math.ceil(e.typographic.width/o*a),r=Math.ceil(e.typographic.height/o*a),super(e.width,e.height,s,r),e.uv?(this._mapUVs(e),this._transformGeometry(e)):(this._nullifyUVs(),this.scale(0,0,1),this.translate(0,e.fontSize/2,0)),this.name="GlyphGeometry"}_mapUVs(e){const i=e.uv.right-e.uv.left,s=e.uv.bottom-e.uv.top,r=this.getAttribute("uv").array.slice(),o=[];for(let a=0;a<r.length;a+=2){const l=r[a],c=r[a+1];o.push(e.uv.left+i*l),o.push(e.uv.top+s*c)}this.setAttribute("uvG",new He.BufferAttribute(new Float32Array(o),2))}_nullifyUVs(){const e=[],i=this.getAttribute("uv").array.length;for(let s=0;s<i;s++)e.push(0);this.setAttribute("uvG",new He.BufferAttribute(new Float32Array(e),2))}_transformGeometry(e){this.translate(e.width/2,-e.height/2,0)}}const Yne=`
attribute vec2 uvG;
varying vec2 vUvG;
`,RI=Yne,Kne=`
vUvG = uvG;
`,II=Kne,Jne=`
gl_Position.z -= 0.00001;
`,LI=Jne,qne=`
varying vec2 vUvG;
uniform sampler2D glyphMap;
uniform vec2 unitRange;
// functions from the original msdf repo:
// https://github.com/Chlumsky/msdfgen#using-a-multi-channel-distance-field
float median(float r, float g, float b) {
	return max(min(r, g), min(max(r, g), b));
}
float screenPxRange() {

	// precomputed unitRange as recommended by Chlumsky
	// vec2 unitRange = vec2(pxRange)/vec2(textureSize(glyphMap, 0));
	vec2 screenTexSize = vec2(1.0)/fwidth(vUvG);
	return max(0.5*dot(unitRange, screenTexSize), 1.0);
}
float tap(vec2 offsetUV) {
	vec3 msd = texture( glyphMap, offsetUV ).rgb;
	float sd = median(msd.r, msd.g, msd.b);
	float screenPxDistance = screenPxRange() * (sd - 0.5);
	float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);
	return alpha;
}
`,PI=qne,$ne=`
	float alpha;
#ifdef NO_RGSS

	alpha = tap( vUvG );

#else

	// shader-based supersampling based on https://bgolus.medium.com/sharper-mipmapping-using-shader-based-supersampling-ed7aadb47bec
	// per pixel partial derivatives
	vec2 dx = dFdx(vUvG);
	vec2 dy = dFdy(vUvG);
	// rotated grid uv offsets
	vec2 uvOffsets = vec2(0.125, 0.375);
	vec2 offsetUV = vec2(0.0, 0.0);
	// supersampled using 2x2 rotated grid
	alpha = 0.0;
	offsetUV.xy = vUvG + uvOffsets.x * dx + uvOffsets.y * dy;
	alpha += tap(offsetUV);
	offsetUV.xy = vUvG - uvOffsets.x * dx - uvOffsets.y * dy;
	alpha += tap(offsetUV);
	offsetUV.xy = vUvG + uvOffsets.y * dx - uvOffsets.x * dy;
	alpha += tap(offsetUV);
	offsetUV.xy = vUvG - uvOffsets.y * dx + uvOffsets.x * dy;
	alpha += tap(offsetUV);
	alpha *= 0.25;

#endif

	alpha = clamp( alpha, 0.0, 1.0 );

#ifdef INVERT_ALPHA

	alpha = 1.0 - alpha;

#endif

	diffuseColor.a *= alpha;
`,BI=$ne,g_=function(n,e,i){n.alphaTest=i,kI(n,"USE_ALPHATEST",i>0)},kI=function(n,e,i){n.defines&&(i?n.defines[e]===void 0&&(n.defines[e]="",n.needsUpdate=!0):n.defines[e]!==void 0&&(delete n.defines[e],n.needsUpdate=!0))},FU=function(n,e,i){n.defines[e]&&n.defines[e]===i||(n.defines[e]=i,n.needsUpdate=!0)},Ia=function(n,e,i){n.userData[e]?n.userData[e].value=i:n.uniforms[e].value=i},ese=function(n,e,i){n.userData[e].value=i};class ul{static ensureMaterialOptions(e){e.transparent=!0,e.alphaTest=e.alphaTest||.02}static ensureDefines(e){e.defines||(e.defines={})}static ensureUserData(e,i){e.userData.glyphMap={value:i.glyphMap},e.userData.unitRange={value:new He.Vector2}}static bindUniformsWithUserData(e,i){e.uniforms.glyphMap=i.userData.glyphMap,e.uniforms.unitRange=i.userData.unitRange}static injectShaderChunks(e){ul.injectVertexShaderChunks(e),ul.injectFragmentShaderChunks(e)}static injectVertexShaderChunks(e){e.vertexShader=e.vertexShader.replace("#include <uv_pars_vertex>",`#include <uv_pars_vertex>
`+RI),e.vertexShader=e.vertexShader.replace("#include <uv_vertex>",`#include <uv_vertex>
`+II),e.vertexShader=e.vertexShader.replace("#include <project_vertex>",`#include <project_vertex>
`+LI)}static injectFragmentShaderChunks(e){e.fragmentShader=e.fragmentShader.replace("#include <uv_pars_fragment>",`#include <uv_pars_fragment>
`+PI),e.fragmentShader=e.fragmentShader.replace("#include <alphamap_fragment>",`#include <alphamap_fragment>
`+BI)}static from(e){return class extends e{constructor(i={}){ul.ensureMaterialOptions(i),super(i),p(this,"_cumulativeOnBeforeCompile",s=>{ul.bindUniformsWithUserData(s,this),ul.injectShaderChunks(s),this._userDefinedOnBeforeCompile(s)}),ul.ensureDefines(this),ul.ensureUserData(this,i),this._userDefinedOnBeforeCompile=s=>{},this._onBeforeCompile=this._cumulativeOnBeforeCompile}static get fontMaterialProperties(){return ul.mediation}set onBeforeCompile(i){this._userDefinedOnBeforeCompile=i}get onBeforeCompile(){return this._onBeforeCompile}}}static get mediation(){return nse}}const tse=function(n,e,i){const s=i?i.texture:null,r=i?i.unitRange:new He.Vector2;if(n[e]!==void 0){n.glyphMap=s,n.unitRange=r;return}n.userData&&n.userData.glyphMap&&(n.userData.glyphMap.value=s,n.userData.unitRange.value=r)},ise=function(n,e,i){i&&i!=="antialiased"?n.defines.NO_RGSS="":delete n.defines.NO_RGSS,n.needsUpdate=!0},nse={clippingPlanes:{m:"clippingPlanes"},fontAlphaTest:{m:"alphaTest",t:g_},fontSide:{m:"side"},font:{m:"glyphMap",t:tse},color:{m:"color"},fontOpacity:{m:"opacity"},fontSmooth:{m:"NO_RGSS",t:ise},invertAlpha:{m:"INVERT_ALPHA",t:kI}},sse=`
${RI}
#include <clipping_planes_pars_vertex>
void main() {
	${II}
	#include <begin_vertex>
	#include <project_vertex>
	${LI}
	#include <clipping_planes_vertex>
}
`,rse=`
uniform vec3 diffuse;
uniform float opacity;
${PI}
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	// instead of <color_fragment> : vec4 diffuseColor
	vec4 diffuseColor = vec4( diffuse, opacity );
	${BI}
	#include <alphatest_fragment>
	// instead of <output_fragment>
	gl_FragColor = diffuseColor;
	#include <clipping_planes_fragment>
}
`,ose=.02;class C3 extends He.ShaderMaterial{static get mediation(){return ul.mediation}constructor(e={}){super({uniforms:{glyphMap:{value:null},diffuse:{value:null},opacity:{value:1},unitRange:{value:new He.Vector2(0,0)},alphaTest:{value:ose}},transparent:!0,clipping:!0,vertexShader:sse,fragmentShader:rse,extensions:{derivatives:!0}}),this.defines.USE_ALPHATEST="",this.needsUpdate=!0,this.noRGSS=e.noRGSS||!1}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get opacity(){return this.uniforms.opacity.value}get unitRange(){return this.uniforms.unitRange.value}set unitRange(e){this.uniforms.unitRange.value.copy(e)}get glyphMap(){return this.uniforms.glyphMap.value}set glyphMap(e){this.uniforms.glyphMap.value=e}get isDefault(){return this.constructor===C3}get alphaTest(){return this.uniforms.alphaTest.value}set alphaTest(e){this.uniforms.alphaTest.value=e}}class ase extends zv{constructor(e,i,s,r){if(super(e,i),this._unitRange=new He.Vector2(1,1),s.pages?this._buildData(s):lse(this,s),r instanceof He.Texture)this._texture=r,this._buildTexture(r);else if(typeof r=="string"||r instanceof String)cse(this,r);else throw new Error(`ThreeMeshUI::MSDFVariant provided 'texture' parameter is '${typeof r}'. Only Texture and String allowed.`);this._defaultMaterialClass=C3,this._checkReadiness()}get texture(){return this._texture}get unitRange(){return this._unitRange}set fontMaterial(e){this._defaultMaterialClass=e}get fontMaterial(){return this._defaultMaterialClass}_buildData(e){this._font=new jne(e),this._kernings=this._buildKerningPairs(e),this._chars=this._buildCharacters(e),this._chars[" "]=this._buildCharacterWhite(e),this._chars[`
`]=this._buildCharacterWhite(e,`
`,.001,1),this._chars["	"]=this._buildCharacterWhite(e,"	",4,1),this._size=e.info.size,this._lineHeight=e.common.lineHeight,this._lineBase=e.common.base,this._distanceRange=e.distanceField.distanceRange,this._unitRange=new He.Vector2(this._distanceRange,this._distanceRange).divide(new He.Vector2(e.common.scaleW,e.common.scaleH))}_buildTexture(e){e.generateMipmaps=!1,e.minFilter=He.LinearFilter,e.magFilter=He.LinearFilter,e.needsUpdate=!0}_getFallbackCharacter(e){return qp.missingCharacter(this,e)}getGeometricGlyph(e,i){return new Zne(e,i)}_readyCondition(){return this._chars&&this._texture&&this._texture.image}_buildKerningPairs(e){const i={};for(let s=0;s<e.kernings.length;s++){const r=e.kernings[s];if(r.amount===0)continue;const o=String.fromCharCode(r.first,r.second);i[o]=r.amount}return i}_buildCharacters(e){const i={};for(let s=0;s<e.chars.length;s++){const r=e.chars[s];i[r.char]=new PT(this._font,r)}return i}_buildCharacterWhite(e,i=" ",s=1,r=1){return new PT(this._font,{char:i,width:e.info.size/3*s,height:e.info.size*.7*r})}_alterElementProperties(e){}}function lse(n,e){new He.FileLoader().setResponseType("json").load(e,i=>{n._buildData(i),n._checkReadiness()})}function cse(n,e){n._texture=new He.TextureLoader().load(e,i=>{n._buildTexture(i),n._checkReadiness()})}class y_ extends He.EventDispatcher{constructor(e){super(),p(this,"_checkReadiness",()=>{this._variants.every(i=>i.isReady)&&use(this)}),this._name=e,this._variants=[],this._isReady=!1}get isReady(){return this._isReady}addVariant(e,i,s,r,o=!1){if(o||!this.getVariant(e,i)){this._isReady=!1;const a=new ase(e,i,s,r);this._variants.push(a),a.isReady?this._checkReadiness():a.addEventListener("ready",this._checkReadiness)}else console.warn(`FontFamily('${this._name}')::addVariant() - Variant(${e}, ${i}) already exists.`);return this}addCustomImplementationVariant(e,i=!1){return i||!this.getVariant(e.weight,e.style)?(this._isReady=!1,this._variants.push(e),e.isReady?this._checkReadiness():e.addEventListener("ready",this._checkReadiness)):console.warn(`FontFamily('${this._name}')::addCustomImplementationVariant() - Variant(${e.weight}, ${e.style}) already exists.`),this}getVariant(e,i){return e=_I(e),this._variants.find(s=>s.weight===e&&s.style===i)}get name(){return this._name}}const hse={type:"ready"};function use(n){n._isReady=!0,n.dispatchEvent(hse)}const v_={},dse=function(n){const e=[...arguments];e.forEach(s=>{if(!(s instanceof y_))throw new Error(`FontLibrary::prepare() - One of the provided parameter is not a FontFamily. Instead ${typeof s} given.`)});const i=function(){return e.every(s=>s.isReady)};return new Promise((s,r)=>{if(i())s();else for(let o=0;o<e.length;o++){const a=e[o];a.isReady||a.addEventListener("ready",()=>{i()&&s()})}})},pse=function(n){return v_[n]&&console.error(`FontLibrary::addFontFamily - Font('${n}') is already registered`),v_[n]=new y_(n),v_[n]},mse=function(n){return v_[n]},fse=function(n){NU=n};let NU=function(n,e){return console.error(`The character '${e}' is not included in the font characters set.`)," "};function gse(n,e){return NU(n,e)}const yse={addFontFamily:pse,getFontFamily:mse,prepare:dse,setMissingCharacterHandler:fse,missingCharacter:gse},qp=yse;class UU extends fn{constructor(){super("fontFamily","inherit",!0)}computeOutputValue(e){if(this._input instanceof y_)this._value=this._input;else if(this._input!=="inherit")if(typeof this._input=="string"){const i=qp.getFontFamily(this._input);i?this._value=i:console.warn(`(.style) fontFamily, the font '${this._input}' is not registered. Aborted.`)}else console.warn("(.style) fontFamily requires a registered fontFamily instance, or the id of a registered fontFamily."),console.warn("If you want to set a specific font, please use .font property instead.")}get value(){return this._value}getInheritedInput(e){if(this._input!=="inherit")return this._input;const i=e._parent._value;return i?i[`_${this._id}`].getInheritedInput(i):this.getDefaultValue()}}class VU extends fn{constructor(){super("lineHeight","inherit",!0)}update(e,i){super.update(e,i),e._layouter._needsProcess=!0}}class XU extends fn{constructor(){super("whiteSpace","inherit"),this.isValidValue=bse}}const vse=["normal","nowrap","pre","pre-line","pre-wrap"];function bse(n){return vse.indexOf(n)===-1?(console.warn(`(.style) whiteSpace value '${n}' is not valid. Aborted`),!1):!0}class WU extends fn{constructor(){super("letterSpacing","inherit",!0)}}class Ase extends fn{constructor(){super("fontSize","inherit",!0)}}class HU extends Ti{constructor(){super("segments",1,!1)}}class xse extends Jp{constructor(){super("invertAlpha","inherit")}}class b_ extends fn{constructor(){super("fontKerning","inherit"),this.isValidValue=_se}}const wse=["normal","none","inherit"];function _se(n){return wse.indexOf(n)===-1?(console.warn(`(.style) fontKerning value '${n}' is not valid. Aborted`),!1):!0}class A_ extends Jp{constructor(e){super(e,"inherit",!0)}}class jU extends Jp{constructor(e){super(e,"inherit",!1),this._mediation={},this._defaultMaterial=null}update(e,i){this._notInheritedValue=this._value,this._notInheritedValue==="inherit"?this._notInheritedValue=this.getInheritedInput(e):this.propagate(e),this._notInheritedValue?this._notInheritedValue.constructor.mediation?this._mediation={...this._notInheritedValue.constructor.mediation}:this._mediation={clippingPlanes:{m:"clippingPlanes"},fontAlphaTest:{m:"alphaTest",t:g_},fontSide:{m:"side"},color:{m:"color"},fontOpacity:{m:"opacity"}}:this._mediation={},e._transferToFontMaterial(),this._outputValue(i)}getInheritedInput(e){if(this._value!=="inherit")return this._value;let i=e,s=null;for(;i._parent._value;)if(i=i._parent._value,i[`_${this._id}`]._value!=="inherit"){s=i[`_${this._id}`]._value;break}return s!==null?s:this.getDefaultValue()}getDefaultValue(){return this._defaultMaterial}}const Sse=function(n,e,i){n.traverse(s=>{s.renderOrder=i})};class Nv extends He.Object3D{constructor(e,i){super(),p(this,"_rebuildParentUI",()=>{this._parent._needsUpdate=!0,this.parent&&!this.parent.isUI?(x_.register(this),this.activatePseudoState("root")):(x_.remove(this),this.deactivatePseudoState("root"))}),Object.defineProperties(this,{isUI:{configurable:!1,enumerable:!0,value:!0}}),this._backgroundMesh=null,this._backgroundMaterial=null,this._backgroundCustomDepthMaterial=null,this._backgroundMaterialMediation={},this._backgroundMeshMediation={backgroundCastShadow:{m:"castShadow"},backgroundReceiveShadow:{m:"receiveShadow"},renderOrder:{m:"renderOrder",t:Sse}},this._fontMesh=null,this._fontMaterial=new jU("fontMaterial"),this._fontCustomDepthMaterial=new jU("fontCustomDepthMaterial"),this._fontMeshMediation={fontMaterial:{m:"material"},fontCustomDepthMaterial:{m:"customDepthMaterial",t:qie},fontCastShadow:{m:"castShadow"},fontReceiveShadow:{m:"receiveShadow"},renderOrder:{m:"renderOrder"}},this._children=e.children?new e.children:new xh("children"),this._parent=new $ie,this.addEventListener("added",this._rebuildParentUI),this.addEventListener("removed",this._rebuildParentUI),this._backgroundSide=new MU("backgroundSide"),this._fontSide=new MU("fontSide"),this._backgroundAlphaTest=new CU("backgroundAlphaTest",.02),this._fontAlphaTest=new CU("fontAlphaTest",.02),this._visible=new Ene("visible",!0),this._backgroundCastShadow=new A_("backgroundCastShadow"),this._fontCastShadow=new A_("fontCastShadow"),this._backgroundReceiveShadow=new A_("backgroundReceiveShadow"),this._fontReceiveShadow=new A_("fontReceiveShadow"),this._renderOrder=new Wie,this._segments=e.segments?new e.segments:new HU,this._bounds=e.bounds?new e.bounds:new xh("bounds"),this._order=new Gne,this._padding=new Kie,this._margin=new Jie,this._position=new BU,this._flexDirection=e.flexDirection?new e.flexDirection:new EI,this._justifyContent=e.justifyContent?new e.justifyContent:new TI,this._alignItems=e.alignItems?new e.alignItems:new CI,this._display=new cne("flex"),this._boxSizing=new dne("border-box"),this._width=new Nne,this._height=new Une,this._backgroundColor=e.backgroundColor?new e.backgroundColor:new PU,this._backgroundOpacity=new SI("backgroundOpacity",.5),this._backgroundImage=new gne,this._backgroundSize=new vne("cover"),this._color=e.color?new e.color:new Fv("color","inherit"),this._fontOpacity=new SI("fontOpacity","inherit"),this._whiteSpace=e.whiteSpace?new e.whiteSpace:new XU,this._fontFamily=e.fontFamily?new e.fontFamily:new UU,this._fontStyle=e.fontStyle?new e.fontStyle:new OU("normal"),this._fontWeight=e.fontWeight?new e.fontWeight:new GU,this._fontSize=e.fontSize?new e.fontSize:new Ase,this._lineHeight=e.lineHeight?new e.lineHeight:new VU,this._fontKerning=e.fontKerning?new e.fontKerning:new b_,this._letterSpacing=e.letterSpacing?new e.letterSpacing:new WU,this._overflow=new xne("visible"),this._borderRadius=new Cne(0),this._borderWidth=new Mne(0),this._borderColor=new Fv("borderColor",16711935),this._borderOpacity=new SI("borderOpacity",1),this._font=new one,this._lineBreak=e.lineBreak?new e.lineBreak:new xh("lineBreak"),this._textContent=e.textContent?new e.textContent:new DU,this._glyphs=e.glyphs?new e.glyphs:new xh("glyphs"),this._inlines=e.inlines?new e.inlines:new xh("inlines"),this._layouter=e.layouter?new e.layouter:new xh("layouter"),this._inlineJustificator=new Tne,this._textAlign=e.textAlign?new e.textAlign:new MI,this._autoSize=e.autoSize?new e.autoSize:new xh("autoSize"),this._renderer=e.renderer?new e.renderer:new xh("renderer"),this._offset=new Hie,this._invertAlpha=new xse,this._fontSmooth=e.fontSmooth?new e.fontSmooth:new jie,this._components=[this._textContent,this._children,this._parent,this._autoSize,this._fontFamily,this._fontStyle,this._fontWeight,this._font,this._whiteSpace,this._glyphs,this._inlines,this._visible,this._backgroundSide,this._fontSide,this._backgroundAlphaTest,this._fontAlphaTest,this._backgroundCastShadow,this._fontCastShadow,this._backgroundReceiveShadow,this._fontReceiveShadow,this._renderOrder,this._segments,this._padding,this._margin,this._width,this._height,this._borderWidth,this._boxSizing,this._bounds,this._position,this._flexDirection,this._justifyContent,this._alignItems,this._order,this._display,this._backgroundColor,this._backgroundOpacity,this._backgroundImage,this._backgroundSize,this._fontOpacity,this._color,this._fontSize,this._lineHeight,this._fontKerning,this._letterSpacing,this._borderRadius,this._borderColor,this._borderOpacity,this._lineBreak,this._offset,this._layouter,this._inlineJustificator,this._textAlign,this._invertAlpha,this._fontSmooth,this._fontMaterial,this._fontCustomDepthMaterial,this._overflow,this._renderer],this._onAfterUpdates=[],i.backgroundSide||(i.backgroundSide=0),i&&this.set(i)}update(){const e={};for(const i of this._components)i._needsUpdate&&(i.update(this,e),i._needsUpdate=!1);this._transferToBackgroundMesh(e),this._transferToFontMesh(e),this._transferToBackgroundMaterial(e),this._transferToFontMaterial(e);for(const i of this._children._uis)i.update()}process(){for(const e of this._children._uis)e.process();for(const e of this._components)e._needsProcess&&(e.process(this),e._needsProcess=!1)}render(){for(let e=0;e<this._components.length;e++){const i=this._components[e];i._needsRender&&(i.render(this),i._needsRender=!1)}for(const e of this._children._uis)e.render()}set(e){if(e.fontTexture&&(console.warn("ThreeMeshUI::set( {fontTexture} ) is deprecated. Please use fontLibrary to register font families and variants."),e.fontFamily)){const i=e.fontFamily.pages?e.fontFamily.info.face:e.fontFamily;let s=qp.getFontFamily(i);if(!s){const r=e.fontStyle?e.fontStyle:"normal",o=e.fontWeight?e.fontWeight:"400";s=qp.addFontFamily(i).addVariant(o,r,e.fontFamily,e.fontTexture)}e.fontFamily=s,delete e.fontTexture}for(let i of Object.keys(e)){const s=e[i];switch(i){case"contentDirection":console.warn("ThreeMeshUI v7xx: property `contentDirection` is deprecated and has been renamed as `flexDirection`"),i="flexDirection";break;case"interLine":console.warn("ThreeMeshUI v7xx: property `interLine` is deprecated and has been renamed as `lineHeight`"),i="lineHeight";break;case"content":console.warn("ThreeMeshUI v7xx: property `content` is deprecated and has been renamed as `textContent`"),i="textContent";break;case"fontColor":console.warn("ThreeMeshUI v7xx: property `fontColor` is deprecated and has been renamed as `color`"),i="color";break;case"hiddenOverflow":console.warn("ThreeMeshUI v7xx: property `hiddenOverflow` is deprecated and has been renamed as `overflow`"),i="overflow";break;case"backgroundTexture":console.warn("ThreeMeshUI v7xx: property `backgroundTexture` is deprecated and has been renamed as `backgroundImage`"),i="backgroundImage";break;case"alignContent":console.warn("ThreeMeshUI v7xx: property `alignContent` is deprecated and has been renamed as `alignItems`"),i="alignItems";break;case"borderTopColor":case"borderBottomColor":case"borderLeftColor":case"borderRightColor":i="borderColor";break}switch(i){case"fontSmooth":case"renderOrder":case"segments":case"visible":case"offset":this[`_${i}`].value=s;break;case"flexDirection":case"justifyContent":case"alignItems":case"color":case"fontFamily":case"fontOpacity":case"fontKerning":case"fontSize":case"fontStyle":case"fontWeight":case"textAlign":case"letterSpacing":case"lineHeight":case"whiteSpace":case"breakOn":case"width":case"height":case"padding":case"margin":case"backgroundColor":case"backgroundOpacity":case"backgroundImage":case"backgroundSize":case"borderColor":case"borderOpacity":case"borderRadius":case"borderWidth":case"overflow":case"order":case"boxSizing":this[`_${i}`]&&(this[`_${i}`].inline=s);break;case"paddingTop":this._padding.top=s;break;case"paddingRight":this._padding.right=s;break;case"paddingBottom":this._padding.bottom=s;break;case"paddingLeft":this._padding.left=s;break;case"marginTop":this._margin.top=s;break;case"marginRight":this._margin.right=s;break;case"marginBottom":this._margin.bottom=s;break;case"marginLeft":this._margin.left=s;break;case"borderTopWidth":this._borderWidth.top=s;break;case"borderRightWidth":this._borderWidth.right=s;break;case"borderBottomWidth":this._borderWidth.bottom=s;break;case"borderLeftWidth":this._borderWidth.left=s;break;case"borderTopLeftRadius":this._borderRadius.topLeft=s;break;case"borderTopRightRadius":this._borderRadius.topRight=s;break;case"borderBottomRightRadius":this._borderRadius.bottomRight=s;break;case"borderBottomLeftRadius":this._borderRadius.bottomLeft=s;break;case"side":case"castShadow":case"receiveShadow":const r=i.charAt(0).toUpperCase()+i.substr(1);this[`_background${r}`].value=s,this[`_font${r}`].value=s;break;case"fontSide":case"backgroundSide":case"fontCastShadow":case"backgroundCastShadow":case"fontReceiveShadow":case"backgroundReceiveShadow":case"fontMaterial":case"fontCustomDepthMaterial":this[`_${i}`].value=s;break;default:this[`_${i}`]!==void 0?this[`_${i}`].value=s:this[i]=s}}}get(e){switch(e){case"overflow":case"width":case"height":return this[`_${e}`].inline}}_rebuildChildrenLists(){this._children._needsUpdate=!0}add(e){let i=!1;for(let s=0;s<arguments.length;s++)super.add(arguments[s]),arguments[s].isUI&&(i=!0);return i&&this._rebuildChildrenLists(),this}remove(e){for(const i of Object.keys(arguments))arguments[i].isInline&&this.update(null,!0);return super.remove(...arguments),this._rebuildChildrenLists(),this}clear(){return this.removeFromParent(),this.traverse(e=>{e.material&&e.material.dispose(),e.geometry&&e.geometry.dispose()}),super.clear(),this._backgroundMesh=null,this._backgroundMaterial=null,this._backgroundMaterialMediation=null,this._backgroundMeshMediation=null,this._children.dispose(),this._children=null,this._parent.dispose(),this._parent=null,this._backgroundSide=null,this._backgroundAlphaTest=null,this._visible=null,this._backgroundCastShadow=null,this._backgroundReceiveShadow=null,this._renderOrder=null,this._segments=null,this._bounds=null,this._boxSizing=null,this._padding=null,this._margin=null,this._position=null,this._flexDirection=null,this._justifyContent=null,this._alignItems=null,this._display=null,this._backgroundColor=null,this._backgroundOpacity=null,this._backgroundSize=null,this._fontOpacity=null,this._color=null,this._whiteSpace=null,this._fontFamily=null,this._fontStyle=null,this._fontWeight=null,this._lineHeight=null,this._fontKerning=null,this._letterSpacing=null,this._overflow=null,this._textAlign=null,this._font=null,this._lineBreak=null,this._layouter=null,this}get textContent(){return this._textContent.process(this),this._textContent._value}get backgroundMaterial(){return this._backgroundMaterial}set backgroundMaterial(e){this._backgroundMaterial=e,this._backgroundMaterialMediation={...e.constructor.mediation},this._transferToBackgroundMaterial(),this._backgroundMesh&&(this._backgroundMesh.material=this._backgroundMaterial,Ia(e,"frameSize",this._backgroundMesh.scale))}set backgroundCustomDepthMaterial(e){this._backgroundCustomDepthMaterial=e,this._transferToBackgroundMaterial(),this._backgroundMesh&&(this._backgroundMesh.customDepthMaterial=this._backgroundCustomDepthMaterial)}get backgroundCustomDepthMaterial(){return this._backgroundCustomDepthMaterial}_transferToBackgroundMaterial(e=null){if(!e){e={};for(const i of this._components)i.output(e)}p_.mediate(this,this._backgroundMaterial,e,this._backgroundMaterialMediation,this._backgroundCustomDepthMaterial)}set backgroundSide(e){this._backgroundSide.value=e,this._backgroundMaterial&&(this._backgroundMaterial.side=e)}get backgroundSide(){return this._backgroundSide.value}set backgroundAlphaTest(e){this._backgroundAlphaTest.value=e,this._backgroundMaterial&&(this._backgroundMaterial.alphaTest=e)}get backgroundAlphaTest(){return this._backgroundAlphaTest.value}get fontMaterial(){return this._fontMaterial.value}set fontMaterial(e){this._fontMaterial.value=e}set fontCustomDepthMaterial(e){this._fontCustomDepthMaterial.value=e}get fontCustomDepthMaterial(){return this._fontCustomDepthMaterial.value}_transferToFontMaterial(e=null){const i=this._fontMaterial.value;if(i){if(!e){e={};for(const s of this._components)s.output(e)}p_.mediate(this,i,e,this._fontMaterial._mediation,this._fontCustomDepthMaterial.value)}}set fontSide(e){this._fontSide.value=e}get fontSide(){return this._fontSide.value}set fontAlphaTest(e){this._fontAlphaTest.value=e}get fontAlphaTest(){return this._fontAlphaTest.value}_transferToBackgroundMesh(e=null){if(!e){e={};for(const i of this._components)i.output(e)}p_.mediate(this,this._backgroundMesh,e,this._backgroundMeshMediation)}setBackgroundMesh(e){this._backgroundMesh&&(this.remove(this._backgroundMesh),this.unbindBackgroundMeshProperties()),this._backgroundMesh=e,this._backgroundMesh&&(this.bindBackgroundMeshProperties(),this._backgroundCustomDepthMaterial&&(this._backgroundMesh.customDepthMaterial=this._backgroundCustomDepthMaterial),this._backgroundMaterial&&Ia(this._backgroundMaterial,"frameSize",this._backgroundMesh.scale),this._transferToBackgroundMesh(),this.add(this._backgroundMesh))}bindBackgroundMeshProperties(){}unbindBackgroundMeshProperties(){}activatePseudoState(e){}deactivatePseudoState(e){}togglePseudoState(e){}hasPseudoState(e){return!1}set borderRadiusMediation(e){this._borderRadius.mediation=e}set backgroundCastShadow(e){this._backgroundCastShadow&&(this._backgroundCastShadow.value=e)}get backgroundCastShadow(){return this._backgroundCastShadow}set backgroundReceiveShadow(e){this._backgroundReceiveShadow&&(this._backgroundReceiveShadow.value=e)}get backgroundReceiveShadow(){return this._backgroundReceiveShadow}set renderOrder(e){this._renderOrder&&(this._renderOrder.value=e)}get renderOrder(){return this._renderOrder.value}_transferToFontMesh(e=null){if(this._fontMesh){if(!e){e={};for(const i of this._components)i.output(e)}p_.mediate(this,this._fontMesh,e,this._fontMeshMediation)}}setFontMesh(e){this._fontMesh&&(this.remove(this._fontMesh),this._fontMesh.material&&this._fontMesh.material.dispose(),this._fontMesh.geometry&&this._fontMesh.geometry.dispose(),this._fontMesh=null,this.unbindFontMeshProperties()),this._fontMesh=e,this._fontMesh&&(this._fontMesh.raycast=()=>{},this.bindFontMeshProperties(),this._transferToFontMaterial(),this._transferToFontMesh(),this.add(this._fontMesh))}bindFontMeshProperties(){}unbindFontMeshProperties(){}set fontCastShadow(e){this._fontCastShadow&&(this._fontCastShadow.value=e)}get fontCastShadow(){return this._fontCastShadow}set fontReceiveShadow(e){this._fontReceiveShadow&&(this._fontReceiveShadow.value=e)}get fontReceiveShadow(){return this._fontReceiveShadow}set segments(e){this._segments.value=e}get segments(){return this._segments.value}set onAfterUpdate(e){console.warn("ThreeMeshUI v7xx : `onAfterUpdate()` property has been deprecated, please rely on `addAfterUpdate` instead."),this.addAfterUpdate(e)}addAfterUpdate(e){this._onAfterUpdates.push(e)}removeAfterUpdate(e){const i=this._onAfterUpdates.indexOf(e);i!==-1&&this._onAfterUpdates.splice(i,1)}performAfterUpdate(){for(let e=0;e<this._onAfterUpdates.length;e++)this._onAfterUpdates[e]()}getProperty(e){return this[`_${e}`]?this[`_${e}`]:null}appendProperty(e,i){this[`_${e}`]=i,this._components.push(i)}replaceProperty(e,i){const s=this[`_${e}`],r=this._components.indexOf(s);return this._components[r]=this[`_${e}`]=i,i.needsUpdate=!0,s}}class x_{static register(e){this.elements.includes(e)||this.elements.push(e)}static remove(e){const i=this.elements.indexOf(e);i!==-1&&this.elements.splice(i,1)}static update(){for(const e of this.elements)e.update(),e.process(),e.process(),e.render()}}x_.elements=[];const Cse=`

// FrameBorder vertex pars
attribute vec2 uvB;
varying vec2 vUvB;

`,DI=Cse,Mse=`

	// FrameBorder vertex shader
	vUvB = uvB;

`,OI=Mse,Ese=`

// borders sequences are : x:TOP, y:RIGHT, z:BOTTOM, w:LEFT
uniform vec4 borderWidth;
uniform vec3 borderColor;
uniform float borderOpacity;
uniform vec4 borderRadius;

uniform vec2 cornerTL;
uniform vec2 cornerTR;
uniform vec2 cornerBR;
uniform vec2 cornerBL;

varying vec2 vUvB;

float getEllipticFactor( vec2 uv, vec2 center, float radiusX, float radiusY )
{

		float edx = uv.x - center.x;
		float edy = uv.y - center.y;

		float ddx = (edx * edx) / (radiusX * radiusX);
		float ddy = (edy * edy) / (radiusY * radiusY);

		return ddx + ddy;

}

`,GI=Ese,Tse=`

vec4 borderColor = vec4( borderColor, borderOpacity );

// This could be tweak to produce more smoothing
float mult = 1.0;

// Step 1 ----------------------------------------------
// Draw the four borders ( top - right - bottom - left )
// Without worrying about radiuses ( Straight boorders )

// Top
float topBorderUVy = 1.0 - borderWidth.x;
if( borderWidth.x > 0.0 && vUvB.y > topBorderUVy )
{

	float w = fwidth( 1.0 - vUvB.y ) * mult;
	float step = smoothstep( topBorderUVy , topBorderUVy + w , vUvB.y );
	diffuseColor = mix( diffuseColor, borderColor, step );

}

// Left
float leftBorderUVx = borderWidth.w;
if( borderWidth.w > 0.0 && vUvB.x < leftBorderUVx )
{

	float w = fwidth( vUvB.x ) * mult ;
	float step = smoothstep( leftBorderUVx , leftBorderUVx - w , vUvB.x );
	diffuseColor = mix( diffuseColor, borderColor, step );

}

// Bottom
float bottomBorderUVy = borderWidth.z;
if( borderWidth.z > 0.0 && vUvB.y < bottomBorderUVy )
{
	float w = fwidth( vUvB.y ) * mult;
	float step = smoothstep( bottomBorderUVy , bottomBorderUVy - w , vUvB.y );
	diffuseColor = mix( diffuseColor, borderColor, step );
}

// Right
float rightBorderUVx = 1.0 - borderWidth.y;
if( borderWidth.y > 0.0 && vUvB.x > rightBorderUVx )
{
	float w = fwidth( 1.0 - vUvB.x ) * mult;
	float step = smoothstep( rightBorderUVx , rightBorderUVx + w , vUvB.x );
	diffuseColor = mix( diffuseColor, borderColor, step );
}


// Step 2 ----------------------------------------------
// Process each corners ( topLeft, topRight, bottomRight, bottomLeft )
// To transparentize outside radiuses
// To draw ellipse border on the corner


// Top Left corner
if( vUvB.x < cornerTL.x && vUvB.y > cornerTL.y ) {

		// Only draw border if width is set
		if( borderWidth.w + borderWidth.x > 0.0 ){

			float borderFactor = getEllipticFactor( vUvB, cornerTL, cornerTL.x - borderWidth.w,  ( 1.0 - cornerTL.y ) - borderWidth.x );
			float step = smoothstep( 1.0, 1.0 + fwidth( borderFactor ) * mult, borderFactor );
			diffuseColor = mix( diffuseColor, borderColor, step );

		}

		// Then then radius
		float radiusFactor = getEllipticFactor( vUvB, cornerTL, cornerTL.x, 1.0 - cornerTL.y );
		float alphaStep = smoothstep( 1.0 , 1.0 + fwidth(radiusFactor) * mult , radiusFactor );
		diffuseColor.a = mix( diffuseColor.a, 0.0, alphaStep );

}
// Bottom Left
if( vUvB.x < cornerBL.x && vUvB.y < cornerBL.y ) {

		if( borderWidth.w + borderWidth.z > 0.0 ){

			float borderFactor = getEllipticFactor( vUvB, cornerBL, cornerBL.x - borderWidth.w,  cornerBL.y - borderWidth.z );
			float step = smoothstep( 1.0, 1.0 + fwidth( borderFactor ) * mult, borderFactor );
			diffuseColor = mix( diffuseColor, borderColor, step );

		}


		float radiusFactor = getEllipticFactor( vUvB, cornerBL, cornerBL.x, cornerBL.y );
		float alphaStep = smoothstep( 1.0 , 1.0 + fwidth(radiusFactor) * mult , radiusFactor );
		diffuseColor.a = mix( diffuseColor.a, 0.0, alphaStep );

}
// Top Right
if( vUvB.x > cornerTR.x && vUvB.y > cornerTR.y ) {

		if( borderWidth.y + borderWidth.x > 0.0 ){

			float borderFactor = getEllipticFactor( vUvB, cornerTR, ( 1.0 - cornerTR.x ) - borderWidth.y,  ( 1.0 - cornerTR.y ) - borderWidth.x );
			float step = smoothstep( 1.0, 1.0 + fwidth( borderFactor ) * mult, borderFactor );
			diffuseColor = mix( diffuseColor, borderColor, step );

		}

		float radiusFactor = getEllipticFactor( vUvB, cornerTR, 1.0 - cornerTR.x, 1.0 - cornerTR.y );
		float alphaStep = smoothstep( 1.0 , 1.0 + fwidth(radiusFactor) * mult , radiusFactor );
		diffuseColor.a = mix( diffuseColor.a, 0.0, alphaStep );

}
// Bottom Right
if( vUvB.x > cornerBR.x && vUvB.y < cornerBR.y ) {

		if( borderWidth.y + borderWidth.z > 0.0 ){

			float borderFactor = getEllipticFactor( vUvB, cornerBR, ( 1.0 - cornerBR.x ) - borderWidth.y,  cornerBR.y - borderWidth.z );
			float step = smoothstep( 1.0, 1.0 + fwidth( borderFactor ) * mult, borderFactor );
			diffuseColor = mix( diffuseColor, borderColor, step );

		}

		float radiusFactor = getEllipticFactor( vUvB, cornerBR, 1.0 - cornerBR.x, cornerBR.y );
		float alphaStep = smoothstep( 1.0 , 1.0 + fwidth(radiusFactor) * mult , radiusFactor );
		diffuseColor.a = mix( diffuseColor.a, 0.0, alphaStep );

}

`,zI=Tse,Rse=`

// To be removed - required for both border and background
uniform vec3 frameSize;
uniform vec2 textureSize;

`,FI=Rse,Ise=`

#ifdef USE_MAP

vec4 sampleTexture() {

	vec2 uv = vUv;

	// default stretch
	#if BACKGROUND_MAPPING != 0

	float textureRatio = textureSize.x / textureSize.y;
	float panelRatio = frameSize.x / frameSize.y;
	float ratio = panelRatio / textureRatio;
	float ratio2 = textureRatio / panelRatio;

		// contain
		#if BACKGROUND_MAPPING == 1
		if ( textureRatio < panelRatio ) { // repeat on X
			float newX = uv.x * ratio;
			newX += 0.5 - 0.5 * ratio;
			uv.x = newX;
		} else { // repeat on Y
			float newY = uv.y * ratio2;
			newY += 0.5 - 0.5 * ratio2;
			uv.y = newY;
		}
		#else
		// cover
		if ( textureRatio < panelRatio ) { // stretch on Y
			float newY = uv.y * ratio2;
			newY += 0.5 - 0.5 * ratio2;
			uv.y = newY;
		} else { // stretch on X
			float newX = uv.x * ratio;
			newX += 0.5 - 0.5 * ratio;
			uv.x = newX;
		}

		#endif

	#endif

	return texture2D( map, uv );

}
#endif
`,NI=Ise,Lse=`
#ifdef USE_MAP

	vec4 textureSample = sampleTexture();
	diffuseColor *= textureSample;

#endif
`,UI=Lse,QU={msdfAlphaglyphParsVertexGlsl:RI,msdfAlphaglyphVertexGlsl:II,msdfOffsetglyphVertexGlsl:LI,msdfAlphaglyphParsFragmentGlsl:PI,msdfAlphaglyphFragmentGlsl:BI,frameBorderParsVertexGlsl:DI,frameBorderVertexGlsl:OI,frameCommonParsFragmentGlsl:FI,frameBorderParsFragmentGlsl:GI,frameBorderFragmentGlsl:zI,frameBackgroundParsFragmentGlsl:NI,frameBackgroundFragmentGlsl:UI},Pse=`
// Would be automatic on three materials and from USE_UV
#ifdef USE_MAP
varying vec2 vUv;
#endif

${DI}

#include <clipping_planes_pars_vertex>

void main() {

	#ifdef USE_MAP
	vUv = uv;
	#endif

	${OI}

	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
	gl_Position = projectionMatrix * mvPosition;

	#include <clipping_planes_vertex>

}
`,Bse=`

// Basic
uniform vec3 diffuse;
uniform float opacity;

#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif

${FI}

${GI}


#ifdef USE_MAP
varying vec2 vUv;
uniform sampler2D map;
#endif

${NI}

#include <clipping_planes_pars_fragment>

void main() {

	vec4 diffuseColor = vec4( diffuse, opacity );

	// map
	${UI}

	${zI}

	#ifdef USE_ALPHATEST

	if ( diffuseColor.a < alphaTest ) discard;

	#endif

	// output
	gl_FragColor = diffuseColor;


	#include <clipping_planes_fragment>
}
`;class BT{static get mediation(){return Dse}static ensureMaterialOptions(e){e.transparent=!0,e.alphaTest=e.alphaTest||.02}static ensureDefines(e){e.defines||(e.defines={})}static ensureUserData(e,i){e.userData.borderColor={value:null},e.userData.borderRadius={value:new He.Vector4(0,0,0,0)},e.userData.cornerTL={value:new He.Vector2(0,1)},e.userData.cornerTR={value:new He.Vector2(1,1)},e.userData.cornerBR={value:new He.Vector2(1,0)},e.userData.cornerBL={value:new He.Vector2(0,0)},e.userData.borderWidth={value:new He.Vector4(0,0,0,0)},e.userData.borderOpacity={value:null},e.userData.frameSize={value:new He.Vector3(1,1,1)},e.userData.textureSize={value:new He.Vector2(1,1)}}static bindUniformsWithUserData(e,i){e.uniforms.borderColor=i.userData.borderColor,e.uniforms.borderRadius=i.userData.borderRadius,e.uniforms.cornerTL=i.userData.cornerTL,e.uniforms.cornerTR=i.userData.cornerTR,e.uniforms.cornerBR=i.userData.cornerBR,e.uniforms.cornerBL=i.userData.cornerBL,e.uniforms.borderWidth=i.userData.borderWidth,e.uniforms.borderOpacity=i.userData.borderOpacity,e.uniforms.frameSize=i.userData.frameSize,e.uniforms.textureSize=i.userData.textureSize}static injectShaderChunks(e){BT.injectVertexShaderChunks(e),BT.injectFragmentShaderChunks(e)}static injectVertexShaderChunks(e){e.vertexShader=e.vertexShader.replace("#include <uv_pars_vertex>",`#include <uv_pars_vertex>
`+DI),e.vertexShader=e.vertexShader.replace("#include <uv_vertex>",`#include <uv_vertex>
`+OI)}static injectFragmentShaderChunks(e){e.fragmentShader=e.fragmentShader.replace("#include <map_pars_fragment>",`#include <map_pars_fragment>
`+NI),e.fragmentShader=e.fragmentShader.replace("#include <map_pars_fragment>",`#include <map_pars_fragment>
`+GI),e.fragmentShader=e.fragmentShader.replace("#include <map_pars_fragment>",`#include <map_pars_fragment>
`+FI),e.fragmentShader=e.fragmentShader.replace("#include <map_fragment>",UI),e.fragmentShader=e.fragmentShader.replace("#include <alphamap_fragment>",zI+`
#include <alphamap_fragment>`)}}const kse=function(n,e,i){i=["stretch","contain","cover"].indexOf(i),FU(n,"BACKGROUND_MAPPING",i)},Dse={clippingPlanes:{m:"clippingPlanes"},backgroundAlphaTest:{m:"alphaTest",t:g_},backgroundSide:{m:"side"},backgroundImage:{m:"map"},backgroundColor:{m:"color"},backgroundOpacity:{m:"opacity"},backgroundSize:{m:"computedBackgroundSize",t:kse},borderWidth:{m:"borderWidth",t:Ia},borderColor:{m:"borderColor",t:Ia},cornerTL:{m:"cornerTL",t:Ia},cornerTR:{m:"cornerTR",t:Ia},cornerBR:{m:"cornerBR",t:Ia},cornerBL:{m:"cornerBL",t:Ia},borderOpacity:{m:"borderOpacity",t:Ia},size:{m:"frameSize",t:Ia},tSize:{m:"textureSize",t:Ia}};class ZU extends He.ShaderMaterial{static get mediation(){return BT.mediation}constructor(){super({uniforms:{alphaTest:{value:.02},map:{value:null},diffuse:{value:new He.Color(16777215)},opacity:{value:1},borderColor:{value:new He.Color(0)},borderOpacity:{value:0},borderRadius:{value:new He.Vector4(0,0,0,0)},cornerTL:{value:new He.Vector2(0,1)},cornerTR:{value:new He.Vector2(1,1)},cornerBR:{value:new He.Vector2(1,0)},cornerBL:{value:new He.Vector2(0,0)},borderWidth:{value:new He.Vector4(0,0,0,0)},frameSize:{value:new He.Vector3(1,1,1)},textureSize:{value:new He.Vector2(1,1)}},side:He.FrontSide,transparent:!0,clipping:!0,vertexShader:Pse,fragmentShader:Bse,extensions:{derivatives:!0}}),this.defines.USE_ALPHATEST="",this.needsUpdate=!0}set map(e){this.uniforms.map.value=e,e?this.defines.USE_UV===void 0&&(this.defines.USE_UV="",this.needsUpdate=!0):this.defines.USE_UV!==void 0&&(delete this.defines.USE_UV,this.needsUpdate=!0),this.needsUpdate=!0}get map(){return this.uniforms.map.value}get alphaTest(){return this.uniforms.alphaTest.value}set alphaTest(e){this.uniforms.alphaTest.value=e}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get opacity(){return this.uniforms.opacity.value}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}}class Ose extends Ti{constructor(){super("children",null,!1),p(this,"_sortOrder",(e,i)=>e._order._value<i._order._value?-1:e._order._value>i._order._value?1:this._uis.indexOf(e)<this._uis.indexOf(i)?-1:1),this._uis=[],this._boxes=[]}update(e,i){this._compute(e),e._layouter._needsUpdate=!0,e._renderOrder._needsUpdate=!0}process(e){this._compute(e),e._flexDirection._needsProcess=!0,e._layouter._needsProcess=!0,e._overflow._needsRender=!0}_compute(e){this._uis=e.children.filter(i=>i.visible&&i.isUI),this._boxes=this._uis.filter(i=>i.isBox).sort(this._sortOrder)}dispose(){this._uis=null,this._boxes=null}}class YU extends Ti{constructor(){super("bounds",null,!1),this._size=new He.Vector3(1,1,1),this._offsetWidth=0,this._offsetHeight=0,this._innerWidth=0,this._innerHeight=0,this._centerX=.5,this._centerY=.5,this._needsProcess=!0}setReferenceWidth(e,i){const s=e._width,r=e._padding._value,o=e._borderWidth._value,a=e._margin._value,l=s._auto?1:s._value,c=i*l-(a.y+a.w);wI(c,this._offsetWidth)||(this._offsetWidth=c,this._innerWidth=this._offsetWidth-(r.y+r.w+o.y+o.w),this._centerX=VI(e),this._propagateWidth(e),this._triggerCascadingDependencies(e))}setReferenceHeight(e,i){const s=e._height,r=e._padding._value,o=e._borderWidth._value,a=e._margin._value,l=s._auto?1:s._value,c=i*l-(a.x+a.z);wI(c,this._offsetHeight)||(this._offsetHeight=c,this._innerHeight=this._offsetHeight-(r.x+r.z+o.x+o.z),this._centerY=XI(e),this._propagateHeight(e),this._triggerCascadingDependencies(e))}setChildrenWidth(e,i){const s=e._padding._value,r=e._borderWidth._value;this._innerWidth=i,this._offsetWidth=this._innerWidth+(s.y+s.w+r.y+r.w),this._centerX=VI(e),this._propagateWidth(e),this._triggerCascadingDependencies(e)}setChildrenHeight(e,i){const s=e._padding._value,r=e._borderWidth._value;this._innerHeight=i,this._offsetHeight=this._innerHeight+(s.x+s.z+r.x+r.z),this._centerY=XI(e),this._propagateHeight(e),this._triggerCascadingDependencies(e)}update(e,i){const s=e._padding._value,r=e._borderWidth._value,o=e._width;!o._auto&&!o._relative&&(e._boxSizing._value==="content-box"?(this._innerWidth=o._value,this._offsetWidth=this._innerWidth+s.y+s.w+r.y+r.w):(this._offsetWidth=o._value,this._innerWidth=this._offsetWidth-(s.y+s.w+r.y+r.w)),this._centerX=VI(e),this._needsProcess=!0,this._propagateWidth(e),this._triggerCascadingDependencies(e));const a=e._height;!a._auto&&!a._relative&&(e._boxSizing._value==="content-box"?(this._innerHeight=a._value,this._offsetHeight=this._innerHeight+s.x+s.z+r.x+r.z):(this._offsetHeight=a._value,this._innerHeight=this._offsetHeight-(s.x+s.z+r.x+r.z)),this._centerY=XI(e),this._needsProcess=!0,this._propagateHeight(e),this._triggerCascadingDependencies(e))}render(e){this._size.x=this._offsetWidth,this._size.y=this._offsetHeight,e._backgroundMesh&&e._backgroundMesh.updateScale(),e._renderer._needsRender=!0}output(e){e.size=this._size}process(e){e._overflow._needsRender=!0}_computeChildrenSideWidth(e){return Gse(e)}_computeChildrenSideHeight(e){return zse(e)}_propagateWidth(e){for(let i=0;i<e._children._boxes.length;i++){const s=e._children._boxes[i];s._width._relative&&s._bounds.setReferenceWidth(s,this._innerWidth)}}_propagateHeight(e){for(let i=0;i<e._children._boxes.length;i++){const s=e._children._boxes[i];s._height._relative&&s._bounds.setReferenceHeight(s,this._innerHeight)}}_triggerCascadingDependencies(e){e._parent._value&&(e._parent._value._autoSize._needsProcess=!0),e._flexDirection._needsProcess=!0,e._fontSize._needsProcess=!0,e._layouter._needsProcess=!0,this._needsRender=!0,e._borderWidth._needsRender=!0,e._borderRadius._needsRender=!0,e._overflow._needsRender=!0}}function VI(n){const e=n._padding._value,i=n._borderWidth._value,s=e.w+i.w,r=e.y+i.y;return(s-r)/2}function XI(n){const e=n._padding._value,i=n._borderWidth._value,s=e.x+i.x;return(e.z+i.z-s)/2}function Gse(n){return n._children._boxes.reduce((e,i)=>{const s=i._margin._value,r=i._bounds._offsetWidth+s.y+s.w;return e+r},0)}function zse(n){return n._children._boxes.reduce((e,i)=>{const s=i._margin._value,r=i._bounds._offsetHeight+s.x+s.z;return e+r},0)}class Fse extends CI{constructor(){super(),this._allowsInherit=!1,this._needsUpdate=!0,this._process=this.emptyStrategyLogic,this._childAlign=this.emptyStrategyLogic}computeOutputValue(e){switch(this._value=this._inheritedInput,e._flexDirection._value){case"row":case"row-reverse":switch(this._process=Hse,this._value){case"start":this._childAlign=Use;break;case"end":this._childAlign=Nse;break;default:this._childAlign=KU}break;case"column":case"column-reverse":switch(this._process=Wse,this._value){case"start":this._childAlign=Xse;break;case"end":this._childAlign=Vse;break;default:this._childAlign=KU}break}this._needsProcess=!0,e._autoSize._needsProcess=!0,e._flexDirection._needsProcess=!0,e._justifyContent._needsProcess=!0,this._needsProcess=!0,e._fontSize._needsProcess=!0,e._layouter._needsProcess=!0}process(e){this._process(e,this._childAlign);let i="center",s="center",r="center";const o=e._padding._value,a=e._borderWidth._value;e._flexDirection._value.indexOf("column")!==-1?this._value==="start"?i=s="left":this._value==="end"?i=s="right":i="centerX":this._value==="start"?i=r="top":this._value==="end"?i=r="bottom":i="centerY";let l=-(o.x-o.z)/2-(a.x-a.z)/2,c=-(o.y-o.w)/2-(a.y-a.w)/2;s==="left"?c=(o.w-o.y)/2+(a.w-a.y)/2:s==="right"&&(c=-(o.y-o.w)/2-(a.y-a.w)/2),r==="top"?l=-(o.x-o.z)/2-(a.x-a.z)/2:r==="bottom"&&(l=(o.z-o.x)/2+(a.z-a.x)/2),e._children._boxes.forEach(h=>{let u=0,d=0;i==="top"?d=-h._margin._value.x:i==="bottom"?d=h._margin._value.z:i==="left"?u=h._margin._value.w:i==="right"?u=-h._margin._value.y:i==="centerX"?u=(h._margin._value.w-h._margin._value.y)/2:i==="centerY"&&(d=(-h._margin._value.x+h._margin._value.z)/2),e._layouter._childrenPos[h.id].x+=c+u,e._layouter._childrenPos[h.id].y+=l+d})}}function KU(){return 0}function Nse(n,e){return-e+n._bounds._offsetHeight/2}function Use(n,e){return e-n._bounds._offsetHeight/2}function Vse(n,e){return e-n._bounds._offsetWidth/2}function Xse(n,e){return-e+n._bounds._offsetWidth/2}function Wse(n,e){const i=n._bounds._innerWidth/2;n._children._boxes.forEach(s=>{n._layouter._childrenPos[s.id].x=e(s,i)})}function Hse(n,e){const i=n._bounds._innerHeight/2;n._children._boxes.forEach(s=>{n._layouter._childrenPos[s.id].y=e(s,i)})}class jse extends EI{constructor(){super(),this._allowsInherit=!1,this._needsUpdate=!0,this._offset=0,this._reverse=1,this._process=this.emptyStrategyLogic}computeOutputValue(e){switch(this._value=this._inheritedInput,this._value){case"row":this._process=Qse;break;case"row-reverse":this._process=Zse;break;case"column":this._process=Yse;break;case"column-reverse":this._process=Kse;break}e._justifyContent._needsUpdate||e._justifyContent.computeOutputValue(e),e._alignItems._needsUpdate||e._alignItems.computeOutputValue(e),this._needsProcess=!0}process(e){switch(this._value){case"row":this._offset=-e._bounds._innerWidth/2;break;case"row-reverse":this._offset=e._bounds._innerWidth/2;break;case"column":this._offset=e._bounds._innerHeight/2;break;case"column-reverse":this._offset=-e._bounds._innerHeight/2;break}this._reverse=-Math.sign(this._offset),this._reverse===0&&(this._reverse=1),this._process(e),e._justifyContent._needsProcess=!0,e._layouter._needsProcess=!0}}function Qse(n){let e=n._flexDirection._offset;const i=n._flexDirection._reverse,s=n._children._boxes;for(let r=0;r<s.length;r++){const o=s[r],a=o.id,l=o._bounds._offsetWidth;e+=o._margin._value.w*i;const c=n._layouter._childrenPos[a];c.x=e+l/2*i,c.y=0,e+=i*(l+o._margin._value.y)}}function Zse(n){let e=n._flexDirection._offset;const i=n._flexDirection._reverse,s=n._children._boxes;for(let r=0;r<s.length;r++){const o=s[r],a=o.id,l=o._bounds._offsetWidth;e+=o._margin._value.y*i;const c=n._layouter._childrenPos[a];c.x=e+l/2*i,c.y=0,e+=(l+o._margin._value.w)*i}}function Yse(n){let e=n._flexDirection._offset;const i=n._flexDirection._reverse,s=n._children._boxes;for(let r=0;r<s.length;r++){const o=s[r],a=o.id,l=o._bounds._offsetHeight;e+=o._margin._value.x*i;const c=n._layouter._childrenPos[a];c.x=0,c.y=e+l/2*i,e+=(l+o._margin._value.z)*i}}function Kse(n){let e=n._flexDirection._offset;const i=n._flexDirection._reverse,s=n._children._boxes;for(let r=0;r<s.length;r++){const o=s[r],a=o.id,l=o._bounds._offsetHeight;e+=o._margin._value.z*i;const c=n._layouter._childrenPos[a];c.x=0,c.y=e+l/2*i,e+=(l+o._margin._value.x)*i}}class Jse extends TI{constructor(e){super("justifyContent",e,!0),this._allowsInherit=!1,this._needsUpdate=!0,this._computeOffset=this.emptyStrategyLogic,this._computeMargin=this.emptyStrategyLogic,this._process=this.emptyStrategyLogic}computeOutputValue(e){switch(this._value=this._inheritedInput,e._flexDirection._value){case"column-reverse":case"column":this._process=$se.bind(this);break;case"row-reverse":case"row":this._process=qse.bind(this);break}switch(this._value){case"end":this._computeOffset=ire,this._computeMargin=WI;break;case"center":this._computeOffset=nre,this._computeMargin=WI;break;case"start":this._computeOffset=w_,this._computeMargin=WI;break;case"space-between":this._computeOffset=w_,this._computeMargin=sre;break;case"space-around":this._computeOffset=w_,this._computeMargin=ore;break;case"space-evenly":this._computeOffset=w_,this._computeMargin=rre;break}e._flexDirection._needsProcess=!0}process(e){this._process(e),e._alignItems._needsProcess=!0}}function qse(n){const e=n._flexDirection._offset,{usedDirectionSpace:i,remainingSpace:s}=ere(n),r=e*2-i*Math.sign(e),o=this._computeOffset(r),a=this._computeMargin(n,s,n._flexDirection._reverse);n._children._boxes.forEach((l,c)=>{n._layouter._childrenPos[l.id].x-=o-a[c]})}function $se(n){const e=n._flexDirection._offset,{usedDirectionSpace:i,remainingSpace:s}=tre(n),r=e*2-i*Math.sign(e),o=this._computeOffset(r),a=this._computeMargin(n,s,n._flexDirection._reverse);n._children._boxes.forEach((l,c)=>{n._layouter._childrenPos[l.id].y-=o-a[c]})}function ere(n){const e=n._bounds._computeChildrenSideWidth(n);return{usedDirectionSpace:e,remainingSpace:n._bounds._innerWidth-e}}function tre(n){const e=n._bounds._computeChildrenSideHeight(n);return{usedDirectionSpace:e,remainingSpace:n._bounds._innerHeight-e}}function w_(n){return 0}function ire(n){return n}function nre(n){return n/2}function WI(n,e=0,i=1){return Array(n._children._boxes.length).fill(0)}function sre(n,e=0,i=1){const s=n._children._boxes.length,r=Array(s).fill(0);if(e>0&&s>1){const o=e/(s-1)*i;r[0]=0;for(let a=1;a<s;a++)r[a]=o*a}return r}function rre(n,e=0,i=1){const s=n._children._boxes.length,r=Array(s).fill(0);if(e>0){const o=e/(s+1)*i;for(let a=0;a<s;a++)r[a]=o*(a+1)}return r}function ore(n,e=0,i=1){const s=n._children._boxes.length,r=Array(s).fill(0);if(e>0){const o=e/s*i,a=o/2;r[0]=a;for(let l=1;l<s;l++)r[l]=a+o*l}return r}let HI;class JU extends He.Mesh{constructor(e){const i=e.slice,s={};let r=1,o=1;if(i){if(r=i.width?i.width:1,o=i.height?i.height:1,i.top){if(i.left){const d=new He.PlaneGeometry(i.left*r,i.top*o,1,1);wh(d,0,i.left,1-i.top,1),d.translate(i.left*r/2,-i.top*o/2,0),s.topLeft=d}const u=new He.PlaneGeometry(1,i.top*o,1,1);if(wh(u,i.left,1-i.right,1-i.top,1),u.translate(0,-i.top*o/2,0),s.top=u,i.right){const d=new He.PlaneGeometry(i.right*r,i.top*o,1,1);wh(d,1-i.right,1,1-i.top,1),d.translate(-i.right*r/2,-i.top*o/2,0),s.topRight=d}}if(i.left){const u=new He.PlaneGeometry(i.left*r,1,1,1);wh(u,0,i.left,i.bottom,1-i.top),u.translate(i.left*r/2,0,0),s.left=u}const h=new He.PlaneGeometry(1,1,1,1);if(wh(h,i.left,1-i.right,i.bottom,1-i.top),s.middle=h,i.right){const u=new He.PlaneGeometry(i.right*r,1,1,1);wh(u,1-i.right,1,i.bottom,1-i.top),u.translate(-i.right*r/2,0,0),s.right=u}if(i.bottom){if(i.left){const d=new He.PlaneGeometry(i.left*r,i.bottom*o,1,1);wh(d,0,i.left,0,i.bottom),d.translate(i.left*r/2,i.bottom*o/2,0),s.bottomLeft=d}const u=new He.PlaneGeometry(1,i.bottom*o,1,1);if(wh(u,i.left,1-i.right,0,i.bottom),u.translate(0,i.bottom*o/2,0),s.bottom=u,i.right){const d=new He.PlaneGeometry(i.right*r,i.bottom*o,1,1);wh(d,1-i.right,1,0,i.bottom),d.translate(-i.right*r/2,i.bottom*o/2,0),s.bottomRight=d}}}let a=e.backgroundMaterial;i&&(HI||(HI=new He.MeshBasicMaterial({alphaTest:1.1})),a=HI);const l=new He.PlaneGeometry(1,1,e._segments.value,e._segments.value),c=new He.BufferAttribute(new Float32Array(l.getAttribute("uv").array),2);if(l.setAttribute("uvB",c).name="uvB",super(l,a),this.name="UIBackgroundBox",i){this.slice=i,this.sliceSize=new He.Vector3(1-(i.left+i.right),1-(i.bottom+i.top),1),this.sliceScale=new He.Vector3(r,o,1);for(const h in s){const u=new He.Mesh(s[h],e.backgroundMaterial);this.add(u),s[h]=u}this.updateScale=this.updateScaleSlice,this.slices=s}}updateScale(){}updateScaleSlice(){const e=new He.Vector3(1,1,1);this.scale.x<(this.slice.left+this.slice.right)*this.sliceScale.x&&(e.x=this.scale.x/((this.slice.left+this.slice.right)*this.sliceScale.x)),this.scale.y<(this.slice.bottom+this.slice.top)*this.sliceScale.y&&(e.y=this.scale.y/((this.slice.bottom+this.slice.top)*this.sliceScale.y));for(const i in this.slices){const s=this.slices[i];s.scale.set(1/this.scale.x,1/this.scale.y,this.scale.y);const r=are[i];for(const a in r)s.position[a]=this.scale[a]*r[a]*s.scale[a];const o=lre[i];if(o){o.x&&(s.position.x=this.sliceScale.x*.5*(this.slice.left-this.slice.right)*(1/this.scale.x)),o.y&&(s.position.y=this.sliceScale.y*.5*(this.slice.bottom-this.slice.top)*(1/this.scale.y));for(const a in o){const l=this.scale[a]-(1-this.sliceSize[a])*this.sliceScale[a];s.scale[a]=Math.max(0,l*(1/this.scale[a]))}}}e.x!==1&&(this.slices.left.scale.x*=e.x,this.slices.topLeft.scale.x*=e.x,this.slices.bottomLeft.scale.x*=e.x,this.slices.right.scale.x*=e.x,this.slices.topRight.scale.x*=e.x,this.slices.bottomRight.scale.x*=e.x),e.y!==1&&(this.slices.top.scale.y*=e.y,this.slices.topLeft.scale.y*=e.y,this.slices.topRight.scale.y*=e.y,this.slices.bottom.scale.y*=e.y,this.slices.bottomLeft.scale.y*=e.y,this.slices.bottomRight.scale.y*=e.y)}}const are={topLeft:{x:-.5,y:.5},top:{y:.5},topRight:{x:.5,y:.5},left:{x:-.5},right:{x:.5},bottomLeft:{x:-.5,y:-.5},bottom:{y:-.5},bottomRight:{x:.5,y:-.5}},lre={top:{x:1},left:{y:1},right:{y:1},bottom:{x:1},middle:{x:1,y:1}};function wh(n,e,i,s,r){const o=i-e,a=r-s,l=n.attributes.uv;for(let h=0;h<l.count;h++){const u=l.getX(h),d=l.getY(h);l.setXY(h,e+u*o,s+d*a)}const c=new He.BufferAttribute(new Float32Array(n.getAttribute("uv").array),2);n.setAttribute("uvB",c).name="uvB"}class qU extends Ti{constructor(){super("renderer")}render(e){e._backgroundMesh||e.setBackgroundMesh(new JU(e)),e.performAfterUpdate()}}class cre extends BU{constructor(){super("position")}update(e,i){super.update(e,i),this._needsProcess=!0}}class hre extends Ti{constructor(){super("autosize"),this._needsProcess=!0}process(e){e._width._auto&&ure(e),e._height._auto&&dre(e);const i=e._alignItems._value==="stretch",s=i&&e._flexDirection._value.indexOf("column")!==-1,r=i&&!s;for(const o of e._children._boxes)(o._width._auto&&s||o._width._relative)&&o._bounds.setReferenceWidth(o,e._bounds._innerWidth),(o._height._auto&&r||o._height._relative)&&o._bounds.setReferenceHeight(o,e._bounds._innerHeight)}}function ure(n){n._bounds.setChildrenWidth(n,mre(n))}function dre(n){n._bounds.setChildrenHeight(n,pre(n))}function pre(n){switch(n._flexDirection._value){case"row":case"row-reverse":return vre(n);case"column":case"column-reverse":return gre(n)}}function mre(n){switch(n._flexDirection._value){case"row":case"row-reverse":return fre(n);case"column":case"column-reverse":return yre(n)}}function fre(n){let e=0;for(const i of n._children._boxes){if(i._position._value!=="static")continue;const s=i._margin._value,r=i._bounds._offsetWidth+s.y+s.w;e+=r}return e}function gre(n){let e=0;for(const i of n._children._boxes){if(i._position._value!=="static")continue;const s=i._margin._value,r=i._bounds._offsetHeight+s.x+s.z;e+=r}return e}function yre(n){let e=0;for(const i of n._children._boxes){if(i._position._value!=="static")continue;const s=i._margin._value,r=i._bounds._offsetWidth+s.y+s.w;r>e&&(e=r)}return e}function vre(n){let e=0;for(const i of n._children._boxes){if(i._position._value!=="static")continue;const s=i._margin._value,r=i._bounds._offsetHeight+s.x+s.z;r>e&&(e=r)}return e}class v1 extends Nv{constructor(e,i){v1.definePropertiesValues(e,i),super(e,i),v1.init(this)}bindBackgroundMeshProperties(){this._bounds._size=this._backgroundMesh.scale,this._bounds._needsProcess=!0}unbindBackgroundMeshProperties(){this._bounds._size=new He.Vector3(1,1,1),this._bounds._needsProcess=!0}static definePropertiesValues(e,i){e.children||(e.children=Ose),e.bounds||(e.bounds=YU),e.flexDirection||(e.flexDirection=jse),e.justifyContent||(e.justifyContent=Jse),e.alignItems||(e.alignItems=Fse),e.position||(e.position=cre),e.autoSize||(e.autoSize=hre),e.renderer||(e.renderer=qU),i.fontSide||(i.fontSide=0),i.invertAlpha||(i.invertAlpha=!1),i.fontCastShadow||(i.fontCastShadow=!1),i.fontReceiveShadow||(i.fontReceiveShadow=!1),i.backgroundCastShadow||(i.backgroundCastShadow=!1),i.backgroundReceiveShadow||(i.backgroundReceiveShadow=!1)}static init(e){Object.defineProperties(e,{isBox:{configurable:!1,enumerable:!0,value:!0}}),e.backgroundMaterial=new ZU,e._renderer.render(e),e._backgroundMesh.visible=!1}}let $U=class extends Array{constructor(...n){super(...n),this.width=0,this.lineBase=0,this.lineHeight=0,this.y=0}};class bre extends Ti{constructor(){super("layouter",null,!1),this._needsUpdate=!0,this._childrenPos={}}update(e,i){this._childrenPos={};for(const s of e._children._boxes)s._position._value==="static"&&(this._childrenPos[s.id]=s.position)}process(e){}}class b1 extends v1{constructor(e={}){const i={};b1.definePropertiesValues(i,e),super(i,e),b1.init(this)}add(e){const i=[];for(let s=0;s<arguments.length;s++){const r=arguments[s];!r.isUI||r.isBox?i.push(r):console.warn("Block element can only contain Box elements.",r)}return super.add(...i)}static definePropertiesValues(e,i){e.layouter=bre}static init(e){Object.defineProperties(e,{isBlock:{configurable:!1,enumerable:!0,value:!0}})}}class Are extends Ti{constructor(){super("textContent",null,!1)}update(e,i){e._glyphs._needsUpdate=!0,e._whiteSpace._needsProcess=!0}}class xre extends Ti{constructor(){super("inlines",null,!1),this._value=null}process(e){if(this._value=e._glyphs._value.map(i=>i.asInlineGlyph()),this._value.length){this._value[0].paddingLeft=e._padding._value.w,this._value[0].marginLeft=e._margin._value.w;const i=this._value.length-1;this._value[i].paddingRight=e._padding._value.y,this._value[i].marginRight=e._margin._value.y}e._fontSize._needsProcess=!0,e._lineBreak._needsProcess=!0,e._fontKerning._needsProcess=!0,e._layouter._needsProcess=!0}get value(){return this._value}}class wre extends Ti{constructor(){super("glyphs",null,!1),this._needsUpdate=!1,this._value=null}process(e){e._font._fontVariant&&e._font._fontVariant.isReady&&(this._value=e._whiteSpace._whiteSpacedContent.split("").map(i=>e._font._fontVariant.getTypographicGlyph(i)),this._value&&(e._inlines._needsProcess=!0))}get value(){return this._value}}class _re extends Fv{constructor(){super("color","inherit",!1),this.output=this._outputValue}computeOutputValue(e){this._input==="inherit"?this._value.set(this.getInheritedInput(e)):this._value.set(this._input)}}class e5 extends Ti{constructor(e=`- ,.:?!
`){super("lineBreak",e,!0),this._newLineBreakability=null}update(e,i){this._needsProcess=!0}process(e){const i=e._whiteSpace._newLineBreakability;if(e._inlines._value)for(let s=0;s<e._inlines._value.length;s++){const r=e._inlines._value[s],o=r.char;let a=null;o!==void 0&&(i!=="nowrap"&&(this._value.includes(o)||o.match(/\s/g))&&(a="possible"),o.match(/\n/g)&&(a=i)),r.lineBreak=a}}get value(){return this._value}}class t5 extends Ti{constructor(){super("layouter",null,!1),this._value=null}update(e,i){this._value=e._parent.find(s=>s.isUI&&s.isText),this._needsProcess=!0}process(e){this._value&&(this._value._layouter._needsProcess=!0)}}class Sre extends Fv{constructor(e){super("backgroundColor",e,!1),this._allowsInherit=!1,this._input=0}computeOutputValue(e){this._input==="inherit"?this._value.set(this.getInheritedInput(e)):this._value.set(this._input)}}class i5 extends OU{constructor(){super(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}}class n5 extends GU{constructor(){super()}computeOutputValue(e){this._value=_I(this.getInheritedInput(e))}}class s5 extends UU{constructor(){super("fontFamily","inherit",!0),this._input="inherit",this._needsUpdate=!0,this._allowsInherit=!1}computeOutputValue(e){let i=this._inheritedInput;if(i==="inherit"&&(i=this.getInheritedInput(e)),i instanceof y_)this._value=i,e._font._needsUpdate=!0;else if(typeof i=="string"){const s=qp.getFontFamily(i);s?(this._value=s,e._font._needsUpdate=!0):console.warn(`(.style) fontFamily, the font '${i}' is not registered. Aborted.`)}else console.warn("(.style) fontFamily requires a registered fontFamily instance, or the id of a registered fontFamily."),console.warn("If you want to set a specific font, please use .font property instead.")}get value(){return this._value}}class jI extends XU{constructor(){super(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited,this._whiteSpacedContent="",this._stringCollapser=this.emptyStrategyLogic,this._inlineCollapser=this.emptyStrategyLogic,this._inlineWrapper=this.emptyStrategyLogic}_computeFromInherited(e){switch(super._computeFromInherited(e),this._newLineBreakability=Cre(this._value),this._value){case"nowrap":case"normal":this._stringCollapser=Mre;break;case"pre-line":this._stringCollapser=o5;break;default:this._stringCollapser=Ere}switch(this._value){case"pre-line":case"nowrap":case"normal":this._inlineCollapser=Pre;break;case"pre-wrap":this._inlineCollapser=Lre;break;default:this._inlineCollapser=Bre}switch(this._value){case"pre-line":case"pre-wrap":case"normal":this._inlineWrapper=Tre;break;case"pre":this._inlineWrapper=Rre;break;default:this._inlineWrapper=Ire}this._needsProcess=!0}process(e){e.isInline&&!e.isInlineBlock&&(this._whiteSpacedContent=this._stringCollapser(e._textContent._value),e._glyphs._needsProcess=!0)}}const r5={"	":"	","\n":`
`,"\r":"\r"," ":" "},Cre=function(n){switch(n){case"pre":case"pre-wrap":case"pre-line":return"mandatory"}return null};function Mre(n){return o5(n.replace(/\n/g," "))}function o5(n){return n.replace(/[ ]{2,}/g," ")}function Ere(n){return n}function Tre(n,e,i,s){const r=n[e];if(r.lineBreak==="mandatory"||i+r.xadvance+r.xoffset+r.kerning>s.INNER_WIDTH)return!0;const o=c5(n,e,s);return kre(n[e-1],i,o,s)}function Rre(n,e,i,s){return n[e].lineBreak==="mandatory"}function Ire(){return!1}function Lre(n){if(!n[0])return 0;const e=n[0],i=n[n.length-1];return e.char&&e.char===`
`&&n.length>1&&l5([e],n[1]),i.char&&i.char===`
`&&n.length>1&&a5([i],n[n.length-2]),e.offsetX}function Pre(n){if(!n[0])return 0;let e=[],i;for(let s=0;s<n.length;s++){const r=n[s];if(r.char&&r5[r.char]&&n.length>s){e.push(r),i=n[s+1];continue}break}l5(e,i),e=[],i=null;for(let s=n.length-1;s>0;s--){const r=n[s];if(r.char&&r5[r.char]&&s>0){e.push(r),i=n[s-1];continue}break}return a5(e,i),n[0].offsetX}function Bre(n){return n[0]?n[0].offsetX:0}function a5(n,e){if(e)for(let i=0;i<n.length;i++){const s=n[i];s.fontFactor=0,s.offsetX=e.offsetX+e.cumulativeWidth,s.cumulativeWidth=0}}function l5(n,e){if(e)for(let i=0;i<n.length;i++){const s=n[i];s.fontFactor=0,s.offsetX=e.offsetX,s.cumulativeWidth=0}}function c5(n,e,i,s){if(s=s||0,!n[e])return s;const r=n[e];return r.lineBreak?s+r.xadvance:c5(n,e+1,i,s+r.xadvance+r.xoffset+r.kerning+i.LETTERSPACING)}function kre(n,e,i,s){return!n||!n.char||e+i<s.INNER_WIDTH?!1:s.BREAKON.indexOf(n.char)>-1}class h5 extends WU{constructor(){super(),this._input="inherit",this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}_computeFromInherited(e){super._computeFromInherited(e),e._fontSize._needsProcess=!0,e._layouter._needsProcess=!0}}class u5 extends fn{constructor(){super("fontSize","inherit",!0),this._allowsInherit=!1}computeOutputValue(e){this._value=this._inheritedInput,e._font._fontVariant&&(e._bounds._needsProcess=!0,e._layouter._needsProcess=!0)}process(e){if(!e._font._fontVariant||!e._font._fontVariant.isReady)return;const i=this._value/e._font._fontVariant.typographic.size,s=e._inlines._value;for(let r=0;r<s.length;r++){const o=s[r];o.resetOffsets(),o.fontSize=this._value,o.fontFactor=i}}get value(){return this._value}}class d5 extends HU{constructor(){super("segments",1,!1),this._notInheritedValue=void 0}update(e,i){this._notInheritedValue=this._value,this._notInheritedValue==="inherit"&&(this._notInheritedValue=this.getInheritedInput(e)),e._layouter._needsUpdate=!0}set value(e){this._value!==e&&(this._value=e,this._needsUpdate=!0)}get value(){return this._value==="inherit"?this._notInheritedValue:this._value}}class Dre extends d5{constructor(){super(),this._value="inherit"}}class Ore extends b_{constructor(){super(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}_computeFromInherited(e){super._computeFromInherited(e),e._parent._value._layouter._needsProcess=!1}process(e){if(this._value!=="none"){const i=e._whiteSpace._whiteSpacedContent,s=e._inlines._value;for(let r=1;r<s.length;r++){const o=i[r-1]+i[r];s[r].kerning=e._font._fontVariant.getKerningAmount(o)}}}}class p5 extends Ti{constructor(){super("children",null,!1),this._uis=[]}update(e,i){}process(e){}_compute(e){}dispose(){}}function Gre(n,e=!1){const i=n[0].index!==null,s=new Set(Object.keys(n[0].attributes)),r=new Set(Object.keys(n[0].morphAttributes)),o={},a={},l=n[0].morphTargetsRelative,c=new He.BufferGeometry;let h=0;for(let u=0;u<n.length;++u){const d=n[u];let m=0;if(i!==(d.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const f in d.attributes){if(!s.has(f))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+'. All geometries must have compatible attributes; make sure "'+f+'" attribute exists among all geometries, or in none of them.'),null;o[f]===void 0&&(o[f]=[]),o[f].push(d.attributes[f]),m++}if(m!==s.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". Make sure all geometries have the same number of attributes."),null;if(l!==d.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const f in d.morphAttributes){if(!r.has(f))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+".  .morphAttributes must be consistent throughout all geometries."),null;a[f]===void 0&&(a[f]=[]),a[f].push(d.morphAttributes[f])}if(e){let f;if(i)f=d.index.count;else if(d.attributes.position!==void 0)f=d.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". The geometry must have either an index or a position attribute"),null;c.addGroup(h,f,u),h+=f}}if(i){let u=0;const d=[];for(let m=0;m<n.length;++m){const f=n[m].index;for(let g=0;g<f.count;++g)d.push(f.getX(g)+u);u+=n[m].attributes.position.count}c.setIndex(d)}for(const u in o){const d=m5(o[u]);if(!d)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+u+" attribute."),null;c.setAttribute(u,d)}for(const u in a){const d=a[u][0].length;if(d===0)break;c.morphAttributes=c.morphAttributes||{},c.morphAttributes[u]=[];for(let m=0;m<d;++m){const f=[];for(let y=0;y<a[u].length;++y)f.push(a[u][y][m]);const g=m5(f);if(!g)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+u+" morphAttribute."),null;c.morphAttributes[u].push(g)}}return c}function m5(n){let e,i,s,r=-1,o=0;for(let h=0;h<n.length;++h){const u=n[h];if(e===void 0&&(e=u.array.constructor),e!==u.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(i===void 0&&(i=u.itemSize),i!==u.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(s===void 0&&(s=u.normalized),s!==u.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(r===-1&&(r=u.gpuType),r!==u.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;o+=u.count*i}const a=new e(o),l=new He.BufferAttribute(a,i,s);let c=0;for(let h=0;h<n.length;++h){const u=n[h];if(u.isInterleavedBufferAttribute){const d=c/i;for(let m=0,f=u.count;m<f;m++)for(let g=0;g<i;g++){const y=u.getComponent(m,g);l.setComponent(m+d,g,y)}}else a.set(u.array,c);c+=u.count*i}return r!==void 0&&(l.gpuType=r),l}class zre extends Ti{constructor(){super("renderer")}render(e){if(!e._inlines._value||!e._inlines._value.length)return;const i=e._inlines._value.map(r=>e._font._fontVariant.getGeometricGlyph(r,e).translate(r.offsetX,r.offsetY,0)),s=Gre(i);e.setFontMesh(new He.Mesh(s,e.fontMaterial)),e._fontMesh.renderOrder=1/0}}class Fre extends MI{constructor(){super(),this._allowsInherit=!1,this._needsUpdate=!1}computeOutputValue(e){this._value=this._inheritedInput,e._layouter._needsProcess=!0}}class Xy extends Nv{constructor(e={}){const i={};Xy.definePropertiesValues(i,e),super(i,e),p(this,"_rebuildParentUI",()=>{super._rebuildParentUI(),this._layouter._needsUpdate=!0}),Xy.init(this)}add(e){const i=[];for(let s=0;s<arguments.length;s++){const r=arguments[s];!r.isUI||r.isInline?(i.push(r),r.position.z=.005):console.warn("Block element can only contain Box elements.",r)}return super.add(...i)}set textContent(e){this._textContent.value=e}get textContent(){return this._textContent._value}set invertAlpha(e){this._invertAlpha.value=e}get invertAlpha(){return this._invertAlpha._value}static definePropertiesValues(e,i){e.children||(e.children=p5),e.textContent||(e.textContent=Are),e.glyphs||(e.glyphs=wre),e.inlines||(e.inlines=xre),e.layouter||(e.layouter=t5),e.renderer||(e.renderer=zre),e.fontFamily||(e.fontFamily=s5),e.fontWeight||(e.fontWeight=n5),e.fontStyle||(e.fontStyle=i5),e.fontSize||(e.fontSize=u5),e.color||(e.color=_re),e.backgroundColor||(e.backgroundColor=Sre),e.lineBreak||(e.lineBreak=e5),e.letterSpacing||(e.letterSpacing=h5),e.whiteSpace||(e.whiteSpace=jI),e.segments||(e.segments=Dre),e.textAlign||(e.textAlign=Fre),e.fontKerning||(e.fontKerning=Ore)}static init(e){Object.defineProperties(e,{isInline:{configurable:!1,enumerable:!0,value:!0}})}}class Nre extends DU{constructor(){super("textContent",null,!1),this._needsUpdate=!1}set value(e){this._value!==e&&(this._value=e,this._needsUpdate=!0)}update(e,i){this._needsUpdate=!1;for(let s=e.children.length-1;s>=0;s--){const r=e.children[s];r.isUI&&(e.remove(r),r.clear())}e._children._uis=[],this._value&&e.add(new Xy({name:"anonymousInline",textContent:this._value}))}}class Ure extends Array{constructor(...e){super(...e),this.width=0,this.height=0}}class Vre extends Ti{constructor(){super("layouter",null,!1),this._value=null}update(e,i){}process(e){let i=e._width._value;e._width._auto?i=1/0:i=e._bounds._innerWidth;const s=e._lineHeight._value,r=new Ure(new $U);let o=0;e._children._inlines.forEach(d=>{if(!d._inlines.value)return;this._resetInlines(d);const m=d._fontSize._value,f=d._letterSpacing._value*m,g=d._whiteSpace._value,y=d._lineBreak._value,v={WHITESPACE:g,LETTERSPACING:f,BREAKON:y,INNER_WIDTH:i},b=d._whiteSpace._inlineWrapper;o+=d._margin._value.w+d._padding._value.w,d._inlines.value.forEach((A,x,w)=>{const _=r[r.length-1];if(b(w,x,o,v)){if(r.push(new $U(A)),A.offsetX=A.xoffset,A.width===0){o=0;return}A.cumulativeWidth=A.xadvance+f,o=A.cumulativeWidth;return}r[r.length-1].push(A),A.offsetX=o+A.xoffset+A.kerning,A.cumulativeWidth=A.xadvance+A.kerning+f,o+=A.cumulativeWidth,_.length-1===1&&_[_.length-2].width===0&&(A.offsetX-=A.xoffset,o-=A.xoffset)}),o+=d._margin._value.y+d._padding._value.y});const a=e._whiteSpace._inlineCollapser;let l=0,c=0,h=0;r.forEach((d,m)=>{const f=a(d);let g=0,y=0;if(d.forEach(v=>{g=Math.max(g,v.lineHeight),y=Math.max(y,v.lineBase),v.offsetX-=f}),d.lineHeight=g,d.lineBase=y,m===0?h=-(g*s-g)*.5:h-=r[m-1].lineHeight*s,d.y=h,d.x=0,d.forEach(v=>{v.offsetY=h-v.anchor,v.lineHeight<d.lineHeight&&(v.offsetY-=d.lineBase-v.lineBase)}),c+=d.lineHeight*s,d.width=0,d[0]){const v=d[d.length-1];d.width=v.offsetX+v.cumulativeWidth+v.paddingRight+v.marginRight+d[0].offsetX,l=Math.max(l,d.width)}}),r.height=c,r.width=l,this._value=r,i===1/0&&e._bounds.setChildrenWidth(e,r.width),e._height._auto&&e._bounds.setChildrenHeight(e,r.height);const u=e._parent._value;u&&(u._autoSize._needsProcess=!0,u._flexDirection._needsProcess=!0),e._inlineJustificator._needsProcess=!0,e._textAlign._needsProcess=!0,e._overflow._needsUpdate=!0}_resetInlines(e){e._fontSize.process(e)}}class Xre extends MI{constructor(){super(),this._allowsInherit=!1,this._needsUpdate=!0}computeOutputValue(e){this._value=this._inheritedInput,this._needsProcess=!0}process(e){Wre(e),e._renderer._needsRender=!0}}function Wre(n){const e=n._layouter._value,i=n._textAlign._value,s=n._bounds._innerWidth;for(let r=0;r<e.length;r++){const o=e[r],a=Hre(n,o,r===e.length-1),l=n._padding._value,c=n._borderWidth._value,h=(-l.w+l.y)/2+(-c.w+c.y)/2;o.x+=a;for(let u=0;u<o.length;u++)o[u].offsetX+=a-h}if(i.indexOf("justify")===0)for(let r=0;r<e.length;r++){const o=e[r];if(i.indexOf("-")!==-1&&r===e.length-1)return;const a=s-o.width;if(a<=0)return;let l=0;for(let d=1;d<o.length-1;d++)l+=o[d].char===" "?1:0;const c=a/l;let h=1;i==="justify-right"&&(o.reverse(),h=-1);let u=0;for(let d=1;d<=o.length-1;d++){const m=o[d];m.offsetX+=u*h,u+=m.char===" "?c:0}i==="justify-right"&&o.reverse()}}function Hre(n,e,i){switch(n._textAlign._value){case"justify-left":case"justify":case"left":return-n._bounds._innerWidth/2;case"justify-right":case"right":return-e.width+n._bounds._innerWidth/2;case"center":return-e.width/2;case"justify-center":return i?-e.width/2:-n._bounds._innerWidth/2;default:console.warn(`textAlign: '${n._textAlign._value}' is not valid`)}}class jre extends EI{constructor(){super(),this._value=this._input="column",this._allowsInherit=!1,this._needsUpdate=!0}computeOutputValue(e){this._value=this._inheritedInput}}class Qre extends VU{constructor(){super(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}}class Zre extends b_{constructor(){super(),this._value=this._input=this.getDefaultValue(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}_computeFromInherited(e){super._computeFromInherited(e)}}class Yre extends YU{constructor(){super(),this._innerWidth=1/0,this._innerHeight=0}}class Kre extends Ti{constructor(){super("children",null,!1),p(this,"_sortOrder",(e,i)=>e._order._value<i._order._value?-1:e._order._value>i._order._value?1:this._uis.indexOf(e)<this._uis.indexOf(i)?-1:1),this._uis=[],this._inlines=[],this._boxes=[]}update(e,i){this._compute(e),this._needsProcess=!0}process(e){this._compute(e),e._overflow._needsRender=!0}_compute(e){this._uis=e.children.filter(i=>i.visible&&i.isUI),this._inlines=this._uis.filter(i=>i.isInline).sort(this._sortOrder)}dispose(){this._inlines=null}}class Jre extends Ti{constructor(){super("autosize")}process(e){if(e._layouter._value&&e._layouter._value.length){const i=e._layouter._value,s=e._padding._value,r=e._borderWidth._value;e._width._auto&&e._bounds.setOffsetWidth(e,i.width+s.w+s.y+r.w+r.y),e._height._auto&&e._bounds.setOffsetHeight(e,i.height+s.x+s.z+r.x+r.z)}}}class qre extends qU{constructor(){super("renderer"),this._needsUpdate=!1}render(e){super.render(e);for(const i of e._children._inlines)i._renderer.render(i);e.performAfterUpdate()}}class A1 extends v1{constructor(e={},i={}){A1.definePropertiesValues(i,e),super(i,e),A1.init(this)}add(e){const i=[];let s=!1;for(let r=0;r<arguments.length;r++){const o=arguments[r];!o.isUI||o.isInline?(o.isInline&&(s=!0),i.push(o)):console.warn("Block element can only contain Box elements.",o)}return i.length>0&&super.add(...i),s&&(this._children._needsUpdate=!0,this._layouter._needsProcess=!0),this}set textContent(e){this._textContent.value=e}get textContent(){return super.textContent}set invertAlpha(e){this._invertAlpha.value=e}get invertAlpha(){return this._invertAlpha._value}get lines(){return this._layouter._value}static definePropertiesValues(e,i){e.flexDirection=jre,e.justifyContent=TI,e.alignItems=CI,e.bounds=Yre,e.autoSize=Jre,e.renderer=qre,e.children||(e.children=Kre),e.textContent||(e.textContent=Nre),e.layouter||(e.layouter=Vre),e.lineHeight||(e.lineHeight=Qre),e.textAlign||(e.textAlign=Xre),e.whiteSpace||(e.whiteSpace=jI),e.fontKerning||(e.fontKerning=Zre),e.segments||(e.segments=d5),i.width||(i.width="100%"),i.fontSide||(i.fontSide=0)}static init(e){Object.defineProperties(e,{isText:{configurable:!1,enumerable:!0,value:!0}})}}class $re extends Ti{constructor(){super("inlines",null,!1),this._value=[]}process(e){this._value[0].paddingLeft=e._padding._value.w,this._value[0].marginLeft=e._margin._value.w;const i=this._value.length-1;this._value[i].paddingRight=e._padding._value.y,this._value[i].marginRight=e._margin._value.y}}class eoe extends Ti{constructor(){super("renderer")}render(e){e._backgroundMesh||e.setBackgroundMesh(new JU(e)),e._backgroundMesh.position.x=e._inlines._value[0].offsetX+e._inlines._value[0].width/2,e._backgroundMesh.position.y=e._inlines._value[0].offsetY+e._inlines._value[0].lineBase/2,e._bounds.render(e)}}class toe extends Ti{constructor(){super("bounds",null,!1),this._size=new He.Vector3(1,1,1),this._offsetWidth=0,this._offsetHeight=0,this._innerWidth=0,this._innerHeight=0}update(e,i){this.output(i),this._needsProcess=!0}process(e){this._offsetWidth=this._innerWidth=e._inlines._value[0].width,this._offsetHeight=this._innerHeight=e._inlines._value[0].height,this._needsRender=!0,e._borderWidth._needsRender=!0,e._borderRadius._needsRender=!0}render(e){this._size.x=this._offsetWidth,this._size.y=this._offsetHeight}output(e){e.size=this._size}}class x1 extends Nv{constructor(e={}){const i={};x1.definePropertiesValues(i,e),super(i,e),x1.init(this)}clear(){for(const e of this._inlines._value)e.clear();return super.clear()}bindBackgroundMeshProperties(){this._backgroundMesh.raycast=()=>{},this._bounds._size=this._backgroundMesh.scale,this._bounds._needsUpdate=!0}unbindBackgroundMeshProperties(){this._bounds._size=new He.Vector3(1,1,1),this._bounds._needsUpdate=!0}add(e){const i=[];for(let s=0;s<arguments.length;s++){const r=arguments[s];r.isUI?console.warn("ThreeMeshUI::InlineBlockElement cannot contains UI Elements.",r):(i.push(r),r.position.z=.005)}return super.add(...i)}static definePropertiesValues(e,i){e.children||(e.children=p5),e.bounds||(e.bounds=toe),e.inlines||(e.inlines=$re),e.layouter||(e.layouter=t5),e.renderer||(e.renderer=eoe),e.fontFamily||(e.fontFamily=s5),e.fontWeight||(e.fontWeight=n5),e.fontStyle||(e.fontStyle=i5),e.fontSize||(e.fontSize=u5),e.backgroundColor||(e.backgroundColor=PU),e.lineBreak||(e.lineBreak=e5),e.letterSpacing||(e.letterSpacing=h5),e.whiteSpace||(e.whiteSpace=jI),e.fontKerning||(e.fontKerning=b_),i.backgroundSize||(i.backgroundSize="cover"),i.width||(i.width="100%"),i.height||(i.height="100%"),i.boxSizing||(i.boxSizing="border-box")}static init(e){Object.defineProperties(e,{isInline:{configurable:!1,enumerable:!0,value:!0},isInlineBlock:{configurable:!1,enumerable:!0,value:!0}}),e._inlines._value=[new ioe(e)],e.backgroundMaterial=new ZU,e._renderer.render(e)}}class ioe extends EU{constructor(e){super(),this._uiElement=e}get xadvance(){const e=this._uiElement._padding._value,i=this._uiElement._width;return i._relative?i._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):e.w+e.y+i.value}get width(){const e=this._uiElement._width;return e._relative?e._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):e.value}get height(){const e=this._uiElement._height;return e._relative?e._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):e.value}get anchor(){return this.height}get lineHeight(){const e=this._uiElement._height;return e._relative?e._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):e.value}get lineBase(){const e=this._uiElement._height;return e._relative?e._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):e.value}clear(){this._uiElement=null}}class f5{constructor(e){this._subject=e}attach(){console.error(`Behavior::attach() - Is abstract and therefore should be overridden in ${this.constructor.name}`)}act(){throw new Error(`Behavior::act() - Is abstract and therefore should be overridden in ${this.constructor.name}`)}detach(){console.error(`Behavior::detach() - Is abstract and therefore should be overridden in ${this.constructor.name}`)}clear(){}}const g5=()=>x_.update(),y5={BaseProperty:Ti,Block:b1,Text:A1,Inline:Xy,InlineBlock:x1,MeshUIBaseElement:Nv,FontLibrary:qp,update:g5,MSDFFontMaterialUtils:ul,ShaderChunkUI:QU,Behavior:f5,FontVariant:zv};typeof global<"u"&&(global.ThreeMeshUI=y5);const noe=y5;var soe=ts.ti,v5=ts.nS,QI=ts.eB,roe=ts.Yp,ZI=ts.VB,ooe=ts.BC,aoe=ts.zN,__=ts.cV,loe=ts.hW,coe=ts.k2,hoe=ts.K6,uoe=ts.M7,doe=ts.ls,poe=ts.Hi,YI=ts.EY,moe=ts.MR,foe=ts.zf,Xi=ts.Ay,b5=ts.yo;const A5=Object.freeze(Object.defineProperty({__proto__:null,BaseProperty:soe,Behavior:v5,Block:QI,DefaultValues:roe,FontLibrary:ZI,FontVariant:ooe,InheritableProperty:aoe,Inline:__,InlineBlock:loe,InlineGlyph:coe,MSDFFontMaterialUtils:hoe,MaterialTransformers:uoe,MeshUIBaseElement:doe,ShaderChunkUI:poe,Text:YI,TypographicFont:moe,TypographicGlyph:foe,default:Xi,update:b5},Symbol.toStringTag,{value:"Module"}));class goe{constructor(){p(this,"Rad2Deg",180/Math.PI),p(this,"Deg2Rad",Math.PI/180),p(this,"Epsilon",1e-5)}random(e,i){return Array.isArray(e)?e.length<=0?null:e[Math.floor(Math.random()*e.length)]:e!==void 0&&i!==void 0?Math.random()*(i-e)+e:Math.random()}randomVector3(e,i=0,s=1){e.x=this.random(i,s),e.y=this.random(i,s),e.z=this.random(i,s)}clamp(e,i,s){return e<i?i:e>s?s:e}clamp01(e){return this.clamp(e,0,1)}lerp(e,i,s){return s=s<0?0:s,s=s>1?1:s,e+(i-e)*s}inverseLerp(e,i,s){return(s-e)/(i-e)}remap(e,i,s,r,o){return r+(o-r)*(e-i)/(s-i)}moveTowards(e,i,s){return e+=s,(s<0&&e<i||s>0&&e>i)&&(e=i),e}toDegrees(e){return e*180/Math.PI}toRadians(e){return e*Math.PI/180}tan(e){return Math.tan(e)}gammaToLinear(e){return Math.pow(e,2.2)}linearToGamma(e){return Math.pow(e,1/2.2)}approximately(e,i,s=Number.EPSILON){for(const r of yoe){const o=e[r],a=i[r];if(o===void 0||a===void 0)break;if(Math.abs(o-a)>s)return!1}return!0}easeInOutCubic(e){return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2}}const yoe=["x","y","z","w"],tt=new goe;class x5{constructor(e){p(this,"y"),p(this,"s"),p(this,"alpha",0),this.setAlpha(e),this.y=null,this.s=null}setAlpha(e){if(e<=0||e>1)throw new Error;this.alpha=e}filter(e,i){i&&this.setAlpha(i);let s;return this.y?s=this.alpha*e+(1-this.alpha)*this.s:s=e,this.y=e,this.s=s,s}lastValue(){return this.y}reset(e){this.y=e,this.s=e}}class S_{constructor(e,i=1,s=0,r=1){if(p(this,"freq"),p(this,"minCutOff"),p(this,"beta"),p(this,"dCutOff"),p(this,"x"),p(this,"dx"),p(this,"lasttime"),e<=0||i<=0||r<=0)throw new Error;this.freq=e,this.minCutOff=i,this.beta=s,this.dCutOff=r,this.x=new x5(this.alpha(this.minCutOff)),this.dx=new x5(this.alpha(this.dCutOff)),this.lasttime=null}alpha(e){const i=1/this.freq;return 1/(1+1/(2*Math.PI*e)/i)}filter(e,i=null){this.lasttime&&i&&(this.freq=1/(i-this.lasttime)),this.lasttime=i;const s=this.x.lastValue(),r=s?(e-s)*this.freq:0,o=this.dx.filter(r,this.alpha(this.dCutOff)),a=this.minCutOff+this.beta*Math.abs(o);return this.x.filter(e,this.alpha(a))}reset(e){e!=null&&this.x.reset(e),this.x.alpha=this.alpha(this.minCutOff),this.dx.alpha=this.alpha(this.dCutOff),this.lasttime=null}}class KI{constructor(e,i=1,s=0,r=1){p(this,"x"),p(this,"y"),p(this,"z"),this.x=new S_(e,i,s,r),this.y=new S_(e,i,s,r),this.z=new S_(e,i,s,r)}filter(e,i,s=null){i.x=this.x.filter(e.x,s),i.y=this.y.filter(e.y,s),i.z=this.z.filter(e.z,s)}reset(e){this.x.reset(e?.x),this.y.reset(e?.y),this.z.reset(e?.z)}}class yg extends pe{constructor(e,i,s,r=128){if(i<=0||s<=0||r<=0)throw new Error("GroundedSkybox height, radius, and resolution must be positive.");const o=new al(s,2*r,r);o.scale(1,1,-1);const a=o.getAttribute("position"),l=new E;for(let c=0;c<a.count;++c)if(l.fromBufferAttribute(a,c),l.y<0){const h=-i*3/2,u=l.y<h?-i/l.y:1-l.y*l.y/(3*h*h);l.multiplyScalar(u),l.toArray(a.array,3*c)}a.needsUpdate=!0,super(o,new Qt({map:e,depthWrite:!1}))}}const C_="needle:cameraController";function w5(n){return n[C_]}function JI(n,e,i){i?n[C_]=e:n[C_]===e&&(n[C_]=null)}const qI="needle:autofit";function _5(n){return n[qI]===void 0?!0:n[qI]!==!1}function $I(n,e){n[qI]=e}function voe(n,e,i){const s=n.length(),r=e.length(),o=tt.lerp(s,r,i);return n.lerp(e,i).normalize().multiplyScalar(o)}const eL=new Se,S5=new Se().setFromAxisAngle(new E(0,1,0),Math.PI);function boe(n,e){n.lookAt(e),n.quaternion.multiply(S5)}function Uv(n,e,i=!0,s=!1){if(n===e)return;eL.copy(n.quaternion);const r=zt(e),o=zt(n);if(s){if(La(n,ki(e)),i){const a=o.y,l=o.sub(sL(n));l.y=a,n.lookAt(l),n.quaternion.multiply(S5)}Number.isNaN(n.quaternion.x)&&n.quaternion.copy(eL);return}i&&(r.y=o.y),n.lookAt(r),Number.isNaN(n.quaternion.x)&&n.quaternion.copy(eL)}const Aoe=new Qo(()=>new E,100);function mt(n,e,i){const s=Aoe.get();return s.set(0,0,0),n instanceof E?s.copy(n):Array.isArray(n)?s.set(n[0],n[1],n[2]):n instanceof DOMPointReadOnly?s.set(n.x,n.y,n.z):typeof n=="number"?(s.x=n,s.y=e!==void 0?e:s.x,s.z=i!==void 0?i:s.x):typeof n=="object"&&(s.x=n.x,s.y=n.y,s.z=n.z),s}const xoe=new Qo(()=>new Ae,30);function C5(n){const e=xoe.get();return n?e.copy(n):e.set(0,0,0),e}const woe=new Qo(()=>new Se,100);function bl(n){const e=woe.get();return e.identity(),n instanceof Se?e.copy(n):n instanceof DOMPointReadOnly&&e.set(n.x,n.y,n.z,n.w),e}const tL=new Qo(()=>new E,100),M5=Symbol("lastMatrixWorldUpdateKey");function zt(n,e=null,i=!0){const s=e??tL.get();return n?n.parent?(i&&n.updateWorldMatrix(!0,!1),n.matrixWorldNeedsUpdate&&n[M5]!==Date.now()&&(n[M5]=Date.now(),n.updateMatrixWorld()),s.setFromMatrixPosition(n.matrixWorld),s):s.copy(n.position):s.set(0,0,0)}function bs(n,e){if(!n)return n;const i=tL.get();return e!==i&&i.copy(e),(n?.parent??n).worldToLocal(i),n.position.set(i.x,i.y,i.z),n}function $p(n,e,i,s){const r=tL.get();return r.set(e,i,s),bs(n,r),n}const M_=new Qo(()=>new Se,100),em=new Se,iL=new Se;function ki(n,e=null){if(!n)return M_.get().identity();const i=e??M_.get();return n.parent?(n.getWorldQuaternion(i),i):i.copy(n.quaternion)}function La(n,e){if(!n)return;e!==em&&em.copy(e);const i=em,s=n?.parent;s?.getWorldQuaternion(iL),iL.invert();const r=iL.multiply(i);n.quaternion.set(r.x,r.y,r.z,r.w)}function nL(n,e,i,s,r){em.set(e,i,s,r),La(n,em)}const _oe=new Qo(()=>new E,100),Soe=new E;function Qi(n,e=null){return e||(e=_oe.get()),n?n.parent?(n.getWorldScale(e),e):e.copy(n.scale):e.set(0,0,0)}function vg(n,e){if(!n)return;if(!n.parent){n.scale.copy(e);return}const i=Soe;n.parent.getWorldScale(i),n.scale.copy(e),n.scale.divide(i)}const Coe=new E,E5=new Se;function Moe(n){return ki(n,E5),Coe.set(0,0,1).applyQuaternion(E5)}const Eoe=new Qo(()=>new E,100),T5=new Se;function sL(n,e){return e||(e=Eoe.get().set(0,0,1)),ki(n,T5),e.applyQuaternion(T5)}const R5=new si,I5=new si,Toe=new E;function rL(n){const e=M_.get();return n.getWorldQuaternion(e),I5.setFromQuaternion(e),I5}function oL(n,e){const i=M_.get();La(n,i.setFromEuler(e))}function Vv(n){const e=rL(n),i=Toe;return i.set(e.x,e.y,e.z),i.x=tt.toDegrees(i.x),i.y=tt.toDegrees(i.y),i.z=tt.toDegrees(i.z),i}function aL(n,e){Xv(n,e.x,e.y,e.z,!0)}function Xv(n,e,i,s,r=!0){r&&(e=tt.toRadians(e),i=tt.toRadians(i),s=tt.toRadians(s)),R5.set(e,i,s),em.setFromEuler(R5),La(n,em)}function E_(n,e=!0){n&&(e?function i(s){console.groupCollapsed((s.name?s.name:"(no name : "+s.type+")")+" %o",s),s.children.forEach(i),console.groupEnd()}(n):n.traverse(function(i){for(var s="|___",r=i;r.parent!==null;)s="	"+s,r=r.parent;console.log(s+i.name+" <"+i.type+">")}))}function Roe(n){let e=n?.name||"";if(!n)return e;let i=n.parent;for(;i;)e=i.name+"/"+e,i=i.parent;return e}function L5(n){if(n){const e=n;return e.blendMode!==void 0&&e.clampWhenFinished!==void 0&&e.enabled!==void 0&&e.fadeIn!==void 0&&e.getClip!==void 0}return!1}class Pa{static createBlitMaterial(e){return new kt({uniforms:{map:new Ce(null)},vertexShader:this.vertex,fragmentShader:e})}static copyTexture(e,i){const s=i??this.blipMaterial;s.uniforms.map.value=e,s.needsUpdate=!0,s.uniformsNeedUpdate=!0,this.blipMaterial||(this.blipMaterial=new kt({uniforms:{map:new Ce(null)},vertexShader:this.vertex,fragmentShader:this.fragment}));const r=s.vertexShader;s.vertexShader=this.vertex,this.mesh||(this.mesh=new pe(this.planeGeometry,this.blipMaterial));const o=this.mesh;o.material=s,o.frustumCulled=!1,this.scene.children.length=0,this.scene.add(o),this.renderer||(this.renderer=new gh({antialias:!1})),this.renderer.setSize(e.image.width,e.image.height),this.renderer.clear(),this.renderer.render(this.scene,this.perspectiveCam);const a=new Vt(this.renderer.domElement);return a.name="Copy",a.needsUpdate=!0,s.vertexShader=r,a}static textureToCanvas(e,i){if(!e)return null;(i===!0||e.isCompressedTexture===!0)&&(e=P5(e));const s=e.image;if(Loe(s)){const r=document.createElement("canvas");r.width=s.width,r.height=s.height;const o=r.getContext("2d");return o?(o.drawImage(s,0,0,s.width,s.height,0,0,r.width,r.height),r):(console.error("Failed getting canvas 2d context"),null)}return null}}p(Pa,"planeGeometry",new ds(2,2,1,1)),p(Pa,"renderer"),p(Pa,"perspectiveCam",new Lt),p(Pa,"scene",new Ls),p(Pa,"vertex",`
    varying vec2 vUv;
    void main(){
        vUv = uv;
        gl_Position = vec4(position.xy * 1.0,0.,.999999);
    }`),p(Pa,"fragment",`
    uniform sampler2D map; 
    varying vec2 vUv;
    void main(){ 
        vec2 uv = vUv;
        uv.y = 1.0 - uv.y;
        gl_FragColor = texture2D( map, uv);
        // gl_FragColor = vec4(uv.xy, 0, 1);
    }`),p(Pa,"blipMaterial"),p(Pa,"mesh");function P5(n){return Pa.copyTexture(n)}function Ioe(n,e=!1){return Pa.textureToCanvas(n,e)}function Loe(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas||typeof ImageBitmap<"u"&&n instanceof ImageBitmap}function Poe(n){const e=n.type;return e==="Mesh"||e==="SkinnedMesh"}function lL(n,e){e?n["needle:rendercustomshadow"]=!0:n["needle:rendercustomshadow"]=!1}function B5(n){return!!(n&&(n["needle:rendercustomshadow"]===!0||n["needle:rendercustomshadow"]==null))}function Ba(n,e=void 0,i=void 0,s=void 0){const r=s||new Wt;r.makeEmpty();const o=[];function a(c){let h=!0;if(c.visible&&_5(c)!==!1&&!(c.type==="TransformControlsGizmo"||c.type==="TransformControlsPlane")){if(c instanceof rI&&(h=!1),c instanceof t_&&(h=!1),c instanceof yg&&(h=!1),c.isGizmo===!0&&(h=!1),c.material instanceof Uw&&(h=!1),Poe(c)||(h=!1),i&&c.layers.test(i)===!1&&(h=!1),h&&(e&&Array.isArray(e)&&e!=null&&e.includes(c)||typeof e=="function"&&e(c)===!0))return;if(c.isUI!==!0){if(h){const u=c.children;c.children=o;const d=c.position,m=c.scale;if(Number.isNaN(d.x)||Number.isNaN(d.y)||Number.isNaN(d.z)){console.warn(`Object "${c.name}" has NaN values in position or scale.... will ignore it`,d,m);return}r.expandByObject(c,!0),c.children=u}for(const u of c.children)a(u)}}}let l=!1;for(const c of n)c&&(l=!0,c.updateMatrixWorld(),a(c));return l||console.warn("No objects to fit camera to..."),r}function k5(n,e,i){const s=Ba([n],i?.ignore),r=new E;s.getSize(r);const o=new E;s.getCenter(o);const a=new E;e.getSize(a);const l=new E;e.getCenter(l);const c=new E;c.set(a.x/r.x,a.y/r.y,a.z/r.z);const h=Math.min(c.x,c.y,c.z),u=i?.scale!==!1;if(u&&vg(n,Qi(n).multiplyScalar(h)),i?.position!==!1){const d=new E;s.getCenter(d),d.y=s.min.y;const m=new E;e.getCenter(m),m.y=e.min.y;const f=m.clone().sub(d);u&&f.multiplyScalar(h),bs(n,zt(n).add(f))}return{boundsBefore:s,scale:c}}function D5(n,e){const i=Ba([n]),s=new E;i.getCenter(s),s.y=i.min.y;const r=e.clone().sub(s),o=zt(n);return bs(n,o.add(r)),{offset:r,bounds:i}}function cL(n,e,i,s){if(Array.isArray(e)){let a=!0;for(let l=0;l<e.length;l++)cL(n,e[l],l,e)||(a=!1);return a}if(e.type==="MeshStandardMaterial")return!1;if(e["material:fbx"]!=null)return!0;const r=new vs;r["material:fbx"]=e;const o=e;return o&&(o.map?r.color.set(1,1,1):r.color.copyLinearToSRGB(o.color),r.emissive.copyLinearToSRGB(o.emissive),r.emissiveIntensity=o.emissiveIntensity,r.opacity=o.opacity,r.displacementScale=o.displacementScale,r.transparent=o.transparent,r.bumpMap=o.bumpMap,r.aoMap=o.aoMap,r.map=o.map,r.displacementMap=o.displacementMap,r.emissiveMap=o.emissiveMap,r.normalMap=o.normalMap,r.envMap=o.envMap,r.alphaMap=o.alphaMap,r.metalness=o.reflectivity,o.shininess&&(r.roughness=1-Math.sqrt(o.shininess)/10),r.needsUpdate=!0),i===void 0?n.material=r:s[i]=r,!0}let T_=!1;kie((...n)=>{var e;Ye()&&(e=yi.Current)!=null&&e.isInXR&&(tm(!0),O5("error",...n))});function tm(n){if(n){if(T_)return;T_=!0,koe()}else{if(!T_)return;T_=!1,Doe()}}const Wv={log:void 0,warn:void 0,error:void 0};class Boe{constructor(){p(this,"familyName","needle-xr"),p(this,"root",null),p(this,"context",null),p(this,"defaultFontSize",.06),p(this,"targetObject",new ye),p(this,"userForwardViewPoint",new E),p(this,"oneEuroFilter",new KI(90,.8)),p(this,"_lastElementRemoveTime",0),p(this,"onBeforeRender",()=>{var e,i;const s=(e=this.context)==null?void 0:e.mainCamera;if(this.context&&s instanceof Lt){const r=this.getRoot();Number.isNaN(r.position.x)&&r.position.set(0,0,0),Number.isNaN(r.quaternion.x)&&r.quaternion.set(0,0,0,1),this.context.scene.add(this.targetObject);const o=((i=this.context.xr)==null?void 0:i.rigScale)??1,a=3.5*o,l=s.worldForward;l.y=0,l.normalize().multiplyScalar(a),this.userForwardViewPoint.copy(s.worldPosition).sub(l),this.targetObject.position.distanceTo(this.userForwardViewPoint)>2*o&&(this.targetObject.position.copy(this.userForwardViewPoint),Uv(this.targetObject,s,!0,!0),this.targetObject.rotateY(Math.PI)),this.oneEuroFilter.filter(this.targetObject.position,r.position,this.context.time.time);const c=this.context.time.deltaTime;if(r.quaternion.slerp(this.targetObject.quaternion,c*5),r.scale.setScalar(o),this.targetObject.removeFromParent(),this.context.scene.add(r),this.context.time.time-this._lastElementRemoveTime>.1){this._lastElementRemoveTime=this.context.time.time;const h=Date.now();for(let u=0;u<this._activeTexts.length;u++){const d=this._activeTexts[u];if(d instanceof Xi.Text&&h-d._activatedTime>2e4){d.removeFromParent(),this._textBuffer.push(d),this._activeTexts.splice(u,1);break}}}}}),p(this,"textOptions",{fontSize:this.defaultFontSize,fontFamily:this.familyName,padding:.03,margin:.005,color:0,backgroundColor:16777215,backgroundOpacity:.4,borderRadius:.03,offset:.025}),p(this,"_textBuffer",[]),p(this,"_activeTexts",[]),this.ensureFont()}onEnable(){this.context=yi.Current||yi.All[0],this.context.pre_render_callbacks.push(this.onBeforeRender)}onDisable(){var e,i,s;(i=this.context)==null||i.pre_render_callbacks.splice((e=this.context)==null?void 0:e.pre_render_callbacks.indexOf(this.onBeforeRender),1),(s=this.root)==null||s.removeFromParent()}addLog(e,i){const s=this.getRoot(),r=this.getText();let o=16777215,a=0;switch(e){case"log":o=16777215,a=0;break;case"warn":o=16772761,a=4465152;break;case"error":o=16755370,a=7798784;break}i.length>1e3&&(i=i.substring(0,1e3)+"...");const l=new Date().toISOString().split("T")[1].split(".")[0];r.textContent="["+l+"] "+i,r.visible=!0,r._activatedTime=Date.now(),s.add(r),this._activeTexts.push(r),this.context&&this.context.scene.add(s),r.set({backgroundColor:o,color:a}),Xi.update()}ensureFont(){let e=Xi.FontLibrary.getFontFamily(this.familyName);if(!e){e=Xi.FontLibrary.addFontFamily(this.familyName);const i=e.addVariant("normal","normal","./include/needle/arial-msdf.json","./include/needle/arial.png");i?.addEventListener("ready",()=>{Xi.update()})}}getText(){const e=this.getRoot();if(this._textBuffer.length>0){const s=this._textBuffer.pop();return s.visible=!0,setTimeout(()=>this.disableDepthTestRecursive(s),100),s}if(e.children.length>20&&this._activeTexts.length>0)return this._activeTexts.shift();const i=new Xi.Text(this.textOptions);return setTimeout(()=>this.disableDepthTestRecursive(i),500),setTimeout(()=>this.disableDepthTestRecursive(i),1500),i}disableDepthTestRecursive(e,i=0){for(let r=0;r<e.children.length;r++){const o=e.children[r];o instanceof ye&&this.disableDepthTestRecursive(o,i+1)}e.renderOrder=10*i,e.layers.set(2);const s=e.material;s&&(s.depthWrite=!1,s.depthTest=!1,s.transparent=!0),i===0&&Xi.update()}getRoot(){if(this.root)return this.root;const e=this.defaultFontSize,i={boxSizing:"border-box",fontFamily:this.familyName,width:"2.6",fontSize:e,color:0,lineHeight:1,backgroundColor:16777215,backgroundOpacity:0,whiteSpace:"pre-wrap",flexDirection:"column-reverse"};return this.root=new Xi.Block(i),this.root}}let Al=null;function koe(){Al||(Al=new Boe),Al.onEnable();for(const n in Wv){Wv[n]=console[n];let e=!1;console[n]=function(){var i;if((i=Wv[n])==null||i.apply(console,arguments),!e)try{e=!0,O5(n,...arguments)}finally{e=!1}}}}function Doe(){Al?.onDisable();for(const n in Wv)console[n]=Wv[n]}const Hv=new Map;function O5(n,...e){try{switch(Hv.clear(),n){case"log":Al?.addLog("log",i());break;case"warn":Al?.addLog("warn",i());break;case"error":Al?.addLog("error",i());break}}catch(o){console.error("Error in spatial console",o)}finally{Hv.clear()}function i(){let o="";for(let a=0;a<e.length;a++){const l=e[a];o+=s(l),a<e.length-1&&(o+=", ")}return o}function s(o,a=0){if(typeof o=="string")return'"'+o+'"';if(typeof o=="number"){if(o%1!==0){const l=o.toFixed(5),c=l.indexOf(".");let h=l.length-1;for(;h>c&&l[h]==="0";)h--;return l.substring(0,h+1)}return o.toString()}else if(Array.isArray(o)){let l="[";for(let c=0;c<o.length;c++){const h=o[c];l+=s(h,a+1),c<o.length-1&&(l+=", ")}return l+="]",l}else{if(o===null)return"null";if(o===void 0)return"undefined";if(typeof o=="function")return o.name+"()"}if(o instanceof Y)return`(${s(o.x)}, ${s(o.y)})`;if(o instanceof E)return`(${s(o.x)}, ${s(o.y)}, ${s(o.z)})`;if(o instanceof Ze)return`(${s(o.x)}, ${s(o.y)}, ${s(o.z)}, ${s(o.w)})`;if(o instanceof Se)return`(${s(o.x)}, ${s(o.y)}, ${s(o.z)}, ${s(o.w)})`;if(o instanceof Ft||o instanceof Vt)return o.name;if(o instanceof Gt)return`[${o.elements.join(", ")}]`;if(o instanceof he)return`[${o.elements.join(", ")}]`;if(o instanceof Mr)return o.mask.toString();if(typeof o=="object"){if(Hv.has(o))return"*";let l=`{
`;l+=r(a);const c=Object.keys(o);let h="";for(let u=0;u<c.length;u++){const d=c[u],m=o[d];if(Hv.has(m)){h+="";continue}Hv.set(m,!0),h+=d+":"+s(m,a+1),u<c.length-1&&(h+=", "),h.length>=60&&(h+=`
`,h+=r(a),l+=h,h="")}return l+=h,l+=`
}`,l}return o}function r(o){let a="";for(let l=0;l<o;l++)a+=" ";return a}}const Ooe=te("nodevlogs");function gn(n,e=Zo.Log){ac(e,n)}function zi(n){gn(n,Zo.Warn)}function R_(n){gn(n,Zo.Error)}let hL,uL;function Ye(){if(Ooe)return!1;if(hL!==void 0)return hL;if(uL!==void 0)return uL;let n=no();return n||(n=window.location.hostname.endsWith(".local-credentialless.webcontainer.io")),uL=n,n}function Goe(n){hL=n}let ka=null,Da=null,lc=null,dL=!1,G5=null;const z5="terminal",jv=te("console"),zoe=te("noerrors")||te("noconsole");if(jv&&mL(),!zoe&&(jv||no())){if(no()&&!jv){const e=new URL(window.location.href);e.searchParams.set("console","1"),console.log('\u{1F335} Tip: You can add the "?console" query parameter to the url to show the debug console (on mobile it will automatically open in the bottom right corner when your get errors during development. In VR a spatial console will appear.)',`
Open this page to get the console: `+e.toString())}const n=xt.isMobileDevice()||xt.isQuest()&&Ye();if((n||jv)&&(Gie(),N5(),V5(!0),n)){const e=document.querySelector("needle-engine");e?.addEventListener("enter-ar",()=>{(jv||ka||fI()>0)&&te("noerrors")}),e?.addEventListener("exit-ar",()=>{Voe()})}}const pL=Symbol("consoleParent");function mL(){if(ka!==null){ka.showSwitch();return}V5()}function F5(){ka!==null&&(ka.hide(),ka.hideSwitch())}function N5(){G5||(G5=setInterval(Foe,500))}let U5=0;function Foe(){const n=fI(),e=n!==U5;U5=n,e&&Noe()}function Noe(){mL(),lc&&(lc.setAttribute("error","true"),lc.innerText="\u{1F92C}")}function Uoe(){lc&&(lc.removeAttribute("error"),lc.innerText=z5)}function Voe(){Da&&Da[pL]&&Da[pL].appendChild(Da)}function V5(n=!1){if(ka||dL)return;dL=!0;const e=document.createElement("script");e.onload=()=>{dL=!1,N5(),ka=new VConsole({pluginOrder:["default","needle-console"]});const i=globalThis["needle:codegen_files"];if(i&&i.length>0&&ka.addPlugin(Xoe()),Da=Hoe(),Da&&(Da[pL]=Da.parentElement,Da.style.position="absolute",Da.style.zIndex=Number.MAX_SAFE_INTEGER.toString()),ka.setSwitchPosition(20,30),lc=Woe(),lc){lc.innerText=z5,lc.addEventListener("click",Uoe);const s=document.createElement("style"),r=40;s.innerHTML=`
                #__vconsole .vc-switch {
                    border: 1px solid rgba(255, 255, 255, .1);
                    border-radius: 50%;
                    width: ${r}px;
                    height: ${r}px;
                    padding: 0;
                    line-height: ${r}px;
                    font-size: ${r*.4}px;
                    text-align: center;
                    background: #ffffff5c;
                    backdrop-filter: blur(16px);
                    -webkit-backdrop-filter: blur(16px);
                    user-select: none;
                    pointer-events: auto;
                    transition: transform .2s ease-in-out;
                    box-shadow: 0px 7px 0.5rem 0px rgb(0 0 0 / 6%), inset 0px 0px 1.3rem rgba(0,0,0,.05);

                    font-family: 'Material Symbols Outlined';
                    color: black;
                    font-size: 2.3em;
                    font-weight: 100;
                }
                #__vconsole .vc-switch:hover {
                    cursor: pointer;
                    transform: scale(1.1);
                    transition: transform .1s ease-in-out, background .1s linear;
                    background: rgba(245, 245, 245, .8);
                    outline: rgba(0, 0, 0, .05) 1px solid;
                }
                #__vconsole .vc-switch[error] {
                    background: rgba(255,0,0,.2);
                    animation: vconsole-notify 1s ease-in-out;
                    line-height: 35px;
                }
                @keyframes vconsole-notify {
                    from {
                        transform: scale(1, 1);
                    }
                    10% {
                        transform: scale(1.3, 1.3);
                    }
                    70% {
                        transform: scale(1.4, 1.4);
                    }
                    to {
                        transform: scale(1, 1);
                    }
                }
                #__vconsole .vc-panel {
                    font-family: monospace;
                    font-size: 11px;
                }
                #__vconsole .vc-plugin-box.vc-actived {
                    height: 100%;
                }
                #__vconsole .vc-mask {
                    overflow: hidden;
                }
            `,Da?.prepend(s),n===!0&&fI()<=0&&F5(),console.log("\u{1F335} Debug console has loaded")}},e.src="https://unpkg.com/vconsole@latest/dist/vconsole.min.js",document.body.appendChild(e)}function Xoe(){const n=new VConsole.VConsolePlugin("needle-console","\u{1F335} Inspect glTF"),e=()=>document.querySelector("#__vc_plug_"+n._id+" iframe");return n.on("renderTab",function(i){const s=globalThis["needle:codegen_files"];if(!s||s.length===0)return;let r=globalThis["needle:codegen_files"][0];const o=r.indexOf("?");o>-1&&(r=r.substring(0,o));const a=location.protocol+"//"+location.host+location.pathname+"/"+r,l=encodeURIComponent(a);n.fullUrl="https://viewer.needle.tools?inspect&file="+l;var c='<iframe src="" style="width: 100%; height: 99%; border: none;"></iframe>';i(c)}),n.on("show",function(){const i=e();i&&i.src!==n.fullUrl&&(i.src=n.fullUrl)}),n.on("hide",function(){const i=e();i&&(i.src="")}),n.on("addTopBar",function(i){var s=new Array;s.push({name:"Open in new window \u2197",onClick:function(r){window.open(n.fullUrl,"_blank"),ka?.hide()}}),s.push({name:"Reload",onClick:function(r){const o=e();o&&(o.src=n.fullUrl)}}),s.push({name:"Fullscreen",onClick:function(r){const o=e();o.requestFullscreen?o.requestFullscreen():o.webkitRequestFullscreen instanceof Function&&o.webkitRequestFullscreen()}}),i(s)}),n}function Woe(){return document.querySelector("#__vconsole .vc-switch")||null}function Hoe(){return document.querySelector("#__vconsole")||null}const X5=te("debugdefines");bg('if(!globalThis[""3.50.0-beta""]) globalThis[""3.50.0-beta""] = "0.0.0";'),bg('if(!globalThis[""undefined""]) globalThis[""undefined""] = "unknown";'),bg('if(!globalThis[""Wed Oct 30 2024 15:14:44 GMT+0100 (Central European Standard Time)""]) globalThis[""Wed Oct 30 2024 15:14:44 GMT+0100 (Central European Standard Time)""] = "unknown";'),bg('globalThis["__NEEDLE_ENGINE_VERSION__"] = "3.50.0-beta";'),bg('globalThis["__NEEDLE_ENGINE_GENERATOR__"] = "undefined";'),bg('globalThis["__NEEDLE_PROJECT_BUILD_TIME__"] = "Wed Oct 30 2024 15:14:44 GMT+0100 (Central European Standard Time)";');const xl="3.50.0-beta",I_="undefined",fL="Wed Oct 30 2024 15:14:44 GMT+0100 (Central European Standard Time)";X5&&console.log(`Engine version: ${xl} (generator: ${I_})
Project built at ${fL}`);const _h="needle_isActiveInHierarchy",im="builtin_components",Qv="needle_editor_guid";function bg(n){try{(0,eval)(n)}catch(e){X5&&console.error(e)}}const joe='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 160 187.74"><defs><linearGradient id="a" x1="89.64" y1="184.81" x2="90.48" y2="21.85" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#62d399"/><stop offset=".51" stop-color="#acd842"/><stop offset=".9" stop-color="#d7db0a"/></linearGradient><linearGradient id="b" x1="69.68" y1="178.9" x2="68.08" y2="16.77" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#0ba398"/><stop offset=".5" stop-color="#4ca352"/><stop offset="1" stop-color="#76a30a"/></linearGradient><linearGradient id="c" x1="36.6" y1="152.17" x2="34.7" y2="84.19" gradientUnits="userSpaceOnUse"><stop offset=".19" stop-color="#36a382"/><stop offset=".54" stop-color="#49a459"/><stop offset="1" stop-color="#76a30b"/></linearGradient><linearGradient id="d" x1="15.82" y1="153.24" x2="18" y2="90.86" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#267880"/><stop offset=".51" stop-color="#457a5c"/><stop offset="1" stop-color="#717516"/></linearGradient><linearGradient id="e" x1="135.08" y1="135.43" x2="148.93" y2="63.47" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#b0d939"/><stop offset="1" stop-color="#eadb04"/></linearGradient><linearGradient id="f" x1="-4163.25" y1="2285.12" x2="-4160.81" y2="2215.34" gradientTransform="rotate(20 4088.49 13316.712)" gradientUnits="userSpaceOnUse"><stop offset=".17" stop-color="#74af52"/><stop offset=".48" stop-color="#99be32"/><stop offset="1" stop-color="#c0c40a"/></linearGradient><symbol id="g" viewBox="0 0 160 187.74"><path style="fill:url(#a)" d="M79.32 36.98v150.76L95 174.54l6.59-156.31-22.27 18.75z"/><path style="fill:url(#b)" d="M79.32 36.98 57.05 18.23l6.59 156.31 15.68 13.2V36.98z"/><path style="fill:url(#c)" d="m25.19 104.83 8.63 49.04 12.5-14.95-2.46-56.42-18.67 22.33z"/><path style="fill:url(#d)" d="M25.19 104.83 0 90.24l16.97 53.86 16.85 9.77-8.63-49.04z"/><path style="fill:#9c3" d="M43.86 82.5 18.69 67.98 0 90.24l25.18 14.59L43.86 82.5z"/><path style="fill:url(#e)" d="m134.82 78.69-9.97 56.5 15.58-9.04L160 64.1l-25.18 14.59z"/><path style="fill:url(#f)" d="m134.82 78.69-18.68-22.33-2.86 65 11.57 13.83 9.97-56.5z"/><path style="fill:#ffe113" d="m160 64.1-18.69-22.26-25.17 14.52 18.67 22.33L160 64.1z"/><path style="fill:#f3e600" d="M101.59 18.23 79.32 0 57.05 18.23l22.27 18.75 22.27-18.75z"/></symbol></defs><use width="160" height="187.74" xlink:href="#g"/></svg>',Qoe=btoa(joe),Zoe="data:image/svg+xml;base64,"+Qoe,Yoe=Zoe,Koe=`<?xml version="1.0" encoding="UTF-8"?> <!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'> <svg clip-rule="evenodd" fill-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="2" version="1.1" viewBox="0 0 1014 282" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m665.95 132.73v44.88l-10.56-8.4c-0.8-0.64-1.2-1.44-1.2-2.4v-32.4c0-6.48-4.12-9.72-12.36-9.72-2.16 0-4.18 0.4-6.06 1.2s-3.54 1.8-4.98 3-2.56 2.5-3.36 3.9-1.2 2.7-1.2 3.9v40.92l-10.68-8.4c-0.72-0.64-1.08-1.44-1.08-2.4v-53.76l10.92 8.52c0.32 0.24 0.56 0.44 0.72 0.6s0.36 0.32 0.6 0.48c0.96-1.2 2.14-2.28 3.54-3.24s2.92-1.76 4.56-2.4 3.34-1.14 5.1-1.5 3.44-0.54 5.04-0.54c1.44 0 2.92 0.04 4.44 0.12s2.84 0.28 3.96 0.6c4.56 1.12 7.8 3.12 9.72 6s2.88 6.56 2.88 11.04z" fill-rule="nonzero"/> </g> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m732.38 146.05c0 0.88 0.02 1.5 0.06 1.86s-0.02 0.98-0.18 1.86h-7.08c-2.08 0-4.44-0.02-7.08-0.06s-5.36-0.06-8.16-0.06h-22.08c0 2.88 0.56 5.36 1.68 7.44s2.6 3.8 4.44 5.16 3.94 2.36 6.3 3 4.74 0.96 7.14 0.96c3.04 0 5.9-0.76 8.58-2.28s4.94-3.52 6.78-6c0.64 0.56 1.54 1.48 2.7 2.76s2.94 3.2 5.34 5.76c-2.8 3.36-6.22 6.02-10.26 7.98s-8.42 2.94-13.14 2.94-8.92-0.64-12.84-1.92-7.32-3.24-10.2-5.88-5.12-5.98-6.72-10.02-2.4-8.82-2.4-14.34c0-4.96 0.66-9.42 1.98-13.38s3.22-7.32 5.7-10.08 5.44-4.9 8.88-6.42 7.32-2.28 11.64-2.28c5.76 0 10.52 0.88 14.28 2.64s6.72 4.16 8.88 7.2 3.66 6.54 4.5 10.5 1.26 8.18 1.26 12.66zm-29.4-22.8c-2.16 0.16-4.16 0.72-6 1.68s-3.42 2.2-4.74 3.72-2.36 3.28-3.12 5.28-1.14 4.12-1.14 6.36h33.12c0-2-0.22-4.06-0.66-6.18s-1.3-4.02-2.58-5.7-3.1-3.02-5.46-4.02-5.5-1.38-9.42-1.14z" fill-rule="nonzero"/> </g> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m795.93 146.05c0 0.88 0.02 1.5 0.06 1.86s-0.02 0.98-0.18 1.86h-7.08c-2.08 0-4.44-0.02-7.08-0.06s-5.36-0.06-8.16-0.06h-22.08c0 2.88 0.56 5.36 1.68 7.44s2.6 3.8 4.44 5.16 3.94 2.36 6.3 3 4.74 0.96 7.14 0.96c3.04 0 5.9-0.76 8.58-2.28s4.94-3.52 6.78-6c0.64 0.56 1.54 1.48 2.7 2.76s2.94 3.2 5.34 5.76c-2.8 3.36-6.22 6.02-10.26 7.98s-8.42 2.94-13.14 2.94-8.92-0.64-12.84-1.92-7.32-3.24-10.2-5.88-5.12-5.98-6.72-10.02-2.4-8.82-2.4-14.34c0-4.96 0.66-9.42 1.98-13.38s3.22-7.32 5.7-10.08 5.44-4.9 8.88-6.42 7.32-2.28 11.64-2.28c5.76 0 10.52 0.88 14.28 2.64s6.72 4.16 8.88 7.2 3.66 6.54 4.5 10.5 1.26 8.18 1.26 12.66zm-29.4-22.8c-2.16 0.16-4.16 0.72-6 1.68s-3.42 2.2-4.74 3.72-2.36 3.28-3.12 5.28-1.14 4.12-1.14 6.36h33.12c0-2-0.22-4.06-0.66-6.18s-1.3-4.02-2.58-5.7-3.1-3.02-5.46-4.02-5.5-1.38-9.42-1.14z" fill-rule="nonzero"/> </g> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m858.57 97.21c0.64 0.48 0.96 1.16 0.96 2.04v74.88c-0.08 1.04-0.12 2.12-0.12 3.24-1.84-1.52-3.56-2.92-5.16-4.2-1.36-1.12-2.66-2.18-3.9-3.18s-2.06-1.66-2.46-1.98c-1.76 2.48-4.26 4.44-7.5 5.88s-7.02 2.16-11.34 2.16c-3.84 0-7.4-0.7-10.68-2.1s-6.14-3.44-8.58-6.12-4.34-5.94-5.7-9.78-2.04-8.16-2.04-12.96c0-4.32 0.78-8.34 2.34-12.06s3.6-6.92 6.12-9.6 5.38-4.78 8.58-6.3 6.48-2.28 9.84-2.28c2.56 0 4.82 0.22 6.78 0.66s3.68 1.06 5.16 1.86 2.78 1.74 3.9 2.82 2.16 2.22 3.12 3.42v-35.04l10.68 8.64zm-27.96 67.92c3.6 0 6.52-0.68 8.76-2.04s3.98-3.06 5.22-5.1 2.1-4.22 2.58-6.54 0.72-4.44 0.72-6.36v-1.2c0-1.12-0.22-2.7-0.66-4.74s-1.28-4.06-2.52-6.06-3-3.7-5.28-5.1-5.22-2.02-8.82-1.86c-3.44 0-6.26 0.74-8.46 2.22s-3.96 3.26-5.28 5.34-2.24 4.2-2.76 6.36-0.78 3.92-0.78 5.28c0 1.84 0.24 3.92 0.72 6.24s1.36 4.48 2.64 6.48 3.04 3.68 5.28 5.04 5.12 2.04 8.64 2.04z" fill-rule="nonzero"/> </g> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m882.81 97.09c0.64 0.48 0.96 1.12 0.96 1.92l-0.12 41.04v37.08l-10.56-8.4c-0.72-0.64-1.08-1.44-1.08-2.4v-77.88l10.8 8.64z" fill-rule="nonzero"/> </g> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m950.36 146.05c0 0.88 0.02 1.5 0.06 1.86s-0.02 0.98-0.18 1.86h-7.08c-2.08 0-4.44-0.02-7.08-0.06s-5.36-0.06-8.16-0.06h-22.08c0 2.88 0.56 5.36 1.68 7.44s2.6 3.8 4.44 5.16 3.94 2.36 6.3 3 4.74 0.96 7.14 0.96c3.04 0 5.9-0.76 8.58-2.28s4.94-3.52 6.78-6c0.64 0.56 1.54 1.48 2.7 2.76s2.94 3.2 5.34 5.76c-2.8 3.36-6.22 6.02-10.26 7.98s-8.42 2.94-13.14 2.94-8.92-0.64-12.84-1.92-7.32-3.24-10.2-5.88-5.12-5.98-6.72-10.02-2.4-8.82-2.4-14.34c0-4.96 0.66-9.42 1.98-13.38s3.22-7.32 5.7-10.08 5.44-4.9 8.88-6.42 7.32-2.28 11.64-2.28c5.76 0 10.52 0.88 14.28 2.64s6.72 4.16 8.88 7.2 3.66 6.54 4.5 10.5 1.26 8.18 1.26 12.66zm-29.4-22.8c-2.16 0.16-4.16 0.72-6 1.68s-3.42 2.2-4.74 3.72-2.36 3.28-3.12 5.28-1.14 4.12-1.14 6.36h33.12c0-2-0.22-4.06-0.66-6.18s-1.3-4.02-2.58-5.7-3.1-3.02-5.46-4.02-5.5-1.38-9.42-1.14z" fill-rule="nonzero"/> </g> <g transform="matrix(1.8559 0 0 .7642 45.348 36.475)"> <g transform="translate(2.7114)"> <path d="m3.935 173.02c-0.331 0-0.497-0.402-0.497-1.207v-51.002c0-0.738 0.138-1.107 0.414-1.107h1.781c0.277 0 0.415 0.335 0.415 1.006v5.935c0 0.336 0.027 0.553 0.083 0.654 0.055 0.101 0.151-0.017 0.289-0.352 0.912-1.744 1.754-3.236 2.527-4.477 0.773-1.24 1.554-2.179 2.341-2.816s1.65-0.956 2.588-0.956c1.685 0 3.011 0.922 3.977 2.766 0.967 1.845 1.602 3.84 1.905 5.986 0.056 0.268 0.139 0.369 0.249 0.302s0.221-0.235 0.331-0.503c0.939-1.811 1.802-3.353 2.589-4.628 0.787-1.274 1.581-2.246 2.382-2.917s1.671-1.006 2.61-1.006c2.016 0 3.569 1.392 4.66 4.175 1.09 2.783 1.636 6.421 1.636 10.915v37.925c0 0.871-0.18 1.307-0.539 1.307h-1.739c-0.138 0-0.249-0.1-0.332-0.301-0.083-0.202-0.124-0.503-0.124-0.906v-36.315c0-3.555-0.338-6.321-1.015-8.3-0.676-1.978-1.76-2.967-3.251-2.967-0.884 0-1.726 0.386-2.527 1.157s-1.519 1.727-2.154 2.867-1.201 2.213-1.699 3.219c-0.248 0.469-0.421 0.905-0.517 1.308-0.097 0.402-0.145 0.972-0.145 1.71v37.221c0 0.871-0.166 1.307-0.497 1.307h-1.74c-0.166 0-0.29-0.1-0.373-0.301-0.083-0.202-0.124-0.503-0.124-0.906v-36.315c0-3.555-0.332-6.321-0.994-8.3-0.663-1.978-1.754-2.967-3.273-2.967-1.242 0-2.375 0.704-3.396 2.112-1.022 1.409-2.223 3.555-3.604 6.439v39.031c0 0.805-0.18 1.207-0.539 1.207h-1.698z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m53.642 166.28c-1.077 2.549-2.237 4.477-3.479 5.785-1.243 1.307-2.61 1.961-4.101 1.961-2.154 0-3.853-1.324-5.095-3.973-1.243-2.649-1.864-6.187-1.864-10.613 0-3.488 0.4-6.489 1.201-9.004s1.988-4.51 3.562-5.985c1.574-1.476 3.521-2.414 5.841-2.817l3.686-0.704c0.221-0.067 0.394-0.218 0.518-0.453 0.124-0.234 0.187-0.587 0.187-1.056v-2.917c0-3.89-0.504-6.975-1.512-9.255s-2.354-3.42-4.039-3.42c-1.298 0-2.472 0.72-3.521 2.162s-2.002 3.572-2.858 6.388c-0.083 0.268-0.159 0.453-0.228 0.554-0.069 0.1-0.172 0.083-0.311-0.051l-1.698-1.71c-0.083-0.134-0.138-0.285-0.166-0.453-0.027-0.167 0.014-0.452 0.125-0.855 0.856-3.353 2.009-6.052 3.459-8.098 1.449-2.045 3.224-3.068 5.322-3.068 1.74 0 3.211 0.687 4.412 2.062s2.112 3.37 2.734 5.986c0.621 2.615 0.932 5.7 0.932 9.255v35.712c0 0.536-0.035 0.888-0.104 1.056s-0.2 0.251-0.393 0.251h-1.533c-0.166 0-0.29-0.117-0.373-0.352-0.083-0.234-0.124-0.553-0.124-0.955l-0.083-5.231c-0.055-0.939-0.221-1.006-0.497-0.202zm0.456-19.314c0-1.14-0.194-1.643-0.58-1.509l-3.107 0.603c-1.436 0.202-2.686 0.638-3.749 1.308-1.063 0.671-1.953 1.543-2.671 2.616s-1.257 2.33-1.616 3.772-0.538 3.102-0.538 4.98c0 3.152 0.455 5.616 1.367 7.393 0.911 1.778 2.14 2.666 3.686 2.666 0.939 0 1.85-0.419 2.734-1.257s1.671-1.895 2.361-3.169c0.663-1.408 1.181-2.85 1.553-4.326 0.373-1.475 0.56-2.883 0.56-4.225v-8.852z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m79.034 173.02c-0.166 0-0.297-0.117-0.394-0.352-0.096-0.234-0.145-0.553-0.145-0.955v-4.628c0-0.536-0.041-0.838-0.124-0.905s-0.207 0.1-0.373 0.503c-0.276 0.67-0.69 1.593-1.242 2.766-0.553 1.174-1.271 2.23-2.154 3.169-0.884 0.939-1.961 1.408-3.231 1.408-1.74 0-3.314-0.989-4.722-2.967-1.409-1.979-2.534-4.963-3.376-8.953-0.843-3.991-1.264-8.937-1.264-14.838 0-5.701 0.415-10.68 1.243-14.939s1.988-7.595 3.479-10.009c1.492-2.415 3.204-3.622 5.137-3.622 1.436 0 2.616 0.57 3.541 1.71 0.926 1.14 1.719 2.381 2.382 3.722 0.249 0.47 0.414 0.637 0.497 0.503s0.125-0.536 0.125-1.207v-23.841c0-0.805 0.151-1.208 0.455-1.208h1.864c0.276 0 0.414 0.369 0.414 1.107v72.128c0 0.537-0.041 0.905-0.124 1.107-0.083 0.201-0.235 0.301-0.455 0.301h-1.533zm-0.621-42.049c-0.939-2.213-1.885-3.94-2.838-5.181s-2.009-1.861-3.169-1.861c-1.463 0-2.768 0.889-3.914 2.666s-2.044 4.376-2.693 7.796-0.973 7.578-0.973 12.474c0 5.097 0.338 9.272 1.015 12.524 0.676 3.253 1.567 5.651 2.672 7.193 1.104 1.543 2.305 2.314 3.603 2.314 1.188 0 2.258-0.704 3.211-2.113 0.952-1.408 1.705-3.118 2.257-5.13s0.829-3.957 0.829-5.835v-24.847z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m89.514 149.38c0 3.42 0.345 6.606 1.035 9.557 0.691 2.951 1.609 5.315 2.755 7.092s2.437 2.666 3.873 2.666c1.519 0 2.837-0.738 3.956-2.213 1.118-1.476 2.064-3.655 2.837-6.539 0.083-0.336 0.166-0.52 0.249-0.554 0.083-0.033 0.179 0.017 0.29 0.151l1.408 1.912c0.221 0.268 0.235 0.67 0.041 1.207-0.69 2.548-1.47 4.661-2.34 6.337-0.87 1.677-1.857 2.935-2.962 3.773-1.104 0.838-2.319 1.257-3.645 1.257-2.043 0-3.838-1.14-5.385-3.42-1.546-2.28-2.761-5.482-3.645-9.607-0.884-4.124-1.325-8.836-1.325-14.134 0-5.901 0.455-10.931 1.367-15.089 0.911-4.158 2.14-7.377 3.686-9.658 1.547-2.28 3.3-3.42 5.261-3.42 1.988 0 3.714 1.073 5.178 3.219 1.463 2.146 2.595 5.231 3.396 9.255s1.201 8.886 1.201 14.587c0 0.469-0.02 0.939-0.062 1.408-0.041 0.469-0.214 0.704-0.517 0.704h-16.362c-0.083 0-0.152 0.151-0.207 0.453-0.056 0.302-0.083 0.654-0.083 1.056zm13.752-6.237c0.304 0 0.497-0.1 0.58-0.302 0.083-0.201 0.124-0.57 0.124-1.106 0-3.219-0.283-6.187-0.849-8.903s-1.367-4.896-2.402-6.539c-1.036-1.643-2.272-2.464-3.708-2.464-1.629 0-2.996 0.955-4.101 2.867-1.104 1.911-1.94 4.342-2.506 7.293s-0.849 6.002-0.849 9.154h13.711z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m148.54 119.7c0.165 0 0.283 0.117 0.352 0.352s0.076 0.52 0.02 0.855l-6.254 50.902c-0.028 0.47-0.104 0.788-0.228 0.956s-0.297 0.251-0.518 0.251h-1.615c-0.442 0-0.718-0.402-0.829-1.207l-5.26-40.138c-0.111-0.604-0.201-0.905-0.27-0.905s-0.131 0.301-0.186 0.905l-5.012 40.138c-0.028 0.47-0.097 0.788-0.207 0.956-0.111 0.168-0.277 0.251-0.497 0.251h-1.74c-0.442 0-0.718-0.402-0.829-1.207l-6.503-50.801c-0.055-0.403-0.048-0.721 0.021-0.956s0.2-0.352 0.393-0.352h1.823c0.166 0 0.297 0.067 0.393 0.201 0.097 0.134 0.159 0.403 0.187 0.805l5.302 41.848c0.083 0.671 0.179 0.989 0.29 0.956 0.11-0.034 0.207-0.386 0.29-1.056l5.219-41.949c0.055-0.268 0.124-0.47 0.207-0.604s0.193-0.201 0.331-0.201h1.533c0.138 0 0.262 0.067 0.373 0.201 0.11 0.134 0.179 0.403 0.207 0.805l5.468 41.848c0.083 0.671 0.179 0.989 0.29 0.956 0.11-0.034 0.207-0.386 0.29-1.056l5.053-41.849c0.055-0.335 0.138-0.57 0.249-0.704 0.11-0.134 0.234-0.201 0.373-0.201h1.284z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m156.49 171.51c0 0.604-0.042 1.006-0.125 1.208-0.082 0.201-0.262 0.301-0.538 0.301h-1.533c-0.221 0-0.366-0.083-0.435-0.251s-0.103-0.486-0.103-0.956v-50.902c0-0.805 0.152-1.207 0.456-1.207h1.822c0.304 0 0.456 0.402 0.456 1.207v50.6zm0.165-63.979c0 1.207-0.207 1.811-0.621 1.811h-1.905c-0.221 0-0.366-0.135-0.435-0.403s-0.104-0.67-0.104-1.207v-7.847c0-1.006 0.18-1.509 0.539-1.509h1.988c0.359 0 0.538 0.47 0.538 1.409v7.746z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m168.3 124.83c-0.221 0-0.331 0.269-0.331 0.805v33.801c0 3.42 0.221 5.667 0.663 6.74 0.441 1.073 1.09 1.609 1.946 1.609h3.024c0.138 0 0.242 0.084 0.311 0.252 0.069 0.167 0.103 0.419 0.103 0.754v2.716c0 0.537-0.138 0.906-0.414 1.107-0.248 0.067-0.614 0.134-1.098 0.201-0.483 0.067-0.959 0.118-1.429 0.151-0.469 0.034-0.828 0.05-1.077 0.05-1.712 0-2.934-0.955-3.665-2.867-0.732-1.911-1.098-5.013-1.098-9.305v-35.108c0-0.604-0.124-0.906-0.373-0.906h-3.521c-0.248 0-0.373-0.268-0.373-0.804v-3.521c0-0.537 0.111-0.805 0.332-0.805h3.686c0.166 0 0.263-0.268 0.29-0.805l0.415-16.095c0-0.805 0.124-1.207 0.372-1.207h1.492c0.303 0 0.455 0.436 0.455 1.307v15.995c0 0.537 0.097 0.805 0.29 0.805h5.468c0.221 0 0.331 0.268 0.331 0.805v3.521c0 0.536-0.124 0.804-0.373 0.804h-5.426z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m179.4 173.02c-0.331 0-0.497-0.402-0.497-1.207v-72.329c0-0.738 0.138-1.107 0.414-1.107h1.782c0.276 0 0.414 0.336 0.414 1.006v27.162c0 0.335 0.034 0.536 0.103 0.603s0.159-0.033 0.27-0.302c0.994-1.81 1.898-3.319 2.713-4.526 0.814-1.208 1.629-2.113 2.444-2.717 0.814-0.603 1.691-0.905 2.63-0.905 2.182 0 3.839 1.375 4.971 4.125 1.132 2.749 1.698 6.404 1.698 10.965v37.925c0 0.871-0.166 1.307-0.497 1.307h-1.74c-0.165 0-0.29-0.1-0.373-0.301-0.082-0.202-0.124-0.503-0.124-0.906v-36.315c0-3.555-0.366-6.321-1.097-8.3-0.732-1.978-1.899-2.967-3.501-2.967-0.883 0-1.705 0.318-2.464 0.956-0.76 0.637-1.526 1.576-2.299 2.816-0.773 1.241-1.643 2.834-2.61 4.779v39.031c0 0.805-0.179 1.207-0.538 1.207h-1.699z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> </g> <g transform="matrix(.80638 0 0 .80638 452.53 65.421)" fill-rule="nonzero"> <path d="m79.32 36.98v150.76l15.68-13.2 6.59-156.31-22.27 18.75z" fill="url(#f)"/> <path d="m79.32 36.98-22.27-18.75 6.59 156.31 15.68 13.2v-150.76z" fill="url(#e)"/> <path d="m25.19 104.83 8.63 49.04 12.5-14.95-2.46-56.42-18.67 22.33z" fill="url(#d)"/> <path d="m25.19 104.83-25.19-14.59 16.97 53.86 16.85 9.77-8.63-49.04z" fill="url(#c)"/> <path d="M43.86,82.5L18.69,67.98L0,90.24L25.18,104.83L43.86,82.5Z" fill="#9c3"/> <path d="m134.82 78.69-9.97 56.5 15.58-9.04 19.57-62.05-25.18 14.59z" fill="url(#b)"/> <path d="m134.82 78.69-18.68-22.33-2.86 65 11.57 13.83 9.97-56.5z" fill="url(#a)"/> <path d="m160 64.1-18.69-22.26-25.17 14.52 18.67 22.33 25.19-14.59z" fill="#ffe113"/> <path d="M101.59,18.23L79.32,0L57.05,18.23L79.32,36.98L101.59,18.23Z" fill="#f3e600"/> </g> <defs> <linearGradient id="f" x2="1" gradientTransform="matrix(.84 -162.96 162.96 .84 89.64 184.81)" gradientUnits="userSpaceOnUse"><stop stop-color="#62d399" offset="0"/><stop stop-color="#acd842" offset=".51"/><stop stop-color="#d7db0a" offset=".9"/><stop stop-color="#d7db0a" offset="1"/></linearGradient> <linearGradient id="e" x2="1" gradientTransform="matrix(-1.6,-162.13,162.13,-1.6,69.68,178.9)" gradientUnits="userSpaceOnUse"><stop stop-color="#0ba398" offset="0"/><stop stop-color="#4ca352" offset=".5"/><stop stop-color="#76a30a" offset="1"/></linearGradient> <linearGradient id="d" x2="1" gradientTransform="matrix(-1.9,-67.98,67.98,-1.9,36.6,152.17)" gradientUnits="userSpaceOnUse"><stop stop-color="#36a382" offset="0"/><stop stop-color="#36a382" offset=".19"/><stop stop-color="#49a459" offset=".54"/><stop stop-color="#76a30b" offset="1"/></linearGradient> <linearGradient id="c" x2="1" gradientTransform="matrix(2.18,-62.38,62.38,2.18,15.82,153.24)" gradientUnits="userSpaceOnUse"><stop stop-color="#267880" offset="0"/><stop stop-color="#457a5c" offset=".51"/><stop stop-color="#717516" offset="1"/></linearGradient> <linearGradient id="b" x2="1" gradientTransform="matrix(13.85,-71.96,71.96,13.85,135.08,135.43)" gradientUnits="userSpaceOnUse"><stop stop-color="#b0d939" offset="0"/><stop stop-color="#eadb04" offset="1"/></linearGradient> <linearGradient id="a" x2="1" gradientTransform="matrix(26.159 -64.737 64.737 26.159 107.42 128.14)" gradientUnits="userSpaceOnUse"><stop stop-color="#74af52" offset="0"/><stop stop-color="#74af52" offset=".17"/><stop stop-color="#99be32" offset=".48"/><stop stop-color="#c0c40a" offset="1"/></linearGradient> </defs> </svg>`;btoa(Koe);const Joe='<svg viewBox="0 0 509 154" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2"><path d="M665.95 132.73v44.88l-10.56-8.4c-.8-.64-1.2-1.44-1.2-2.4v-32.4c0-6.48-4.12-9.72-12.36-9.72-2.16 0-4.18.4-6.06 1.2-1.88.8-3.54 1.8-4.98 3-1.44 1.2-2.56 2.5-3.36 3.9-.8 1.4-1.2 2.7-1.2 3.9v40.92l-10.68-8.4c-.72-.64-1.08-1.44-1.08-2.4v-53.76l10.92 8.52c.32.24.56.44.72.6.16.16.36.32.6.48.96-1.2 2.14-2.28 3.54-3.24 1.4-.96 2.92-1.76 4.56-2.4 1.64-.64 3.34-1.14 5.1-1.5 1.76-.36 3.44-.54 5.04-.54 1.44 0 2.92.04 4.44.12 1.52.08 2.84.28 3.96.6 4.56 1.12 7.8 3.12 9.72 6 1.92 2.88 2.88 6.56 2.88 11.04ZM732.38 146.05c0 .88.02 1.5.06 1.86.04.36-.02.98-.18 1.86h-7.08c-2.08 0-4.44-.02-7.08-.06-2.64-.04-5.36-.06-8.16-.06h-22.08c0 2.88.56 5.36 1.68 7.44 1.12 2.08 2.6 3.8 4.44 5.16 1.84 1.36 3.94 2.36 6.3 3 2.36.64 4.74.96 7.14.96 3.04 0 5.9-.76 8.58-2.28 2.68-1.52 4.94-3.52 6.78-6 .64.56 1.54 1.48 2.7 2.76 1.16 1.28 2.94 3.2 5.34 5.76-2.8 3.36-6.22 6.02-10.26 7.98-4.04 1.96-8.42 2.94-13.14 2.94-4.72 0-8.92-.64-12.84-1.92-3.92-1.28-7.32-3.24-10.2-5.88-2.88-2.64-5.12-5.98-6.72-10.02-1.6-4.04-2.4-8.82-2.4-14.34 0-4.96.66-9.42 1.98-13.38 1.32-3.96 3.22-7.32 5.7-10.08s5.44-4.9 8.88-6.42c3.44-1.52 7.32-2.28 11.64-2.28 5.76 0 10.52.88 14.28 2.64 3.76 1.76 6.72 4.16 8.88 7.2 2.16 3.04 3.66 6.54 4.5 10.5.84 3.96 1.26 8.18 1.26 12.66Zm-29.4-22.8c-2.16.16-4.16.72-6 1.68-1.84.96-3.42 2.2-4.74 3.72-1.32 1.52-2.36 3.28-3.12 5.28-.76 2-1.14 4.12-1.14 6.36h33.12c0-2-.22-4.06-.66-6.18-.44-2.12-1.3-4.02-2.58-5.7-1.28-1.68-3.1-3.02-5.46-4.02-2.36-1-5.5-1.38-9.42-1.14ZM795.93 146.05c0 .88.02 1.5.06 1.86.04.36-.02.98-.18 1.86h-7.08c-2.08 0-4.44-.02-7.08-.06-2.64-.04-5.36-.06-8.16-.06h-22.08c0 2.88.56 5.36 1.68 7.44 1.12 2.08 2.6 3.8 4.44 5.16 1.84 1.36 3.94 2.36 6.3 3 2.36.64 4.74.96 7.14.96 3.04 0 5.9-.76 8.58-2.28 2.68-1.52 4.94-3.52 6.78-6 .64.56 1.54 1.48 2.7 2.76 1.16 1.28 2.94 3.2 5.34 5.76-2.8 3.36-6.22 6.02-10.26 7.98-4.04 1.96-8.42 2.94-13.14 2.94-4.72 0-8.92-.64-12.84-1.92-3.92-1.28-7.32-3.24-10.2-5.88-2.88-2.64-5.12-5.98-6.72-10.02-1.6-4.04-2.4-8.82-2.4-14.34 0-4.96.66-9.42 1.98-13.38 1.32-3.96 3.22-7.32 5.7-10.08s5.44-4.9 8.88-6.42c3.44-1.52 7.32-2.28 11.64-2.28 5.76 0 10.52.88 14.28 2.64 3.76 1.76 6.72 4.16 8.88 7.2 2.16 3.04 3.66 6.54 4.5 10.5.84 3.96 1.26 8.18 1.26 12.66Zm-29.4-22.8c-2.16.16-4.16.72-6 1.68-1.84.96-3.42 2.2-4.74 3.72-1.32 1.52-2.36 3.28-3.12 5.28-.76 2-1.14 4.12-1.14 6.36h33.12c0-2-.22-4.06-.66-6.18-.44-2.12-1.3-4.02-2.58-5.7-1.28-1.68-3.1-3.02-5.46-4.02-2.36-1-5.5-1.38-9.42-1.14ZM858.57 97.21c.64.48.96 1.16.96 2.04v74.88c-.08 1.04-.12 2.12-.12 3.24-1.84-1.52-3.56-2.92-5.16-4.2-1.36-1.12-2.66-2.18-3.9-3.18-1.24-1-2.06-1.66-2.46-1.98-1.76 2.48-4.26 4.44-7.5 5.88-3.24 1.44-7.02 2.16-11.34 2.16-3.84 0-7.4-.7-10.68-2.1-3.28-1.4-6.14-3.44-8.58-6.12-2.44-2.68-4.34-5.94-5.7-9.78-1.36-3.84-2.04-8.16-2.04-12.96 0-4.32.78-8.34 2.34-12.06 1.56-3.72 3.6-6.92 6.12-9.6 2.52-2.68 5.38-4.78 8.58-6.3 3.2-1.52 6.48-2.28 9.84-2.28 2.56 0 4.82.22 6.78.66 1.96.44 3.68 1.06 5.16 1.86s2.78 1.74 3.9 2.82a35.92 35.92 0 0 1 3.12 3.42V88.57l10.68 8.64Zm-27.96 67.92c3.6 0 6.52-.68 8.76-2.04 2.24-1.36 3.98-3.06 5.22-5.1a20.5 20.5 0 0 0 2.58-6.54c.48-2.32.72-4.44.72-6.36v-1.2c0-1.12-.22-2.7-.66-4.74-.44-2.04-1.28-4.06-2.52-6.06s-3-3.7-5.28-5.1c-2.28-1.4-5.22-2.02-8.82-1.86-3.44 0-6.26.74-8.46 2.22-2.2 1.48-3.96 3.26-5.28 5.34-1.32 2.08-2.24 4.2-2.76 6.36-.52 2.16-.78 3.92-.78 5.28 0 1.84.24 3.92.72 6.24.48 2.32 1.36 4.48 2.64 6.48s3.04 3.68 5.28 5.04c2.24 1.36 5.12 2.04 8.64 2.04ZM882.81 97.09c.64.48.96 1.12.96 1.92l-.12 41.04v37.08l-10.56-8.4c-.72-.64-1.08-1.44-1.08-2.4V88.45l10.8 8.64ZM950.36 146.05c0 .88.02 1.5.06 1.86.04.36-.02.98-.18 1.86h-7.08c-2.08 0-4.44-.02-7.08-.06-2.64-.04-5.36-.06-8.16-.06h-22.08c0 2.88.56 5.36 1.68 7.44 1.12 2.08 2.6 3.8 4.44 5.16 1.84 1.36 3.94 2.36 6.3 3 2.36.64 4.74.96 7.14.96 3.04 0 5.9-.76 8.58-2.28 2.68-1.52 4.94-3.52 6.78-6 .64.56 1.54 1.48 2.7 2.76 1.16 1.28 2.94 3.2 5.34 5.76-2.8 3.36-6.22 6.02-10.26 7.98-4.04 1.96-8.42 2.94-13.14 2.94-4.72 0-8.92-.64-12.84-1.92-3.92-1.28-7.32-3.24-10.2-5.88-2.88-2.64-5.12-5.98-6.72-10.02-1.6-4.04-2.4-8.82-2.4-14.34 0-4.96.66-9.42 1.98-13.38 1.32-3.96 3.22-7.32 5.7-10.08s5.44-4.9 8.88-6.42c3.44-1.52 7.32-2.28 11.64-2.28 5.76 0 10.52.88 14.28 2.64 3.76 1.76 6.72 4.16 8.88 7.2 2.16 3.04 3.66 6.54 4.5 10.5.84 3.96 1.26 8.18 1.26 12.66Zm-29.4-22.8c-2.16.16-4.16.72-6 1.68-1.84.96-3.42 2.2-4.74 3.72-1.32 1.52-2.36 3.28-3.12 5.28-.76 2-1.14 4.12-1.14 6.36h33.12c0-2-.22-4.06-.66-6.18-.44-2.12-1.3-4.02-2.58-5.7-1.28-1.68-3.1-3.02-5.46-4.02-2.36-1-5.5-1.38-9.42-1.14Z" style="fill-rule:nonzero" transform="translate(-452.406 -63.709) scale(1.00797)"/><path d="M79.32 36.98v150.76L95 174.54l6.59-156.31-22.27 18.75Z" style="fill:url(#a);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="M79.32 36.98 57.05 18.23l6.59 156.31 15.68 13.2V36.98Z" style="fill:url(#b);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="m25.19 104.83 8.63 49.04 12.5-14.95-2.46-56.42-18.67 22.33Z" style="fill:url(#c);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="M25.19 104.83 0 90.24l16.97 53.86 16.85 9.77-8.63-49.04Z" style="fill:url(#d);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="M43.86 82.5 18.69 67.98 0 90.24l25.18 14.59L43.86 82.5Z" style="fill:#9c3;fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="m134.82 78.69-9.97 56.5 15.58-9.04L160 64.1l-25.18 14.59Z" style="fill:url(#e);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="m134.82 78.69-18.68-22.33-2.86 65 11.57 13.83 9.97-56.5Z" style="fill:url(#f);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="m160 64.1-18.69-22.26-25.17 14.52 18.67 22.33L160 64.1Z" style="fill:#ffe113;fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="M101.59 18.23 79.32 0 57.05 18.23l22.27 18.75 22.27-18.75Z" style="fill:#f3e600;fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><defs><linearGradient id="a" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="matrix(.84 -162.96 162.96 .84 89.64 184.81)"><stop offset="0" style="stop-color:#62d399;stop-opacity:1"/><stop offset=".51" style="stop-color:#acd842;stop-opacity:1"/><stop offset=".9" style="stop-color:#d7db0a;stop-opacity:1"/><stop offset="1" style="stop-color:#d7db0a;stop-opacity:1"/></linearGradient><linearGradient id="b" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="rotate(-90.565 123.412 54.953) scale(162.14)"><stop offset="0" style="stop-color:#0ba398;stop-opacity:1"/><stop offset=".5" style="stop-color:#4ca352;stop-opacity:1"/><stop offset="1" style="stop-color:#76a30a;stop-opacity:1"/></linearGradient><linearGradient id="c" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="scale(-68) rotate(88.4 .881 -1.396)"><stop offset="0" style="stop-color:#36a382;stop-opacity:1"/><stop offset=".19" style="stop-color:#36a382;stop-opacity:1"/><stop offset=".54" style="stop-color:#49a459;stop-opacity:1"/><stop offset="1" style="stop-color:#76a30b;stop-opacity:1"/></linearGradient><linearGradient id="d" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="rotate(-88 87.255 68.431) scale(62.42)"><stop offset="0" style="stop-color:#267880;stop-opacity:1"/><stop offset=".51" style="stop-color:#457a5c;stop-opacity:1"/><stop offset="1" style="stop-color:#717516;stop-opacity:1"/></linearGradient><linearGradient id="e" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="rotate(-79.1 149.53 -14.065) scale(73.28)"><stop offset="0" style="stop-color:#b0d939;stop-opacity:1"/><stop offset="1" style="stop-color:#eadb04;stop-opacity:1"/></linearGradient><linearGradient id="f" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="rotate(-67.997 148.705 -15.558) scale(69.8226)"><stop offset="0" style="stop-color:#74af52;stop-opacity:1"/><stop offset=".17" style="stop-color:#74af52;stop-opacity:1"/><stop offset=".48" style="stop-color:#99be32;stop-opacity:1"/><stop offset="1" style="stop-color:#c0c40a;stop-opacity:1"/></linearGradient></defs></svg>',qoe=btoa(Joe),$oe="data:image/svg+xml;charset=utf-8;base64,"+qoe,eae=$oe;/**
 * postprocessing v6.36.2 build Tue Sep 10 2024
 * https://github.com/pmndrs/postprocessing
 * Copyright 2015-2024 Raoul van Rschen
 * @license Zlib
 */var gL=1/1e3,tae=1e3,iae=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(n){typeof document<"u"&&document.hidden!==void 0&&(n?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=n)}get delta(){return this._delta*gL}get fixedDelta(){return this._fixedDelta*gL}set fixedDelta(n){this._fixedDelta=n*tae}get elapsed(){return this._elapsed*gL}update(n){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(n!==void 0?n:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}getDelta(){return this.delta}getElapsed(){return this.elapsed}handleEvent(n){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},nae=(()=>{const n=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),e=new Float32Array([0,0,2,0,0,2]),i=new dt;return i.setAttribute("position",new qe(n,3)),i.setAttribute("uv",new qe(e,2)),i})(),Ps=class S3{static get fullscreenGeometry(){return nae}constructor(e="Pass",i=new Ls,s=new mv){this.name=e,this.renderer=null,this.scene=i,this.camera=s,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){const i=this.fullscreenMaterial;i!==null&&(i.needsUpdate=!0),this.rtt=!e}}set mainScene(e){}set mainCamera(e){}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let i=this.screen;i!==null?i.material=e:(i=new pe(S3.fullscreenGeometry,e),i.frustumCulled=!1,this.scene===null&&(this.scene=new Ls),this.scene.add(i),this.screen=i)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,i=Ys){}render(e,i,s,r,o){throw new Error("Render method not implemented!")}setSize(e,i){}initialize(e,i,s){}dispose(){for(const e of Object.keys(this)){const i=this[e];(i instanceof Zt||i instanceof Ft||i instanceof Vt||i instanceof S3)&&this[e].dispose()}this.fullscreenMaterial!==null&&this.fullscreenMaterial.dispose()}},sae=class extends Ps{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(n,e,i,s,r){const o=n.state.buffers.stencil;o.setLocked(!1),o.setTest(!1)}},rae=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <colorspace_fragment>
#include <dithering_fragment>
}`,nm="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",W5=class extends kt{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new Ce(null),opacity:new Ce(1)},blending:dn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:rae,vertexShader:nm})}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}getOpacity(n){return this.uniforms.opacity.value}setOpacity(n){this.uniforms.opacity.value=n}},H5=class extends Ps{constructor(n,e=!0){super("CopyPass"),this.fullscreenMaterial=new W5,this.needsSwap=!1,this.renderTarget=n,n===void 0&&(this.renderTarget=new Zt(1,1,{minFilter:Ot,magFilter:Ot,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=e}get resize(){return this.autoResize}set resize(n){this.autoResize=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(n){this.autoResize=n}render(n,e,i,s,r){this.fullscreenMaterial.inputBuffer=e.texture,n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,e){this.autoResize&&this.renderTarget.setSize(n,e)}initialize(n,e,i){i!==void 0&&(this.renderTarget.texture.type=i,i!==pn?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":n!==null&&n.outputColorSpace===vt&&(this.renderTarget.texture.colorSpace=vt))}},j5=new Ae,L_=class extends Ps{constructor(n=!0,e=!0,i=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=n,this.depth=e,this.stencil=i,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(n,e,i){this.color=n,this.depth=e,this.stencil=i}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(n){this.overrideClearColor=n}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(n){this.overrideClearAlpha=n}render(n,e,i,s,r){const o=this.overrideClearColor,a=this.overrideClearAlpha,l=n.getClearAlpha(),c=o!==null,h=a>=0;c?(n.getClearColor(j5),n.setClearColor(o,h?a:l)):h&&n.setClearAlpha(a),n.setRenderTarget(this.renderToScreen?null:e),n.clear(this.color,this.depth,this.stencil),c?n.setClearColor(j5,l):h&&n.setClearAlpha(l)}},oae=class extends Ps{constructor(n,e){super("MaskPass",n,e),this.needsSwap=!1,this.clearPass=new L_(!1,!1,!0),this.inverse=!1}set mainScene(n){this.scene=n}set mainCamera(n){this.camera=n}get inverted(){return this.inverse}set inverted(n){this.inverse=n}get clear(){return this.clearPass.enabled}set clear(n){this.clearPass.enabled=n}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(n){this.inverted=n}render(n,e,i,s,r){const o=n.getContext(),a=n.state.buffers,l=this.scene,c=this.camera,h=this.clearPass,u=this.inverted?0:1,d=1-u;a.color.setMask(!1),a.depth.setMask(!1),a.color.setLocked(!0),a.depth.setLocked(!0),a.stencil.setTest(!0),a.stencil.setOp(o.REPLACE,o.REPLACE,o.REPLACE),a.stencil.setFunc(o.ALWAYS,u,4294967295),a.stencil.setClear(d),a.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?h.render(n,null):(h.render(n,e),h.render(n,i))),this.renderToScreen?(n.setRenderTarget(null),n.render(l,c)):(n.setRenderTarget(e),n.render(l,c),n.setRenderTarget(i),n.render(l,c)),a.color.setLocked(!1),a.depth.setLocked(!1),a.stencil.setLocked(!1),a.stencil.setFunc(o.EQUAL,1,4294967295),a.stencil.setOp(o.KEEP,o.KEEP,o.KEEP),a.stencil.setLocked(!0)}},yL=class{constructor(n=null,{depthBuffer:e=!0,stencilBuffer:i=!1,multisampling:s=0,frameBufferType:r}={}){this.renderer=null,this.inputBuffer=this.createBuffer(e,i,r,s),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new H5,this.depthTexture=null,this.passes=[],this.timer=new iae,this.autoRenderToScreen=!0,this.setRenderer(n)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(n){const e=this.inputBuffer,i=this.multisampling;i>0&&n>0?(this.inputBuffer.samples=n,this.outputBuffer.samples=n,this.inputBuffer.dispose(),this.outputBuffer.dispose()):i!==n&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(e.depthBuffer,e.stencilBuffer,e.texture.type,n),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(n){if(this.renderer=n,n!==null){const e=n.getSize(new Y),i=n.getContext().getContextAttributes().alpha,s=this.inputBuffer.texture.type;s===pn&&n.outputColorSpace===vt&&(this.inputBuffer.texture.colorSpace=vt,this.outputBuffer.texture.colorSpace=vt,this.inputBuffer.dispose(),this.outputBuffer.dispose()),n.autoClear=!1,this.setSize(e.width,e.height);for(const r of this.passes)r.initialize(n,i,s)}}replaceRenderer(n,e=!0){const i=this.renderer,s=i.domElement.parentNode;return this.setRenderer(n),e&&s!==null&&(s.removeChild(i.domElement),s.appendChild(n.domElement)),i}createDepthTexture(){const n=this.depthTexture=new tg;return this.inputBuffer.depthTexture=n,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(n.format=Cu,n.type=lh):n.type=_r,n}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const n of this.passes)n.setDepthTexture(null)}}createBuffer(n,e,i,s){const r=this.renderer,o=r===null?new Y:r.getDrawingBufferSize(new Y),a={minFilter:Ot,magFilter:Ot,stencilBuffer:e,depthBuffer:n,type:i},l=new Zt(o.width,o.height,a);return s>0&&(l.ignoreDepthForMultisampleCopy=!1,l.samples=s),i===pn&&r!==null&&r.outputColorSpace===vt&&(l.texture.colorSpace=vt),l.texture.name="EffectComposer.Buffer",l.texture.generateMipmaps=!1,l}setMainScene(n){for(const e of this.passes)e.mainScene=n}setMainCamera(n){for(const e of this.passes)e.mainCamera=n}addPass(n,e){const i=this.passes,s=this.renderer,r=s.getDrawingBufferSize(new Y),o=s.getContext().getContextAttributes().alpha,a=this.inputBuffer.texture.type;if(n.setRenderer(s),n.setSize(r.width,r.height),n.initialize(s,o,a),this.autoRenderToScreen&&(i.length>0&&(i[i.length-1].renderToScreen=!1),n.renderToScreen&&(this.autoRenderToScreen=!1)),e!==void 0?i.splice(e,0,n):i.push(n),this.autoRenderToScreen&&(i[i.length-1].renderToScreen=!0),n.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){const l=this.createDepthTexture();for(n of i)n.setDepthTexture(l)}else n.setDepthTexture(this.depthTexture)}removePass(n){const e=this.passes,i=e.indexOf(n);if(i!==-1&&e.splice(i,1).length>0){if(this.depthTexture!==null){const s=(r,o)=>r||o.needsDepthTexture;e.reduce(s,!1)||(n.getDepthTexture()===this.depthTexture&&n.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&i===e.length&&(n.renderToScreen=!1,e.length>0&&(e[e.length-1].renderToScreen=!0))}}removeAllPasses(){const n=this.passes;this.deleteDepthTexture(),n.length>0&&(this.autoRenderToScreen&&(n[n.length-1].renderToScreen=!1),this.passes=[])}render(n){const e=this.renderer,i=this.copyPass;let s=this.inputBuffer,r=this.outputBuffer,o=!1,a,l,c;n===void 0&&(this.timer.update(),n=this.timer.getDelta());for(const h of this.passes)h.enabled&&(h.render(e,s,r,n,o),h.needsSwap&&(o&&(i.renderToScreen=h.renderToScreen,a=e.getContext(),l=e.state.buffers.stencil,l.setFunc(a.NOTEQUAL,1,4294967295),i.render(e,s,r,n,o),l.setFunc(a.EQUAL,1,4294967295)),c=s,s=r,r=c),h instanceof oae?o=!0:h instanceof sae&&(o=!1))}setSize(n,e,i){const s=this.renderer,r=s.getSize(new Y);(n===void 0||e===void 0)&&(n=r.width,e=r.height),(r.width!==n||r.height!==e)&&s.setSize(n,e,i);const o=s.getDrawingBufferSize(new Y);this.inputBuffer.setSize(o.width,o.height),this.outputBuffer.setSize(o.width,o.height);for(const a of this.passes)a.setSize(o.width,o.height)}reset(){this.dispose(),this.autoRenderToScreen=!0}dispose(){for(const n of this.passes)n.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose(),Ps.fullscreenGeometry.dispose()}},Yo={NONE:0,DEPTH:1,CONVOLUTION:2},Si={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},aae=class{constructor(){this.shaderParts=new Map([[Si.FRAGMENT_HEAD,null],[Si.FRAGMENT_MAIN_UV,null],[Si.FRAGMENT_MAIN_IMAGE,null],[Si.VERTEX_HEAD,null],[Si.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=Yo.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=Bi}},vL=!1,Q5=class{constructor(n=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(n),this.meshCount=0,this.replaceMaterial=e=>{if(e.isMesh){let i;if(e.material.flatShading)switch(e.material.side){case xi:i=this.materialsFlatShadedDoubleSide;break;case un:i=this.materialsFlatShadedBackSide;break;default:i=this.materialsFlatShaded;break}else switch(e.material.side){case xi:i=this.materialsDoubleSide;break;case un:i=this.materialsBackSide;break;default:i=this.materials;break}this.originalMaterials.set(e,e.material),e.isSkinnedMesh?e.material=i[2]:e.isInstancedMesh?e.material=i[1]:e.material=i[0],++this.meshCount}}}cloneMaterial(n){if(!(n instanceof kt))return n.clone();const e=n.uniforms,i=new Map;for(const r in e){const o=e[r].value;o.isRenderTargetTexture&&(e[r].value=null,i.set(r,o))}const s=n.clone();for(const r of i)e[r[0]].value=r[1],s.uniforms[r[0]].value=r[1];return s}setMaterial(n){if(this.disposeMaterials(),this.material=n,n!==null){const e=this.materials=[this.cloneMaterial(n),this.cloneMaterial(n),this.cloneMaterial(n)];for(const i of e)i.uniforms=Object.assign({},n.uniforms),i.side=Un;e[2].skinning=!0,this.materialsBackSide=e.map(i=>{const s=this.cloneMaterial(i);return s.uniforms=Object.assign({},n.uniforms),s.side=un,s}),this.materialsDoubleSide=e.map(i=>{const s=this.cloneMaterial(i);return s.uniforms=Object.assign({},n.uniforms),s.side=xi,s}),this.materialsFlatShaded=e.map(i=>{const s=this.cloneMaterial(i);return s.uniforms=Object.assign({},n.uniforms),s.flatShading=!0,s}),this.materialsFlatShadedBackSide=e.map(i=>{const s=this.cloneMaterial(i);return s.uniforms=Object.assign({},n.uniforms),s.flatShading=!0,s.side=un,s}),this.materialsFlatShadedDoubleSide=e.map(i=>{const s=this.cloneMaterial(i);return s.uniforms=Object.assign({},n.uniforms),s.flatShading=!0,s.side=xi,s})}}render(n,e,i){const s=n.shadowMap.enabled;if(n.shadowMap.enabled=!1,vL){const r=this.originalMaterials;this.meshCount=0,e.traverse(this.replaceMaterial),n.render(e,i);for(const o of r)o[0].material=o[1];this.meshCount!==r.size&&r.clear()}else{const r=e.overrideMaterial;e.overrideMaterial=this.material,n.render(e,i),e.overrideMaterial=r}n.shadowMap.enabled=s}disposeMaterials(){if(this.material!==null){const n=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const e of n)e.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return vL}static set workaroundEnabled(n){vL=n}},Wu=-1,Ri=class extends Rs{constructor(n,e=Wu,i=Wu,s=1){super(),this.resizable=n,this.baseSize=new Y(1,1),this.preferredSize=new Y(e,i),this.target=this.preferredSize,this.s=s,this.effectiveSize=new Y,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){const n=this.baseSize,e=this.preferredSize,i=this.effectiveSize,s=this.scale;e.width!==Wu?i.width=e.width:e.height!==Wu?i.width=Math.round(e.height*(n.width/Math.max(n.height,1))):i.width=Math.round(n.width*s),e.height!==Wu?i.height=e.height:e.width!==Wu?i.height=Math.round(e.width/Math.max(n.width/Math.max(n.height,1),1)):i.height=Math.round(n.height*s)}get width(){return this.effectiveSize.width}set width(n){this.preferredWidth=n}get height(){return this.effectiveSize.height}set height(n){this.preferredHeight=n}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(n){this.s!==n&&(this.s=n,this.preferredSize.setScalar(Wu),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(n){this.scale=n}get baseWidth(){return this.baseSize.width}set baseWidth(n){this.baseSize.width!==n&&(this.baseSize.width=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(n){this.baseWidth=n}get baseHeight(){return this.baseSize.height}set baseHeight(n){this.baseSize.height!==n&&(this.baseSize.height=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(n){this.baseHeight=n}setBaseSize(n,e){(this.baseSize.width!==n||this.baseSize.height!==e)&&(this.baseSize.set(n,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(n){this.preferredSize.width!==n&&(this.preferredSize.width=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(n){this.preferredWidth=n}get preferredHeight(){return this.preferredSize.height}set preferredHeight(n){this.preferredSize.height!==n&&(this.preferredSize.height=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(n){this.preferredHeight=n}setPreferredSize(n,e){(this.preferredSize.width!==n||this.preferredSize.height!==e)&&(this.preferredSize.set(n,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(n){this.s=n.scale,this.baseSize.set(n.baseWidth,n.baseHeight),this.preferredSize.set(n.preferredWidth,n.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return Wu}},lae=class{constructor(n=0){this.nextId=n}getNextId(){return this.nextId++}reset(n=0){return this.nextId=n,this}},bL=new lae(2),cae=class extends Set{constructor(n,e=bL.getNextId()){super(),this.exclusive=!1,this._layer=e,(this._layer<1||this._layer>31)&&(console.warn("Layer out of range, resetting to 2"),bL.reset(2),this._layer=bL.getNextId()),n!==void 0&&this.set(n)}get layer(){return this._layer}set layer(n){const e=this._layer;for(const i of this)i.layers.disable(e),i.layers.enable(n);this._layer=n}getLayer(){return this.layer}setLayer(n){this.layer=n}isExclusive(){return this.exclusive}setExclusive(n){this.exclusive=n}clear(){const n=this.layer;for(const e of this)e.layers.disable(n);return super.clear()}set(n){this.clear();for(const e of n)this.add(e);return this}indexOf(n){return this.has(n)?0:-1}add(n){return this.exclusive?n.layers.set(this.layer):n.layers.enable(this.layer),super.add(n)}delete(n){return this.has(n)&&n.layers.disable(this.layer),super.delete(n)}toggle(n){let e;return this.has(n)?(this.delete(n),e=!1):(this.add(n),e=!0),e}setVisible(n){for(const e of this)n?e.layers.enable(0):e.layers.disable(0);return this}},Ht={SKIP:9,SET:30,ADD:0,ALPHA:1,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},hae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y,opacity);}",uae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,min(y.a,opacity));}",dae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y)*0.5,opacity);}",pae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.rg,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",mae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(step(0.0,y)*(1.0-min(vec4(1.0),(1.0-x)/y)),vec4(1.0),step(1.0,x));return mix(x,z,opacity);}",fae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=step(0.0,x)*mix(min(vec4(1.0),x/max(1.0-y,1e-9)),vec4(1.0),step(1.0,y));return mix(x,z,opacity);}",gae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x,y),opacity);}",yae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,abs(x-y),opacity);}",vae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x/max(y,1e-12),opacity);}",bae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y-2.0*x*y),opacity);}",Aae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 a=min(x,1.0),b=min(y,1.0);vec4 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,y));return mix(x,z,opacity);}",xae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,step(1.0,x+y),opacity);}",wae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.r,xHSL.gb));return vec4(mix(x.rgb,z,opacity),y.a);}",_ae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-y,opacity);}",Sae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y*(1.0-x),opacity);}",Cae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x,y),opacity);}",Mae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(y+x-1.0,0.0,1.0),opacity);}",Eae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x+y,1.0),opacity);}",Tae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(2.0*y+x-1.0,0.0,1.0),opacity);}",Rae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.rg,yHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",Iae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x*y,opacity);}",Lae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-abs(1.0-x-y),opacity);}",Pae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,opacity);}",Bae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(2.0*y*x,1.0-2.0*(1.0-y)*(1.0-x),step(0.5,x));return mix(x,z,opacity);}",kae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 z=mix(mix(y2,x,step(0.5*x,y)),max(vec4(0.0),y2-1.0),step(x,(y2-1.0)));return mix(x,z,opacity);}",Dae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(min(x*x/max(1.0-y,1e-12),1.0),y,step(1.0,y));return mix(x,z,opacity);}",Oae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.r,yHSL.g,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",Gae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y-min(x*y,1.0),opacity);}",zae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 w=step(0.5,y);vec4 z=mix(x-(1.0-y2)*x*(1.0-x),mix(x+(y2-1.0)*(sqrt(x)-x),x+(y2-1.0)*x*((16.0*x-12.0)*x+3.0),w*(1.0-step(0.25,x))),w);return mix(x,z,opacity);}",Fae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}",Nae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x+y-1.0,0.0),opacity);}",Uae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(max(1.0-min((1.0-x)/(2.0*y),1.0),0.0),min(x/(2.0*(1.0-y)),1.0),step(0.5,y));return mix(x,z,opacity);}",Vae=new Map([[Ht.ADD,hae],[Ht.ALPHA,uae],[Ht.AVERAGE,dae],[Ht.COLOR,pae],[Ht.COLOR_BURN,mae],[Ht.COLOR_DODGE,fae],[Ht.DARKEN,gae],[Ht.DIFFERENCE,yae],[Ht.DIVIDE,vae],[Ht.DST,null],[Ht.EXCLUSION,bae],[Ht.HARD_LIGHT,Aae],[Ht.HARD_MIX,xae],[Ht.HUE,wae],[Ht.INVERT,_ae],[Ht.INVERT_RGB,Sae],[Ht.LIGHTEN,Cae],[Ht.LINEAR_BURN,Mae],[Ht.LINEAR_DODGE,Eae],[Ht.LINEAR_LIGHT,Tae],[Ht.LUMINOSITY,Rae],[Ht.MULTIPLY,Iae],[Ht.NEGATION,Lae],[Ht.NORMAL,Pae],[Ht.OVERLAY,Bae],[Ht.PIN_LIGHT,kae],[Ht.REFLECT,Dae],[Ht.SATURATION,Oae],[Ht.SCREEN,Gae],[Ht.SOFT_LIGHT,zae],[Ht.SRC,Fae],[Ht.SUBTRACT,Nae],[Ht.VIVID_LIGHT,Uae]]),Xae=class extends Rs{constructor(n,e=1){super(),this._blendFunction=n,this.opacity=new Ce(e)}getOpacity(){return this.opacity.value}setOpacity(n){this.opacity.value=n}get blendFunction(){return this._blendFunction}set blendFunction(n){this._blendFunction=n,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(n){this.blendFunction=n}getShaderCode(){return Vae.get(this.blendFunction)}},cc={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},Wae=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,Hae="uniform vec4 texelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",jae=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],Z5=class extends kt{constructor(n=new Ze){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new Ce(null),texelSize:new Ce(new Ze),scale:new Ce(1),kernel:new Ce(0)},blending:dn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Wae,vertexShader:Hae}),this.setTexelSize(n.x,n.y),this.kernelSize=cc.MEDIUM}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.inputBuffer=n}get kernelSequence(){return jae[this.kernelSize]}get scale(){return this.uniforms.scale.value}set scale(n){this.uniforms.scale.value=n}getScale(){return this.uniforms.scale.value}setScale(n){this.uniforms.scale.value=n}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(n){this.uniforms.kernel.value=n}setKernel(n){this.kernel=n}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e,n*.5,e*.5)}setSize(n,e){const i=1/n,s=1/e;this.uniforms.texelSize.value.set(i,s,i*.5,s*.5)}},AL=class extends Ps{constructor({kernelSize:n=cc.MEDIUM,resolutionScale:e=.5,width:i=Ri.AUTO_SIZE,height:s=Ri.AUTO_SIZE,resolutionX:r=i,resolutionY:o=s}={}){super("KawaseBlurPass"),this.renderTargetA=new Zt(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";const a=this.resolution=new Ri(this,r,o,e);a.addEventListener("change",l=>this.setSize(a.baseWidth,a.baseHeight)),this._blurMaterial=new Z5,this._blurMaterial.kernelSize=n,this.copyMaterial=new W5}getResolution(){return this.resolution}get blurMaterial(){return this._blurMaterial}set blurMaterial(n){this._blurMaterial=n}get dithering(){return this.copyMaterial.dithering}set dithering(n){this.copyMaterial.dithering=n}get kernelSize(){return this.blurMaterial.kernelSize}set kernelSize(n){this.blurMaterial.kernelSize=n}get width(){return this.resolution.width}set width(n){this.resolution.preferredWidth=n}get height(){return this.resolution.height}set height(n){this.resolution.preferredHeight=n}get scale(){return this.blurMaterial.scale}set scale(n){this.blurMaterial.scale=n}getScale(){return this.blurMaterial.scale}setScale(n){this.blurMaterial.scale=n}getKernelSize(){return this.kernelSize}setKernelSize(n){this.kernelSize=n}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,e,i,s,r){const o=this.scene,a=this.camera,l=this.renderTargetA,c=this.renderTargetB,h=this.blurMaterial,u=h.kernelSequence;let d=e;this.fullscreenMaterial=h;for(let m=0,f=u.length;m<f;++m){const g=m&1?c:l;h.kernel=u[m],h.inputBuffer=d.texture,n.setRenderTarget(g),n.render(o,a),d=g}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=d.texture,n.setRenderTarget(this.renderToScreen?null:i),n.render(o,a)}setSize(n,e){const i=this.resolution;i.setBaseSize(n,e);const s=i.width,r=i.height;this.renderTargetA.setSize(s,r),this.renderTargetB.setSize(s,r),this.blurMaterial.setSize(n,e)}initialize(n,e,i){i!==void 0&&(this.renderTargetA.texture.type=i,this.renderTargetB.texture.type=i,i!==pn?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):n!==null&&n.outputColorSpace===vt&&(this.renderTargetA.texture.colorSpace=vt,this.renderTargetB.texture.colorSpace=vt))}static get AUTO_SIZE(){return Ri.AUTO_SIZE}},Qae=`#include <common>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);l*=low*high;
#elif defined(THRESHOLD)
l=smoothstep(threshold,threshold+smoothing,l)*l;
#endif
#ifdef COLOR
gl_FragColor=vec4(texel.rgb*clamp(l,0.0,1.0),l);
#else
gl_FragColor=vec4(l);
#endif
}`,Zae=class extends kt{constructor(n=!1,e=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:sh.replace(/\D+/g,"")},uniforms:{inputBuffer:new Ce(null),threshold:new Ce(0),smoothing:new Ce(1),range:new Ce(null)},blending:dn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Qae,vertexShader:nm}),this.colorOutput=n,this.luminanceRange=e}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get threshold(){return this.uniforms.threshold.value}set threshold(n){this.smoothing>0||n>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=n}getThreshold(){return this.threshold}setThreshold(n){this.threshold=n}get smoothing(){return this.uniforms.smoothing.value}set smoothing(n){this.threshold>0||n>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=n}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(n){this.smoothing=n}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(n){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(n){n?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(n){return this.colorOutput}setColorOutputEnabled(n){this.colorOutput=n}get useRange(){return this.luminanceRange!==null}set useRange(n){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(n){n!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=n,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(n){this.luminanceRange=n}},Y5=class extends Ps{constructor({renderTarget:n,luminanceRange:e,colorOutput:i,resolutionScale:s=1,width:r=Ri.AUTO_SIZE,height:o=Ri.AUTO_SIZE,resolutionX:a=r,resolutionY:l=o}={}){super("LuminancePass"),this.fullscreenMaterial=new Zae(i,e),this.needsSwap=!1,this.renderTarget=n,this.renderTarget===void 0&&(this.renderTarget=new Zt(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target");const c=this.resolution=new Ri(this,a,l,s);c.addEventListener("change",h=>this.setSize(c.baseWidth,c.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(n,e,i,s,r){const o=this.fullscreenMaterial;o.inputBuffer=e.texture,n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,e){const i=this.resolution;i.setBaseSize(n,e),this.renderTarget.setSize(i.width,i.height)}initialize(n,e,i){i!==void 0&&i!==pn&&(this.renderTarget.texture.type=i,this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},Yae=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#define WEIGHT_INNER 0.125
#define WEIGHT_OUTER 0.0555555
varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;float clampToBorder(const in vec2 uv){return float(uv.s>=0.0&&uv.s<=1.0&&uv.t>=0.0&&uv.t<=1.0);}void main(){vec4 c=vec4(0.0);vec4 w=WEIGHT_INNER*vec4(clampToBorder(vUv00),clampToBorder(vUv01),clampToBorder(vUv02),clampToBorder(vUv03));c+=w.x*texture2D(inputBuffer,vUv00);c+=w.y*texture2D(inputBuffer,vUv01);c+=w.z*texture2D(inputBuffer,vUv02);c+=w.w*texture2D(inputBuffer,vUv03);w=WEIGHT_OUTER*vec4(clampToBorder(vUv04),clampToBorder(vUv05),clampToBorder(vUv06),clampToBorder(vUv07));c+=w.x*texture2D(inputBuffer,vUv04);c+=w.y*texture2D(inputBuffer,vUv05);c+=w.z*texture2D(inputBuffer,vUv06);c+=w.w*texture2D(inputBuffer,vUv07);w=WEIGHT_OUTER*vec4(clampToBorder(vUv08),clampToBorder(vUv09),clampToBorder(vUv10),clampToBorder(vUv11));c+=w.x*texture2D(inputBuffer,vUv08);c+=w.y*texture2D(inputBuffer,vUv09);c+=w.z*texture2D(inputBuffer,vUv10);c+=w.w*texture2D(inputBuffer,vUv11);c+=WEIGHT_OUTER*texture2D(inputBuffer,vUv);gl_FragColor=c;
#include <colorspace_fragment>
}`,Kae="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;void main(){vUv=position.xy*0.5+0.5;vUv00=vUv+texelSize*vec2(-1.0,1.0);vUv01=vUv+texelSize*vec2(1.0,1.0);vUv02=vUv+texelSize*vec2(-1.0,-1.0);vUv03=vUv+texelSize*vec2(1.0,-1.0);vUv04=vUv+texelSize*vec2(-2.0,2.0);vUv05=vUv+texelSize*vec2(0.0,2.0);vUv06=vUv+texelSize*vec2(2.0,2.0);vUv07=vUv+texelSize*vec2(-2.0,0.0);vUv08=vUv+texelSize*vec2(2.0,0.0);vUv09=vUv+texelSize*vec2(-2.0,-2.0);vUv10=vUv+texelSize*vec2(0.0,-2.0);vUv11=vUv+texelSize*vec2(2.0,-2.0);gl_Position=vec4(position.xy,1.0,1.0);}",Jae=class extends kt{constructor(){super({name:"DownsamplingMaterial",uniforms:{inputBuffer:new Ce(null),texelSize:new Ce(new Y)},blending:dn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Yae,vertexShader:Kae})}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},qae=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;uniform mediump sampler2D supportBuffer;
#else
uniform lowp sampler2D inputBuffer;uniform lowp sampler2D supportBuffer;
#endif
uniform float radius;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vec4 c=vec4(0.0);c+=texture2D(inputBuffer,vUv0)*0.0625;c+=texture2D(inputBuffer,vUv1)*0.125;c+=texture2D(inputBuffer,vUv2)*0.0625;c+=texture2D(inputBuffer,vUv3)*0.125;c+=texture2D(inputBuffer,vUv)*0.25;c+=texture2D(inputBuffer,vUv4)*0.125;c+=texture2D(inputBuffer,vUv5)*0.0625;c+=texture2D(inputBuffer,vUv6)*0.125;c+=texture2D(inputBuffer,vUv7)*0.0625;vec4 baseColor=texture2D(supportBuffer,vUv);gl_FragColor=mix(baseColor,c,radius);
#include <colorspace_fragment>
}`,$ae="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,1.0);vUv1=vUv+texelSize*vec2(0.0,1.0);vUv2=vUv+texelSize*vec2(1.0,1.0);vUv3=vUv+texelSize*vec2(-1.0,0.0);vUv4=vUv+texelSize*vec2(1.0,0.0);vUv5=vUv+texelSize*vec2(-1.0,-1.0);vUv6=vUv+texelSize*vec2(0.0,-1.0);vUv7=vUv+texelSize*vec2(1.0,-1.0);gl_Position=vec4(position.xy,1.0,1.0);}",ele=class extends kt{constructor(){super({name:"UpsamplingMaterial",uniforms:{inputBuffer:new Ce(null),supportBuffer:new Ce(null),texelSize:new Ce(new Y),radius:new Ce(.85)},blending:dn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:qae,vertexShader:$ae})}set inputBuffer(n){this.uniforms.inputBuffer.value=n}set supportBuffer(n){this.uniforms.supportBuffer.value=n}get radius(){return this.uniforms.radius.value}set radius(n){this.uniforms.radius.value=n}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},tle=class extends Ps{constructor(){super("MipmapBlurPass"),this.needsSwap=!1,this.renderTarget=new Zt(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Upsampling.Mipmap0",this.downsamplingMipmaps=[],this.upsamplingMipmaps=[],this.downsamplingMaterial=new Jae,this.upsamplingMaterial=new ele,this.resolution=new Y}get texture(){return this.renderTarget.texture}get levels(){return this.downsamplingMipmaps.length}set levels(n){if(this.levels!==n){const e=this.renderTarget;this.dispose(),this.downsamplingMipmaps=[],this.upsamplingMipmaps=[];for(let i=0;i<n;++i){const s=e.clone();s.texture.name="Downsampling.Mipmap"+i,this.downsamplingMipmaps.push(s)}this.upsamplingMipmaps.push(e);for(let i=1,s=n-1;i<s;++i){const r=e.clone();r.texture.name="Upsampling.Mipmap"+i,this.upsamplingMipmaps.push(r)}this.setSize(this.resolution.x,this.resolution.y)}}get radius(){return this.upsamplingMaterial.radius}set radius(n){this.upsamplingMaterial.radius=n}render(n,e,i,s,r){const{scene:o,camera:a}=this,{downsamplingMaterial:l,upsamplingMaterial:c}=this,{downsamplingMipmaps:h,upsamplingMipmaps:u}=this;let d=e;this.fullscreenMaterial=l;for(let m=0,f=h.length;m<f;++m){const g=h[m];l.setSize(d.width,d.height),l.inputBuffer=d.texture,n.setRenderTarget(g),n.render(o,a),d=g}this.fullscreenMaterial=c;for(let m=u.length-1;m>=0;--m){const f=u[m];c.setSize(d.width,d.height),c.inputBuffer=d.texture,c.supportBuffer=h[m].texture,n.setRenderTarget(f),n.render(o,a),d=f}}setSize(n,e){const i=this.resolution;i.set(n,e);let s=i.width,r=i.height;for(let o=0,a=this.downsamplingMipmaps.length;o<a;++o)s=Math.round(s*.5),r=Math.round(r*.5),this.downsamplingMipmaps[o].setSize(s,r),o<this.upsamplingMipmaps.length&&this.upsamplingMipmaps[o].setSize(s,r)}initialize(n,e,i){if(i!==void 0){const s=this.downsamplingMipmaps.concat(this.upsamplingMipmaps);for(const r of s)r.texture.type=i;if(i!==pn)this.downsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.upsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1";else if(n!==null&&n.outputColorSpace===vt)for(const r of s)r.texture.colorSpace=vt}}dispose(){super.dispose();for(const n of this.downsamplingMipmaps.concat(this.upsamplingMipmaps))n.dispose()}},so=class extends Rs{constructor(n,e,{attributes:i=Yo.NONE,blendFunction:s=Ht.NORMAL,defines:r=new Map,uniforms:o=new Map,extensions:a=null,vertexShader:l=null}={}){super(),this.name=n,this.renderer=null,this.attributes=i,this.fragmentShader=e,this.vertexShader=l,this.defines=r,this.uniforms=o,this.extensions=a,this.blendMode=new Xae(s),this.blendMode.addEventListener("change",c=>this.setChanged()),this._inputColorSpace=Bi,this._outputColorSpace=Co}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(n){this._inputColorSpace=n,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(n){this._outputColorSpace=n,this.setChanged()}set mainScene(n){}set mainCamera(n){}getName(){return this.name}setRenderer(n){this.renderer=n}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(n){this.attributes=n,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(n){this.fragmentShader=n,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(n){this.vertexShader=n,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(n,e=Ys){}update(n,e,i){}setSize(n,e){}initialize(n,e,i){}dispose(){for(const n of Object.keys(this)){const e=this[n];(e instanceof Zt||e instanceof Ft||e instanceof Vt||e instanceof Ps)&&this[n].dispose()}}},ile=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 texel=texture2D(map,uv);outputColor=vec4(texel.rgb*intensity,texel.a);}`,xL=class extends so{constructor({blendFunction:n=Ht.SCREEN,luminanceThreshold:e=.9,luminanceSmoothing:i=.025,mipmapBlur:s=!1,intensity:r=1,radius:o=.85,levels:a=8,kernelSize:l=cc.LARGE,resolutionScale:c=.5,width:h=Ri.AUTO_SIZE,height:u=Ri.AUTO_SIZE,resolutionX:d=h,resolutionY:m=u}={}){super("BloomEffect",ile,{blendFunction:n,uniforms:new Map([["map",new Ce(null)],["intensity",new Ce(r)]])}),this.renderTarget=new Zt(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.blurPass=new AL({kernelSize:l}),this.luminancePass=new Y5({colorOutput:!0}),this.luminanceMaterial.threshold=e,this.luminanceMaterial.smoothing=i,this.mipmapBlurPass=new tle,this.mipmapBlurPass.enabled=s,this.mipmapBlurPass.radius=o,this.mipmapBlurPass.levels=a,this.uniforms.get("map").value=s?this.mipmapBlurPass.texture:this.renderTarget.texture;const f=this.resolution=new Ri(this,d,m,c);f.addEventListener("change",g=>this.setSize(f.baseWidth,f.baseHeight))}get texture(){return this.mipmapBlurPass.enabled?this.mipmapBlurPass.texture:this.renderTarget.texture}getTexture(){return this.texture}getResolution(){return this.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(n){this.resolution.preferredWidth=n}get height(){return this.resolution.height}set height(n){this.resolution.preferredHeight=n}get dithering(){return this.blurPass.dithering}set dithering(n){this.blurPass.dithering=n}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(n){this.blurPass.kernelSize=n}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(n){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(n){this.uniforms.get("intensity").value=n}getIntensity(){return this.intensity}setIntensity(n){this.intensity=n}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}update(n,e,i){const s=this.renderTarget,r=this.luminancePass;r.enabled?(r.render(n,e),this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(n,r.renderTarget):this.blurPass.render(n,r.renderTarget,s)):this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(n,e):this.blurPass.render(n,e,s)}setSize(n,e){const i=this.resolution;i.setBaseSize(n,e),this.renderTarget.setSize(i.width,i.height),this.blurPass.resolution.copy(i),this.luminancePass.setSize(n,e),this.mipmapBlurPass.setSize(n,e)}initialize(n,e,i){this.blurPass.initialize(n,e,i),this.luminancePass.initialize(n,e,i),this.mipmapBlurPass.initialize(n,e,i),i!==void 0&&(this.renderTarget.texture.type=i,n!==null&&n.outputColorSpace===vt&&(this.renderTarget.texture.colorSpace=vt))}},nle="uniform float brightness;uniform float contrast;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=inputColor.rgb+vec3(brightness-0.5);if(contrast>0.0){color/=vec3(1.0-contrast);}else{color*=vec3(1.0+contrast);}outputColor=vec4(color+vec3(0.5),inputColor.a);}",K5=class extends so{constructor({blendFunction:n=Ht.SRC,brightness:e=0,contrast:i=0}={}){super("BrightnessContrastEffect",nle,{blendFunction:n,uniforms:new Map([["brightness",new Ce(e)],["contrast",new Ce(i)]])}),this.inputColorSpace=vt}get brightness(){return this.uniforms.get("brightness").value}set brightness(n){this.uniforms.get("brightness").value=n}getBrightness(){return this.brightness}setBrightness(n){this.brightness=n}get contrast(){return this.uniforms.get("contrast").value}set contrast(n){this.uniforms.get("contrast").value=n}getContrast(){return this.contrast}setContrast(n){this.contrast=n}},sle=`#ifdef RADIAL_MODULATION
uniform float modulationOffset;
#endif
varying float vActive;varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=inputColor.ra;vec2 ba=inputColor.ba;
#ifdef RADIAL_MODULATION
const vec2 center=vec2(0.5);float d=distance(uv,center)*2.0;d=max(d-modulationOffset,0.0);if(vActive>0.0&&d>0.0){ra=texture2D(inputBuffer,mix(uv,vUvR,d)).ra;ba=texture2D(inputBuffer,mix(uv,vUvB,d)).ba;}
#else
if(vActive>0.0){ra=texture2D(inputBuffer,vUvR).ra;ba=texture2D(inputBuffer,vUvB).ba;}
#endif
outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}`,rle="uniform vec2 offset;varying float vActive;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vActive=(shift.x!=0.0||shift.y!=0.0)?1.0:0.0;vUvR=uv+shift;vUvB=uv-shift;}",J5=class extends so{constructor({offset:n=new Y(.001,5e-4),radialModulation:e=!1,modulationOffset:i=.15}={}){super("ChromaticAberrationEffect",sle,{vertexShader:rle,attributes:Yo.CONVOLUTION,uniforms:new Map([["offset",new Ce(n)],["modulationOffset",new Ce(i)]])}),this.radialModulation=e}get offset(){return this.uniforms.get("offset").value}set offset(n){this.uniforms.get("offset").value=n}get radialModulation(){return this.defines.has("RADIAL_MODULATION")}set radialModulation(n){n?this.defines.set("RADIAL_MODULATION","1"):this.defines.delete("RADIAL_MODULATION"),this.setChanged()}get modulationOffset(){return this.uniforms.get("modulationOffset").value}set modulationOffset(n){this.uniforms.get("modulationOffset").value=n}getOffset(){return this.offset}setOffset(n){this.offset=n}},q5={RED:0,GREEN:1,BLUE:2,ALPHA:3},$5={DISCARD:0,MULTIPLY:1,MULTIPLY_RGB_SET_ALPHA:2,MULTIPLY_RGB:3},ole=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if PASS == 1
uniform vec4 kernel64[32];
#else
uniform vec4 kernel16[8];
#endif
uniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;varying vec2 vUv;void main(){
#ifdef FOREGROUND
vec2 cocNearFar=texture2D(cocBuffer,vUv).rg*scale;float coc=cocNearFar.x;
#else
float coc=texture2D(cocBuffer,vUv).g*scale;
#endif
if(coc==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{
#ifdef FOREGROUND
vec2 step=texelSize*max(cocNearFar.x,cocNearFar.y);
#else
vec2 step=texelSize*coc;
#endif
#if PASS == 1
vec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;
#else
vec4 maxValue=texture2D(inputBuffer,vUv);for(int i=0;i<8;++i){vec4 kernel=kernel16[i];vec2 uv=step*kernel.xy+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);uv=step*kernel.zw+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);}gl_FragColor=maxValue;
#endif
}}`,P_=class extends kt{constructor(n=!1,e=!1){super({name:"BokehMaterial",defines:{PASS:n?"2":"1"},uniforms:{inputBuffer:new Ce(null),cocBuffer:new Ce(null),texelSize:new Ce(new Y),kernel64:new Ce(null),kernel16:new Ce(null),scale:new Ce(1)},blending:dn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:ole,vertexShader:nm}),e&&(this.defines.FOREGROUND="1"),this.generateKernel()}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}set cocBuffer(n){this.uniforms.cocBuffer.value=n}setCoCBuffer(n){this.uniforms.cocBuffer.value=n}get scale(){return this.uniforms.scale.value}set scale(n){this.uniforms.scale.value=n}getScale(n){return this.scale}setScale(n){this.scale=n}generateKernel(){const n=2.39996323,e=new Float64Array(128),i=new Float64Array(32);let s=0,r=0;for(let o=0,a=Math.sqrt(80);o<80;++o){const l=o*n,c=Math.sqrt(o)/a,h=c*Math.cos(l),u=c*Math.sin(l);o%5===0?(i[r++]=h,i[r++]=u):(e[s++]=h,e[s++]=u)}this.uniforms.kernel64.value=e,this.uniforms.kernel16.value=i}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e)}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}};function Ag(n,e,i){return n*(e-i)-e}function sm(n,e,i){return Math.min(Math.max((n+e)/(e-i),0),1)}var ale=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform float focusDistance;uniform float focusRange;uniform float cameraNear;uniform float cameraFar;varying vec2 vUv;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
float depth=unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
float depth=texture2D(depthBuffer,uv).r;
#endif
#ifdef LOG_DEPTH
float d=pow(2.0,depth*log2(cameraFar+1.0))-1.0;float a=cameraFar/(cameraFar-cameraNear);float b=cameraFar*cameraNear/(cameraNear-cameraFar);depth=a+b/d;
#endif
return depth;}void main(){float depth=readDepth(vUv);
#ifdef PERSPECTIVE_CAMERA
float viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);
#else
float linearDepth=depth;
#endif
float signedDistance=linearDepth-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}`,lle=class extends kt{constructor(n){super({name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new Ce(null),focusDistance:new Ce(0),focusRange:new Ce(0),cameraNear:new Ce(.3),cameraFar:new Ce(1e3)},blending:dn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:ale,vertexShader:nm}),this.uniforms.focalLength=this.uniforms.focusRange,this.copyCameraSettings(n)}get near(){return this.uniforms.cameraNear.value}get far(){return this.uniforms.cameraFar.value}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=Ys){this.depthBuffer=n,this.depthPacking=e}get focusDistance(){return this.uniforms.focusDistance.value}set focusDistance(n){this.uniforms.focusDistance.value=n}get worldFocusDistance(){return-Ag(this.focusDistance,this.near,this.far)}set worldFocusDistance(n){this.focusDistance=sm(-n,this.near,this.far)}getFocusDistance(n){this.uniforms.focusDistance.value=n}setFocusDistance(n){this.uniforms.focusDistance.value=n}get focalLength(){return this.focusRange}set focalLength(n){this.focusRange=n}get focusRange(){return this.uniforms.focusRange.value}set focusRange(n){this.uniforms.focusRange.value=n}get worldFocusRange(){return-Ag(this.focusRange,this.near,this.far)}set worldFocusRange(n){this.focusRange=sm(-n,this.near,this.far)}getFocalLength(n){return this.focusRange}setFocalLength(n){this.focusRange=n}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNear.value=n.near,this.uniforms.cameraFar.value=n.far,n instanceof Lt?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},cle=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef MASK_PRECISION_HIGH
uniform mediump sampler2D maskTexture;
#else
uniform lowp sampler2D maskTexture;
#endif
#if MASK_FUNCTION != 0
uniform float strength;
#endif
varying vec2 vUv;void main(){
#if COLOR_CHANNEL == 0
float mask=texture2D(maskTexture,vUv).r;
#elif COLOR_CHANNEL == 1
float mask=texture2D(maskTexture,vUv).g;
#elif COLOR_CHANNEL == 2
float mask=texture2D(maskTexture,vUv).b;
#else
float mask=texture2D(maskTexture,vUv).a;
#endif
#if MASK_FUNCTION == 0
#ifdef INVERTED
mask=step(mask,0.0);
#else
mask=1.0-step(mask,0.0);
#endif
#else
mask=clamp(mask*strength,0.0,1.0);
#ifdef INVERTED
mask=1.0-mask;
#endif
#endif
#if MASK_FUNCTION == 3
vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=vec4(mask*texel.rgb,texel.a);
#elif MASK_FUNCTION == 2
gl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);
#else
gl_FragColor=mask*texture2D(inputBuffer,vUv);
#endif
}`,hle=class extends kt{constructor(n=null){super({name:"MaskMaterial",uniforms:{maskTexture:new Ce(n),inputBuffer:new Ce(null),strength:new Ce(1)},blending:dn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:cle,vertexShader:nm}),this.colorChannel=q5.RED,this.maskFunction=$5.DISCARD}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}set maskTexture(n){this.uniforms.maskTexture.value=n,delete this.defines.MASK_PRECISION_HIGH,n.type!==pn&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}setMaskTexture(n){this.maskTexture=n}set colorChannel(n){this.defines.COLOR_CHANNEL=n.toFixed(0),this.needsUpdate=!0}setColorChannel(n){this.colorChannel=n}set maskFunction(n){this.defines.MASK_FUNCTION=n.toFixed(0),this.needsUpdate=!0}setMaskFunction(n){this.maskFunction=n}get inverted(){return this.defines.INVERTED!==void 0}set inverted(n){this.inverted&&!n?delete this.defines.INVERTED:n&&(this.defines.INVERTED="1"),this.needsUpdate=!0}isInverted(){return this.inverted}setInverted(n){this.inverted=n}get strength(){return this.uniforms.strength.value}set strength(n){this.uniforms.strength.value=n}getStrength(){return this.strength}setStrength(n){this.strength=n}},hc=class extends Ps{constructor(n,e="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=n,this.input=e}setInput(n){this.input=n}render(n,e,i,s,r){const o=this.fullscreenMaterial.uniforms;e!==null&&o!==void 0&&o[this.input]!==void 0&&(o[this.input].value=e.texture),n.setRenderTarget(this.renderToScreen?null:i),n.render(this.scene,this.camera)}initialize(n,e,i){i!==void 0&&i!==pn&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},ule=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;
#else
uniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;
#endif
uniform lowp sampler2D nearCoCBuffer;uniform lowp sampler2D farCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);
#if MASK_FUNCTION == 1
vec2 cocNearFar=vec2(texture2D(nearCoCBuffer,uv).r,colorFar.a);cocNearFar.x=min(cocNearFar.x*scale,1.0);
#else
vec2 cocNearFar=vec2(texture2D(nearCoCBuffer,uv).r,texture2D(farCoCBuffer,uv).g);cocNearFar=min(cocNearFar*scale,1.0);
#endif
vec4 result=inputColor*(1.0-cocNearFar.y)+colorFar;result=mix(result,colorNear,cocNearFar.x);outputColor=result;}`,eV=class extends so{constructor(n,{blendFunction:e,worldFocusDistance:i,worldFocusRange:s,focusDistance:r=0,focalLength:o=.1,focusRange:a=o,bokehScale:l=1,resolutionScale:c=1,width:h=Ri.AUTO_SIZE,height:u=Ri.AUTO_SIZE,resolutionX:d=h,resolutionY:m=u}={}){super("DepthOfFieldEffect",ule,{blendFunction:e,attributes:Yo.DEPTH,uniforms:new Map([["nearColorBuffer",new Ce(null)],["farColorBuffer",new Ce(null)],["nearCoCBuffer",new Ce(null)],["farCoCBuffer",new Ce(null)],["scale",new Ce(1)]])}),this.camera=n,this.renderTarget=new Zt(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="DoF.Intermediate",this.renderTargetMasked=this.renderTarget.clone(),this.renderTargetMasked.texture.name="DoF.Masked.Far",this.renderTargetNear=this.renderTarget.clone(),this.renderTargetNear.texture.name="DoF.Bokeh.Near",this.uniforms.get("nearColorBuffer").value=this.renderTargetNear.texture,this.renderTargetFar=this.renderTarget.clone(),this.renderTargetFar.texture.name="DoF.Bokeh.Far",this.uniforms.get("farColorBuffer").value=this.renderTargetFar.texture,this.renderTargetCoC=this.renderTarget.clone(),this.renderTargetCoC.texture.name="DoF.CoC",this.uniforms.get("farCoCBuffer").value=this.renderTargetCoC.texture,this.renderTargetCoCBlurred=this.renderTargetCoC.clone(),this.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",this.uniforms.get("nearCoCBuffer").value=this.renderTargetCoCBlurred.texture,this.cocPass=new hc(new lle(n));const f=this.cocMaterial;f.focusDistance=r,f.focusRange=a,i!==void 0&&(f.worldFocusDistance=i),s!==void 0&&(f.worldFocusRange=s),this.blurPass=new AL({resolutionScale:c,resolutionX:d,resolutionY:m,kernelSize:cc.MEDIUM}),this.maskPass=new hc(new hle(this.renderTargetCoC.texture));const g=this.maskPass.fullscreenMaterial;g.colorChannel=q5.GREEN,this.maskFunction=$5.MULTIPLY_RGB,this.bokehNearBasePass=new hc(new P_(!1,!0)),this.bokehNearBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehNearFillPass=new hc(new P_(!0,!0)),this.bokehNearFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehFarBasePass=new hc(new P_(!1,!1)),this.bokehFarBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.bokehFarFillPass=new hc(new P_(!0,!1)),this.bokehFarFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.target=null;const y=this.resolution=new Ri(this,d,m,c);y.addEventListener("change",v=>this.setSize(y.baseWidth,y.baseHeight)),this.bokehScale=l}set mainCamera(n){this.camera=n,this.cocMaterial.copyCameraSettings(n)}get cocTexture(){return this.renderTargetCoC.texture}get maskFunction(){return this.maskPass.fullscreenMaterial.maskFunction}set maskFunction(n){this.maskFunction!==n&&(this.defines.set("MASK_FUNCTION",n.toFixed(0)),this.maskPass.fullscreenMaterial.maskFunction=n,this.setChanged())}get cocMaterial(){return this.cocPass.fullscreenMaterial}get circleOfConfusionMaterial(){return this.cocMaterial}getCircleOfConfusionMaterial(){return this.cocMaterial}getBlurPass(){return this.blurPass}getResolution(){return this.resolution}get bokehScale(){return this.uniforms.get("scale").value}set bokehScale(n){this.bokehNearBasePass.fullscreenMaterial.scale=n,this.bokehNearFillPass.fullscreenMaterial.scale=n,this.bokehFarBasePass.fullscreenMaterial.scale=n,this.bokehFarFillPass.fullscreenMaterial.scale=n,this.maskPass.fullscreenMaterial.strength=n,this.uniforms.get("scale").value=n}getBokehScale(){return this.bokehScale}setBokehScale(n){this.bokehScale=n}getTarget(){return this.target}setTarget(n){this.target=n}calculateFocusDistance(n){const e=this.camera,i=e.position.distanceTo(n);return sm(-i,e.near,e.far)}setDepthTexture(n,e=Ys){this.cocMaterial.depthBuffer=n,this.cocMaterial.depthPacking=e}update(n,e,i){const s=this.renderTarget,r=this.renderTargetCoC,o=this.renderTargetCoCBlurred,a=this.renderTargetMasked;if(this.target!==null){const l=this.calculateFocusDistance(this.target);this.cocMaterial.focusDistance=l}this.cocPass.render(n,null,r),this.blurPass.render(n,r,o),this.maskPass.render(n,e,a),this.bokehFarBasePass.render(n,a,s),this.bokehFarFillPass.render(n,s,this.renderTargetFar),this.bokehNearBasePass.render(n,e,s),this.bokehNearFillPass.render(n,s,this.renderTargetNear)}setSize(n,e){const i=this.resolution;i.setBaseSize(n,e);const s=i.width,r=i.height;this.cocPass.setSize(n,e),this.blurPass.setSize(n,e),this.maskPass.setSize(n,e),this.renderTargetFar.setSize(n,e),this.renderTargetCoC.setSize(n,e),this.renderTargetMasked.setSize(n,e),this.renderTarget.setSize(s,r),this.renderTargetNear.setSize(s,r),this.renderTargetCoCBlurred.setSize(s,r),this.bokehNearBasePass.fullscreenMaterial.setSize(n,e),this.bokehNearFillPass.fullscreenMaterial.setSize(n,e),this.bokehFarBasePass.fullscreenMaterial.setSize(n,e),this.bokehFarFillPass.fullscreenMaterial.setSize(n,e)}initialize(n,e,i){this.cocPass.initialize(n,e,i),this.maskPass.initialize(n,e,i),this.bokehNearBasePass.initialize(n,e,i),this.bokehNearFillPass.initialize(n,e,i),this.bokehFarBasePass.initialize(n,e,i),this.bokehFarFillPass.initialize(n,e,i),this.blurPass.initialize(n,e,pn),n.capabilities.logarithmicDepthBuffer&&(this.cocPass.fullscreenMaterial.defines.LOG_DEPTH="1"),i!==void 0&&(this.renderTarget.texture.type=i,this.renderTargetNear.texture.type=i,this.renderTargetFar.texture.type=i,this.renderTargetMasked.texture.type=i,n!==null&&n.outputColorSpace===vt&&(this.renderTarget.texture.colorSpace=vt,this.renderTargetNear.texture.colorSpace=vt,this.renderTargetFar.texture.colorSpace=vt,this.renderTargetMasked.texture.colorSpace=vt))}};function dle(n,e,i){const s=new Map([[I1,1],[Sp,1],[P1,2],[_i,4]]);let r;if(s.has(e)||console.error("Invalid noise texture format"),i===pn){r=new Uint8Array(n*s.get(e));for(let o=0,a=r.length;o<a;++o)r[o]=Math.random()*255+.5}else{r=new Float32Array(n*s.get(e));for(let o=0,a=r.length;o<a;++o)r[o]=Math.random()}return r}var ple=class extends Tr{constructor(n,e,i=I1,s=pn){super(dle(n*e,i,s),n,e,i,s),this.needsUpdate=!0}},Zv={DEFAULT:0,KEEP_MAX_DEPTH:1,DISCARD_MAX_DEPTH:2},mle=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer0;uniform highp sampler2D depthBuffer1;
#else
uniform mediump sampler2D depthBuffer0;uniform mediump sampler2D depthBuffer1;
#endif
uniform sampler2D inputBuffer;uniform vec2 cameraNearFar;float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#else
return orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#endif
}varying vec2 vUv;void main(){vec2 depth;
#if DEPTH_PACKING_0 == 3201
depth.x=unpackRGBAToDepth(texture2D(depthBuffer0,vUv));
#else
depth.x=texture2D(depthBuffer0,vUv).r;
#ifdef LOG_DEPTH
float d=pow(2.0,depth.x*log2(cameraNearFar.y+1.0))-1.0;float a=cameraNearFar.y/(cameraNearFar.y-cameraNearFar.x);float b=cameraNearFar.y*cameraNearFar.x/(cameraNearFar.x-cameraNearFar.y);depth.x=a+b/d;
#endif
#endif
#if DEPTH_PACKING_1 == 3201
depth.y=unpackRGBAToDepth(texture2D(depthBuffer1,vUv));
#else
depth.y=texture2D(depthBuffer1,vUv).r;
#ifdef LOG_DEPTH
float d=pow(2.0,depth.y*log2(cameraNearFar.y+1.0))-1.0;float a=cameraNearFar.y/(cameraNearFar.y-cameraNearFar.x);float b=cameraNearFar.y*cameraNearFar.x/(cameraNearFar.x-cameraNearFar.y);depth.y=a+b/d;
#endif
#endif
bool isMaxDepth=(depth.x==1.0);
#ifdef PERSPECTIVE_CAMERA
depth.x=viewZToOrthographicDepth(getViewZ(depth.x),cameraNearFar.x,cameraNearFar.y);depth.y=viewZToOrthographicDepth(getViewZ(depth.y),cameraNearFar.x,cameraNearFar.y);
#endif
#if DEPTH_TEST_STRATEGY == 0
bool keep=depthTest(depth.x,depth.y);
#elif DEPTH_TEST_STRATEGY == 1
bool keep=isMaxDepth||depthTest(depth.x,depth.y);
#else
bool keep=!isMaxDepth&&depthTest(depth.x,depth.y);
#endif
if(keep){gl_FragColor=texture2D(inputBuffer,vUv);}else{discard;}}`,fle=class extends kt{constructor(){super({name:"DepthMaskMaterial",defines:{DEPTH_EPSILON:"0.0001",DEPTH_PACKING_0:"0",DEPTH_PACKING_1:"0",DEPTH_TEST_STRATEGY:Zv.KEEP_MAX_DEPTH},uniforms:{inputBuffer:new Ce(null),depthBuffer0:new Ce(null),depthBuffer1:new Ce(null),cameraNearFar:new Ce(new Y(1,1))},blending:dn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:mle,vertexShader:nm}),this.depthMode=jy}set depthBuffer0(n){this.uniforms.depthBuffer0.value=n}set depthPacking0(n){this.defines.DEPTH_PACKING_0=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer0(n,e=Ys){this.depthBuffer0=n,this.depthPacking0=e}set depthBuffer1(n){this.uniforms.depthBuffer1.value=n}set depthPacking1(n){this.defines.DEPTH_PACKING_1=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer1(n,e=Ys){this.depthBuffer1=n,this.depthPacking1=e}get maxDepthStrategy(){return Number(this.defines.DEPTH_TEST_STRATEGY)}set maxDepthStrategy(n){this.defines.DEPTH_TEST_STRATEGY=n.toFixed(0),this.needsUpdate=!0}get keepFar(){return this.maxDepthStrategy}set keepFar(n){this.maxDepthStrategy=n?Zv.KEEP_MAX_DEPTH:Zv.DISCARD_MAX_DEPTH}getMaxDepthStrategy(){return this.maxDepthStrategy}setMaxDepthStrategy(n){this.maxDepthStrategy=n}get epsilon(){return Number(this.defines.DEPTH_EPSILON)}set epsilon(n){this.defines.DEPTH_EPSILON=n.toFixed(16),this.needsUpdate=!0}getEpsilon(){return this.epsilon}setEpsilon(n){this.epsilon=n}get depthMode(){return Number(this.defines.DEPTH_MODE)}set depthMode(n){let e;switch(n){case YT:e="false";break;case C1:e="true";break;case Ef:e="abs(d1 - d0) <= DEPTH_EPSILON";break;case Qy:e="abs(d1 - d0) > DEPTH_EPSILON";break;case jy:e="d0 > d1";break;case Ap:e="d0 >= d1";break;case M1:e="d0 <= d1";break;case E1:default:e="d0 < d1";break}this.defines.DEPTH_MODE=n.toFixed(0),this.defines["depthTest(d0, d1)"]=e,this.needsUpdate=!0}getDepthMode(){return this.depthMode}setDepthMode(n){this.depthMode=n}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNearFar.value.set(n.near,n.far),n instanceof Lt?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},B_=class extends Ps{constructor(n,e,i=null){super("RenderPass",n,e),this.needsSwap=!1,this.clearPass=new L_,this.overrideMaterialManager=i===null?null:new Q5(i),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(n){this.scene=n}set mainCamera(n){this.camera=n}get renderToScreen(){return super.renderToScreen}set renderToScreen(n){super.renderToScreen=n,this.clearPass.renderToScreen=n}get overrideMaterial(){const n=this.overrideMaterialManager;return n!==null?n.material:null}set overrideMaterial(n){const e=this.overrideMaterialManager;n!==null?e!==null?e.setMaterial(n):this.overrideMaterialManager=new Q5(n):e!==null&&(e.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(n){this.overrideMaterial=n}get clear(){return this.clearPass.enabled}set clear(n){this.clearPass.enabled=n}getSelection(){return this.selection}setSelection(n){this.selection=n}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(n){this.ignoreBackground=n}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(n){this.skipShadowMapUpdate=n}getClearPass(){return this.clearPass}render(n,e,i,s,r){const o=this.scene,a=this.camera,l=this.selection,c=a.layers.mask,h=o.background,u=n.shadowMap.autoUpdate,d=this.renderToScreen?null:e;l!==null&&a.layers.set(l.getLayer()),this.skipShadowMapUpdate&&(n.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(o.background=null),this.clearPass.enabled&&this.clearPass.render(n,e),n.setRenderTarget(d),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(n,o,a):n.render(o,a),a.layers.mask=c,o.background=h,n.shadowMap.autoUpdate=u}},gle="uniform vec3 hue;uniform float saturation;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(dot(inputColor.rgb,hue.xyz),dot(inputColor.rgb,hue.zxy),dot(inputColor.rgb,hue.yzx));float average=(color.r+color.g+color.b)/3.0;vec3 diff=average-color;if(saturation>0.0){color+=diff*(1.0-1.0/(1.001-saturation));}else{color+=diff*-saturation;}outputColor=vec4(min(color,1.0),inputColor.a);}",tV=class extends so{constructor({blendFunction:n=Ht.SRC,hue:e=0,saturation:i=0}={}){super("HueSaturationEffect",gle,{blendFunction:n,uniforms:new Map([["hue",new Ce(new E)],["saturation",new Ce(i)]])}),this.hue=e}get saturation(){return this.uniforms.get("saturation").value}set saturation(n){this.uniforms.get("saturation").value=n}getSaturation(){return this.saturation}setSaturation(n){this.saturation=n}get hue(){const n=this.uniforms.get("hue").value;return Math.acos((n.x*3-1)/2)}set hue(n){const e=Math.sin(n),i=Math.cos(n);this.uniforms.get("hue").value.set((2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3)}getHue(){return this.hue}setHue(n){this.hue=n}},wL={DEPTH:0,LUMA:1,COLOR:2},yle={DISABLED:0,DEPTH:1,CUSTOM:2},rm={LOW:0,MEDIUM:1,HIGH:2,ULTRA:3},As={LINEAR:0,REINHARD:1,REINHARD2:2,REINHARD2_ADAPTIVE:3,UNCHARTED2:4,OPTIMIZED_CINEON:5,CINEON:5,ACES_FILMIC:6,AGX:7,NEUTRAL:8},Yv={DEFAULT:0,ESKIL:1},vle=class extends Ps{constructor(n,e,{renderTarget:i,resolutionScale:s=1,width:r=Ri.AUTO_SIZE,height:o=Ri.AUTO_SIZE,resolutionX:a=r,resolutionY:l=o}={}){super("DepthPass"),this.needsSwap=!1,this.renderPass=new B_(n,e,new gv({depthPacking:U1}));const c=this.renderPass;c.skipShadowMapUpdate=!0,c.ignoreBackground=!0;const h=c.clearPass;h.overrideClearColor=new Ae(16777215),h.overrideClearAlpha=1,this.renderTarget=i,this.renderTarget===void 0&&(this.renderTarget=new Zt(1,1,{minFilter:Dt,magFilter:Dt}),this.renderTarget.texture.name="DepthPass.Target");const u=this.resolution=new Ri(this,a,l,s);u.addEventListener("change",d=>this.setSize(u.baseWidth,u.baseHeight))}set mainScene(n){this.renderPass.mainScene=n}set mainCamera(n){this.renderPass.mainCamera=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,e,i,s,r){const o=this.renderToScreen?null:this.renderTarget;this.renderPass.render(n,o)}setSize(n,e){const i=this.resolution;i.setBaseSize(n,e),this.renderTarget.setSize(i.width,i.height)}},ble="uniform bool active;uniform vec4 d;void mainUv(inout vec2 uv){if(active){uv=d.xy*(floor(uv*d.zw)+0.5);}}",iV=class extends so{constructor(n=30){super("PixelationEffect",ble,{uniforms:new Map([["active",new Ce(!1)],["d",new Ce(new Ze)]])}),this.resolution=new Y,this._granularity=0,this.granularity=n}get granularity(){return this._granularity}set granularity(n){let e=Math.floor(n);e%2>0&&(e+=1),this._granularity=e,this.uniforms.get("active").value=e>0,this.setSize(this.resolution.width,this.resolution.height)}getGranularity(){return this.granularity}setGranularity(n){this.granularity=n}setSize(n,e){const i=this.resolution;i.set(n,e);const s=this.granularity,r=s/i.x,o=s/i.y;this.uniforms.get("d").value.set(r,o,1/r,1/o)}},nV=class extends xL{constructor(n,e,i){super(i),this.setAttributes(this.getAttributes()|Yo.DEPTH),this.camera=e,this.depthPass=new vle(n,e),this.clearPass=new L_(!0,!1,!1),this.clearPass.overrideClearColor=new Ae(0),this.depthMaskPass=new hc(new fle);const s=this.depthMaskMaterial;s.copyCameraSettings(e),s.depthBuffer1=this.depthPass.texture,s.depthPacking1=U1,s.depthMode=Ef,this.renderTargetMasked=new Zt(1,1,{depthBuffer:!1}),this.renderTargetMasked.texture.name="Bloom.Masked",this.selection=new cae,this._inverted=!1,this._ignoreBackground=!1}set mainScene(n){this.depthPass.mainScene=n}set mainCamera(n){this.camera=n,this.depthPass.mainCamera=n,this.depthMaskMaterial.copyCameraSettings(n)}getSelection(){return this.selection}get depthMaskMaterial(){return this.depthMaskPass.fullscreenMaterial}get inverted(){return this._inverted}set inverted(n){this._inverted=n,this.depthMaskMaterial.depthMode=n?Qy:Ef}isInverted(){return this.inverted}setInverted(n){this.inverted=n}get ignoreBackground(){return this._ignoreBackground}set ignoreBackground(n){this._ignoreBackground=n,this.depthMaskMaterial.maxDepthStrategy=n?Zv.DISCARD_MAX_DEPTH:Zv.KEEP_MAX_DEPTH}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(n){this.ignoreBackground=n}setDepthTexture(n,e=Ys){this.depthMaskMaterial.depthBuffer0=n,this.depthMaskMaterial.depthPacking0=e}update(n,e,i){const s=this.camera,r=this.selection,o=this.inverted;let a=e;if(this.ignoreBackground||!o||r.size>0){const l=s.layers.mask;s.layers.set(r.layer),this.depthPass.render(n),s.layers.mask=l,a=this.renderTargetMasked,this.clearPass.render(n,a),this.depthMaskPass.render(n,e,a)}super.update(n,a,i)}setSize(n,e){super.setSize(n,e),this.renderTargetMasked.setSize(n,e),this.depthPass.setSize(n,e)}initialize(n,e,i){super.initialize(n,e,i),this.clearPass.initialize(n,e,i),this.depthPass.initialize(n,e,i),this.depthMaskPass.initialize(n,e,i),n!==null&&n.capabilities.logarithmicDepthBuffer&&(this.depthMaskPass.fullscreenMaterial.defines.LOG_DEPTH="1"),i!==void 0&&(this.renderTargetMasked.texture.type=i,n!==null&&n.outputColorSpace===vt&&(this.renderTargetMasked.texture.colorSpace=vt))}},Ale=`varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
#if EDGE_DETECTION_MODE == 1
#include <common>
#endif
#if EDGE_DETECTION_MODE == 0 || PREDICATION_MODE == 1
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}vec3 gatherNeighbors(){float p=readDepth(vUv);float pLeft=readDepth(vUv0);float pTop=readDepth(vUv1);return vec3(p,pLeft,pTop);}
#elif PREDICATION_MODE == 2
uniform sampler2D predicationBuffer;vec3 gatherNeighbors(){float p=texture2D(predicationBuffer,vUv).r;float pLeft=texture2D(predicationBuffer,vUv0).r;float pTop=texture2D(predicationBuffer,vUv1).r;return vec3(p,pLeft,pTop);}
#endif
#if PREDICATION_MODE != 0
vec2 calculatePredicatedThreshold(){vec3 neighbours=gatherNeighbors();vec2 delta=abs(neighbours.xx-neighbours.yz);vec2 edges=step(PREDICATION_THRESHOLD,delta);return PREDICATION_SCALE*EDGE_THRESHOLD*(1.0-PREDICATION_STRENGTH*edges);}
#endif
#if EDGE_DETECTION_MODE != 0
uniform sampler2D inputBuffer;
#endif
void main(){
#if EDGE_DETECTION_MODE == 0
const vec2 threshold=vec2(DEPTH_THRESHOLD);
#elif PREDICATION_MODE != 0
vec2 threshold=calculatePredicatedThreshold();
#else
const vec2 threshold=vec2(EDGE_THRESHOLD);
#endif
#if EDGE_DETECTION_MODE == 0
vec3 neighbors=gatherNeighbors();vec2 delta=abs(neighbors.xx-vec2(neighbors.y,neighbors.z));vec2 edges=step(threshold,delta);if(dot(edges,vec2(1.0))==0.0){discard;}gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 1
float l=luminance(texture2D(inputBuffer,vUv).rgb);float lLeft=luminance(texture2D(inputBuffer,vUv0).rgb);float lTop=luminance(texture2D(inputBuffer,vUv1).rgb);vec4 delta;delta.xy=abs(l-vec2(lLeft,lTop));vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}float lRight=luminance(texture2D(inputBuffer,vUv2).rgb);float lBottom=luminance(texture2D(inputBuffer,vUv3).rgb);delta.zw=abs(l-vec2(lRight,lBottom));vec2 maxDelta=max(delta.xy,delta.zw);float lLeftLeft=luminance(texture2D(inputBuffer,vUv4).rgb);float lTopTop=luminance(texture2D(inputBuffer,vUv5).rgb);delta.zw=abs(vec2(lLeft,lTop)-vec2(lLeftLeft,lTopTop));maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges.xy*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 2
vec4 delta;vec3 c=texture2D(inputBuffer,vUv).rgb;vec3 cLeft=texture2D(inputBuffer,vUv0).rgb;vec3 t=abs(c-cLeft);delta.x=max(max(t.r,t.g),t.b);vec3 cTop=texture2D(inputBuffer,vUv1).rgb;t=abs(c-cTop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}vec3 cRight=texture2D(inputBuffer,vUv2).rgb;t=abs(c-cRight);delta.z=max(max(t.r,t.g),t.b);vec3 cBottom=texture2D(inputBuffer,vUv3).rgb;t=abs(c-cBottom);delta.w=max(max(t.r,t.g),t.b);vec2 maxDelta=max(delta.xy,delta.zw);vec3 cLeftLeft=texture2D(inputBuffer,vUv4).rgb;t=abs(c-cLeftLeft);delta.z=max(max(t.r,t.g),t.b);vec3 cTopTop=texture2D(inputBuffer,vUv5).rgb;t=abs(c-cTopTop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#endif
}`,xle=`uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,0.0);vUv1=vUv+texelSize*vec2(0.0,-1.0);
#if EDGE_DETECTION_MODE != 0
vUv2=vUv+texelSize*vec2(1.0,0.0);vUv3=vUv+texelSize*vec2(0.0,1.0);vUv4=vUv+texelSize*vec2(-2.0,0.0);vUv5=vUv+texelSize*vec2(0.0,-2.0);
#endif
gl_Position=vec4(position.xy,1.0,1.0);}`,wle=class extends kt{constructor(n=new Y,e=wL.COLOR){super({name:"EdgeDetectionMaterial",defines:{THREE_REVISION:sh.replace(/\D+/g,""),LOCAL_CONTRAST_ADAPTATION_FACTOR:"2.0",EDGE_THRESHOLD:"0.1",DEPTH_THRESHOLD:"0.01",PREDICATION_MODE:"0",PREDICATION_THRESHOLD:"0.01",PREDICATION_SCALE:"2.0",PREDICATION_STRENGTH:"1.0",DEPTH_PACKING:"0"},uniforms:{inputBuffer:new Ce(null),depthBuffer:new Ce(null),predicationBuffer:new Ce(null),texelSize:new Ce(n)},blending:dn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Ale,vertexShader:xle}),this.edgeDetectionMode=e}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=Ys){this.depthBuffer=n,this.depthPacking=e}get edgeDetectionMode(){return Number(this.defines.EDGE_DETECTION_MODE)}set edgeDetectionMode(n){this.defines.EDGE_DETECTION_MODE=n.toFixed(0),this.needsUpdate=!0}getEdgeDetectionMode(){return this.edgeDetectionMode}setEdgeDetectionMode(n){this.edgeDetectionMode=n}get localContrastAdaptationFactor(){return Number(this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR)}set localContrastAdaptationFactor(n){this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR=n.toFixed("6"),this.needsUpdate=!0}getLocalContrastAdaptationFactor(){return this.localContrastAdaptationFactor}setLocalContrastAdaptationFactor(n){this.localContrastAdaptationFactor=n}get edgeDetectionThreshold(){return Number(this.defines.EDGE_THRESHOLD)}set edgeDetectionThreshold(n){this.defines.EDGE_THRESHOLD=n.toFixed("6"),this.defines.DEPTH_THRESHOLD=(n*.1).toFixed("6"),this.needsUpdate=!0}getEdgeDetectionThreshold(){return this.edgeDetectionThreshold}setEdgeDetectionThreshold(n){this.edgeDetectionThreshold=n}get predicationMode(){return Number(this.defines.PREDICATION_MODE)}set predicationMode(n){this.defines.PREDICATION_MODE=n.toFixed(0),this.needsUpdate=!0}getPredicationMode(){return this.predicationMode}setPredicationMode(n){this.predicationMode=n}set predicationBuffer(n){this.uniforms.predicationBuffer.value=n}setPredicationBuffer(n){this.uniforms.predicationBuffer.value=n}get predicationThreshold(){return Number(this.defines.PREDICATION_THRESHOLD)}set predicationThreshold(n){this.defines.PREDICATION_THRESHOLD=n.toFixed("6"),this.needsUpdate=!0}getPredicationThreshold(){return this.predicationThreshold}setPredicationThreshold(n){this.predicationThreshold=n}get predicationScale(){return Number(this.defines.PREDICATION_SCALE)}set predicationScale(n){this.defines.PREDICATION_SCALE=n.toFixed("6"),this.needsUpdate=!0}getPredicationScale(){return this.predicationScale}setPredicationScale(n){this.predicationScale=n}get predicationStrength(){return Number(this.defines.PREDICATION_STRENGTH)}set predicationStrength(n){this.defines.PREDICATION_STRENGTH=n.toFixed("6"),this.needsUpdate=!0}getPredicationStrength(){return this.predicationStrength}setPredicationStrength(n){this.predicationStrength=n}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},_le=`#define sampleLevelZeroOffset(t, coord, offset) texture2D(t, coord + offset * texelSize)
#if __VERSION__ < 300
#define round(v) floor(v + 0.5)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D areaTexture;uniform lowp sampler2D searchTexture;uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}vec2 decodeDiagBilinearAccess(in vec2 e){e.r=e.r*abs(5.0*e.r-5.0*0.75);return round(e);}vec4 decodeDiagBilinearAccess(in vec4 e){e.rb=e.rb*abs(5.0*e.rb-5.0*0.75);return round(e);}vec2 searchDiag1(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 searchDiag2(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);coord.x+=0.25*texelSize.x;vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;e=decodeDiagBilinearAccess(e);coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 areaDiag(const in vec2 dist,const in vec2 e,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE_DIAG,AREATEX_MAX_DISTANCE_DIAG)*e+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.x+=0.5;texCoord.y+=AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTexture,texCoord).rg;}vec2 calculateDiagWeights(const in vec2 texCoord,const in vec2 e,const in vec4 subsampleIndices){vec2 weights=vec2(0.0);vec4 d;vec2 end;if(e.r>0.0){d.xz=searchDiag1(texCoord,vec2(-1.0,1.0),end);d.x+=float(end.y>0.9);}else{d.xz=vec2(0.0);}d.yw=searchDiag1(texCoord,vec2(1.0,-1.0),end);if(d.x+d.y>2.0){vec4 coords=vec4(-d.x+0.25,d.x,d.y,-d.y-0.25)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.xy=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).rg;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).rg;c.yxwz=decodeDiagBilinearAccess(c.xyzw);vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.z);}d.xz=searchDiag2(texCoord,vec2(-1.0,-1.0),end);if(sampleLevelZeroOffset(inputBuffer,texCoord,vec2(1,0)).r>0.0){d.yw=searchDiag2(texCoord,vec2(1.0),end);d.y+=float(end.y>0.9);}else{d.yw=vec2(0.0);}if(d.x+d.y>2.0){vec4 coords=vec4(-d.x,-d.x,d.y,d.y)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.x=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).g;c.y=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(0,-1)).r;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).gr;vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.w).gr;}return weights;}float searchLength(const in vec2 e,const in float offset){vec2 scale=SEARCHTEX_SIZE*vec2(0.5,-1.0);vec2 bias=SEARCHTEX_SIZE*vec2(offset,1.0);scale+=vec2(-1.0,1.0);bias+=vec2(0.5,-0.5);scale*=1.0/SEARCHTEX_PACKED_SIZE;bias*=1.0/SEARCHTEX_PACKED_SIZE;return texture2D(searchTexture,scale*e+bias).r;}float searchXLeft(in vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x>end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(-2.0,0.0)*texelSize+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.0)+3.25;return texelSize.x*offset+texCoord.x;}float searchXRight(vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x<end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(2.0,0.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.5)+3.25;return-texelSize.x*offset+texCoord.x;}float searchYUp(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.y>end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=-vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.0)+3.25;return texelSize.y*offset+texCoord.y;}float searchYDown(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;i++){if(!(texCoord.y<end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.5)+3.25;return-texelSize.y*offset+texCoord.y;}vec2 area(const in vec2 dist,const in float e1,const in float e2,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.y=AREATEX_SUBTEX_SIZE*offset+texCoord.y;return texture2D(areaTexture,texCoord).rg;}void detectHorizontalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,1)).r;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).r;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,-2)).r;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,-2)).r;weights*=clamp(factor,0.0,1.0);
#endif
}void detectVerticalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(1,0)).g;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).g;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(-2,0)).g;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(-2,1)).g;weights*=clamp(factor,0.0,1.0);
#endif
}void main(){vec4 weights=vec4(0.0);vec4 subsampleIndices=vec4(0.0);vec2 e=texture2D(inputBuffer,vUv).rg;if(e.g>0.0){
#if !defined(DISABLE_DIAG_DETECTION)
weights.rg=calculateDiagWeights(vUv,e,subsampleIndices);if(weights.r==-weights.g){
#endif
vec2 d;vec3 coords;coords.x=searchXLeft(vOffset[0].xy,vOffset[2].x);coords.y=vOffset[1].y;d.x=coords.x;float e1=texture2D(inputBuffer,coords.xy).r;coords.z=searchXRight(vOffset[0].zw,vOffset[2].y);d.y=coords.z;d=round(resolution.xx*d+-vPixCoord.xx);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.zy,vec2(1,0)).r;weights.rg=area(sqrtD,e1,e2,subsampleIndices.y);coords.y=vUv.y;detectHorizontalCornerPattern(weights.rg,coords.xyzy,d);
#if !defined(DISABLE_DIAG_DETECTION)
}else{e.r=0.0;}
#endif
}if(e.r>0.0){vec2 d;vec3 coords;coords.y=searchYUp(vOffset[1].xy,vOffset[2].z);coords.x=vOffset[0].x;d.x=coords.y;float e1=texture2D(inputBuffer,coords.xy).g;coords.z=searchYDown(vOffset[1].zw,vOffset[2].w);d.y=coords.z;d=round(resolution.yy*d-vPixCoord.yy);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.xz,vec2(0,1)).g;weights.ba=area(sqrtD,e1,e2,subsampleIndices.x);coords.x=vUv.x;detectVerticalCornerPattern(weights.ba,coords.xyxz,d);}gl_FragColor=weights;}`,Sle="uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void main(){vUv=position.xy*0.5+0.5;vPixCoord=vUv*resolution;vOffset[0]=vUv.xyxy+texelSize.xyxy*vec4(-0.25,-0.125,1.25,-0.125);vOffset[1]=vUv.xyxy+texelSize.xyxy*vec4(-0.125,-0.25,-0.125,1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*texelSize.xxyy*MAX_SEARCH_STEPS_FLOAT;gl_Position=vec4(position.xy,1.0,1.0);}",Cle=class extends kt{constructor(n=new Y,e=new Y){super({name:"SMAAWeightsMaterial",defines:{MAX_SEARCH_STEPS_INT:"16",MAX_SEARCH_STEPS_FLOAT:"16.0",MAX_SEARCH_STEPS_DIAG_INT:"8",MAX_SEARCH_STEPS_DIAG_FLOAT:"8.0",CORNER_ROUNDING:"25",CORNER_ROUNDING_NORM:"0.25",AREATEX_MAX_DISTANCE:"16.0",AREATEX_MAX_DISTANCE_DIAG:"20.0",AREATEX_PIXEL_SIZE:"(1.0 / vec2(160.0, 560.0))",AREATEX_SUBTEX_SIZE:"(1.0 / 7.0)",SEARCHTEX_SIZE:"vec2(66.0, 33.0)",SEARCHTEX_PACKED_SIZE:"vec2(64.0, 16.0)"},uniforms:{inputBuffer:new Ce(null),searchTexture:new Ce(null),areaTexture:new Ce(null),resolution:new Ce(e),texelSize:new Ce(n)},blending:dn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:_le,vertexShader:Sle})}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get searchTexture(){return this.uniforms.searchTexture.value}set searchTexture(n){this.uniforms.searchTexture.value=n}get areaTexture(){return this.uniforms.areaTexture.value}set areaTexture(n){this.uniforms.areaTexture.value=n}setLookupTextures(n,e){this.searchTexture=n,this.areaTexture=e}get orthogonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_INT)}set orthogonalSearchSteps(n){const e=Math.min(Math.max(n,0),112);this.defines.MAX_SEARCH_STEPS_INT=e.toFixed("0"),this.defines.MAX_SEARCH_STEPS_FLOAT=e.toFixed("1"),this.needsUpdate=!0}setOrthogonalSearchSteps(n){this.orthogonalSearchSteps=n}get diagonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_DIAG_INT)}set diagonalSearchSteps(n){const e=Math.min(Math.max(n,0),20);this.defines.MAX_SEARCH_STEPS_DIAG_INT=e.toFixed("0"),this.defines.MAX_SEARCH_STEPS_DIAG_FLOAT=e.toFixed("1"),this.needsUpdate=!0}setDiagonalSearchSteps(n){this.diagonalSearchSteps=n}get diagonalDetection(){return this.defines.DISABLE_DIAG_DETECTION===void 0}set diagonalDetection(n){n?delete this.defines.DISABLE_DIAG_DETECTION:this.defines.DISABLE_DIAG_DETECTION="1",this.needsUpdate=!0}isDiagonalDetectionEnabled(){return this.diagonalDetection}setDiagonalDetectionEnabled(n){this.diagonalDetection=n}get cornerRounding(){return Number(this.defines.CORNER_ROUNDING)}set cornerRounding(n){const e=Math.min(Math.max(n,0),100);this.defines.CORNER_ROUNDING=e.toFixed("4"),this.defines.CORNER_ROUNDING_NORM=(e/100).toFixed("4"),this.needsUpdate=!0}setCornerRounding(n){this.cornerRounding=n}get cornerDetection(){return this.defines.DISABLE_CORNER_DETECTION===void 0}set cornerDetection(n){n?delete this.defines.DISABLE_CORNER_DETECTION:this.defines.DISABLE_CORNER_DETECTION="1",this.needsUpdate=!0}isCornerRoundingEnabled(){return this.cornerDetection}setCornerRoundingEnabled(n){this.cornerDetection=n}setSize(n,e){const i=this.uniforms;i.texelSize.value.set(1/n,1/e),i.resolution.value.set(n,e)}},sV="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAYAAACm53kpAAAAeElEQVRYR+2XSwqAMAxEJ168ePEqwRSKhIIiuHjJqiU0gWE+1CQdApcVAMUAuARaMGCX1MIL/Ow13++9lW2s3mW9MWvsnWc/2fvGygwPAN4E8QzAA4CXAB6AHjG4JTHYI1ey3pcx6FHnEfhLDOIBKAmUBK6/ANUDTlROXAHd9EC1AAAAAElFTkSuQmCC",rV="data:image/png;base64,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",Mle="uniform sampler2D weightMap;varying vec2 vOffset0;varying vec2 vOffset1;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 a;a.x=texture2D(weightMap,vOffset0).a;a.y=texture2D(weightMap,vOffset1).g;a.wz=texture2D(weightMap,uv).rb;vec4 color=inputColor;if(dot(a,vec4(1.0))>=1e-5){bool h=max(a.x,a.z)>max(a.y,a.w);vec4 blendingOffset=vec4(0.0,a.y,0.0,a.w);vec2 blendingWeight=a.yw;movec(bvec4(h),blendingOffset,vec4(a.x,0.0,a.z,0.0));movec(bvec2(h),blendingWeight,a.xz);blendingWeight/=dot(blendingWeight,vec2(1.0));vec4 blendingCoord=blendingOffset*vec4(texelSize,-texelSize)+uv.xyxy;color=blendingWeight.x*texture2D(inputBuffer,blendingCoord.xy);color+=blendingWeight.y*texture2D(inputBuffer,blendingCoord.zw);}outputColor=color;}",Ele="varying vec2 vOffset0;varying vec2 vOffset1;void mainSupport(const in vec2 uv){vOffset0=uv+texelSize*vec2(1.0,0.0);vOffset1=uv+texelSize*vec2(0.0,1.0);}",oV=class extends so{constructor({blendFunction:n=Ht.SRC,preset:e=rm.MEDIUM,edgeDetectionMode:i=wL.COLOR,predicationMode:s=yle.DISABLED}={}){super("SMAAEffect",Mle,{vertexShader:Ele,blendFunction:n,attributes:Yo.CONVOLUTION|Yo.DEPTH,uniforms:new Map([["weightMap",new Ce(null)]])});let r,o;arguments.length>1&&(r=arguments[0],o=arguments[1],arguments.length>2&&(e=arguments[2]),arguments.length>3&&(i=arguments[3])),this.renderTargetEdges=new Zt(1,1,{depthBuffer:!1}),this.renderTargetEdges.texture.name="SMAA.Edges",this.renderTargetWeights=this.renderTargetEdges.clone(),this.renderTargetWeights.texture.name="SMAA.Weights",this.uniforms.get("weightMap").value=this.renderTargetWeights.texture,this.clearPass=new L_(!0,!1,!1),this.clearPass.overrideClearColor=new Ae(0),this.clearPass.overrideClearAlpha=1,this.edgeDetectionPass=new hc(new wle),this.edgeDetectionMaterial.edgeDetectionMode=i,this.edgeDetectionMaterial.predicationMode=s,this.weightsPass=new hc(new Cle);const a=new Hw;a.onLoad=()=>{const l=new Vt(r);l.name="SMAA.Search",l.magFilter=Dt,l.minFilter=Dt,l.generateMipmaps=!1,l.needsUpdate=!0,l.flipY=!0,this.weightsMaterial.searchTexture=l;const c=new Vt(o);c.name="SMAA.Area",c.magFilter=Ot,c.minFilter=Ot,c.generateMipmaps=!1,c.needsUpdate=!0,c.flipY=!1,this.weightsMaterial.areaTexture=c,this.dispatchEvent({type:"load"})},a.itemStart("search"),a.itemStart("area"),r!==void 0&&o!==void 0?(a.itemEnd("search"),a.itemEnd("area")):typeof Image<"u"&&(r=new Image,o=new Image,r.addEventListener("load",()=>a.itemEnd("search")),o.addEventListener("load",()=>a.itemEnd("area")),r.src=sV,o.src=rV),this.applyPreset(e)}get edgesTexture(){return this.renderTargetEdges.texture}getEdgesTexture(){return this.edgesTexture}get weightsTexture(){return this.renderTargetWeights.texture}getWeightsTexture(){return this.weightsTexture}get edgeDetectionMaterial(){return this.edgeDetectionPass.fullscreenMaterial}get colorEdgesMaterial(){return this.edgeDetectionMaterial}getEdgeDetectionMaterial(){return this.edgeDetectionMaterial}get weightsMaterial(){return this.weightsPass.fullscreenMaterial}getWeightsMaterial(){return this.weightsMaterial}setEdgeDetectionThreshold(n){this.edgeDetectionMaterial.edgeDetectionThreshold=n}setOrthogonalSearchSteps(n){this.weightsMaterial.orthogonalSearchSteps=n}applyPreset(n){const e=this.edgeDetectionMaterial,i=this.weightsMaterial;switch(n){case rm.LOW:e.edgeDetectionThreshold=.15,i.orthogonalSearchSteps=4,i.diagonalDetection=!1,i.cornerDetection=!1;break;case rm.MEDIUM:e.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=8,i.diagonalDetection=!1,i.cornerDetection=!1;break;case rm.HIGH:e.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=16,i.diagonalSearchSteps=8,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0;break;case rm.ULTRA:e.edgeDetectionThreshold=.05,i.orthogonalSearchSteps=32,i.diagonalSearchSteps=16,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0;break}}setDepthTexture(n,e=Ys){this.edgeDetectionMaterial.depthBuffer=n,this.edgeDetectionMaterial.depthPacking=e}update(n,e,i){this.clearPass.render(n,this.renderTargetEdges),this.edgeDetectionPass.render(n,e,this.renderTargetEdges),this.weightsPass.render(n,this.renderTargetEdges,this.renderTargetWeights)}setSize(n,e){this.edgeDetectionMaterial.setSize(n,e),this.weightsMaterial.setSize(n,e),this.renderTargetEdges.setSize(n,e),this.renderTargetWeights.setSize(n,e)}dispose(){const{searchTexture:n,areaTexture:e}=this.weightsMaterial;n!==null&&e!==null&&(n.dispose(),e.dispose()),super.dispose()}static get searchImageDataURL(){return sV}static get areaImageDataURL(){return rV}},Tle=`#include <common>
#include <packing>
#ifdef NORMAL_DEPTH
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D normalDepthBuffer;
#else
uniform mediump sampler2D normalDepthBuffer;
#endif
float readDepth(const in vec2 uv){return texture2D(normalDepthBuffer,uv).a;}
#else
uniform lowp sampler2D normalBuffer;
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}
#endif
uniform lowp sampler2D noiseTexture;uniform mat4 inverseProjectionMatrix;uniform mat4 projectionMatrix;uniform vec2 texelSize;uniform vec2 cameraNearFar;uniform float intensity;uniform float minRadiusScale;uniform float fade;uniform float bias;uniform vec2 distanceCutoff;uniform vec2 proximityCutoff;varying vec2 vUv;varying vec2 vUv2;float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#else
return orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#endif
}vec3 getViewPosition(const in vec2 screenPosition,const in float depth,const in float viewZ){vec4 clipPosition=vec4(vec3(screenPosition,depth)*2.0-1.0,1.0);float clipW=projectionMatrix[2][3]*viewZ+projectionMatrix[3][3];clipPosition*=clipW;return(inverseProjectionMatrix*clipPosition).xyz;}float getAmbientOcclusion(const in vec3 p,const in vec3 n,const in float depth,const in vec2 uv){float radiusScale=1.0-smoothstep(0.0,distanceCutoff.y,depth);radiusScale=radiusScale*(1.0-minRadiusScale)+minRadiusScale;float radius=RADIUS*radiusScale;float noise=texture2D(noiseTexture,vUv2).r;float baseAngle=noise*PI2;float rings=SPIRAL_TURNS*PI2;float occlusion=0.0;int taps=0;for(int i=0;i<SAMPLES_INT;++i){float alpha=(float(i)+0.5)*INV_SAMPLES_FLOAT;float angle=alpha*rings+baseAngle;vec2 rotation=vec2(cos(angle),sin(angle));vec2 coords=alpha*radius*rotation*texelSize+uv;if(coords.s<0.0||coords.s>1.0||coords.t<0.0||coords.t>1.0){continue;}float sampleDepth=readDepth(coords);float viewZ=getViewZ(sampleDepth);
#ifdef PERSPECTIVE_CAMERA
float linearSampleDepth=viewZToOrthographicDepth(viewZ,cameraNearFar.x,cameraNearFar.y);
#else
float linearSampleDepth=sampleDepth;
#endif
float proximity=abs(depth-linearSampleDepth);if(proximity<proximityCutoff.y){float falloff=1.0-smoothstep(proximityCutoff.x,proximityCutoff.y,proximity);vec3 Q=getViewPosition(coords,sampleDepth,viewZ);vec3 v=Q-p;float vv=dot(v,v);float vn=dot(v,n)-bias;float f=max(RADIUS_SQ-vv,0.0)/RADIUS_SQ;occlusion+=(f*f*f*max(vn/(fade+vv),0.0))*falloff;}++taps;}return occlusion/(4.0*max(float(taps),1.0));}void main(){
#ifdef NORMAL_DEPTH
vec4 normalDepth=texture2D(normalDepthBuffer,vUv);
#else
vec4 normalDepth=vec4(texture2D(normalBuffer,vUv).xyz,readDepth(vUv));
#endif
float ao=0.0;float depth=normalDepth.a;float viewZ=getViewZ(depth);
#ifdef PERSPECTIVE_CAMERA
float linearDepth=viewZToOrthographicDepth(viewZ,cameraNearFar.x,cameraNearFar.y);
#else
float linearDepth=depth;
#endif
if(linearDepth<distanceCutoff.y){vec3 viewPosition=getViewPosition(vUv,depth,viewZ);vec3 viewNormal=unpackRGBToNormal(normalDepth.rgb);ao+=getAmbientOcclusion(viewPosition,viewNormal,linearDepth,vUv);float d=smoothstep(distanceCutoff.x,distanceCutoff.y,linearDepth);ao=mix(ao,0.0,d);
#ifdef LEGACY_INTENSITY
ao=clamp(1.0-pow(1.0-ao,abs(intensity)),0.0,1.0);
#endif
}gl_FragColor.r=ao;}`,Rle="uniform vec2 noiseScale;varying vec2 vUv;varying vec2 vUv2;void main(){vUv=position.xy*0.5+0.5;vUv2=vUv*noiseScale;gl_Position=vec4(position.xy,1.0,1.0);}",Ile=class extends kt{constructor(n){super({name:"SSAOMaterial",defines:{SAMPLES_INT:"0",INV_SAMPLES_FLOAT:"0.0",SPIRAL_TURNS:"0.0",RADIUS:"1.0",RADIUS_SQ:"1.0",DISTANCE_SCALING:"1",DEPTH_PACKING:"0"},uniforms:{depthBuffer:new Ce(null),normalBuffer:new Ce(null),normalDepthBuffer:new Ce(null),noiseTexture:new Ce(null),inverseProjectionMatrix:new Ce(new he),projectionMatrix:new Ce(new he),texelSize:new Ce(new Y),cameraNearFar:new Ce(new Y),distanceCutoff:new Ce(new Y),proximityCutoff:new Ce(new Y),noiseScale:new Ce(new Y),minRadiusScale:new Ce(.33),intensity:new Ce(1),fade:new Ce(.01),bias:new Ce(0)},blending:dn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Tle,vertexShader:Rle}),this.copyCameraSettings(n),this.resolution=new Y,this.r=1}get near(){return this.uniforms.cameraNearFar.value.x}get far(){return this.uniforms.cameraNearFar.value.y}set normalDepthBuffer(n){this.uniforms.normalDepthBuffer.value=n,n!==null?this.defines.NORMAL_DEPTH="1":delete this.defines.NORMAL_DEPTH,this.needsUpdate=!0}setNormalDepthBuffer(n){this.normalDepthBuffer=n}set normalBuffer(n){this.uniforms.normalBuffer.value=n}setNormalBuffer(n){this.uniforms.normalBuffer.value=n}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=Ys){this.depthBuffer=n,this.depthPacking=e}set noiseTexture(n){this.uniforms.noiseTexture.value=n}setNoiseTexture(n){this.uniforms.noiseTexture.value=n}get samples(){return Number(this.defines.SAMPLES_INT)}set samples(n){this.defines.SAMPLES_INT=n.toFixed(0),this.defines.INV_SAMPLES_FLOAT=(1/n).toFixed(9),this.needsUpdate=!0}getSamples(){return this.samples}setSamples(n){this.samples=n}get rings(){return Number(this.defines.SPIRAL_TURNS)}set rings(n){this.defines.SPIRAL_TURNS=n.toFixed(1),this.needsUpdate=!0}getRings(){return this.rings}setRings(n){this.rings=n}get intensity(){return this.uniforms.intensity.value}set intensity(n){this.uniforms.intensity.value=n,this.defines.LEGACY_INTENSITY===void 0&&(this.defines.LEGACY_INTENSITY="1",this.needsUpdate=!0)}getIntensity(){return this.uniforms.intensity.value}setIntensity(n){this.uniforms.intensity.value=n}get fade(){return this.uniforms.fade.value}set fade(n){this.uniforms.fade.value=n}getFade(){return this.uniforms.fade.value}setFade(n){this.uniforms.fade.value=n}get bias(){return this.uniforms.bias.value}set bias(n){this.uniforms.bias.value=n}getBias(){return this.uniforms.bias.value}setBias(n){this.uniforms.bias.value=n}get minRadiusScale(){return this.uniforms.minRadiusScale.value}set minRadiusScale(n){this.uniforms.minRadiusScale.value=n}getMinRadiusScale(){return this.uniforms.minRadiusScale.value}setMinRadiusScale(n){this.uniforms.minRadiusScale.value=n}updateRadius(){const n=this.r*this.resolution.height;this.defines.RADIUS=n.toFixed(11),this.defines.RADIUS_SQ=(n*n).toFixed(11),this.needsUpdate=!0}get radius(){return this.r}set radius(n){this.r=Math.min(Math.max(n,1e-6),1),this.updateRadius()}getRadius(){return this.radius}setRadius(n){this.radius=n}get distanceScaling(){return!0}set distanceScaling(n){}isDistanceScalingEnabled(){return this.distanceScaling}setDistanceScalingEnabled(n){this.distanceScaling=n}get distanceThreshold(){return this.uniforms.distanceCutoff.value.x}set distanceThreshold(n){this.uniforms.distanceCutoff.value.set(Math.min(Math.max(n,0),1),Math.min(Math.max(n+this.distanceFalloff,0),1))}get worldDistanceThreshold(){return-Ag(this.distanceThreshold,this.near,this.far)}set worldDistanceThreshold(n){this.distanceThreshold=sm(-n,this.near,this.far)}get distanceFalloff(){return this.uniforms.distanceCutoff.value.y-this.distanceThreshold}set distanceFalloff(n){this.uniforms.distanceCutoff.value.y=Math.min(Math.max(this.distanceThreshold+n,0),1)}get worldDistanceFalloff(){return-Ag(this.distanceFalloff,this.near,this.far)}set worldDistanceFalloff(n){this.distanceFalloff=sm(-n,this.near,this.far)}setDistanceCutoff(n,e){this.uniforms.distanceCutoff.value.set(Math.min(Math.max(n,0),1),Math.min(Math.max(n+e,0),1))}get proximityThreshold(){return this.uniforms.proximityCutoff.value.x}set proximityThreshold(n){this.uniforms.proximityCutoff.value.set(Math.min(Math.max(n,0),1),Math.min(Math.max(n+this.proximityFalloff,0),1))}get worldProximityThreshold(){return-Ag(this.proximityThreshold,this.near,this.far)}set worldProximityThreshold(n){this.proximityThreshold=sm(-n,this.near,this.far)}get proximityFalloff(){return this.uniforms.proximityCutoff.value.y-this.proximityThreshold}set proximityFalloff(n){this.uniforms.proximityCutoff.value.y=Math.min(Math.max(this.proximityThreshold+n,0),1)}get worldProximityFalloff(){return-Ag(this.proximityFalloff,this.near,this.far)}set worldProximityFalloff(n){this.proximityFalloff=sm(-n,this.near,this.far)}setProximityCutoff(n,e){this.uniforms.proximityCutoff.value.set(Math.min(Math.max(n,0),1),Math.min(Math.max(n+e,0),1))}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e)}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNearFar.value.set(n.near,n.far),this.uniforms.projectionMatrix.value.copy(n.projectionMatrix),this.uniforms.inverseProjectionMatrix.value.copy(n.projectionMatrix).invert(),n instanceof Lt?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(n,e){const i=this.uniforms,s=i.noiseTexture.value;s!==null&&i.noiseScale.value.set(n/s.image.width,e/s.image.height),i.texelSize.value.set(1/n,1/e),this.resolution.set(n,e),this.updateRadius()}},Lle=`#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
#ifdef DOWNSAMPLE_NORMALS
uniform lowp sampler2D normalBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}int findBestDepth(const in float samples[4]){float c=(samples[0]+samples[1]+samples[2]+samples[3])*0.25;float distances[4];distances[0]=abs(c-samples[0]);distances[1]=abs(c-samples[1]);distances[2]=abs(c-samples[2]);distances[3]=abs(c-samples[3]);float maxDistance=max(max(distances[0],distances[1]),max(distances[2],distances[3]));int remaining[3];int rejected[3];int i,j,k;for(i=0,j=0,k=0;i<4;++i){if(distances[i]<maxDistance){remaining[j++]=i;}else{rejected[k++]=i;}}for(;j<3;++j){remaining[j]=rejected[--k];}vec3 s=vec3(samples[remaining[0]],samples[remaining[1]],samples[remaining[2]]);c=(s.x+s.y+s.z)/3.0;distances[0]=abs(c-s.x);distances[1]=abs(c-s.y);distances[2]=abs(c-s.z);float minDistance=min(distances[0],min(distances[1],distances[2]));for(i=0;i<3;++i){if(distances[i]==minDistance){break;}}return remaining[i];}void main(){float d[4];d[0]=readDepth(vUv0);d[1]=readDepth(vUv1);d[2]=readDepth(vUv2);d[3]=readDepth(vUv3);int index=findBestDepth(d);
#ifdef DOWNSAMPLE_NORMALS
vec3 n[4];n[0]=texture2D(normalBuffer,vUv0).rgb;n[1]=texture2D(normalBuffer,vUv1).rgb;n[2]=texture2D(normalBuffer,vUv2).rgb;n[3]=texture2D(normalBuffer,vUv3).rgb;
#else
vec3 n[4];n[0]=vec3(0.0);n[1]=vec3(0.0);n[2]=vec3(0.0);n[3]=vec3(0.0);
#endif
gl_FragColor=vec4(n[index],d[index]);}`,Ple="uniform vec2 texelSize;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vUv0=uv;vUv1=vec2(uv.x,uv.y+texelSize.y);vUv2=vec2(uv.x+texelSize.x,uv.y);vUv3=uv+texelSize;gl_Position=vec4(position.xy,1.0,1.0);}",Ble=class extends kt{constructor(){super({name:"DepthDownsamplingMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new Ce(null),normalBuffer:new Ce(null),texelSize:new Ce(new Y)},blending:dn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Lle,vertexShader:Ple})}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=Ys){this.depthBuffer=n,this.depthPacking=e}set normalBuffer(n){this.uniforms.normalBuffer.value=n,n!==null?this.defines.DOWNSAMPLE_NORMALS="1":delete this.defines.DOWNSAMPLE_NORMALS,this.needsUpdate=!0}setNormalBuffer(n){this.normalBuffer=n}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e)}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},_L=class extends Ps{constructor({normalBuffer:n=null,resolutionScale:e=.5,width:i=Ri.AUTO_SIZE,height:s=Ri.AUTO_SIZE,resolutionX:r=i,resolutionY:o=s}={}){super("DepthDownsamplingPass");const a=new Ble;a.normalBuffer=n,this.fullscreenMaterial=a,this.needsDepthTexture=!0,this.needsSwap=!1,this.renderTarget=new Zt(1,1,{minFilter:Dt,magFilter:Dt,depthBuffer:!1,type:Hi}),this.renderTarget.texture.name="DepthDownsamplingPass.Target",this.renderTarget.texture.generateMipmaps=!1;const l=this.resolution=new Ri(this,r,o,e);l.addEventListener("change",c=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}setDepthTexture(n,e=Ys){this.fullscreenMaterial.depthBuffer=n,this.fullscreenMaterial.depthPacking=e}render(n,e,i,s,r){n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,e){const i=this.resolution;i.setBaseSize(n,e),this.renderTarget.setSize(i.width,i.height),this.fullscreenMaterial.setSize(n,e)}initialize(n,e,i){const s=n.getContext();if(!(s.getExtension("EXT_color_buffer_float")||s.getExtension("EXT_color_buffer_half_float")))throw new Error("Rendering to float texture is not supported.")}},kle=`uniform lowp sampler2D aoBuffer;uniform float luminanceInfluence;uniform float intensity;
#if defined(DEPTH_AWARE_UPSAMPLING) && defined(NORMAL_DEPTH)
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D normalDepthBuffer;
#else
uniform mediump sampler2D normalDepthBuffer;
#endif
#endif
#ifdef COLORIZE
uniform vec3 color;
#endif
void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){float aoLinear=texture2D(aoBuffer,uv).r;
#if defined(DEPTH_AWARE_UPSAMPLING) && defined(NORMAL_DEPTH) && __VERSION__ == 300
vec4 normalDepth[4];normalDepth[0]=textureOffset(normalDepthBuffer,uv,ivec2(0,0));normalDepth[1]=textureOffset(normalDepthBuffer,uv,ivec2(0,1));normalDepth[2]=textureOffset(normalDepthBuffer,uv,ivec2(1,0));normalDepth[3]=textureOffset(normalDepthBuffer,uv,ivec2(1,1));float dot01=dot(normalDepth[0].rgb,normalDepth[1].rgb);float dot02=dot(normalDepth[0].rgb,normalDepth[2].rgb);float dot03=dot(normalDepth[0].rgb,normalDepth[3].rgb);float minDot=min(dot01,min(dot02,dot03));float s=step(THRESHOLD,minDot);float smallestDistance=1.0;int index;for(int i=0;i<4;++i){float distance=abs(depth-normalDepth[i].a);if(distance<smallestDistance){smallestDistance=distance;index=i;}}ivec2 offsets[4];offsets[0]=ivec2(0,0);offsets[1]=ivec2(0,1);offsets[2]=ivec2(1,0);offsets[3]=ivec2(1,1);ivec2 coord=ivec2(uv*vec2(textureSize(aoBuffer,0)))+offsets[index];float aoNearest=texelFetch(aoBuffer,coord,0).r;float ao=mix(aoNearest,aoLinear,s);
#else
float ao=aoLinear;
#endif
float l=luminance(inputColor.rgb);ao=mix(ao,0.0,l*luminanceInfluence);ao=clamp(ao*intensity,0.0,1.0);
#ifdef COLORIZE
outputColor=vec4(1.0-ao*(1.0-color),inputColor.a);
#else
outputColor=vec4(vec3(1.0-ao),inputColor.a);
#endif
}`,aV=64,lV=class extends so{constructor(n,e,{blendFunction:i=Ht.MULTIPLY,samples:s=9,rings:r=7,normalDepthBuffer:o=null,depthAwareUpsampling:a=!0,worldDistanceThreshold:l,worldDistanceFalloff:c,worldProximityThreshold:h,worldProximityFalloff:u,distanceThreshold:d=.97,distanceFalloff:m=.03,rangeThreshold:f=5e-4,rangeFalloff:g=.001,minRadiusScale:y=.1,luminanceInfluence:v=.7,radius:b=.1825,intensity:A=1,bias:x=.025,fade:w=.01,color:_=null,resolutionScale:S=1,width:M=Ri.AUTO_SIZE,height:R=Ri.AUTO_SIZE,resolutionX:P=M,resolutionY:C=R}={}){super("SSAOEffect",kle,{blendFunction:i,attributes:Yo.DEPTH,defines:new Map([["THRESHOLD","0.997"]]),uniforms:new Map([["aoBuffer",new Ce(null)],["normalDepthBuffer",new Ce(o)],["luminanceInfluence",new Ce(v)],["color",new Ce(null)],["intensity",new Ce(A)],["scale",new Ce(0)]])}),this.renderTarget=new Zt(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="AO.Target",this.uniforms.get("aoBuffer").value=this.renderTarget.texture;const L=this.resolution=new Ri(this,P,C,S);L.addEventListener("change",D=>this.setSize(L.baseWidth,L.baseHeight)),this.camera=n,this.depthDownsamplingPass=new _L({normalBuffer:e,resolutionScale:S}),this.depthDownsamplingPass.enabled=o===null,this.ssaoPass=new hc(new Ile(n));const B=new ple(aV,aV,_i);B.wrapS=B.wrapT=_o;const z=this.ssaoMaterial;z.normalBuffer=e,z.noiseTexture=B,z.minRadiusScale=y,z.samples=s,z.radius=b,z.rings=r,z.fade=w,z.bias=x,z.distanceThreshold=d,z.distanceFalloff=m,z.proximityThreshold=f,z.proximityFalloff=g,l!==void 0&&(z.worldDistanceThreshold=l),c!==void 0&&(z.worldDistanceFalloff=c),h!==void 0&&(z.worldProximityThreshold=h),u!==void 0&&(z.worldProximityFalloff=u),o!==null&&(this.ssaoMaterial.normalDepthBuffer=o,this.defines.set("NORMAL_DEPTH","1")),this.depthAwareUpsampling=a,this.color=_}set mainCamera(n){this.camera=n,this.ssaoMaterial.copyCameraSettings(n)}get normalBuffer(){return this.ssaoMaterial.normalBuffer}set normalBuffer(n){this.ssaoMaterial.normalBuffer=n,this.depthDownsamplingPass.fullscreenMaterial.normalBuffer=n}getResolution(){return this.resolution}get ssaoMaterial(){return this.ssaoPass.fullscreenMaterial}getSSAOMaterial(){return this.ssaoMaterial}get samples(){return this.ssaoMaterial.samples}set samples(n){this.ssaoMaterial.samples=n}get rings(){return this.ssaoMaterial.rings}set rings(n){this.ssaoMaterial.rings=n}get radius(){return this.ssaoMaterial.radius}set radius(n){this.ssaoMaterial.radius=n}get depthAwareUpsampling(){return this.defines.has("DEPTH_AWARE_UPSAMPLING")}set depthAwareUpsampling(n){this.depthAwareUpsampling!==n&&(n?this.defines.set("DEPTH_AWARE_UPSAMPLING","1"):this.defines.delete("DEPTH_AWARE_UPSAMPLING"),this.setChanged())}isDepthAwareUpsamplingEnabled(){return this.depthAwareUpsampling}setDepthAwareUpsamplingEnabled(n){this.depthAwareUpsampling=n}get distanceScaling(){return!0}set distanceScaling(n){}get color(){return this.uniforms.get("color").value}set color(n){const e=this.uniforms,i=this.defines;n!==null?i.has("COLORIZE")?e.get("color").value.set(n):(i.set("COLORIZE","1"),e.get("color").value=new Ae(n),this.setChanged()):i.has("COLORIZE")&&(i.delete("COLORIZE"),e.get("color").value=null,this.setChanged())}get luminanceInfluence(){return this.uniforms.get("luminanceInfluence").value}set luminanceInfluence(n){this.uniforms.get("luminanceInfluence").value=n}get intensity(){return this.uniforms.get("intensity").value}set intensity(n){this.uniforms.get("intensity").value=n}getColor(){return this.color}setColor(n){this.color=n}setDistanceCutoff(n,e){this.ssaoMaterial.distanceThreshold=n,this.ssaoMaterial.distanceFalloff=e}setProximityCutoff(n,e){this.ssaoMaterial.proximityThreshold=n,this.ssaoMaterial.proximityFalloff=e}setDepthTexture(n,e=Ys){this.depthDownsamplingPass.setDepthTexture(n,e),this.ssaoMaterial.depthBuffer=n,this.ssaoMaterial.depthPacking=e}update(n,e,i){const s=this.renderTarget;this.depthDownsamplingPass.enabled&&this.depthDownsamplingPass.render(n),this.ssaoPass.render(n,null,s)}setSize(n,e){const i=this.resolution;i.setBaseSize(n,e);const s=i.width,r=i.height;this.ssaoMaterial.copyCameraSettings(this.camera),this.ssaoMaterial.setSize(s,r),this.renderTarget.setSize(s,r),this.depthDownsamplingPass.resolution.scale=i.scale,this.depthDownsamplingPass.setSize(n,e)}initialize(n,e,i){try{let s=this.uniforms.get("normalDepthBuffer").value;s===null&&(this.depthDownsamplingPass.initialize(n,e,i),s=this.depthDownsamplingPass.texture,this.uniforms.get("normalDepthBuffer").value=s,this.ssaoMaterial.normalDepthBuffer=s,this.defines.set("NORMAL_DEPTH","1"))}catch{this.depthDownsamplingPass.enabled=!1}}},Dle=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform vec4 maskParams;varying vec2 vUv;varying vec2 vUv2;varying vec2 vOffset;float linearGradientMask(const in float x){return smoothstep(maskParams.x,maskParams.y,x)-smoothstep(maskParams.w,maskParams.z,x);}void main(){vec2 dUv=vOffset*(1.0-linearGradientMask(vUv2.y));vec4 sum=texture2D(inputBuffer,vec2(vUv.x-dUv.x,vUv.y+dUv.y));sum+=texture2D(inputBuffer,vec2(vUv.x+dUv.x,vUv.y+dUv.y));sum+=texture2D(inputBuffer,vec2(vUv.x+dUv.x,vUv.y-dUv.y));sum+=texture2D(inputBuffer,vec2(vUv.x-dUv.x,vUv.y-dUv.y));gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,Ole="uniform vec4 texelSize;uniform float kernel;uniform float scale;uniform float aspect;uniform vec2 rotation;varying vec2 vUv;varying vec2 vUv2;varying vec2 vOffset;void main(){vec2 uv=position.xy*0.5+0.5;vUv=uv;vUv2=(uv-0.5)*2.0*vec2(aspect,1.0);vUv2=vec2(dot(rotation,vUv2),dot(rotation,vec2(vUv2.y,-vUv2.x)));vOffset=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;gl_Position=vec4(position.xy,1.0,1.0);}",Gle=class extends Z5{constructor({kernelSize:n=cc.MEDIUM,offset:e=0,rotation:i=0,focusArea:s=.4,feather:r=.3}={}){super(),this.fragmentShader=Dle,this.vertexShader=Ole,this.kernelSize=n,this.uniforms.aspect=new Ce(1),this.uniforms.rotation=new Ce(new Y),this.uniforms.maskParams=new Ce(new Ze),this._offset=e,this._focusArea=s,this._feather=r,this.rotation=i,this.updateParams()}updateParams(){const n=this.uniforms.maskParams.value,e=Math.max(this.focusArea,0),i=Math.max(e-this.feather,0);n.set(this.offset-e,this.offset-i,this.offset+e,this.offset+i)}get rotation(){return Math.acos(this.uniforms.rotation.value.x)}set rotation(n){this.uniforms.rotation.value.set(Math.cos(n),Math.sin(n))}get offset(){return this._offset}set offset(n){this._offset=n,this.updateParams()}get focusArea(){return this._focusArea}set focusArea(n){this._focusArea=n,this.updateParams()}get feather(){return this._feather}set feather(n){this._feather=n,this.updateParams()}setSize(n,e){super.setSize(n,e),this.uniforms.aspect.value=n/e}},zle=class extends AL{constructor({offset:n=0,rotation:e=0,focusArea:i=.4,feather:s=.3,kernelSize:r=cc.MEDIUM,resolutionScale:o=.5,resolutionX:a=Ri.AUTO_SIZE,resolutionY:l=Ri.AUTO_SIZE}={}){super({kernelSize:r,resolutionScale:o,resolutionX:a,resolutionY:l}),this.blurMaterial=new Gle({kernelSize:r,offset:n,rotation:e,focusArea:i,feather:s})}},Fle=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform vec2 maskParams;varying vec2 vUv2;float linearGradientMask(const in float x){return step(maskParams.x,x)-step(maskParams.y,x);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){float mask=linearGradientMask(vUv2.y);vec4 texel=texture2D(map,uv);outputColor=mix(texel,inputColor,mask);}`,Nle="uniform vec2 rotation;varying vec2 vUv2;void mainSupport(const in vec2 uv){vUv2=(uv-0.5)*2.0*vec2(aspect,1.0);vUv2=vec2(dot(rotation,vUv2),dot(rotation,vec2(vUv2.y,-vUv2.x)));}",cV=class extends so{constructor({blendFunction:n,offset:e=0,rotation:i=0,focusArea:s=.4,feather:r=.3,kernelSize:o=cc.MEDIUM,resolutionScale:a=.5,resolutionX:l=Ri.AUTO_SIZE,resolutionY:c=Ri.AUTO_SIZE}={}){super("TiltShiftEffect",Fle,{vertexShader:Nle,blendFunction:n,uniforms:new Map([["rotation",new Ce(new Y)],["maskParams",new Ce(new Y)],["map",new Ce(null)]])}),this._offset=e,this._focusArea=s,this._feather=r,this.renderTarget=new Zt(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="TiltShift.Target",this.uniforms.get("map").value=this.renderTarget.texture,this.blurPass=new zle({kernelSize:o,resolutionScale:a,resolutionX:l,resolutionY:c,offset:e,rotation:i,focusArea:s,feather:r});const h=this.resolution=new Ri(this,l,c,a);h.addEventListener("change",u=>this.setSize(h.baseWidth,h.baseHeight)),this.rotation=i,this.updateParams()}updateParams(){const n=this.uniforms.get("maskParams").value,e=Math.max(this.focusArea-this.feather,0);n.set(this.offset-e,this.offset+e)}get rotation(){return Math.acos(this.uniforms.get("rotation").value.x)}set rotation(n){this.uniforms.get("rotation").value.set(Math.cos(n),Math.sin(n)),this.blurPass.blurMaterial.rotation=n}get offset(){return this._offset}set offset(n){this._offset=n,this.blurPass.blurMaterial.offset=n,this.updateParams()}get focusArea(){return this._focusArea}set focusArea(n){this._focusArea=n,this.blurPass.blurMaterial.focusArea=n,this.updateParams()}get feather(){return this._feather}set feather(n){this._feather=n,this.blurPass.blurMaterial.feather=n,this.updateParams()}get bias(){return 0}set bias(n){}update(n,e,i){this.blurPass.render(n,e,this.renderTarget)}setSize(n,e){const i=this.resolution;i.setBaseSize(n,e),this.renderTarget.setSize(i.width,i.height),this.blurPass.resolution.copy(i)}initialize(n,e,i){this.blurPass.initialize(n,e,i),i!==void 0&&(this.renderTarget.texture.type=i,n!==null&&n.outputColorSpace===vt&&(this.renderTarget.texture.colorSpace=vt))}},Ule=`#include <packing>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
uniform lowp sampler2D luminanceBuffer0;uniform lowp sampler2D luminanceBuffer1;uniform float minLuminance;uniform float deltaTime;uniform float tau;varying vec2 vUv;void main(){float l0=unpackRGBAToFloat(texture2D(luminanceBuffer0,vUv));
#if __VERSION__ < 300
float l1=texture2DLodEXT(luminanceBuffer1,vUv,MIP_LEVEL_1X1).r;
#else
float l1=textureLod(luminanceBuffer1,vUv,MIP_LEVEL_1X1).r;
#endif
l0=max(minLuminance,l0);l1=max(minLuminance,l1);float adaptedLum=l0+(l1-l0)*(1.0-exp(-deltaTime*tau));gl_FragColor=(adaptedLum==1.0)?vec4(1.0):packFloatToRGBA(adaptedLum);}`,Vle=class extends kt{constructor(){super({name:"AdaptiveLuminanceMaterial",defines:{MIP_LEVEL_1X1:"0.0"},uniforms:{luminanceBuffer0:new Ce(null),luminanceBuffer1:new Ce(null),minLuminance:new Ce(.01),deltaTime:new Ce(0),tau:new Ce(1)},extensions:{shaderTextureLOD:!0},blending:dn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Ule,vertexShader:nm})}set luminanceBuffer0(n){this.uniforms.luminanceBuffer0.value=n}setLuminanceBuffer0(n){this.uniforms.luminanceBuffer0.value=n}set luminanceBuffer1(n){this.uniforms.luminanceBuffer1.value=n}setLuminanceBuffer1(n){this.uniforms.luminanceBuffer1.value=n}set mipLevel1x1(n){this.defines.MIP_LEVEL_1X1=n.toFixed(1),this.needsUpdate=!0}setMipLevel1x1(n){this.mipLevel1x1=n}set deltaTime(n){this.uniforms.deltaTime.value=n}setDeltaTime(n){this.uniforms.deltaTime.value=n}get minLuminance(){return this.uniforms.minLuminance.value}set minLuminance(n){this.uniforms.minLuminance.value=n}getMinLuminance(){return this.uniforms.minLuminance.value}setMinLuminance(n){this.uniforms.minLuminance.value=n}get adaptationRate(){return this.uniforms.tau.value}set adaptationRate(n){this.uniforms.tau.value=n}getAdaptationRate(){return this.uniforms.tau.value}setAdaptationRate(n){this.uniforms.tau.value=n}},Xle=class extends Ps{constructor(n,{minLuminance:e=.01,adaptationRate:i=1}={}){super("AdaptiveLuminancePass"),this.fullscreenMaterial=new Vle,this.needsSwap=!1,this.renderTargetPrevious=new Zt(1,1,{minFilter:Dt,magFilter:Dt,depthBuffer:!1}),this.renderTargetPrevious.texture.name="Luminance.Previous";const s=this.fullscreenMaterial;s.luminanceBuffer0=this.renderTargetPrevious.texture,s.luminanceBuffer1=n,s.minLuminance=e,s.adaptationRate=i,this.renderTargetAdapted=this.renderTargetPrevious.clone(),this.renderTargetAdapted.texture.name="Luminance.Adapted",this.copyPass=new H5(this.renderTargetPrevious,!1)}get texture(){return this.renderTargetAdapted.texture}getTexture(){return this.renderTargetAdapted.texture}set mipLevel1x1(n){this.fullscreenMaterial.mipLevel1x1=n}get adaptationRate(){return this.fullscreenMaterial.adaptationRate}set adaptationRate(n){this.fullscreenMaterial.adaptationRate=n}render(n,e,i,s,r){this.fullscreenMaterial.deltaTime=s,n.setRenderTarget(this.renderToScreen?null:this.renderTargetAdapted),n.render(this.scene,this.camera),this.copyPass.render(n,this.renderTargetAdapted)}},Wle=`#include <tonemapping_pars_fragment>
uniform float whitePoint;
#if TONE_MAPPING_MODE == 2 || TONE_MAPPING_MODE == 3
uniform float middleGrey;
#if TONE_MAPPING_MODE == 3
uniform lowp sampler2D luminanceBuffer;
#else
uniform float averageLuminance;
#endif
vec3 Reinhard2ToneMapping(vec3 color){color*=toneMappingExposure;float l=luminance(color);
#if TONE_MAPPING_MODE == 3
float lumAvg=unpackRGBAToFloat(texture2D(luminanceBuffer,vec2(0.5)));
#else
float lumAvg=averageLuminance;
#endif
float lumScaled=(l*middleGrey)/max(lumAvg,1e-6);float lumCompressed=lumScaled*(1.0+lumScaled/(whitePoint*whitePoint));lumCompressed/=(1.0+lumScaled);return clamp(lumCompressed*color,0.0,1.0);}
#elif TONE_MAPPING_MODE == 4
#define A 0.15
#define B 0.50
#define C 0.10
#define D 0.20
#define E 0.02
#define F 0.30
vec3 Uncharted2Helper(const in vec3 x){return((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}vec3 Uncharted2ToneMapping(vec3 color){color*=toneMappingExposure;return clamp(Uncharted2Helper(color)/Uncharted2Helper(vec3(whitePoint)),0.0,1.0);}
#endif
void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){
#if TONE_MAPPING_MODE == 2 || TONE_MAPPING_MODE == 3
outputColor=vec4(Reinhard2ToneMapping(inputColor.rgb),inputColor.a);
#elif TONE_MAPPING_MODE == 4
outputColor=vec4(Uncharted2ToneMapping(inputColor.rgb),inputColor.a);
#else
outputColor=vec4(toneMapping(inputColor.rgb),inputColor.a);
#endif
}`,k_=class extends so{constructor({blendFunction:n=Ht.SRC,adaptive:e=!1,mode:i=e?As.REINHARD2_ADAPTIVE:As.AGX,resolution:s=256,maxLuminance:r=4,whitePoint:o=r,middleGrey:a=.6,minLuminance:l=.01,averageLuminance:c=1,adaptationRate:h=1}={}){super("ToneMappingEffect",Wle,{blendFunction:n,uniforms:new Map([["luminanceBuffer",new Ce(null)],["maxLuminance",new Ce(r)],["whitePoint",new Ce(o)],["middleGrey",new Ce(a)],["averageLuminance",new Ce(c)]])}),this.renderTargetLuminance=new Zt(1,1,{minFilter:So,depthBuffer:!1}),this.renderTargetLuminance.texture.generateMipmaps=!0,this.renderTargetLuminance.texture.name="Luminance",this.luminancePass=new Y5({renderTarget:this.renderTargetLuminance}),this.adaptiveLuminancePass=new Xle(this.luminancePass.texture,{minLuminance:l,adaptationRate:h}),this.uniforms.get("luminanceBuffer").value=this.adaptiveLuminancePass.texture,this.resolution=s,this.mode=i}get mode(){return Number(this.defines.get("TONE_MAPPING_MODE"))}set mode(n){if(this.mode===n)return;const e=sh.replace(/\D+/g,"")>=168?"CineonToneMapping(texel)":"OptimizedCineonToneMapping(texel)";switch(this.defines.clear(),this.defines.set("TONE_MAPPING_MODE",n.toFixed(0)),n){case As.LINEAR:this.defines.set("toneMapping(texel)","LinearToneMapping(texel)");break;case As.REINHARD:this.defines.set("toneMapping(texel)","ReinhardToneMapping(texel)");break;case As.CINEON:case As.OPTIMIZED_CINEON:this.defines.set("toneMapping(texel)",e);break;case As.ACES_FILMIC:this.defines.set("toneMapping(texel)","ACESFilmicToneMapping(texel)");break;case As.AGX:this.defines.set("toneMapping(texel)","AgXToneMapping(texel)");break;case As.NEUTRAL:this.defines.set("toneMapping(texel)","NeutralToneMapping(texel)");break;default:this.defines.set("toneMapping(texel)","texel");break}this.adaptiveLuminancePass.enabled=n===As.REINHARD2_ADAPTIVE,this.setChanged()}getMode(){return this.mode}setMode(n){this.mode=n}get whitePoint(){return this.uniforms.get("whitePoint").value}set whitePoint(n){this.uniforms.get("whitePoint").value=n}get middleGrey(){return this.uniforms.get("middleGrey").value}set middleGrey(n){this.uniforms.get("middleGrey").value=n}get averageLuminance(){return this.uniforms.get("averageLuminance").value}set averageLuminance(n){this.uniforms.get("averageLuminance").value=n}get adaptiveLuminanceMaterial(){return this.adaptiveLuminancePass.fullscreenMaterial}getAdaptiveLuminanceMaterial(){return this.adaptiveLuminanceMaterial}get resolution(){return this.luminancePass.resolution.width}set resolution(n){const e=Math.max(0,Math.ceil(Math.log2(n))),i=Math.pow(2,e);this.luminancePass.resolution.setPreferredSize(i,i),this.adaptiveLuminanceMaterial.mipLevel1x1=e}getResolution(){return this.resolution}setResolution(n){this.resolution=n}get adaptive(){return this.mode===As.REINHARD2_ADAPTIVE}set adaptive(n){this.mode=n?As.REINHARD2_ADAPTIVE:As.REINHARD2}get adaptationRate(){return this.adaptiveLuminanceMaterial.adaptationRate}set adaptationRate(n){this.adaptiveLuminanceMaterial.adaptationRate=n}get distinction(){return console.warn(this.name,"distinction was removed."),1}set distinction(n){console.warn(this.name,"distinction was removed.")}update(n,e,i){this.adaptiveLuminancePass.enabled&&(this.luminancePass.render(n,e),this.adaptiveLuminancePass.render(n,null,null,i))}initialize(n,e,i){this.adaptiveLuminancePass.initialize(n,e,i)}},Hle=`uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;
#if VIGNETTE_TECHNIQUE == 0
float d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));
#else
vec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));
#endif
outputColor=vec4(color,inputColor.a);}`,hV=class extends so{constructor({blendFunction:n,eskil:e=!1,technique:i=e?Yv.ESKIL:Yv.DEFAULT,offset:s=.5,darkness:r=.5}={}){super("VignetteEffect",Hle,{blendFunction:n,defines:new Map([["VIGNETTE_TECHNIQUE",i.toFixed(0)]]),uniforms:new Map([["offset",new Ce(s)],["darkness",new Ce(r)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(n){this.technique!==n&&(this.defines.set("VIGNETTE_TECHNIQUE",n.toFixed(0)),this.setChanged())}get eskil(){return this.technique===Yv.ESKIL}set eskil(n){this.technique=n?Yv.ESKIL:Yv.DEFAULT}getTechnique(){return this.technique}setTechnique(n){this.technique=n}get offset(){return this.uniforms.get("offset").value}set offset(n){this.uniforms.get("offset").value=n}getOffset(){return this.offset}setOffset(n){this.offset=n}get darkness(){return this.uniforms.get("darkness").value}set darkness(n){this.uniforms.get("darkness").value=n}getDarkness(){return this.darkness}setDarkness(n){this.darkness=n}},jle=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
}`,Qle="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",Zle=class extends kt{constructor(n,e,i,s,r=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:sh.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new Ce(null),depthBuffer:new Ce(null),resolution:new Ce(new Y),texelSize:new Ce(new Y),cameraNear:new Ce(.3),cameraFar:new Ce(1e3),aspect:new Ce(1),time:new Ce(0)},blending:dn,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:r}),n&&this.setShaderParts(n),e&&this.setDefines(e),i&&this.setUniforms(i),this.copyCameraSettings(s)}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(n){this.uniforms.depthBuffer.value=n}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=Ys){this.depthBuffer=n,this.depthPacking=e}setShaderData(n){this.setShaderParts(n.shaderParts),this.setDefines(n.defines),this.setUniforms(n.uniforms),this.setExtensions(n.extensions)}setShaderParts(n){return this.fragmentShader=jle.replace(Si.FRAGMENT_HEAD,n.get(Si.FRAGMENT_HEAD)||"").replace(Si.FRAGMENT_MAIN_UV,n.get(Si.FRAGMENT_MAIN_UV)||"").replace(Si.FRAGMENT_MAIN_IMAGE,n.get(Si.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=Qle.replace(Si.VERTEX_HEAD,n.get(Si.VERTEX_HEAD)||"").replace(Si.VERTEX_MAIN_SUPPORT,n.get(Si.VERTEX_MAIN_SUPPORT)||""),this.needsUpdate=!0,this}setDefines(n){for(const e of n.entries())this.defines[e[0]]=e[1];return this.needsUpdate=!0,this}setUniforms(n){for(const e of n.entries())this.uniforms[e[0]]=e[1];return this}setExtensions(n){this.extensions={};for(const e of n)this.extensions[e]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(n){this.encodeOutput!==n&&(n?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(n){return this.encodeOutput}setOutputEncodingEnabled(n){this.encodeOutput=n}get time(){return this.uniforms.time.value}set time(n){this.uniforms.time.value=n}setDeltaTime(n){this.uniforms.time.value+=n}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNear.value=n.near,this.uniforms.cameraFar.value=n.far,n instanceof Lt?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(n,e){const i=this.uniforms;i.resolution.value.set(n,e),i.texelSize.value.set(1/n,1/e),i.aspect.value=n/e}static get Section(){return Si}};function uV(n,e,i){for(const s of e){const r="$1"+n+s.charAt(0).toUpperCase()+s.slice(1),o=new RegExp("([^\\.])(\\b"+s+"\\b)","g");for(const a of i.entries())a[1]!==null&&i.set(a[0],a[1].replace(o,r))}}function Yle(n,e,i){let s=e.getFragmentShader(),r=e.getVertexShader();const o=s!==void 0&&/mainImage/.test(s),a=s!==void 0&&/mainUv/.test(s);if(i.attributes|=e.getAttributes(),s===void 0)throw new Error(`Missing fragment shader (${e.name})`);if(a&&i.attributes&Yo.CONVOLUTION)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${e.name})`);if(!o&&!a)throw new Error(`Could not find mainImage or mainUv function (${e.name})`);{const l=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,c=i.shaderParts;let h=c.get(Si.FRAGMENT_HEAD)||"",u=c.get(Si.FRAGMENT_MAIN_UV)||"",d=c.get(Si.FRAGMENT_MAIN_IMAGE)||"",m=c.get(Si.VERTEX_HEAD)||"",f=c.get(Si.VERTEX_MAIN_SUPPORT)||"";const g=new Set,y=new Set;if(a&&(u+=`	${n}MainUv(UV);
`,i.uvTransformation=!0),r!==null&&/mainSupport/.test(r)){const A=/mainSupport *\([\w\s]*?uv\s*?\)/.test(r);f+=`	${n}MainSupport(`,f+=A?`vUv);
`:`);
`;for(const x of r.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const w of x[1].split(/\s*,\s*/))i.varyings.add(w),g.add(w),y.add(w);for(const x of r.matchAll(l))y.add(x[1])}for(const A of s.matchAll(l))y.add(A[1]);for(const A of e.defines.keys())y.add(A.replace(/\([\w\s,]*\)/g,""));for(const A of e.uniforms.keys())y.add(A);y.delete("while"),y.delete("for"),y.delete("if"),e.uniforms.forEach((A,x)=>i.uniforms.set(n+x.charAt(0).toUpperCase()+x.slice(1),A)),e.defines.forEach((A,x)=>i.defines.set(n+x.charAt(0).toUpperCase()+x.slice(1),A));const v=new Map([["fragment",s],["vertex",r]]);uV(n,y,i.defines),uV(n,y,v),s=v.get("fragment"),r=v.get("vertex");const b=e.blendMode;if(i.blendModes.set(b.blendFunction,b),o){e.inputColorSpace!==null&&e.inputColorSpace!==i.colorSpace&&(d+=e.inputColorSpace===vt?`color0 = sRGBTransferOETF(color0);
	`:`color0 = sRGBToLinear(color0);
	`),e.outputColorSpace!==Co?i.colorSpace=e.outputColorSpace:e.inputColorSpace!==null&&(i.colorSpace=e.inputColorSpace);const A=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;d+=`${n}MainImage(color0, UV, `,i.attributes&Yo.DEPTH&&A.test(s)&&(d+="depth, ",i.readDepth=!0),d+=`color1);
	`;const x=n+"BlendOpacity";i.uniforms.set(x,b.opacity),d+=`color0 = blend${b.blendFunction}(color0, color1, ${x});

	`,h+=`uniform float ${x};

`}if(h+=s+`
`,r!==null&&(m+=r+`
`),c.set(Si.FRAGMENT_HEAD,h),c.set(Si.FRAGMENT_MAIN_UV,u),c.set(Si.FRAGMENT_MAIN_IMAGE,d),c.set(Si.VERTEX_HEAD,m),c.set(Si.VERTEX_MAIN_SUPPORT,f),e.extensions!==null)for(const A of e.extensions)i.extensions.add(A)}}var dV=class extends Ps{constructor(n,...e){super("EffectPass"),this.fullscreenMaterial=new Zle(null,null,null,n),this.listener=i=>this.handleEvent(i),this.effects=[],this.setEffects(e),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(n){for(const e of this.effects)e.mainScene=n}set mainCamera(n){this.fullscreenMaterial.copyCameraSettings(n);for(const e of this.effects)e.mainCamera=n}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(n){this.fullscreenMaterial.encodeOutput=n}get dithering(){return this.fullscreenMaterial.dithering}set dithering(n){const e=this.fullscreenMaterial;e.dithering=n,e.needsUpdate=!0}setEffects(n){for(const e of this.effects)e.removeEventListener("change",this.listener);this.effects=n.sort((e,i)=>i.attributes-e.attributes);for(const e of this.effects)e.addEventListener("change",this.listener)}updateMaterial(){const n=new aae;let e=0;for(const a of this.effects)if(a.blendMode.blendFunction===Ht.DST)n.attributes|=a.getAttributes()&Yo.DEPTH;else{if(n.attributes&a.getAttributes()&Yo.CONVOLUTION)throw new Error(`Convolution effects cannot be merged (${a.name})`);Yle("e"+e++,a,n)}let i=n.shaderParts.get(Si.FRAGMENT_HEAD),s=n.shaderParts.get(Si.FRAGMENT_MAIN_IMAGE),r=n.shaderParts.get(Si.FRAGMENT_MAIN_UV);const o=/\bblend\b/g;for(const a of n.blendModes.values())i+=a.getShaderCode().replace(o,`blend${a.blendFunction}`)+`
`;n.attributes&Yo.DEPTH?(n.readDepth&&(s=`float depth = readDepth(UV);

	`+s),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,n.colorSpace===vt&&(s+=`color0 = sRGBToLinear(color0);
	`),n.uvTransformation?(r=`vec2 transformedUv = vUv;
`+r,n.defines.set("UV","transformedUv")):n.defines.set("UV","vUv"),n.shaderParts.set(Si.FRAGMENT_HEAD,i),n.shaderParts.set(Si.FRAGMENT_MAIN_IMAGE,s),n.shaderParts.set(Si.FRAGMENT_MAIN_UV,r);for(const[a,l]of n.shaderParts)l!==null&&n.shaderParts.set(a,l.trim().replace(/^#/,`
#`));this.skipRendering=e===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(n)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(n,e=Ys){this.fullscreenMaterial.depthBuffer=n,this.fullscreenMaterial.depthPacking=e;for(const i of this.effects)i.setDepthTexture(n,e)}render(n,e,i,s,r){for(const o of this.effects)o.update(n,e,s);if(!this.skipRendering||this.renderToScreen){const o=this.fullscreenMaterial;o.inputBuffer=e.texture,o.time+=s*this.timeScale,n.setRenderTarget(this.renderToScreen?null:i),n.render(this.scene,this.camera)}}setSize(n,e){this.fullscreenMaterial.setSize(n,e);for(const i of this.effects)i.setSize(n,e)}initialize(n,e,i){this.renderer=n;for(const s of this.effects)s.initialize(n,e,i);this.updateMaterial(),i!==void 0&&i!==pn&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const n of this.effects)n.removeEventListener("change",this.listener),n.dispose()}handleEvent(n){switch(n.type){case"change":this.recompile();break}}},pV=class extends Ps{constructor(n,e,{renderTarget:i,resolutionScale:s=1,width:r=Ri.AUTO_SIZE,height:o=Ri.AUTO_SIZE,resolutionX:a=r,resolutionY:l=o}={}){super("NormalPass"),this.needsSwap=!1,this.renderPass=new B_(n,e,new Xw);const c=this.renderPass;c.ignoreBackground=!0,c.skipShadowMapUpdate=!0;const h=c.getClearPass();h.overrideClearColor=new Ae(7829503),h.overrideClearAlpha=1,this.renderTarget=i,this.renderTarget===void 0&&(this.renderTarget=new Zt(1,1,{minFilter:Dt,magFilter:Dt}),this.renderTarget.texture.name="NormalPass.Target");const u=this.resolution=new Ri(this,a,l,s);u.addEventListener("change",d=>this.setSize(u.baseWidth,u.baseHeight))}set mainScene(n){this.renderPass.mainScene=n}set mainCamera(n){this.renderPass.mainCamera=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,e,i,s,r){const o=this.renderToScreen?null:this.renderTarget;this.renderPass.render(n,o,o)}setSize(n,e){const i=this.resolution;i.setBaseSize(n,e),this.renderTarget.setSize(i.width,i.height)}},Kv=function(){var n=0,e=document.createElement("div");e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",function(u){u.preventDefault(),s(++n%e.children.length)},!1);function i(u){return e.appendChild(u.dom),u}function s(u){for(var d=0;d<e.children.length;d++)e.children[d].style.display=d===u?"block":"none";n=u}var r=(performance||Date).now(),o=r,a=0,l=i(new Kv.Panel("FPS","#0ff","#002")),c=i(new Kv.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var h=i(new Kv.Panel("MB","#f08","#201"));return s(0),{REVISION:16,dom:e,addPanel:i,showPanel:s,begin:function(){r=(performance||Date).now()},end:function(){a++;var u=(performance||Date).now();if(c.update(u-r,200),u>=o+1e3&&(l.update(a*1e3/(u-o),100),o=u,a=0,h)){var d=performance.memory;h.update(d.usedJSHeapSize/1048576,d.jsHeapSizeLimit/1048576)}return u},update:function(){r=this.end()},domElement:e,setMode:s}};Kv.Panel=function(n,e,i){var s=1/0,r=0,o=Math.round,a=o(window.devicePixelRatio||1),l=80*a,c=48*a,h=3*a,u=2*a,d=3*a,m=15*a,f=74*a,g=30*a,y=document.createElement("canvas");y.width=l,y.height=c,y.style.cssText="width:80px;height:48px";var v=y.getContext("2d");return v.font="bold "+9*a+"px Helvetica,Arial,sans-serif",v.textBaseline="top",v.fillStyle=i,v.fillRect(0,0,l,c),v.fillStyle=e,v.fillText(n,h,u),v.fillRect(d,m,f,g),v.fillStyle=i,v.globalAlpha=.9,v.fillRect(d,m,f,g),{dom:y,update:function(b,A){s=Math.min(s,b),r=Math.max(r,b),v.fillStyle=i,v.globalAlpha=1,v.fillRect(0,0,l,m),v.fillStyle=e,v.fillText(o(b)+" "+n+" ("+o(s)+"-"+o(r)+")",h,u),v.drawImage(y,d+a,m,f-a,g,d,m,f-a,g),v.fillRect(d+f-a,m,a,g),v.fillStyle=i,v.globalAlpha=.9,v.fillRect(d+f-a,m,a,o((1-b/A)*g))}}};const Kle=Kv,Jle=te("debugpatch");function D_(n,e,i,s){const r=Jle===e;if(!i&&!s)return;const o=e+"___needle";$le(n,e,i,s);const a=Object.getOwnPropertyDescriptor(n,e),l=n[e];r&&console.log("Patch",n.constructor.name,e,a,l),a?(r&&console.log("Apply patch with existing descriptor",n.constructor.name,e,a),typeof a.value=="function"&&(n[e]=fV(a.value,n,e))):(r&&console.log("Create patch with new property",n.constructor.name,e,a),Object.defineProperty(n,e,{set:function(c){if(typeof c=="function")this[o]=fV(c,n,e);else{const h=this[o];gV(n,e,this,h,c),this[o]=c,yV(n,e,this,h,c)}},get:function(){const c=this[o];return typeof c=="function"&&c[o]?c[o]:c}}))}function qle(n,e,i){const s=CL(n,e);if(s)for(let r=s.length-1;r>=0;r--){const o=s[r];o.prefix===i&&(o.prefix=null),o.postfix===i&&(o.postfix=null),!o.prefix&&!o.postfix&&s.splice(r,1)}}const mV=Symbol("Needle:Patches:WrappedFunction");function fV(n,e,i){if(n[mV])return n;const s=function(...r){gV(e,i,this,...r);const o=n.apply(this,r);return yV(e,i,this,o,...r),o};return s[mV]=!0,s}const O_="Needle:Patches";function SL(){return globalThis[O_]||(globalThis[O_]=new WeakMap),globalThis[O_]}function CL(n,e){const i=SL().get(n);return i?i.get(e):null}function $le(n,e,i,s){let r=SL().get(n);r||(r=new Map,SL().set(n,r));let o=r.get(e);o||(o=[],r.set(e,o)),o.push({prefix:i,postfix:s})}function gV(n,e,i,...s){var r;if(!i)return;const o=CL(n,e);if(o)for(const a of o)(r=a.prefix)==null||r.call(i,...s)}function yV(n,e,i,s,...r){var o;if(!i)return;const a=CL(n,e);if(a)for(const l of a)(o=l.postfix)==null||o.call(i,s,...r)}const vV="";globalThis.GLTF_PROGRESSIVE_VERSION=vV,console.debug(`[gltf-progressive] version ${vV}`);/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const bV="168",G_=0,ece=1,tce=2,AV=1,xV=100,wV=204,_V=205,SV=3,ice=0,CV="attached",nce="detached",MV=300,sce=301,Jv=1e3,om=1001,ML=1002,qv=1003,rce=1004,oce=1005,$v=1006,ace=1007,z_=1008,Oa=1009,am=1015,F_=1016,Hu=1023,xg=1028,eb=1030,lce=33777,cce=33779,hce=35840,uce=35842,dce=36196,pce=37492,mce=37496,fce=37808,EV=37812,gce=36492,tb=2300,ib=2301,EL=2302,TV=2400,RV=2401,IV=2402,yce=2500,vce=0,LV=1,TL=2,bce=0,RL="",Lr="srgb",Io="srgb-linear",PV="display-p3",IL="display-p3-linear",LL="linear",BV="srgb",kV="rec709",DV="p3",wg=7680,OV=519,PL=35044,lm=2e3,BL=2001;class N_{addEventListener(e,i){this._listeners===void 0&&(this._listeners={});const s=this._listeners;s[e]===void 0&&(s[e]=[]),s[e].indexOf(i)===-1&&s[e].push(i)}hasEventListener(e,i){if(this._listeners===void 0)return!1;const s=this._listeners;return s[e]!==void 0&&s[e].indexOf(i)!==-1}removeEventListener(e,i){if(this._listeners===void 0)return;const s=this._listeners[e];if(s!==void 0){const r=s.indexOf(i);r!==-1&&s.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const s=i.slice(0);for(let r=0,o=s.length;r<o;r++)s[r].call(this,e);e.target=null}}}const Pr=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let GV=1234567;const nb=Math.PI/180,sb=180/Math.PI;function wl(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,s=Math.random()*4294967295|0;return(Pr[n&255]+Pr[n>>8&255]+Pr[n>>16&255]+Pr[n>>24&255]+"-"+Pr[e&255]+Pr[e>>8&255]+"-"+Pr[e>>16&15|64]+Pr[e>>24&255]+"-"+Pr[i&63|128]+Pr[i>>8&255]+"-"+Pr[i>>16&255]+Pr[i>>24&255]+Pr[s&255]+Pr[s>>8&255]+Pr[s>>16&255]+Pr[s>>24&255]).toLowerCase()}function Br(n,e,i){return Math.max(e,Math.min(i,n))}function kL(n,e){return(n%e+e)%e}function Ace(n,e,i,s,r){return s+(n-e)*(r-s)/(i-e)}function xce(n,e,i){return n!==e?(i-n)/(e-n):0}function rb(n,e,i){return(1-i)*n+i*e}function wce(n,e,i,s){return rb(n,e,1-Math.exp(-i*s))}function _ce(n,e=1){return e-Math.abs(kL(n,e*2)-e)}function Sce(n,e,i){return n<=e?0:n>=i?1:(n=(n-e)/(i-e),n*n*(3-2*n))}function Cce(n,e,i){return n<=e?0:n>=i?1:(n=(n-e)/(i-e),n*n*n*(n*(n*6-15)+10))}function Mce(n,e){return n+Math.floor(Math.random()*(e-n+1))}function Ece(n,e){return n+Math.random()*(e-n)}function Tce(n){return n*(.5-Math.random())}function Rce(n){n!==void 0&&(GV=n);let e=GV+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function Ice(n){return n*nb}function Lce(n){return n*sb}function Pce(n){return(n&n-1)===0&&n!==0}function Bce(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function kce(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function Dce(n,e,i,s,r){const o=Math.cos,a=Math.sin,l=o(i/2),c=a(i/2),h=o((e+s)/2),u=a((e+s)/2),d=o((e-s)/2),m=a((e-s)/2),f=o((s-e)/2),g=a((s-e)/2);switch(r){case"XYX":n.set(l*u,c*d,c*m,l*h);break;case"YZY":n.set(c*m,l*u,c*d,l*h);break;case"ZXZ":n.set(c*d,c*m,l*u,l*h);break;case"XZX":n.set(l*u,c*g,c*f,l*h);break;case"YXY":n.set(c*f,l*u,c*g,l*h);break;case"ZYZ":n.set(c*g,c*f,l*u,l*h);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function _l(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function Di(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const Oce={DEG2RAD:nb,RAD2DEG:sb,generateUUID:wl,clamp:Br,euclideanModulo:kL,mapLinear:Ace,inverseLerp:xce,lerp:rb,damp:wce,pingpong:_ce,smoothstep:Sce,smootherstep:Cce,randInt:Mce,randFloat:Ece,randFloatSpread:Tce,seededRandom:Rce,degToRad:Ice,radToDeg:Lce,isPowerOfTwo:Pce,ceilPowerOfTwo:Bce,floorPowerOfTwo:kce,setQuaternionFromProperEuler:Dce,normalize:Di,denormalize:_l};class Ln{constructor(e=0,i=0){Ln.prototype.isVector2=!0,this.x=e,this.y=i}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,i){return this.x=e,this.y=i,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const i=this.x,s=this.y,r=e.elements;return this.x=r[0]*i+r[3]*s+r[6],this.y=r[1]*i+r[4]*s+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this}clampLength(e,i){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(e,Math.min(i,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const s=this.dot(e)/i;return Math.acos(Br(s,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,s=this.y-e.y;return i*i+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this}lerpVectors(e,i,s){return this.x=e.x+(i.x-e.x)*s,this.y=e.y+(i.y-e.y)*s,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this}rotateAround(e,i){const s=Math.cos(i),r=Math.sin(i),o=this.x-e.x,a=this.y-e.y;return this.x=o*s-a*r+e.x,this.y=o*r+a*s+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class yu{constructor(e,i,s,r,o,a,l,c,h){yu.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,i,s,r,o,a,l,c,h)}set(e,i,s,r,o,a,l,c,h){const u=this.elements;return u[0]=e,u[1]=r,u[2]=l,u[3]=i,u[4]=o,u[5]=c,u[6]=s,u[7]=a,u[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const i=this.elements,s=e.elements;return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=s[7],i[8]=s[8],this}extractBasis(e,i,s){return e.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),s.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const i=e.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const s=e.elements,r=i.elements,o=this.elements,a=s[0],l=s[3],c=s[6],h=s[1],u=s[4],d=s[7],m=s[2],f=s[5],g=s[8],y=r[0],v=r[3],b=r[6],A=r[1],x=r[4],w=r[7],_=r[2],S=r[5],M=r[8];return o[0]=a*y+l*A+c*_,o[3]=a*v+l*x+c*S,o[6]=a*b+l*w+c*M,o[1]=h*y+u*A+d*_,o[4]=h*v+u*x+d*S,o[7]=h*b+u*w+d*M,o[2]=m*y+f*A+g*_,o[5]=m*v+f*x+g*S,o[8]=m*b+f*w+g*M,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=e,i[4]*=e,i[7]*=e,i[2]*=e,i[5]*=e,i[8]*=e,this}determinant(){const e=this.elements,i=e[0],s=e[1],r=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],u=e[8];return i*a*u-i*l*h-s*o*u+s*l*c+r*o*h-r*a*c}invert(){const e=this.elements,i=e[0],s=e[1],r=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],u=e[8],d=u*a-l*h,m=l*c-u*o,f=h*o-a*c,g=i*d+s*m+r*f;if(g===0)return this.set(0,0,0,0,0,0,0,0,0);const y=1/g;return e[0]=d*y,e[1]=(r*h-u*s)*y,e[2]=(l*s-r*a)*y,e[3]=m*y,e[4]=(u*i-r*c)*y,e[5]=(r*o-l*i)*y,e[6]=f*y,e[7]=(s*c-h*i)*y,e[8]=(a*i-s*o)*y,this}transpose(){let e;const i=this.elements;return e=i[1],i[1]=i[3],i[3]=e,e=i[2],i[2]=i[6],i[6]=e,e=i[5],i[5]=i[7],i[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const i=this.elements;return e[0]=i[0],e[1]=i[3],e[2]=i[6],e[3]=i[1],e[4]=i[4],e[5]=i[7],e[6]=i[2],e[7]=i[5],e[8]=i[8],this}setUvTransform(e,i,s,r,o,a,l){const c=Math.cos(o),h=Math.sin(o);return this.set(s*c,s*h,-s*(c*a+h*l)+a+e,-r*h,r*c,-r*(-h*a+c*l)+l+i,0,0,1),this}scale(e,i){return this.premultiply(DL.makeScale(e,i)),this}rotate(e){return this.premultiply(DL.makeRotation(-e)),this}translate(e,i){return this.premultiply(DL.makeTranslation(e,i)),this}makeTranslation(e,i){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,i,0,0,1),this}makeRotation(e){const i=Math.cos(e),s=Math.sin(e);return this.set(i,-s,0,s,i,0,0,0,1),this}makeScale(e,i){return this.set(e,0,0,0,i,0,0,0,1),this}equals(e){const i=this.elements,s=e.elements;for(let r=0;r<9;r++)if(i[r]!==s[r])return!1;return!0}fromArray(e,i=0){for(let s=0;s<9;s++)this.elements[s]=e[s+i];return this}toArray(e=[],i=0){const s=this.elements;return e[i]=s[0],e[i+1]=s[1],e[i+2]=s[2],e[i+3]=s[3],e[i+4]=s[4],e[i+5]=s[5],e[i+6]=s[6],e[i+7]=s[7],e[i+8]=s[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const DL=new yu;function Gce(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}function OL(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}const zV={};function FV(n){n in zV||(zV[n]=!0,console.warn(n))}const NV=new yu().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),UV=new yu().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),ob={[Io]:{transfer:LL,primaries:kV,luminanceCoefficients:[.2126,.7152,.0722],toReference:n=>n,fromReference:n=>n},[Lr]:{transfer:BV,primaries:kV,luminanceCoefficients:[.2126,.7152,.0722],toReference:n=>n.convertSRGBToLinear(),fromReference:n=>n.convertLinearToSRGB()},[IL]:{transfer:LL,primaries:DV,luminanceCoefficients:[.2289,.6917,.0793],toReference:n=>n.applyMatrix3(UV),fromReference:n=>n.applyMatrix3(NV)},[PV]:{transfer:BV,primaries:DV,luminanceCoefficients:[.2289,.6917,.0793],toReference:n=>n.convertSRGBToLinear().applyMatrix3(UV),fromReference:n=>n.applyMatrix3(NV).convertLinearToSRGB()}},zce=new Set([Io,IL]),Ko={enabled:!0,_workingColorSpace:Io,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(n){if(!zce.has(n))throw new Error(`Unsupported working color space, "${n}".`);this._workingColorSpace=n},convert:function(n,e,i){if(this.enabled===!1||e===i||!e||!i)return n;const s=ob[e].toReference,r=ob[i].fromReference;return r(s(n))},fromWorkingColorSpace:function(n,e){return this.convert(n,this._workingColorSpace,e)},toWorkingColorSpace:function(n,e){return this.convert(n,e,this._workingColorSpace)},getPrimaries:function(n){return ob[n].primaries},getTransfer:function(n){return n===RL?LL:ob[n].transfer},getLuminanceCoefficients:function(n,e=this._workingColorSpace){return n.fromArray(ob[e].luminanceCoefficients)}};function _g(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function GL(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}let Sg;class Fce{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let i;if(e instanceof HTMLCanvasElement)i=e;else{Sg===void 0&&(Sg=OL("canvas")),Sg.width=e.width,Sg.height=e.height;const s=Sg.getContext("2d");e instanceof ImageData?s.putImageData(e,0,0):s.drawImage(e,0,0,e.width,e.height),i=Sg}return i.width>2048||i.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),i.toDataURL("image/jpeg",.6)):i.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const i=OL("canvas");i.width=e.width,i.height=e.height;const s=i.getContext("2d");s.drawImage(e,0,0,e.width,e.height);const r=s.getImageData(0,0,e.width,e.height),o=r.data;for(let a=0;a<o.length;a++)o[a]=_g(o[a]/255)*255;return s.putImageData(r,0,0),i}else if(e.data){const i=e.data.slice(0);for(let s=0;s<i.length;s++)i instanceof Uint8Array||i instanceof Uint8ClampedArray?i[s]=Math.floor(_g(i[s]/255)*255):i[s]=_g(i[s]);return{data:i,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let Nce=0;class Uce{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Nce++}),this.uuid=wl(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const s={uuid:this.uuid,url:""},r=this.data;if(r!==null){let o;if(Array.isArray(r)){o=[];for(let a=0,l=r.length;a<l;a++)r[a].isDataTexture?o.push(zL(r[a].image)):o.push(zL(r[a]))}else o=zL(r);s.url=o}return i||(e.images[this.uuid]=s),s}}function zL(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?Fce.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Vce=0;class Zs extends N_{constructor(e=Zs.DEFAULT_IMAGE,i=Zs.DEFAULT_MAPPING,s=om,r=om,o=$v,a=z_,l=Hu,c=Oa,h=Zs.DEFAULT_ANISOTROPY,u=RL){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Vce++}),this.uuid=wl(),this.name="",this.source=new Uce(e),this.mipmaps=[],this.mapping=i,this.channel=0,this.wrapS=s,this.wrapT=r,this.magFilter=o,this.minFilter=a,this.anisotropy=h,this.format=l,this.internalFormat=null,this.type=c,this.offset=new Ln(0,0),this.repeat=new Ln(1,1),this.center=new Ln(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new yu,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const s={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(s.userData=this.userData),i||(e.textures[this.uuid]=s),s}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==MV)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Jv:e.x=e.x-Math.floor(e.x);break;case om:e.x=e.x<0?0:1;break;case ML:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Jv:e.y=e.y-Math.floor(e.y);break;case om:e.y=e.y<0?0:1;break;case ML:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}Zs.DEFAULT_IMAGE=null,Zs.DEFAULT_MAPPING=MV,Zs.DEFAULT_ANISOTROPY=1;class ll{constructor(e=0,i=0,s=0,r=1){ll.prototype.isVector4=!0,this.x=e,this.y=i,this.z=s,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,i,s,r){return this.x=e,this.y=i,this.z=s,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this.w=e.w+i.w,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this.w+=e.w*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this.w=e.w-i.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const i=this.x,s=this.y,r=this.z,o=this.w,a=e.elements;return this.x=a[0]*i+a[4]*s+a[8]*r+a[12]*o,this.y=a[1]*i+a[5]*s+a[9]*r+a[13]*o,this.z=a[2]*i+a[6]*s+a[10]*r+a[14]*o,this.w=a[3]*i+a[7]*s+a[11]*r+a[15]*o,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const i=Math.sqrt(1-e.w*e.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/i,this.y=e.y/i,this.z=e.z/i),this}setAxisAngleFromRotationMatrix(e){let i,s,r,o;const a=e.elements,l=a[0],c=a[4],h=a[8],u=a[1],d=a[5],m=a[9],f=a[2],g=a[6],y=a[10];if(Math.abs(c-u)<.01&&Math.abs(h-f)<.01&&Math.abs(m-g)<.01){if(Math.abs(c+u)<.1&&Math.abs(h+f)<.1&&Math.abs(m+g)<.1&&Math.abs(l+d+y-3)<.1)return this.set(1,0,0,0),this;i=Math.PI;const b=(l+1)/2,A=(d+1)/2,x=(y+1)/2,w=(c+u)/4,_=(h+f)/4,S=(m+g)/4;return b>A&&b>x?b<.01?(s=0,r=.707106781,o=.707106781):(s=Math.sqrt(b),r=w/s,o=_/s):A>x?A<.01?(s=.707106781,r=0,o=.707106781):(r=Math.sqrt(A),s=w/r,o=S/r):x<.01?(s=.707106781,r=.707106781,o=0):(o=Math.sqrt(x),s=_/o,r=S/o),this.set(s,r,o,i),this}let v=Math.sqrt((g-m)*(g-m)+(h-f)*(h-f)+(u-c)*(u-c));return Math.abs(v)<.001&&(v=1),this.x=(g-m)/v,this.y=(h-f)/v,this.z=(u-c)/v,this.w=Math.acos((l+d+y-1)/2),this}setFromMatrixPosition(e){const i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this.w=i[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this.w=Math.max(e.w,Math.min(i.w,this.w)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this.w=Math.max(e,Math.min(i,this.w)),this}clampLength(e,i){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(e,Math.min(i,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this.w+=(e.w-this.w)*i,this}lerpVectors(e,i,s){return this.x=e.x+(i.x-e.x)*s,this.y=e.y+(i.y-e.y)*s,this.z=e.z+(i.z-e.z)*s,this.w=e.w+(i.w-e.w)*s,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this.w=e[i+3],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e[i+3]=this.w,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this.w=e.getW(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Xce extends Zs{constructor(e=null,i=1,s=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:i,height:s,depth:r},this.magFilter=qv,this.minFilter=qv,this.wrapR=om,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class ju{constructor(e=0,i=0,s=0,r=1){this.isQuaternion=!0,this._x=e,this._y=i,this._z=s,this._w=r}static slerpFlat(e,i,s,r,o,a,l){let c=s[r+0],h=s[r+1],u=s[r+2],d=s[r+3];const m=o[a+0],f=o[a+1],g=o[a+2],y=o[a+3];if(l===0){e[i+0]=c,e[i+1]=h,e[i+2]=u,e[i+3]=d;return}if(l===1){e[i+0]=m,e[i+1]=f,e[i+2]=g,e[i+3]=y;return}if(d!==y||c!==m||h!==f||u!==g){let v=1-l;const b=c*m+h*f+u*g+d*y,A=b>=0?1:-1,x=1-b*b;if(x>Number.EPSILON){const _=Math.sqrt(x),S=Math.atan2(_,b*A);v=Math.sin(v*S)/_,l=Math.sin(l*S)/_}const w=l*A;if(c=c*v+m*w,h=h*v+f*w,u=u*v+g*w,d=d*v+y*w,v===1-l){const _=1/Math.sqrt(c*c+h*h+u*u+d*d);c*=_,h*=_,u*=_,d*=_}}e[i]=c,e[i+1]=h,e[i+2]=u,e[i+3]=d}static multiplyQuaternionsFlat(e,i,s,r,o,a){const l=s[r],c=s[r+1],h=s[r+2],u=s[r+3],d=o[a],m=o[a+1],f=o[a+2],g=o[a+3];return e[i]=l*g+u*d+c*f-h*m,e[i+1]=c*g+u*m+h*d-l*f,e[i+2]=h*g+u*f+l*m-c*d,e[i+3]=u*g-l*d-c*m-h*f,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,i,s,r){return this._x=e,this._y=i,this._z=s,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,i=!0){const s=e._x,r=e._y,o=e._z,a=e._order,l=Math.cos,c=Math.sin,h=l(s/2),u=l(r/2),d=l(o/2),m=c(s/2),f=c(r/2),g=c(o/2);switch(a){case"XYZ":this._x=m*u*d+h*f*g,this._y=h*f*d-m*u*g,this._z=h*u*g+m*f*d,this._w=h*u*d-m*f*g;break;case"YXZ":this._x=m*u*d+h*f*g,this._y=h*f*d-m*u*g,this._z=h*u*g-m*f*d,this._w=h*u*d+m*f*g;break;case"ZXY":this._x=m*u*d-h*f*g,this._y=h*f*d+m*u*g,this._z=h*u*g+m*f*d,this._w=h*u*d-m*f*g;break;case"ZYX":this._x=m*u*d-h*f*g,this._y=h*f*d+m*u*g,this._z=h*u*g-m*f*d,this._w=h*u*d+m*f*g;break;case"YZX":this._x=m*u*d+h*f*g,this._y=h*f*d+m*u*g,this._z=h*u*g-m*f*d,this._w=h*u*d-m*f*g;break;case"XZY":this._x=m*u*d-h*f*g,this._y=h*f*d-m*u*g,this._z=h*u*g+m*f*d,this._w=h*u*d+m*f*g;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return i===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,i){const s=i/2,r=Math.sin(s);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(s),this._onChangeCallback(),this}setFromRotationMatrix(e){const i=e.elements,s=i[0],r=i[4],o=i[8],a=i[1],l=i[5],c=i[9],h=i[2],u=i[6],d=i[10],m=s+l+d;if(m>0){const f=.5/Math.sqrt(m+1);this._w=.25/f,this._x=(u-c)*f,this._y=(o-h)*f,this._z=(a-r)*f}else if(s>l&&s>d){const f=2*Math.sqrt(1+s-l-d);this._w=(u-c)/f,this._x=.25*f,this._y=(r+a)/f,this._z=(o+h)/f}else if(l>d){const f=2*Math.sqrt(1+l-s-d);this._w=(o-h)/f,this._x=(r+a)/f,this._y=.25*f,this._z=(c+u)/f}else{const f=2*Math.sqrt(1+d-s-l);this._w=(a-r)/f,this._x=(o+h)/f,this._y=(c+u)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(e,i){let s=e.dot(i)+1;return s<Number.EPSILON?(s=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=s):(this._x=0,this._y=-e.z,this._z=e.y,this._w=s)):(this._x=e.y*i.z-e.z*i.y,this._y=e.z*i.x-e.x*i.z,this._z=e.x*i.y-e.y*i.x,this._w=s),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Br(this.dot(e),-1,1)))}rotateTowards(e,i){const s=this.angleTo(e);if(s===0)return this;const r=Math.min(1,i/s);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,i){const s=e._x,r=e._y,o=e._z,a=e._w,l=i._x,c=i._y,h=i._z,u=i._w;return this._x=s*u+a*l+r*h-o*c,this._y=r*u+a*c+o*l-s*h,this._z=o*u+a*h+s*c-r*l,this._w=a*u-s*l-r*c-o*h,this._onChangeCallback(),this}slerp(e,i){if(i===0)return this;if(i===1)return this.copy(e);const s=this._x,r=this._y,o=this._z,a=this._w;let l=a*e._w+s*e._x+r*e._y+o*e._z;if(l<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,l=-l):this.copy(e),l>=1)return this._w=a,this._x=s,this._y=r,this._z=o,this;const c=1-l*l;if(c<=Number.EPSILON){const f=1-i;return this._w=f*a+i*this._w,this._x=f*s+i*this._x,this._y=f*r+i*this._y,this._z=f*o+i*this._z,this.normalize(),this}const h=Math.sqrt(c),u=Math.atan2(h,l),d=Math.sin((1-i)*u)/h,m=Math.sin(i*u)/h;return this._w=a*d+this._w*m,this._x=s*d+this._x*m,this._y=r*d+this._y*m,this._z=o*d+this._z*m,this._onChangeCallback(),this}slerpQuaternions(e,i,s){return this.copy(e).slerp(i,s)}random(){const e=2*Math.PI*Math.random(),i=2*Math.PI*Math.random(),s=Math.random(),r=Math.sqrt(1-s),o=Math.sqrt(s);return this.set(r*Math.sin(e),r*Math.cos(e),o*Math.sin(i),o*Math.cos(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,i=0){return this._x=e[i],this._y=e[i+1],this._z=e[i+2],this._w=e[i+3],this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._w,e}fromBufferAttribute(e,i){return this._x=e.getX(i),this._y=e.getY(i),this._z=e.getZ(i),this._w=e.getW(i),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class me{constructor(e=0,i=0,s=0){me.prototype.isVector3=!0,this.x=e,this.y=i,this.z=s}set(e,i,s){return s===void 0&&(s=this.z),this.x=e,this.y=i,this.z=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,i){return this.x=e.x*i.x,this.y=e.y*i.y,this.z=e.z*i.z,this}applyEuler(e){return this.applyQuaternion(VV.setFromEuler(e))}applyAxisAngle(e,i){return this.applyQuaternion(VV.setFromAxisAngle(e,i))}applyMatrix3(e){const i=this.x,s=this.y,r=this.z,o=e.elements;return this.x=o[0]*i+o[3]*s+o[6]*r,this.y=o[1]*i+o[4]*s+o[7]*r,this.z=o[2]*i+o[5]*s+o[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const i=this.x,s=this.y,r=this.z,o=e.elements,a=1/(o[3]*i+o[7]*s+o[11]*r+o[15]);return this.x=(o[0]*i+o[4]*s+o[8]*r+o[12])*a,this.y=(o[1]*i+o[5]*s+o[9]*r+o[13])*a,this.z=(o[2]*i+o[6]*s+o[10]*r+o[14])*a,this}applyQuaternion(e){const i=this.x,s=this.y,r=this.z,o=e.x,a=e.y,l=e.z,c=e.w,h=2*(a*r-l*s),u=2*(l*i-o*r),d=2*(o*s-a*i);return this.x=i+c*h+a*d-l*u,this.y=s+c*u+l*h-o*d,this.z=r+c*d+o*u-a*h,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const i=this.x,s=this.y,r=this.z,o=e.elements;return this.x=o[0]*i+o[4]*s+o[8]*r,this.y=o[1]*i+o[5]*s+o[9]*r,this.z=o[2]*i+o[6]*s+o[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this}clampLength(e,i){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(e,Math.min(i,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this}lerpVectors(e,i,s){return this.x=e.x+(i.x-e.x)*s,this.y=e.y+(i.y-e.y)*s,this.z=e.z+(i.z-e.z)*s,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,i){const s=e.x,r=e.y,o=e.z,a=i.x,l=i.y,c=i.z;return this.x=r*c-o*l,this.y=o*a-s*c,this.z=s*l-r*a,this}projectOnVector(e){const i=e.lengthSq();if(i===0)return this.set(0,0,0);const s=e.dot(this)/i;return this.copy(e).multiplyScalar(s)}projectOnPlane(e){return FL.copy(this).projectOnVector(e),this.sub(FL)}reflect(e){return this.sub(FL.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const s=this.dot(e)/i;return Math.acos(Br(s,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,s=this.y-e.y,r=this.z-e.z;return i*i+s*s+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,i,s){const r=Math.sin(i)*e;return this.x=r*Math.sin(s),this.y=Math.cos(i)*e,this.z=r*Math.cos(s),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,i,s){return this.x=e*Math.sin(i),this.y=s,this.z=e*Math.cos(i),this}setFromMatrixPosition(e){const i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(e){const i=this.setFromMatrixColumn(e,0).length(),s=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=i,this.y=s,this.z=r,this}setFromMatrixColumn(e,i){return this.fromArray(e.elements,i*4)}setFromMatrix3Column(e,i){return this.fromArray(e.elements,i*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,i=Math.random()*2-1,s=Math.sqrt(1-i*i);return this.x=s*Math.cos(e),this.y=i,this.z=s*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const FL=new me,VV=new ju;class Sl{constructor(e=new me(1/0,1/0,1/0),i=new me(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=i}set(e,i){return this.min.copy(e),this.max.copy(i),this}setFromArray(e){this.makeEmpty();for(let i=0,s=e.length;i<s;i+=3)this.expandByPoint(Cl.fromArray(e,i));return this}setFromBufferAttribute(e){this.makeEmpty();for(let i=0,s=e.count;i<s;i++)this.expandByPoint(Cl.fromBufferAttribute(e,i));return this}setFromPoints(e){this.makeEmpty();for(let i=0,s=e.length;i<s;i++)this.expandByPoint(e[i]);return this}setFromCenterAndSize(e,i){const s=Cl.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(s),this.max.copy(e).add(s),this}setFromObject(e,i=!1){return this.makeEmpty(),this.expandByObject(e,i)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,i=!1){e.updateWorldMatrix(!1,!1);const s=e.geometry;if(s!==void 0){const o=s.getAttribute("position");if(i===!0&&o!==void 0&&e.isInstancedMesh!==!0)for(let a=0,l=o.count;a<l;a++)e.isMesh===!0?e.getVertexPosition(a,Cl):Cl.fromBufferAttribute(o,a),Cl.applyMatrix4(e.matrixWorld),this.expandByPoint(Cl);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),U_.copy(e.boundingBox)):(s.boundingBox===null&&s.computeBoundingBox(),U_.copy(s.boundingBox)),U_.applyMatrix4(e.matrixWorld),this.union(U_)}const r=e.children;for(let o=0,a=r.length;o<a;o++)this.expandByObject(r[o],i);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,i){return i.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Cl),Cl.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let i,s;return e.normal.x>0?(i=e.normal.x*this.min.x,s=e.normal.x*this.max.x):(i=e.normal.x*this.max.x,s=e.normal.x*this.min.x),e.normal.y>0?(i+=e.normal.y*this.min.y,s+=e.normal.y*this.max.y):(i+=e.normal.y*this.max.y,s+=e.normal.y*this.min.y),e.normal.z>0?(i+=e.normal.z*this.min.z,s+=e.normal.z*this.max.z):(i+=e.normal.z*this.max.z,s+=e.normal.z*this.min.z),i<=-e.constant&&s>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(ab),V_.subVectors(this.max,ab),Cg.subVectors(e.a,ab),Mg.subVectors(e.b,ab),Eg.subVectors(e.c,ab),Qu.subVectors(Mg,Cg),Zu.subVectors(Eg,Mg),cm.subVectors(Cg,Eg);let i=[0,-Qu.z,Qu.y,0,-Zu.z,Zu.y,0,-cm.z,cm.y,Qu.z,0,-Qu.x,Zu.z,0,-Zu.x,cm.z,0,-cm.x,-Qu.y,Qu.x,0,-Zu.y,Zu.x,0,-cm.y,cm.x,0];return!NL(i,Cg,Mg,Eg,V_)||(i=[1,0,0,0,1,0,0,0,1],!NL(i,Cg,Mg,Eg,V_))?!1:(X_.crossVectors(Qu,Zu),i=[X_.x,X_.y,X_.z],NL(i,Cg,Mg,Eg,V_))}clampPoint(e,i){return i.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Cl).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Cl).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Sh[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Sh[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Sh[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Sh[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Sh[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Sh[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Sh[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Sh[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Sh),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Sh=[new me,new me,new me,new me,new me,new me,new me,new me],Cl=new me,U_=new Sl,Cg=new me,Mg=new me,Eg=new me,Qu=new me,Zu=new me,cm=new me,ab=new me,V_=new me,X_=new me,hm=new me;function NL(n,e,i,s,r){for(let o=0,a=n.length-3;o<=a;o+=3){hm.fromArray(n,o);const l=r.x*Math.abs(hm.x)+r.y*Math.abs(hm.y)+r.z*Math.abs(hm.z),c=e.dot(hm),h=i.dot(hm),u=s.dot(hm);if(Math.max(-Math.max(c,h,u),Math.min(c,h,u))>l)return!1}return!0}const Wce=new Sl,lb=new me,UL=new me;class Ml{constructor(e=new me,i=-1){this.isSphere=!0,this.center=e,this.radius=i}set(e,i){return this.center.copy(e),this.radius=i,this}setFromPoints(e,i){const s=this.center;i!==void 0?s.copy(i):Wce.setFromPoints(e).getCenter(s);let r=0;for(let o=0,a=e.length;o<a;o++)r=Math.max(r,s.distanceToSquared(e[o]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const i=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=i*i}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,i){const s=this.center.distanceToSquared(e);return i.copy(e),s>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;lb.subVectors(e,this.center);const i=lb.lengthSq();if(i>this.radius*this.radius){const s=Math.sqrt(i),r=(s-this.radius)*.5;this.center.addScaledVector(lb,r/s),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(UL.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(lb.copy(e.center).add(UL)),this.expandByPoint(lb.copy(e.center).sub(UL))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Ch=new me,VL=new me,W_=new me,Yu=new me,XL=new me,H_=new me,WL=new me;class j_{constructor(e=new me,i=new me(0,0,-1)){this.origin=e,this.direction=i}set(e,i){return this.origin.copy(e),this.direction.copy(i),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,i){return i.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Ch)),this}closestPointToPoint(e,i){i.subVectors(e,this.origin);const s=i.dot(this.direction);return s<0?i.copy(this.origin):i.copy(this.origin).addScaledVector(this.direction,s)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const i=Ch.subVectors(e,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(e):(Ch.copy(this.origin).addScaledVector(this.direction,i),Ch.distanceToSquared(e))}distanceSqToSegment(e,i,s,r){VL.copy(e).add(i).multiplyScalar(.5),W_.copy(i).sub(e).normalize(),Yu.copy(this.origin).sub(VL);const o=e.distanceTo(i)*.5,a=-this.direction.dot(W_),l=Yu.dot(this.direction),c=-Yu.dot(W_),h=Yu.lengthSq(),u=Math.abs(1-a*a);let d,m,f,g;if(u>0)if(d=a*c-l,m=a*l-c,g=o*u,d>=0)if(m>=-g)if(m<=g){const y=1/u;d*=y,m*=y,f=d*(d+a*m+2*l)+m*(a*d+m+2*c)+h}else m=o,d=Math.max(0,-(a*m+l)),f=-d*d+m*(m+2*c)+h;else m=-o,d=Math.max(0,-(a*m+l)),f=-d*d+m*(m+2*c)+h;else m<=-g?(d=Math.max(0,-(-a*o+l)),m=d>0?-o:Math.min(Math.max(-o,-c),o),f=-d*d+m*(m+2*c)+h):m<=g?(d=0,m=Math.min(Math.max(-o,-c),o),f=m*(m+2*c)+h):(d=Math.max(0,-(a*o+l)),m=d>0?o:Math.min(Math.max(-o,-c),o),f=-d*d+m*(m+2*c)+h);else m=a>0?-o:o,d=Math.max(0,-(a*m+l)),f=-d*d+m*(m+2*c)+h;return s&&s.copy(this.origin).addScaledVector(this.direction,d),r&&r.copy(VL).addScaledVector(W_,m),f}intersectSphere(e,i){Ch.subVectors(e.center,this.origin);const s=Ch.dot(this.direction),r=Ch.dot(Ch)-s*s,o=e.radius*e.radius;if(r>o)return null;const a=Math.sqrt(o-r),l=s-a,c=s+a;return c<0?null:l<0?this.at(c,i):this.at(l,i)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const i=e.normal.dot(this.direction);if(i===0)return e.distanceToPoint(this.origin)===0?0:null;const s=-(this.origin.dot(e.normal)+e.constant)/i;return s>=0?s:null}intersectPlane(e,i){const s=this.distanceToPlane(e);return s===null?null:this.at(s,i)}intersectsPlane(e){const i=e.distanceToPoint(this.origin);return i===0||e.normal.dot(this.direction)*i<0}intersectBox(e,i){let s,r,o,a,l,c;const h=1/this.direction.x,u=1/this.direction.y,d=1/this.direction.z,m=this.origin;return h>=0?(s=(e.min.x-m.x)*h,r=(e.max.x-m.x)*h):(s=(e.max.x-m.x)*h,r=(e.min.x-m.x)*h),u>=0?(o=(e.min.y-m.y)*u,a=(e.max.y-m.y)*u):(o=(e.max.y-m.y)*u,a=(e.min.y-m.y)*u),s>a||o>r||((o>s||isNaN(s))&&(s=o),(a<r||isNaN(r))&&(r=a),d>=0?(l=(e.min.z-m.z)*d,c=(e.max.z-m.z)*d):(l=(e.max.z-m.z)*d,c=(e.min.z-m.z)*d),s>c||l>r)||((l>s||s!==s)&&(s=l),(c<r||r!==r)&&(r=c),r<0)?null:this.at(s>=0?s:r,i)}intersectsBox(e){return this.intersectBox(e,Ch)!==null}intersectTriangle(e,i,s,r,o){XL.subVectors(i,e),H_.subVectors(s,e),WL.crossVectors(XL,H_);let a=this.direction.dot(WL),l;if(a>0){if(r)return null;l=1}else if(a<0)l=-1,a=-a;else return null;Yu.subVectors(this.origin,e);const c=l*this.direction.dot(H_.crossVectors(Yu,H_));if(c<0)return null;const h=l*this.direction.dot(XL.cross(Yu));if(h<0||c+h>a)return null;const u=-l*Yu.dot(WL);return u<0?null:this.at(u/a,o)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class ui{constructor(e,i,s,r,o,a,l,c,h,u,d,m,f,g,y,v){ui.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,i,s,r,o,a,l,c,h,u,d,m,f,g,y,v)}set(e,i,s,r,o,a,l,c,h,u,d,m,f,g,y,v){const b=this.elements;return b[0]=e,b[4]=i,b[8]=s,b[12]=r,b[1]=o,b[5]=a,b[9]=l,b[13]=c,b[2]=h,b[6]=u,b[10]=d,b[14]=m,b[3]=f,b[7]=g,b[11]=y,b[15]=v,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new ui().fromArray(this.elements)}copy(e){const i=this.elements,s=e.elements;return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=s[7],i[8]=s[8],i[9]=s[9],i[10]=s[10],i[11]=s[11],i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15],this}copyPosition(e){const i=this.elements,s=e.elements;return i[12]=s[12],i[13]=s[13],i[14]=s[14],this}setFromMatrix3(e){const i=e.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(e,i,s){return e.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),s.setFromMatrixColumn(this,2),this}makeBasis(e,i,s){return this.set(e.x,i.x,s.x,0,e.y,i.y,s.y,0,e.z,i.z,s.z,0,0,0,0,1),this}extractRotation(e){const i=this.elements,s=e.elements,r=1/Tg.setFromMatrixColumn(e,0).length(),o=1/Tg.setFromMatrixColumn(e,1).length(),a=1/Tg.setFromMatrixColumn(e,2).length();return i[0]=s[0]*r,i[1]=s[1]*r,i[2]=s[2]*r,i[3]=0,i[4]=s[4]*o,i[5]=s[5]*o,i[6]=s[6]*o,i[7]=0,i[8]=s[8]*a,i[9]=s[9]*a,i[10]=s[10]*a,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(e){const i=this.elements,s=e.x,r=e.y,o=e.z,a=Math.cos(s),l=Math.sin(s),c=Math.cos(r),h=Math.sin(r),u=Math.cos(o),d=Math.sin(o);if(e.order==="XYZ"){const m=a*u,f=a*d,g=l*u,y=l*d;i[0]=c*u,i[4]=-c*d,i[8]=h,i[1]=f+g*h,i[5]=m-y*h,i[9]=-l*c,i[2]=y-m*h,i[6]=g+f*h,i[10]=a*c}else if(e.order==="YXZ"){const m=c*u,f=c*d,g=h*u,y=h*d;i[0]=m+y*l,i[4]=g*l-f,i[8]=a*h,i[1]=a*d,i[5]=a*u,i[9]=-l,i[2]=f*l-g,i[6]=y+m*l,i[10]=a*c}else if(e.order==="ZXY"){const m=c*u,f=c*d,g=h*u,y=h*d;i[0]=m-y*l,i[4]=-a*d,i[8]=g+f*l,i[1]=f+g*l,i[5]=a*u,i[9]=y-m*l,i[2]=-a*h,i[6]=l,i[10]=a*c}else if(e.order==="ZYX"){const m=a*u,f=a*d,g=l*u,y=l*d;i[0]=c*u,i[4]=g*h-f,i[8]=m*h+y,i[1]=c*d,i[5]=y*h+m,i[9]=f*h-g,i[2]=-h,i[6]=l*c,i[10]=a*c}else if(e.order==="YZX"){const m=a*c,f=a*h,g=l*c,y=l*h;i[0]=c*u,i[4]=y-m*d,i[8]=g*d+f,i[1]=d,i[5]=a*u,i[9]=-l*u,i[2]=-h*u,i[6]=f*d+g,i[10]=m-y*d}else if(e.order==="XZY"){const m=a*c,f=a*h,g=l*c,y=l*h;i[0]=c*u,i[4]=-d,i[8]=h*u,i[1]=m*d+y,i[5]=a*u,i[9]=f*d-g,i[2]=g*d-f,i[6]=l*u,i[10]=y*d+m}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Hce,e,jce)}lookAt(e,i,s){const r=this.elements;return Jo.subVectors(e,i),Jo.lengthSq()===0&&(Jo.z=1),Jo.normalize(),Ku.crossVectors(s,Jo),Ku.lengthSq()===0&&(Math.abs(s.z)===1?Jo.x+=1e-4:Jo.z+=1e-4,Jo.normalize(),Ku.crossVectors(s,Jo)),Ku.normalize(),Q_.crossVectors(Jo,Ku),r[0]=Ku.x,r[4]=Q_.x,r[8]=Jo.x,r[1]=Ku.y,r[5]=Q_.y,r[9]=Jo.y,r[2]=Ku.z,r[6]=Q_.z,r[10]=Jo.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const s=e.elements,r=i.elements,o=this.elements,a=s[0],l=s[4],c=s[8],h=s[12],u=s[1],d=s[5],m=s[9],f=s[13],g=s[2],y=s[6],v=s[10],b=s[14],A=s[3],x=s[7],w=s[11],_=s[15],S=r[0],M=r[4],R=r[8],P=r[12],C=r[1],L=r[5],B=r[9],z=r[13],D=r[2],W=r[6],O=r[10],F=r[14],X=r[3],J=r[7],q=r[11],oe=r[15];return o[0]=a*S+l*C+c*D+h*X,o[4]=a*M+l*L+c*W+h*J,o[8]=a*R+l*B+c*O+h*q,o[12]=a*P+l*z+c*F+h*oe,o[1]=u*S+d*C+m*D+f*X,o[5]=u*M+d*L+m*W+f*J,o[9]=u*R+d*B+m*O+f*q,o[13]=u*P+d*z+m*F+f*oe,o[2]=g*S+y*C+v*D+b*X,o[6]=g*M+y*L+v*W+b*J,o[10]=g*R+y*B+v*O+b*q,o[14]=g*P+y*z+v*F+b*oe,o[3]=A*S+x*C+w*D+_*X,o[7]=A*M+x*L+w*W+_*J,o[11]=A*R+x*B+w*O+_*q,o[15]=A*P+x*z+w*F+_*oe,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[4]*=e,i[8]*=e,i[12]*=e,i[1]*=e,i[5]*=e,i[9]*=e,i[13]*=e,i[2]*=e,i[6]*=e,i[10]*=e,i[14]*=e,i[3]*=e,i[7]*=e,i[11]*=e,i[15]*=e,this}determinant(){const e=this.elements,i=e[0],s=e[4],r=e[8],o=e[12],a=e[1],l=e[5],c=e[9],h=e[13],u=e[2],d=e[6],m=e[10],f=e[14],g=e[3],y=e[7],v=e[11],b=e[15];return g*(+o*c*d-r*h*d-o*l*m+s*h*m+r*l*f-s*c*f)+y*(+i*c*f-i*h*m+o*a*m-r*a*f+r*h*u-o*c*u)+v*(+i*h*d-i*l*f-o*a*d+s*a*f+o*l*u-s*h*u)+b*(-r*l*u-i*c*d+i*l*m+r*a*d-s*a*m+s*c*u)}transpose(){const e=this.elements;let i;return i=e[1],e[1]=e[4],e[4]=i,i=e[2],e[2]=e[8],e[8]=i,i=e[6],e[6]=e[9],e[9]=i,i=e[3],e[3]=e[12],e[12]=i,i=e[7],e[7]=e[13],e[13]=i,i=e[11],e[11]=e[14],e[14]=i,this}setPosition(e,i,s){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=i,r[14]=s),this}invert(){const e=this.elements,i=e[0],s=e[1],r=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],u=e[8],d=e[9],m=e[10],f=e[11],g=e[12],y=e[13],v=e[14],b=e[15],A=d*v*h-y*m*h+y*c*f-l*v*f-d*c*b+l*m*b,x=g*m*h-u*v*h-g*c*f+a*v*f+u*c*b-a*m*b,w=u*y*h-g*d*h+g*l*f-a*y*f-u*l*b+a*d*b,_=g*d*c-u*y*c-g*l*m+a*y*m+u*l*v-a*d*v,S=i*A+s*x+r*w+o*_;if(S===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const M=1/S;return e[0]=A*M,e[1]=(y*m*o-d*v*o-y*r*f+s*v*f+d*r*b-s*m*b)*M,e[2]=(l*v*o-y*c*o+y*r*h-s*v*h-l*r*b+s*c*b)*M,e[3]=(d*c*o-l*m*o-d*r*h+s*m*h+l*r*f-s*c*f)*M,e[4]=x*M,e[5]=(u*v*o-g*m*o+g*r*f-i*v*f-u*r*b+i*m*b)*M,e[6]=(g*c*o-a*v*o-g*r*h+i*v*h+a*r*b-i*c*b)*M,e[7]=(a*m*o-u*c*o+u*r*h-i*m*h-a*r*f+i*c*f)*M,e[8]=w*M,e[9]=(g*d*o-u*y*o-g*s*f+i*y*f+u*s*b-i*d*b)*M,e[10]=(a*y*o-g*l*o+g*s*h-i*y*h-a*s*b+i*l*b)*M,e[11]=(u*l*o-a*d*o-u*s*h+i*d*h+a*s*f-i*l*f)*M,e[12]=_*M,e[13]=(u*y*r-g*d*r+g*s*m-i*y*m-u*s*v+i*d*v)*M,e[14]=(g*l*r-a*y*r-g*s*c+i*y*c+a*s*v-i*l*v)*M,e[15]=(a*d*r-u*l*r+u*s*c-i*d*c-a*s*m+i*l*m)*M,this}scale(e){const i=this.elements,s=e.x,r=e.y,o=e.z;return i[0]*=s,i[4]*=r,i[8]*=o,i[1]*=s,i[5]*=r,i[9]*=o,i[2]*=s,i[6]*=r,i[10]*=o,i[3]*=s,i[7]*=r,i[11]*=o,this}getMaxScaleOnAxis(){const e=this.elements,i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],s=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(i,s,r))}makeTranslation(e,i,s){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,i,0,0,1,s,0,0,0,1),this}makeRotationX(e){const i=Math.cos(e),s=Math.sin(e);return this.set(1,0,0,0,0,i,-s,0,0,s,i,0,0,0,0,1),this}makeRotationY(e){const i=Math.cos(e),s=Math.sin(e);return this.set(i,0,s,0,0,1,0,0,-s,0,i,0,0,0,0,1),this}makeRotationZ(e){const i=Math.cos(e),s=Math.sin(e);return this.set(i,-s,0,0,s,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,i){const s=Math.cos(i),r=Math.sin(i),o=1-s,a=e.x,l=e.y,c=e.z,h=o*a,u=o*l;return this.set(h*a+s,h*l-r*c,h*c+r*l,0,h*l+r*c,u*l+s,u*c-r*a,0,h*c-r*l,u*c+r*a,o*c*c+s,0,0,0,0,1),this}makeScale(e,i,s){return this.set(e,0,0,0,0,i,0,0,0,0,s,0,0,0,0,1),this}makeShear(e,i,s,r,o,a){return this.set(1,s,o,0,e,1,a,0,i,r,1,0,0,0,0,1),this}compose(e,i,s){const r=this.elements,o=i._x,a=i._y,l=i._z,c=i._w,h=o+o,u=a+a,d=l+l,m=o*h,f=o*u,g=o*d,y=a*u,v=a*d,b=l*d,A=c*h,x=c*u,w=c*d,_=s.x,S=s.y,M=s.z;return r[0]=(1-(y+b))*_,r[1]=(f+w)*_,r[2]=(g-x)*_,r[3]=0,r[4]=(f-w)*S,r[5]=(1-(m+b))*S,r[6]=(v+A)*S,r[7]=0,r[8]=(g+x)*M,r[9]=(v-A)*M,r[10]=(1-(m+y))*M,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,i,s){const r=this.elements;let o=Tg.set(r[0],r[1],r[2]).length();const a=Tg.set(r[4],r[5],r[6]).length(),l=Tg.set(r[8],r[9],r[10]).length();this.determinant()<0&&(o=-o),e.x=r[12],e.y=r[13],e.z=r[14],El.copy(this);const c=1/o,h=1/a,u=1/l;return El.elements[0]*=c,El.elements[1]*=c,El.elements[2]*=c,El.elements[4]*=h,El.elements[5]*=h,El.elements[6]*=h,El.elements[8]*=u,El.elements[9]*=u,El.elements[10]*=u,i.setFromRotationMatrix(El),s.x=o,s.y=a,s.z=l,this}makePerspective(e,i,s,r,o,a,l=lm){const c=this.elements,h=2*o/(i-e),u=2*o/(s-r),d=(i+e)/(i-e),m=(s+r)/(s-r);let f,g;if(l===lm)f=-(a+o)/(a-o),g=-2*a*o/(a-o);else if(l===BL)f=-a/(a-o),g=-a*o/(a-o);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+l);return c[0]=h,c[4]=0,c[8]=d,c[12]=0,c[1]=0,c[5]=u,c[9]=m,c[13]=0,c[2]=0,c[6]=0,c[10]=f,c[14]=g,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,i,s,r,o,a,l=lm){const c=this.elements,h=1/(i-e),u=1/(s-r),d=1/(a-o),m=(i+e)*h,f=(s+r)*u;let g,y;if(l===lm)g=(a+o)*d,y=-2*d;else if(l===BL)g=o*d,y=-1*d;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+l);return c[0]=2*h,c[4]=0,c[8]=0,c[12]=-m,c[1]=0,c[5]=2*u,c[9]=0,c[13]=-f,c[2]=0,c[6]=0,c[10]=y,c[14]=-g,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const i=this.elements,s=e.elements;for(let r=0;r<16;r++)if(i[r]!==s[r])return!1;return!0}fromArray(e,i=0){for(let s=0;s<16;s++)this.elements[s]=e[s+i];return this}toArray(e=[],i=0){const s=this.elements;return e[i]=s[0],e[i+1]=s[1],e[i+2]=s[2],e[i+3]=s[3],e[i+4]=s[4],e[i+5]=s[5],e[i+6]=s[6],e[i+7]=s[7],e[i+8]=s[8],e[i+9]=s[9],e[i+10]=s[10],e[i+11]=s[11],e[i+12]=s[12],e[i+13]=s[13],e[i+14]=s[14],e[i+15]=s[15],e}}const Tg=new me,El=new ui,Hce=new me(0,0,0),jce=new me(1,1,1),Ku=new me,Q_=new me,Jo=new me,XV=new ui,WV=new ju;class Ny{constructor(e=0,i=0,s=0,r=Ny.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=i,this._z=s,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,i,s,r=this._order){return this._x=e,this._y=i,this._z=s,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,i=this._order,s=!0){const r=e.elements,o=r[0],a=r[4],l=r[8],c=r[1],h=r[5],u=r[9],d=r[2],m=r[6],f=r[10];switch(i){case"XYZ":this._y=Math.asin(Br(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,f),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(m,h),this._z=0);break;case"YXZ":this._x=Math.asin(-Br(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(l,f),this._z=Math.atan2(c,h)):(this._y=Math.atan2(-d,o),this._z=0);break;case"ZXY":this._x=Math.asin(Br(m,-1,1)),Math.abs(m)<.9999999?(this._y=Math.atan2(-d,f),this._z=Math.atan2(-a,h)):(this._y=0,this._z=Math.atan2(c,o));break;case"ZYX":this._y=Math.asin(-Br(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(m,f),this._z=Math.atan2(c,o)):(this._x=0,this._z=Math.atan2(-a,h));break;case"YZX":this._z=Math.asin(Br(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-u,h),this._y=Math.atan2(-d,o)):(this._x=0,this._y=Math.atan2(l,f));break;case"XZY":this._z=Math.asin(-Br(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(m,h),this._y=Math.atan2(l,o)):(this._x=Math.atan2(-u,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,s===!0&&this._onChangeCallback(),this}setFromQuaternion(e,i,s){return XV.makeRotationFromQuaternion(e),this.setFromRotationMatrix(XV,i,s)}setFromVector3(e,i=this._order){return this.set(e.x,e.y,e.z,i)}reorder(e){return WV.setFromEuler(this),this.setFromQuaternion(WV,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Ny.DEFAULT_ORDER="XYZ";class Qce{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let Zce=0;const HV=new me,Rg=new ju,Mh=new ui,Z_=new me,cb=new me,Yce=new me,Kce=new ju,jV=new me(1,0,0),QV=new me(0,1,0),ZV=new me(0,0,1),YV={type:"added"},Jce={type:"removed"},Ig={type:"childadded",child:null},HL={type:"childremoved",child:null};class Kn extends N_{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Zce++}),this.uuid=wl(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Kn.DEFAULT_UP.clone();const e=new me,i=new Ny,s=new ju,r=new me(1,1,1);function o(){s.setFromEuler(i,!1)}function a(){i.setFromQuaternion(s,void 0,!1)}i._onChange(o),s._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:s},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new ui},normalMatrix:{value:new yu}}),this.matrix=new ui,this.matrixWorld=new ui,this.matrixAutoUpdate=Kn.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Kn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Qce,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,i){this.quaternion.setFromAxisAngle(e,i)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,i){return Rg.setFromAxisAngle(e,i),this.quaternion.multiply(Rg),this}rotateOnWorldAxis(e,i){return Rg.setFromAxisAngle(e,i),this.quaternion.premultiply(Rg),this}rotateX(e){return this.rotateOnAxis(jV,e)}rotateY(e){return this.rotateOnAxis(QV,e)}rotateZ(e){return this.rotateOnAxis(ZV,e)}translateOnAxis(e,i){return HV.copy(e).applyQuaternion(this.quaternion),this.position.add(HV.multiplyScalar(i)),this}translateX(e){return this.translateOnAxis(jV,e)}translateY(e){return this.translateOnAxis(QV,e)}translateZ(e){return this.translateOnAxis(ZV,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Mh.copy(this.matrixWorld).invert())}lookAt(e,i,s){e.isVector3?Z_.copy(e):Z_.set(e,i,s);const r=this.parent;this.updateWorldMatrix(!0,!1),cb.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Mh.lookAt(cb,Z_,this.up):Mh.lookAt(Z_,cb,this.up),this.quaternion.setFromRotationMatrix(Mh),r&&(Mh.extractRotation(r.matrixWorld),Rg.setFromRotationMatrix(Mh),this.quaternion.premultiply(Rg.invert()))}add(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(YV),Ig.child=e,this.dispatchEvent(Ig),Ig.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let s=0;s<arguments.length;s++)this.remove(arguments[s]);return this}const i=this.children.indexOf(e);return i!==-1&&(e.parent=null,this.children.splice(i,1),e.dispatchEvent(Jce),HL.child=e,this.dispatchEvent(HL),HL.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Mh.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Mh.multiply(e.parent.matrixWorld)),e.applyMatrix4(Mh),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(YV),Ig.child=e,this.dispatchEvent(Ig),Ig.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,i){if(this[e]===i)return this;for(let s=0,r=this.children.length;s<r;s++){const o=this.children[s].getObjectByProperty(e,i);if(o!==void 0)return o}}getObjectsByProperty(e,i,s=[]){this[e]===i&&s.push(this);const r=this.children;for(let o=0,a=r.length;o<a;o++)r[o].getObjectsByProperty(e,i,s);return s}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(cb,e,Yce),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(cb,Kce,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return e.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(e){e(this);const i=this.children;for(let s=0,r=i.length;s<r;s++)i[s].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const i=this.children;for(let s=0,r=i.length;s<r;s++)i[s].traverseVisible(e)}traverseAncestors(e){const i=this.parent;i!==null&&(e(i),i.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const i=this.children;for(let s=0,r=i.length;s<r;s++)i[s].updateMatrixWorld(e)}updateWorldMatrix(e,i){const s=this.parent;if(e===!0&&s!==null&&s.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),i===!0){const r=this.children;for(let o=0,a=r.length;o<a;o++)r[o].updateWorldMatrix(!1,!0)}}toJSON(e){const i=e===void 0||typeof e=="string",s={};i&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},s.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.visibility=this._visibility,r.active=this._active,r.bounds=this._bounds.map(l=>({boxInitialized:l.boxInitialized,boxMin:l.box.min.toArray(),boxMax:l.box.max.toArray(),sphereInitialized:l.sphereInitialized,sphereRadius:l.sphere.radius,sphereCenter:l.sphere.center.toArray()})),r.maxInstanceCount=this._maxInstanceCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.geometryCount=this._geometryCount,r.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(r.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(r.boundingSphere={center:r.boundingSphere.center.toArray(),radius:r.boundingSphere.radius}),this.boundingBox!==null&&(r.boundingBox={min:r.boundingBox.min.toArray(),max:r.boundingBox.max.toArray()}));function o(l,c){return l[c.uuid]===void 0&&(l[c.uuid]=c.toJSON(e)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=o(e.geometries,this.geometry);const l=this.geometry.parameters;if(l!==void 0&&l.shapes!==void 0){const c=l.shapes;if(Array.isArray(c))for(let h=0,u=c.length;h<u;h++){const d=c[h];o(e.shapes,d)}else o(e.shapes,c)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(o(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const l=[];for(let c=0,h=this.material.length;c<h;c++)l.push(o(e.materials,this.material[c]));r.material=l}else r.material=o(e.materials,this.material);if(this.children.length>0){r.children=[];for(let l=0;l<this.children.length;l++)r.children.push(this.children[l].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let l=0;l<this.animations.length;l++){const c=this.animations[l];r.animations.push(o(e.animations,c))}}if(i){const l=a(e.geometries),c=a(e.materials),h=a(e.textures),u=a(e.images),d=a(e.shapes),m=a(e.skeletons),f=a(e.animations),g=a(e.nodes);l.length>0&&(s.geometries=l),c.length>0&&(s.materials=c),h.length>0&&(s.textures=h),u.length>0&&(s.images=u),d.length>0&&(s.shapes=d),m.length>0&&(s.skeletons=m),f.length>0&&(s.animations=f),g.length>0&&(s.nodes=g)}return s.object=r,s;function a(l){const c=[];for(const h in l){const u=l[h];delete u.metadata,c.push(u)}return c}}clone(e){return new this.constructor().copy(this,e)}copy(e,i=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),i===!0)for(let s=0;s<e.children.length;s++){const r=e.children[s];this.add(r.clone())}return this}}Kn.DEFAULT_UP=new me(0,1,0),Kn.DEFAULT_MATRIX_AUTO_UPDATE=!0,Kn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Tl=new me,Eh=new me,jL=new me,Th=new me,Lg=new me,Pg=new me,KV=new me,QL=new me,ZL=new me,YL=new me;class th{constructor(e=new me,i=new me,s=new me){this.a=e,this.b=i,this.c=s}static getNormal(e,i,s,r){r.subVectors(s,i),Tl.subVectors(e,i),r.cross(Tl);const o=r.lengthSq();return o>0?r.multiplyScalar(1/Math.sqrt(o)):r.set(0,0,0)}static getBarycoord(e,i,s,r,o){Tl.subVectors(r,i),Eh.subVectors(s,i),jL.subVectors(e,i);const a=Tl.dot(Tl),l=Tl.dot(Eh),c=Tl.dot(jL),h=Eh.dot(Eh),u=Eh.dot(jL),d=a*h-l*l;if(d===0)return o.set(0,0,0),null;const m=1/d,f=(h*c-l*u)*m,g=(a*u-l*c)*m;return o.set(1-f-g,g,f)}static containsPoint(e,i,s,r){return this.getBarycoord(e,i,s,r,Th)===null?!1:Th.x>=0&&Th.y>=0&&Th.x+Th.y<=1}static getInterpolation(e,i,s,r,o,a,l,c){return this.getBarycoord(e,i,s,r,Th)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(o,Th.x),c.addScaledVector(a,Th.y),c.addScaledVector(l,Th.z),c)}static isFrontFacing(e,i,s,r){return Tl.subVectors(s,i),Eh.subVectors(e,i),Tl.cross(Eh).dot(r)<0}set(e,i,s){return this.a.copy(e),this.b.copy(i),this.c.copy(s),this}setFromPointsAndIndices(e,i,s,r){return this.a.copy(e[i]),this.b.copy(e[s]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,i,s,r){return this.a.fromBufferAttribute(e,i),this.b.fromBufferAttribute(e,s),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Tl.subVectors(this.c,this.b),Eh.subVectors(this.a,this.b),Tl.cross(Eh).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return th.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,i){return th.getBarycoord(e,this.a,this.b,this.c,i)}getInterpolation(e,i,s,r,o){return th.getInterpolation(e,this.a,this.b,this.c,i,s,r,o)}containsPoint(e){return th.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return th.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,i){const s=this.a,r=this.b,o=this.c;let a,l;Lg.subVectors(r,s),Pg.subVectors(o,s),QL.subVectors(e,s);const c=Lg.dot(QL),h=Pg.dot(QL);if(c<=0&&h<=0)return i.copy(s);ZL.subVectors(e,r);const u=Lg.dot(ZL),d=Pg.dot(ZL);if(u>=0&&d<=u)return i.copy(r);const m=c*d-u*h;if(m<=0&&c>=0&&u<=0)return a=c/(c-u),i.copy(s).addScaledVector(Lg,a);YL.subVectors(e,o);const f=Lg.dot(YL),g=Pg.dot(YL);if(g>=0&&f<=g)return i.copy(o);const y=f*h-c*g;if(y<=0&&h>=0&&g<=0)return l=h/(h-g),i.copy(s).addScaledVector(Pg,l);const v=u*g-f*d;if(v<=0&&d-u>=0&&f-g>=0)return KV.subVectors(o,r),l=(d-u)/(d-u+(f-g)),i.copy(r).addScaledVector(KV,l);const b=1/(v+y+m);return a=y*b,l=m*b,i.copy(s).addScaledVector(Lg,a).addScaledVector(Pg,l)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const JV={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ju={h:0,s:0,l:0},Y_={h:0,s:0,l:0};function KL(n,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?n+(e-n)*6*i:i<1/2?e:i<2/3?n+(e-n)*6*(2/3-i):n}class is{constructor(e,i,s){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,i,s)}set(e,i,s){if(i===void 0&&s===void 0){const r=e;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(e,i,s);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,i=Lr){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Ko.toWorkingColorSpace(this,i),this}setRGB(e,i,s,r=Ko.workingColorSpace){return this.r=e,this.g=i,this.b=s,Ko.toWorkingColorSpace(this,r),this}setHSL(e,i,s,r=Ko.workingColorSpace){if(e=kL(e,1),i=Br(i,0,1),s=Br(s,0,1),i===0)this.r=this.g=this.b=s;else{const o=s<=.5?s*(1+i):s+i-s*i,a=2*s-o;this.r=KL(a,o,e+1/3),this.g=KL(a,o,e),this.b=KL(a,o,e-1/3)}return Ko.toWorkingColorSpace(this,r),this}setStyle(e,i=Lr){function s(o){o!==void 0&&parseFloat(o)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let o;const a=r[1],l=r[2];switch(a){case"rgb":case"rgba":if(o=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return s(o[4]),this.setRGB(Math.min(255,parseInt(o[1],10))/255,Math.min(255,parseInt(o[2],10))/255,Math.min(255,parseInt(o[3],10))/255,i);if(o=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return s(o[4]),this.setRGB(Math.min(100,parseInt(o[1],10))/100,Math.min(100,parseInt(o[2],10))/100,Math.min(100,parseInt(o[3],10))/100,i);break;case"hsl":case"hsla":if(o=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return s(o[4]),this.setHSL(parseFloat(o[1])/360,parseFloat(o[2])/100,parseFloat(o[3])/100,i);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const o=r[1],a=o.length;if(a===3)return this.setRGB(parseInt(o.charAt(0),16)/15,parseInt(o.charAt(1),16)/15,parseInt(o.charAt(2),16)/15,i);if(a===6)return this.setHex(parseInt(o,16),i);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,i);return this}setColorName(e,i=Lr){const s=JV[e.toLowerCase()];return s!==void 0?this.setHex(s,i):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=_g(e.r),this.g=_g(e.g),this.b=_g(e.b),this}copyLinearToSRGB(e){return this.r=GL(e.r),this.g=GL(e.g),this.b=GL(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Lr){return Ko.fromWorkingColorSpace(kr.copy(this),e),Math.round(Br(kr.r*255,0,255))*65536+Math.round(Br(kr.g*255,0,255))*256+Math.round(Br(kr.b*255,0,255))}getHexString(e=Lr){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,i=Ko.workingColorSpace){Ko.fromWorkingColorSpace(kr.copy(this),i);const s=kr.r,r=kr.g,o=kr.b,a=Math.max(s,r,o),l=Math.min(s,r,o);let c,h;const u=(l+a)/2;if(l===a)c=0,h=0;else{const d=a-l;switch(h=u<=.5?d/(a+l):d/(2-a-l),a){case s:c=(r-o)/d+(r<o?6:0);break;case r:c=(o-s)/d+2;break;case o:c=(s-r)/d+4;break}c/=6}return e.h=c,e.s=h,e.l=u,e}getRGB(e,i=Ko.workingColorSpace){return Ko.fromWorkingColorSpace(kr.copy(this),i),e.r=kr.r,e.g=kr.g,e.b=kr.b,e}getStyle(e=Lr){Ko.fromWorkingColorSpace(kr.copy(this),e);const i=kr.r,s=kr.g,r=kr.b;return e!==Lr?`color(${e} ${i.toFixed(3)} ${s.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(i*255)},${Math.round(s*255)},${Math.round(r*255)})`}offsetHSL(e,i,s){return this.getHSL(Ju),this.setHSL(Ju.h+e,Ju.s+i,Ju.l+s)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,i){return this.r=e.r+i.r,this.g=e.g+i.g,this.b=e.b+i.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,i){return this.r+=(e.r-this.r)*i,this.g+=(e.g-this.g)*i,this.b+=(e.b-this.b)*i,this}lerpColors(e,i,s){return this.r=e.r+(i.r-e.r)*s,this.g=e.g+(i.g-e.g)*s,this.b=e.b+(i.b-e.b)*s,this}lerpHSL(e,i){this.getHSL(Ju),e.getHSL(Y_);const s=rb(Ju.h,Y_.h,i),r=rb(Ju.s,Y_.s,i),o=rb(Ju.l,Y_.l,i);return this.setHSL(s,r,o),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const i=this.r,s=this.g,r=this.b,o=e.elements;return this.r=o[0]*i+o[3]*s+o[6]*r,this.g=o[1]*i+o[4]*s+o[7]*r,this.b=o[2]*i+o[5]*s+o[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,i=0){return this.r=e[i],this.g=e[i+1],this.b=e[i+2],this}toArray(e=[],i=0){return e[i]=this.r,e[i+1]=this.g,e[i+2]=this.b,e}fromBufferAttribute(e,i){return this.r=e.getX(i),this.g=e.getY(i),this.b=e.getZ(i),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const kr=new is;is.NAMES=JV;let qce=0;class qu extends N_{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:qce++}),this.uuid=wl(),this.name="",this.type="Material",this.blending=AV,this.side=G_,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=wV,this.blendDst=_V,this.blendEquation=xV,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new is(0,0,0),this.blendAlpha=0,this.depthFunc=SV,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=OV,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=wg,this.stencilZFail=wg,this.stencilZPass=wg,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const i in e){const s=e[i];if(s===void 0){console.warn(`THREE.Material: parameter '${i}' has value of undefined.`);continue}const r=this[i];if(r===void 0){console.warn(`THREE.Material: '${i}' is not a property of THREE.${this.type}.`);continue}r&&r.isColor?r.set(s):r&&r.isVector3&&s&&s.isVector3?r.copy(s):this[i]=s}}toJSON(e){const i=e===void 0||typeof e=="string";i&&(e={textures:{},images:{}});const s={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.color&&this.color.isColor&&(s.color=this.color.getHex()),this.roughness!==void 0&&(s.roughness=this.roughness),this.metalness!==void 0&&(s.metalness=this.metalness),this.sheen!==void 0&&(s.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(s.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(s.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(s.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(s.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(s.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(s.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(s.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(s.shininess=this.shininess),this.clearcoat!==void 0&&(s.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(s.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(s.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(s.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(s.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,s.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(s.dispersion=this.dispersion),this.iridescence!==void 0&&(s.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(s.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(s.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(s.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(s.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(s.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(s.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(s.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(s.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(s.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(s.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(s.lightMap=this.lightMap.toJSON(e).uuid,s.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(s.aoMap=this.aoMap.toJSON(e).uuid,s.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(s.bumpMap=this.bumpMap.toJSON(e).uuid,s.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(s.normalMap=this.normalMap.toJSON(e).uuid,s.normalMapType=this.normalMapType,s.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(s.displacementMap=this.displacementMap.toJSON(e).uuid,s.displacementScale=this.displacementScale,s.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(s.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(s.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(s.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(s.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(s.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(s.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(s.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(s.combine=this.combine)),this.envMapRotation!==void 0&&(s.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(s.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(s.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(s.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(s.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(s.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(s.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(s.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(s.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(s.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(s.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(s.size=this.size),this.shadowSide!==null&&(s.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(s.sizeAttenuation=this.sizeAttenuation),this.blending!==AV&&(s.blending=this.blending),this.side!==G_&&(s.side=this.side),this.vertexColors===!0&&(s.vertexColors=!0),this.opacity<1&&(s.opacity=this.opacity),this.transparent===!0&&(s.transparent=!0),this.blendSrc!==wV&&(s.blendSrc=this.blendSrc),this.blendDst!==_V&&(s.blendDst=this.blendDst),this.blendEquation!==xV&&(s.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(s.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(s.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(s.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(s.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(s.blendAlpha=this.blendAlpha),this.depthFunc!==SV&&(s.depthFunc=this.depthFunc),this.depthTest===!1&&(s.depthTest=this.depthTest),this.depthWrite===!1&&(s.depthWrite=this.depthWrite),this.colorWrite===!1&&(s.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(s.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==OV&&(s.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(s.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(s.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==wg&&(s.stencilFail=this.stencilFail),this.stencilZFail!==wg&&(s.stencilZFail=this.stencilZFail),this.stencilZPass!==wg&&(s.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(s.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(s.rotation=this.rotation),this.polygonOffset===!0&&(s.polygonOffset=!0),this.polygonOffsetFactor!==0&&(s.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(s.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(s.linewidth=this.linewidth),this.dashSize!==void 0&&(s.dashSize=this.dashSize),this.gapSize!==void 0&&(s.gapSize=this.gapSize),this.scale!==void 0&&(s.scale=this.scale),this.dithering===!0&&(s.dithering=!0),this.alphaTest>0&&(s.alphaTest=this.alphaTest),this.alphaHash===!0&&(s.alphaHash=!0),this.alphaToCoverage===!0&&(s.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(s.premultipliedAlpha=!0),this.forceSinglePass===!0&&(s.forceSinglePass=!0),this.wireframe===!0&&(s.wireframe=!0),this.wireframeLinewidth>1&&(s.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(s.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(s.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(s.flatShading=!0),this.visible===!1&&(s.visible=!1),this.toneMapped===!1&&(s.toneMapped=!1),this.fog===!1&&(s.fog=!1),Object.keys(this.userData).length>0&&(s.userData=this.userData);function r(o){const a=[];for(const l in o){const c=o[l];delete c.metadata,a.push(c)}return a}if(i){const o=r(e.textures),a=r(e.images);o.length>0&&(s.textures=o),a.length>0&&(s.images=a)}return s}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const i=e.clippingPlanes;let s=null;if(i!==null){const r=i.length;s=new Array(r);for(let o=0;o!==r;++o)s[o]=i[o].clone()}return this.clippingPlanes=s,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class Bg extends qu{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new is(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ny,this.combine=ice,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const ns=new me,K_=new Ln;class qo{constructor(e,i,s=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=i,this.count=e!==void 0?e.length/i:0,this.normalized=s,this.usage=PL,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=am,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return FV("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,i){this.updateRanges.push({start:e,count:i})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,i,s){e*=this.itemSize,s*=i.itemSize;for(let r=0,o=this.itemSize;r<o;r++)this.array[e+r]=i.array[s+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let i=0,s=this.count;i<s;i++)K_.fromBufferAttribute(this,i),K_.applyMatrix3(e),this.setXY(i,K_.x,K_.y);else if(this.itemSize===3)for(let i=0,s=this.count;i<s;i++)ns.fromBufferAttribute(this,i),ns.applyMatrix3(e),this.setXYZ(i,ns.x,ns.y,ns.z);return this}applyMatrix4(e){for(let i=0,s=this.count;i<s;i++)ns.fromBufferAttribute(this,i),ns.applyMatrix4(e),this.setXYZ(i,ns.x,ns.y,ns.z);return this}applyNormalMatrix(e){for(let i=0,s=this.count;i<s;i++)ns.fromBufferAttribute(this,i),ns.applyNormalMatrix(e),this.setXYZ(i,ns.x,ns.y,ns.z);return this}transformDirection(e){for(let i=0,s=this.count;i<s;i++)ns.fromBufferAttribute(this,i),ns.transformDirection(e),this.setXYZ(i,ns.x,ns.y,ns.z);return this}set(e,i=0){return this.array.set(e,i),this}getComponent(e,i){let s=this.array[e*this.itemSize+i];return this.normalized&&(s=_l(s,this.array)),s}setComponent(e,i,s){return this.normalized&&(s=Di(s,this.array)),this.array[e*this.itemSize+i]=s,this}getX(e){let i=this.array[e*this.itemSize];return this.normalized&&(i=_l(i,this.array)),i}setX(e,i){return this.normalized&&(i=Di(i,this.array)),this.array[e*this.itemSize]=i,this}getY(e){let i=this.array[e*this.itemSize+1];return this.normalized&&(i=_l(i,this.array)),i}setY(e,i){return this.normalized&&(i=Di(i,this.array)),this.array[e*this.itemSize+1]=i,this}getZ(e){let i=this.array[e*this.itemSize+2];return this.normalized&&(i=_l(i,this.array)),i}setZ(e,i){return this.normalized&&(i=Di(i,this.array)),this.array[e*this.itemSize+2]=i,this}getW(e){let i=this.array[e*this.itemSize+3];return this.normalized&&(i=_l(i,this.array)),i}setW(e,i){return this.normalized&&(i=Di(i,this.array)),this.array[e*this.itemSize+3]=i,this}setXY(e,i,s){return e*=this.itemSize,this.normalized&&(i=Di(i,this.array),s=Di(s,this.array)),this.array[e+0]=i,this.array[e+1]=s,this}setXYZ(e,i,s,r){return e*=this.itemSize,this.normalized&&(i=Di(i,this.array),s=Di(s,this.array),r=Di(r,this.array)),this.array[e+0]=i,this.array[e+1]=s,this.array[e+2]=r,this}setXYZW(e,i,s,r,o){return e*=this.itemSize,this.normalized&&(i=Di(i,this.array),s=Di(s,this.array),r=Di(r,this.array),o=Di(o,this.array)),this.array[e+0]=i,this.array[e+1]=s,this.array[e+2]=r,this.array[e+3]=o,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==PL&&(e.usage=this.usage),e}}class $ce extends qo{constructor(e,i,s){super(new Uint16Array(e),i,s)}}class ehe extends qo{constructor(e,i,s){super(new Uint32Array(e),i,s)}}class JL extends qo{constructor(e,i,s){super(new Float32Array(e),i,s)}}let the=0;const Ga=new ui,qL=new Kn,kg=new me,$o=new Sl,hb=new Sl,Bs=new me;class Kl extends N_{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:the++}),this.uuid=wl(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Gce(e)?ehe:$ce)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,i){return this.attributes[e]=i,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,i,s=0){this.groups.push({start:e,count:i,materialIndex:s})}clearGroups(){this.groups=[]}setDrawRange(e,i){this.drawRange.start=e,this.drawRange.count=i}applyMatrix4(e){const i=this.attributes.position;i!==void 0&&(i.applyMatrix4(e),i.needsUpdate=!0);const s=this.attributes.normal;if(s!==void 0){const o=new yu().getNormalMatrix(e);s.applyNormalMatrix(o),s.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Ga.makeRotationFromQuaternion(e),this.applyMatrix4(Ga),this}rotateX(e){return Ga.makeRotationX(e),this.applyMatrix4(Ga),this}rotateY(e){return Ga.makeRotationY(e),this.applyMatrix4(Ga),this}rotateZ(e){return Ga.makeRotationZ(e),this.applyMatrix4(Ga),this}translate(e,i,s){return Ga.makeTranslation(e,i,s),this.applyMatrix4(Ga),this}scale(e,i,s){return Ga.makeScale(e,i,s),this.applyMatrix4(Ga),this}lookAt(e){return qL.lookAt(e),qL.updateMatrix(),this.applyMatrix4(qL.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(kg).negate(),this.translate(kg.x,kg.y,kg.z),this}setFromPoints(e){const i=[];for(let s=0,r=e.length;s<r;s++){const o=e[s];i.push(o.x,o.y,o.z||0)}return this.setAttribute("position",new JL(i,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Sl);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new me(-1/0,-1/0,-1/0),new me(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),i)for(let s=0,r=i.length;s<r;s++){const o=i[s];$o.setFromBufferAttribute(o),this.morphTargetsRelative?(Bs.addVectors(this.boundingBox.min,$o.min),this.boundingBox.expandByPoint(Bs),Bs.addVectors(this.boundingBox.max,$o.max),this.boundingBox.expandByPoint(Bs)):(this.boundingBox.expandByPoint($o.min),this.boundingBox.expandByPoint($o.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ml);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new me,1/0);return}if(e){const s=this.boundingSphere.center;if($o.setFromBufferAttribute(e),i)for(let o=0,a=i.length;o<a;o++){const l=i[o];hb.setFromBufferAttribute(l),this.morphTargetsRelative?(Bs.addVectors($o.min,hb.min),$o.expandByPoint(Bs),Bs.addVectors($o.max,hb.max),$o.expandByPoint(Bs)):($o.expandByPoint(hb.min),$o.expandByPoint(hb.max))}$o.getCenter(s);let r=0;for(let o=0,a=e.count;o<a;o++)Bs.fromBufferAttribute(e,o),r=Math.max(r,s.distanceToSquared(Bs));if(i)for(let o=0,a=i.length;o<a;o++){const l=i[o],c=this.morphTargetsRelative;for(let h=0,u=l.count;h<u;h++)Bs.fromBufferAttribute(l,h),c&&(kg.fromBufferAttribute(e,h),Bs.add(kg)),r=Math.max(r,s.distanceToSquared(Bs))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,i=this.attributes;if(e===null||i.position===void 0||i.normal===void 0||i.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const s=i.position,r=i.normal,o=i.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new qo(new Float32Array(4*s.count),4));const a=this.getAttribute("tangent"),l=[],c=[];for(let R=0;R<s.count;R++)l[R]=new me,c[R]=new me;const h=new me,u=new me,d=new me,m=new Ln,f=new Ln,g=new Ln,y=new me,v=new me;function b(R,P,C){h.fromBufferAttribute(s,R),u.fromBufferAttribute(s,P),d.fromBufferAttribute(s,C),m.fromBufferAttribute(o,R),f.fromBufferAttribute(o,P),g.fromBufferAttribute(o,C),u.sub(h),d.sub(h),f.sub(m),g.sub(m);const L=1/(f.x*g.y-g.x*f.y);isFinite(L)&&(y.copy(u).multiplyScalar(g.y).addScaledVector(d,-f.y).multiplyScalar(L),v.copy(d).multiplyScalar(f.x).addScaledVector(u,-g.x).multiplyScalar(L),l[R].add(y),l[P].add(y),l[C].add(y),c[R].add(v),c[P].add(v),c[C].add(v))}let A=this.groups;A.length===0&&(A=[{start:0,count:e.count}]);for(let R=0,P=A.length;R<P;++R){const C=A[R],L=C.start,B=C.count;for(let z=L,D=L+B;z<D;z+=3)b(e.getX(z+0),e.getX(z+1),e.getX(z+2))}const x=new me,w=new me,_=new me,S=new me;function M(R){_.fromBufferAttribute(r,R),S.copy(_);const P=l[R];x.copy(P),x.sub(_.multiplyScalar(_.dot(P))).normalize(),w.crossVectors(S,P);const C=w.dot(c[R])<0?-1:1;a.setXYZW(R,x.x,x.y,x.z,C)}for(let R=0,P=A.length;R<P;++R){const C=A[R],L=C.start,B=C.count;for(let z=L,D=L+B;z<D;z+=3)M(e.getX(z+0)),M(e.getX(z+1)),M(e.getX(z+2))}}computeVertexNormals(){const e=this.index,i=this.getAttribute("position");if(i!==void 0){let s=this.getAttribute("normal");if(s===void 0)s=new qo(new Float32Array(i.count*3),3),this.setAttribute("normal",s);else for(let m=0,f=s.count;m<f;m++)s.setXYZ(m,0,0,0);const r=new me,o=new me,a=new me,l=new me,c=new me,h=new me,u=new me,d=new me;if(e)for(let m=0,f=e.count;m<f;m+=3){const g=e.getX(m+0),y=e.getX(m+1),v=e.getX(m+2);r.fromBufferAttribute(i,g),o.fromBufferAttribute(i,y),a.fromBufferAttribute(i,v),u.subVectors(a,o),d.subVectors(r,o),u.cross(d),l.fromBufferAttribute(s,g),c.fromBufferAttribute(s,y),h.fromBufferAttribute(s,v),l.add(u),c.add(u),h.add(u),s.setXYZ(g,l.x,l.y,l.z),s.setXYZ(y,c.x,c.y,c.z),s.setXYZ(v,h.x,h.y,h.z)}else for(let m=0,f=i.count;m<f;m+=3)r.fromBufferAttribute(i,m+0),o.fromBufferAttribute(i,m+1),a.fromBufferAttribute(i,m+2),u.subVectors(a,o),d.subVectors(r,o),u.cross(d),s.setXYZ(m+0,u.x,u.y,u.z),s.setXYZ(m+1,u.x,u.y,u.z),s.setXYZ(m+2,u.x,u.y,u.z);this.normalizeNormals(),s.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let i=0,s=e.count;i<s;i++)Bs.fromBufferAttribute(e,i),Bs.normalize(),e.setXYZ(i,Bs.x,Bs.y,Bs.z)}toNonIndexed(){function e(l,c){const h=l.array,u=l.itemSize,d=l.normalized,m=new h.constructor(c.length*u);let f=0,g=0;for(let y=0,v=c.length;y<v;y++){l.isInterleavedBufferAttribute?f=c[y]*l.data.stride+l.offset:f=c[y]*u;for(let b=0;b<u;b++)m[g++]=h[f++]}return new qo(m,u,d)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const i=new Kl,s=this.index.array,r=this.attributes;for(const l in r){const c=r[l],h=e(c,s);i.setAttribute(l,h)}const o=this.morphAttributes;for(const l in o){const c=[],h=o[l];for(let u=0,d=h.length;u<d;u++){const m=h[u],f=e(m,s);c.push(f)}i.morphAttributes[l]=c}i.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let l=0,c=a.length;l<c;l++){const h=a[l];i.addGroup(h.start,h.count,h.materialIndex)}return i}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const h in c)c[h]!==void 0&&(e[h]=c[h]);return e}e.data={attributes:{}};const i=this.index;i!==null&&(e.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});const s=this.attributes;for(const c in s){const h=s[c];e.data.attributes[c]=h.toJSON(e.data)}const r={};let o=!1;for(const c in this.morphAttributes){const h=this.morphAttributes[c],u=[];for(let d=0,m=h.length;d<m;d++){const f=h[d];u.push(f.toJSON(e.data))}u.length>0&&(r[c]=u,o=!0)}o&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const l=this.boundingSphere;return l!==null&&(e.data.boundingSphere={center:l.center.toArray(),radius:l.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const i={};this.name=e.name;const s=e.index;s!==null&&this.setIndex(s.clone(i));const r=e.attributes;for(const h in r){const u=r[h];this.setAttribute(h,u.clone(i))}const o=e.morphAttributes;for(const h in o){const u=[],d=o[h];for(let m=0,f=d.length;m<f;m++)u.push(d[m].clone(i));this.morphAttributes[h]=u}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let h=0,u=a.length;h<u;h++){const d=a[h];this.addGroup(d.start,d.count,d.materialIndex)}const l=e.boundingBox;l!==null&&(this.boundingBox=l.clone());const c=e.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const qV=new ui,um=new j_,J_=new Ml,$V=new me,Dg=new me,Og=new me,Gg=new me,$L=new me,q_=new me,$_=new Ln,eS=new Ln,tS=new Ln,eX=new me,tX=new me,iX=new me,iS=new me,nS=new me;class $u extends Kn{constructor(e=new Kl,i=new Bg){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=i,this.updateMorphTargets()}copy(e,i){return super.copy(e,i),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){const s=e[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=s.length;r<o;r++){const a=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}getVertexPosition(e,i){const s=this.geometry,r=s.attributes.position,o=s.morphAttributes.position,a=s.morphTargetsRelative;i.fromBufferAttribute(r,e);const l=this.morphTargetInfluences;if(o&&l){q_.set(0,0,0);for(let c=0,h=o.length;c<h;c++){const u=l[c],d=o[c];u!==0&&($L.fromBufferAttribute(d,e),a?q_.addScaledVector($L,u):q_.addScaledVector($L.sub(i),u))}i.add(q_)}return i}raycast(e,i){const s=this.geometry,r=this.material,o=this.matrixWorld;r!==void 0&&(s.boundingSphere===null&&s.computeBoundingSphere(),J_.copy(s.boundingSphere),J_.applyMatrix4(o),um.copy(e.ray).recast(e.near),!(J_.containsPoint(um.origin)===!1&&(um.intersectSphere(J_,$V)===null||um.origin.distanceToSquared($V)>(e.far-e.near)**2))&&(qV.copy(o).invert(),um.copy(e.ray).applyMatrix4(qV),!(s.boundingBox!==null&&um.intersectsBox(s.boundingBox)===!1)&&this._computeIntersections(e,i,um)))}_computeIntersections(e,i,s){let r;const o=this.geometry,a=this.material,l=o.index,c=o.attributes.position,h=o.attributes.uv,u=o.attributes.uv1,d=o.attributes.normal,m=o.groups,f=o.drawRange;if(l!==null)if(Array.isArray(a))for(let g=0,y=m.length;g<y;g++){const v=m[g],b=a[v.materialIndex],A=Math.max(v.start,f.start),x=Math.min(l.count,Math.min(v.start+v.count,f.start+f.count));for(let w=A,_=x;w<_;w+=3){const S=l.getX(w),M=l.getX(w+1),R=l.getX(w+2);r=sS(this,b,e,s,h,u,d,S,M,R),r&&(r.faceIndex=Math.floor(w/3),r.face.materialIndex=v.materialIndex,i.push(r))}}else{const g=Math.max(0,f.start),y=Math.min(l.count,f.start+f.count);for(let v=g,b=y;v<b;v+=3){const A=l.getX(v),x=l.getX(v+1),w=l.getX(v+2);r=sS(this,a,e,s,h,u,d,A,x,w),r&&(r.faceIndex=Math.floor(v/3),i.push(r))}}else if(c!==void 0)if(Array.isArray(a))for(let g=0,y=m.length;g<y;g++){const v=m[g],b=a[v.materialIndex],A=Math.max(v.start,f.start),x=Math.min(c.count,Math.min(v.start+v.count,f.start+f.count));for(let w=A,_=x;w<_;w+=3){const S=w,M=w+1,R=w+2;r=sS(this,b,e,s,h,u,d,S,M,R),r&&(r.faceIndex=Math.floor(w/3),r.face.materialIndex=v.materialIndex,i.push(r))}}else{const g=Math.max(0,f.start),y=Math.min(c.count,f.start+f.count);for(let v=g,b=y;v<b;v+=3){const A=v,x=v+1,w=v+2;r=sS(this,a,e,s,h,u,d,A,x,w),r&&(r.faceIndex=Math.floor(v/3),i.push(r))}}}}function ihe(n,e,i,s,r,o,a,l){let c;if(e.side===ece?c=s.intersectTriangle(a,o,r,!0,l):c=s.intersectTriangle(r,o,a,e.side===G_,l),c===null)return null;nS.copy(l),nS.applyMatrix4(n.matrixWorld);const h=i.ray.origin.distanceTo(nS);return h<i.near||h>i.far?null:{distance:h,point:nS.clone(),object:n}}function sS(n,e,i,s,r,o,a,l,c,h){n.getVertexPosition(l,Dg),n.getVertexPosition(c,Og),n.getVertexPosition(h,Gg);const u=ihe(n,e,i,s,Dg,Og,Gg,iS);if(u){r&&($_.fromBufferAttribute(r,l),eS.fromBufferAttribute(r,c),tS.fromBufferAttribute(r,h),u.uv=th.getInterpolation(iS,Dg,Og,Gg,$_,eS,tS,new Ln)),o&&($_.fromBufferAttribute(o,l),eS.fromBufferAttribute(o,c),tS.fromBufferAttribute(o,h),u.uv1=th.getInterpolation(iS,Dg,Og,Gg,$_,eS,tS,new Ln)),a&&(eX.fromBufferAttribute(a,l),tX.fromBufferAttribute(a,c),iX.fromBufferAttribute(a,h),u.normal=th.getInterpolation(iS,Dg,Og,Gg,eX,tX,iX,new me),u.normal.dot(s.direction)>0&&u.normal.multiplyScalar(-1));const d={a:l,b:c,c:h,normal:new me,materialIndex:0};th.getNormal(Dg,Og,Gg,d.normal),u.face=d}return u}let nX=class extends Kn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new ui,this.projectionMatrix=new ui,this.projectionMatrixInverse=new ui,this.coordinateSystem=lm}copy(n,e){return super.copy(n,e),this.matrixWorldInverse.copy(n.matrixWorldInverse),this.projectionMatrix.copy(n.projectionMatrix),this.projectionMatrixInverse.copy(n.projectionMatrixInverse),this.coordinateSystem=n.coordinateSystem,this}getWorldDirection(n){return super.getWorldDirection(n).negate()}updateMatrixWorld(n){super.updateMatrixWorld(n),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(n,e){super.updateWorldMatrix(n,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}};const ed=new me,sX=new Ln,rX=new Ln;class eP extends nX{constructor(e=50,i=1,s=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=s,this.far=r,this.focus=10,this.aspect=i,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,i){return super.copy(e,i),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const i=.5*this.getFilmHeight()/e;this.fov=sb*2*Math.atan(i),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(nb*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return sb*2*Math.atan(Math.tan(nb*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,i,s){ed.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(ed.x,ed.y).multiplyScalar(-e/ed.z),ed.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),s.set(ed.x,ed.y).multiplyScalar(-e/ed.z)}getViewSize(e,i){return this.getViewBounds(e,sX,rX),i.subVectors(rX,sX)}setViewOffset(e,i,s,r,o,a){this.aspect=e/i,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=i,this.view.offsetX=s,this.view.offsetY=r,this.view.width=o,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let i=e*Math.tan(nb*.5*this.fov)/this.zoom,s=2*i,r=this.aspect*s,o=-.5*r;const a=this.view;if(this.view!==null&&this.view.enabled){const c=a.fullWidth,h=a.fullHeight;o+=a.offsetX*r/c,i-=a.offsetY*s/h,r*=a.width/c,s*=a.height/h}const l=this.filmOffset;l!==0&&(o+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(o,o+r,i,i-s,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const i=super.toJSON(e);return i.object.fov=this.fov,i.object.zoom=this.zoom,i.object.near=this.near,i.object.far=this.far,i.object.focus=this.focus,i.object.aspect=this.aspect,this.view!==null&&(i.object.view=Object.assign({},this.view)),i.object.filmGauge=this.filmGauge,i.object.filmOffset=this.filmOffset,i}}const tP=new me,nhe=new me,she=new yu;class zg{constructor(e=new me(1,0,0),i=0){this.isPlane=!0,this.normal=e,this.constant=i}set(e,i){return this.normal.copy(e),this.constant=i,this}setComponents(e,i,s,r){return this.normal.set(e,i,s),this.constant=r,this}setFromNormalAndCoplanarPoint(e,i){return this.normal.copy(e),this.constant=-i.dot(this.normal),this}setFromCoplanarPoints(e,i,s){const r=tP.subVectors(s,i).cross(nhe.subVectors(e,i)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,i){return i.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,i){const s=e.delta(tP),r=this.normal.dot(s);if(r===0)return this.distanceToPoint(e.start)===0?i.copy(e.start):null;const o=-(e.start.dot(this.normal)+this.constant)/r;return o<0||o>1?null:i.copy(e.start).addScaledVector(s,o)}intersectsLine(e){const i=this.distanceToPoint(e.start),s=this.distanceToPoint(e.end);return i<0&&s>0||s<0&&i>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,i){const s=i||she.getNormalMatrix(e),r=this.coplanarPoint(tP).applyMatrix4(e),o=this.normal.applyMatrix3(s).normalize();return this.constant=-r.dot(o),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const dm=new Ml,rS=new me;class rhe{constructor(e=new zg,i=new zg,s=new zg,r=new zg,o=new zg,a=new zg){this.planes=[e,i,s,r,o,a]}set(e,i,s,r,o,a){const l=this.planes;return l[0].copy(e),l[1].copy(i),l[2].copy(s),l[3].copy(r),l[4].copy(o),l[5].copy(a),this}copy(e){const i=this.planes;for(let s=0;s<6;s++)i[s].copy(e.planes[s]);return this}setFromProjectionMatrix(e,i=lm){const s=this.planes,r=e.elements,o=r[0],a=r[1],l=r[2],c=r[3],h=r[4],u=r[5],d=r[6],m=r[7],f=r[8],g=r[9],y=r[10],v=r[11],b=r[12],A=r[13],x=r[14],w=r[15];if(s[0].setComponents(c-o,m-h,v-f,w-b).normalize(),s[1].setComponents(c+o,m+h,v+f,w+b).normalize(),s[2].setComponents(c+a,m+u,v+g,w+A).normalize(),s[3].setComponents(c-a,m-u,v-g,w-A).normalize(),s[4].setComponents(c-l,m-d,v-y,w-x).normalize(),i===lm)s[5].setComponents(c+l,m+d,v+y,w+x).normalize();else if(i===BL)s[5].setComponents(l,d,y,x).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+i);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),dm.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const i=e.geometry;i.boundingSphere===null&&i.computeBoundingSphere(),dm.copy(i.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(dm)}intersectsSprite(e){return dm.center.set(0,0,0),dm.radius=.7071067811865476,dm.applyMatrix4(e.matrixWorld),this.intersectsSphere(dm)}intersectsSphere(e){const i=this.planes,s=e.center,r=-e.radius;for(let o=0;o<6;o++)if(i[o].distanceToPoint(s)<r)return!1;return!0}intersectsBox(e){const i=this.planes;for(let s=0;s<6;s++){const r=i[s];if(rS.x=r.normal.x>0?e.max.x:e.min.x,rS.y=r.normal.y>0?e.max.y:e.min.y,rS.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(rS)<0)return!1}return!0}containsPoint(e){const i=this.planes;for(let s=0;s<6;s++)if(i[s].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}class oX extends nX{constructor(e=-1,i=1,s=1,r=-1,o=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=i,this.top=s,this.bottom=r,this.near=o,this.far=a,this.updateProjectionMatrix()}copy(e,i){return super.copy(e,i),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,i,s,r,o,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=i,this.view.offsetX=s,this.view.offsetY=r,this.view.width=o,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),i=(this.top-this.bottom)/(2*this.zoom),s=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let o=s-e,a=s+e,l=r+i,c=r-i;if(this.view!==null&&this.view.enabled){const h=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o+=h*this.view.offsetX,a=o+h*this.view.width,l-=u*this.view.offsetY,c=l-u*this.view.height}this.projectionMatrix.makeOrthographic(o,a,l,c,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const i=super.toJSON(e);return i.object.zoom=this.zoom,i.object.left=this.left,i.object.right=this.right,i.object.top=this.top,i.object.bottom=this.bottom,i.object.near=this.near,i.object.far=this.far,this.view!==null&&(i.object.view=Object.assign({},this.view)),i}}class iP extends Kn{constructor(){super(),this.isGroup=!0,this.type="Group"}}class ohe{constructor(e,i){this.isInterleavedBuffer=!0,this.array=e,this.stride=i,this.count=e!==void 0?e.length/i:0,this.usage=PL,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=wl()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return FV("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,i){this.updateRanges.push({start:e,count:i})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,i,s){e*=this.stride,s*=i.stride;for(let r=0,o=this.stride;r<o;r++)this.array[e+r]=i.array[s+r];return this}set(e,i=0){return this.array.set(e,i),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=wl()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const i=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),s=new this.constructor(i,this.stride);return s.setUsage(this.usage),s}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=wl()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const ro=new me;class M3{constructor(e,i,s,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=i,this.offset=s,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let i=0,s=this.data.count;i<s;i++)ro.fromBufferAttribute(this,i),ro.applyMatrix4(e),this.setXYZ(i,ro.x,ro.y,ro.z);return this}applyNormalMatrix(e){for(let i=0,s=this.count;i<s;i++)ro.fromBufferAttribute(this,i),ro.applyNormalMatrix(e),this.setXYZ(i,ro.x,ro.y,ro.z);return this}transformDirection(e){for(let i=0,s=this.count;i<s;i++)ro.fromBufferAttribute(this,i),ro.transformDirection(e),this.setXYZ(i,ro.x,ro.y,ro.z);return this}getComponent(e,i){let s=this.array[e*this.data.stride+this.offset+i];return this.normalized&&(s=_l(s,this.array)),s}setComponent(e,i,s){return this.normalized&&(s=Di(s,this.array)),this.data.array[e*this.data.stride+this.offset+i]=s,this}setX(e,i){return this.normalized&&(i=Di(i,this.array)),this.data.array[e*this.data.stride+this.offset]=i,this}setY(e,i){return this.normalized&&(i=Di(i,this.array)),this.data.array[e*this.data.stride+this.offset+1]=i,this}setZ(e,i){return this.normalized&&(i=Di(i,this.array)),this.data.array[e*this.data.stride+this.offset+2]=i,this}setW(e,i){return this.normalized&&(i=Di(i,this.array)),this.data.array[e*this.data.stride+this.offset+3]=i,this}getX(e){let i=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(i=_l(i,this.array)),i}getY(e){let i=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(i=_l(i,this.array)),i}getZ(e){let i=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(i=_l(i,this.array)),i}getW(e){let i=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(i=_l(i,this.array)),i}setXY(e,i,s){return e=e*this.data.stride+this.offset,this.normalized&&(i=Di(i,this.array),s=Di(s,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=s,this}setXYZ(e,i,s,r){return e=e*this.data.stride+this.offset,this.normalized&&(i=Di(i,this.array),s=Di(s,this.array),r=Di(r,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=s,this.data.array[e+2]=r,this}setXYZW(e,i,s,r,o){return e=e*this.data.stride+this.offset,this.normalized&&(i=Di(i,this.array),s=Di(s,this.array),r=Di(r,this.array),o=Di(o,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=s,this.data.array[e+2]=r,this.data.array[e+3]=o,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let s=0;s<this.count;s++){const r=s*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)i.push(this.data.array[r+o])}return new qo(new this.array.constructor(i),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new M3(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let s=0;s<this.count;s++){const r=s*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)i.push(this.data.array[r+o])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:i,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}const aX=new me,lX=new ll,cX=new ll,ahe=new me,hX=new ui,oS=new me,nP=new Ml,uX=new ui,sP=new j_;class lhe extends $u{constructor(e,i){super(e,i),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=CV,this.bindMatrix=new ui,this.bindMatrixInverse=new ui,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new Sl),this.boundingBox.makeEmpty();const i=e.getAttribute("position");for(let s=0;s<i.count;s++)this.getVertexPosition(s,oS),this.boundingBox.expandByPoint(oS)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Ml),this.boundingSphere.makeEmpty();const i=e.getAttribute("position");for(let s=0;s<i.count;s++)this.getVertexPosition(s,oS),this.boundingSphere.expandByPoint(oS)}copy(e,i){return super.copy(e,i),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,i){const s=this.material,r=this.matrixWorld;s!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),nP.copy(this.boundingSphere),nP.applyMatrix4(r),e.ray.intersectsSphere(nP)!==!1&&(uX.copy(r).invert(),sP.copy(e.ray).applyMatrix4(uX),!(this.boundingBox!==null&&sP.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,i,sP)))}getVertexPosition(e,i){return super.getVertexPosition(e,i),this.applyBoneTransform(e,i),i}bind(e,i){this.skeleton=e,i===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),i=this.matrixWorld),this.bindMatrix.copy(i),this.bindMatrixInverse.copy(i).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new ll,i=this.geometry.attributes.skinWeight;for(let s=0,r=i.count;s<r;s++){e.fromBufferAttribute(i,s);const o=1/e.manhattanLength();o!==1/0?e.multiplyScalar(o):e.set(1,0,0,0),i.setXYZW(s,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===CV?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===nce?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,i){const s=this.skeleton,r=this.geometry;lX.fromBufferAttribute(r.attributes.skinIndex,e),cX.fromBufferAttribute(r.attributes.skinWeight,e),aX.copy(i).applyMatrix4(this.bindMatrix),i.set(0,0,0);for(let o=0;o<4;o++){const a=cX.getComponent(o);if(a!==0){const l=lX.getComponent(o);hX.multiplyMatrices(s.bones[l].matrixWorld,s.boneInverses[l]),i.addScaledVector(ahe.copy(aX).applyMatrix4(hX),a)}}return i.applyMatrix4(this.bindMatrixInverse)}}class dX extends Kn{constructor(){super(),this.isBone=!0,this.type="Bone"}}class rP extends Zs{constructor(e=null,i=1,s=1,r,o,a,l,c,h=qv,u=qv,d,m){super(null,a,l,c,h,u,r,o,d,m),this.isDataTexture=!0,this.image={data:e,width:i,height:s},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const pX=new ui,che=new ui;class E3{constructor(e=[],i=[]){this.uuid=wl(),this.bones=e.slice(0),this.boneInverses=i,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,i=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),i.length===0)this.calculateInverses();else if(e.length!==i.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let s=0,r=this.bones.length;s<r;s++)this.boneInverses.push(new ui)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,i=this.bones.length;e<i;e++){const s=new ui;this.bones[e]&&s.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(s)}}pose(){for(let e=0,i=this.bones.length;e<i;e++){const s=this.bones[e];s&&s.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,i=this.bones.length;e<i;e++){const s=this.bones[e];s&&(s.parent&&s.parent.isBone?(s.matrix.copy(s.parent.matrixWorld).invert(),s.matrix.multiply(s.matrixWorld)):s.matrix.copy(s.matrixWorld),s.matrix.decompose(s.position,s.quaternion,s.scale))}}update(){const e=this.bones,i=this.boneInverses,s=this.boneMatrices,r=this.boneTexture;for(let o=0,a=e.length;o<a;o++){const l=e[o]?e[o].matrixWorld:che;pX.multiplyMatrices(l,i[o]),pX.toArray(s,o*16)}r!==null&&(r.needsUpdate=!0)}clone(){return new E3(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const i=new Float32Array(e*e*4);i.set(this.boneMatrices);const s=new rP(i,e,e,Hu,am);return s.needsUpdate=!0,this.boneMatrices=i,this.boneTexture=s,this}getBoneByName(e){for(let i=0,s=this.bones.length;i<s;i++){const r=this.bones[i];if(r.name===e)return r}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,i){this.uuid=e.uuid;for(let s=0,r=e.bones.length;s<r;s++){const o=e.bones[s];let a=i[o];a===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",o),a=new dX),this.bones.push(a),this.boneInverses.push(new ui().fromArray(e.boneInverses[s]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const i=this.bones,s=this.boneInverses;for(let r=0,o=i.length;r<o;r++){const a=i[r];e.bones.push(a.uuid);const l=s[r];e.boneInverses.push(l.toArray())}return e}}class oP extends qo{constructor(e,i,s,r=1){super(e,i,s),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Fg=new ui,mX=new ui,aS=[],fX=new Sl,hhe=new ui,ub=new $u,db=new Ml;class uhe extends $u{constructor(e,i,s){super(e,i),this.isInstancedMesh=!0,this.instanceMatrix=new oP(new Float32Array(s*16),16),this.instanceColor=null,this.morphTexture=null,this.count=s,this.boundingBox=null,this.boundingSphere=null;for(let r=0;r<s;r++)this.setMatrixAt(r,hhe)}computeBoundingBox(){const e=this.geometry,i=this.count;this.boundingBox===null&&(this.boundingBox=new Sl),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let s=0;s<i;s++)this.getMatrixAt(s,Fg),fX.copy(e.boundingBox).applyMatrix4(Fg),this.boundingBox.union(fX)}computeBoundingSphere(){const e=this.geometry,i=this.count;this.boundingSphere===null&&(this.boundingSphere=new Ml),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let s=0;s<i;s++)this.getMatrixAt(s,Fg),db.copy(e.boundingSphere).applyMatrix4(Fg),this.boundingSphere.union(db)}copy(e,i){return super.copy(e,i),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,i){i.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,i){i.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,i){const s=i.morphTargetInfluences,r=this.morphTexture.source.data.data,o=s.length+1,a=e*o+1;for(let l=0;l<s.length;l++)s[l]=r[a+l]}raycast(e,i){const s=this.matrixWorld,r=this.count;if(ub.geometry=this.geometry,ub.material=this.material,ub.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),db.copy(this.boundingSphere),db.applyMatrix4(s),e.ray.intersectsSphere(db)!==!1))for(let o=0;o<r;o++){this.getMatrixAt(o,Fg),mX.multiplyMatrices(s,Fg),ub.matrixWorld=mX,ub.raycast(e,aS);for(let a=0,l=aS.length;a<l;a++){const c=aS[a];c.instanceId=o,c.object=this,i.push(c)}aS.length=0}}setColorAt(e,i){this.instanceColor===null&&(this.instanceColor=new oP(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),i.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,i){i.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,i){const s=i.morphTargetInfluences,r=s.length+1;this.morphTexture===null&&(this.morphTexture=new rP(new Float32Array(r*this.count),r,this.count,xg,am));const o=this.morphTexture.source.data.data;let a=0;for(let h=0;h<s.length;h++)a+=s[h];const l=this.geometry.morphTargetsRelative?1:1-a,c=r*e;o[c]=l,o.set(s,c+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null),this}}class gX extends qu{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new is(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const lS=new me,cS=new me,yX=new ui,pb=new j_,hS=new Ml,aP=new me,vX=new me;class lP extends Kn{constructor(e=new Kl,i=new gX){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=i,this.updateMorphTargets()}copy(e,i){return super.copy(e,i),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const i=e.attributes.position,s=[0];for(let r=1,o=i.count;r<o;r++)lS.fromBufferAttribute(i,r-1),cS.fromBufferAttribute(i,r),s[r]=s[r-1],s[r]+=lS.distanceTo(cS);e.setAttribute("lineDistance",new JL(s,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,i){const s=this.geometry,r=this.matrixWorld,o=e.params.Line.threshold,a=s.drawRange;if(s.boundingSphere===null&&s.computeBoundingSphere(),hS.copy(s.boundingSphere),hS.applyMatrix4(r),hS.radius+=o,e.ray.intersectsSphere(hS)===!1)return;yX.copy(r).invert(),pb.copy(e.ray).applyMatrix4(yX);const l=o/((this.scale.x+this.scale.y+this.scale.z)/3),c=l*l,h=this.isLineSegments?2:1,u=s.index,d=s.attributes.position;if(u!==null){const m=Math.max(0,a.start),f=Math.min(u.count,a.start+a.count);for(let g=m,y=f-1;g<y;g+=h){const v=u.getX(g),b=u.getX(g+1),A=uS(this,e,pb,c,v,b);A&&i.push(A)}if(this.isLineLoop){const g=u.getX(f-1),y=u.getX(m),v=uS(this,e,pb,c,g,y);v&&i.push(v)}}else{const m=Math.max(0,a.start),f=Math.min(d.count,a.start+a.count);for(let g=m,y=f-1;g<y;g+=h){const v=uS(this,e,pb,c,g,g+1);v&&i.push(v)}if(this.isLineLoop){const g=uS(this,e,pb,c,f-1,m);g&&i.push(g)}}}updateMorphTargets(){const e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){const s=e[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=s.length;r<o;r++){const a=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}}function uS(n,e,i,s,r,o){const a=n.geometry.attributes.position;if(lS.fromBufferAttribute(a,r),cS.fromBufferAttribute(a,o),i.distanceSqToSegment(lS,cS,aP,vX)>s)return;aP.applyMatrix4(n.matrixWorld);const l=e.ray.origin.distanceTo(aP);if(!(l<e.near||l>e.far))return{distance:l,point:vX.clone().applyMatrix4(n.matrixWorld),index:r,face:null,faceIndex:null,object:n}}const bX=new me,AX=new me;class dhe extends lP{constructor(e,i){super(e,i),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const i=e.attributes.position,s=[];for(let r=0,o=i.count;r<o;r+=2)bX.fromBufferAttribute(i,r),AX.fromBufferAttribute(i,r+1),s[r]=r===0?0:s[r-1],s[r+1]=s[r]+bX.distanceTo(AX);e.setAttribute("lineDistance",new JL(s,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class phe extends lP{constructor(e,i){super(e,i),this.isLineLoop=!0,this.type="LineLoop"}}class xX extends qu{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new is(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const wX=new ui,cP=new j_,dS=new Ml,pS=new me;class mhe extends Kn{constructor(e=new Kl,i=new xX){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=i,this.updateMorphTargets()}copy(e,i){return super.copy(e,i),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,i){const s=this.geometry,r=this.matrixWorld,o=e.params.Points.threshold,a=s.drawRange;if(s.boundingSphere===null&&s.computeBoundingSphere(),dS.copy(s.boundingSphere),dS.applyMatrix4(r),dS.radius+=o,e.ray.intersectsSphere(dS)===!1)return;wX.copy(r).invert(),cP.copy(e.ray).applyMatrix4(wX);const l=o/((this.scale.x+this.scale.y+this.scale.z)/3),c=l*l,h=s.index,u=s.attributes.position;if(h!==null){const d=Math.max(0,a.start),m=Math.min(h.count,a.start+a.count);for(let f=d,g=m;f<g;f++){const y=h.getX(f);pS.fromBufferAttribute(u,y),_X(pS,y,c,r,e,i,this)}}else{const d=Math.max(0,a.start),m=Math.min(u.count,a.start+a.count);for(let f=d,g=m;f<g;f++)pS.fromBufferAttribute(u,f),_X(pS,f,c,r,e,i,this)}}updateMorphTargets(){const e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){const s=e[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=s.length;r<o;r++){const a=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}}function _X(n,e,i,s,r,o,a){const l=cP.distanceSqToPoint(n);if(l<i){const c=new me;cP.closestPointToPoint(n,c),c.applyMatrix4(s);const h=r.ray.origin.distanceTo(c);if(h<r.near||h>r.far)return;o.push({distance:h,distanceToRay:Math.sqrt(l),point:c,index:e,face:null,object:a})}}class mS extends Zs{constructor(e,i,s,r,o,a,l,c,h,u,d,m){super(null,a,l,c,h,u,r,o,d,m),this.isCompressedTexture=!0,this.image={width:i,height:s},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class fhe extends mS{constructor(e,i,s,r,o,a){super(e,i,s,o,a),this.isCompressedArrayTexture=!0,this.image.depth=r,this.wrapR=om,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class ghe extends mS{constructor(e,i,s){super(void 0,e[0].width,e[0].height,i,s,sce),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class fS extends qu{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new is(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new is(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=bce,this.normalScale=new Ln(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ny,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class uc extends fS{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Ln(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Br(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(i){this.ior=(1+.4*i)/(1-.4*i)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new is(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new is(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new is(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}function gS(n,e,i){return!n||!i&&n.constructor===e?n:typeof e.BYTES_PER_ELEMENT=="number"?new e(n):Array.prototype.slice.call(n)}function yhe(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function vhe(n){function e(r,o){return n[r]-n[o]}const i=n.length,s=new Array(i);for(let r=0;r!==i;++r)s[r]=r;return s.sort(e),s}function SX(n,e,i){const s=n.length,r=new n.constructor(s);for(let o=0,a=0;a!==s;++o){const l=i[o]*e;for(let c=0;c!==e;++c)r[a++]=n[l+c]}return r}function CX(n,e,i,s){let r=1,o=n[0];for(;o!==void 0&&o[s]===void 0;)o=n[r++];if(o===void 0)return;let a=o[s];if(a!==void 0)if(Array.isArray(a))do a=o[s],a!==void 0&&(e.push(o.time),i.push.apply(i,a)),o=n[r++];while(o!==void 0);else if(a.toArray!==void 0)do a=o[s],a!==void 0&&(e.push(o.time),a.toArray(i,i.length)),o=n[r++];while(o!==void 0);else do a=o[s],a!==void 0&&(e.push(o.time),i.push(a)),o=n[r++];while(o!==void 0)}class mb{constructor(e,i,s,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new i.constructor(s),this.sampleValues=i,this.valueSize=s,this.settings=null,this.DefaultSettings_={}}evaluate(e){const i=this.parameterPositions;let s=this._cachedIndex,r=i[s],o=i[s-1];e:{t:{let a;i:{n:if(!(e<r)){for(let l=s+2;;){if(r===void 0){if(e<o)break n;return s=i.length,this._cachedIndex=s,this.copySampleValue_(s-1)}if(s===l)break;if(o=r,r=i[++s],e<r)break t}a=i.length;break i}if(!(e>=o)){const l=i[1];e<l&&(s=2,o=l);for(let c=s-2;;){if(o===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(s===c)break;if(r=o,o=i[--s-1],e>=o)break t}a=s,s=0;break i}break e}for(;s<a;){const l=s+a>>>1;e<i[l]?a=l:s=l+1}if(r=i[s],o=i[s-1],o===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===void 0)return s=i.length,this._cachedIndex=s,this.copySampleValue_(s-1)}this._cachedIndex=s,this.intervalChanged_(s,o,r)}return this.interpolate_(s,o,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const i=this.resultBuffer,s=this.sampleValues,r=this.valueSize,o=e*r;for(let a=0;a!==r;++a)i[a]=s[o+a];return i}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class bhe extends mb{constructor(e,i,s,r){super(e,i,s,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:TV,endingEnd:TV}}intervalChanged_(e,i,s){const r=this.parameterPositions;let o=e-2,a=e+1,l=r[o],c=r[a];if(l===void 0)switch(this.getSettings_().endingStart){case RV:o=e,l=2*i-s;break;case IV:o=r.length-2,l=i+r[o]-r[o+1];break;default:o=e,l=s}if(c===void 0)switch(this.getSettings_().endingEnd){case RV:a=e,c=2*s-i;break;case IV:a=1,c=s+r[1]-r[0];break;default:a=e-1,c=i}const h=(s-i)*.5,u=this.valueSize;this._weightPrev=h/(i-l),this._weightNext=h/(c-s),this._offsetPrev=o*u,this._offsetNext=a*u}interpolate_(e,i,s,r){const o=this.resultBuffer,a=this.sampleValues,l=this.valueSize,c=e*l,h=c-l,u=this._offsetPrev,d=this._offsetNext,m=this._weightPrev,f=this._weightNext,g=(s-i)/(r-i),y=g*g,v=y*g,b=-m*v+2*m*y-m*g,A=(1+m)*v+(-1.5-2*m)*y+(-.5+m)*g+1,x=(-1-f)*v+(1.5+f)*y+.5*g,w=f*v-f*y;for(let _=0;_!==l;++_)o[_]=b*a[u+_]+A*a[h+_]+x*a[c+_]+w*a[d+_];return o}}class Ahe extends mb{constructor(e,i,s,r){super(e,i,s,r)}interpolate_(e,i,s,r){const o=this.resultBuffer,a=this.sampleValues,l=this.valueSize,c=e*l,h=c-l,u=(s-i)/(r-i),d=1-u;for(let m=0;m!==l;++m)o[m]=a[h+m]*d+a[c+m]*u;return o}}class xhe extends mb{constructor(e,i,s,r){super(e,i,s,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class dc{constructor(e,i,s,r){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(i===void 0||i.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=gS(i,this.TimeBufferType),this.values=gS(s,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const i=e.constructor;let s;if(i.toJSON!==this.toJSON)s=i.toJSON(e);else{s={name:e.name,times:gS(e.times,Array),values:gS(e.values,Array)};const r=e.getInterpolation();r!==e.DefaultInterpolation&&(s.interpolation=r)}return s.type=e.ValueTypeName,s}InterpolantFactoryMethodDiscrete(e){return new xhe(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Ahe(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new bhe(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let i;switch(e){case tb:i=this.InterpolantFactoryMethodDiscrete;break;case ib:i=this.InterpolantFactoryMethodLinear;break;case EL:i=this.InterpolantFactoryMethodSmooth;break}if(i===void 0){const s="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(s);return console.warn("THREE.KeyframeTrack:",s),this}return this.createInterpolant=i,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return tb;case this.InterpolantFactoryMethodLinear:return ib;case this.InterpolantFactoryMethodSmooth:return EL}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const i=this.times;for(let s=0,r=i.length;s!==r;++s)i[s]+=e}return this}scale(e){if(e!==1){const i=this.times;for(let s=0,r=i.length;s!==r;++s)i[s]*=e}return this}trim(e,i){const s=this.times,r=s.length;let o=0,a=r-1;for(;o!==r&&s[o]<e;)++o;for(;a!==-1&&s[a]>i;)--a;if(++a,o!==0||a!==r){o>=a&&(a=Math.max(a,1),o=a-1);const l=this.getValueSize();this.times=s.slice(o,a),this.values=this.values.slice(o*l,a*l)}return this}validate(){let e=!0;const i=this.getValueSize();i-Math.floor(i)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const s=this.times,r=this.values,o=s.length;o===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let l=0;l!==o;l++){const c=s[l];if(typeof c=="number"&&isNaN(c)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,l,c),e=!1;break}if(a!==null&&a>c){console.error("THREE.KeyframeTrack: Out of order keys.",this,l,c,a),e=!1;break}a=c}if(r!==void 0&&yhe(r))for(let l=0,c=r.length;l!==c;++l){const h=r[l];if(isNaN(h)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,l,h),e=!1;break}}return e}optimize(){const e=this.times.slice(),i=this.values.slice(),s=this.getValueSize(),r=this.getInterpolation()===EL,o=e.length-1;let a=1;for(let l=1;l<o;++l){let c=!1;const h=e[l],u=e[l+1];if(h!==u&&(l!==1||h!==e[0]))if(r)c=!0;else{const d=l*s,m=d-s,f=d+s;for(let g=0;g!==s;++g){const y=i[d+g];if(y!==i[m+g]||y!==i[f+g]){c=!0;break}}}if(c){if(l!==a){e[a]=e[l];const d=l*s,m=a*s;for(let f=0;f!==s;++f)i[m+f]=i[d+f]}++a}}if(o>0){e[a]=e[o];for(let l=o*s,c=a*s,h=0;h!==s;++h)i[c+h]=i[l+h];++a}return a!==e.length?(this.times=e.slice(0,a),this.values=i.slice(0,a*s)):(this.times=e,this.values=i),this}clone(){const e=this.times.slice(),i=this.values.slice(),s=this.constructor,r=new s(this.name,e,i);return r.createInterpolant=this.createInterpolant,r}}dc.prototype.TimeBufferType=Float32Array,dc.prototype.ValueBufferType=Float32Array,dc.prototype.DefaultInterpolation=ib;class Ng extends dc{constructor(e,i,s){super(e,i,s)}}Ng.prototype.ValueTypeName="bool",Ng.prototype.ValueBufferType=Array,Ng.prototype.DefaultInterpolation=tb,Ng.prototype.InterpolantFactoryMethodLinear=void 0,Ng.prototype.InterpolantFactoryMethodSmooth=void 0;class MX extends dc{}MX.prototype.ValueTypeName="color";class Ug extends dc{}Ug.prototype.ValueTypeName="number";class whe extends mb{constructor(e,i,s,r){super(e,i,s,r)}interpolate_(e,i,s,r){const o=this.resultBuffer,a=this.sampleValues,l=this.valueSize,c=(s-i)/(r-i);let h=e*l;for(let u=h+l;h!==u;h+=4)ju.slerpFlat(o,0,a,h-l,a,h,c);return o}}class Vg extends dc{InterpolantFactoryMethodLinear(e){return new whe(this.times,this.values,this.getValueSize(),e)}}Vg.prototype.ValueTypeName="quaternion",Vg.prototype.InterpolantFactoryMethodSmooth=void 0;class Xg extends dc{constructor(e,i,s){super(e,i,s)}}Xg.prototype.ValueTypeName="string",Xg.prototype.ValueBufferType=Array,Xg.prototype.DefaultInterpolation=tb,Xg.prototype.InterpolantFactoryMethodLinear=void 0,Xg.prototype.InterpolantFactoryMethodSmooth=void 0;class Wg extends dc{}Wg.prototype.ValueTypeName="vector";class _he{constructor(e="",i=-1,s=[],r=yce){this.name=e,this.tracks=s,this.duration=i,this.blendMode=r,this.uuid=wl(),this.duration<0&&this.resetDuration()}static parse(e){const i=[],s=e.tracks,r=1/(e.fps||1);for(let a=0,l=s.length;a!==l;++a)i.push(Che(s[a]).scale(r));const o=new this(e.name,e.duration,i,e.blendMode);return o.uuid=e.uuid,o}static toJSON(e){const i=[],s=e.tracks,r={name:e.name,duration:e.duration,tracks:i,uuid:e.uuid,blendMode:e.blendMode};for(let o=0,a=s.length;o!==a;++o)i.push(dc.toJSON(s[o]));return r}static CreateFromMorphTargetSequence(e,i,s,r){const o=i.length,a=[];for(let l=0;l<o;l++){let c=[],h=[];c.push((l+o-1)%o,l,(l+1)%o),h.push(0,1,0);const u=vhe(c);c=SX(c,1,u),h=SX(h,1,u),!r&&c[0]===0&&(c.push(o),h.push(h[0])),a.push(new Ug(".morphTargetInfluences["+i[l].name+"]",c,h).scale(1/s))}return new this(e,-1,a)}static findByName(e,i){let s=e;if(!Array.isArray(e)){const r=e;s=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<s.length;r++)if(s[r].name===i)return s[r];return null}static CreateClipsFromMorphTargetSequences(e,i,s){const r={},o=/^([\w-]*?)([\d]+)$/;for(let l=0,c=e.length;l<c;l++){const h=e[l],u=h.name.match(o);if(u&&u.length>1){const d=u[1];let m=r[d];m||(r[d]=m=[]),m.push(h)}}const a=[];for(const l in r)a.push(this.CreateFromMorphTargetSequence(l,r[l],i,s));return a}static parseAnimation(e,i){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const s=function(u,d,m,f,g){if(m.length!==0){const y=[],v=[];CX(m,y,v,f),y.length!==0&&g.push(new u(d,y,v))}},r=[],o=e.name||"default",a=e.fps||30,l=e.blendMode;let c=e.length||-1;const h=e.hierarchy||[];for(let u=0;u<h.length;u++){const d=h[u].keys;if(!(!d||d.length===0))if(d[0].morphTargets){const m={};let f;for(f=0;f<d.length;f++)if(d[f].morphTargets)for(let g=0;g<d[f].morphTargets.length;g++)m[d[f].morphTargets[g]]=-1;for(const g in m){const y=[],v=[];for(let b=0;b!==d[f].morphTargets.length;++b){const A=d[f];y.push(A.time),v.push(A.morphTarget===g?1:0)}r.push(new Ug(".morphTargetInfluence["+g+"]",y,v))}c=m.length*a}else{const m=".bones["+i[u].name+"]";s(Wg,m+".position",d,"pos",r),s(Vg,m+".quaternion",d,"rot",r),s(Wg,m+".scale",d,"scl",r)}}return r.length===0?null:new this(o,c,r,l)}resetDuration(){const e=this.tracks;let i=0;for(let s=0,r=e.length;s!==r;++s){const o=this.tracks[s];i=Math.max(i,o.times[o.times.length-1])}return this.duration=i,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let i=0;i<this.tracks.length;i++)e=e&&this.tracks[i].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let i=0;i<this.tracks.length;i++)e.push(this.tracks[i].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function She(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Ug;case"vector":case"vector2":case"vector3":case"vector4":return Wg;case"color":return MX;case"quaternion":return Vg;case"bool":case"boolean":return Ng;case"string":return Xg}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}function Che(n){if(n.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=She(n.type);if(n.times===void 0){const i=[],s=[];CX(n.keys,i,s,"value"),n.times=i,n.values=s}return e.parse!==void 0?e.parse(n):new e(n.name,n.times,n.values,n.interpolation)}const td={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class Mhe{constructor(e,i,s){const r=this;let o=!1,a=0,l=0,c;const h=[];this.onStart=void 0,this.onLoad=e,this.onProgress=i,this.onError=s,this.itemStart=function(u){l++,o===!1&&r.onStart!==void 0&&r.onStart(u,a,l),o=!0},this.itemEnd=function(u){a++,r.onProgress!==void 0&&r.onProgress(u,a,l),a===l&&(o=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(u){r.onError!==void 0&&r.onError(u)},this.resolveURL=function(u){return c?c(u):u},this.setURLModifier=function(u){return c=u,this},this.addHandler=function(u,d){return h.push(u,d),this},this.removeHandler=function(u){const d=h.indexOf(u);return d!==-1&&h.splice(d,2),this},this.getHandler=function(u){for(let d=0,m=h.length;d<m;d+=2){const f=h[d],g=h[d+1];if(f.global&&(f.lastIndex=0),f.test(u))return g}return null}}}const Ehe=new Mhe;class id{constructor(e){this.manager=e!==void 0?e:Ehe,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,i){const s=this;return new Promise(function(r,o){s.load(e,r,i,o)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}id.DEFAULT_MATERIAL_NAME="__DEFAULT";const Rh={};class The extends Error{constructor(e,i){super(e),this.response=i}}class pm extends id{constructor(e){super(e)}load(e,i,s,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=td.get(e);if(o!==void 0)return this.manager.itemStart(e),setTimeout(()=>{i&&i(o),this.manager.itemEnd(e)},0),o;if(Rh[e]!==void 0){Rh[e].push({onLoad:i,onProgress:s,onError:r});return}Rh[e]=[],Rh[e].push({onLoad:i,onProgress:s,onError:r});const a=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),l=this.mimeType,c=this.responseType;fetch(a).then(h=>{if(h.status===200||h.status===0){if(h.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||h.body===void 0||h.body.getReader===void 0)return h;const u=Rh[e],d=h.body.getReader(),m=h.headers.get("X-File-Size")||h.headers.get("Content-Length"),f=m?parseInt(m):0,g=f!==0;let y=0;const v=new ReadableStream({start(b){A();function A(){d.read().then(({done:x,value:w})=>{if(x)b.close();else{y+=w.byteLength;const _=new ProgressEvent("progress",{lengthComputable:g,loaded:y,total:f});for(let S=0,M=u.length;S<M;S++){const R=u[S];R.onProgress&&R.onProgress(_)}b.enqueue(w),A()}},x=>{b.error(x)})}}});return new Response(v)}else throw new The(`fetch for "${h.url}" responded with ${h.status}: ${h.statusText}`,h)}).then(h=>{switch(c){case"arraybuffer":return h.arrayBuffer();case"blob":return h.blob();case"document":return h.text().then(u=>new DOMParser().parseFromString(u,l));case"json":return h.json();default:if(l===void 0)return h.text();{const u=/charset="?([^;"\s]*)"?/i.exec(l),d=u&&u[1]?u[1].toLowerCase():void 0,m=new TextDecoder(d);return h.arrayBuffer().then(f=>m.decode(f))}}}).then(h=>{td.add(e,h);const u=Rh[e];delete Rh[e];for(let d=0,m=u.length;d<m;d++){const f=u[d];f.onLoad&&f.onLoad(h)}}).catch(h=>{const u=Rh[e];if(u===void 0)throw this.manager.itemError(e),h;delete Rh[e];for(let d=0,m=u.length;d<m;d++){const f=u[d];f.onError&&f.onError(h)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class Rhe extends id{constructor(e){super(e)}load(e,i,s,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,a=td.get(e);if(a!==void 0)return o.manager.itemStart(e),setTimeout(function(){i&&i(a),o.manager.itemEnd(e)},0),a;const l=OL("img");function c(){u(),td.add(e,this),i&&i(this),o.manager.itemEnd(e)}function h(d){u(),r&&r(d),o.manager.itemError(e),o.manager.itemEnd(e)}function u(){l.removeEventListener("load",c,!1),l.removeEventListener("error",h,!1)}return l.addEventListener("load",c,!1),l.addEventListener("error",h,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(l.crossOrigin=this.crossOrigin),o.manager.itemStart(e),l.src=e,l}}class EX extends id{constructor(e){super(e)}load(e,i,s,r){const o=new Zs,a=new Rhe(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(l){o.image=l,o.needsUpdate=!0,i!==void 0&&i(o)},s,r),o}}let hP=class extends Kn{constructor(n,e=1){super(),this.isLight=!0,this.type="Light",this.color=new is(n),this.intensity=e}dispose(){}copy(n,e){return super.copy(n,e),this.color.copy(n.color),this.intensity=n.intensity,this}toJSON(n){const e=super.toJSON(n);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,this.groundColor!==void 0&&(e.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(e.object.distance=this.distance),this.angle!==void 0&&(e.object.angle=this.angle),this.decay!==void 0&&(e.object.decay=this.decay),this.penumbra!==void 0&&(e.object.penumbra=this.penumbra),this.shadow!==void 0&&(e.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(e.object.target=this.target.uuid),e}};const uP=new ui,TX=new me,RX=new me;class dP{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Ln(512,512),this.map=null,this.mapPass=null,this.matrix=new ui,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new rhe,this._frameExtents=new Ln(1,1),this._viewportCount=1,this._viewports=[new ll(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const i=this.camera,s=this.matrix;TX.setFromMatrixPosition(e.matrixWorld),i.position.copy(TX),RX.setFromMatrixPosition(e.target.matrixWorld),i.lookAt(RX),i.updateMatrixWorld(),uP.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(uP),s.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),s.multiply(uP)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class Ihe extends dP{constructor(){super(new eP(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const i=this.camera,s=sb*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,o=e.distance||i.far;(s!==i.fov||r!==i.aspect||o!==i.far)&&(i.fov=s,i.aspect=r,i.far=o,i.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class Lhe extends hP{constructor(e,i,s=0,r=Math.PI/3,o=0,a=2){super(e,i),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Kn.DEFAULT_UP),this.updateMatrix(),this.target=new Kn,this.distance=s,this.angle=r,this.penumbra=o,this.decay=a,this.map=null,this.shadow=new Ihe}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,i){return super.copy(e,i),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const IX=new ui,fb=new me,pP=new me;class Phe extends dP{constructor(){super(new eP(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Ln(4,2),this._viewportCount=6,this._viewports=[new ll(2,1,1,1),new ll(0,1,1,1),new ll(3,1,1,1),new ll(1,1,1,1),new ll(3,0,1,1),new ll(1,0,1,1)],this._cubeDirections=[new me(1,0,0),new me(-1,0,0),new me(0,0,1),new me(0,0,-1),new me(0,1,0),new me(0,-1,0)],this._cubeUps=[new me(0,1,0),new me(0,1,0),new me(0,1,0),new me(0,1,0),new me(0,0,1),new me(0,0,-1)]}updateMatrices(e,i=0){const s=this.camera,r=this.matrix,o=e.distance||s.far;o!==s.far&&(s.far=o,s.updateProjectionMatrix()),fb.setFromMatrixPosition(e.matrixWorld),s.position.copy(fb),pP.copy(s.position),pP.add(this._cubeDirections[i]),s.up.copy(this._cubeUps[i]),s.lookAt(pP),s.updateMatrixWorld(),r.makeTranslation(-fb.x,-fb.y,-fb.z),IX.multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse),this._frustum.setFromProjectionMatrix(IX)}}class Bhe extends hP{constructor(e,i,s=0,r=2){super(e,i),this.isPointLight=!0,this.type="PointLight",this.distance=s,this.decay=r,this.shadow=new Phe}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,i){return super.copy(e,i),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class khe extends dP{constructor(){super(new oX(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Dhe extends hP{constructor(e,i){super(e,i),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Kn.DEFAULT_UP),this.updateMatrix(),this.target=new Kn,this.shadow=new khe}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class gb{static decodeText(e){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),typeof TextDecoder<"u")return new TextDecoder().decode(e);let i="";for(let s=0,r=e.length;s<r;s++)i+=String.fromCharCode(e[s]);try{return decodeURIComponent(escape(i))}catch{return i}}static extractUrlBase(e){const i=e.lastIndexOf("/");return i===-1?"./":e.slice(0,i+1)}static resolveURL(e,i){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(i)&&/^\//.test(e)&&(i=i.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:i+e)}}class Ohe extends id{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,i,s,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,a=td.get(e);if(a!==void 0){if(o.manager.itemStart(e),a.then){a.then(h=>{i&&i(h),o.manager.itemEnd(e)}).catch(h=>{r&&r(h)});return}return setTimeout(function(){i&&i(a),o.manager.itemEnd(e)},0),a}const l={};l.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",l.headers=this.requestHeader;const c=fetch(e,l).then(function(h){return h.blob()}).then(function(h){return createImageBitmap(h,Object.assign(o.options,{colorSpaceConversion:"none"}))}).then(function(h){return td.add(e,h),i&&i(h),o.manager.itemEnd(e),h}).catch(function(h){r&&r(h),td.remove(e),o.manager.itemError(e),o.manager.itemEnd(e)});td.add(e,c),o.manager.itemStart(e)}}class Ghe{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=LX(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const i=LX();e=(i-this.oldTime)/1e3,this.oldTime=i,this.elapsedTime+=e}return e}}function LX(){return(typeof performance>"u"?Date:performance).now()}const mP="\\[\\]\\.:\\/",zhe=new RegExp("["+mP+"]","g"),fP="[^"+mP+"]",Fhe="[^"+mP.replace("\\.","")+"]",Nhe=/((?:WC+[\/:])*)/.source.replace("WC",fP),Uhe=/(WCOD+)?/.source.replace("WCOD",Fhe),Vhe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",fP),Xhe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",fP),Whe=new RegExp("^"+Nhe+Uhe+Vhe+Xhe+"$"),Hhe=["material","materials","bones","map"];class jhe{constructor(e,i,s){const r=s||Oi.parseTrackName(i);this._targetGroup=e,this._bindings=e.subscribe_(i,r)}getValue(e,i){this.bind();const s=this._targetGroup.nCachedObjects_,r=this._bindings[s];r!==void 0&&r.getValue(e,i)}setValue(e,i){const s=this._bindings;for(let r=this._targetGroup.nCachedObjects_,o=s.length;r!==o;++r)s[r].setValue(e,i)}bind(){const e=this._bindings;for(let i=this._targetGroup.nCachedObjects_,s=e.length;i!==s;++i)e[i].bind()}unbind(){const e=this._bindings;for(let i=this._targetGroup.nCachedObjects_,s=e.length;i!==s;++i)e[i].unbind()}}class Oi{constructor(e,i,s){this.path=i,this.parsedPath=s||Oi.parseTrackName(i),this.node=Oi.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,i,s){return e&&e.isAnimationObjectGroup?new Oi.Composite(e,i,s):new Oi(e,i,s)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(zhe,"")}static parseTrackName(e){const i=Whe.exec(e);if(i===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const s={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]},r=s.nodeName&&s.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){const o=s.nodeName.substring(r+1);Hhe.indexOf(o)!==-1&&(s.nodeName=s.nodeName.substring(0,r),s.objectName=o)}if(s.propertyName===null||s.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return s}static findNode(e,i){if(i===void 0||i===""||i==="."||i===-1||i===e.name||i===e.uuid)return e;if(e.skeleton){const s=e.skeleton.getBoneByName(i);if(s!==void 0)return s}if(e.children){const s=function(o){for(let a=0;a<o.length;a++){const l=o[a];if(l.name===i||l.uuid===i)return l;const c=s(l.children);if(c)return c}return null},r=s(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,i){e[i]=this.targetObject[this.propertyName]}_getValue_array(e,i){const s=this.resolvedProperty;for(let r=0,o=s.length;r!==o;++r)e[i++]=s[r]}_getValue_arrayElement(e,i){e[i]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,i){this.resolvedProperty.toArray(e,i)}_setValue_direct(e,i){this.targetObject[this.propertyName]=e[i]}_setValue_direct_setNeedsUpdate(e,i){this.targetObject[this.propertyName]=e[i],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,i){this.targetObject[this.propertyName]=e[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,i){const s=this.resolvedProperty;for(let r=0,o=s.length;r!==o;++r)s[r]=e[i++]}_setValue_array_setNeedsUpdate(e,i){const s=this.resolvedProperty;for(let r=0,o=s.length;r!==o;++r)s[r]=e[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,i){const s=this.resolvedProperty;for(let r=0,o=s.length;r!==o;++r)s[r]=e[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,i){this.resolvedProperty[this.propertyIndex]=e[i]}_setValue_arrayElement_setNeedsUpdate(e,i){this.resolvedProperty[this.propertyIndex]=e[i],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,i){this.resolvedProperty[this.propertyIndex]=e[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,i){this.resolvedProperty.fromArray(e,i)}_setValue_fromArray_setNeedsUpdate(e,i){this.resolvedProperty.fromArray(e,i),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,i){this.resolvedProperty.fromArray(e,i),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,i){this.bind(),this.getValue(e,i)}_setValue_unbound(e,i){this.bind(),this.setValue(e,i)}bind(){let e=this.node;const i=this.parsedPath,s=i.objectName,r=i.propertyName;let o=i.propertyIndex;if(e||(e=Oi.findNode(this.rootNode,i.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(s){let h=i.objectIndex;switch(s){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let u=0;u<e.length;u++)if(e[u].name===h){h=u;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[s]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[s]}if(h!==void 0){if(e[h]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[h]}}const a=e[r];if(a===void 0){const h=i.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+h+"."+r+" but it wasn't found.",e);return}let l=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?l=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(l=this.Versioning.MatrixWorldNeedsUpdate);let c=this.BindingType.Direct;if(o!==void 0){if(r==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[o]!==void 0&&(o=e.morphTargetDictionary[o])}c=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=o}else a.fromArray!==void 0&&a.toArray!==void 0?(c=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(c=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=r;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][l]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Oi.Composite=jhe,Oi.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Oi.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Oi.prototype.GetterByBindingType=[Oi.prototype._getValue_direct,Oi.prototype._getValue_array,Oi.prototype._getValue_arrayElement,Oi.prototype._getValue_toArray],Oi.prototype.SetterByBindingTypeAndVersioning=[[Oi.prototype._setValue_direct,Oi.prototype._setValue_direct_setNeedsUpdate,Oi.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Oi.prototype._setValue_array,Oi.prototype._setValue_array_setNeedsUpdate,Oi.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Oi.prototype._setValue_arrayElement,Oi.prototype._setValue_arrayElement_setNeedsUpdate,Oi.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Oi.prototype._setValue_fromArray,Oi.prototype._setValue_fromArray_setNeedsUpdate,Oi.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]],typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:bV}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=bV);function PX(n,e){if(e===vce)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),n;if(e===TL||e===LV){let i=n.getIndex();if(i===null){const a=[],l=n.getAttribute("position");if(l!==void 0){for(let c=0;c<l.count;c++)a.push(c);n.setIndex(a),i=n.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}const s=i.count-2,r=[];if(e===TL)for(let a=1;a<=s;a++)r.push(i.getX(0)),r.push(i.getX(a)),r.push(i.getX(a+1));else for(let a=0;a<s;a++)a%2===0?(r.push(i.getX(a)),r.push(i.getX(a+1)),r.push(i.getX(a+2))):(r.push(i.getX(a+2)),r.push(i.getX(a+1)),r.push(i.getX(a)));r.length/3!==s&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=n.clone();return o.setIndex(r),o.clearGroups(),o}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),n}let Qhe=class extends id{constructor(n){super(n),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new qhe(e)}),this.register(function(e){return new $he(e)}),this.register(function(e){return new lue(e)}),this.register(function(e){return new cue(e)}),this.register(function(e){return new hue(e)}),this.register(function(e){return new tue(e)}),this.register(function(e){return new iue(e)}),this.register(function(e){return new nue(e)}),this.register(function(e){return new sue(e)}),this.register(function(e){return new Jhe(e)}),this.register(function(e){return new rue(e)}),this.register(function(e){return new eue(e)}),this.register(function(e){return new aue(e)}),this.register(function(e){return new oue(e)}),this.register(function(e){return new Yhe(e)}),this.register(function(e){return new uue(e)}),this.register(function(e){return new due(e)})}load(n,e,i,s){const r=this;let o;if(this.resourcePath!=="")o=this.resourcePath;else if(this.path!==""){const c=gb.extractUrlBase(n);o=gb.resolveURL(c,this.path)}else o=gb.extractUrlBase(n);this.manager.itemStart(n);const a=function(c){s?s(c):console.error(c),r.manager.itemError(n),r.manager.itemEnd(n)},l=new pm(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(n,function(c){try{r.parse(c,o,function(h){e(h),r.manager.itemEnd(n)},a)}catch(h){a(h)}},i,a)}setDRACOLoader(n){return this.dracoLoader=n,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(n){return this.ktx2Loader=n,this}setMeshoptDecoder(n){return this.meshoptDecoder=n,this}register(n){return this.pluginCallbacks.indexOf(n)===-1&&this.pluginCallbacks.push(n),this}unregister(n){return this.pluginCallbacks.indexOf(n)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(n),1),this}parse(n,e,i,s){let r;const o={},a={},l=new TextDecoder;if(typeof n=="string")r=JSON.parse(n);else if(n instanceof ArrayBuffer)if(l.decode(new Uint8Array(n,0,4))===BX){try{o[ci.KHR_BINARY_GLTF]=new pue(n)}catch(h){s&&s(h);return}r=JSON.parse(o[ci.KHR_BINARY_GLTF].content)}else r=JSON.parse(l.decode(n));else r=n;if(r.asset===void 0||r.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const c=new Mue(r,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){const u=this.pluginCallbacks[h](c);u.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[u.name]=u,o[u.name]=!0}if(r.extensionsUsed)for(let h=0;h<r.extensionsUsed.length;++h){const u=r.extensionsUsed[h],d=r.extensionsRequired||[];switch(u){case ci.KHR_MATERIALS_UNLIT:o[u]=new Khe;break;case ci.KHR_DRACO_MESH_COMPRESSION:o[u]=new mue(r,this.dracoLoader);break;case ci.KHR_TEXTURE_TRANSFORM:o[u]=new fue;break;case ci.KHR_MESH_QUANTIZATION:o[u]=new gue;break;default:d.indexOf(u)>=0&&a[u]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}c.setExtensions(o),c.setPlugins(a),c.parse(i,s)}parseAsync(n,e){const i=this;return new Promise(function(s,r){i.parse(n,e,s,r)})}};function Zhe(){let n={};return{get:function(e){return n[e]},add:function(e,i){n[e]=i},remove:function(e){delete n[e]},removeAll:function(){n={}}}}const ci={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};let Yhe=class{constructor(n){this.parser=n,this.name=ci.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const n=this.parser,e=this.parser.json.nodes||[];for(let i=0,s=e.length;i<s;i++){const r=e[i];r.extensions&&r.extensions[this.name]&&r.extensions[this.name].light!==void 0&&n._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(n){const e=this.parser,i="light:"+n;let s=e.cache.get(i);if(s)return s;const r=e.json,o=((r.extensions&&r.extensions[this.name]||{}).lights||[])[n];let a;const l=new is(16777215);o.color!==void 0&&l.setRGB(o.color[0],o.color[1],o.color[2],Io);const c=o.range!==void 0?o.range:0;switch(o.type){case"directional":a=new Dhe(l),a.target.position.set(0,0,-1),a.add(a.target);break;case"point":a=new Bhe(l),a.distance=c;break;case"spot":a=new Lhe(l),a.distance=c,o.spot=o.spot||{},o.spot.innerConeAngle=o.spot.innerConeAngle!==void 0?o.spot.innerConeAngle:0,o.spot.outerConeAngle=o.spot.outerConeAngle!==void 0?o.spot.outerConeAngle:Math.PI/4,a.angle=o.spot.outerConeAngle,a.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,a.target.position.set(0,0,-1),a.add(a.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return a.position.set(0,0,0),a.decay=2,Ih(a,o),o.intensity!==void 0&&(a.intensity=o.intensity),a.name=e.createUniqueName(o.name||"light_"+n),s=Promise.resolve(a),e.cache.add(i,s),s}getDependency(n,e){if(n==="light")return this._loadLight(e)}createNodeAttachment(n){const e=this,i=this.parser,s=i.json.nodes[n],r=(s.extensions&&s.extensions[this.name]||{}).light;return r===void 0?null:this._loadLight(r).then(function(o){return i._getNodeRef(e.cache,r,o)})}},Khe=class{constructor(){this.name=ci.KHR_MATERIALS_UNLIT}getMaterialType(){return Bg}extendParams(n,e,i){const s=[];n.color=new is(1,1,1),n.opacity=1;const r=e.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const o=r.baseColorFactor;n.color.setRGB(o[0],o[1],o[2],Io),n.opacity=o[3]}r.baseColorTexture!==void 0&&s.push(i.assignTexture(n,"map",r.baseColorTexture,Lr))}return Promise.all(s)}},Jhe=class{constructor(n){this.parser=n,this.name=ci.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(n,e){const i=this.parser.json.materials[n];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name].emissiveStrength;return s!==void 0&&(e.emissiveIntensity=s),Promise.resolve()}},qhe=class{constructor(n){this.parser=n,this.name=ci.KHR_MATERIALS_CLEARCOAT}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:uc}extendMaterialParams(n,e){const i=this.parser,s=i.json.materials[n];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];if(o.clearcoatFactor!==void 0&&(e.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&r.push(i.assignTexture(e,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(e.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&r.push(i.assignTexture(e,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(r.push(i.assignTexture(e,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const a=o.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new Ln(a,a)}return Promise.all(r)}};class $he{constructor(e){this.parser=e,this.name=ci.KHR_MATERIALS_DISPERSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:uc}extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name];return i.dispersion=r.dispersion!==void 0?r.dispersion:0,Promise.resolve()}}let eue=class{constructor(n){this.parser=n,this.name=ci.KHR_MATERIALS_IRIDESCENCE}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:uc}extendMaterialParams(n,e){const i=this.parser,s=i.json.materials[n];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.iridescenceFactor!==void 0&&(e.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&r.push(i.assignTexture(e,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(e.iridescenceIOR=o.iridescenceIor),e.iridescenceThicknessRange===void 0&&(e.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(e.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(e.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&r.push(i.assignTexture(e,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(r)}},tue=class{constructor(n){this.parser=n,this.name=ci.KHR_MATERIALS_SHEEN}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:uc}extendMaterialParams(n,e){const i=this.parser,s=i.json.materials[n];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[];e.sheenColor=new is(0,0,0),e.sheenRoughness=0,e.sheen=1;const o=s.extensions[this.name];if(o.sheenColorFactor!==void 0){const a=o.sheenColorFactor;e.sheenColor.setRGB(a[0],a[1],a[2],Io)}return o.sheenRoughnessFactor!==void 0&&(e.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&r.push(i.assignTexture(e,"sheenColorMap",o.sheenColorTexture,Lr)),o.sheenRoughnessTexture!==void 0&&r.push(i.assignTexture(e,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(r)}},iue=class{constructor(n){this.parser=n,this.name=ci.KHR_MATERIALS_TRANSMISSION}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:uc}extendMaterialParams(n,e){const i=this.parser,s=i.json.materials[n];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.transmissionFactor!==void 0&&(e.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&r.push(i.assignTexture(e,"transmissionMap",o.transmissionTexture)),Promise.all(r)}},nue=class{constructor(n){this.parser=n,this.name=ci.KHR_MATERIALS_VOLUME}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:uc}extendMaterialParams(n,e){const i=this.parser,s=i.json.materials[n];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];e.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&r.push(i.assignTexture(e,"thicknessMap",o.thicknessTexture)),e.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return e.attenuationColor=new is().setRGB(a[0],a[1],a[2],Io),Promise.all(r)}},sue=class{constructor(n){this.parser=n,this.name=ci.KHR_MATERIALS_IOR}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:uc}extendMaterialParams(n,e){const i=this.parser.json.materials[n];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name];return e.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}},rue=class{constructor(n){this.parser=n,this.name=ci.KHR_MATERIALS_SPECULAR}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:uc}extendMaterialParams(n,e){const i=this.parser,s=i.json.materials[n];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];e.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&r.push(i.assignTexture(e,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return e.specularColor=new is().setRGB(a[0],a[1],a[2],Io),o.specularColorTexture!==void 0&&r.push(i.assignTexture(e,"specularColorMap",o.specularColorTexture,Lr)),Promise.all(r)}},oue=class{constructor(n){this.parser=n,this.name=ci.EXT_MATERIALS_BUMP}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:uc}extendMaterialParams(n,e){const i=this.parser,s=i.json.materials[n];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return e.bumpScale=o.bumpFactor!==void 0?o.bumpFactor:1,o.bumpTexture!==void 0&&r.push(i.assignTexture(e,"bumpMap",o.bumpTexture)),Promise.all(r)}},aue=class{constructor(n){this.parser=n,this.name=ci.KHR_MATERIALS_ANISOTROPY}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:uc}extendMaterialParams(n,e){const i=this.parser,s=i.json.materials[n];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.anisotropyStrength!==void 0&&(e.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(e.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&r.push(i.assignTexture(e,"anisotropyMap",o.anisotropyTexture)),Promise.all(r)}},lue=class{constructor(n){this.parser=n,this.name=ci.KHR_TEXTURE_BASISU}loadTexture(n){const e=this.parser,i=e.json,s=i.textures[n];if(!s.extensions||!s.extensions[this.name])return null;const r=s.extensions[this.name],o=e.options.ktx2Loader;if(!o){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(n,r.source,o)}},cue=class{constructor(n){this.parser=n,this.name=ci.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(n){const e=this.name,i=this.parser,s=i.json,r=s.textures[n];if(!r.extensions||!r.extensions[e])return null;const o=r.extensions[e],a=s.images[o.source];let l=i.textureLoader;if(a.uri){const c=i.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(n,o.source,l);if(s.extensionsRequired&&s.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(n)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(n){const e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){n(e.height===1)}})),this.isSupported}},hue=class{constructor(n){this.parser=n,this.name=ci.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(n){const e=this.name,i=this.parser,s=i.json,r=s.textures[n];if(!r.extensions||!r.extensions[e])return null;const o=r.extensions[e],a=s.images[o.source];let l=i.textureLoader;if(a.uri){const c=i.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(n,o.source,l);if(s.extensionsRequired&&s.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(n)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(n){const e=new Image;e.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",e.onload=e.onerror=function(){n(e.height===1)}})),this.isSupported}},uue=class{constructor(n){this.name=ci.EXT_MESHOPT_COMPRESSION,this.parser=n}loadBufferView(n){const e=this.parser.json,i=e.bufferViews[n];if(i.extensions&&i.extensions[this.name]){const s=i.extensions[this.name],r=this.parser.getDependency("buffer",s.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then(function(a){const l=s.byteOffset||0,c=s.byteLength||0,h=s.count,u=s.byteStride,d=new Uint8Array(a,l,c);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(h,u,d,s.mode,s.filter).then(function(m){return m.buffer}):o.ready.then(function(){const m=new ArrayBuffer(h*u);return o.decodeGltfBuffer(new Uint8Array(m),h,u,d,s.mode,s.filter),m})})}else return null}},due=class{constructor(n){this.name=ci.EXT_MESH_GPU_INSTANCING,this.parser=n}createNodeMesh(n){const e=this.parser.json,i=e.nodes[n];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const s=e.meshes[i.mesh];for(const l of s.primitives)if(l.mode!==za.TRIANGLES&&l.mode!==za.TRIANGLE_STRIP&&l.mode!==za.TRIANGLE_FAN&&l.mode!==void 0)return null;const r=i.extensions[this.name].attributes,o=[],a={};for(const l in r)o.push(this.parser.getDependency("accessor",r[l]).then(c=>(a[l]=c,a[l])));return o.length<1?null:(o.push(this.parser.createNodeMesh(n)),Promise.all(o).then(l=>{const c=l.pop(),h=c.isGroup?c.children:[c],u=l[0].count,d=[];for(const m of h){const f=new ui,g=new me,y=new ju,v=new me(1,1,1),b=new uhe(m.geometry,m.material,u);for(let A=0;A<u;A++)a.TRANSLATION&&g.fromBufferAttribute(a.TRANSLATION,A),a.ROTATION&&y.fromBufferAttribute(a.ROTATION,A),a.SCALE&&v.fromBufferAttribute(a.SCALE,A),b.setMatrixAt(A,f.compose(g,y,v));for(const A in a)if(A==="_COLOR_0"){const x=a[A];b.instanceColor=new oP(x.array,x.itemSize,x.normalized)}else A!=="TRANSLATION"&&A!=="ROTATION"&&A!=="SCALE"&&m.geometry.setAttribute(A,a[A]);Kn.prototype.copy.call(b,m),this.parser.assignFinalMaterial(b),d.push(b)}return c.isGroup?(c.clear(),c.add(...d),c):d[0]}))}};const BX="glTF",yb=12,kX={JSON:1313821514,BIN:5130562};let pue=class{constructor(n){this.name=ci.KHR_BINARY_GLTF,this.content=null,this.body=null;const e=new DataView(n,0,yb),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(n.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==BX)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-yb,r=new DataView(n,yb);let o=0;for(;o<s;){const a=r.getUint32(o,!0);o+=4;const l=r.getUint32(o,!0);if(o+=4,l===kX.JSON){const c=new Uint8Array(n,yb+o,a);this.content=i.decode(c)}else if(l===kX.BIN){const c=yb+o;this.body=n.slice(c,c+a)}o+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}},mue=class{constructor(n,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=ci.KHR_DRACO_MESH_COMPRESSION,this.json=n,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(n,e){const i=this.json,s=this.dracoLoader,r=n.extensions[this.name].bufferView,o=n.extensions[this.name].attributes,a={},l={},c={};for(const h in o){const u=yP[h]||h.toLowerCase();a[u]=o[h]}for(const h in n.attributes){const u=yP[h]||h.toLowerCase();if(o[h]!==void 0){const d=i.accessors[n.attributes[h]],m=Hg[d.componentType];c[u]=m.name,l[u]=d.normalized===!0}}return e.getDependency("bufferView",r).then(function(h){return new Promise(function(u,d){s.decodeDracoFile(h,function(m){for(const f in m.attributes){const g=m.attributes[f],y=l[f];y!==void 0&&(g.normalized=y)}u(m)},a,c,Io,d)})})}},fue=class{constructor(){this.name=ci.KHR_TEXTURE_TRANSFORM}extendTexture(n,e){return(e.texCoord===void 0||e.texCoord===n.channel)&&e.offset===void 0&&e.rotation===void 0&&e.scale===void 0||(n=n.clone(),e.texCoord!==void 0&&(n.channel=e.texCoord),e.offset!==void 0&&n.offset.fromArray(e.offset),e.rotation!==void 0&&(n.rotation=e.rotation),e.scale!==void 0&&n.repeat.fromArray(e.scale),n.needsUpdate=!0),n}},gue=class{constructor(){this.name=ci.KHR_MESH_QUANTIZATION}},DX=class extends mb{constructor(n,e,i,s){super(n,e,i,s)}copySampleValue_(n){const e=this.resultBuffer,i=this.sampleValues,s=this.valueSize,r=n*s*3+s;for(let o=0;o!==s;o++)e[o]=i[r+o];return e}interpolate_(n,e,i,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=a*2,c=a*3,h=s-e,u=(i-e)/h,d=u*u,m=d*u,f=n*c,g=f-c,y=-2*m+3*d,v=m-d,b=1-y,A=v-d+u;for(let x=0;x!==a;x++){const w=o[g+x+a],_=o[g+x+l]*h,S=o[f+x+a],M=o[f+x]*h;r[x]=b*w+A*_+y*S+v*M}return r}};const yue=new ju;let vue=class extends DX{interpolate_(n,e,i,s){const r=super.interpolate_(n,e,i,s);return yue.fromArray(r).normalize().toArray(r),r}};const za={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Hg={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},OX={9728:qv,9729:$v,9984:rce,9985:ace,9986:oce,9987:z_},GX={33071:om,33648:ML,10497:Jv},gP={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},yP={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},nd={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},bue={CUBICSPLINE:void 0,LINEAR:ib,STEP:tb},vP={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Aue(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new fS({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:G_})),n.DefaultMaterial}function mm(n,e,i){for(const s in i.extensions)n[s]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[s]=i.extensions[s])}function Ih(n,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(n.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function xue(n,e,i){let s=!1,r=!1,o=!1;for(let h=0,u=e.length;h<u;h++){const d=e[h];if(d.POSITION!==void 0&&(s=!0),d.NORMAL!==void 0&&(r=!0),d.COLOR_0!==void 0&&(o=!0),s&&r&&o)break}if(!s&&!r&&!o)return Promise.resolve(n);const a=[],l=[],c=[];for(let h=0,u=e.length;h<u;h++){const d=e[h];if(s){const m=d.POSITION!==void 0?i.getDependency("accessor",d.POSITION):n.attributes.position;a.push(m)}if(r){const m=d.NORMAL!==void 0?i.getDependency("accessor",d.NORMAL):n.attributes.normal;l.push(m)}if(o){const m=d.COLOR_0!==void 0?i.getDependency("accessor",d.COLOR_0):n.attributes.color;c.push(m)}}return Promise.all([Promise.all(a),Promise.all(l),Promise.all(c)]).then(function(h){const u=h[0],d=h[1],m=h[2];return s&&(n.morphAttributes.position=u),r&&(n.morphAttributes.normal=d),o&&(n.morphAttributes.color=m),n.morphTargetsRelative=!0,n})}function wue(n,e){if(n.updateMorphTargets(),e.weights!==void 0)for(let i=0,s=e.weights.length;i<s;i++)n.morphTargetInfluences[i]=e.weights[i];if(e.extras&&Array.isArray(e.extras.targetNames)){const i=e.extras.targetNames;if(n.morphTargetInfluences.length===i.length){n.morphTargetDictionary={};for(let s=0,r=i.length;s<r;s++)n.morphTargetDictionary[i[s]]=s}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function _ue(n){let e;const i=n.extensions&&n.extensions[ci.KHR_DRACO_MESH_COMPRESSION];if(i?e="draco:"+i.bufferView+":"+i.indices+":"+bP(i.attributes):e=n.indices+":"+bP(n.attributes)+":"+n.mode,n.targets!==void 0)for(let s=0,r=n.targets.length;s<r;s++)e+=":"+bP(n.targets[s]);return e}function bP(n){let e="";const i=Object.keys(n).sort();for(let s=0,r=i.length;s<r;s++)e+=i[s]+":"+n[i[s]]+";";return e}function AP(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Sue(n){return n.search(/\.jpe?g($|\?)/i)>0||n.search(/^data\:image\/jpeg/)===0?"image/jpeg":n.search(/\.webp($|\?)/i)>0||n.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const Cue=new ui;let Mue=class{constructor(n={},e={}){this.json=n,this.extensions={},this.plugins={},this.options=e,this.cache=new Zhe,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,s=-1,r=!1,o=-1;if(typeof navigator<"u"){const a=navigator.userAgent;i=/^((?!chrome|android).)*safari/i.test(a)===!0;const l=a.match(/Version\/(\d+)/);s=i&&l?parseInt(l[1],10):-1,r=a.indexOf("Firefox")>-1,o=r?a.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||i&&s<17||r&&o<98?this.textureLoader=new EX(this.options.manager):this.textureLoader=new Ohe(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new pm(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(n){this.extensions=n}setPlugins(n){this.plugins=n}parse(n,e){const i=this,s=this.json,r=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(o){const a={scene:o[0][s.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:s.asset,parser:i,userData:{}};return mm(r,a,s),Ih(a,s),Promise.all(i._invokeAll(function(l){return l.afterRoot&&l.afterRoot(a)})).then(function(){for(const l of a.scenes)l.updateMatrixWorld();n(a)})}).catch(e)}_markDefs(){const n=this.json.nodes||[],e=this.json.skins||[],i=this.json.meshes||[];for(let s=0,r=e.length;s<r;s++){const o=e[s].joints;for(let a=0,l=o.length;a<l;a++)n[o[a]].isBone=!0}for(let s=0,r=n.length;s<r;s++){const o=n[s];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(i[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(n,e){e!==void 0&&(n.refs[e]===void 0&&(n.refs[e]=n.uses[e]=0),n.refs[e]++)}_getNodeRef(n,e,i){if(n.refs[e]<=1)return i;const s=i.clone(),r=(o,a)=>{const l=this.associations.get(o);l!=null&&this.associations.set(a,l);for(const[c,h]of o.children.entries())r(h,a.children[c])};return r(i,s),s.name+="_instance_"+n.uses[e]++,s}_invokeOne(n){const e=Object.values(this.plugins);e.push(this);for(let i=0;i<e.length;i++){const s=n(e[i]);if(s)return s}return null}_invokeAll(n){const e=Object.values(this.plugins);e.unshift(this);const i=[];for(let s=0;s<e.length;s++){const r=n(e[s]);r&&i.push(r)}return i}getDependency(n,e){const i=n+":"+e;let s=this.cache.get(i);if(!s){switch(n){case"scene":s=this.loadScene(e);break;case"node":s=this._invokeOne(function(r){return r.loadNode&&r.loadNode(e)});break;case"mesh":s=this._invokeOne(function(r){return r.loadMesh&&r.loadMesh(e)});break;case"accessor":s=this.loadAccessor(e);break;case"bufferView":s=this._invokeOne(function(r){return r.loadBufferView&&r.loadBufferView(e)});break;case"buffer":s=this.loadBuffer(e);break;case"material":s=this._invokeOne(function(r){return r.loadMaterial&&r.loadMaterial(e)});break;case"texture":s=this._invokeOne(function(r){return r.loadTexture&&r.loadTexture(e)});break;case"skin":s=this.loadSkin(e);break;case"animation":s=this._invokeOne(function(r){return r.loadAnimation&&r.loadAnimation(e)});break;case"camera":s=this.loadCamera(e);break;default:if(s=this._invokeOne(function(r){return r!=this&&r.getDependency&&r.getDependency(n,e)}),!s)throw new Error("Unknown type: "+n);break}this.cache.add(i,s)}return s}getDependencies(n){let e=this.cache.get(n);if(!e){const i=this,s=this.json[n+(n==="mesh"?"es":"s")]||[];e=Promise.all(s.map(function(r,o){return i.getDependency(n,o)})),this.cache.add(n,e)}return e}loadBuffer(n){const e=this.json.buffers[n],i=this.fileLoader;if(e.type&&e.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(e.uri===void 0&&n===0)return Promise.resolve(this.extensions[ci.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(r,o){i.load(gb.resolveURL(e.uri,s.path),r,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))})})}loadBufferView(n){const e=this.json.bufferViews[n];return this.getDependency("buffer",e.buffer).then(function(i){const s=e.byteLength||0,r=e.byteOffset||0;return i.slice(r,r+s)})}loadAccessor(n){const e=this,i=this.json,s=this.json.accessors[n];if(s.bufferView===void 0&&s.sparse===void 0){const o=gP[s.type],a=Hg[s.componentType],l=s.normalized===!0,c=new a(s.count*o);return Promise.resolve(new qo(c,o,l))}const r=[];return s.bufferView!==void 0?r.push(this.getDependency("bufferView",s.bufferView)):r.push(null),s.sparse!==void 0&&(r.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(r).then(function(o){const a=o[0],l=gP[s.type],c=Hg[s.componentType],h=c.BYTES_PER_ELEMENT,u=h*l,d=s.byteOffset||0,m=s.bufferView!==void 0?i.bufferViews[s.bufferView].byteStride:void 0,f=s.normalized===!0;let g,y;if(m&&m!==u){const v=Math.floor(d/m),b="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+v+":"+s.count;let A=e.cache.get(b);A||(g=new c(a,v*m,s.count*m/h),A=new ohe(g,m/h),e.cache.add(b,A)),y=new M3(A,l,d%m/h,f)}else a===null?g=new c(s.count*l):g=new c(a,d,s.count*l),y=new qo(g,l,f);if(s.sparse!==void 0){const v=gP.SCALAR,b=Hg[s.sparse.indices.componentType],A=s.sparse.indices.byteOffset||0,x=s.sparse.values.byteOffset||0,w=new b(o[1],A,s.sparse.count*v),_=new c(o[2],x,s.sparse.count*l);a!==null&&(y=new qo(y.array.slice(),y.itemSize,y.normalized));for(let S=0,M=w.length;S<M;S++){const R=w[S];if(y.setX(R,_[S*l]),l>=2&&y.setY(R,_[S*l+1]),l>=3&&y.setZ(R,_[S*l+2]),l>=4&&y.setW(R,_[S*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return y})}loadTexture(n){const e=this.json,i=this.options,s=e.textures[n].source,r=e.images[s];let o=this.textureLoader;if(r.uri){const a=i.manager.getHandler(r.uri);a!==null&&(o=a)}return this.loadTextureImage(n,s,o)}loadTextureImage(n,e,i){const s=this,r=this.json,o=r.textures[n],a=r.images[e],l=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(e,i).then(function(h){h.flipY=!1,h.name=o.name||a.name||"",h.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(h.name=a.uri);const u=(r.samplers||{})[o.sampler]||{};return h.magFilter=OX[u.magFilter]||$v,h.minFilter=OX[u.minFilter]||z_,h.wrapS=GX[u.wrapS]||Jv,h.wrapT=GX[u.wrapT]||Jv,s.associations.set(h,{textures:n}),h}).catch(function(){return null});return this.textureCache[l]=c,c}loadImageSource(n,e){const i=this,s=this.json,r=this.options;if(this.sourceCache[n]!==void 0)return this.sourceCache[n].then(u=>u.clone());const o=s.images[n],a=self.URL||self.webkitURL;let l=o.uri||"",c=!1;if(o.bufferView!==void 0)l=i.getDependency("bufferView",o.bufferView).then(function(u){c=!0;const d=new Blob([u],{type:o.mimeType});return l=a.createObjectURL(d),l});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+n+" is missing URI and bufferView");const h=Promise.resolve(l).then(function(u){return new Promise(function(d,m){let f=d;e.isImageBitmapLoader===!0&&(f=function(g){const y=new Zs(g);y.needsUpdate=!0,d(y)}),e.load(gb.resolveURL(u,r.path),f,void 0,m)})}).then(function(u){return c===!0&&a.revokeObjectURL(l),Ih(u,o),u.userData.mimeType=o.mimeType||Sue(o.uri),u}).catch(function(u){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),u});return this.sourceCache[n]=h,h}assignTexture(n,e,i,s){const r=this;return this.getDependency("texture",i.index).then(function(o){if(!o)return null;if(i.texCoord!==void 0&&i.texCoord>0&&(o=o.clone(),o.channel=i.texCoord),r.extensions[ci.KHR_TEXTURE_TRANSFORM]){const a=i.extensions!==void 0?i.extensions[ci.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const l=r.associations.get(o);o=r.extensions[ci.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),r.associations.set(o,l)}}return s!==void 0&&(o.colorSpace=s),n[e]=o,o})}assignFinalMaterial(n){const e=n.geometry;let i=n.material;const s=e.attributes.tangent===void 0,r=e.attributes.color!==void 0,o=e.attributes.normal===void 0;if(n.isPoints){const a="PointsMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new xX,qu.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,l.sizeAttenuation=!1,this.cache.add(a,l)),i=l}else if(n.isLine){const a="LineBasicMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new gX,qu.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,this.cache.add(a,l)),i=l}if(s||r||o){let a="ClonedMaterial:"+i.uuid+":";s&&(a+="derivative-tangents:"),r&&(a+="vertex-colors:"),o&&(a+="flat-shading:");let l=this.cache.get(a);l||(l=i.clone(),r&&(l.vertexColors=!0),o&&(l.flatShading=!0),s&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(a,l),this.associations.set(l,this.associations.get(i))),i=l}n.material=i}getMaterialType(){return fS}loadMaterial(n){const e=this,i=this.json,s=this.extensions,r=i.materials[n];let o;const a={},l=r.extensions||{},c=[];if(l[ci.KHR_MATERIALS_UNLIT]){const u=s[ci.KHR_MATERIALS_UNLIT];o=u.getMaterialType(),c.push(u.extendParams(a,r,e))}else{const u=r.pbrMetallicRoughness||{};if(a.color=new is(1,1,1),a.opacity=1,Array.isArray(u.baseColorFactor)){const d=u.baseColorFactor;a.color.setRGB(d[0],d[1],d[2],Io),a.opacity=d[3]}u.baseColorTexture!==void 0&&c.push(e.assignTexture(a,"map",u.baseColorTexture,Lr)),a.metalness=u.metallicFactor!==void 0?u.metallicFactor:1,a.roughness=u.roughnessFactor!==void 0?u.roughnessFactor:1,u.metallicRoughnessTexture!==void 0&&(c.push(e.assignTexture(a,"metalnessMap",u.metallicRoughnessTexture)),c.push(e.assignTexture(a,"roughnessMap",u.metallicRoughnessTexture))),o=this._invokeOne(function(d){return d.getMaterialType&&d.getMaterialType(n)}),c.push(Promise.all(this._invokeAll(function(d){return d.extendMaterialParams&&d.extendMaterialParams(n,a)})))}r.doubleSided===!0&&(a.side=tce);const h=r.alphaMode||vP.OPAQUE;if(h===vP.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,h===vP.MASK&&(a.alphaTest=r.alphaCutoff!==void 0?r.alphaCutoff:.5)),r.normalTexture!==void 0&&o!==Bg&&(c.push(e.assignTexture(a,"normalMap",r.normalTexture)),a.normalScale=new Ln(1,1),r.normalTexture.scale!==void 0)){const u=r.normalTexture.scale;a.normalScale.set(u,u)}if(r.occlusionTexture!==void 0&&o!==Bg&&(c.push(e.assignTexture(a,"aoMap",r.occlusionTexture)),r.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=r.occlusionTexture.strength)),r.emissiveFactor!==void 0&&o!==Bg){const u=r.emissiveFactor;a.emissive=new is().setRGB(u[0],u[1],u[2],Io)}return r.emissiveTexture!==void 0&&o!==Bg&&c.push(e.assignTexture(a,"emissiveMap",r.emissiveTexture,Lr)),Promise.all(c).then(function(){const u=new o(a);return r.name&&(u.name=r.name),Ih(u,r),e.associations.set(u,{materials:n}),r.extensions&&mm(s,u,r),u})}createUniqueName(n){const e=Oi.sanitizeNodeName(n||"");return e in this.nodeNamesUsed?e+"_"+ ++this.nodeNamesUsed[e]:(this.nodeNamesUsed[e]=0,e)}loadGeometries(n){const e=this,i=this.extensions,s=this.primitiveCache;function r(a){return i[ci.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,e).then(function(l){return zX(l,a,e)})}const o=[];for(let a=0,l=n.length;a<l;a++){const c=n[a],h=_ue(c),u=s[h];if(u)o.push(u.promise);else{let d;c.extensions&&c.extensions[ci.KHR_DRACO_MESH_COMPRESSION]?d=r(c):d=zX(new Kl,c,e),s[h]={primitive:c,promise:d},o.push(d)}}return Promise.all(o)}loadMesh(n){const e=this,i=this.json,s=this.extensions,r=i.meshes[n],o=r.primitives,a=[];for(let l=0,c=o.length;l<c;l++){const h=o[l].material===void 0?Aue(this.cache):this.getDependency("material",o[l].material);a.push(h)}return a.push(e.loadGeometries(o)),Promise.all(a).then(function(l){const c=l.slice(0,l.length-1),h=l[l.length-1],u=[];for(let m=0,f=h.length;m<f;m++){const g=h[m],y=o[m];let v;const b=c[m];if(y.mode===za.TRIANGLES||y.mode===za.TRIANGLE_STRIP||y.mode===za.TRIANGLE_FAN||y.mode===void 0)v=r.isSkinnedMesh===!0?new lhe(g,b):new $u(g,b),v.isSkinnedMesh===!0&&v.normalizeSkinWeights(),y.mode===za.TRIANGLE_STRIP?v.geometry=PX(v.geometry,LV):y.mode===za.TRIANGLE_FAN&&(v.geometry=PX(v.geometry,TL));else if(y.mode===za.LINES)v=new dhe(g,b);else if(y.mode===za.LINE_STRIP)v=new lP(g,b);else if(y.mode===za.LINE_LOOP)v=new phe(g,b);else if(y.mode===za.POINTS)v=new mhe(g,b);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+y.mode);Object.keys(v.geometry.morphAttributes).length>0&&wue(v,r),v.name=e.createUniqueName(r.name||"mesh_"+n),Ih(v,r),y.extensions&&mm(s,v,y),e.assignFinalMaterial(v),u.push(v)}for(let m=0,f=u.length;m<f;m++)e.associations.set(u[m],{meshes:n,primitives:m});if(u.length===1)return r.extensions&&mm(s,u[0],r),u[0];const d=new iP;r.extensions&&mm(s,d,r),e.associations.set(d,{meshes:n});for(let m=0,f=u.length;m<f;m++)d.add(u[m]);return d})}loadCamera(n){let e;const i=this.json.cameras[n],s=i[i.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?e=new eP(Oce.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):i.type==="orthographic"&&(e=new oX(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),i.name&&(e.name=this.createUniqueName(i.name)),Ih(e,i),Promise.resolve(e)}loadSkin(n){const e=this.json.skins[n],i=[];for(let s=0,r=e.joints.length;s<r;s++)i.push(this._loadNodeShallow(e.joints[s]));return e.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",e.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(s){const r=s.pop(),o=s,a=[],l=[];for(let c=0,h=o.length;c<h;c++){const u=o[c];if(u){a.push(u);const d=new ui;r!==null&&d.fromArray(r.array,c*16),l.push(d)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',e.joints[c])}return new E3(a,l)})}loadAnimation(n){const e=this.json,i=this,s=e.animations[n],r=s.name?s.name:"animation_"+n,o=[],a=[],l=[],c=[],h=[];for(let u=0,d=s.channels.length;u<d;u++){const m=s.channels[u],f=s.samplers[m.sampler],g=m.target,y=g.node,v=s.parameters!==void 0?s.parameters[f.input]:f.input,b=s.parameters!==void 0?s.parameters[f.output]:f.output;g.node!==void 0&&(o.push(this.getDependency("node",y)),a.push(this.getDependency("accessor",v)),l.push(this.getDependency("accessor",b)),c.push(f),h.push(g))}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l),Promise.all(c),Promise.all(h)]).then(function(u){const d=u[0],m=u[1],f=u[2],g=u[3],y=u[4],v=[];for(let b=0,A=d.length;b<A;b++){const x=d[b],w=m[b],_=f[b],S=g[b],M=y[b];if(x===void 0)continue;x.updateMatrix&&x.updateMatrix();const R=i._createAnimationTracks(x,w,_,S,M);if(R)for(let P=0;P<R.length;P++)v.push(R[P])}return new _he(r,void 0,v)})}createNodeMesh(n){const e=this.json,i=this,s=e.nodes[n];return s.mesh===void 0?null:i.getDependency("mesh",s.mesh).then(function(r){const o=i._getNodeRef(i.meshCache,s.mesh,r);return s.weights!==void 0&&o.traverse(function(a){if(a.isMesh)for(let l=0,c=s.weights.length;l<c;l++)a.morphTargetInfluences[l]=s.weights[l]}),o})}loadNode(n){const e=this.json,i=this,s=e.nodes[n],r=i._loadNodeShallow(n),o=[],a=s.children||[];for(let c=0,h=a.length;c<h;c++)o.push(i.getDependency("node",a[c]));const l=s.skin===void 0?Promise.resolve(null):i.getDependency("skin",s.skin);return Promise.all([r,Promise.all(o),l]).then(function(c){const h=c[0],u=c[1],d=c[2];d!==null&&h.traverse(function(m){m.isSkinnedMesh&&m.bind(d,Cue)});for(let m=0,f=u.length;m<f;m++)h.add(u[m]);return h})}_loadNodeShallow(n){const e=this.json,i=this.extensions,s=this;if(this.nodeCache[n]!==void 0)return this.nodeCache[n];const r=e.nodes[n],o=r.name?s.createUniqueName(r.name):"",a=[],l=s._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(n)});return l&&a.push(l),r.camera!==void 0&&a.push(s.getDependency("camera",r.camera).then(function(c){return s._getNodeRef(s.cameraCache,r.camera,c)})),s._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(n)}).forEach(function(c){a.push(c)}),this.nodeCache[n]=Promise.all(a).then(function(c){let h;if(r.isBone===!0?h=new dX:c.length>1?h=new iP:c.length===1?h=c[0]:h=new Kn,h!==c[0])for(let u=0,d=c.length;u<d;u++)h.add(c[u]);if(r.name&&(h.userData.name=r.name,h.name=o),Ih(h,r),r.extensions&&mm(i,h,r),r.matrix!==void 0){const u=new ui;u.fromArray(r.matrix),h.applyMatrix4(u)}else r.translation!==void 0&&h.position.fromArray(r.translation),r.rotation!==void 0&&h.quaternion.fromArray(r.rotation),r.scale!==void 0&&h.scale.fromArray(r.scale);return s.associations.has(h)||s.associations.set(h,{}),s.associations.get(h).nodes=n,h}),this.nodeCache[n]}loadScene(n){const e=this.extensions,i=this.json.scenes[n],s=this,r=new iP;i.name&&(r.name=s.createUniqueName(i.name)),Ih(r,i),i.extensions&&mm(e,r,i);const o=i.nodes||[],a=[];for(let l=0,c=o.length;l<c;l++)a.push(s.getDependency("node",o[l]));return Promise.all(a).then(function(l){for(let h=0,u=l.length;h<u;h++)r.add(l[h]);const c=h=>{const u=new Map;for(const[d,m]of s.associations)(d instanceof qu||d instanceof Zs)&&u.set(d,m);return h.traverse(d=>{const m=s.associations.get(d);m!=null&&u.set(d,m)}),u};return s.associations=c(r),r})}_createAnimationTracks(n,e,i,s,r){const o=[],a=n.name?n.name:n.uuid,l=[];nd[r.path]===nd.weights?n.traverse(function(d){d.morphTargetInfluences&&l.push(d.name?d.name:d.uuid)}):l.push(a);let c;switch(nd[r.path]){case nd.weights:c=Ug;break;case nd.rotation:c=Vg;break;case nd.position:case nd.scale:c=Wg;break;default:switch(i.itemSize){case 1:c=Ug;break;case 2:case 3:default:c=Wg;break}break}const h=s.interpolation!==void 0?bue[s.interpolation]:ib,u=this._getArrayFromAccessor(i);for(let d=0,m=l.length;d<m;d++){const f=new c(l[d]+"."+nd[r.path],e.array,u,h);s.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(f),o.push(f)}return o}_getArrayFromAccessor(n){let e=n.array;if(n.normalized){const i=AP(e.constructor),s=new Float32Array(e.length);for(let r=0,o=e.length;r<o;r++)s[r]=e[r]*i;e=s}return e}_createCubicSplineTrackInterpolant(n){n.createInterpolant=function(e){const i=this instanceof Vg?vue:DX;return new i(this.times,this.values,this.getValueSize()/3,e)},n.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}};function Eue(n,e,i){const s=e.attributes,r=new Sl;if(s.POSITION!==void 0){const l=i.json.accessors[s.POSITION],c=l.min,h=l.max;if(c!==void 0&&h!==void 0){if(r.set(new me(c[0],c[1],c[2]),new me(h[0],h[1],h[2])),l.normalized){const u=AP(Hg[l.componentType]);r.min.multiplyScalar(u),r.max.multiplyScalar(u)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const o=e.targets;if(o!==void 0){const l=new me,c=new me;for(let h=0,u=o.length;h<u;h++){const d=o[h];if(d.POSITION!==void 0){const m=i.json.accessors[d.POSITION],f=m.min,g=m.max;if(f!==void 0&&g!==void 0){if(c.setX(Math.max(Math.abs(f[0]),Math.abs(g[0]))),c.setY(Math.max(Math.abs(f[1]),Math.abs(g[1]))),c.setZ(Math.max(Math.abs(f[2]),Math.abs(g[2]))),m.normalized){const y=AP(Hg[m.componentType]);c.multiplyScalar(y)}l.max(c)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(l)}n.boundingBox=r;const a=new Ml;r.getCenter(a.center),a.radius=r.min.distanceTo(r.max)/2,n.boundingSphere=a}function zX(n,e,i){const s=e.attributes,r=[];function o(a,l){return i.getDependency("accessor",a).then(function(c){n.setAttribute(l,c)})}for(const a in s){const l=yP[a]||a.toLowerCase();l in n.attributes||r.push(o(s[a],l))}if(e.indices!==void 0&&!n.index){const a=i.getDependency("accessor",e.indices).then(function(l){n.setIndex(l)});r.push(a)}return Ko.workingColorSpace!==Io&&"COLOR_0"in s&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${Ko.workingColorSpace}" not supported.`),Ih(n,e),Eue(n,e,i),Promise.all(r).then(function(){return e.targets!==void 0?xue(n,e.targets,i):n})}var Tue=function(){var n="b9H79Tebbbe8Fv9Gbb9Gvuuuuueu9Giuuub9Geueu9Giuuueuikqbeeedddillviebeoweuec:q;iekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbeY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVbdE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbiL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtblK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbol79IV9Rbrq:P8Yqdbk;3sezu8Jjjjjbcj;eb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Radz1jjjbhwcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhDcbhqinaqae9pmeaDaeaq9RaqaDfae6Egkcsfgocl4cifcd4hxdndndndnaoc9WGgmTmbcbhPcehsawcjdfhzalhHinaraH9Rax6midnaraHaxfgl9RcK6mbczhoinawcj;cbfaogifgoc9WfhOdndndndndnaHaic9WfgAco4fRbbaAci4coG4ciGPlbedibkaO9cb83ibaOcwf9cb83ibxikaOalRblalRbbgAco4gCaCciSgCE86bbaocGfalclfaCfgORbbaAcl4ciGgCaCciSgCE86bbaocVfaOaCfgORbbaAcd4ciGgCaCciSgCE86bbaoc7faOaCfgORbbaAciGgAaAciSgAE86bbaoctfaOaAfgARbbalRbegOco4gCaCciSgCE86bbaoc91faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc4faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc93faAaCfgARbbaOciGgOaOciSgOE86bbaoc94faAaOfgARbbalRbdgOco4gCaCciSgCE86bbaoc95faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc96faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc97faAaCfgARbbaOciGgOaOciSgOE86bbaoc98faAaOfgORbbalRbiglco4gAaAciSgAE86bbaoc99faOaAfgORbbalcl4ciGgAaAciSgAE86bbaoc9:faOaAfgORbbalcd4ciGgAaAciSgAE86bbaocufaOaAfgoRbbalciGglalciSglE86bbaoalfhlxdkaOalRbwalRbbgAcl4gCaCcsSgCE86bbaocGfalcwfaCfgORbbaAcsGgAaAcsSgAE86bbaocVfaOaAfgORbbalRbegAcl4gCaCcsSgCE86bbaoc7faOaCfgORbbaAcsGgAaAcsSgAE86bbaoctfaOaAfgORbbalRbdgAcl4gCaCcsSgCE86bbaoc91faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc4faOaAfgORbbalRbigAcl4gCaCcsSgCE86bbaoc93faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc94faOaAfgORbbalRblgAcl4gCaCcsSgCE86bbaoc95faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc96faOaAfgORbbalRbvgAcl4gCaCcsSgCE86bbaoc97faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc98faOaAfgORbbalRbogAcl4gCaCcsSgCE86bbaoc99faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc9:faOaAfgORbbalRbrglcl4gAaAcsSgAE86bbaocufaOaAfgoRbbalcsGglalcsSglE86bbaoalfhlxekaOal8Pbb83bbaOcwfalcwf8Pbb83bbalczfhlkdnaiam9pmbaiczfhoaral9RcL0mekkaiam6mialTmidnakTmbawaPfRbbhOcbhoazhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkkazcefhzaPcefgPad6hsalhHaPad9hmexvkkcbhlasceGmdxikalaxad2fhCdnakTmbcbhHcehsawcjdfhminaral9Rax6mialTmdalaxfhlawaHfRbbhOcbhoamhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkamcefhmaHcefgHad6hsaHad9hmbkaChlxikcbhocehsinaral9Rax6mdalTmealaxfhlaocefgoad6hsadao9hmbkaChlxdkcbhlasceGTmekc9:hoxikabaqad2fawcjdfakad2z1jjjb8Aawawcjdfakcufad2fadz1jjjb8Aakaqfhqalmbkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;ebf8Kjjjjbaok;yzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecjez:jjjjb8AavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:Lvoeue99dud99eud99dndnadcl9hmbaeTmeindndnabcdfgd8Sbb:Yab8Sbbgi:Ygl:l:tabcefgv8Sbbgo:Ygr:l:tgwJbb;:9cawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai86bbdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad86bbdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad86bbabclfhbaecufgembxdkkaeTmbindndnabclfgd8Ueb:Yab8Uebgi:Ygl:l:tabcdfgv8Uebgo:Ygr:l:tgwJb;:FSawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai87ebdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad87ebdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad87ebabcwfhbaecufgembkkk;siliui99iue99dnaeTmbcbhiabhlindndnJ;Zl81Zalcof8UebgvciV:Y:vgoal8Ueb:YNgrJb;:FSNJbbbZJbbb:;arJbbbb9GEMgw:lJbbb9p9DTmbaw:OhDxekcjjjj94hDkalclf8Uebhqalcdf8UebhkabavcefciGaiVcetfaD87ebdndnaoak:YNgwJb;:FSNJbbbZJbbb:;awJbbbb9GEMgx:lJbbb9p9DTmbax:Ohkxekcjjjj94hkkabavcdfciGaiVcetfak87ebdndnaoaq:YNgoJb;:FSNJbbbZJbbb:;aoJbbbb9GEMgx:lJbbb9p9DTmbax:Ohqxekcjjjj94hqkabavcufciGaiVcetfaq87ebdndnJbbjZararN:tawawN:taoaoN:tgrJbbbbarJbbbb9GE:rJb;:FSNJbbbZMgr:lJbbb9p9DTmbar:Ohqxekcjjjj94hqkabavciGaiVcetfaq87ebalcwfhlaiclfhiaecufgembkkk9mbdnadcd4ae2geTmbinababydbgdcwtcw91:Yadce91cjjj;8ifcjjj98G::NUdbabclfhbaecufgembkkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;LeeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiclfaeclfydbBdbaicwfaecwfydbBdbaicxfaecxfydbBdbaiczfhiaeczfheadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk;aeedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdbaicxfalBdbaicwfalBdbaiclfalBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabkkkebcjwklz9Kbb",e="b9H79TebbbeKl9Gbb9Gvuuuuueu9Giuuub9Geueuikqbbebeedddilve9Weeeviebeoweuec:q;Aekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbdY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVblE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtboK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbrL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbwl79IV9RbDq;t9tqlbzik9:evu8Jjjjjbcz9Rhbcbheincbhdcbhiinabcwfadfaicjuaead4ceGglE86bbaialfhiadcefgdcw9hmbkaec:q:yjjbfai86bbaecitc:q1jjbfab8Piw83ibaecefgecjd9hmbkk;h8JlHud97euo978Jjjjjbcj;kb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Rad;8qbbcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhwcbhDinaDae9pmeawaeaD9RaDawfae6Egqcsfgoc9WGgkci2hxakcethmaocl4cifcd4hPabaDad2fhscbhzdnincehHalhOcbhAdninaraO9RaP6miavcj;cbfaAak2fhCaOaPfhlcbhidnakc;ab6mbaral9Rc;Gb6mbcbhoinaCaofhidndndndndnaOaoco4fRbbgXciGPlbedibkaipxbbbbbbbbbbbbbbbbpklbxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklbalczfhlkdndndndndnaXcd4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklzxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklzalczfhlkdndndndndnaXcl4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklaxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklaalczfhlkdndndndndnaXco4Plbedibkaipxbbbbbbbbbbbbbbbbpkl8WxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalclfaYpQbfaXc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalcwfaYpQbfaXc:q:yjjbfRbbfhlxekaialpbbbpkl8Walczfhlkaoc;abfhiaocjefak0meaihoaral9Rc;Fb0mbkkdndnaiak9pmbaici4hoinaral9RcK6mdaCaifhXdndndndndnaOaico4fRbbaocoG4ciGPlbedibkaXpxbbbbbbbbbbbbbbbbpklbxikaXalpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaXalpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaXalpbbbpklbalczfhlkaocdfhoaiczfgiak6mbkkalTmbaAci6hHalhOaAcefgohAaoclSmdxekkcbhlaHceGmdkdnakTmbavcjdfazfhiavazfpbdbhYcbhXinaiavcj;cbfaXfgopblbgLcep9TaLpxeeeeeeeeeeeeeeeegQp9op9Hp9rgLaoakfpblbg8Acep9Ta8AaQp9op9Hp9rg8ApmbzeHdOiAlCvXoQrLgEaoamfpblbg3cep9Ta3aQp9op9Hp9rg3aoaxfpblbg5cep9Ta5aQp9op9Hp9rg5pmbzeHdOiAlCvXoQrLg8EpmbezHdiOAlvCXorQLgQaQpmbedibedibedibediaYp9UgYp9AdbbaiadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaEa8EpmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwKDYq8AkEx3m5P8Es8FgLa3a5pmwKDYq8AkEx3m5P8Es8Fg8ApmbezHdiOAlvCXorQLgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfhiaXczfgXak6mbkkazclfgzad6mbkasavcjdfaqad2;8qbbavavcjdfaqcufad2fad;8qbbaqaDfhDc9:hoalmexikkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;kbf8Kjjjjbaokwbz:bjjjbk;uzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecje;8kbavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:EPliuo97eue978Jjjjjbca9Rhidndnadcl9hmbdnaec98GglTmbcbhvabhdinadadpbbbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpkbbadczfhdavclfgval6mbkkalae9pmeaiaeciGgvcdtgdVcbczad9R;8kbaiabalcdtfglad;8qbbdnavTmbaiaipblbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpklbkalaiad;8qbbskdnaec98GgxTmbcbhvabhdinadczfglalpbbbgopxbbbbbbFFbbbbbbFFgkp9oadpbbbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpkbbadaDakp9oawaopmbezHdiOAlvCXorQLp9qpkbbadcafhdavclfgvax6mbkkaxae9pmbaiaeciGgvcitgdfcbcaad9R;8kbaiabaxcitfglad;8qbbdnavTmbaiaipblzgopxbbbbbbFFbbbbbbFFgkp9oaipblbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpklzaiaDakp9oawaopmbezHdiOAlvCXorQLp9qpklbkalaiad;8qbbkk;4wllue97euv978Jjjjjbc8W9Rhidnaec98GglTmbcbhvabhoinaiaopbbbgraoczfgwpbbbgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklbaopxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblbpEb:T:j83ibaocwfarp5eaipblbpEe:T:j83ibawaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblbpEd:T:j83ibaocKfakp5eaipblbpEi:T:j83ibaocafhoavclfgval6mbkkdnalae9pmbaiaeciGgvcitgofcbcaao9R;8kbaiabalcitfgwao;8qbbdnavTmbaiaipblbgraipblzgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklaaipxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblapEb:T:j83ibaiarp5eaipblapEe:T:j83iwaiaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblapEd:T:j83izaiakp5eaipblapEi:T:j83iKkawaiao;8qbbkk:Pddiue978Jjjjjbc;ab9Rhidnadcd4ae2glc98GgvTmbcbhdabheinaeaepbbbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepkbbaeczfheadclfgdav6mbkkdnaval9pmbaialciGgdcdtgeVcbc;abae9R;8kbaiabavcdtfgvae;8qbbdnadTmbaiaipblbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepklbkavaiae;8qbbkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaikkkebcjwklz9Tbb",i=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),s=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if(typeof WebAssembly!="object")return{supported:!1};var r=WebAssembly.validate(i)?e:n,o,a=WebAssembly.instantiate(l(r),{}).then(function(b){o=b.instance,o.exports.__wasm_call_ctors()});function l(b){for(var A=new Uint8Array(b.length),x=0;x<b.length;++x){var w=b.charCodeAt(x);A[x]=w>96?w-97:w>64?w-39:w+4}for(var _=0,x=0;x<b.length;++x)A[_++]=A[x]<60?s[A[x]]:(A[x]-60)*64+A[++x];return A.buffer.slice(0,_)}function c(b,A,x,w,_,S){var M=o.exports.sbrk,R=x+3&-4,P=M(R*w),C=M(_.length),L=new Uint8Array(o.exports.memory.buffer);L.set(_,C);var B=b(P,x,w,C,_.length);if(B==0&&S&&S(P,R,w),A.set(L.subarray(P,P+x*w)),M(P-M(0)),B!=0)throw new Error("Malformed buffer data: "+B)}var h={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},u={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"},d=[],m=0;function f(b){var A={object:new Worker(b),pending:0,requests:{}};return A.object.onmessage=function(x){var w=x.data;A.pending-=w.count,A.requests[w.id][w.action](w.value),delete A.requests[w.id]},A}function g(b){for(var A="var instance; var ready = WebAssembly.instantiate(new Uint8Array(["+new Uint8Array(l(r))+"]), {}).then(function(result) { instance = result.instance; instance.exports.__wasm_call_ctors(); });self.onmessage = workerProcess;"+c.toString()+v.toString(),x=new Blob([A],{type:"text/javascript"}),w=URL.createObjectURL(x),_=0;_<b;++_)d[_]=f(w);URL.revokeObjectURL(w)}function y(b,A,x,w,_){for(var S=d[0],M=1;M<d.length;++M)d[M].pending<S.pending&&(S=d[M]);return new Promise(function(R,P){var C=new Uint8Array(x),L=m++;S.pending+=b,S.requests[L]={resolve:R,reject:P},S.object.postMessage({id:L,count:b,size:A,source:C,mode:w,filter:_},[C.buffer])})}function v(b){a.then(function(){var A=b.data;try{var x=new Uint8Array(A.count*A.size);c(o.exports[A.mode],x,A.count,A.size,A.source,o.exports[A.filter]),self.postMessage({id:A.id,count:A.count,action:"resolve",value:x},[x.buffer])}catch(w){self.postMessage({id:A.id,count:A.count,action:"reject",value:w})}})}return{ready:a,supported:!0,useWorkers:function(b){g(b)},decodeVertexBuffer:function(b,A,x,w,_){c(o.exports.meshopt_decodeVertexBuffer,b,A,x,w,o.exports[h[_]])},decodeIndexBuffer:function(b,A,x,w){c(o.exports.meshopt_decodeIndexBuffer,b,A,x,w)},decodeIndexSequence:function(b,A,x,w){c(o.exports.meshopt_decodeIndexSequence,b,A,x,w)},decodeGltfBuffer:function(b,A,x,w,_,S){c(o.exports[u[_]],b,A,x,w,o.exports[h[S]])},decodeGltfBufferAsync:function(b,A,x,w,_){return d.length>0?y(b,A,x,u[w],h[_]):a.then(function(){var S=new Uint8Array(b*A);return c(o.exports[u[w]],S,b,A,x,o.exports[h[_]]),S})}}}();const xP=new WeakMap;class Rue extends id{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,i,s,r){const o=new pm(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,a=>{this.parse(a,i,r)},s,r)}parse(e,i,s=()=>{}){this.decodeDracoFile(e,i,null,null,Lr,s).catch(s)}decodeDracoFile(e,i,s,r,o=Io,a=()=>{}){const l={attributeIDs:s||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!s,vertexColorSpace:o};return this.decodeGeometry(e,l).then(i).catch(a)}decodeGeometry(e,i){const s=JSON.stringify(i);if(xP.has(e)){const c=xP.get(e);if(c.key===s)return c.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let r;const o=this.workerNextTaskID++,a=e.byteLength,l=this._getWorker(o,a).then(c=>(r=c,new Promise((h,u)=>{r._callbacks[o]={resolve:h,reject:u},r.postMessage({type:"decode",id:o,taskConfig:i,buffer:e},[e])}))).then(c=>this._createGeometry(c.geometry));return l.catch(()=>!0).then(()=>{r&&o&&this._releaseTask(r,o)}),xP.set(e,{key:s,promise:l}),l}_createGeometry(e){const i=new Kl;e.index&&i.setIndex(new qo(e.index.array,1));for(let s=0;s<e.attributes.length;s++){const r=e.attributes[s],o=r.name,a=r.array,l=r.itemSize,c=new qo(a,l);o==="color"&&(this._assignVertexColorSpace(c,r.vertexColorSpace),c.normalized=!(a instanceof Float32Array)),i.setAttribute(o,c)}return i}_assignVertexColorSpace(e,i){if(i!==Lr)return;const s=new is;for(let r=0,o=e.count;r<o;r++)s.fromBufferAttribute(e,r).convertSRGBToLinear(),e.setXYZ(r,s.r,s.g,s.b)}_loadLibrary(e,i){const s=new pm(this.manager);return s.setPath(this.decoderPath),s.setResponseType(i),s.setWithCredentials(this.withCredentials),new Promise((r,o)=>{s.load(e,r,void 0,o)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",i=[];return e?i.push(this._loadLibrary("draco_decoder.js","text")):(i.push(this._loadLibrary("draco_wasm_wrapper.js","text")),i.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(i).then(s=>{const r=s[0];e||(this.decoderConfig.wasmBinary=s[1]);const o=Iue.toString(),a=["/* draco decoder */",r,"","/* worker */",o.substring(o.indexOf("{")+1,o.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([a]))}),this.decoderPending}_getWorker(e,i){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const r=new Worker(this.workerSourceURL);r._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:this.decoderConfig}),r.onmessage=function(o){const a=o.data;switch(a.type){case"decode":r._callbacks[a.id].resolve(a);break;case"error":r._callbacks[a.id].reject(a);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+a.type+'"')}},this.workerPool.push(r)}else this.workerPool.sort(function(r,o){return r._taskLoad>o._taskLoad?-1:1});const s=this.workerPool[this.workerPool.length-1];return s._taskCosts[e]=i,s._taskLoad+=i,s})}_releaseTask(e,i){e._taskLoad-=e._taskCosts[i],delete e._callbacks[i],delete e._taskCosts[i]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function Iue(){let n,e;onmessage=function(a){const l=a.data;switch(l.type){case"init":n=l.decoderConfig,e=new Promise(function(u){n.onModuleLoaded=function(d){u({draco:d})},DracoDecoderModule(n)});break;case"decode":const c=l.buffer,h=l.taskConfig;e.then(u=>{const d=u.draco,m=new d.Decoder;try{const f=i(d,m,new Int8Array(c),h),g=f.attributes.map(y=>y.array.buffer);f.index&&g.push(f.index.array.buffer),self.postMessage({type:"decode",id:l.id,geometry:f},g)}catch(f){console.error(f),self.postMessage({type:"error",id:l.id,error:f.message})}finally{d.destroy(m)}});break}};function i(a,l,c,h){const u=h.attributeIDs,d=h.attributeTypes;let m,f;const g=l.GetEncodedGeometryType(c);if(g===a.TRIANGULAR_MESH)m=new a.Mesh,f=l.DecodeArrayToMesh(c,c.byteLength,m);else if(g===a.POINT_CLOUD)m=new a.PointCloud,f=l.DecodeArrayToPointCloud(c,c.byteLength,m);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!f.ok()||m.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+f.error_msg());const y={index:null,attributes:[]};for(const v in u){const b=self[d[v]];let A,x;if(h.useUniqueIDs)x=u[v],A=l.GetAttributeByUniqueId(m,x);else{if(x=l.GetAttributeId(m,a[u[v]]),x===-1)continue;A=l.GetAttribute(m,x)}const w=r(a,l,m,v,b,A);v==="color"&&(w.vertexColorSpace=h.vertexColorSpace),y.attributes.push(w)}return g===a.TRIANGULAR_MESH&&(y.index=s(a,l,m)),a.destroy(m),y}function s(a,l,c){const h=c.num_faces()*3,u=h*4,d=a._malloc(u);l.GetTrianglesUInt32Array(c,u,d);const m=new Uint32Array(a.HEAPF32.buffer,d,h).slice();return a._free(d),{array:m,itemSize:1}}function r(a,l,c,h,u,d){const m=d.num_components(),f=c.num_points()*m,g=f*u.BYTES_PER_ELEMENT,y=o(a,u),v=a._malloc(g);l.GetAttributeDataArrayForAllPoints(c,d,y,g,v);const b=new u(a.HEAPF32.buffer,v,f).slice();return a._free(v),{name:h,array:b,itemSize:m}}function o(a,l){switch(l){case Float32Array:return a.DT_FLOAT32;case Int8Array:return a.DT_INT8;case Int16Array:return a.DT_INT16;case Int32Array:return a.DT_INT32;case Uint8Array:return a.DT_UINT8;case Uint16Array:return a.DT_UINT16;case Uint32Array:return a.DT_UINT32}}}class Lue{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const i=this.workerCreator();i.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=i}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,i){const s=this.workersResolve[e];if(s&&s(i),this.queue.length){const{resolve:r,msg:o,transfer:a}=this.queue.shift();this.workersResolve[e]=r,this.workers[e].postMessage(o,a)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,i){return new Promise(s=>{const r=this._getIdleWorker();r!==-1?(this._initWorker(r),this.workerStatus|=1<<r,this.workersResolve[r]=s,this.workers[r].postMessage(e,i)):this.queue.push({resolve:s,msg:e,transfer:i})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const Pue=0,FX=2,Bue=1,NX=2,kue=0,Due=1,Oue=10,Gue=0,UX=9,VX=15,XX=16,WX=22,HX=37,jX=43,QX=76,ZX=83,YX=97,KX=100,JX=103,qX=109,$X=165,eW=166;class zue{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class vb{constructor(e,i,s,r){this._dataView=new DataView(e.buffer,e.byteOffset+i,s),this._littleEndian=r,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,i=0){const s=this._offset;let r=0;for(;this._dataView.getUint8(this._offset)!==i&&r<e;)r++,this._offset++;return r<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+s,r)}}const oo=[171,75,84,88,32,50,48,187,13,10,26,10];function tW(n){return typeof TextDecoder<"u"?new TextDecoder().decode(n):Buffer.from(n).toString("utf8")}function Fue(n){const e=new Uint8Array(n.buffer,n.byteOffset,oo.length);if(e[0]!==oo[0]||e[1]!==oo[1]||e[2]!==oo[2]||e[3]!==oo[3]||e[4]!==oo[4]||e[5]!==oo[5]||e[6]!==oo[6]||e[7]!==oo[7]||e[8]!==oo[8]||e[9]!==oo[9]||e[10]!==oo[10]||e[11]!==oo[11])throw new Error("Missing KTX 2.0 identifier.");const i=new zue,s=17*Uint32Array.BYTES_PER_ELEMENT,r=new vb(n,oo.length,s,!0);i.vkFormat=r._nextUint32(),i.typeSize=r._nextUint32(),i.pixelWidth=r._nextUint32(),i.pixelHeight=r._nextUint32(),i.pixelDepth=r._nextUint32(),i.layerCount=r._nextUint32(),i.faceCount=r._nextUint32();const o=r._nextUint32();i.supercompressionScheme=r._nextUint32();const a=r._nextUint32(),l=r._nextUint32(),c=r._nextUint32(),h=r._nextUint32(),u=r._nextUint64(),d=r._nextUint64(),m=new vb(n,oo.length+s,3*o*8,!0);for(let F=0;F<o;F++)i.levels.push({levelData:new Uint8Array(n.buffer,n.byteOffset+m._nextUint64(),m._nextUint64()),uncompressedByteLength:m._nextUint64()});const f=new vb(n,a,l,!0),g={vendorId:f._skip(4)._nextUint16(),descriptorType:f._nextUint16(),versionNumber:f._nextUint16(),descriptorBlockSize:f._nextUint16(),colorModel:f._nextUint8(),colorPrimaries:f._nextUint8(),transferFunction:f._nextUint8(),flags:f._nextUint8(),texelBlockDimension:[f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8()],bytesPlane:[f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8()],samples:[]},y=(g.descriptorBlockSize/4-6)/4;for(let F=0;F<y;F++){const X={bitOffset:f._nextUint16(),bitLength:f._nextUint8(),channelType:f._nextUint8(),samplePosition:[f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&X.channelType?(X.sampleLower=f._nextInt32(),X.sampleUpper=f._nextInt32()):(X.sampleLower=f._nextUint32(),X.sampleUpper=f._nextUint32()),g.samples[F]=X}i.dataFormatDescriptor.length=0,i.dataFormatDescriptor.push(g);const v=new vb(n,c,h,!0);for(;v._offset<h;){const F=v._nextUint32(),X=v._scan(F),J=tW(X),q=v._scan(F-X.byteLength);i.keyValue[J]=J.match(/^ktx/i)?tW(q):q,v._offset%4&&v._skip(4-v._offset%4)}if(d<=0)return i;const b=new vb(n,u,d,!0),A=b._nextUint16(),x=b._nextUint16(),w=b._nextUint32(),_=b._nextUint32(),S=b._nextUint32(),M=b._nextUint32(),R=[];for(let F=0;F<o;F++)R.push({imageFlags:b._nextUint32(),rgbSliceByteOffset:b._nextUint32(),rgbSliceByteLength:b._nextUint32(),alphaSliceByteOffset:b._nextUint32(),alphaSliceByteLength:b._nextUint32()});const P=u+b._offset,C=P+w,L=C+_,B=L+S,z=new Uint8Array(n.buffer,n.byteOffset+P,w),D=new Uint8Array(n.buffer,n.byteOffset+C,_),W=new Uint8Array(n.buffer,n.byteOffset+L,S),O=new Uint8Array(n.buffer,n.byteOffset+B,M);return i.globalData={endpointCount:A,selectorCount:x,imageDescs:R,endpointsData:z,selectorsData:D,tablesData:W,extendedData:O},i}let wP,Lh,_P;const SP={env:{emscripten_notify_memory_growth:function(n){_P=new Uint8Array(Lh.exports.memory.buffer)}}};class Nue{init(){return wP||(wP=typeof fetch<"u"?fetch("data:application/wasm;base64,"+iW).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,SP)).then(this._init):WebAssembly.instantiate(Buffer.from(iW,"base64"),SP).then(this._init),wP)}_init(e){Lh=e.instance,SP.env.emscripten_notify_memory_growth(0)}decode(e,i=0){if(!Lh)throw new Error("ZSTDDecoder: Await .init() before decoding.");const s=e.byteLength,r=Lh.exports.malloc(s);_P.set(e,r),i=i||Number(Lh.exports.ZSTD_findDecompressedSize(r,s));const o=Lh.exports.malloc(i),a=Lh.exports.ZSTD_decompress(o,i,r,s),l=_P.slice(o,o+a);return Lh.exports.free(r),Lh.exports.free(o),l}}const iW="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IAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQh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ASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigC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C0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdB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IAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY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wOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEE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",CP=new WeakMap;let MP=0,EP;class ih extends id{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new Lue,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}async detectSupportAsync(e){return this.workerConfig={astcSupported:await e.hasFeatureAsync("texture-compression-astc"),etc1Supported:await e.hasFeatureAsync("texture-compression-etc1"),etc2Supported:await e.hasFeatureAsync("texture-compression-etc2"),dxtSupported:await e.hasFeatureAsync("texture-compression-bc"),bptcSupported:await e.hasFeatureAsync("texture-compression-bptc"),pvrtcSupported:await e.hasFeatureAsync("texture-compression-pvrtc")},this}detectSupport(e){return e.isWebGPURenderer===!0?this.workerConfig={astcSupported:e.hasFeature("texture-compression-astc"),etc1Supported:e.hasFeature("texture-compression-etc1"),etc2Supported:e.hasFeature("texture-compression-etc2"),dxtSupported:e.hasFeature("texture-compression-bc"),bptcSupported:e.hasFeature("texture-compression-bptc"),pvrtcSupported:e.hasFeature("texture-compression-pvrtc")}:this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}init(){if(!this.transcoderPending){const e=new pm(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const i=e.loadAsync("basis_transcoder.js"),s=new pm(this.manager);s.setPath(this.transcoderPath),s.setResponseType("arraybuffer"),s.setWithCredentials(this.withCredentials);const r=s.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([i,r]).then(([o,a])=>{const l=ih.BasisWorker.toString(),c=["/* constants */","let _EngineFormat = "+JSON.stringify(ih.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(ih.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(ih.BasisFormat),"/* basis_transcoder.js */",o,"/* worker */",l.substring(l.indexOf("{")+1,l.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([c])),this.transcoderBinary=a,this.workerPool.setWorkerCreator(()=>{const h=new Worker(this.workerSourceURL),u=this.transcoderBinary.slice(0);return h.postMessage({type:"init",config:this.workerConfig,transcoderBinary:u},[u]),h})}),MP>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),MP++}return this.transcoderPending}load(e,i,s,r){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const o=new pm(this.manager);o.setResponseType("arraybuffer"),o.setWithCredentials(this.withCredentials),o.load(e,a=>{this.parse(a,i,r)},s,r)}parse(e,i,s){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");if(CP.has(e))return CP.get(e).promise.then(i).catch(s);this._createTexture(e).then(r=>i?i(r):null).catch(s)}_createTextureFrom(e,i){const{faces:s,width:r,height:o,format:a,type:l,error:c,dfdFlags:h}=e;if(l==="error")return Promise.reject(c);let u;if(i.faceCount===6)u=new ghe(s,a,Oa);else{const d=s[0].mipmaps;u=i.layerCount>1?new fhe(d,r,o,i.layerCount,a,Oa):new mS(d,r,o,a,Oa)}return u.minFilter=s[0].mipmaps.length===1?$v:z_,u.magFilter=$v,u.generateMipmaps=!1,u.needsUpdate=!0,u.colorSpace=nW(i),u.premultiplyAlpha=!!(h&Bue),u}async _createTexture(e,i={}){const s=Fue(new Uint8Array(e));if(s.vkFormat!==Gue)return Vue(s);const r=i,o=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:r},[e])).then(a=>this._createTextureFrom(a.data,s));return CP.set(e,{promise:o}),o}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),MP--,this}}ih.BasisFormat={ETC1S:0,UASTC_4x4:1},ih.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},ih.EngineFormat={RGBAFormat:Hu,RGBA_ASTC_4x4_Format:fce,RGBA_BPTC_Format:gce,RGBA_ETC2_EAC_Format:mce,RGBA_PVRTC_4BPPV1_Format:uce,RGBA_S3TC_DXT5_Format:cce,RGB_ETC1_Format:dce,RGB_ETC2_Format:pce,RGB_PVRTC_4BPPV1_Format:hce,RGBA_S3TC_DXT1_Format:lce},ih.BasisWorker=function(){let n,e,i;const s=_EngineFormat,r=_TranscoderFormat,o=_BasisFormat;self.addEventListener("message",function(g){const y=g.data;switch(y.type){case"init":n=y.config,a(y.transcoderBinary);break;case"transcode":e.then(()=>{try{const{faces:v,buffers:b,width:A,height:x,hasAlpha:w,format:_,dfdFlags:S}=l(y.buffer);self.postMessage({type:"transcode",id:y.id,faces:v,width:A,height:x,hasAlpha:w,format:_,dfdFlags:S},b)}catch(v){console.error(v),self.postMessage({type:"error",id:y.id,error:v.message})}});break}});function a(g){e=new Promise(y=>{i={wasmBinary:g,onRuntimeInitialized:y},BASIS(i)}).then(()=>{i.initializeBasis(),i.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")})}function l(g){const y=new i.KTX2File(new Uint8Array(g));function v(){y.close(),y.delete()}if(!y.isValid())throw v(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");const b=y.isUASTC()?o.UASTC_4x4:o.ETC1S,A=y.getWidth(),x=y.getHeight(),w=y.getLayers()||1,_=y.getLevels(),S=y.getFaces(),M=y.getHasAlpha(),R=y.getDFDFlags(),{transcoderFormat:P,engineFormat:C}=d(b,A,x,M);if(!A||!x||!_)throw v(),new Error("THREE.KTX2Loader:	Invalid texture");if(!y.startTranscoding())throw v(),new Error("THREE.KTX2Loader: .startTranscoding failed");const L=[],B=[];for(let z=0;z<S;z++){const D=[];for(let W=0;W<_;W++){const O=[];let F,X;for(let q=0;q<w;q++){const oe=y.getImageLevelInfo(W,q,z);z===0&&W===0&&q===0&&(oe.origWidth%4!==0||oe.origHeight%4!==0)&&console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),_>1?(F=oe.origWidth,X=oe.origHeight):(F=oe.width,X=oe.height);const _e=new Uint8Array(y.getImageTranscodedSizeInBytes(W,q,0,P));if(!y.transcodeImage(_e,W,q,z,P,0,-1,-1))throw v(),new Error("THREE.KTX2Loader: .transcodeImage failed.");O.push(_e)}const J=f(O);D.push({data:J,width:F,height:X}),B.push(J.buffer)}L.push({mipmaps:D,width:A,height:x,format:C})}return v(),{faces:L,buffers:B,width:A,height:x,hasAlpha:M,format:C,dfdFlags:R}}const c=[{if:"astcSupported",basisFormat:[o.UASTC_4x4],transcoderFormat:[r.ASTC_4x4,r.ASTC_4x4],engineFormat:[s.RGBA_ASTC_4x4_Format,s.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[r.BC7_M5,r.BC7_M5],engineFormat:[s.RGBA_BPTC_Format,s.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[r.BC1,r.BC3],engineFormat:[s.RGBA_S3TC_DXT1_Format,s.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[r.ETC1,r.ETC2],engineFormat:[s.RGB_ETC2_Format,s.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[r.ETC1],engineFormat:[s.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[r.PVRTC1_4_RGB,r.PVRTC1_4_RGBA],engineFormat:[s.RGB_PVRTC_4BPPV1_Format,s.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],h=c.sort(function(g,y){return g.priorityETC1S-y.priorityETC1S}),u=c.sort(function(g,y){return g.priorityUASTC-y.priorityUASTC});function d(g,y,v,b){let A,x;const w=g===o.ETC1S?h:u;for(let _=0;_<w.length;_++){const S=w[_];if(n[S.if]&&S.basisFormat.includes(g)&&!(b&&S.transcoderFormat.length<2)&&!(S.needsPowerOfTwo&&!(m(y)&&m(v))))return A=S.transcoderFormat[b?1:0],x=S.engineFormat[b?1:0],{transcoderFormat:A,engineFormat:x}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),A=r.RGBA32,x=s.RGBAFormat,{transcoderFormat:A,engineFormat:x}}function m(g){return g<=2?!0:(g&g-1)===0&&g!==0}function f(g){if(g.length===1)return g[0];let y=0;for(let A=0;A<g.length;A++){const x=g[A];y+=x.byteLength}const v=new Uint8Array(y);let b=0;for(let A=0;A<g.length;A++){const x=g[A];v.set(x,b),b+=x.byteLength}return v}};const Uue=new Set([Hu,eb,xg]),TP={[qX]:Hu,[YX]:Hu,[HX]:Hu,[jX]:Hu,[JX]:eb,[ZX]:eb,[XX]:eb,[WX]:eb,[KX]:xg,[QX]:xg,[VX]:xg,[UX]:xg,[eW]:EV,[$X]:EV},RP={[qX]:am,[YX]:F_,[HX]:Oa,[jX]:Oa,[JX]:am,[ZX]:F_,[XX]:Oa,[WX]:Oa,[KX]:am,[QX]:F_,[VX]:Oa,[UX]:Oa,[eW]:Oa,[$X]:Oa};async function Vue(n){const{vkFormat:e}=n;if(TP[e]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let i;n.supercompressionScheme===FX&&(EP||(EP=new Promise(async o=>{const a=new Nue;await a.init(),o(a)})),i=await EP);const s=[];for(let o=0;o<n.levels.length;o++){const a=Math.max(1,n.pixelWidth>>o),l=Math.max(1,n.pixelHeight>>o),c=n.pixelDepth?Math.max(1,n.pixelDepth>>o):0,h=n.levels[o];let u;if(n.supercompressionScheme===Pue)u=h.levelData;else if(n.supercompressionScheme===FX)u=i.decode(h.levelData,h.uncompressedByteLength);else throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");let d;RP[e]===am?d=new Float32Array(u.buffer,u.byteOffset,u.byteLength/Float32Array.BYTES_PER_ELEMENT):RP[e]===F_?d=new Uint16Array(u.buffer,u.byteOffset,u.byteLength/Uint16Array.BYTES_PER_ELEMENT):d=u,s.push({data:d,width:a,height:l,depth:c})}let r;if(Uue.has(TP[e]))r=n.pixelDepth===0?new rP(s[0].data,n.pixelWidth,n.pixelHeight):new Xce(s[0].data,n.pixelWidth,n.pixelHeight,n.pixelDepth);else{if(n.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");r=new mS(s,n.pixelWidth,n.pixelHeight)}return r.mipmaps=s,r.type=RP[e],r.format=TP[e],r.colorSpace=nW(n),r.needsUpdate=!0,Promise.resolve(r)}function nW(n){const e=n.dataFormatDescriptor[0];return e.colorPrimaries===Due?e.transferFunction===NX?Lr:Io:e.colorPrimaries===Oue?e.transferFunction===NX?PV:IL:(e.colorPrimaries===kue||console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${e.colorPrimaries}"`),RL)}let jg="https://www.gstatic.com/draco/versioned/decoders/1.5.7/",bb="https://www.gstatic.com/basis-universal/versioned/2021-04-15-ba1c3e4/";const Xue=jg,Wue=bb;fetch(jg+"draco_decoder.js",{method:"head"}).catch(n=>{jg===Xue&&(jg="./include/draco/"),bb===Wue&&(bb="./include/ktx2/")});function Hue(n){jg=n}function jue(n){bb=n}let Qg,yS,Zg;function IP(n){return Qg||(Qg=new Rue,Qg.setDecoderPath(jg),Qg.setDecoderConfig({type:"js"})),Zg||(Zg=new ih,Zg.setTranscoderPath(bb)),yS||(yS=Tue),n?Zg.detectSupport(n):n!==null&&console.warn("No renderer provided to detect ktx2 support - loading KTX2 textures might fail"),{dracoLoader:Qg,ktx2Loader:Zg,meshoptDecoder:yS}}function Que(n){n.dracoLoader||n.setDRACOLoader(Qg),n.ktx2Loader||n.setKTX2Loader(Zg),n.meshoptDecoder||n.setMeshoptDecoder(yS)}Ab("debugprogressive");function Ab(n){if(typeof window>"u")return!1;const e=new URL(window.location.href).searchParams.get(n);return e==null||e==="0"||e==="false"?!1:e===""?!0:e}function Zue(n,e){if(e===void 0||e.startsWith("./")||e.startsWith("http")||n===void 0)return e;const i=n.lastIndexOf("/");if(i>=0){const s=n.substring(0,i+1);for(;s.endsWith("/")&&e.startsWith("/");)e=e.substring(1);return s+e}return e}let vS;function Yue(){return vS!==void 0||(vS=/iPhone|iPad|iPod|Android|IEMobile/i.test(navigator.userAgent),Ab("debugprogressive")&&console.log("[glTF Progressive]: isMobileDevice",vS)),vS}const LP=Symbol("needle:raycast-mesh");function xb(n){return n?.[LP]instanceof Kl?n[LP]:null}function Kue(n,e){if((n.type==="Mesh"||n.type==="SkinnedMesh")&&!xb(n)){const i=Jue(e);i.userData={isRaycastMesh:!0},n[LP]=i}}function Jue(n){const e=new Kl;for(const i in n.attributes)e.setAttribute(i,n.getAttribute(i));return e.setIndex(n.getIndex()),e}const sd=new Array,Ph="NEEDLE_progressive",nn=Ab("debugprogressive"),PP=Symbol("needle-progressive-texture"),wb=new Map,BP=new Set;if(nn){let n=function(){e+=1,console.log("Toggle LOD level",e,wb),wb.forEach((r,o)=>{for(const a of r.keys){const l=o[a];if(l!=null){if(l.isBufferGeometry===!0){const c=mi.getMeshLODInformation(l),h=c?Math.min(e,c.lods.length):0;o["DEBUG:LOD"]=e,mi.assignMeshLOD(o,h),c&&(i=Math.max(i,c.lods.length-1))}else if(o.isMaterial===!0){o["DEBUG:LOD"]=e,mi.assignTextureLOD(o,e);break}}}}),e>=i&&(e=-1)},e=-1,i=2,s=!1;window.addEventListener("keyup",r=>{r.key==="p"&&n(),r.key==="w"&&(s=!s,BP&&BP.forEach(o=>{o.name!="BackgroundCubeMaterial"&&o.glyphMap==null&&"wireframe"in o&&(o.wireframe=s)}))})}function sW(n,e,i){var s;if(!nn)return;wb.has(n)||wb.set(n,{keys:[],sourceId:i});const r=wb.get(n);((s=r?.keys)==null?void 0:s.includes(e))==!1&&r.keys.push(e)}const ks=class{constructor(n,e){this.loadMesh=i=>{var s,r;if(this._isLoadingMesh)return null;const o=(r=(s=this.parser.json.meshes[i])==null?void 0:s.extensions)==null?void 0:r[Ph];return o?(this._isLoadingMesh=!0,this.parser.getDependency("mesh",i).then(a=>{var l;return this._isLoadingMesh=!1,a&&ks.registerMesh(this.url,o.guid,a,(l=o.lods)==null?void 0:l.length,void 0,o),a})):null},nn&&console.log("Progressive extension registered for",e),this.parser=n,this.url=e}get name(){return Ph}static getMeshLODInformation(n){const e=this.getAssignedLODInformation(n);return e!=null&&e.key?this.lodInfos.get(e.key):null}static getMaterialMinMaxLODsCount(n,e){const i=this,s="LODS:minmax",r=n[s];if(r!=null)return r;if(e||(e={min_count:1/0,max_count:0,lods:[]}),Array.isArray(n)){for(const a of n)this.getMaterialMinMaxLODsCount(a,e);return n[s]=e,e}if(nn==="verbose"&&console.log("getMaterialMinMaxLODsCount",n),n.type==="ShaderMaterial"||n.type==="RawShaderMaterial"){const a=n;for(const l of Object.keys(a.uniforms)){const c=a.uniforms[l].value;c?.isTexture===!0&&o(c,e)}}else if(n.isMaterial)for(const a of Object.keys(n)){const l=n[a];l?.isTexture===!0&&o(l,e)}return n[s]=e,e;function o(a,l){const c=i.getAssignedLODInformation(a);if(c){const h=i.lodInfos.get(c.key);if(h&&h.lods){l.min_count=Math.min(l.min_count,h.lods.length),l.max_count=Math.max(l.max_count,h.lods.length);for(let u=0;u<h.lods.length;u++){const d=h.lods[u];d.width&&(l.lods[u]=l.lods[u]||{min_height:1/0,max_height:0},l.lods[u].min_height=Math.min(l.lods[u].min_height,d.height),l.lods[u].max_height=Math.max(l.lods[u].max_height,d.height))}}}}}static hasLODLevelAvailable(n,e){var i;if(Array.isArray(n)){for(const o of n)if(this.hasLODLevelAvailable(o,e))return!0;return!1}if(n.isMaterial===!0){for(const o of Object.keys(n)){const a=n[o];if(a&&a.isTexture&&this.hasLODLevelAvailable(a,e))return!0}return!1}else if(n.isGroup===!0){for(const o of n.children)if(o.isMesh===!0&&this.hasLODLevelAvailable(o,e))return!0}let s,r;if(n.isMesh?s=n.geometry:(n.isBufferGeometry||n.isTexture)&&(s=n),s&&(i=s?.userData)!=null&&i.LODS){const o=s.userData.LODS;if(r=this.lodInfos.get(o.key),e===void 0)return r!=null;if(r)return Array.isArray(r.lods)?e<r.lods.length:e===0}return!1}static assignMeshLOD(n,e){var i;if(!n)return Promise.resolve(null);if(n instanceof $u||n.isMesh===!0){const s=n.geometry,r=this.getAssignedLODInformation(s);if(!r)return Promise.resolve(null);for(const o of sd)(i=o.onBeforeGetLODMesh)==null||i.call(o,n,e);return n["LOD:requested level"]=e,ks.getOrLoadLOD(s,e).then(o=>{if(n["LOD:requested level"]===e){if(delete n["LOD:requested level"],Array.isArray(o)){const a=r.index||0;o=o[a]}o&&s!=o&&(o?.isBufferGeometry?(n.geometry=o,nn&&sW(n,"geometry",r.url)):nn&&console.error("Invalid LOD geometry",o))}return o}).catch(o=>(console.error("Error loading mesh LOD",n,o),null))}else nn&&console.error("Invalid call to assignMeshLOD: Request mesh LOD but the object is not a mesh",n);return Promise.resolve(null)}static assignTextureLOD(n,e=0){if(!n)return Promise.resolve(null);if(n.isMesh===!0){const i=n;if(Array.isArray(i.material)){const s=new Array;for(const r of i.material){const o=this.assignTextureLOD(r,e);s.push(o)}return Promise.all(s).then(r=>{const o=new Array;for(const a of r)Array.isArray(a)&&o.push(...a);return o})}else return this.assignTextureLOD(i.material,e)}if(n instanceof qu||n.isMaterial===!0){const i=n,s=[],r=new Array;if(nn&&BP.add(i),i.uniforms&&(i.isRawShaderMaterial||i.isShaderMaterial===!0)){const o=i;for(const a of Object.keys(o.uniforms)){const l=o.uniforms[a].value;if(l?.isTexture===!0){const c=this.assignTextureLODForSlot(l,e,i,a).then(h=>(h&&o.uniforms[a].value!=h&&(o.uniforms[a].value=h,o.uniformsNeedUpdate=!0),h));s.push(c),r.push(a)}}}else for(const o of Object.keys(i)){const a=i[o];if(a?.isTexture===!0){const l=this.assignTextureLODForSlot(a,e,i,o);s.push(l),r.push(o)}}return Promise.all(s).then(o=>{const a=new Array;for(let l=0;l<o.length;l++){const c=o[l],h=r[l];c&&c.isTexture===!0?a.push({material:i,slot:h,texture:c,level:e}):a.push({material:i,slot:h,texture:null,level:e})}return a})}if(n instanceof Zs||n.isTexture===!0){const i=n;return this.assignTextureLODForSlot(i,e,null,null)}return Promise.resolve(null)}static assignTextureLODForSlot(n,e,i,s){return n?.isTexture!==!0?Promise.resolve(null):s==="glyphMap"?Promise.resolve(n):ks.getOrLoadLOD(n,e).then(r=>{if(Array.isArray(r))return null;if(r?.isTexture===!0){if(r!=n){if(i&&s){const o=i[s];if(o){const a=this.getAssignedLODInformation(o);if(a&&a?.level<e)return nn==="verbose"&&console.warn("Assigned texture level is already higher: ",a.level,e,i,o,r),null}i[s]=r}if(nn&&s&&i){const o=this.getAssignedLODInformation(n);o&&sW(i,s,o.url)}}return r}else nn=="verbose"&&console.warn("No LOD found for",n,e);return null}).catch(r=>(console.error("Error loading LOD",n,r),null))}afterRoot(n){var e,i;return nn&&console.log("AFTER",this.url,n),(e=this.parser.json.textures)==null||e.forEach((s,r)=>{var o;if(s!=null&&s.extensions){const a=s?.extensions[Ph];if(a){if(!a.lods){nn&&console.warn("Texture has no LODs",a);return}let l=!1;for(const c of this.parser.associations.keys())if(c.isTexture===!0){const h=this.parser.associations.get(c);h?.textures===r&&(l=!0,ks.registerTexture(this.url,c,(o=a.lods)==null?void 0:o.length,r,a))}l||this.parser.getDependency("texture",r).then(c=>{var h;c&&ks.registerTexture(this.url,c,(h=a.lods)==null?void 0:h.length,r,a)})}}}),(i=this.parser.json.meshes)==null||i.forEach((s,r)=>{if(s!=null&&s.extensions){const o=s?.extensions[Ph];if(o&&o.lods){for(const a of this.parser.associations.keys())if(a.isMesh){const l=this.parser.associations.get(a);l?.meshes===r&&ks.registerMesh(this.url,o.guid,a,o.lods.length,l.primitives,o)}}}}),null}static async getOrLoadLOD(n,e){var i,s,r,o;const a=nn=="verbose",l=n.userData.LODS;if(!l)return null;const c=l?.key;let h;if(n.isTexture===!0){const u=n;u.source&&u.source[PP]&&(h=u.source[PP])}if(h||(h=ks.lodInfos.get(c)),h){if(e>0){let m=!1;const f=Array.isArray(h.lods);if(f&&e>=h.lods.length?m=!0:f||(m=!0),m)return this.lowresCache.get(c)}const u=Array.isArray(h.lods)?(i=h.lods[e])==null?void 0:i.path:h.lods;if(!u)return nn&&!h["missing:uri"]&&(h["missing:uri"]=!0,console.warn("Missing uri for progressive asset for LOD "+e,h)),null;const d=Zue(l.url,u);if(d.endsWith(".glb")||d.endsWith(".gltf")){if(!h.guid)return console.warn("missing pointer for glb/gltf texture",h),null;const m=d+"_"+h.guid,f=this.previouslyLoaded.get(m);if(f!==void 0){a&&console.log(`LOD ${e} was already loading/loaded: ${m}`);let v=await f.catch(A=>(console.error(`Error loading LOD ${e} from ${d}
`,A),null)),b=!1;if(v==null||(v instanceof Zs&&n instanceof Zs?(s=v.image)!=null&&s.data||(r=v.source)!=null&&r.data?v=this.copySettings(n,v):(b=!0,this.previouslyLoaded.delete(m)):v instanceof Kl&&n instanceof Kl&&((o=v.attributes.position)!=null&&o.array||(b=!0,this.previouslyLoaded.delete(m)))),!b)return v}const g=h,y=new Promise(async(v,b)=>{const A=new Qhe;Que(A),nn&&(await new Promise(M=>setTimeout(M,1e3)),a&&console.warn("Start loading (delayed) "+d,g.guid));let x=d;if(g&&Array.isArray(g.lods)){const M=g.lods[e];M.hash&&(x+="?v="+M.hash)}const w=await A.loadAsync(x).catch(M=>(console.error(`Error loading LOD ${e} from ${d}
`,M),null));if(!w)return null;const _=w.parser;a&&console.log("Loading finished "+d,g.guid);let S=0;if(w.parser.json.textures){let M=!1;for(const R of w.parser.json.textures){if(R!=null&&R.extensions){const P=R?.extensions[Ph];if(P!=null&&P.guid&&P.guid===g.guid){M=!0;break}}S++}if(M){let R=await _.getDependency("texture",S);return R&&ks.assignLODInformation(l.url,R,c,e,void 0,void 0),a&&console.log('change "'+n.name+'" \u2192 "'+R.name+'"',d,S,R,m),n instanceof Zs&&(R=this.copySettings(n,R)),R&&(R.guid=g.guid),v(R)}else nn&&console.warn("Could not find texture with guid",g.guid,w.parser.json)}if(S=0,w.parser.json.meshes){let M=!1;for(const R of w.parser.json.meshes){if(R!=null&&R.extensions){const P=R?.extensions[Ph];if(P!=null&&P.guid&&P.guid===g.guid){M=!0;break}}S++}if(M){const R=await _.getDependency("mesh",S),P=g;if(a&&console.log(`Loaded Mesh "${R.name}"`,d,S,R,m),R.isMesh===!0){const C=R.geometry;return ks.assignLODInformation(l.url,C,c,e,void 0,P.density),v(C)}else{const C=new Array;for(let L=0;L<R.children.length;L++){const B=R.children[L];if(B.isMesh===!0){const z=B.geometry;ks.assignLODInformation(l.url,z,c,e,L,P.density),C.push(z)}}return v(C)}}else nn&&console.warn("Could not find mesh with guid",g.guid,w.parser.json)}return v(null)});return this.previouslyLoaded.set(m,y),await y}else if(n instanceof Zs){a&&console.log("Load texture from uri: "+d);const m=await new EX().loadAsync(d);return m?(m.guid=h.guid,m.flipY=!1,m.needsUpdate=!0,m.colorSpace=n.colorSpace,a&&console.log(h,m)):nn&&console.warn("failed loading",d),m}}else nn&&console.warn(`Can not load LOD ${e}: no LOD info found for "${c}" ${n.name}`,n.type);return null}static assignLODInformation(n,e,i,s,r,o){if(!e)return;e.userData||(e.userData={});const a=new que(n,i,s,r,o);e.userData.LODS=a}static getAssignedLODInformation(n){var e;return((e=n?.userData)==null?void 0:e.LODS)||null}static copySettings(n,e){return e=e.clone(),nn&&console.warn(`Copying texture settings
`,n.uuid,`
`,e.uuid),e.offset=n.offset,e.repeat=n.repeat,e.colorSpace=n.colorSpace,e.magFilter=n.magFilter,e.minFilter=n.minFilter,e.wrapS=n.wrapS,e.wrapT=n.wrapT,e.flipY=n.flipY,e.anisotropy=n.anisotropy,e.mipmaps||(e.generateMipmaps=n.generateMipmaps),e}};let mi=ks;mi.registerTexture=(n,e,i,s,r)=>{if(nn&&console.log("> Progressive: register texture",s,e.name,e.uuid,e,r),!e){nn&&console.error("gltf-progressive: Register texture without texture");return}e.source&&(e.source[PP]=r);const o=r.guid;ks.assignLODInformation(n,e,o,i,s,void 0),ks.lodInfos.set(o,r),ks.lowresCache.set(o,e)},mi.registerMesh=(n,e,i,s,r,o)=>{var a;nn&&console.log("> Progressive: register mesh",r,i.name,o,i.uuid,i);const l=i.geometry;if(!l){nn&&console.warn("gltf-progressive: Register mesh without geometry");return}l.userData||(l.userData={}),ks.assignLODInformation(n,l,e,s,r,o.density),ks.lodInfos.set(e,o);let c=ks.lowresCache.get(e);c?c.push(i.geometry):c=[i.geometry],ks.lowresCache.set(e,c),s>0&&!xb(i)&&Kue(i,l);for(const h of sd)(a=h.onRegisteredNewMesh)==null||a.call(h,i,o)},mi.lodInfos=new Map,mi.previouslyLoaded=new Map,mi.lowresCache=new Map;class que{constructor(e,i,s,r,o){this.url=e,this.key=i,this.level=s,r!=null&&(this.index=r),o!=null&&(this.density=o)}}var rW=(n,e,i)=>{if(!e.has(n))throw TypeError("Cannot "+i)},sn=(n,e,i)=>(rW(n,e,"read from private field"),i?i.call(n):e.get(n)),fm=(n,e,i)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,i)},Bh=(n,e,i,s)=>(rW(n,e,"write to private field"),s?s.call(n,i):e.set(n,i),i),Lo,rd,kP,Yg,_b,bS,od;const Rl=Ab("debugprogressive"),$ue=Ab("noprogressive"),DP=Symbol("Needle:LODSManager"),OP=Symbol("Needle:LODState"),Kg=Symbol("Needle:CurrentLOD"),Il={mesh_lod:-1,texture_lod:-1},Fa=class{constructor(n,e){this.projectionScreenMatrix=new ui,this.targetTriangleDensity=2e5,this.updateInterval="auto",fm(this,Lo,1),this.pause=!1,this.manual=!1,this._lodchangedlisteners=[],fm(this,rd,void 0),fm(this,kP,new Ghe),fm(this,Yg,0),fm(this,_b,0),fm(this,bS,0),fm(this,od,0),this._fpsBuffer=[60,60,60,60,60],this._sphere=new Ml,this._tempBox=new Sl,this._tempBox2=new Sl,this.tempMatrix=new ui,this._tempWorldPosition=new me,this._tempBoxSize=new me,this._tempBox2Size=new me,this.renderer=n,this.context={...e}}static getObjectLODState(n){return n[OP]}static addPlugin(n){sd.push(n)}static removePlugin(n){const e=sd.indexOf(n);e>=0&&sd.splice(e,1)}static get(n,e){if(n[DP])return console.debug("[gltf-progressive] LODsManager already exists for this renderer"),n[DP];const i=new Fa(n,{engine:"unknown",...e});return n[DP]=i,i}get plugins(){return sd}addEventListener(n,e){n==="changed"&&this._lodchangedlisteners.push(e)}removeEventListener(n,e){if(n==="changed"){const i=this._lodchangedlisteners.indexOf(e);i>=0&&this._lodchangedlisteners.splice(i,1)}}enable(){if(sn(this,rd))return;console.debug("[gltf-progressive] Enabling LODsManager for renderer");let n=0;Bh(this,rd,this.renderer.render);const e=this;IP(this.renderer),this.renderer.render=function(i,s){const r=e.renderer.getRenderTarget();(r==null||"isXRRenderTarget"in r&&r.isXRRenderTarget)&&(n=0,Bh(e,Yg,sn(e,Yg)+1),Bh(e,_b,sn(e,kP).getDelta()),Bh(e,bS,sn(e,bS)+sn(e,_b)),e._fpsBuffer.shift(),e._fpsBuffer.push(1/sn(e,_b)),Bh(e,od,e._fpsBuffer.reduce((a,l)=>a+l)/e._fpsBuffer.length),Rl&&sn(e,Yg)%200===0&&console.log("FPS",Math.round(sn(e,od)),"Interval:",sn(e,Lo)));const o=n++;sn(e,rd).call(this,i,s),e.onAfterRender(i,s,o)}}disable(){sn(this,rd)&&(this.renderer.render=sn(this,rd),Bh(this,rd,void 0))}update(n,e){this.internalUpdate(n,e)}onAfterRender(n,e,i){if(this.pause)return;const s=this.renderer.renderLists.get(n,0).opaque;let r=!0;if(s.length===1){const o=s[0].material;(o.name==="EffectMaterial"||o.name==="CopyShader")&&(r=!1)}if((e.parent&&e.parent.type==="CubeCamera"||i>=1&&e.type==="OrthographicCamera")&&(r=!1),r){if($ue||(this.updateInterval==="auto"?sn(this,od)<40&&sn(this,Lo)<10?(Bh(this,Lo,sn(this,Lo)+1),Rl&&console.warn("\u2193 Reducing LOD updates",sn(this,Lo),sn(this,od).toFixed(0))):sn(this,od)>=60&&sn(this,Lo)>1&&(Bh(this,Lo,sn(this,Lo)-1),Rl&&console.warn("\u2191 Increasing LOD updates",sn(this,Lo),sn(this,od).toFixed(0))):Bh(this,Lo,this.updateInterval),sn(this,Lo)>0&&sn(this,Yg)%sn(this,Lo)!=0))return;this.internalUpdate(n,e)}}internalUpdate(n,e){var i,s;const r=this.renderer.renderLists.get(n,0),o=r.opaque;this.projectionScreenMatrix.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse);const a=this.targetTriangleDensity;for(const h of o){if(h.material&&(((i=h.geometry)==null?void 0:i.type)==="BoxGeometry"||((s=h.geometry)==null?void 0:s.type)==="BufferGeometry")&&(h.material.name==="SphericalGaussianBlur"||h.material.name=="BackgroundCubeMaterial"||h.material.name==="CubemapFromEquirect"||h.material.name==="EquirectangularToCubeUV")){Rl&&(h.material["NEEDLE_PROGRESSIVE:IGNORE-WARNING"]||(h.material["NEEDLE_PROGRESSIVE:IGNORE-WARNING"]=!0,console.warn("Ignoring skybox or BLIT object",h,h.material.name,h.material.type)));continue}switch(h.material.type){case"LineBasicMaterial":case"LineDashedMaterial":case"PointsMaterial":case"ShadowMaterial":case"MeshDistanceMaterial":case"MeshDepthMaterial":continue}if(Rl==="color"&&h.material&&!h.object.progressive_debug_color){h.object.progressive_debug_color=!0;const d=Math.random()*16777215,m=new fS({color:d});h.object.material=m}const u=h.object;(u instanceof $u||u.isMesh)&&this.updateLODs(n,e,u,a)}const l=r.transparent;for(const h of l){const u=h.object;(u instanceof $u||u.isMesh)&&this.updateLODs(n,e,u,a)}const c=r.transmissive;for(const h of c){const u=h.object;(u instanceof $u||u.isMesh)&&this.updateLODs(n,e,u,a)}}updateLODs(n,e,i,s){var r,o;i.userData||(i.userData={});let a=i[OP];if(a||(a=new ede,i[OP]=a),a.frames++<2)return;for(const c of sd)(r=c.onBeforeUpdateLOD)==null||r.call(c,this.renderer,n,e,i);this.calculateLodLevel(e,i,a,s,Il),Il.mesh_lod=Math.round(Il.mesh_lod),Il.texture_lod=Math.round(Il.texture_lod),Il.mesh_lod>=0&&this.loadProgressiveMeshes(i,Il.mesh_lod);let l=Il.texture_lod;if(i.material&&l>=0){const c=i["DEBUG:LOD"];c!=null&&(l=c),this.loadProgressiveTextures(i.material,l)}for(const c of sd)(o=c.onAfterUpdatedLOD)==null||o.call(c,this.renderer,n,e,i,Il);a.lastLodLevel_Mesh=Il.mesh_lod,a.lastLodLevel_Texture=Il.texture_lod}loadProgressiveTextures(n,e){if(!n)return;if(Array.isArray(n)){for(const s of n)this.loadProgressiveTextures(s,e);return}let i=!1;(n[Kg]===void 0||e<n[Kg])&&(i=!0),i&&(n[Kg]=e,mi.assignTextureLOD(n,e).then(s=>{this._lodchangedlisteners.forEach(r=>r({type:"texture",level:e,object:n}))}))}loadProgressiveMeshes(n,e){if(!n)return Promise.resolve(null);if(n[Kg]!==e){n[Kg]=e;const i=n.geometry;return mi.assignMeshLOD(n,e).then(s=>(s&&n[Kg]==e&&i!=n.geometry&&this._lodchangedlisteners.forEach(r=>r({type:"mesh",level:e,object:n})),s))}return Promise.resolve(null)}static isInside(n,e){const i=n.min,s=n.max,r=(i.x+s.x)*.5,o=(i.y+s.y)*.5;return this._tempPtInside.set(r,o,i.z).applyMatrix4(e).z<0}calculateLodLevel(n,e,i,s,r){var o;if(!e){r.mesh_lod=-1,r.texture_lod=-1;return}if(!n){r.mesh_lod=-1,r.texture_lod=-1;return}let a=10+1,l=!1;if(Rl&&e["DEBUG:LOD"]!=null)return e["DEBUG:LOD"];const c=mi.getMeshLODInformation(e.geometry),h=c?.lods,u=h&&h.length>0,d=mi.getMaterialMinMaxLODsCount(e.material),m=d?.min_count!=1/0&&d.min_count>0&&d.max_count>0;if(!u&&!m){r.mesh_lod=0,r.texture_lod=0;return}u||(l=!0,a=0);const f=this.renderer.domElement.clientHeight||this.renderer.domElement.height;let g=e.geometry.boundingBox;if(e.type==="SkinnedMesh"){const y=e;if(!y.boundingBox)y.computeBoundingBox();else if(i.frames%30===0){const v=xb(y),b=y.geometry;v&&(y.geometry=v),y.computeBoundingBox(),y.geometry=b}g=y.boundingBox}if(g&&n.isPerspectiveCamera){const y=n;if(e.geometry.attributes.color&&e.geometry.attributes.color.count<100&&e.geometry.boundingSphere){this._sphere.copy(e.geometry.boundingSphere),this._sphere.applyMatrix4(e.matrixWorld);const S=n.getWorldPosition(this._tempWorldPosition);if(this._sphere.containsPoint(S)){r.mesh_lod=0,r.texture_lod=0;return}}if(this._tempBox.copy(g),this._tempBox.applyMatrix4(e.matrixWorld),Fa.isInside(this._tempBox,this.projectionScreenMatrix)){r.mesh_lod=0,r.texture_lod=0;return}if(this._tempBox.applyMatrix4(this.projectionScreenMatrix),this.renderer.xr.enabled&&y.fov>70){const S=this._tempBox.min,M=this._tempBox.max;let R=S.x,P=S.y,C=M.x,L=M.y;const B=2,z=1.5,D=(S.x+M.x)*.5,W=(S.y+M.y)*.5;R=(R-D)*B+D,P=(P-W)*B+W,C=(C-D)*B+D,L=(L-W)*B+W;const O=R<0&&C>0?0:Math.min(Math.abs(S.x),Math.abs(M.x)),F=P<0&&L>0?0:Math.min(Math.abs(S.y),Math.abs(M.y)),X=Math.max(O,F);i.lastCentrality=(z-X)*(z-X)*(z-X)}else i.lastCentrality=1;const v=this._tempBox.getSize(this._tempBoxSize);v.multiplyScalar(.5),screen.availHeight>0&&f>0&&v.multiplyScalar(f/screen.availHeight),v.x*=y.aspect;const b=n.matrixWorldInverse,A=this._tempBox2;A.copy(g),A.applyMatrix4(e.matrixWorld),A.applyMatrix4(b);const x=A.getSize(this._tempBox2Size),w=Math.max(x.x,x.y);if(Math.max(v.x,v.y)!=0&&w!=0&&(v.z=x.z/Math.max(x.x,x.y)*Math.max(v.x,v.y)),i.lastScreenCoverage=Math.max(v.x,v.y,v.z),i.lastScreenspaceVolume.copy(v),i.lastScreenCoverage*=i.lastCentrality,Rl&&Fa.debugDrawLine){const S=this.tempMatrix.copy(this.projectionScreenMatrix);S.invert();const M=Fa.corner0,R=Fa.corner1,P=Fa.corner2,C=Fa.corner3;M.copy(this._tempBox.min),R.copy(this._tempBox.max),R.x=M.x,P.copy(this._tempBox.max),P.y=M.y,C.copy(this._tempBox.max);const L=(M.z+C.z)*.5;M.z=R.z=P.z=C.z=L,M.applyMatrix4(S),R.applyMatrix4(S),P.applyMatrix4(S),C.applyMatrix4(S),Fa.debugDrawLine(M,R,255),Fa.debugDrawLine(M,P,255),Fa.debugDrawLine(R,C,255),Fa.debugDrawLine(P,C,255)}let _=999;if(h&&i.lastScreenCoverage>0){for(let S=0;S<h.length;S++)if(h[S].density/i.lastScreenCoverage<s){_=S;break}}_<a&&(a=_,l=!0)}if(l?r.mesh_lod=a:r.mesh_lod=i.lastLodLevel_Mesh,Rl&&r.mesh_lod!=i.lastLodLevel_Mesh){const y=h?.[r.mesh_lod];y&&console.log(`Mesh LOD changed: ${i.lastLodLevel_Mesh} \u2192 ${r.mesh_lod} (${y.density.toFixed(0)}) - ${e.name}`)}if(m){const y="saveData"in globalThis.navigator&&globalThis.navigator.saveData===!0;if(i.lastLodLevel_Texture<0){if(r.texture_lod=d.max_count-1,Rl){const v=d.lods[d.max_count-1];Rl&&console.log(`First Texture LOD ${r.texture_lod} (${v.max_height}px) - ${e.name}`)}}else{const v=i.lastScreenspaceVolume.x+i.lastScreenspaceVolume.y+i.lastScreenspaceVolume.z;let b=i.lastScreenCoverage*2;((o=this.context)==null?void 0:o.engine)==="model-viewer"&&(b*=2);const A=f/window.devicePixelRatio*b;for(let x=d.lods.length-1;x>=0;x--){let w=d.lods[x];if(!(y&&w.max_height>=2048)&&!(Yue()&&w.max_height>4096)&&w.max_height>A){if(r.texture_lod=x,r.texture_lod<i.lastLodLevel_Texture){const _=w.max_height;Rl&&console.log(`Texture LOD changed: ${i.lastLodLevel_Texture} \u2192 ${r.texture_lod} = ${_}px 
Screensize: ${A.toFixed(0)}px, Coverage: ${(100*i.lastScreenCoverage).toFixed(2)}%, Volume ${v.toFixed(1)} 
${e.name}`)}break}}}}else r.texture_lod=0}};let Na=Fa;Lo=new WeakMap,rd=new WeakMap,kP=new WeakMap,Yg=new WeakMap,_b=new WeakMap,bS=new WeakMap,od=new WeakMap,Na.corner0=new me,Na.corner1=new me,Na.corner2=new me,Na.corner3=new me,Na._tempPtInside=new me;class ede{constructor(){this.frames=0,this.lastLodLevel_Mesh=-1,this.lastLodLevel_Texture=-1,this.lastScreenCoverage=0,this.lastScreenspaceVolume=new me,this.lastCentrality=0}}const oW=Symbol("NEEDLE_mesh_lod"),AS=Symbol("NEEDLE_texture_lod");let xS=null;function aW(){const n=tde();n&&(n.mapURLs(function(e){return lW(),e}),lW(),xS?.disconnect(),xS=new MutationObserver(e=>{e.forEach(i=>{i.addedNodes.forEach(s=>{s instanceof HTMLElement&&s.tagName.toLowerCase()==="model-viewer"&&hW(s)})})}),xS.observe(document,{childList:!0,subtree:!0}))}function tde(){return typeof customElements>"u"?null:customElements.get("model-viewer")||(customElements.whenDefined("model-viewer").then(()=>{console.debug("[gltf-progressive] model-viewer defined"),aW()}),null)}function lW(){typeof document>"u"||document.querySelectorAll("model-viewer").forEach(n=>{hW(n)})}const cW=new WeakSet;let ide=0;function hW(n){if(!n||cW.has(n))return null;cW.add(n),console.debug("[gltf-progressive] found new model-viewer..."+ ++ide+`
`,n.getAttribute("src"));let e=null,i=null,s=null;for(let r=n;r!=null;r=Object.getPrototypeOf(r)){const o=Object.getOwnPropertySymbols(r),a=o.find(h=>h.toString()=="Symbol(renderer)"),l=o.find(h=>h.toString()=="Symbol(scene)"),c=o.find(h=>h.toString()=="Symbol(needsRender)");!e&&a!=null&&(e=n[a].threeRenderer),!i&&l!=null&&(i=n[l]),!s&&c!=null&&(s=n[c])}if(e&&i){let r=function(){if(s){let a=0,l=setInterval(()=>{if(a++>5){clearInterval(l);return}s?.call(n)},300)}};console.debug("[gltf-progressive] setup model-viewer");const o=Na.get(e,{engine:"model-viewer"});return Na.addPlugin(new nde),o.enable(),o.addEventListener("changed",()=>{s?.call(n)}),n.addEventListener("model-visibility",a=>{a.detail.visible&&s?.call(n)}),n.addEventListener("load",()=>{r()}),()=>{o.disable()}}return null}class nde{constructor(){this._didWarnAboutMissingUrl=!1}onBeforeUpdateLOD(e,i,s,r){this.tryParseMeshLOD(i,r),this.tryParseTextureLOD(i,r)}getUrl(e){if(!e)return null;let i=e.getAttribute("src");return i||(i=e.src),i||(this._didWarnAboutMissingUrl||console.warn("No url found in modelviewer",e),this._didWarnAboutMissingUrl=!0),i}tryGetCurrentGLTF(e){return e._currentGLTF}tryGetCurrentModelViewer(e){return e.element}tryParseTextureLOD(e,i){if(i[AS]==!0)return;i[AS]=!0;const s=this.tryGetCurrentGLTF(e),r=this.tryGetCurrentModelViewer(e),o=this.getUrl(r);if(o&&s&&i.material){let a=function(c){var h,u,d;if(c[AS]==!0)return;c[AS]=!0,c.userData&&(c.userData.LOD=-1);const m=Object.keys(c);for(let f=0;f<m.length;f++){const g=m[f],y=c[g];if(y?.isTexture===!0){const v=(u=(h=y.userData)==null?void 0:h.associations)==null?void 0:u.textures;if(v==null)continue;const b=s.parser.json.textures[v];if(!b){console.warn("Texture data not found for texture index "+v);continue}if((d=b?.extensions)!=null&&d[Ph]){const A=b.extensions[Ph];A&&o&&mi.registerTexture(o,y,A.lods.length,v,A)}}}};const l=i.material;if(Array.isArray(l))for(const c of l)a(c);else a(l)}}tryParseMeshLOD(e,i){var s,r;if(i[oW]==!0)return;i[oW]=!0;const o=this.tryGetCurrentModelViewer(e),a=this.getUrl(o);if(!a)return;const l=(r=(s=i.userData)==null?void 0:s.gltfExtensions)==null?void 0:r[Ph];if(l&&a){const c=i.uuid;mi.registerMesh(a,c,i,0,l.lods.length,l)}}}aW();const Jg=[];function wS(n){Jg.indexOf(n)===-1&&Jg.push(n)}function sde(n){const e=Jg.indexOf(n);e!==-1&&Jg.splice(e,1)}const qg=[];function GP(n){qg.indexOf(n)===-1&&qg.push(n)}function rde(n){const e=qg.indexOf(n);e!==-1&&qg.splice(e,1)}function uW(n){globalThis.dispatchEvent(new CustomEvent("needle-xrsession-start",{detail:n}));for(let e=0;e<Jg.length;e++)Jg[e](n)}function dW(n){globalThis.dispatchEvent(new CustomEvent("needle-xrsession-end",{detail:n}));for(let e=0;e<qg.length;e++)qg[e](n)}const Ds={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function pW(n){const e=await fetch(n);if(e.ok)return e.json();throw new Error(e.statusText)}async function ode(n){if(!n)throw new Error("No basePath supplied");return await pW(`${n}/profilesList.json`)}async function ade(n,e,i=null,s=!0){if(!n)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No basePath supplied");const r=await ode(e);let o;if(n.profiles.some(c=>{const h=r[c];return h&&(o={profileId:c,profilePath:`${e}/${h.path}`,deprecated:!!h.deprecated}),!!o}),!o){if(!i)throw new Error("No matching profile name found");const c=r[i];if(!c)throw new Error(`No matching profile name found and default profile "${i}" missing.`);o={profileId:i,profilePath:`${e}/${c.path}`,deprecated:!!c.deprecated}}const a=await pW(o.profilePath);let l;if(s){let c;if(n.handedness==="any"?c=a.layouts[Object.keys(a.layouts)[0]]:c=a.layouts[n.handedness],!c)throw new Error(`No matching handedness, ${n.handedness}, in profile ${o.profileId}`);c.assetPath&&(l=o.profilePath.replace("profile.json",c.assetPath))}return{profile:a,assetPath:l}}const lde={xAxis:0,yAxis:0,button:0,state:Ds.ComponentState.DEFAULT};function cde(n=0,e=0){let i=n,s=e;if(Math.sqrt(n*n+e*e)>1){const r=Math.atan2(e,n);i=Math.cos(r),s=Math.sin(r)}return{normalizedXAxis:i*.5+.5,normalizedYAxis:s*.5+.5}}let hde=class{constructor(n){this.componentProperty=n.componentProperty,this.states=n.states,this.valueNodeName=n.valueNodeName,this.valueNodeProperty=n.valueNodeProperty,this.valueNodeProperty===Ds.VisualResponseProperty.TRANSFORM&&(this.minNodeName=n.minNodeName,this.maxNodeName=n.maxNodeName),this.value=0,this.updateFromComponent(lde)}updateFromComponent({xAxis:n,yAxis:e,button:i,state:s}){const{normalizedXAxis:r,normalizedYAxis:o}=cde(n,e);switch(this.componentProperty){case Ds.ComponentProperty.X_AXIS:this.value=this.states.includes(s)?r:.5;break;case Ds.ComponentProperty.Y_AXIS:this.value=this.states.includes(s)?o:.5;break;case Ds.ComponentProperty.BUTTON:this.value=this.states.includes(s)?i:0;break;case Ds.ComponentProperty.STATE:this.valueNodeProperty===Ds.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(s):this.value=this.states.includes(s)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}},ude=class{constructor(n,e){if(!n||!e||!e.visualResponses||!e.gamepadIndices||Object.keys(e.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=n,this.type=e.type,this.rootNodeName=e.rootNodeName,this.touchPointNodeName=e.touchPointNodeName,this.visualResponses={},Object.keys(e.visualResponses).forEach(i=>{const s=new hde(e.visualResponses[i]);this.visualResponses[i]=s}),this.gamepadIndices=Object.assign({},e.gamepadIndices),this.values={state:Ds.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(n){if(this.values.state=Ds.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&n.buttons.length>this.gamepadIndices.button){const e=n.buttons[this.gamepadIndices.button];this.values.button=e.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,e.pressed||this.values.button===1?this.values.state=Ds.ComponentState.PRESSED:(e.touched||this.values.button>Ds.ButtonTouchThreshold)&&(this.values.state=Ds.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&n.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=n.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===Ds.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>Ds.AxisTouchThreshold&&(this.values.state=Ds.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&n.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=n.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===Ds.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>Ds.AxisTouchThreshold&&(this.values.state=Ds.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(e=>{e.updateFromComponent(this.values)})}},dde=class{constructor(n,e,i){if(!n)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No profile supplied");this.xrInputSource=n,this.assetUrl=i,this.id=e.profileId,this.layoutDescription=e.layouts[n.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(s=>{const r=this.layoutDescription.components[s];this.components[s]=new ude(s,r)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const n=[];return Object.values(this.components).forEach(e=>{n.push(e.data)}),n}updateFromGamepad(){Object.values(this.components).forEach(n=>{n.updateFromGamepad(this.xrInputSource.gamepad)})}};const xs=te("debuginput");var _S=(n=>(n.Mouse="mouse",n.Touch="touch",n.Controller="controller",n.Hand="hand",n))(_S||{}),yn=(n=>(n.PointerDown="pointerdown",n.PointerUp="pointerup",n.PointerMove="pointermove",n.KeyDown="keydown",n.KeyUp="keyup",n.KeyPressed="keypress",n))(yn||{});class kh extends PointerEvent{constructor(e,i,s){super(e,s),p(this,"clientZ"),p(this,"deviceIndex"),p(this,"origin"),p(this,"source"),p(this,"mode"),p(this,"_ray"),p(this,"space"),p(this,"isClick",!1),p(this,"isDoubleClick",!1),p(this,"_used",!1),p(this,"_pointerid"),p(this,"_pointerType"),p(this,"_type"),p(this,"metadata",{}),p(this,"intersections",new Array),p(this,"_immediatePropagationStopped",!1),p(this,"_propagationStopped",!1),this.clientZ=s.clientZ,this._pointerid=s.pointerId,this._pointerType=s.pointerType,this._type=e,this.deviceIndex=s.deviceIndex,this.origin=s.origin,this.source=i,this.mode=s.mode,this._ray=s.ray,this.space=s.device}get isSpatial(){return this.mode!="screen"}get ray(){return this._ray||(this._ray=new qr(this.space.worldPosition.clone(),this.space.worldForward.clone())),this._ray}set ray(e){this._ray=e}get hasRay(){return this._ray!==void 0}get used(){return this._used}use(){this._used=!0}get pointerId(){return this._pointerid}get pointerType(){return this._pointerType}get type(){return this._type}get immediatePropagationStopped(){return this._immediatePropagationStopped}get propagationStopped(){return this._immediatePropagationStopped||this._propagationStopped}stopImmediatePropagation(){var e;this._immediatePropagationStopped=!0,super.stopImmediatePropagation(),(e=this.source)==null||e.stopImmediatePropagation()}stopPropagation(){var e;this._propagationStopped=!0,super.stopPropagation(),(e=this.source)==null||e.stopPropagation(),xs&&console.warn("Stop propagation...",this.pointerId,this.pointerType)}}class Sb extends KeyboardEvent{constructor(e,i,s){super(e,s),p(this,"source"),this.source=i}stopImmediatePropagation(){var e;super.stopImmediatePropagation(),(e=this.source)==null||e.stopImmediatePropagation()}}class pde{constructor(e){p(this,"key"),p(this,"keyType"),p(this,"source"),this.key=e.key,this.keyType=e.type,this.source=e}}var ea=(n=>(n[n.Early=-100]="Early",n[n.Default=0]="Default",n[n.Late=100]="Late",n))(ea||{});class mW{constructor(e){p(this,"_eventListeners",{}),p(this,"_doubleClickTimeThreshold",.2),p(this,"_longPressTimeThreshold",1),p(this,"_specialCursorTrigger",0),p(this,"context"),p(this,"_pointerDown",[!1]),p(this,"_pointerUp",[!1]),p(this,"_pointerClick",[!1]),p(this,"_pointerDoubleClick",[!1]),p(this,"_pointerPressed",[!1]),p(this,"_pointerPositions",[new Y]),p(this,"_pointerPositionsLastFrame",[new Y]),p(this,"_pointerPositionsDelta",[new Y]),p(this,"_pointerPositionsRC",[new Y]),p(this,"_pointerPositionDown",[new E]),p(this,"_pointerDownTime",[]),p(this,"_pointerUpTime",[]),p(this,"_pointerUpTimestamp",[]),p(this,"_pointerIds",[]),p(this,"_pointerTypes",[""]),p(this,"_mouseWheelChanged",[!1]),p(this,"_mouseWheelDeltaY",[0]),p(this,"_pointerEvent",[]),p(this,"_pointerEventsPressed",[]),p(this,"_pointerSpace",[]),p(this,"_pressedStack",new Map),p(this,"_htmlEventSource"),p(this,"onLostFocus",()=>{for(const i in this.keysPressed)this.keysPressed[i].pressed=!1}),p(this,"onEndOfFrame",()=>{for(let i=0;i<this._pointerUp.length;i++)this._pointerUp[i]=!1;for(let i=0;i<this._pointerDown.length;i++)this._pointerDown[i]=!1;for(let i=0;i<this._pointerClick.length;i++)this._pointerClick[i]=!1;for(let i=0;i<this._pointerDoubleClick.length;i++)this._pointerDoubleClick[i]=!1;for(const i of this._pointerPositionsDelta)i.set(0,0);for(let i=0;i<this._mouseWheelChanged.length;i++)this._mouseWheelChanged[i]=!1;for(let i=0;i<this._mouseWheelDeltaY.length;i++)this._mouseWheelDeltaY[i]=0}),p(this,"onContextMenu",i=>{this.canReceiveInput(i)!==!1&&i instanceof PointerEvent&&i.pointerType}),p(this,"keysPressed",{}),p(this,"onKeyDown",i=>{if(xs&&console.log(`key down ${i.code}, ${this.context.application.hasFocus}`,i),!this.context.application.hasFocus)return;const s=this.keysPressed[i.code];if(s&&s.pressed)return;this.keysPressed[i.code]={pressed:!0,frame:this.context.time.frameCount+1,startFrame:this.context.time.frameCount+1,key:i.key,code:i.code};const r=new Sb("keydown",i,i);this.onDispatchEvent(r)}),p(this,"onKeyPressed",i=>{if(!this.context.application.hasFocus)return;const s=this.keysPressed[i.code];if(!s)return;s.pressed=!0,s.frame=this.context.time.frameCount+1;const r=new Sb("keypress",i,i);this.onDispatchEvent(r)}),p(this,"onKeyUp",i=>{if(!this.context.application.hasFocus)return;const s=this.keysPressed[i.code];if(!s)return;s.pressed=!1,s.frame=this.context.time.frameCount+1;const r=new Sb("keyup",i,i);this.onDispatchEvent(r)}),p(this,"onWheelWindow",i=>{document.pointerLockElement&&this.onMouseWheel(i)}),p(this,"onMouseWheel",i=>{if(this.canReceiveInput(i)===!1)return;this._mouseWheelDeltaY.length<=0&&this._mouseWheelDeltaY.push(0),this._mouseWheelChanged.length<=0&&this._mouseWheelChanged.push(!1),this._mouseWheelChanged[0]=!0;const s=this._mouseWheelDeltaY[0];this._mouseWheelDeltaY[0]=s+i.deltaY}),p(this,"onPointerDown",i=>{if(this.context.isInAR||this.canReceiveInput(i)===!1)return;i.target instanceof HTMLElement&&i.target.setPointerCapture(i.pointerId);const s=this.getPointerId(i);xs&&gn(`pointer down #${s}, identifier:${i.pointerId}`);const r=this.getAndUpdateSpatialObjectForScreenPosition(s,i.clientX,i.clientY),o=new kh("pointerdown",i,{origin:this,mode:"screen",deviceIndex:0,pointerId:s,button:i.button,clientX:i.clientX,clientY:i.clientY,pointerType:i.pointerType,buttonName:this.getButtonName(i),device:r,pressure:i.pressure});this.onDown(o)}),p(this,"onPointerMove",i=>{if(this.context.isInAR)return;let s=i.button;i.pointerType==="mouse"&&(s=this.getFirstPressedButtonForPointer(0)??0);const r=this.getPointerId(i,s);s===-1&&(s=r);const o=this.getAndUpdateSpatialObjectForScreenPosition(r,i.clientX,i.clientY),a=new kh("pointermove",i,{origin:this,mode:"screen",deviceIndex:0,pointerId:r,button:s,clientX:i.clientX,clientY:i.clientY,pointerType:i.pointerType,buttonName:this.getButtonName(i),device:o,pressure:i.pressure});this.onMove(a)}),p(this,"onPointerCancel",i=>{this.context.isInAR||(xs&&console.log("Pointer cancel",i),this.onPointerUp(i))}),p(this,"onPointerUp",i=>{if(this.context.isInAR)return;i.target instanceof HTMLElement&&i.target.releasePointerCapture(i.pointerId);const s=this.getPointerId(i),r=new kh("pointerup",i,{origin:this,mode:"screen",deviceIndex:0,pointerId:s,button:i.button,clientX:i.clientX,clientY:i.clientY,pointerType:i.pointerType,buttonName:this.getButtonName(i),device:this.getAndUpdateSpatialObjectForScreenPosition(s,i.clientX,i.clientY),pressure:i.pressure});this.onUp(r),this._pointerIds[s]=-1,xs&&console.log("ID="+s,"PointerId="+i.pointerId,"ALL:",[...this._pointerIds])}),p(this,"onTouchStart",i=>{if(this.context.isInAR)for(let s=0;s<i.changedTouches.length;s++){const r=i.changedTouches[s],o=this.getPointerIndex(r.identifier),a=this.getAndUpdateSpatialObjectForScreenPosition(o,r.clientX,r.clientY),l=new kh("pointerdown",i,{origin:this,mode:"screen",deviceIndex:0,pointerId:o,button:0,clientX:r.clientX,clientY:r.clientY,pointerType:"touch",buttonName:"unknown",device:a,pressure:r.force});this.onDown(l)}}),p(this,"onTouchMove",i=>{if(this.context.isInAR)for(let s=0;s<i.changedTouches.length;s++){const r=i.changedTouches[s],o=this.getPointerIndex(r.identifier),a=this.getAndUpdateSpatialObjectForScreenPosition(o,r.clientX,r.clientY),l=new kh("pointermove",i,{origin:this,mode:"screen",deviceIndex:0,pointerId:o,button:0,clientX:r.clientX,clientY:r.clientY,pointerType:"touch",buttonName:"unknown",device:a,pressure:r.force});this.onMove(l)}}),p(this,"onTouchEnd",i=>{if(this.context.isInAR)for(let s=0;s<i.changedTouches.length;s++){const r=i.changedTouches[s],o=this.getPointerIndex(r.identifier),a=new kh("pointerup",i,{origin:this,mode:"screen",deviceIndex:0,pointerId:o,button:0,clientX:r.clientX,clientY:r.clientY,pointerType:"touch",buttonName:"unknown",device:this.getAndUpdateSpatialObjectForScreenPosition(o,r.clientX,r.clientY),pressure:r.force});this.onUp(a),this._pointerIds[o]=-1}}),p(this,"tempNearPlaneVector",new E),p(this,"tempFarPlaneVector",new E),p(this,"tempLookMatrix",new he),this.context=e,this.context.post_render_callbacks.push(this.onEndOfFrame)}addEventListener(e,i,s){if(this._eventListeners[e]||(this._eventListeners[e]=[]),!i||typeof i!="function"){console.error("Invalid call to addEventListener: callback is required and must be a function!");return}s?s={...s}:s={};let r=0;s?.queue!=null&&(r=s.queue);const o=this._eventListeners[e],a=o.find(l=>l.priority===r);a?a.listeners.push({callback:i,options:s}):(o.push({priority:r,listeners:[{callback:i,options:s}]}),o.sort((l,c)=>l.priority-c.priority))}removeEventListener(e,i,s){if(!this._eventListeners[e]||!i)return;const r=this._eventListeners[e];if(s?.queue!=null){const o=r.find(l=>l.priority===s.queue);if(!o)return;const a=o.listeners.findIndex(l=>l.callback===i);a>=0&&o.listeners.splice(a,1)}else for(const o of r){const a=o.listeners.findIndex(l=>l.callback===i);a>=0&&o.listeners.splice(a,1)}}dispatchEvent(e){var i,s,r,o;let a=!1;if(e instanceof Sb){const l=this._eventListeners[e.type];if(l)for(const c of l)for(let h=0;h<c.listeners.length;h++){const u=c.listeners[h];if((s=(i=u.options)==null?void 0:i.signal)!=null&&s.aborted){c.listeners.splice(h,1),h--;continue}u.options.once&&(c.listeners.splice(h,1),h--),u.callback(e)}}if(e instanceof kh){const l=this._eventListeners[e.type];if(l)for(const c of l){if(a)break;for(let h=0;h<c.listeners.length;h++){const u=c.listeners[h];if((o=(r=u.options)==null?void 0:r.signal)!=null&&o.aborted){c.listeners.splice(h,1),h--;continue}if(e.immediatePropagationStopped){a=!0,xs&&console.log("immediatePropagationStopped",e.type);break}else e.propagationStopped&&(a=!0,xs&&console.log("propagationStopped",e.type));u.options.once&&(c.listeners.splice(h,1),h--),u.callback(e)}}}}get mousePosition(){return this._pointerPositions[0]}get mousePositionRC(){return this._pointerPositionsRC[0]}get mouseDown(){return this._pointerDown[0]}get mouseUp(){return this._pointerUp[0]}get mouseClick(){return this._pointerClick[0]}get mouseDoubleClick(){return this._pointerDoubleClick[0]}get mousePressed(){return this._pointerPressed[0]}get mouseWheelChanged(){return this.getMouseWheelChanged(0)}setCursorPointer(){this._specialCursorTrigger+=1,this.context.domElement.style.cursor="pointer"}setCursorNormal(){this._specialCursorTrigger-=1,this._specialCursorTrigger=Math.max(0,this._specialCursorTrigger),this._specialCursorTrigger===0&&(this.context.domElement.style.cursor="default")}getIsPointerIdInUse(e){for(const i of this._pointerEventsPressed)if(i.pointerId===e&&i.used)return!0;return!1}getPointerPressedCount(){let e=0;for(let i=0;i<this._pointerPressed.length;i++)this._pointerPressed[i]&&e++;return e}getPointerPosition(e){return e>=this._pointerPositions.length?null:this._pointerPositions[e]}getPointerPositionLastFrame(e){return e>=this._pointerPositionsLastFrame.length?null:this._pointerPositionsLastFrame[e]}getPointerPositionDelta(e){return e>=this._pointerPositionsDelta.length?null:this._pointerPositionsDelta[e]}getPointerPositionRC(e){return e>=this._pointerPositionsRC.length?null:this._pointerPositionsRC[e]}getPointerDown(e){return e>=this._pointerDown.length?!1:this._pointerDown[e]}getPointerUp(e){return e>=this._pointerUp.length?!1:this._pointerUp[e]}getPointerPressed(e){return e>=this._pointerPressed.length?!1:this._pointerPressed[e]}getPointerClicked(e){return e>=this._pointerClick.length?!1:this._pointerClick[e]}getPointerDoubleClicked(e){return e>=this._pointerDoubleClick.length?!1:this._pointerDoubleClick[e]}getPointerDownTime(e){return e>=this._pointerDownTime.length?-1:this._pointerDownTime[e]}getPointerUpTime(e){return e>=this._pointerUpTime.length?-1:this._pointerUpTime[e]}getPointerLongPress(e){return e>=this._pointerDownTime.length?!1:this.getPointerPressed(e)&&this.context.time.time-this._pointerDownTime[e]>this._longPressTimeThreshold}getIsMouse(e){return e<0||e>=this._pointerTypes.length?!1:this._pointerTypes[e]==="mouse"}getIsTouch(e){return e<0||e>=this._pointerTypes.length?!1:this._pointerTypes[e]==="touch"}getTouchesPressedCount(){let e=0;for(let i=0;i<this._pointerPressed.length;i++)this._pointerPressed[i]&&this.getIsTouch(i)&&e++;return e}getMouseWheelChanged(e=0){return e>=this._mouseWheelChanged.length?!1:this._mouseWheelChanged[e]}getMouseWheelDeltaY(e=0){return e>=this._mouseWheelDeltaY.length?0:this._mouseWheelDeltaY[e]}getPointerEvent(e){if(!(e>=this._pointerEvent.length))return this._pointerEvent[e]??void 0}*foreachPointerId(e){for(let i=0;i<this._pointerTypes.length;i++)if(this._pointerIsActive(i)){if(e!==void 0){const s=this._pointerTypes[i];if(Array.isArray(e)){let r=!1;for(const o of e)if(s===o){r=!0;break}if(!r)continue}else if(e!==s)continue}yield i}}*foreachTouchId(){for(let e=0;e<this._pointerTypes.length;e++)this._pointerTypes[e]==="touch"&&this._pointerIsActive[e]&&(yield e)}_pointerIsActive(e){return e<0?!1:this._pointerPressed[e]||this._pointerDown[e]||this._pointerUp[e]}onDownButton(e,i){let s=this._pressedStack.get(e);s||(s=[],this._pressedStack.set(e,s)),s.push(i)}onReleaseButton(e,i){const s=this._pressedStack.get(e);if(!s)return;const r=s.indexOf(i);r>=0&&s.splice(r,1)}getFirstPressedButtonForPointer(e){const i=this._pressedStack.get(e);if(i)return i[0]}getLatestPressedButtonForPointer(e){const i=this._pressedStack.get(e);if(i)return i[i.length-1]}getKeyDown(){for(const e in this.keysPressed){const i=this.keysPressed[e];if(i.startFrame===this.context.time.frameCount)return i.key}return null}getKeyPressed(){for(const e in this.keysPressed){const i=this.keysPressed[e];if(i.pressed)return i.key}return null}isKeyDown(e){var i;if(!this.context.application.isVisible||!this.context.application.hasFocus)return!1;const s=this.getCodeForCommonKeyName(e);if(s!==null){for(const r of s)if(this.isKeyDown(r))return!0;return!1}return((i=this.keysPressed[e])==null?void 0:i.startFrame)===this.context.time.frameCount&&this.keysPressed[e].pressed}isKeyUp(e){var i;if(!this.context.application.isVisible||!this.context.application.hasFocus)return!1;const s=this.getCodeForCommonKeyName(e);if(s!==null){for(const r of s)if(this.isKeyUp(r))return!0;return!1}return((i=this.keysPressed[e])==null?void 0:i.frame)===this.context.time.frameCount&&!this.keysPressed[e].pressed}isKeyPressed(e){var i;if(!this.context.application.isVisible||!this.context.application.hasFocus)return!1;const s=this.getCodeForCommonKeyName(e);if(s!==null){for(const r of s)if(this.isKeyPressed(r))return!0;return!1}return(i=this.keysPressed[e])==null?void 0:i.pressed}getCodeForCommonKeyName(e){if(e.length===1){if(e>="0"&&e<="9")return["Digit"+e];if(e>="a"&&e<="z")return["Key"+e.toUpperCase()];if(e==" ")return["Space"]}switch(e){case"shift":case"Shift":return["ShiftLeft","ShiftRight"];case"control":case"Control":return["ControlLeft","ControlRight"];case"alt":case"Alt":return["AltLeft","AltRight"]}return null}createInputEvent(e){switch(e.type){case"pointerdown":xs&&gn("Create Pointer down"),this.onDownButton(e.deviceIndex,e.button),this.onDown(e);break;case"pointermove":xs&&gn("Create Pointer move"),this.onMove(e);break;case"pointerup":xs&&gn("Create Pointer up"),this.onUp(e),this.onReleaseButton(e.deviceIndex,e.button);break}}convertScreenspaceToRaycastSpace(e){return e.x=(e.x-this.context.domX)/this.context.domWidth*2-1,e.y=-((e.y-this.context.domY)/this.context.domHeight)*2+1,e}bindEvents(){this.unbindEvents(),this._htmlEventSource=this.context.renderer.domElement,window.addEventListener("contextmenu",this.onContextMenu),this._htmlEventSource.addEventListener("pointerdown",this.onPointerDown,{passive:!0}),window.addEventListener("pointermove",this.onPointerMove,{passive:!0,capture:!0}),window.addEventListener("pointerup",this.onPointerUp,{passive:!0}),window.addEventListener("pointercancel",this.onPointerCancel,{passive:!0}),window.addEventListener("touchstart",this.onTouchStart,{passive:!0}),window.addEventListener("touchmove",this.onTouchMove,{passive:!0}),window.addEventListener("touchend",this.onTouchEnd,{passive:!0}),this._htmlEventSource.addEventListener("wheel",this.onMouseWheel,{passive:!0}),window.addEventListener("wheel",this.onWheelWindow,{passive:!0}),window.addEventListener("keydown",this.onKeyDown,!1),window.addEventListener("keypress",this.onKeyPressed,!1),window.addEventListener("keyup",this.onKeyUp,!1),window.addEventListener("blur",this.onLostFocus)}unbindEvents(){var e,i;window.removeEventListener("contextmenu",this.onContextMenu),(e=this._htmlEventSource)==null||e.removeEventListener("pointerdown",this.onPointerDown),window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("pointercancel",this.onPointerCancel),(i=this._htmlEventSource)==null||i.removeEventListener("wheel",this.onMouseWheel,!1),window.removeEventListener("wheel",this.onWheelWindow,!1),window.removeEventListener("keydown",this.onKeyDown,!1),window.removeEventListener("keypress",this.onKeyPressed,!1),window.removeEventListener("keyup",this.onKeyUp,!1),window.removeEventListener("blur",this.onLostFocus)}dispose(){const e=this.context.post_render_callbacks.indexOf(this.onEndOfFrame);e>=0&&this.context.post_render_callbacks.splice(e,1),this.unbindEvents()}canReceiveInput(e){var i;return e.target===((i=this.context.renderer)==null?void 0:i.domElement)||e.target===this.context.domElement||this.context.isInAR||this.context.isInAR&&e.target===document.body&&xt.isMozillaXR()?!0:(xs&&console.warn("CanReceiveInput:False for",e.target),!1)}getPointerId(e,i){return e.pointerType==="mouse"?0+(i??e.button):this.getPointerIndex(e.pointerId)}getButtonName(e){const i=e.button;if(e.pointerType==="mouse")switch(i){case 0:return"left";case 1:return"middle";case 2:return"right"}return"unknown"}getAndUpdateSpatialObjectForScreenPosition(e,i,s){let r=this._pointerSpace[e];r||(r=new ye,this._pointerSpace[e]=r),this._pointerSpace[e]=r;const o=this.context.mainCamera;if(o){const a=this.tempNearPlaneVector.set(i,s,-1);this.convertScreenspaceToRaycastSpace(a);const l=this.tempFarPlaneVector.set(a.x,a.y,1);a.unproject(o),l.unproject(o);const c=o.worldUp||mt(0,1,0).applyQuaternion(ki(o));this.tempLookMatrix.lookAt(l,a,c),r.position.set(a.x,a.y,a.z),r.quaternion.setFromRotationMatrix(this.tempLookMatrix)}return r}isInRect(e){if(this.context.isInXR)return!0;const i=this.context.domElement.getBoundingClientRect(),s=e.clientX,r=e.clientY,o=s>=i.x&&s<=i.right&&r>=i.y&&r<=i.bottom;return xs&&!o&&console.log("Not in rect",i,s,r),o}onDown(e){const i=e.pointerId;if(this.getPointerPressed(i)&&console.warn(`Received pointerDown for pointerId that is already pressed: ${i}`,xs?e:""),xs&&console.log(e.pointerType,"DOWN",i),!!this.isInRect(e)){for(this.setPointerState(i,this._pointerPressed,!0),this.setPointerState(i,this._pointerDown,!0),this.setPointerStateT(i,this._pointerEvent,e.source);i>=this._pointerTypes.length;)this._pointerTypes.push(e.pointerType);for(this._pointerTypes[i]=e.pointerType;i>=this._pointerPositionDown.length;)this._pointerPositionDown.push(new E);for(this._pointerPositionDown[i].set(e.clientX,e.clientY,e.clientZ??0);i>=this._pointerPositions.length;)this._pointerPositions.push(new Y);this._pointerPositions[i].set(e.clientX,e.clientY),i>=this._pointerDownTime.length&&this._pointerDownTime.push(0),this._pointerDownTime[i]=this.context.time.realtimeSinceStartup,this.updatePointerPosition(e),this._pointerEventsPressed.push(e),this.onDispatchEvent(e)}}onMove(e){const i=e.pointerId,s=this.getPointerPressed(i);s===!1&&!this.isInRect(e)||e.pointerType==="touch"&&!s||(this.updatePointerPosition(e),this.setPointerStateT(i,this._pointerEvent,e.source),this.onDispatchEvent(e))}onUp(e){const i=e.pointerId;if(!this.getPointerPressed(i)){xs&&console.log(e.pointerType,"UP",i,"was not down");return}xs&&console.log(e.pointerType,"UP",i),this.setPointerState(i,this._pointerPressed,!1),this.setPointerStateT(i,this._pointerEvent,e.source),this.setPointerState(i,this._pointerUp,!0),this.updatePointerPosition(e);for(let l=this._pointerEventsPressed.length-1;l>=0;l--)if(this._pointerEventsPressed[l].pointerId===i){this._pointerEventsPressed.splice(l,1);break}if(!this._pointerPositionDown[i]){xs&&zi("Received pointer up event without matching down event for button: "+i),console.warn("Received pointer up event without matching down event for button: "+i);return}const s=this._pointerUpTime[i],r=this._pointerDownTime[i],o=this.context.time.realtimeSinceStartup,a=o-r;if(i>=this._pointerUpTime.length&&this._pointerUpTime.push(-99),this._pointerUpTime[i]=o,a<1){let l=e.clientX-this._pointerPositionDown[i].x,c=e.clientY-this._pointerPositionDown[i].y,h=0;if(e.isSpatial&&e.clientZ!=null&&(h=e.clientZ-this._pointerPositionDown[i].z,l*=200,c*=200,h*=200),Math.abs(l)<5&&Math.abs(c)<5&&Math.abs(h)<5){this.setPointerState(i,this._pointerClick,!0),e.isClick=!0;const u=o-s;xs&&console.log("CLICK",i,l,c,h,u),u<this._doubleClickTimeThreshold&&u>0&&(this.setPointerState(i,this._pointerDoubleClick,!0),e.isDoubleClick=!0)}}this.onDispatchEvent(e)}updatePointerPosition(e){const i=e.pointerId;for(;i>=this._pointerPositions.length;)this._pointerPositions.push(new Y);for(;i>=this._pointerPositionsLastFrame.length;)this._pointerPositionsLastFrame.push(new Y);for(;i>=this._pointerPositionsDelta.length;)this._pointerPositionsDelta.push(new Y);const s=this._pointerPositionsLastFrame[i];s.copy(this._pointerPositions[i]);const r=this._pointerPositionsDelta[i];let o=e.clientX-s.x,a=e.clientY-s.y;if(e.source instanceof MouseEvent||e.source instanceof TouchEvent){const u=e.source;o===0&&u.movementX!==0&&(o=u.movementX||0),a===0&&u.movementY!==0&&(a=u.movementY||0)}r.x+=o,r.y+=a,this._pointerPositions[i].x=e.clientX,this._pointerPositions[i].y=e.clientY;const l=e.clientX,c=e.clientY;for(;i>=this._pointerPositionsRC.length;)this._pointerPositionsRC.push(new Y);const h=this._pointerPositionsRC[i];h.set(l,c),this.convertScreenspaceToRaycastSpace(h)}getPointerIndex(e){let i=-1;for(let s=0;s<this._pointerIds.length;s++){if(this._pointerIds[s]===e)return s;i===-1&&this._pointerIds[s]===-1&&(i=s)}return i!==-1?(this._pointerIds[i]=e,i):(xs&&console.log("PUSH pointerId:",e),this._pointerIds.push(e),this._pointerIds.length-1)}setPointerState(e,i,s){i[e]=s}setPointerStateT(e,i,s){return i[e]=s,s}onDispatchEvent(e){const i=Pt.Current;try{Pt.Current=this.context,this.dispatchEvent(e)}finally{Pt.Current=i}}}const $g=new he().makeRotationY(Math.PI),Ua=new Se().setFromAxisAngle(new E(0,1,0),Math.PI),mde=te("debugwebxr");class fde{constructor(){if(p(this,"priority",-1e5),p(this,"gameObject"),this.gameObject=new ye,this.gameObject.name="Implicit XR Rig",mde){const e=_B(16733661);e.position.y+=.5,this.gameObject.add(e)}}isXRRig(){return!0}get isActive(){return this.gameObject.visible}}const pc=te("debugwebxr"),SS=te("debugcustomgesture"),gde="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",yde="generic-trigger",vde=new Se().setFromEuler(new si(oi.degToRad(0),oi.degToRad(-90),oi.degToRad(-90))),bde=new E(.04,-.04,0);class zP{constructor(e,i,s){p(this,"xr"),p(this,"inputSource"),p(this,"index",0),p(this,"emitEvents",!0),p(this,"_connected",!0),p(this,"_isTracking",!1),p(this,"__gamepad"),p(this,"__hand"),p(this,"__side"),p(this,"_hitTestSource"),p(this,"_hasSelectEvent",!1),p(this,"_isMxInk",!1),p(this,"_isMxInkFallback",!1),p(this,"_isMetaQuestTouchController",!1),p(this,"_handJointPoses",new Map),p(this,"_gripMatrix",new he),p(this,"_gripPosition",new E),p(this,"_gripQuaternion",new Se),p(this,"_linearVelocity",new E),p(this,"_rayPositionRaw",new E),p(this,"_rayRotationRaw",new Se),p(this,"_rayMatrix",new he),p(this,"_rayPosition",new E),p(this,"_rayQuaternion",new Se),p(this,"_gripWorldPosition",new E),p(this,"_gripWorldQuaternion",new Se),p(this,"_rayWorldPosition",new E),p(this,"_rayWorldQuaternion",new Se),p(this,"_pinchPosition",new E),p(this,"_ray"),p(this,"_hand_wristDotUp"),p(this,"_object"),p(this,"_gripSpaceObject"),p(this,"_raySpaceObject"),p(this,"model",null),p(this,"_debugAxesHelper",new io(.15)),p(this,"_debugGripAxesHelper",new io(.07)),p(this,"_debugRayAxesHelper",new io(.07)),p(this,"_hitTestSourcePromise",null),p(this,"onPointerHits",r=>{}),p(this,"_needleGamepadButtons",{}),p(this,"_buttonMap",new Map),p(this,"_motioncontroller"),p(this,"_layout"),p(this,"getMotionController"),p(this,"emitPointerDownEvent",!0),p(this,"emitPointerUpEvent",!0),p(this,"emitPointerMoveEvent",!0),p(this,"pointerMoveDistanceThreshold",.03),p(this,"pointerMoveAngleThreshold",.05),p(this,"_selectButtonIndex"),p(this,"_squeezeButtonIndex"),p(this,"onSelectStart",r=>{var o,a,l,c;if(!this.emitPointerDownEvent||this.inputSource!==r.inputSource)return;this.onUpdateFrame(r.frame),this._hasSelectEvent=!0;const h=(o=this._layout)==null?void 0:o.selectComponentId,u=(c=(l=(a=this._layout)==null?void 0:a.components[h])==null?void 0:l.gamepadIndices)==null?void 0:c.button;u!==void 0&&(this._selectButtonIndex=u),!SS&&(pc&&ft.DrawDirection(this.rayWorldPosition,mt(0,.01,1).applyQuaternion(this.rayWorldQuaternion),16711680,10),this.emitPointerEvent(yn.PointerDown,this._selectButtonIndex||0,"xr-standard-trigger",!0,r))}),p(this,"onSelectEnd",r=>{this.emitPointerUpEvent&&(SS||this.inputSource===r.inputSource&&this.emitPointerEvent(yn.PointerUp,this._selectButtonIndex||0,"xr-standard-trigger",!0,r))}),p(this,"onSequeezeStart",r=>{var o,a,l;this.emitPointerDownEvent&&this.inputSource===r.inputSource&&(this._squeezeButtonIndex=(l=(a=(o=this._layout)==null?void 0:o.components["xr-standard-squeeze"])==null?void 0:a.gamepadIndices)==null?void 0:l.button,this._squeezeButtonIndex!==void 0&&(pc&&ft.DrawDirection(this.rayWorldPosition,mt(0,.01,1).applyQuaternion(this.rayWorldQuaternion),255,10),this.emitPointerEvent(yn.PointerDown,this._squeezeButtonIndex||0,"xr-standard-squeeze",!0,r)))}),p(this,"onSequeezeEnd",r=>{this.emitPointerUpEvent&&this.inputSource===r.inputSource&&this._squeezeButtonIndex!==void 0&&this.emitPointerEvent(yn.PointerUp,this._squeezeButtonIndex||0,"xr-standard-squeeze",!0,r)}),p(this,"states",{}),p(this,"_didMoveLastFrame",!1),p(this,"_lastPointerMovePosition",new E),p(this,"_lastPointerMoveQuaternion",new Se),p(this,"pointerInit"),this.xr=e,this.inputSource=i,this.index=s,this._object=new ye,this._object.name=`NeedleXRController_${s}`,pc&&(this._object.add(this._debugAxesHelper),this._gripSpaceObject=new ye,this._raySpaceObject=new ye,this._gripSpaceObject.name=`NeedleXRController_${s}_gripSpace`,this._raySpaceObject.name=`NeedleXRController_${s}_raySpace`,this._gripSpaceObject.add(this._debugGripAxesHelper),this._raySpaceObject.add(this._debugRayAxesHelper),this.xr.context.scene.add(this._gripSpaceObject),this.xr.context.scene.add(this._raySpaceObject)),this.xr.context.scene.add(this._object),this._ray=new qr,this.pointerInit={origin:this,pointerType:this.hand?"hand":"controller",deviceIndex:this.index,pointerId:-1,mode:this.inputSource.targetRayMode,ray:this._ray,device:this._object,buttonName:"none"},this.initialize(),this.subscribeEvents()}get context(){return this.xr.context}get connected(){return this._connected}get isTracking(){return this._isTracking}get gamepad(){return this.__gamepad??(this.__gamepad=this.inputSource.gamepad)}get isHand(){return this.hand!=null}get hand(){return this.__hand??(this.__hand=this.inputSource.hand)}get handObject(){return this.context.renderer.xr.getHand(this.index)}get profiles(){return this.inputSource.profiles}get layout(){return this._layout}get targetRayMode(){return this.inputSource.targetRayMode}get targetRaySpace(){return this.inputSource.targetRaySpace}get gripSpace(){return this.inputSource.gripSpace}get side(){return this.__side??(this.__side=this.inputSource.handedness)}get isRight(){return this.side==="right"}get isLeft(){return this.side==="left"}get isStylus(){return this._isMxInk}getHitTestSource(){return this._hitTestSource||this._requestHitTestSource(),this._hitTestSource}get hasHitTestSource(){return this._hitTestSource}cancelHitTestSource(){this._hitTestSource&&(this._hitTestSource.cancel(),this._hitTestSource=void 0)}get hasSelectEvent(){return this._hasSelectEvent}getHitTest(){return this.xr.getHitTest(this)}getHandJointPose(e,i){var s;if(i=i||this.xr.frame,!this.hand||!(i!=null&&i.getJointPose)||!this.xr.referenceSpace)return null;let r=(s=this._handJointPoses)==null?void 0:s.get(e);return r||(r=i.getJointPose(e,this.xr.referenceSpace),r&&this._handJointPoses.set(e,r),r)}get gripPosition(){return mt(this._gripPosition)}get gripQuaternion(){return bl(this._gripQuaternion)}get gripMatrix(){return this._gripMatrix}get gripLinearVelocity(){return mt(this._linearVelocity).applyQuaternion(Ua)}get rayPosition(){return mt(this._rayPosition)}get rayQuaternion(){return bl(this._rayQuaternion)}get gripWorldPosition(){return mt(this._gripWorldPosition)}get gripWorldQuaternion(){return bl(this._gripWorldQuaternion)}get rayWorldPosition(){return mt(this._rayWorldPosition)}updateRayWorldPosition(){var e;const i=(e=this.xr.context.mainCamera)==null?void 0:e.parent;this._rayWorldPosition.copy(this._rayPositionRaw),i&&this._rayWorldPosition.applyMatrix4(i.matrixWorld)}get rayWorldQuaternion(){return bl(this._rayWorldQuaternion)}get pinchPosition(){return mt(this._pinchPosition)}updateRayWorldQuaternion(){var e;const i=(e=this.xr.context.mainCamera)==null?void 0:e.parent,s=i?ki(i):void 0;this._rayWorldQuaternion.copy(this._rayRotationRaw).multiply(Ua),s&&this._rayWorldQuaternion.premultiply(s)}get ray(){return this._ray.origin.copy(this.rayWorldPosition),this._ray.direction.copy(mt(0,0,1).applyQuaternion(this.rayWorldQuaternion)),this._ray}get handWristDotUp(){var e;if(this._hand_wristDotUp!==void 0)return this._hand_wristDotUp;const i=(e=this.handObject)==null?void 0:e.joints.wrist;if(i){const s=mt(0,1,0).applyQuaternion(i.quaternion),r=mt(0,1,0).dot(s);return this._hand_wristDotUp=r}}get isHandUpsideDown(){return this.handWristDotUp!==void 0?this.handWristDotUp<-.7:!1}get isTeleportGesture(){var e;return this.isHandUpsideDown&&((e=this.getGesture("pinch"))==null?void 0:e.isDown)}get object(){return this._object}async getModelUrl(){var e;return(e=this.getMotionController)==null?void 0:e.then(i=>i?.assetUrl||null)}_requestHitTestSource(){var e;return this._hitTestSourcePromise?this._hitTestSourcePromise:this.xr.mode==="immersive-ar"&&this.inputSource.targetRayMode==="tracked-pointer"&&this.xr.session.requestHitTestSourceForTransientInput?this._hitTestSourcePromise=((e=this.xr.session.requestHitTestSourceForTransientInput({profile:this.inputSource.profiles[0],offsetRay:new XRRay}))==null?void 0:e.then(i=>(this._hitTestSourcePromise=null,this.connected?this._hitTestSource=i:(i.cancel(),null))))??null:null}onUpdate(e){performance.mark("NeedleXRController onUpdate start"),this.onUpdateFrame(e),this.updateInputEvents(),this.onUpdateMove(),performance.mark("NeedleXRController onUpdate end"),performance.measure("NeedleXRController onUpdate","NeedleXRController onUpdate start","NeedleXRController onUpdate end")}onRenderDebug(){var e;ft.DrawSphere(this.rayWorldPosition,.003),ft.DrawDirection(this.rayWorldPosition,mt(0,0,10).applyQuaternion(this.rayWorldQuaternion));const i=(this.inputSource.gripSpace?this.gripWorldPosition:this.object.worldPosition).sub(this.object.worldForward.multiplyScalar(.1)),s=this.inputSource.profiles.join(`
`);let r=`Controller[${this.index}] (${this.inputSource.targetRayMode}, ${this.side})
C:${this.connected?"x":"-"} T:${this.isTracking?"x":"-"} Hand:${this.inputSource.hand?"x":"-"} Pen: ${this._isMxInk?"x":"-"}`;if(this.inputSource.hand&&(r+=`
Pinch: ${(e=this.getGesture("pinch"))==null?void 0:e.value.toFixed(3)}`),r+=`
`+s,r+=`
`+(this.inputSource.targetRaySpace?"Ray: x":"Ray: -")+(this.inputSource.gripSpace?" Grip: x":" Grip: -")+(this.inputSource.gamepad?` Gamepad: ${this.inputSource.gamepad.mapping}`:" Gamepad: -"),this.inputSource.gamepad){const o=this.inputSource.gamepad;let a="[btns "+o.buttons.length+"]: "+o.buttons.map(l=>l.value.toPrecision(1)).join(",");a+=`
[axes `+o.axes.length+"]: "+o.axes.map(l=>l.toPrecision(1)).join(","),r+=`
`+a}ft.DrawLabel(i,r,.006)}onUpdateFrame(e){var i,s,r,o,a,l,c,h,u,d,m;if(this._handJointPoses.clear(),this._hand_wristDotUp=void 0,!this.xr.referenceSpace){this._isTracking=!1;return}const f=e.getPose(this.inputSource.targetRaySpace,this.xr.referenceSpace);this._isTracking=f!=null;let g=null,y=null,v=null,b=null;if(f){const _=f.transform;if(this._rayMatrix.fromArray(_.matrix).premultiply($g),this._rayMatrix.decompose(this._rayPosition,this._rayQuaternion,mt(1,1,1)),v=mt(_.position),b=bl(_.orientation),this._isMxInk&&!this._isMxInkFallback){const S=mt(.013,0,-.028).applyQuaternion(b);v.add(S),this._rayPosition.add(S)}this._rayPositionRaw.copy(v),this._rayRotationRaw.copy(b)}if(this.inputSource.gripSpace){const _=e.getPose(this.inputSource.gripSpace,this.xr.referenceSpace);if(_){const S=_.transform;if(g=mt(S.position),y=bl(S.orientation),this._gripMatrix.fromArray(S.matrix).premultiply($g),this._gripMatrix.decompose(this._gripPosition,this._gripQuaternion,mt(1,1,1)),"linearVelocity"in _&&_.linearVelocity){const M=_.linearVelocity;this._linearVelocity.set(M.x,M.y,M.z)}}}(i=this.xr.context.mainCamera)!=null&&i.parent&&(this._object.parent!==((s=this.xr.context.mainCamera)==null?void 0:s.parent)&&this.xr.context.mainCamera.parent.add(this._object),this._gripSpaceObject!==void 0&&((r=this._gripSpaceObject)==null?void 0:r.parent)!==((o=this.xr.context.mainCamera)==null?void 0:o.parent)&&this.xr.context.mainCamera.parent.add(this._gripSpaceObject),this._raySpaceObject!==void 0&&((a=this._raySpaceObject)==null?void 0:a.parent)!==((l=this.xr.context.mainCamera)==null?void 0:l.parent)&&this.xr.context.mainCamera.parent.add(this._raySpaceObject));const A=this.hand;if(A){let _=!1;const S=A.get("wrist"),M=S&&this.getHandJointPose(S,e);if(M){_=!0;const C=M.transform.position,L=M.transform.orientation;this._object.position.set(C.x,C.y,C.z),this._object.quaternion.set(L.x,L.y,L.z,L.w).multiply(Ua)}_||(this._object.position.copy(this._rayPosition),this._object.quaternion.copy(this._rayQuaternion).multiply(Ua));const R=A.get("middle-finger-metacarpal"),P=R&&this.getHandJointPose(R,e);P&&(this._gripMatrix.fromArray(P.transform.matrix).premultiply($g),this._gripMatrix.decompose(this._gripPosition,this._gripQuaternion,mt(1,1,1)),g=mt().copy(P.transform.position),y=bl().copy(P.transform.orientation),y.multiply(vde),g.add(mt(bde).applyQuaternion(y)))}else this.inputSource.gripSpace&&this.targetRayMode==="transient-pointer"&&g&&y?(this._object.position.copy(g),this._object.quaternion.copy(y).multiply(Ua)):v&&b&&(this._object.position.copy(v),this._object.quaternion.copy(b).multiply(Ua));pc&&(v&&b&&((c=this._raySpaceObject)==null||c.position.copy(v),(h=this._raySpaceObject)==null||h.quaternion.copy(b).multiply(Ua)),g&&y&&((u=this._gripSpaceObject)==null||u.position.copy(g),(d=this._gripSpaceObject)==null||d.quaternion.copy(y).multiply(Ua)));const x=(m=this.xr.context.mainCamera)==null?void 0:m.parent,w=x?ki(x):void 0;g&&y&&(this._gripWorldPosition.copy(g),x&&this._gripWorldPosition.applyMatrix4(x.matrixWorld),this._gripWorldQuaternion.copy(y),this._gripWorldQuaternion.multiply(Ua),w&&this._gripWorldQuaternion.premultiply(w)),this.updateRayWorldPosition(),this.updateRayWorldQuaternion()}onDisconnected(){var e,i,s,r,o,a;this._connected=!1,pc&&console.warn("Controller disconnected",this.index);for(const l of this._object.children)this.xr.context.scene.attach(l);(e=this._object)==null||e.removeFromParent(),(i=this._debugAxesHelper)==null||i.removeFromParent(),(s=this._debugGripAxesHelper)==null||s.removeFromParent(),(r=this._debugRayAxesHelper)==null||r.removeFromParent(),(o=this._gripSpaceObject)==null||o.removeFromParent(),(a=this._raySpaceObject)==null||a.removeFromParent(),this.unsubscribeEvents(),this._hitTestSource&&(this._hitTestSource.cancel(),this._hitTestSource=void 0)}getButton(e){var i;if(!this._layout)return;switch(e){case"primary-button":if(this.isLeft)e="x-button";else if(this.isRight)e="a-button";else return;break;case"primary":return this.hand?this.getGesture("pinch"):this.toNeedleGamepadButton(0,e)}if(this._buttonMap.has(e))return this.toNeedleGamepadButton(this._buttonMap.get(e),e);const s=(i=this._layout)==null?void 0:i.components[e];if(s!=null&&s.gamepadIndices)switch(s.type){case"button":case"squeeze":if(this.inputSource.gamepad){const r=s.gamepadIndices.button;return this._buttonMap.set(e,r),this.toNeedleGamepadButton(r,e)}break;default:console.warn("Unsupported component type",s.type);break}this._buttonMap.set(e,void 0)}getGesture(e){const i=this.states[e];if(!i)return null;this.states[e]=i;const s=this._needleGamepadButtons[e]||new gW(void 0,e);return s.pressed=i.pressed,s.value=i.value,s.isDown=i.isDown,s.isUp=i.isUp,this._needleGamepadButtons[e]=s,s}getPointerId(e){if((e==="primary"||e==="pinch")&&(e=0),typeof e!="number"){const i=this._buttonMap.get(e);if(i===void 0)return;e=i}return this.index*10+e}toNeedleGamepadButton(e,i){var s,r;if(!((s=this.inputSource.gamepad)!=null&&s.buttons))return;const o=(r=this.inputSource.gamepad)==null?void 0:r.buttons[e],a=this.states[e],l=this._needleGamepadButtons[e]||new gW(e,i);return o&&(l.pressed=o.pressed,l.value=o.value,l.touched=o.touched),a&&(l.isDown=a.isDown,l.isUp=a.isUp),this._needleGamepadButtons[e]=l,l}getStick(e){var i,s,r,o,a,l,c,h,u;if(!this._layout)return{x:0,y:0,z:0};if(e==="primary"){const m=((i=this.inputSource.gamepad)==null?void 0:i.axes[0])||0,f=((s=this.inputSource.gamepad)==null?void 0:s.axes[1])||0,g=((o=(r=this.inputSource.gamepad)==null?void 0:r.buttons[3])==null?void 0:o.value)||0;return{x:m,y:f,z:g}}const d=(a=this._layout)==null?void 0:a.components[e];if(d!=null&&d.gamepadIndices)switch(d.type){case"thumbstick":if(this.inputSource.gamepad){const m=d.gamepadIndices.xAxis,f=d.gamepadIndices.yAxis;let g=(l=this.inputSource.gamepad)==null?void 0:l.axes[m],y=(c=this.inputSource.gamepad)==null?void 0:c.axes[f];g*=-1,y*=-1;const v=d.gamepadIndices.button,b=(u=(h=this.inputSource.gamepad)==null?void 0:h.buttons[v])==null?void 0:u.value;return{x:g,y,z:b}}}return{x:0,y:0,z:0}}initialize(){var e;if(this._hasSelectEvent=this.profiles.includes("generic-hand-select")||this.profiles.some(i=>i.startsWith("generic-trigger")),this._isMetaQuestTouchController=this.profiles.includes("meta-quest-touch-plus")||this.profiles.includes("oculus-touch-v3"),this._isMxInk=this.profiles.includes("logitech-mx-ink")||this.profiles.includes("meta-quest-touch-plus")&&((e=this.inputSource.gamepad)==null?void 0:e.buttons.length)===7,!this._layout){if(this.inputSource.targetRayMode==="transient-pointer")return;const i=ade(this.inputSource,gde,yde);this.getMotionController=i.then(s=>{var r;if(!this.connected)return null;this._isMxInk&&!s.assetPath&&(pc&&console.log("Falling back to custom MX Ink model",s.profile,s.assetPath),s.assetPath="https://cdn.needle.tools/static/models/controllers/logitech_vr_stylus_v1.3.1_grip_questos68.glb",this._isMxInkFallback=!0),this._motioncontroller=new dde(this.inputSource,s.profile,s.assetPath||"");const o=s.profile.layouts[this.inputSource.handedness];if(this._layout=o,this._layout&&!((r=this._layout.gamepad)!=null&&r.length)){this._layout.gamepad=[];for(const a in this._layout.components){const l=this._layout.components[a];this._layout.gamepad[l.gamepadIndices.button]=a}}return this._motioncontroller}).catch(s=>(this.inputSource&&console.warn("Couldn't initialize motion controller profile for ",this.inputSource,s),null))}}subscribeEvents(){this.xr.session.addEventListener("selectstart",this.onSelectStart),this.xr.session.addEventListener("selectend",this.onSelectEnd),this.xr.session.addEventListener("squeezestart",this.onSequeezeStart),this.xr.session.addEventListener("squeezeend",this.onSequeezeEnd)}unsubscribeEvents(){this.xr.session.removeEventListener("selectstart",this.onSelectStart),this.xr.session.removeEventListener("selectend",this.onSelectEnd),this.xr.session.removeEventListener("squeezestart",this.onSequeezeStart),this.xr.session.removeEventListener("squeezeend",this.onSequeezeEnd)}updateInputEvents(){var e,i,s;if((e=this.gamepad)!=null&&e.buttons){for(let r=0;r<this.gamepad.buttons.length;r++){const o=this.gamepad.buttons[r],a=this.states[r]||new fW;let l=null;this._isMxInk&&(r===4||r===5)?(o.value>0&&!a.pressed?(l="pointerdown",a.isDown=!0,a.isUp=!1):o.value===0&&a.pressed?(l="pointerup",a.isDown=!1,a.isUp=!0):a.pressed&&(l="pointermove",a.isDown=!1,a.isUp=!1),a.pressed=o.value>0,a.value=o.value):(o.pressed&&!a.pressed?(l="pointerdown",a.isDown=!0,a.isUp=!1):!o.pressed&&a.pressed?(l="pointerup",a.isDown=!1,a.isUp=!0):(a.isDown=!1,a.isUp=!1),a.pressed=o.pressed,a.value=o.value),this.states[r]=a;const c=r!==this._selectButtonIndex&&r!==this._squeezeButtonIndex;if(l!=null&&c){let h=(i=this._layout)==null?void 0:i.gamepad[r];this._isMxInk&&r===4&&(h="stylus-touch"),this._isMxInk&&r===5&&(h="stylus-tip"),(pc||SS)&&console.log("Emitting pointer event",l,r,h,o.value,this.gamepad,this._layout),this.emitPointerEvent(l,r,h??"none",!1,null,o.value)}}if(this._isMetaQuestTouchController){const r=this.gamepad.buttons.length-1,o=this.states[r];if(o&&o.isDown){const a=this.context.menu;a.spatialMenuIsVisible?a.setSpatialMenuVisible(!1):this.context.menu.setSpatialMenuVisible(!0)}}}if(this.hand){const r=this.handObject;if(r){const o=r.joints["index-finger-tip"],a=r.joints["thumb-tip"];if(o&&a){const l=o.position.distanceTo(a.position);this._pinchPosition.lerpVectors(o.position,a.position,.5);const c=(s=this.xr.context.mainCamera)==null?void 0:s.parent;if(c&&this._pinchPosition.applyMatrix4(c.matrixWorld),l!==0){const h=this.states.pinch||new fW,u=(.02+.01)*1.5;h.value=1-(l-.02)/u;const d=l<.02-.01,m=l>.02+.01;d&&!h.pressed?(SS&&console.log("pinch start",l),h.isDown=!0,h.isUp=!1,h.pressed=!0):m&&h.pressed?(h.isDown=!1,h.isUp=!0,h.pressed=!1):(h.isDown=!1,h.isUp=!1),this.states.pinch=h}}}}}onUpdateMove(){var e,i;if(!this.emitPointerMoveEvent)return;let s=!1;if(this._lastPointerMovePosition.distanceTo(this.gripWorldPosition)>this.pointerMoveDistanceThreshold*this.xr.rigScale&&(s=!0),s||this._lastPointerMoveQuaternion.angleTo(this.gripWorldQuaternion)>this.pointerMoveAngleThreshold&&(s=!0),s){this._didMoveLastFrame=!0,this._lastPointerMovePosition.copy(this.gripWorldPosition),this._lastPointerMoveQuaternion.copy(this.gripWorldQuaternion),pc&&ft.DrawLabel(this.rayWorldPosition.add(this.object.worldForward.multiplyScalar(.1)),"move",.01);let r=this.xr.context.input.getFirstPressedButtonForPointer(this.index);r===void 0&&(r=0);const o=(i=(e=this.gamepad)==null?void 0:e.buttons[r])==null?void 0:i.value;this.emitPointerEvent("pointermove",r,"none",!1,null,o)}else this._didMoveLastFrame=!1}emitPointerEvent(e,i,s,r,o=null,a){if(!this.emitEvents){pc&&e!==yn.PointerMove&&console.warn("Pointer events are disabled for this controller",this.index,e,i);return}if(this.xr.mode==="immersive-vr"||this.xr.isPassThrough){this.pointerInit.origin=this,this.pointerInit.pointerId=this.getPointerId(i),this.pointerInit.pointerType=this.hand?"hand":"controller",this.pointerInit.button=i,this.pointerInit.buttonName=s,this.pointerInit.isPrimary=r,this.pointerInit.mode=this.inputSource.targetRayMode,this.pointerInit.ray=this.ray,this.pointerInit.device=this.object,this.pointerInit.pressure=a,this.pointerInit.clientX=this._rayPosition.x/this.xr.rigScale,this.pointerInit.clientY=this._rayPosition.y/this.xr.rigScale,this.pointerInit.clientZ=this._rayPosition.z/this.xr.rigScale;const l=Pt.Current;Pt.Current=this.xr.context,pc&&e!=="pointermove"&&console.warn("Pointer event",e,i,s,{...this.pointerInit}),this.xr.context.input.createInputEvent(new kh(e,o,this.pointerInit)),Pt.Current=l}}}class fW{constructor(){p(this,"isDown",!1),p(this,"isUp",!1),p(this,"pressed",!1),p(this,"value",0)}}class gW{constructor(e,i){p(this,"index"),p(this,"name"),p(this,"touched",!1),p(this,"pressed",!1),p(this,"value",0),p(this,"isDown",!1),p(this,"isUp",!1),this.index=e,this.name=i}}const e0=new Map,t0=new Map;let yW=0;function ad(n,e,i){if(e0.has(e)||e0.set(e,new Array),e0.get(e).push({method:n,options:{once:!1,...i}}),yW<30){const s=t0.get(e);s&&s?.length>100&&(yW+=1,console.warn(`You have ${s.length} methods registered for Event ${e}.

This might be a performance issue!
Consider unregistering the methods when they are not needed anymore!

To unregister you can call the function returned by your event hook (e.g.const unregister = onStart(...)) 

or by using the once option like onStart(()=>{}, { once:true }).

See https://engine.needle.tools/docs/scripting.html#special-lifecycle-hooks for more information.`))}}function ld(n,e){const i=t0.get(e);if(i){for(let r=0;r<i.length;r++)if(i[r].method===n){i.splice(r,1);return}}const s=e0.get(e);if(s){for(let r=0;r<s.length;r++)if(s[r].method===n){s.splice(r,1);return}}}function mc(n,e){e===wi.ContextCreated&&FP.delete(n),vW(n,e)}function vW(n,e){e===Yi.Start&&e0.get(wi.ContextCreated)&&vW(n,wi.ContextCreated);const i=e===Yi.Start||e===wi.ContextCreated,s=t0.get(e);s&&s.length>0&&AW(n,s,i);const r=e0.get(e);if(r&&r.length>0){const o=[...r];r.length=0,AW(n,o,i),o.length>0&&(t0.has(e)||t0.set(e,new Array),t0.get(e).push(...o))}}const CS=new Array,bW={context:null};function AW(n,e,i){var s,r;CS.length=0;for(let a=0;a<e.length;a++)CS.push(e[a]);let o=FP.get(n);for(let a=0;a<CS.length;a++){const l=CS[a];let c=!0;if(o&&o.has(l)&&(c=!1),c)try{bW.context=n,(s=l.method)==null||s.call(bW,n)}catch(h){console.error("Error in lifecycle method",h)}if((r=l.options)!=null&&r.once){for(let h=0;h<e.length;h++)if(e[h]===l){e.splice(h,1);break}}else i&&(o||(o=new Set,FP.set(n,o)),o.add(l))}}const FP=new WeakMap,NP=2,fc=4,Dh=4,UP=4,cd=new Int32Array(2),xW=new Float32Array(cd.buffer),wW=new Float64Array(cd.buffer),MS=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;class bu{constructor(e,i){this.low=e|0,this.high=i|0}static create(e,i){return e==0&&i==0?bu.ZERO:new bu(e,i)}toFloat64(){return(this.low>>>0)+this.high*4294967296}equals(e){return this.low==e.low&&this.high==e.high}}bu.ZERO=new bu(0,0);var VP;(function(n){n[n.UTF8_BYTES=1]="UTF8_BYTES",n[n.UTF16_STRING=2]="UTF16_STRING"})(VP||(VP={}));class p1{constructor(e){this.bytes_=e,this.position_=0}static allocate(e){return new p1(new Uint8Array(e))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(e){this.position_=e}capacity(){return this.bytes_.length}readInt8(e){return this.readUint8(e)<<24>>24}readUint8(e){return this.bytes_[e]}readInt16(e){return this.readUint16(e)<<16>>16}readUint16(e){return this.bytes_[e]|this.bytes_[e+1]<<8}readInt32(e){return this.bytes_[e]|this.bytes_[e+1]<<8|this.bytes_[e+2]<<16|this.bytes_[e+3]<<24}readUint32(e){return this.readInt32(e)>>>0}readInt64(e){return new bu(this.readInt32(e),this.readInt32(e+4))}readUint64(e){return new bu(this.readUint32(e),this.readUint32(e+4))}readFloat32(e){return cd[0]=this.readInt32(e),xW[0]}readFloat64(e){return cd[MS?0:1]=this.readInt32(e),cd[MS?1:0]=this.readInt32(e+4),wW[0]}writeInt8(e,i){this.bytes_[e]=i}writeUint8(e,i){this.bytes_[e]=i}writeInt16(e,i){this.bytes_[e]=i,this.bytes_[e+1]=i>>8}writeUint16(e,i){this.bytes_[e]=i,this.bytes_[e+1]=i>>8}writeInt32(e,i){this.bytes_[e]=i,this.bytes_[e+1]=i>>8,this.bytes_[e+2]=i>>16,this.bytes_[e+3]=i>>24}writeUint32(e,i){this.bytes_[e]=i,this.bytes_[e+1]=i>>8,this.bytes_[e+2]=i>>16,this.bytes_[e+3]=i>>24}writeInt64(e,i){this.writeInt32(e,i.low),this.writeInt32(e+4,i.high)}writeUint64(e,i){this.writeUint32(e,i.low),this.writeUint32(e+4,i.high)}writeFloat32(e,i){xW[0]=i,this.writeInt32(e,cd[0])}writeFloat64(e,i){wW[0]=i,this.writeInt32(e,cd[MS?0:1]),this.writeInt32(e+4,cd[MS?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+fc+Dh)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let e="";for(let i=0;i<Dh;i++)e+=String.fromCharCode(this.readInt8(this.position_+fc+i));return e}__offset(e,i){const s=e-this.readInt32(e);return i<this.readInt16(s)?this.readInt16(s+i):0}__union(e,i){return e.bb_pos=i+this.readInt32(i),e.bb=this,e}__string(e,i){e+=this.readInt32(e);const s=this.readInt32(e);let r="",o=0;if(e+=fc,i===VP.UTF8_BYTES)return this.bytes_.subarray(e,e+s);for(;o<s;){let a;const l=this.readUint8(e+o++);if(l<192)a=l;else{const c=this.readUint8(e+o++);if(l<224)a=(l&31)<<6|c&63;else{const h=this.readUint8(e+o++);if(l<240)a=(l&15)<<12|(c&63)<<6|h&63;else{const u=this.readUint8(e+o++);a=(l&7)<<18|(c&63)<<12|(h&63)<<6|u&63}}}a<65536?r+=String.fromCharCode(a):(a-=65536,r+=String.fromCharCode((a>>10)+55296,(a&1024-1)+56320))}return r}__union_with_string(e,i){return typeof e=="string"?this.__string(i):this.__union(e,i)}__indirect(e){return e+this.readInt32(e)}__vector(e){return e+this.readInt32(e)+fc}__vector_len(e){return this.readInt32(e+this.readInt32(e))}__has_identifier(e){if(e.length!=Dh)throw new Error("FlatBuffers: file identifier must be length "+Dh);for(let i=0;i<Dh;i++)if(e.charCodeAt(i)!=this.readInt8(this.position()+fc+i))return!1;return!0}createLong(e,i){return bu.create(e,i)}createScalarList(e,i){const s=[];for(let r=0;r<i;++r)e(r)!==null&&s.push(e(r));return s}createObjList(e,i){const s=[];for(let r=0;r<i;++r){const o=e(r);o!==null&&s.push(o.unpack())}return s}}class m1{constructor(e){this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null;let i;e?i=e:i=1024,this.bb=p1.allocate(i),this.space=i}clear(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null}forceDefaults(e){this.force_defaults=e}dataBuffer(){return this.bb}asUint8Array(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())}prep(e,i){e>this.minalign&&(this.minalign=e);const s=~(this.bb.capacity()-this.space+i)+1&e-1;for(;this.space<s+e+i;){const r=this.bb.capacity();this.bb=m1.growByteBuffer(this.bb),this.space+=this.bb.capacity()-r}this.pad(s)}pad(e){for(let i=0;i<e;i++)this.bb.writeInt8(--this.space,0)}writeInt8(e){this.bb.writeInt8(this.space-=1,e)}writeInt16(e){this.bb.writeInt16(this.space-=2,e)}writeInt32(e){this.bb.writeInt32(this.space-=4,e)}writeInt64(e){this.bb.writeInt64(this.space-=8,e)}writeFloat32(e){this.bb.writeFloat32(this.space-=4,e)}writeFloat64(e){this.bb.writeFloat64(this.space-=8,e)}addInt8(e){this.prep(1,0),this.writeInt8(e)}addInt16(e){this.prep(2,0),this.writeInt16(e)}addInt32(e){this.prep(4,0),this.writeInt32(e)}addInt64(e){this.prep(8,0),this.writeInt64(e)}addFloat32(e){this.prep(4,0),this.writeFloat32(e)}addFloat64(e){this.prep(8,0),this.writeFloat64(e)}addFieldInt8(e,i,s){(this.force_defaults||i!=s)&&(this.addInt8(i),this.slot(e))}addFieldInt16(e,i,s){(this.force_defaults||i!=s)&&(this.addInt16(i),this.slot(e))}addFieldInt32(e,i,s){(this.force_defaults||i!=s)&&(this.addInt32(i),this.slot(e))}addFieldInt64(e,i,s){(this.force_defaults||!i.equals(s))&&(this.addInt64(i),this.slot(e))}addFieldFloat32(e,i,s){(this.force_defaults||i!=s)&&(this.addFloat32(i),this.slot(e))}addFieldFloat64(e,i,s){(this.force_defaults||i!=s)&&(this.addFloat64(i),this.slot(e))}addFieldOffset(e,i,s){(this.force_defaults||i!=s)&&(this.addOffset(i),this.slot(e))}addFieldStruct(e,i,s){i!=s&&(this.nested(i),this.slot(e))}nested(e){if(e!=this.offset())throw new Error("FlatBuffers: struct must be serialized inline.")}notNested(){if(this.isNested)throw new Error("FlatBuffers: object serialization must not be nested.")}slot(e){this.vtable!==null&&(this.vtable[e]=this.offset())}offset(){return this.bb.capacity()-this.space}static growByteBuffer(e){const i=e.capacity();if(i&3221225472)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");const s=i<<1,r=p1.allocate(s);return r.setPosition(s-i),r.bytes().set(e.bytes(),s-i),r}addOffset(e){this.prep(fc,0),this.writeInt32(this.offset()-e+fc)}startObject(e){this.notNested(),this.vtable==null&&(this.vtable=[]),this.vtable_in_use=e;for(let i=0;i<e;i++)this.vtable[i]=0;this.isNested=!0,this.object_start=this.offset()}endObject(){if(this.vtable==null||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);const e=this.offset();let i=this.vtable_in_use-1;for(;i>=0&&this.vtable[i]==0;i--);const s=i+1;for(;i>=0;i--)this.addInt16(this.vtable[i]!=0?e-this.vtable[i]:0);const r=2;this.addInt16(e-this.object_start);const o=(s+r)*NP;this.addInt16(o);let a=0;const l=this.space;e:for(i=0;i<this.vtables.length;i++){const c=this.bb.capacity()-this.vtables[i];if(o==this.bb.readInt16(c)){for(let h=NP;h<o;h+=NP)if(this.bb.readInt16(l+h)!=this.bb.readInt16(c+h))continue e;a=this.vtables[i];break}}return a?(this.space=this.bb.capacity()-e,this.bb.writeInt32(this.space,a-e)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-e,this.offset()-e)),this.isNested=!1,e}finish(e,i,s){const r=s?UP:0;if(i){const o=i;if(this.prep(this.minalign,fc+Dh+r),o.length!=Dh)throw new Error("FlatBuffers: file identifier must be length "+Dh);for(let a=Dh-1;a>=0;a--)this.writeInt8(o.charCodeAt(a))}this.prep(this.minalign,fc+r),this.addOffset(e),r&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)}finishSizePrefixed(e,i){this.finish(e,i,!0)}requiredField(e,i){const s=this.bb.capacity()-e,r=s-this.bb.readInt32(s);if(this.bb.readInt16(r+i)==0)throw new Error("FlatBuffers: field "+i+" must be set")}startVector(e,i,s){this.notNested(),this.vector_num_elems=i,this.prep(fc,e*i),this.prep(s,e*i)}endVector(){return this.writeInt32(this.vector_num_elems),this.offset()}createSharedString(e){if(!e)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(e))return this.string_maps.get(e);const i=this.createString(e);return this.string_maps.set(e,i),i}createString(e){if(!e)return 0;let i;if(e instanceof Uint8Array)i=e;else{i=[];let s=0;for(;s<e.length;){let r;const o=e.charCodeAt(s++);if(o<55296||o>=56320)r=o;else{const a=e.charCodeAt(s++);r=(o<<10)+a+(65536-56623104-56320)}r<128?i.push(r):(r<2048?i.push(r>>6&31|192):(r<65536?i.push(r>>12&15|224):i.push(r>>18&7|240,r>>12&63|128),i.push(r>>6&63|128)),i.push(r&63|128))}}this.addInt8(0),this.startVector(1,i.length,1),this.bb.setPosition(this.space-=i.length);for(let s=0,r=this.space,o=this.bb.bytes();s<i.length;s++)o[r++]=i[s];return this.endVector()}createLong(e,i){return bu.create(e,i)}createObjectOffset(e){return e===null?0:typeof e=="string"?this.createString(e):e.pack(this)}createObjectOffsetList(e){const i=[];for(let s=0;s<e.length;++s){const r=e[s];if(r!==null)i.push(this.createObjectOffset(r));else throw new Error("FlatBuffers: Argument for createObjectOffsetList cannot contain null.")}return i}createStructOffsetList(e,i){return i(this,e.length),this.createObjectOffsetList(e),this.endVector()}}const XP={};function WP(n,e){XP[n]=e}function _W(n){const e=n.getBufferIdentifier(),i=XP[e];return i(n)}function SW(n){return typeof n.guid=="function"?n.guid():null}function ES(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var CW={exports:{}};(function(n){var e={};e.useBlobBuilder=function(){try{return new Blob([]),!1}catch{return!0}}(),e.useArrayBufferView=!e.useBlobBuilder&&function(){try{return new Blob([new Uint8Array([])]).size===0}catch{return!0}}(),n.exports.binaryFeatures=e;var i=n.exports.BlobBuilder;typeof window<"u"&&(i=n.exports.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder);function s(){this._pieces=[],this._parts=[]}s.prototype.append=function(r){typeof r=="number"?this._pieces.push(r):(this.flush(),this._parts.push(r))},s.prototype.flush=function(){if(this._pieces.length>0){var r=new Uint8Array(this._pieces);e.useArrayBufferView||(r=r.buffer),this._parts.push(r),this._pieces=[]}},s.prototype.getBuffer=function(){if(this.flush(),e.useBlobBuilder){for(var r=new i,o=0,a=this._parts.length;o<a;o++)r.append(this._parts[o]);return r.getBlob()}else return new Blob(this._parts)},n.exports.BufferBuilder=s})(CW);var MW=CW.exports,Ade=MW.BufferBuilder,EW=MW.binaryFeatures,xde={unpack:function(n){var e=new $s(n);return e.unpack()},pack:function(n){var e=new er;e.pack(n);var i=e.getBuffer();return i}},wde=xde;function $s(n){this.index=0,this.dataBuffer=n,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}$s.prototype.unpack=function(){var n=this.unpack_uint8();if(n<128)return n;if((n^224)<32)return(n^224)-32;var e;if((e=n^160)<=15)return this.unpack_raw(e);if((e=n^176)<=15)return this.unpack_string(e);if((e=n^144)<=15)return this.unpack_array(e);if((e=n^128)<=15)return this.unpack_map(e);switch(n){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return e=this.unpack_uint16(),this.unpack_string(e);case 217:return e=this.unpack_uint32(),this.unpack_string(e);case 218:return e=this.unpack_uint16(),this.unpack_raw(e);case 219:return e=this.unpack_uint32(),this.unpack_raw(e);case 220:return e=this.unpack_uint16(),this.unpack_array(e);case 221:return e=this.unpack_uint32(),this.unpack_array(e);case 222:return e=this.unpack_uint16(),this.unpack_map(e);case 223:return e=this.unpack_uint32(),this.unpack_map(e)}},$s.prototype.unpack_uint8=function(){var n=this.dataView[this.index]&255;return this.index++,n},$s.prototype.unpack_uint16=function(){var n=this.read(2),e=(n[0]&255)*256+(n[1]&255);return this.index+=2,e},$s.prototype.unpack_uint32=function(){var n=this.read(4),e=((n[0]*256+n[1])*256+n[2])*256+n[3];return this.index+=4,e},$s.prototype.unpack_uint64=function(){var n=this.read(8),e=((((((n[0]*256+n[1])*256+n[2])*256+n[3])*256+n[4])*256+n[5])*256+n[6])*256+n[7];return this.index+=8,e},$s.prototype.unpack_int8=function(){var n=this.unpack_uint8();return n<128?n:n-256},$s.prototype.unpack_int16=function(){var n=this.unpack_uint16();return n<32768?n:n-65536},$s.prototype.unpack_int32=function(){var n=this.unpack_uint32();return n<Math.pow(2,31)?n:n-Math.pow(2,32)},$s.prototype.unpack_int64=function(){var n=this.unpack_uint64();return n<Math.pow(2,63)?n:n-Math.pow(2,64)},$s.prototype.unpack_raw=function(n){if(this.length<this.index+n)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+n+" "+this.length);var e=this.dataBuffer.slice(this.index,this.index+n);return this.index+=n,e},$s.prototype.unpack_string=function(n){for(var e=this.read(n),i=0,s="",r,o;i<n;)r=e[i],r<128?(s+=String.fromCharCode(r),i++):(r^192)<32?(o=(r^192)<<6|e[i+1]&63,s+=String.fromCharCode(o),i+=2):(o=(r&15)<<12|(e[i+1]&63)<<6|e[i+2]&63,s+=String.fromCharCode(o),i+=3);return this.index+=n,s},$s.prototype.unpack_array=function(n){for(var e=new Array(n),i=0;i<n;i++)e[i]=this.unpack();return e},$s.prototype.unpack_map=function(n){for(var e={},i=0;i<n;i++){var s=this.unpack(),r=this.unpack();e[s]=r}return e},$s.prototype.unpack_float=function(){var n=this.unpack_uint32(),e=n>>31,i=(n>>23&255)-127,s=n&8388607|8388608;return(e===0?1:-1)*s*Math.pow(2,i-23)},$s.prototype.unpack_double=function(){var n=this.unpack_uint32(),e=this.unpack_uint32(),i=n>>31,s=(n>>20&2047)-1023,r=n&1048575|1048576,o=r*Math.pow(2,s-20)+e*Math.pow(2,s-52);return(i===0?1:-1)*o},$s.prototype.read=function(n){var e=this.index;if(e+n<=this.length)return this.dataView.subarray(e,e+n);throw new Error("BinaryPackFailure: read index out of range")};function er(){this.bufferBuilder=new Ade}er.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()},er.prototype.pack=function(n){var e=typeof n;if(e==="string")this.pack_string(n);else if(e==="number")Math.floor(n)===n?this.pack_integer(n):this.pack_double(n);else if(e==="boolean")n===!0?this.bufferBuilder.append(195):n===!1&&this.bufferBuilder.append(194);else if(e==="undefined")this.bufferBuilder.append(192);else if(e==="object")if(n===null)this.bufferBuilder.append(192);else{var i=n.constructor;if(i==Array)this.pack_array(n);else if(i==Blob||i==File||n instanceof Blob||n instanceof File)this.pack_bin(n);else if(i==ArrayBuffer)EW.useArrayBufferView?this.pack_bin(new Uint8Array(n)):this.pack_bin(n);else if("BYTES_PER_ELEMENT"in n)EW.useArrayBufferView?this.pack_bin(new Uint8Array(n.buffer)):this.pack_bin(n.buffer);else if(i==Object||i.toString().startsWith("class"))this.pack_object(n);else if(i==Date)this.pack_string(n.toString());else if(typeof n.toBinaryPack=="function")this.bufferBuilder.append(n.toBinaryPack());else throw new Error('Type "'+i.toString()+'" not yet supported')}else throw new Error('Type "'+e+'" not yet supported');this.bufferBuilder.flush()},er.prototype.pack_bin=function(n){var e=n.length||n.byteLength||n.size;if(e<=15)this.pack_uint8(160+e);else if(e<=65535)this.bufferBuilder.append(218),this.pack_uint16(e);else if(e<=4294967295)this.bufferBuilder.append(219),this.pack_uint32(e);else throw new Error("Invalid length");this.bufferBuilder.append(n)},er.prototype.pack_string=function(n){var e=Sde(n);if(e<=15)this.pack_uint8(176+e);else if(e<=65535)this.bufferBuilder.append(216),this.pack_uint16(e);else if(e<=4294967295)this.bufferBuilder.append(217),this.pack_uint32(e);else throw new Error("Invalid length");this.bufferBuilder.append(n)},er.prototype.pack_array=function(n){var e=n.length;if(e<=15)this.pack_uint8(144+e);else if(e<=65535)this.bufferBuilder.append(220),this.pack_uint16(e);else if(e<=4294967295)this.bufferBuilder.append(221),this.pack_uint32(e);else throw new Error("Invalid length");for(var i=0;i<e;i++)this.pack(n[i])},er.prototype.pack_integer=function(n){if(n>=-32&&n<=127)this.bufferBuilder.append(n&255);else if(n>=0&&n<=255)this.bufferBuilder.append(204),this.pack_uint8(n);else if(n>=-128&&n<=127)this.bufferBuilder.append(208),this.pack_int8(n);else if(n>=0&&n<=65535)this.bufferBuilder.append(205),this.pack_uint16(n);else if(n>=-32768&&n<=32767)this.bufferBuilder.append(209),this.pack_int16(n);else if(n>=0&&n<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(n);else if(n>=-2147483648&&n<=2147483647)this.bufferBuilder.append(210),this.pack_int32(n);else if(n>=-9223372036854776e3&&n<=9223372036854776e3)this.bufferBuilder.append(211),this.pack_int64(n);else if(n>=0&&n<=18446744073709552e3)this.bufferBuilder.append(207),this.pack_uint64(n);else throw new Error("Invalid integer")},er.prototype.pack_double=function(n){var e=0;n<0&&(e=1,n=-n);var i=Math.floor(Math.log(n)/Math.LN2),s=n/Math.pow(2,i)-1,r=Math.floor(s*Math.pow(2,52)),o=Math.pow(2,32),a=e<<31|i+1023<<20|r/o&1048575,l=r%o;this.bufferBuilder.append(203),this.pack_int32(a),this.pack_int32(l)},er.prototype.pack_object=function(n){var e=Object.keys(n),i=e.length;if(i<=15)this.pack_uint8(128+i);else if(i<=65535)this.bufferBuilder.append(222),this.pack_uint16(i);else if(i<=4294967295)this.bufferBuilder.append(223),this.pack_uint32(i);else throw new Error("Invalid length");for(var s in n)n.hasOwnProperty(s)&&(this.pack(s),this.pack(n[s]))},er.prototype.pack_uint8=function(n){this.bufferBuilder.append(n)},er.prototype.pack_uint16=function(n){this.bufferBuilder.append(n>>8),this.bufferBuilder.append(n&255)},er.prototype.pack_uint32=function(n){var e=n&4294967295;this.bufferBuilder.append((e&4278190080)>>>24),this.bufferBuilder.append((e&16711680)>>>16),this.bufferBuilder.append((e&65280)>>>8),this.bufferBuilder.append(e&255)},er.prototype.pack_uint64=function(n){var e=n/Math.pow(2,32),i=n%Math.pow(2,32);this.bufferBuilder.append((e&4278190080)>>>24),this.bufferBuilder.append((e&16711680)>>>16),this.bufferBuilder.append((e&65280)>>>8),this.bufferBuilder.append(e&255),this.bufferBuilder.append((i&4278190080)>>>24),this.bufferBuilder.append((i&16711680)>>>16),this.bufferBuilder.append((i&65280)>>>8),this.bufferBuilder.append(i&255)},er.prototype.pack_int8=function(n){this.bufferBuilder.append(n&255)},er.prototype.pack_int16=function(n){this.bufferBuilder.append((n&65280)>>8),this.bufferBuilder.append(n&255)},er.prototype.pack_int32=function(n){this.bufferBuilder.append(n>>>24&255),this.bufferBuilder.append((n&16711680)>>>16),this.bufferBuilder.append((n&65280)>>>8),this.bufferBuilder.append(n&255)},er.prototype.pack_int64=function(n){var e=Math.floor(n/Math.pow(2,32)),i=n%Math.pow(2,32);this.bufferBuilder.append((e&4278190080)>>>24),this.bufferBuilder.append((e&16711680)>>>16),this.bufferBuilder.append((e&65280)>>>8),this.bufferBuilder.append(e&255),this.bufferBuilder.append((i&4278190080)>>>24),this.bufferBuilder.append((i&16711680)>>>16),this.bufferBuilder.append((i&65280)>>>8),this.bufferBuilder.append(i&255)};function _de(n){var e=n.charCodeAt(0);return e<=2047?"00":e<=65535?"000":e<=2097151?"0000":e<=67108863?"00000":"000000"}function Sde(n){return n.length>600?new Blob([n]).size:n.replace(/[^\u0000-\u007F]/g,_de).length}const TW=ES(wde);let RW=!0,IW=!0;function Cb(n,e,i){const s=n.match(e);return s&&s.length>=i&&parseInt(s[i],10)}function i0(n,e,i){if(!n.RTCPeerConnection)return;const s=n.RTCPeerConnection.prototype,r=s.addEventListener;s.addEventListener=function(a,l){if(a!==e)return r.apply(this,arguments);const c=h=>{const u=i(h);u&&(l.handleEvent?l.handleEvent(u):l(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(l,c),r.apply(this,[a,c])};const o=s.removeEventListener;s.removeEventListener=function(a,l){if(a!==e||!this._eventMap||!this._eventMap[e])return o.apply(this,arguments);if(!this._eventMap[e].has(l))return o.apply(this,arguments);const c=this._eventMap[e].get(l);return this._eventMap[e].delete(l),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,o.apply(this,[a,c])},Object.defineProperty(s,"on"+e,{get(){return this["_on"+e]},set(a){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),a&&this.addEventListener(e,this["_on"+e]=a)},enumerable:!0,configurable:!0})}function Cde(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(RW=n,n?"adapter.js logging disabled":"adapter.js logging enabled")}function Mde(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(IW=!n,"adapter.js deprecation warnings "+(n?"disabled":"enabled"))}function HP(){if(typeof window=="object"){if(RW)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function TS(n,e){IW&&console.warn(n+" is deprecated, please use "+e+" instead.")}function Ede(n){const e={browser:null,version:null};if(typeof n>"u"||!n.navigator)return e.browser="Not a browser.",e;const{navigator:i}=n;if(i.mozGetUserMedia)e.browser="firefox",e.version=Cb(i.userAgent,/Firefox\/(\d+)\./,1);else if(i.webkitGetUserMedia||n.isSecureContext===!1&&n.webkitRTCPeerConnection&&!n.RTCIceGatherer)e.browser="chrome",e.version=Cb(i.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(i.mediaDevices&&i.userAgent.match(/Edge\/(\d+).(\d+)$/))e.browser="edge",e.version=Cb(i.userAgent,/Edge\/(\d+).(\d+)$/,2);else if(n.RTCPeerConnection&&i.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=Cb(i.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=n.RTCRtpTransceiver&&"currentDirection"in n.RTCRtpTransceiver.prototype;else return e.browser="Not a supported browser.",e;return e}function LW(n){return Object.prototype.toString.call(n)==="[object Object]"}function PW(n){return LW(n)?Object.keys(n).reduce(function(e,i){const s=LW(n[i]),r=s?PW(n[i]):n[i],o=s&&!Object.keys(r).length;return r===void 0||o?e:Object.assign(e,{[i]:r})},{}):n}function jP(n,e,i){!e||i.has(e.id)||(i.set(e.id,e),Object.keys(e).forEach(s=>{s.endsWith("Id")?jP(n,n.get(e[s]),i):s.endsWith("Ids")&&e[s].forEach(r=>{jP(n,n.get(r),i)})}))}function BW(n,e,i){const s=i?"outbound-rtp":"inbound-rtp",r=new Map;if(e===null)return r;const o=[];return n.forEach(a=>{a.type==="track"&&a.trackIdentifier===e.id&&o.push(a)}),o.forEach(a=>{n.forEach(l=>{l.type===s&&l.trackId===a.id&&jP(n,l,r)})}),r}const kW=HP;function DW(n,e){const i=n&&n.navigator;if(!i.mediaDevices)return;const s=function(l){if(typeof l!="object"||l.mandatory||l.optional)return l;const c={};return Object.keys(l).forEach(h=>{if(h==="require"||h==="advanced"||h==="mediaSource")return;const u=typeof l[h]=="object"?l[h]:{ideal:l[h]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const d=function(m,f){return m?m+f.charAt(0).toUpperCase()+f.slice(1):f==="deviceId"?"sourceId":f};if(u.ideal!==void 0){c.optional=c.optional||[];let m={};typeof u.ideal=="number"?(m[d("min",h)]=u.ideal,c.optional.push(m),m={},m[d("max",h)]=u.ideal,c.optional.push(m)):(m[d("",h)]=u.ideal,c.optional.push(m))}u.exact!==void 0&&typeof u.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[d("",h)]=u.exact):["min","max"].forEach(m=>{u[m]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[d(m,h)]=u[m])})}),l.advanced&&(c.optional=(c.optional||[]).concat(l.advanced)),c},r=function(l,c){if(e.version>=61)return c(l);if(l=JSON.parse(JSON.stringify(l)),l&&typeof l.audio=="object"){const h=function(u,d,m){d in u&&!(m in u)&&(u[m]=u[d],delete u[d])};l=JSON.parse(JSON.stringify(l)),h(l.audio,"autoGainControl","googAutoGainControl"),h(l.audio,"noiseSuppression","googNoiseSuppression"),l.audio=s(l.audio)}if(l&&typeof l.video=="object"){let h=l.video.facingMode;h=h&&(typeof h=="object"?h:{ideal:h});const u=e.version<66;if(h&&(h.exact==="user"||h.exact==="environment"||h.ideal==="user"||h.ideal==="environment")&&!(i.mediaDevices.getSupportedConstraints&&i.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete l.video.facingMode;let d;if(h.exact==="environment"||h.ideal==="environment"?d=["back","rear"]:(h.exact==="user"||h.ideal==="user")&&(d=["front"]),d)return i.mediaDevices.enumerateDevices().then(m=>{m=m.filter(g=>g.kind==="videoinput");let f=m.find(g=>d.some(y=>g.label.toLowerCase().includes(y)));return!f&&m.length&&d.includes("back")&&(f=m[m.length-1]),f&&(l.video.deviceId=h.exact?{exact:f.deviceId}:{ideal:f.deviceId}),l.video=s(l.video),kW("chrome: "+JSON.stringify(l)),c(l)})}l.video=s(l.video)}return kW("chrome: "+JSON.stringify(l)),c(l)},o=function(l){return e.version>=64?l:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[l.name]||l.name,message:l.message,constraint:l.constraint||l.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},a=function(l,c,h){r(l,u=>{i.webkitGetUserMedia(u,c,d=>{h&&h(o(d))})})};if(i.getUserMedia=a.bind(i),i.mediaDevices.getUserMedia){const l=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(c){return r(c,h=>l(h).then(u=>{if(h.audio&&!u.getAudioTracks().length||h.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(d=>{d.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(o(u))))}}}function Tde(n,e){if(!(n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices)&&n.navigator.mediaDevices){if(typeof e!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}n.navigator.mediaDevices.getDisplayMedia=function(i){return e(i).then(s=>{const r=i.video&&i.video.width,o=i.video&&i.video.height,a=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:s,maxFrameRate:a||3}},r&&(i.video.mandatory.maxWidth=r),o&&(i.video.mandatory.maxHeight=o),n.navigator.mediaDevices.getUserMedia(i)})}}}function OW(n){n.MediaStream=n.MediaStream||n.webkitMediaStream}function GW(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("ontrack"in n.RTCPeerConnection.prototype)){Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(i){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=i)},enumerable:!0,configurable:!0});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",s=>{let r;n.RTCPeerConnection.prototype.getReceivers?r=this.getReceivers().find(a=>a.track&&a.track.id===s.track.id):r={track:s.track};const o=new Event("track");o.track=s.track,o.receiver=r,o.transceiver={receiver:r},o.streams=[i.stream],this.dispatchEvent(o)}),i.stream.getTracks().forEach(s=>{let r;n.RTCPeerConnection.prototype.getReceivers?r=this.getReceivers().find(a=>a.track&&a.track.id===s.id):r={track:s};const o=new Event("track");o.track=s,o.receiver=r,o.transceiver={receiver:r},o.streams=[i.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else i0(n,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function zW(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("getSenders"in n.RTCPeerConnection.prototype)&&"createDTMFSender"in n.RTCPeerConnection.prototype){const e=function(r,o){return{track:o,get dtmf(){return this._dtmf===void 0&&(o.kind==="audio"?this._dtmf=r.createDTMFSender(o):this._dtmf=null),this._dtmf},_pc:r}};if(!n.RTCPeerConnection.prototype.getSenders){n.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(a,l){let c=r.apply(this,arguments);return c||(c=e(this,a),this._senders.push(c)),c};const o=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(a){o.apply(this,arguments);const l=this._senders.indexOf(a);l!==-1&&this._senders.splice(l,1)}}const i=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(r){this._senders=this._senders||[],i.apply(this,[r]),r.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const s=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(r){this._senders=this._senders||[],s.apply(this,[r]),r.getTracks().forEach(o=>{const a=this._senders.find(l=>l.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof n=="object"&&n.RTCPeerConnection&&"getSenders"in n.RTCPeerConnection.prototype&&"createDTMFSender"in n.RTCPeerConnection.prototype&&n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)){const e=n.RTCPeerConnection.prototype.getSenders;n.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(s=>s._pc=this),i},Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function FW(n){if(!n.RTCPeerConnection)return;const e=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[i,s,r]=arguments;if(arguments.length>0&&typeof i=="function")return e.apply(this,arguments);if(e.length===0&&(arguments.length===0||typeof i!="function"))return e.apply(this,[]);const o=function(l){const c={};return l.result().forEach(h=>{const u={id:h.id,timestamp:h.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[h.type]||h.type};h.names().forEach(d=>{u[d]=h.stat(d)}),c[u.id]=u}),c},a=function(l){return new Map(Object.keys(l).map(c=>[c,l[c]]))};if(arguments.length>=2){const l=function(c){s(a(o(c)))};return e.apply(this,[l,i])}return new Promise((l,c)=>{e.apply(this,[function(h){l(a(o(h)))},c])}).then(s,r)}}function NW(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&n.RTCRtpReceiver))return;if(!("getStats"in n.RTCRtpSender.prototype)){const i=n.RTCPeerConnection.prototype.getSenders;i&&(n.RTCPeerConnection.prototype.getSenders=function(){const r=i.apply(this,[]);return r.forEach(o=>o._pc=this),r});const s=n.RTCPeerConnection.prototype.addTrack;s&&(n.RTCPeerConnection.prototype.addTrack=function(){const r=s.apply(this,arguments);return r._pc=this,r}),n.RTCRtpSender.prototype.getStats=function(){const r=this;return this._pc.getStats().then(o=>BW(o,r.track,!0))}}if(!("getStats"in n.RTCRtpReceiver.prototype)){const i=n.RTCPeerConnection.prototype.getReceivers;i&&(n.RTCPeerConnection.prototype.getReceivers=function(){const s=i.apply(this,[]);return s.forEach(r=>r._pc=this),s}),i0(n,"track",s=>(s.receiver._pc=s.srcElement,s)),n.RTCRtpReceiver.prototype.getStats=function(){const s=this;return this._pc.getStats().then(r=>BW(r,s.track,!1))}}if(!("getStats"in n.RTCRtpSender.prototype&&"getStats"in n.RTCRtpReceiver.prototype))return;const e=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof n.MediaStreamTrack){const i=arguments[0];let s,r,o;return this.getSenders().forEach(a=>{a.track===i&&(s?o=!0:s=a)}),this.getReceivers().forEach(a=>(a.track===i&&(r?o=!0:r=a),a.track===i)),o||s&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):s?s.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function UW(n){n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const l=e.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(l)===-1&&this._shimmedLocalStreams[a.id].push(l):this._shimmedLocalStreams[a.id]=[a,l],l};const i=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(c=>{if(this.getSenders().find(h=>h.track===c))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();i.apply(this,arguments);const l=this.getSenders().filter(c=>a.indexOf(c)===-1);this._shimmedLocalStreams[o.id]=[o].concat(l)};const s=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],s.apply(this,arguments)};const r=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const l=this._shimmedLocalStreams[a].indexOf(o);l!==-1&&this._shimmedLocalStreams[a].splice(l,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),r.apply(this,arguments)}}function VW(n,e){if(!n.RTCPeerConnection)return;if(n.RTCPeerConnection.prototype.addTrack&&e.version>=65)return UW(n);const i=n.RTCPeerConnection.prototype.getLocalStreams;n.RTCPeerConnection.prototype.getLocalStreams=function(){const h=i.apply(this);return this._reverseStreams=this._reverseStreams||{},h.map(u=>this._reverseStreams[u.id])};const s=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(h){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},h.getTracks().forEach(u=>{if(this.getSenders().find(d=>d.track===u))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[h.id]){const u=new n.MediaStream(h.getTracks());this._streams[h.id]=u,this._reverseStreams[u.id]=h,h=u}s.apply(this,[h])};const r=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(h){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[h.id]||h]),delete this._reverseStreams[this._streams[h.id]?this._streams[h.id].id:h.id],delete this._streams[h.id]},n.RTCPeerConnection.prototype.addTrack=function(h,u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const d=[].slice.call(arguments,1);if(d.length!==1||!d[0].getTracks().find(f=>f===h))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(f=>f.track===h))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const m=this._streams[u.id];if(m)m.addTrack(h),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const f=new n.MediaStream([h]);this._streams[u.id]=f,this._reverseStreams[f.id]=u,this.addStream(f)}return this.getSenders().find(f=>f.track===h)};function o(h,u){let d=u.sdp;return Object.keys(h._reverseStreams||[]).forEach(m=>{const f=h._reverseStreams[m],g=h._streams[f.id];d=d.replace(new RegExp(g.id,"g"),f.id)}),new RTCSessionDescription({type:u.type,sdp:d})}function a(h,u){let d=u.sdp;return Object.keys(h._reverseStreams||[]).forEach(m=>{const f=h._reverseStreams[m],g=h._streams[f.id];d=d.replace(new RegExp(f.id,"g"),g.id)}),new RTCSessionDescription({type:u.type,sdp:d})}["createOffer","createAnswer"].forEach(function(h){const u=n.RTCPeerConnection.prototype[h],d={[h](){const m=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[f=>{const g=o(this,f);m[0].apply(null,[g])},f=>{m[1]&&m[1].apply(null,f)},arguments[2]]):u.apply(this,arguments).then(f=>o(this,f))}};n.RTCPeerConnection.prototype[h]=d[h]});const l=n.RTCPeerConnection.prototype.setLocalDescription;n.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?l.apply(this,arguments):(arguments[0]=a(this,arguments[0]),l.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(n.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(n.RTCPeerConnection.prototype,"localDescription",{get(){const h=c.get.apply(this);return h.type===""?h:o(this,h)}}),n.RTCPeerConnection.prototype.removeTrack=function(h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!h._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(h._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let u;Object.keys(this._streams).forEach(d=>{this._streams[d].getTracks().find(m=>h.track===m)&&(u=this._streams[d])}),u&&(u.getTracks().length===1?this.removeStream(this._reverseStreams[u.id]):u.removeTrack(h.track),this.dispatchEvent(new Event("negotiationneeded")))}}function QP(n,e){!n.RTCPeerConnection&&n.webkitRTCPeerConnection&&(n.RTCPeerConnection=n.webkitRTCPeerConnection),n.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const s=n.RTCPeerConnection.prototype[i],r={[i](){return arguments[0]=new(i==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};n.RTCPeerConnection.prototype[i]=r[i]})}function XW(n,e){i0(n,"negotiationneeded",i=>{const s=i.target;if(!((e.version<72||s.getConfiguration&&s.getConfiguration().sdpSemantics==="plan-b")&&s.signalingState!=="stable"))return i})}const WW=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:XW,shimAddTrackRemoveTrack:VW,shimAddTrackRemoveTrackWithNative:UW,shimGetDisplayMedia:Tde,shimGetSendersWithDtmf:zW,shimGetStats:FW,shimGetUserMedia:DW,shimMediaStream:OW,shimOnTrack:GW,shimPeerConnection:QP,shimSenderReceiverGetStats:NW},Symbol.toStringTag,{value:"Module"}));function Rde(n,e){let i=!1;return n=JSON.parse(JSON.stringify(n)),n.filter(s=>{if(s&&(s.urls||s.url)){let r=s.urls||s.url;s.url&&!s.urls&&TS("RTCIceServer.url","RTCIceServer.urls");const o=typeof r=="string";return o&&(r=[r]),r=r.filter(a=>{if(a.indexOf("stun:")===0)return!1;const l=a.startsWith("turn")&&!a.startsWith("turn:[")&&a.includes("transport=udp");return l&&!i?(i=!0,!0):l&&!i}),delete s.url,s.urls=o?r[0]:r,!!r.length}})}var HW={exports:{}};(function(n){var e={};e.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},e.localCName=e.generateIdentifier(),e.splitLines=function(i){return i.trim().split(`
`).map(function(s){return s.trim()})},e.splitSections=function(i){var s=i.split(`
m=`);return s.map(function(r,o){return(o>0?"m="+r:r).trim()+`\r
`})},e.getDescription=function(i){var s=e.splitSections(i);return s&&s[0]},e.getMediaSections=function(i){var s=e.splitSections(i);return s.shift(),s},e.matchPrefix=function(i,s){return e.splitLines(i).filter(function(r){return r.indexOf(s)===0})},e.parseCandidate=function(i){var s;i.indexOf("a=candidate:")===0?s=i.substring(12).split(" "):s=i.substring(10).split(" ");for(var r={foundation:s[0],component:parseInt(s[1],10),protocol:s[2].toLowerCase(),priority:parseInt(s[3],10),ip:s[4],address:s[4],port:parseInt(s[5],10),type:s[7]},o=8;o<s.length;o+=2)switch(s[o]){case"raddr":r.relatedAddress=s[o+1];break;case"rport":r.relatedPort=parseInt(s[o+1],10);break;case"tcptype":r.tcpType=s[o+1];break;case"ufrag":r.ufrag=s[o+1],r.usernameFragment=s[o+1];break;default:r[s[o]]=s[o+1];break}return r},e.writeCandidate=function(i){var s=[];s.push(i.foundation),s.push(i.component),s.push(i.protocol.toUpperCase()),s.push(i.priority),s.push(i.address||i.ip),s.push(i.port);var r=i.type;return s.push("typ"),s.push(r),r!=="host"&&i.relatedAddress&&i.relatedPort&&(s.push("raddr"),s.push(i.relatedAddress),s.push("rport"),s.push(i.relatedPort)),i.tcpType&&i.protocol.toLowerCase()==="tcp"&&(s.push("tcptype"),s.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(s.push("ufrag"),s.push(i.usernameFragment||i.ufrag)),"candidate:"+s.join(" ")},e.parseIceOptions=function(i){return i.substr(14).split(" ")},e.parseRtpMap=function(i){var s=i.substr(9).split(" "),r={payloadType:parseInt(s.shift(),10)};return s=s[0].split("/"),r.name=s[0],r.clockRate=parseInt(s[1],10),r.channels=s.length===3?parseInt(s[2],10):1,r.numChannels=r.channels,r},e.writeRtpMap=function(i){var s=i.payloadType;i.preferredPayloadType!==void 0&&(s=i.preferredPayloadType);var r=i.channels||i.numChannels||1;return"a=rtpmap:"+s+" "+i.name+"/"+i.clockRate+(r!==1?"/"+r:"")+`\r
`},e.parseExtmap=function(i){var s=i.substr(9).split(" ");return{id:parseInt(s[0],10),direction:s[0].indexOf("/")>0?s[0].split("/")[1]:"sendrecv",uri:s[1]}},e.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&i.direction!=="sendrecv"?"/"+i.direction:"")+" "+i.uri+`\r
`},e.parseFmtp=function(i){for(var s={},r,o=i.substr(i.indexOf(" ")+1).split(";"),a=0;a<o.length;a++)r=o[a].trim().split("="),s[r[0].trim()]=r[1];return s},e.writeFmtp=function(i){var s="",r=i.payloadType;if(i.preferredPayloadType!==void 0&&(r=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){var o=[];Object.keys(i.parameters).forEach(function(a){i.parameters[a]?o.push(a+"="+i.parameters[a]):o.push(a)}),s+="a=fmtp:"+r+" "+o.join(";")+`\r
`}return s},e.parseRtcpFb=function(i){var s=i.substr(i.indexOf(" ")+1).split(" ");return{type:s.shift(),parameter:s.join(" ")}},e.writeRtcpFb=function(i){var s="",r=i.payloadType;return i.preferredPayloadType!==void 0&&(r=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach(function(o){s+="a=rtcp-fb:"+r+" "+o.type+(o.parameter&&o.parameter.length?" "+o.parameter:"")+`\r
`}),s},e.parseSsrcMedia=function(i){var s=i.indexOf(" "),r={ssrc:parseInt(i.substr(7,s-7),10)},o=i.indexOf(":",s);return o>-1?(r.attribute=i.substr(s+1,o-s-1),r.value=i.substr(o+1)):r.attribute=i.substr(s+1),r},e.parseSsrcGroup=function(i){var s=i.substr(13).split(" ");return{semantics:s.shift(),ssrcs:s.map(function(r){return parseInt(r,10)})}},e.getMid=function(i){var s=e.matchPrefix(i,"a=mid:")[0];if(s)return s.substr(6)},e.parseFingerprint=function(i){var s=i.substr(14).split(" ");return{algorithm:s[0].toLowerCase(),value:s[1]}},e.getDtlsParameters=function(i,s){var r=e.matchPrefix(i+s,"a=fingerprint:");return{role:"auto",fingerprints:r.map(e.parseFingerprint)}},e.writeDtlsParameters=function(i,s){var r="a=setup:"+s+`\r
`;return i.fingerprints.forEach(function(o){r+="a=fingerprint:"+o.algorithm+" "+o.value+`\r
`}),r},e.parseCryptoLine=function(i){var s=i.substr(9).split(" ");return{tag:parseInt(s[0],10),cryptoSuite:s[1],keyParams:s[2],sessionParams:s.slice(3)}},e.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+(typeof i.keyParams=="object"?e.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(i){if(i.indexOf("inline:")!==0)return null;var s=i.substr(7).split("|");return{keyMethod:"inline",keySalt:s[0],lifeTime:s[1],mkiValue:s[2]?s[2].split(":")[0]:void 0,mkiLength:s[2]?s[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},e.getCryptoParameters=function(i,s){var r=e.matchPrefix(i+s,"a=crypto:");return r.map(e.parseCryptoLine)},e.getIceParameters=function(i,s){var r=e.matchPrefix(i+s,"a=ice-ufrag:")[0],o=e.matchPrefix(i+s,"a=ice-pwd:")[0];return r&&o?{usernameFragment:r.substr(12),password:o.substr(10)}:null},e.writeIceParameters=function(i){return"a=ice-ufrag:"+i.usernameFragment+`\r
a=ice-pwd:`+i.password+`\r
`},e.parseRtpParameters=function(i){for(var s={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=e.splitLines(i),o=r[0].split(" "),a=3;a<o.length;a++){var l=o[a],c=e.matchPrefix(i,"a=rtpmap:"+l+" ")[0];if(c){var h=e.parseRtpMap(c),u=e.matchPrefix(i,"a=fmtp:"+l+" ");switch(h.parameters=u.length?e.parseFmtp(u[0]):{},h.rtcpFeedback=e.matchPrefix(i,"a=rtcp-fb:"+l+" ").map(e.parseRtcpFb),s.codecs.push(h),h.name.toUpperCase()){case"RED":case"ULPFEC":s.fecMechanisms.push(h.name.toUpperCase());break}}}return e.matchPrefix(i,"a=extmap:").forEach(function(d){s.headerExtensions.push(e.parseExtmap(d))}),s},e.writeRtpDescription=function(i,s){var r="";r+="m="+i+" ",r+=s.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=s.codecs.map(function(a){return a.preferredPayloadType!==void 0?a.preferredPayloadType:a.payloadType}).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,s.codecs.forEach(function(a){r+=e.writeRtpMap(a),r+=e.writeFmtp(a),r+=e.writeRtcpFb(a)});var o=0;return s.codecs.forEach(function(a){a.maxptime>o&&(o=a.maxptime)}),o>0&&(r+="a=maxptime:"+o+`\r
`),r+=`a=rtcp-mux\r
`,s.headerExtensions&&s.headerExtensions.forEach(function(a){r+=e.writeExtmap(a)}),r},e.parseRtpEncodingParameters=function(i){var s=[],r=e.parseRtpParameters(i),o=r.fecMechanisms.indexOf("RED")!==-1,a=r.fecMechanisms.indexOf("ULPFEC")!==-1,l=e.matchPrefix(i,"a=ssrc:").map(function(m){return e.parseSsrcMedia(m)}).filter(function(m){return m.attribute==="cname"}),c=l.length>0&&l[0].ssrc,h,u=e.matchPrefix(i,"a=ssrc-group:FID").map(function(m){var f=m.substr(17).split(" ");return f.map(function(g){return parseInt(g,10)})});u.length>0&&u[0].length>1&&u[0][0]===c&&(h=u[0][1]),r.codecs.forEach(function(m){if(m.name.toUpperCase()==="RTX"&&m.parameters.apt){var f={ssrc:c,codecPayloadType:parseInt(m.parameters.apt,10)};c&&h&&(f.rtx={ssrc:h}),s.push(f),o&&(f=JSON.parse(JSON.stringify(f)),f.fec={ssrc:c,mechanism:a?"red+ulpfec":"red"},s.push(f))}}),s.length===0&&c&&s.push({ssrc:c});var d=e.matchPrefix(i,"b=");return d.length&&(d[0].indexOf("b=TIAS:")===0?d=parseInt(d[0].substr(7),10):d[0].indexOf("b=AS:")===0?d=parseInt(d[0].substr(5),10)*1e3*.95-50*40*8:d=void 0,s.forEach(function(m){m.maxBitrate=d})),s},e.parseRtcpParameters=function(i){var s={},r=e.matchPrefix(i,"a=ssrc:").map(function(l){return e.parseSsrcMedia(l)}).filter(function(l){return l.attribute==="cname"})[0];r&&(s.cname=r.value,s.ssrc=r.ssrc);var o=e.matchPrefix(i,"a=rtcp-rsize");s.reducedSize=o.length>0,s.compound=o.length===0;var a=e.matchPrefix(i,"a=rtcp-mux");return s.mux=a.length>0,s},e.parseMsid=function(i){var s,r=e.matchPrefix(i,"a=msid:");if(r.length===1)return s=r[0].substr(7).split(" "),{stream:s[0],track:s[1]};var o=e.matchPrefix(i,"a=ssrc:").map(function(a){return e.parseSsrcMedia(a)}).filter(function(a){return a.attribute==="msid"});if(o.length>0)return s=o[0].value.split(" "),{stream:s[0],track:s[1]}},e.parseSctpDescription=function(i){var s=e.parseMLine(i),r=e.matchPrefix(i,"a=max-message-size:"),o;r.length>0&&(o=parseInt(r[0].substr(19),10)),isNaN(o)&&(o=65536);var a=e.matchPrefix(i,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substr(12),10),protocol:s.fmt,maxMessageSize:o};var l=e.matchPrefix(i,"a=sctpmap:");if(l.length>0){var c=e.matchPrefix(i,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:o}}},e.writeSctpDescription=function(i,s){var r=[];return i.protocol!=="DTLS/SCTP"?r=["m="+i.kind+" 9 "+i.protocol+" "+s.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+s.port+`\r
`]:r=["m="+i.kind+" 9 "+i.protocol+" "+s.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+s.port+" "+s.protocol+` 65535\r
`],s.maxMessageSize!==void 0&&r.push("a=max-message-size:"+s.maxMessageSize+`\r
`),r.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,21)},e.writeSessionBoilerplate=function(i,s,r){var o,a=s!==void 0?s:2;i?o=i:o=e.generateSessionId();var l=r||"thisisadapterortc";return`v=0\r
o=`+l+" "+o+" "+a+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.writeMediaSection=function(i,s,r,o){var a=e.writeRtpDescription(i.kind,s);if(a+=e.writeIceParameters(i.iceGatherer.getLocalParameters()),a+=e.writeDtlsParameters(i.dtlsTransport.getLocalParameters(),r==="offer"?"actpass":"active"),a+="a=mid:"+i.mid+`\r
`,i.direction?a+="a="+i.direction+`\r
`:i.rtpSender&&i.rtpReceiver?a+=`a=sendrecv\r
`:i.rtpSender?a+=`a=sendonly\r
`:i.rtpReceiver?a+=`a=recvonly\r
`:a+=`a=inactive\r
`,i.rtpSender){var l="msid:"+o.id+" "+i.rtpSender.track.id+`\r
`;a+="a="+l,a+="a=ssrc:"+i.sendEncodingParameters[0].ssrc+" "+l,i.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+i.sendEncodingParameters[0].rtx.ssrc+" "+l,a+="a=ssrc-group:FID "+i.sendEncodingParameters[0].ssrc+" "+i.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return a+="a=ssrc:"+i.sendEncodingParameters[0].ssrc+" cname:"+e.localCName+`\r
`,i.rtpSender&&i.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+i.sendEncodingParameters[0].rtx.ssrc+" cname:"+e.localCName+`\r
`),a},e.getDirection=function(i,s){for(var r=e.splitLines(i),o=0;o<r.length;o++)switch(r[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[o].substr(2)}return s?e.getDirection(s):"sendrecv"},e.getKind=function(i){var s=e.splitLines(i),r=s[0].split(" ");return r[0].substr(2)},e.isRejected=function(i){return i.split(" ",2)[1]==="0"},e.parseMLine=function(i){var s=e.splitLines(i),r=s[0].substr(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},e.parseOLine=function(i){var s=e.matchPrefix(i,"o=")[0],r=s.substr(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},e.isValidSDP=function(i){if(typeof i!="string"||i.length===0)return!1;for(var s=e.splitLines(i),r=0;r<s.length;r++)if(s[r].length<2||s[r].charAt(1)!=="=")return!1;return!0},n.exports=e})(HW);var jW=HW.exports;const RS=ES(jW);var Nt=jW;function Ide(n){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[n.type]||n.type}function QW(n,e,i,s,r){var o=Nt.writeRtpDescription(n.kind,e);if(o+=Nt.writeIceParameters(n.iceGatherer.getLocalParameters()),o+=Nt.writeDtlsParameters(n.dtlsTransport.getLocalParameters(),i==="offer"?"actpass":r||"active"),o+="a=mid:"+n.mid+`\r
`,n.rtpSender&&n.rtpReceiver?o+=`a=sendrecv\r
`:n.rtpSender?o+=`a=sendonly\r
`:n.rtpReceiver?o+=`a=recvonly\r
`:o+=`a=inactive\r
`,n.rtpSender){var a=n.rtpSender._initialTrackId||n.rtpSender.track.id;n.rtpSender._initialTrackId=a;var l="msid:"+(s?s.id:"-")+" "+a+`\r
`;o+="a="+l,o+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" "+l,n.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" "+l,o+="a=ssrc-group:FID "+n.sendEncodingParameters[0].ssrc+" "+n.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return o+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" cname:"+Nt.localCName+`\r
`,n.rtpSender&&n.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" cname:"+Nt.localCName+`\r
`),o}function Lde(n,e){var i=!1;return n=JSON.parse(JSON.stringify(n)),n.filter(function(s){if(s&&(s.urls||s.url)){var r=s.urls||s.url;s.url&&!s.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var o=typeof r=="string";return o&&(r=[r]),r=r.filter(function(a){var l=a.indexOf("turn:")===0&&a.indexOf("transport=udp")!==-1&&a.indexOf("turn:[")===-1&&!i;return l?(i=!0,!0):a.indexOf("stun:")===0&&e>=14393&&a.indexOf("?transport=udp")===-1}),delete s.url,s.urls=o?r[0]:r,!!r.length}})}function IS(n,e){var i={codecs:[],headerExtensions:[],fecMechanisms:[]},s=function(o,a){o=parseInt(o,10);for(var l=0;l<a.length;l++)if(a[l].payloadType===o||a[l].preferredPayloadType===o)return a[l]},r=function(o,a,l,c){var h=s(o.parameters.apt,l),u=s(a.parameters.apt,c);return h&&u&&h.name.toLowerCase()===u.name.toLowerCase()};return n.codecs.forEach(function(o){for(var a=0;a<e.codecs.length;a++){var l=e.codecs[a];if(o.name.toLowerCase()===l.name.toLowerCase()&&o.clockRate===l.clockRate){if(o.name.toLowerCase()==="rtx"&&o.parameters&&l.parameters.apt&&!r(o,l,n.codecs,e.codecs))continue;l=JSON.parse(JSON.stringify(l)),l.numChannels=Math.min(o.numChannels,l.numChannels),i.codecs.push(l),l.rtcpFeedback=l.rtcpFeedback.filter(function(c){for(var h=0;h<o.rtcpFeedback.length;h++)if(o.rtcpFeedback[h].type===c.type&&o.rtcpFeedback[h].parameter===c.parameter)return!0;return!1});break}}}),n.headerExtensions.forEach(function(o){for(var a=0;a<e.headerExtensions.length;a++){var l=e.headerExtensions[a];if(o.uri===l.uri){i.headerExtensions.push(l);break}}}),i}function ZW(n,e,i){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[e][n].indexOf(i)!==-1}function ZP(n,e){var i=n.getRemoteCandidates().find(function(s){return e.foundation===s.foundation&&e.ip===s.ip&&e.port===s.port&&e.priority===s.priority&&e.protocol===s.protocol&&e.type===s.type});return i||n.addRemoteCandidate(e),!i}function Dr(n,e){var i=new Error(e);return i.name=n,i.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[n],i}var Pde=function(n,e){function i(c,h){h.addTrack(c),h.dispatchEvent(new n.MediaStreamTrackEvent("addtrack",{track:c}))}function s(c,h){h.removeTrack(c),h.dispatchEvent(new n.MediaStreamTrackEvent("removetrack",{track:c}))}function r(c,h,u,d){var m=new Event("track");m.track=h,m.receiver=u,m.transceiver={receiver:u},m.streams=d,n.setTimeout(function(){c._dispatchEvent("track",m)})}var o=function(c){var h=this,u=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(m){h[m]=u[m].bind(u)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",c=JSON.parse(JSON.stringify(c||{})),this.usingBundle=c.bundlePolicy==="max-bundle",c.rtcpMuxPolicy==="negotiate")throw Dr("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(c.rtcpMuxPolicy||(c.rtcpMuxPolicy="require"),c.iceTransportPolicy){case"all":case"relay":break;default:c.iceTransportPolicy="all";break}switch(c.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:c.bundlePolicy="balanced";break}if(c.iceServers=Lde(c.iceServers||[],e),this._iceGatherers=[],c.iceCandidatePoolSize)for(var d=c.iceCandidatePoolSize;d>0;d--)this._iceGatherers.push(new n.RTCIceGatherer({iceServers:c.iceServers,gatherPolicy:c.iceTransportPolicy}));else c.iceCandidatePoolSize=0;this._config=c,this.transceivers=[],this._sdpSessionId=Nt.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(o.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(o.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),o.prototype.onicecandidate=null,o.prototype.onaddstream=null,o.prototype.ontrack=null,o.prototype.onremovestream=null,o.prototype.onsignalingstatechange=null,o.prototype.oniceconnectionstatechange=null,o.prototype.onconnectionstatechange=null,o.prototype.onicegatheringstatechange=null,o.prototype.onnegotiationneeded=null,o.prototype.ondatachannel=null,o.prototype._dispatchEvent=function(c,h){this._isClosed||(this.dispatchEvent(h),typeof this["on"+c]=="function"&&this["on"+c](h))},o.prototype._emitGatheringStateChange=function(){var c=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",c)},o.prototype.getConfiguration=function(){return this._config},o.prototype.getLocalStreams=function(){return this.localStreams},o.prototype.getRemoteStreams=function(){return this.remoteStreams},o.prototype._createTransceiver=function(c,h){var u=this.transceivers.length>0,d={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:c,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&u)d.iceTransport=this.transceivers[0].iceTransport,d.dtlsTransport=this.transceivers[0].dtlsTransport;else{var m=this._createIceAndDtlsTransports();d.iceTransport=m.iceTransport,d.dtlsTransport=m.dtlsTransport}return h||this.transceivers.push(d),d},o.prototype.addTrack=function(c,h){if(this._isClosed)throw Dr("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var u=this.transceivers.find(function(f){return f.track===c});if(u)throw Dr("InvalidAccessError","Track already exists.");for(var d,m=0;m<this.transceivers.length;m++)!this.transceivers[m].track&&this.transceivers[m].kind===c.kind&&(d=this.transceivers[m]);return d||(d=this._createTransceiver(c.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(h)===-1&&this.localStreams.push(h),d.track=c,d.stream=h,d.rtpSender=new n.RTCRtpSender(c,d.dtlsTransport),d.rtpSender},o.prototype.addStream=function(c){var h=this;if(e>=15025)c.getTracks().forEach(function(d){h.addTrack(d,c)});else{var u=c.clone();c.getTracks().forEach(function(d,m){var f=u.getTracks()[m];d.addEventListener("enabled",function(g){f.enabled=g.enabled})}),u.getTracks().forEach(function(d){h.addTrack(d,u)})}},o.prototype.removeTrack=function(c){if(this._isClosed)throw Dr("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(c instanceof n.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var h=this.transceivers.find(function(m){return m.rtpSender===c});if(!h)throw Dr("InvalidAccessError","Sender was not created by this connection.");var u=h.stream;h.rtpSender.stop(),h.rtpSender=null,h.track=null,h.stream=null;var d=this.transceivers.map(function(m){return m.stream});d.indexOf(u)===-1&&this.localStreams.indexOf(u)>-1&&this.localStreams.splice(this.localStreams.indexOf(u),1),this._maybeFireNegotiationNeeded()},o.prototype.removeStream=function(c){var h=this;c.getTracks().forEach(function(u){var d=h.getSenders().find(function(m){return m.track===u});d&&h.removeTrack(d)})},o.prototype.getSenders=function(){return this.transceivers.filter(function(c){return!!c.rtpSender}).map(function(c){return c.rtpSender})},o.prototype.getReceivers=function(){return this.transceivers.filter(function(c){return!!c.rtpReceiver}).map(function(c){return c.rtpReceiver})},o.prototype._createIceGatherer=function(c,h){var u=this;if(h&&c>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var d=new n.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(d,"state",{value:"new",writable:!0}),this.transceivers[c].bufferedCandidateEvents=[],this.transceivers[c].bufferCandidates=function(m){var f=!m.candidate||Object.keys(m.candidate).length===0;d.state=f?"completed":"gathering",u.transceivers[c].bufferedCandidateEvents!==null&&u.transceivers[c].bufferedCandidateEvents.push(m)},d.addEventListener("localcandidate",this.transceivers[c].bufferCandidates),d},o.prototype._gather=function(c,h){var u=this,d=this.transceivers[h].iceGatherer;if(!d.onlocalcandidate){var m=this.transceivers[h].bufferedCandidateEvents;this.transceivers[h].bufferedCandidateEvents=null,d.removeEventListener("localcandidate",this.transceivers[h].bufferCandidates),d.onlocalcandidate=function(f){if(!(u.usingBundle&&h>0)){var g=new Event("icecandidate");g.candidate={sdpMid:c,sdpMLineIndex:h};var y=f.candidate,v=!y||Object.keys(y).length===0;if(v)(d.state==="new"||d.state==="gathering")&&(d.state="completed");else{d.state==="new"&&(d.state="gathering"),y.component=1,y.ufrag=d.getLocalParameters().usernameFragment;var b=Nt.writeCandidate(y);g.candidate=Object.assign(g.candidate,Nt.parseCandidate(b)),g.candidate.candidate=b,g.candidate.toJSON=function(){return{candidate:g.candidate.candidate,sdpMid:g.candidate.sdpMid,sdpMLineIndex:g.candidate.sdpMLineIndex,usernameFragment:g.candidate.usernameFragment}}}var A=Nt.getMediaSections(u._localDescription.sdp);v?A[g.candidate.sdpMLineIndex]+=`a=end-of-candidates\r
`:A[g.candidate.sdpMLineIndex]+="a="+g.candidate.candidate+`\r
`,u._localDescription.sdp=Nt.getDescription(u._localDescription.sdp)+A.join("");var x=u.transceivers.every(function(w){return w.iceGatherer&&w.iceGatherer.state==="completed"});u.iceGatheringState!=="gathering"&&(u.iceGatheringState="gathering",u._emitGatheringStateChange()),v||u._dispatchEvent("icecandidate",g),x&&(u._dispatchEvent("icecandidate",new Event("icecandidate")),u.iceGatheringState="complete",u._emitGatheringStateChange())}},n.setTimeout(function(){m.forEach(function(f){d.onlocalcandidate(f)})},0)}},o.prototype._createIceAndDtlsTransports=function(){var c=this,h=new n.RTCIceTransport(null);h.onicestatechange=function(){c._updateIceConnectionState(),c._updateConnectionState()};var u=new n.RTCDtlsTransport(h);return u.ondtlsstatechange=function(){c._updateConnectionState()},u.onerror=function(){Object.defineProperty(u,"state",{value:"failed",writable:!0}),c._updateConnectionState()},{iceTransport:h,dtlsTransport:u}},o.prototype._disposeIceAndDtlsTransports=function(c){var h=this.transceivers[c].iceGatherer;h&&(delete h.onlocalcandidate,delete this.transceivers[c].iceGatherer);var u=this.transceivers[c].iceTransport;u&&(delete u.onicestatechange,delete this.transceivers[c].iceTransport);var d=this.transceivers[c].dtlsTransport;d&&(delete d.ondtlsstatechange,delete d.onerror,delete this.transceivers[c].dtlsTransport)},o.prototype._transceive=function(c,h,u){var d=IS(c.localCapabilities,c.remoteCapabilities);h&&c.rtpSender&&(d.encodings=c.sendEncodingParameters,d.rtcp={cname:Nt.localCName,compound:c.rtcpParameters.compound},c.recvEncodingParameters.length&&(d.rtcp.ssrc=c.recvEncodingParameters[0].ssrc),c.rtpSender.send(d)),u&&c.rtpReceiver&&d.codecs.length>0&&(c.kind==="video"&&c.recvEncodingParameters&&e<15019&&c.recvEncodingParameters.forEach(function(m){delete m.rtx}),c.recvEncodingParameters.length?d.encodings=c.recvEncodingParameters:d.encodings=[{}],d.rtcp={compound:c.rtcpParameters.compound},c.rtcpParameters.cname&&(d.rtcp.cname=c.rtcpParameters.cname),c.sendEncodingParameters.length&&(d.rtcp.ssrc=c.sendEncodingParameters[0].ssrc),c.rtpReceiver.receive(d))},o.prototype.setLocalDescription=function(c){var h=this;if(["offer","answer"].indexOf(c.type)===-1)return Promise.reject(Dr("TypeError",'Unsupported type "'+c.type+'"'));if(!ZW("setLocalDescription",c.type,h.signalingState)||h._isClosed)return Promise.reject(Dr("InvalidStateError","Can not set local "+c.type+" in state "+h.signalingState));var u,d;if(c.type==="offer")u=Nt.splitSections(c.sdp),d=u.shift(),u.forEach(function(f,g){var y=Nt.parseRtpParameters(f);h.transceivers[g].localCapabilities=y}),h.transceivers.forEach(function(f,g){h._gather(f.mid,g)});else if(c.type==="answer"){u=Nt.splitSections(h._remoteDescription.sdp),d=u.shift();var m=Nt.matchPrefix(d,"a=ice-lite").length>0;u.forEach(function(f,g){var y=h.transceivers[g],v=y.iceGatherer,b=y.iceTransport,A=y.dtlsTransport,x=y.localCapabilities,w=y.remoteCapabilities,_=Nt.isRejected(f)&&Nt.matchPrefix(f,"a=bundle-only").length===0;if(!_&&!y.rejected){var S=Nt.getIceParameters(f,d),M=Nt.getDtlsParameters(f,d);m&&(M.role="server"),(!h.usingBundle||g===0)&&(h._gather(y.mid,g),b.state==="new"&&b.start(v,S,m?"controlling":"controlled"),A.state==="new"&&A.start(M));var R=IS(x,w);h._transceive(y,R.codecs.length>0,!1)}})}return h._localDescription={type:c.type,sdp:c.sdp},c.type==="offer"?h._updateSignalingState("have-local-offer"):h._updateSignalingState("stable"),Promise.resolve()},o.prototype.setRemoteDescription=function(c){var h=this;if(["offer","answer"].indexOf(c.type)===-1)return Promise.reject(Dr("TypeError",'Unsupported type "'+c.type+'"'));if(!ZW("setRemoteDescription",c.type,h.signalingState)||h._isClosed)return Promise.reject(Dr("InvalidStateError","Can not set remote "+c.type+" in state "+h.signalingState));var u={};h.remoteStreams.forEach(function(b){u[b.id]=b});var d=[],m=Nt.splitSections(c.sdp),f=m.shift(),g=Nt.matchPrefix(f,"a=ice-lite").length>0,y=Nt.matchPrefix(f,"a=group:BUNDLE ").length>0;h.usingBundle=y;var v=Nt.matchPrefix(f,"a=ice-options:")[0];return v?h.canTrickleIceCandidates=v.substr(14).split(" ").indexOf("trickle")>=0:h.canTrickleIceCandidates=!1,m.forEach(function(b,A){var x=Nt.splitLines(b),w=Nt.getKind(b),_=Nt.isRejected(b)&&Nt.matchPrefix(b,"a=bundle-only").length===0,S=x[0].substr(2).split(" ")[2],M=Nt.getDirection(b,f),R=Nt.parseMsid(b),P=Nt.getMid(b)||Nt.generateIdentifier();if(_||w==="application"&&(S==="DTLS/SCTP"||S==="UDP/DTLS/SCTP")){h.transceivers[A]={mid:P,kind:w,protocol:S,rejected:!0};return}!_&&h.transceivers[A]&&h.transceivers[A].rejected&&(h.transceivers[A]=h._createTransceiver(w,!0));var C,L,B,z,D,W,O,F,X,J=Nt.parseRtpParameters(b),q,oe;_||(q=Nt.getIceParameters(b,f),oe=Nt.getDtlsParameters(b,f),oe.role="client"),O=Nt.parseRtpEncodingParameters(b);var _e=Nt.parseRtcpParameters(b),ke=Nt.matchPrefix(b,"a=end-of-candidates",f).length>0,re=Nt.matchPrefix(b,"a=candidate:").map(function(Ge){return Nt.parseCandidate(Ge)}).filter(function(Ge){return Ge.component===1});if((c.type==="offer"||c.type==="answer")&&!_&&y&&A>0&&h.transceivers[A]&&(h._disposeIceAndDtlsTransports(A),h.transceivers[A].iceGatherer=h.transceivers[0].iceGatherer,h.transceivers[A].iceTransport=h.transceivers[0].iceTransport,h.transceivers[A].dtlsTransport=h.transceivers[0].dtlsTransport,h.transceivers[A].rtpSender&&h.transceivers[A].rtpSender.setTransport(h.transceivers[0].dtlsTransport),h.transceivers[A].rtpReceiver&&h.transceivers[A].rtpReceiver.setTransport(h.transceivers[0].dtlsTransport)),c.type==="offer"&&!_){C=h.transceivers[A]||h._createTransceiver(w),C.mid=P,C.iceGatherer||(C.iceGatherer=h._createIceGatherer(A,y)),re.length&&C.iceTransport.state==="new"&&(ke&&(!y||A===0)?C.iceTransport.setRemoteCandidates(re):re.forEach(function(Ge){ZP(C.iceTransport,Ge)})),F=n.RTCRtpReceiver.getCapabilities(w),e<15019&&(F.codecs=F.codecs.filter(function(Ge){return Ge.name!=="rtx"})),W=C.sendEncodingParameters||[{ssrc:(2*A+2)*1001}];var we=!1;if(M==="sendrecv"||M==="sendonly"){if(we=!C.rtpReceiver,D=C.rtpReceiver||new n.RTCRtpReceiver(C.dtlsTransport,w),we){var Me;X=D.track,R&&R.stream==="-"||(R?(u[R.stream]||(u[R.stream]=new n.MediaStream,Object.defineProperty(u[R.stream],"id",{get:function(){return R.stream}})),Object.defineProperty(X,"id",{get:function(){return R.track}}),Me=u[R.stream]):(u.default||(u.default=new n.MediaStream),Me=u.default)),Me&&(i(X,Me),C.associatedRemoteMediaStreams.push(Me)),d.push([X,D,Me])}}else C.rtpReceiver&&C.rtpReceiver.track&&(C.associatedRemoteMediaStreams.forEach(function(Ge){var rt=Ge.getTracks().find(function(ge){return ge.id===C.rtpReceiver.track.id});rt&&s(rt,Ge)}),C.associatedRemoteMediaStreams=[]);C.localCapabilities=F,C.remoteCapabilities=J,C.rtpReceiver=D,C.rtcpParameters=_e,C.sendEncodingParameters=W,C.recvEncodingParameters=O,h._transceive(h.transceivers[A],!1,we)}else if(c.type==="answer"&&!_){C=h.transceivers[A],L=C.iceGatherer,B=C.iceTransport,z=C.dtlsTransport,D=C.rtpReceiver,W=C.sendEncodingParameters,F=C.localCapabilities,h.transceivers[A].recvEncodingParameters=O,h.transceivers[A].remoteCapabilities=J,h.transceivers[A].rtcpParameters=_e,re.length&&B.state==="new"&&((g||ke)&&(!y||A===0)?B.setRemoteCandidates(re):re.forEach(function(Ge){ZP(C.iceTransport,Ge)})),(!y||A===0)&&(B.state==="new"&&B.start(L,q,"controlling"),z.state==="new"&&z.start(oe));var it=IS(C.localCapabilities,C.remoteCapabilities),je=it.codecs.filter(function(Ge){return Ge.name.toLowerCase()==="rtx"}).length;!je&&C.sendEncodingParameters[0].rtx&&delete C.sendEncodingParameters[0].rtx,h._transceive(C,M==="sendrecv"||M==="recvonly",M==="sendrecv"||M==="sendonly"),D&&(M==="sendrecv"||M==="sendonly")?(X=D.track,R?(u[R.stream]||(u[R.stream]=new n.MediaStream),i(X,u[R.stream]),d.push([X,D,u[R.stream]])):(u.default||(u.default=new n.MediaStream),i(X,u.default),d.push([X,D,u.default]))):delete C.rtpReceiver}}),h._dtlsRole===void 0&&(h._dtlsRole=c.type==="offer"?"active":"passive"),h._remoteDescription={type:c.type,sdp:c.sdp},c.type==="offer"?h._updateSignalingState("have-remote-offer"):h._updateSignalingState("stable"),Object.keys(u).forEach(function(b){var A=u[b];if(A.getTracks().length){if(h.remoteStreams.indexOf(A)===-1){h.remoteStreams.push(A);var x=new Event("addstream");x.stream=A,n.setTimeout(function(){h._dispatchEvent("addstream",x)})}d.forEach(function(w){var _=w[0],S=w[1];A.id===w[2].id&&r(h,_,S,[A])})}}),d.forEach(function(b){b[2]||r(h,b[0],b[1],[])}),n.setTimeout(function(){h&&h.transceivers&&h.transceivers.forEach(function(b){b.iceTransport&&b.iceTransport.state==="new"&&b.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),b.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},o.prototype.close=function(){this.transceivers.forEach(function(c){c.iceTransport&&c.iceTransport.stop(),c.dtlsTransport&&c.dtlsTransport.stop(),c.rtpSender&&c.rtpSender.stop(),c.rtpReceiver&&c.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},o.prototype._updateSignalingState=function(c){this.signalingState=c;var h=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",h)},o.prototype._maybeFireNegotiationNeeded=function(){var c=this;this.signalingState!=="stable"||this.needNegotiation===!0||(this.needNegotiation=!0,n.setTimeout(function(){if(c.needNegotiation){c.needNegotiation=!1;var h=new Event("negotiationneeded");c._dispatchEvent("negotiationneeded",h)}},0))},o.prototype._updateIceConnectionState=function(){var c,h={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(d){d.iceTransport&&!d.rejected&&h[d.iceTransport.state]++}),c="new",h.failed>0?c="failed":h.checking>0?c="checking":h.disconnected>0?c="disconnected":h.new>0?c="new":h.connected>0?c="connected":h.completed>0&&(c="completed"),c!==this.iceConnectionState){this.iceConnectionState=c;var u=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",u)}},o.prototype._updateConnectionState=function(){var c,h={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(d){d.iceTransport&&d.dtlsTransport&&!d.rejected&&(h[d.iceTransport.state]++,h[d.dtlsTransport.state]++)}),h.connected+=h.completed,c="new",h.failed>0?c="failed":h.connecting>0?c="connecting":h.disconnected>0?c="disconnected":h.new>0?c="new":h.connected>0&&(c="connected"),c!==this.connectionState){this.connectionState=c;var u=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",u)}},o.prototype.createOffer=function(){var c=this;if(c._isClosed)return Promise.reject(Dr("InvalidStateError","Can not call createOffer after close"));var h=c.transceivers.filter(function(g){return g.kind==="audio"}).length,u=c.transceivers.filter(function(g){return g.kind==="video"}).length,d=arguments[0];if(d){if(d.mandatory||d.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");d.offerToReceiveAudio!==void 0&&(d.offerToReceiveAudio===!0?h=1:d.offerToReceiveAudio===!1?h=0:h=d.offerToReceiveAudio),d.offerToReceiveVideo!==void 0&&(d.offerToReceiveVideo===!0?u=1:d.offerToReceiveVideo===!1?u=0:u=d.offerToReceiveVideo)}for(c.transceivers.forEach(function(g){g.kind==="audio"?(h--,h<0&&(g.wantReceive=!1)):g.kind==="video"&&(u--,u<0&&(g.wantReceive=!1))});h>0||u>0;)h>0&&(c._createTransceiver("audio"),h--),u>0&&(c._createTransceiver("video"),u--);var m=Nt.writeSessionBoilerplate(c._sdpSessionId,c._sdpSessionVersion++);c.transceivers.forEach(function(g,y){var v=g.track,b=g.kind,A=g.mid||Nt.generateIdentifier();g.mid=A,g.iceGatherer||(g.iceGatherer=c._createIceGatherer(y,c.usingBundle));var x=n.RTCRtpSender.getCapabilities(b);e<15019&&(x.codecs=x.codecs.filter(function(_){return _.name!=="rtx"})),x.codecs.forEach(function(_){_.name==="H264"&&_.parameters["level-asymmetry-allowed"]===void 0&&(_.parameters["level-asymmetry-allowed"]="1"),g.remoteCapabilities&&g.remoteCapabilities.codecs&&g.remoteCapabilities.codecs.forEach(function(S){_.name.toLowerCase()===S.name.toLowerCase()&&_.clockRate===S.clockRate&&(_.preferredPayloadType=S.payloadType)})}),x.headerExtensions.forEach(function(_){var S=g.remoteCapabilities&&g.remoteCapabilities.headerExtensions||[];S.forEach(function(M){_.uri===M.uri&&(_.id=M.id)})});var w=g.sendEncodingParameters||[{ssrc:(2*y+1)*1001}];v&&e>=15019&&b==="video"&&!w[0].rtx&&(w[0].rtx={ssrc:w[0].ssrc+1}),g.wantReceive&&(g.rtpReceiver=new n.RTCRtpReceiver(g.dtlsTransport,b)),g.localCapabilities=x,g.sendEncodingParameters=w}),c._config.bundlePolicy!=="max-compat"&&(m+="a=group:BUNDLE "+c.transceivers.map(function(g){return g.mid}).join(" ")+`\r
`),m+=`a=ice-options:trickle\r
`,c.transceivers.forEach(function(g,y){m+=QW(g,g.localCapabilities,"offer",g.stream,c._dtlsRole),m+=`a=rtcp-rsize\r
`,g.iceGatherer&&c.iceGatheringState!=="new"&&(y===0||!c.usingBundle)&&(g.iceGatherer.getLocalCandidates().forEach(function(v){v.component=1,m+="a="+Nt.writeCandidate(v)+`\r
`}),g.iceGatherer.state==="completed"&&(m+=`a=end-of-candidates\r
`))});var f=new n.RTCSessionDescription({type:"offer",sdp:m});return Promise.resolve(f)},o.prototype.createAnswer=function(){var c=this;if(c._isClosed)return Promise.reject(Dr("InvalidStateError","Can not call createAnswer after close"));if(!(c.signalingState==="have-remote-offer"||c.signalingState==="have-local-pranswer"))return Promise.reject(Dr("InvalidStateError","Can not call createAnswer in signalingState "+c.signalingState));var h=Nt.writeSessionBoilerplate(c._sdpSessionId,c._sdpSessionVersion++);c.usingBundle&&(h+="a=group:BUNDLE "+c.transceivers.map(function(m){return m.mid}).join(" ")+`\r
`),h+=`a=ice-options:trickle\r
`;var u=Nt.getMediaSections(c._remoteDescription.sdp).length;c.transceivers.forEach(function(m,f){if(!(f+1>u)){if(m.rejected){m.kind==="application"?m.protocol==="DTLS/SCTP"?h+=`m=application 0 DTLS/SCTP 5000\r
`:h+="m=application 0 "+m.protocol+` webrtc-datachannel\r
`:m.kind==="audio"?h+=`m=audio 0 UDP/TLS/RTP/SAVPF 0\r
a=rtpmap:0 PCMU/8000\r
`:m.kind==="video"&&(h+=`m=video 0 UDP/TLS/RTP/SAVPF 120\r
a=rtpmap:120 VP8/90000\r
`),h+=`c=IN IP4 0.0.0.0\r
a=inactive\r
a=mid:`+m.mid+`\r
`;return}if(m.stream){var g;m.kind==="audio"?g=m.stream.getAudioTracks()[0]:m.kind==="video"&&(g=m.stream.getVideoTracks()[0]),g&&e>=15019&&m.kind==="video"&&!m.sendEncodingParameters[0].rtx&&(m.sendEncodingParameters[0].rtx={ssrc:m.sendEncodingParameters[0].ssrc+1})}var y=IS(m.localCapabilities,m.remoteCapabilities),v=y.codecs.filter(function(b){return b.name.toLowerCase()==="rtx"}).length;!v&&m.sendEncodingParameters[0].rtx&&delete m.sendEncodingParameters[0].rtx,h+=QW(m,y,"answer",m.stream,c._dtlsRole),m.rtcpParameters&&m.rtcpParameters.reducedSize&&(h+=`a=rtcp-rsize\r
`)}});var d=new n.RTCSessionDescription({type:"answer",sdp:h});return Promise.resolve(d)},o.prototype.addIceCandidate=function(c){var h=this,u;return c&&!(c.sdpMLineIndex!==void 0||c.sdpMid)?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(d,m){if(h._remoteDescription)if(!c||c.candidate==="")for(var f=0;f<h.transceivers.length&&!(!h.transceivers[f].rejected&&(h.transceivers[f].iceTransport.addRemoteCandidate({}),u=Nt.getMediaSections(h._remoteDescription.sdp),u[f]+=`a=end-of-candidates\r
`,h._remoteDescription.sdp=Nt.getDescription(h._remoteDescription.sdp)+u.join(""),h.usingBundle));f++);else{var g=c.sdpMLineIndex;if(c.sdpMid){for(var y=0;y<h.transceivers.length;y++)if(h.transceivers[y].mid===c.sdpMid){g=y;break}}var v=h.transceivers[g];if(v){if(v.rejected)return d();var b=Object.keys(c.candidate).length>0?Nt.parseCandidate(c.candidate):{};if(b.protocol==="tcp"&&(b.port===0||b.port===9)||b.component&&b.component!==1)return d();if((g===0||g>0&&v.iceTransport!==h.transceivers[0].iceTransport)&&!ZP(v.iceTransport,b))return m(Dr("OperationError","Can not add ICE candidate"));var A=c.candidate.trim();A.indexOf("a=")===0&&(A=A.substr(2)),u=Nt.getMediaSections(h._remoteDescription.sdp),u[g]+="a="+(b.type?A:"end-of-candidates")+`\r
`,h._remoteDescription.sdp=Nt.getDescription(h._remoteDescription.sdp)+u.join("")}else return m(Dr("OperationError","Can not add ICE candidate"))}else return m(Dr("InvalidStateError","Can not add ICE candidate without a remote description"));d()})},o.prototype.getStats=function(c){if(c&&c instanceof n.MediaStreamTrack){var h=null;if(this.transceivers.forEach(function(d){d.rtpSender&&d.rtpSender.track===c?h=d.rtpSender:d.rtpReceiver&&d.rtpReceiver.track===c&&(h=d.rtpReceiver)}),!h)throw Dr("InvalidAccessError","Invalid selector.");return h.getStats()}var u=[];return this.transceivers.forEach(function(d){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(m){d[m]&&u.push(d[m].getStats())})}),Promise.all(u).then(function(d){var m=new Map;return d.forEach(function(f){f.forEach(function(g){m.set(g.id,g)})}),m})};var a=["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"];a.forEach(function(c){var h=n[c];if(h&&h.prototype&&h.prototype.getStats){var u=h.prototype.getStats;h.prototype.getStats=function(){return u.apply(this).then(function(d){var m=new Map;return Object.keys(d).forEach(function(f){d[f].type=Ide(d[f]),m.set(f,d[f])}),m})}}});var l=["createOffer","createAnswer"];return l.forEach(function(c){var h=o.prototype[c];o.prototype[c]=function(){var u=arguments;return typeof u[0]=="function"||typeof u[1]=="function"?h.apply(this,[arguments[2]]).then(function(d){typeof u[0]=="function"&&u[0].apply(null,[d])},function(d){typeof u[1]=="function"&&u[1].apply(null,[d])}):h.apply(this,arguments)}}),l=["setLocalDescription","setRemoteDescription","addIceCandidate"],l.forEach(function(c){var h=o.prototype[c];o.prototype[c]=function(){var u=arguments;return typeof u[1]=="function"||typeof u[2]=="function"?h.apply(this,arguments).then(function(){typeof u[1]=="function"&&u[1].apply(null)},function(d){typeof u[2]=="function"&&u[2].apply(null,[d])}):h.apply(this,arguments)}}),["getStats"].forEach(function(c){var h=o.prototype[c];o.prototype[c]=function(){var u=arguments;return typeof u[1]=="function"?h.apply(this,arguments).then(function(){typeof u[1]=="function"&&u[1].apply(null)}):h.apply(this,arguments)}}),o};const Bde=ES(Pde);function YW(n){const e=n&&n.navigator,i=function(r){return{name:{PermissionDeniedError:"NotAllowedError"}[r.name]||r.name,message:r.message,constraint:r.constraint,toString(){return this.name}}},s=e.mediaDevices.getUserMedia.bind(e.mediaDevices);e.mediaDevices.getUserMedia=function(r){return s(r).catch(o=>Promise.reject(i(o)))}}function KW(n){"getDisplayMedia"in n.navigator&&n.navigator.mediaDevices&&(n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||(n.navigator.mediaDevices.getDisplayMedia=n.navigator.getDisplayMedia.bind(n.navigator)))}function YP(n,e){if(n.RTCIceGatherer&&(n.RTCIceCandidate||(n.RTCIceCandidate=function(s){return s}),n.RTCSessionDescription||(n.RTCSessionDescription=function(s){return s}),e.version<15025)){const s=Object.getOwnPropertyDescriptor(n.MediaStreamTrack.prototype,"enabled");Object.defineProperty(n.MediaStreamTrack.prototype,"enabled",{set(r){s.set.call(this,r);const o=new Event("enabled");o.enabled=r,this.dispatchEvent(o)}})}n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)&&Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=new n.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}}),n.RTCDtmfSender&&!n.RTCDTMFSender&&(n.RTCDTMFSender=n.RTCDtmfSender);const i=Bde(n,e.version);n.RTCPeerConnection=function(s){return s&&s.iceServers&&(s.iceServers=Rde(s.iceServers,e.version),HP("ICE servers after filtering:",s.iceServers)),new i(s)},n.RTCPeerConnection.prototype=i.prototype}function JW(n){n.RTCRtpSender&&!("replaceTrack"in n.RTCRtpSender.prototype)&&(n.RTCRtpSender.prototype.replaceTrack=n.RTCRtpSender.prototype.setTrack)}const qW=Object.freeze(Object.defineProperty({__proto__:null,shimGetDisplayMedia:KW,shimGetUserMedia:YW,shimPeerConnection:YP,shimReplaceTrack:JW},Symbol.toStringTag,{value:"Module"}));function $W(n,e){const i=n&&n.navigator,s=n&&n.MediaStreamTrack;if(i.getUserMedia=function(r,o,a){TS("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(r).then(o,a)},!(e.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){const r=function(a,l,c){l in a&&!(c in a)&&(a[c]=a[l],delete a[l])},o=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(a){return typeof a=="object"&&typeof a.audio=="object"&&(a=JSON.parse(JSON.stringify(a)),r(a.audio,"autoGainControl","mozAutoGainControl"),r(a.audio,"noiseSuppression","mozNoiseSuppression")),o(a)},s&&s.prototype.getSettings){const a=s.prototype.getSettings;s.prototype.getSettings=function(){const l=a.apply(this,arguments);return r(l,"mozAutoGainControl","autoGainControl"),r(l,"mozNoiseSuppression","noiseSuppression"),l}}if(s&&s.prototype.applyConstraints){const a=s.prototype.applyConstraints;s.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),r(l,"autoGainControl","mozAutoGainControl"),r(l,"noiseSuppression","mozNoiseSuppression")),a.apply(this,[l])}}}}function kde(n,e){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&(n.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){const s=new DOMException("getDisplayMedia without video constraints is undefined");return s.name="NotFoundError",s.code=8,Promise.reject(s)}return i.video===!0?i.video={mediaSource:e}:i.video.mediaSource=e,n.navigator.mediaDevices.getUserMedia(i)})}function eH(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function KP(n,e){if(typeof n!="object"||!(n.RTCPeerConnection||n.mozRTCPeerConnection))return;!n.RTCPeerConnection&&n.mozRTCPeerConnection&&(n.RTCPeerConnection=n.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const o=n.RTCPeerConnection.prototype[r],a={[r](){return arguments[0]=new(r==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};n.RTCPeerConnection.prototype[r]=a[r]});const i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},s=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[r,o,a]=arguments;return s.apply(this,[r||null]).then(l=>{if(e.version<53&&!o)try{l.forEach(c=>{c.type=i[c.type]||c.type})}catch(c){if(c.name!=="TypeError")throw c;l.forEach((h,u)=>{l.set(u,Object.assign({},h,{type:i[h.type]||h.type}))})}return l}).then(o,a)}}function tH(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpSender.prototype)return;const e=n.RTCPeerConnection.prototype.getSenders;e&&(n.RTCPeerConnection.prototype.getSenders=function(){const s=e.apply(this,[]);return s.forEach(r=>r._pc=this),s});const i=n.RTCPeerConnection.prototype.addTrack;i&&(n.RTCPeerConnection.prototype.addTrack=function(){const s=i.apply(this,arguments);return s._pc=this,s}),n.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function iH(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpReceiver.prototype)return;const e=n.RTCPeerConnection.prototype.getReceivers;e&&(n.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach(s=>s._pc=this),i}),i0(n,"track",i=>(i.receiver._pc=i.srcElement,i)),n.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function nH(n){!n.RTCPeerConnection||"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(e){TS("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&e.getTracks().includes(i.track)&&this.removeTrack(i)})})}function sH(n){n.DataChannel&&!n.RTCDataChannel&&(n.RTCDataChannel=n.DataChannel)}function rH(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.addTransceiver;e&&(n.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const i=arguments[1],s=i&&"sendEncodings"in i;s&&i.sendEncodings.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const r=e.apply(this,arguments);if(s){const{sender:o}=r,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=i.sendEncodings,o.sendEncodings=i.sendEncodings,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return r})}function oH(n){if(!(typeof n=="object"&&n.RTCRtpSender))return;const e=n.RTCRtpSender.prototype.getParameters;e&&(n.RTCRtpSender.prototype.getParameters=function(){const i=e.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function aH(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function lH(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createAnswer;n.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}const cH=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:rH,shimCreateAnswer:lH,shimCreateOffer:aH,shimGetDisplayMedia:kde,shimGetParameters:oH,shimGetUserMedia:$W,shimOnTrack:eH,shimPeerConnection:KP,shimRTCDataChannel:sH,shimReceiverGetStats:iH,shimRemoveStream:nH,shimSenderGetStats:tH},Symbol.toStringTag,{value:"Module"}));function hH(n){if(!(typeof n!="object"||!n.RTCPeerConnection)){if("getLocalStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in n.RTCPeerConnection.prototype)){const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(s=>e.call(this,s,i)),i.getVideoTracks().forEach(s=>e.call(this,s,i))},n.RTCPeerConnection.prototype.addTrack=function(i,...s){return s&&s.forEach(r=>{this._localStreams?this._localStreams.includes(r)||this._localStreams.push(r):this._localStreams=[r]}),e.apply(this,arguments)}}"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(e);if(i===-1)return;this._localStreams.splice(i,1);const s=e.getTracks();this.getSenders().forEach(r=>{s.includes(r.track)&&this.removeTrack(r)})})}}function uH(n){if(!(typeof n!="object"||!n.RTCPeerConnection)&&("getRemoteStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in n.RTCPeerConnection.prototype))){Object.defineProperty(n.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(i){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=i),this.addEventListener("track",this._onaddstreampoly=s=>{s.streams.forEach(r=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(r))return;this._remoteStreams.push(r);const o=new Event("addstream");o.stream=r,this.dispatchEvent(o)})})}});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(s){s.streams.forEach(r=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(r)>=0)return;i._remoteStreams.push(r);const o=new Event("addstream");o.stream=r,i.dispatchEvent(o)})}),e.apply(i,arguments)}}}function dH(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const e=n.RTCPeerConnection.prototype,i=e.createOffer,s=e.createAnswer,r=e.setLocalDescription,o=e.setRemoteDescription,a=e.addIceCandidate;e.createOffer=function(c,h){const u=arguments.length>=2?arguments[2]:arguments[0],d=i.apply(this,[u]);return h?(d.then(c,h),Promise.resolve()):d},e.createAnswer=function(c,h){const u=arguments.length>=2?arguments[2]:arguments[0],d=s.apply(this,[u]);return h?(d.then(c,h),Promise.resolve()):d};let l=function(c,h,u){const d=r.apply(this,[c]);return u?(d.then(h,u),Promise.resolve()):d};e.setLocalDescription=l,l=function(c,h,u){const d=o.apply(this,[c]);return u?(d.then(h,u),Promise.resolve()):d},e.setRemoteDescription=l,l=function(c,h,u){const d=a.apply(this,[c]);return u?(d.then(h,u),Promise.resolve()):d},e.addIceCandidate=l}function pH(n){const e=n&&n.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const i=e.mediaDevices,s=i.getUserMedia.bind(i);e.mediaDevices.getUserMedia=r=>s(mH(r))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=function(i,s,r){e.mediaDevices.getUserMedia(i).then(s,r)}.bind(e))}function mH(n){return n&&n.video!==void 0?Object.assign({},n,{video:PW(n.video)}):n}function fH(n){if(!n.RTCPeerConnection)return;const e=n.RTCPeerConnection;n.RTCPeerConnection=function(i,s){if(i&&i.iceServers){const r=[];for(let o=0;o<i.iceServers.length;o++){let a=i.iceServers[o];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(TS("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,r.push(a)):r.push(i.iceServers[o])}i.iceServers=r}return new e(i,s)},n.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function gH(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function yH(n){const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(i){if(i){typeof i.offerToReceiveAudio<"u"&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):i.offerToReceiveAudio===!0&&!s&&this.addTransceiver("audio"),typeof i.offerToReceiveVideo<"u"&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const r=this.getTransceivers().find(o=>o.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveVideo===!0&&!r&&this.addTransceiver("video")}return e.apply(this,arguments)}}function vH(n){typeof n!="object"||n.AudioContext||(n.AudioContext=n.webkitAudioContext)}const bH=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:vH,shimCallbacksAPI:dH,shimConstraints:mH,shimCreateOfferLegacy:yH,shimGetUserMedia:pH,shimLocalStreamsAPI:hH,shimRTCIceServerUrls:fH,shimRemoteStreamsAPI:uH,shimTrackEventTransceiver:gH},Symbol.toStringTag,{value:"Module"}));function LS(n){if(!n.RTCIceCandidate||n.RTCIceCandidate&&"foundation"in n.RTCIceCandidate.prototype)return;const e=n.RTCIceCandidate;n.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&(i=JSON.parse(JSON.stringify(i)),i.candidate=i.candidate.substr(2)),i.candidate&&i.candidate.length){const s=new e(i),r=RS.parseCandidate(i.candidate),o=Object.assign(s,r);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new e(i)},n.RTCIceCandidate.prototype=e.prototype,i0(n,"icecandidate",i=>(i.candidate&&Object.defineProperty(i,"candidate",{value:new n.RTCIceCandidate(i.candidate),writable:"false"}),i))}function Mb(n,e){if(!n.RTCPeerConnection)return;"sctp"in n.RTCPeerConnection.prototype||Object.defineProperty(n.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const i=function(l){if(!l||!l.sdp)return!1;const c=RS.splitSections(l.sdp);return c.shift(),c.some(h=>{const u=RS.parseMLine(h);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},s=function(l){const c=l.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const h=parseInt(c[1],10);return h!==h?-1:h},r=function(l){let c=65536;return e.browser==="firefox"&&(e.version<57?l===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},o=function(l,c){let h=65536;e.browser==="firefox"&&e.version===57&&(h=65535);const u=RS.matchPrefix(l.sdp,"a=max-message-size:");return u.length>0?h=parseInt(u[0].substr(19),10):e.browser==="firefox"&&c!==-1&&(h=2147483637),h},a=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:l}=this.getConfiguration();l==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){const l=s(arguments[0]),c=r(l),h=o(arguments[0],l);let u;c===0&&h===0?u=Number.POSITIVE_INFINITY:c===0||h===0?u=Math.max(c,h):u=Math.min(c,h);const d={};Object.defineProperty(d,"maxMessageSize",{get(){return u}}),this._sctp=d}return a.apply(this,arguments)}}function Eb(n){if(!(n.RTCPeerConnection&&"createDataChannel"in n.RTCPeerConnection.prototype))return;function e(s,r){const o=s.send;s.send=function(){const a=arguments[0],l=a.length||a.size||a.byteLength;if(s.readyState==="open"&&r.sctp&&l>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return o.apply(s,arguments)}}const i=n.RTCPeerConnection.prototype.createDataChannel;n.RTCPeerConnection.prototype.createDataChannel=function(){const s=i.apply(this,arguments);return e(s,this),s},i0(n,"datachannel",s=>(e(s.channel,s.target),s))}function JP(n){if(!n.RTCPeerConnection||"connectionState"in n.RTCPeerConnection.prototype)return;const e=n.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(i){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),i&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=i)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(i=>{const s=e[i];e[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const o=r.target;if(o._lastConnectionState!==o.connectionState){o._lastConnectionState=o.connectionState;const a=new Event("connectionstatechange",r);o.dispatchEvent(a)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),s.apply(this,arguments)}})}function qP(n,e){if(!n.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const i=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(s){if(s&&s.sdp&&s.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const r=s.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);n.RTCSessionDescription&&s instanceof n.RTCSessionDescription?arguments[0]=new n.RTCSessionDescription({type:s.type,sdp:r}):s.sdp=r}return i.apply(this,arguments)}}function PS(n,e){if(!(n.RTCPeerConnection&&n.RTCPeerConnection.prototype))return;const i=n.RTCPeerConnection.prototype.addIceCandidate;!i||i.length===0||(n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}const Dde=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:qP,shimAddIceCandidateNullOrEmpty:PS,shimConnectionState:JP,shimMaxMessageSize:Mb,shimRTCIceCandidate:LS,shimSendThrowTypeError:Eb},Symbol.toStringTag,{value:"Module"}));function Ode({window:n}={},e={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){const i=HP,s=Ede(n),r={browserDetails:s,commonShim:Dde,extractVersion:Cb,disableLog:Cde,disableWarnings:Mde};switch(s.browser){case"chrome":if(!WW||!QP||!e.shimChrome)return i("Chrome shim is not included in this adapter release."),r;if(s.version===null)return i("Chrome shim can not determine version, not shimming."),r;i("adapter.js shimming chrome."),r.browserShim=WW,PS(n,s),DW(n,s),OW(n),QP(n,s),GW(n),VW(n,s),zW(n),FW(n),NW(n),XW(n,s),LS(n),JP(n),Mb(n,s),Eb(n),qP(n,s);break;case"firefox":if(!cH||!KP||!e.shimFirefox)return i("Firefox shim is not included in this adapter release."),r;i("adapter.js shimming firefox."),r.browserShim=cH,PS(n,s),$W(n,s),KP(n,s),eH(n),nH(n),tH(n),iH(n),sH(n),rH(n),oH(n),aH(n),lH(n),LS(n),JP(n),Mb(n,s),Eb(n);break;case"edge":if(!qW||!YP||!e.shimEdge)return i("MS edge shim is not included in this adapter release."),r;i("adapter.js shimming edge."),r.browserShim=qW,YW(n),KW(n),YP(n,s),JW(n),Mb(n,s),Eb(n);break;case"safari":if(!bH||!e.shimSafari)return i("Safari shim is not included in this adapter release."),r;i("adapter.js shimming safari."),r.browserShim=bH,PS(n,s),fH(n),yH(n),dH(n),hH(n),uH(n),gH(n),pH(n),vH(n),LS(n),Mb(n,s),Eb(n),qP(n,s);break;default:i("Unsupported browser!");break}return r}const AH=Ode({window:typeof window>"u"?void 0:window});function gc(n,e,i,s){Object.defineProperty(n,e,{get:i,set:s,enumerable:!0,configurable:!0})}var $P=AH.default||AH,Tb=new(function(){function n(){this.isIOS=["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}return n.prototype.isWebRTCSupported=function(){return typeof RTCPeerConnection<"u"},n.prototype.isBrowserSupported=function(){var e=this.getBrowser(),i=this.getVersion(),s=this.supportedBrowsers.includes(e);return s?e==="chrome"?i>=this.minChromeVersion:e==="firefox"?i>=this.minFirefoxVersion:e==="safari"?!this.isIOS&&i>=this.minSafariVersion:!1:!1},n.prototype.getBrowser=function(){return $P.browserDetails.browser},n.prototype.getVersion=function(){return $P.browserDetails.version||0},n.prototype.isUnifiedPlanSupported=function(){var e=this.getBrowser(),i=$P.browserDetails.version||0;if(e==="chrome"&&i<this.minChromeVersion)return!1;if(e==="firefox"&&i>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var s,r=!1;try{s=new RTCPeerConnection,s.addTransceiver("audio"),r=!0}catch{}finally{s&&s.close()}return r},n.prototype.toString=function(){return`Supports:
    browser:`.concat(this.getBrowser(),`
    version:`).concat(this.getVersion(),`
    isIOS:`).concat(this.isIOS,`
    isWebRTCSupported:`).concat(this.isWebRTCSupported(),`
    isBrowserSupported:`).concat(this.isBrowserSupported(),`
    isUnifiedPlanSupported:`).concat(this.isUnifiedPlanSupported())},n}()),xH={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"},Gde=function(){function n(){this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.chunkedMTU=16300,this.defaultConfig=xH,this.browser=Tb.getBrowser(),this.browserVersion=Tb.getVersion(),this.supports=function(){var e={browser:Tb.isBrowserSupported(),webRTC:Tb.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!e.webRTC)return e;var i;try{i=new RTCPeerConnection(xH),e.audioVideo=!0;var s=void 0;try{s=i.createDataChannel("_PEERJSTEST",{ordered:!0}),e.data=!0,e.reliable=!!s.ordered;try{s.binaryType="blob",e.binaryBlob=!Tb.isIOS}catch{}}catch{}finally{s&&s.close()}}catch{}finally{i&&i.close()}return e}(),this.pack=TW.pack,this.unpack=TW.unpack,this._dataCount=1}return n.prototype.noop=function(){},n.prototype.validateId=function(e){return!e||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(e)},n.prototype.chunk=function(e){for(var i=[],s=e.size,r=Math.ceil(s/Mi.chunkedMTU),o=0,a=0;a<s;){var l=Math.min(s,a+Mi.chunkedMTU),c=e.slice(a,l),h={__peerData:this._dataCount,n:o,data:c,total:r};i.push(h),a=l,o++}return this._dataCount++,i},n.prototype.blobToArrayBuffer=function(e,i){var s=new FileReader;return s.onload=function(r){r.target&&i(r.target.result)},s.readAsArrayBuffer(e),s},n.prototype.binaryStringToArrayBuffer=function(e){for(var i=new Uint8Array(e.length),s=0;s<e.length;s++)i[s]=e.charCodeAt(s)&255;return i.buffer},n.prototype.randomToken=function(){return Math.random().toString(36).slice(2)},n.prototype.isSecure=function(){return location.protocol==="https:"},n}(),Mi=new Gde,wH={};gc(wH,"Peer",()=>rB,n=>rB=n);var Rb={},zde=Object.prototype.hasOwnProperty,ao="~";function Ib(){}Object.create&&(Ib.prototype=Object.create(null),new Ib().__proto__||(ao=!1));function Fde(n,e,i){this.fn=n,this.context=e,this.once=i||!1}function _H(n,e,i,s,r){if(typeof i!="function")throw new TypeError("The listener must be a function");var o=new Fde(i,s||n,r),a=ao?ao+e:e;return n._events[a]?n._events[a].fn?n._events[a]=[n._events[a],o]:n._events[a].push(o):(n._events[a]=o,n._eventsCount++),n}function BS(n,e){--n._eventsCount===0?n._events=new Ib:delete n._events[e]}function Or(){this._events=new Ib,this._eventsCount=0}Or.prototype.eventNames=function(){var n=[],e,i;if(this._eventsCount===0)return n;for(i in e=this._events)zde.call(e,i)&&n.push(ao?i.slice(1):i);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},Or.prototype.listeners=function(n){var e=ao?ao+n:n,i=this._events[e];if(!i)return[];if(i.fn)return[i.fn];for(var s=0,r=i.length,o=new Array(r);s<r;s++)o[s]=i[s].fn;return o},Or.prototype.listenerCount=function(n){var e=ao?ao+n:n,i=this._events[e];return i?i.fn?1:i.length:0},Or.prototype.emit=function(n,e,i,s,r,o){var a=ao?ao+n:n;if(!this._events[a])return!1;var l=this._events[a],c=arguments.length,h,u;if(l.fn){switch(l.once&&this.removeListener(n,l.fn,void 0,!0),c){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,e),!0;case 3:return l.fn.call(l.context,e,i),!0;case 4:return l.fn.call(l.context,e,i,s),!0;case 5:return l.fn.call(l.context,e,i,s,r),!0;case 6:return l.fn.call(l.context,e,i,s,r,o),!0}for(u=1,h=new Array(c-1);u<c;u++)h[u-1]=arguments[u];l.fn.apply(l.context,h)}else{var d=l.length,m;for(u=0;u<d;u++)switch(l[u].once&&this.removeListener(n,l[u].fn,void 0,!0),c){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,e);break;case 3:l[u].fn.call(l[u].context,e,i);break;case 4:l[u].fn.call(l[u].context,e,i,s);break;default:if(!h)for(m=1,h=new Array(c-1);m<c;m++)h[m-1]=arguments[m];l[u].fn.apply(l[u].context,h)}}return!0},Or.prototype.on=function(n,e,i){return _H(this,n,e,i,!1)},Or.prototype.once=function(n,e,i){return _H(this,n,e,i,!0)},Or.prototype.removeListener=function(n,e,i,s){var r=ao?ao+n:n;if(!this._events[r])return this;if(!e)return BS(this,r),this;var o=this._events[r];if(o.fn)o.fn===e&&(!s||o.once)&&(!i||o.context===i)&&BS(this,r);else{for(var a=0,l=[],c=o.length;a<c;a++)(o[a].fn!==e||s&&!o[a].once||i&&o[a].context!==i)&&l.push(o[a]);l.length?this._events[r]=l.length===1?l[0]:l:BS(this,r)}return this},Or.prototype.removeAllListeners=function(n){var e;return n?(e=ao?ao+n:n,this._events[e]&&BS(this,e)):(this._events=new Ib,this._eventsCount=0),this},Or.prototype.off=Or.prototype.removeListener,Or.prototype.addListener=Or.prototype.on,Or.prefixed=ao,Or.EventEmitter=Or,Rb=Or;var pt={};gc(pt,"LogLevel",()=>Po,n=>Po=n),gc(pt,"default",()=>SH,n=>SH=n);var gm=function(n,e){var i=typeof Symbol=="function"&&n[Symbol.iterator];if(!i)return n;var s=i.call(n),r,o=[],a;try{for(;(e===void 0||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(l){a={error:l}}finally{try{r&&!r.done&&(i=s.return)&&i.call(s)}finally{if(a)throw a.error}}return o},ym=function(n,e,i){if(i||arguments.length===2)for(var s=0,r=e.length,o;s<r;s++)(o||!(s in e))&&(o||(o=Array.prototype.slice.call(e,0,s)),o[s]=e[s]);return n.concat(o||Array.prototype.slice.call(e))},Nde="PeerJS: ",Po;(function(n){n[n.Disabled=0]="Disabled",n[n.Errors=1]="Errors",n[n.Warnings=2]="Warnings",n[n.All=3]="All"})(Po||(Po={}));var Ude=function(){function n(){this._logLevel=Po.Disabled}return Object.defineProperty(n.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){this._logLevel=e},enumerable:!1,configurable:!0}),n.prototype.log=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this._logLevel>=Po.All&&this._print.apply(this,ym([Po.All],gm(e),!1))},n.prototype.warn=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this._logLevel>=Po.Warnings&&this._print.apply(this,ym([Po.Warnings],gm(e),!1))},n.prototype.error=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this._logLevel>=Po.Errors&&this._print.apply(this,ym([Po.Errors],gm(e),!1))},n.prototype.setLogFunction=function(e){this._print=e},n.prototype._print=function(e){for(var i=[],s=1;s<arguments.length;s++)i[s-1]=arguments[s];var r=ym([Nde],gm(i),!1);for(var o in r)r[o]instanceof Error&&(r[o]="("+r[o].name+") "+r[o].message);e>=Po.All?console.log.apply(console,ym([],gm(r),!1)):e>=Po.Warnings?console.warn.apply(console,ym(["WARNING"],gm(r),!1)):e>=Po.Errors&&console.error.apply(console,ym(["ERROR"],gm(r),!1))},n}(),SH=new Ude,CH={};gc(CH,"Socket",()=>MH,n=>MH=n);var Ll;(function(n){n.Data="data",n.Media="media"})(Ll||(Ll={}));var Wn;(function(n){n.BrowserIncompatible="browser-incompatible",n.Disconnected="disconnected",n.InvalidID="invalid-id",n.InvalidKey="invalid-key",n.Network="network",n.PeerUnavailable="peer-unavailable",n.SslUnavailable="ssl-unavailable",n.ServerError="server-error",n.SocketError="socket-error",n.SocketClosed="socket-closed",n.UnavailableID="unavailable-id",n.WebRTC="webrtc"})(Wn||(Wn={}));var Oh;(function(n){n.Binary="binary",n.BinaryUTF8="binary-utf8",n.JSON="json"})(Oh||(Oh={}));var Gh;(function(n){n.Message="message",n.Disconnected="disconnected",n.Error="error",n.Close="close"})(Gh||(Gh={}));var tr;(function(n){n.Heartbeat="HEARTBEAT",n.Candidate="CANDIDATE",n.Offer="OFFER",n.Answer="ANSWER",n.Open="OPEN",n.Error="ERROR",n.IdTaken="ID-TAKEN",n.InvalidKey="INVALID-KEY",n.Leave="LEAVE",n.Expire="EXPIRE"})(tr||(tr={}));var eB={};eB=JSON.parse('{"name":"peerjs","version":"1.4.7","keywords":["peerjs","webrtc","p2p","rtc"],"description":"PeerJS client","homepage":"https://peerjs.com","bugs":{"url":"https://github.com/peers/peerjs/issues"},"repository":{"type":"git","url":"https://github.com/peers/peerjs"},"license":"MIT","contributors":["Michelle Bu <michelle@michellebu.com>","afrokick <devbyru@gmail.com>","ericz <really.ez@gmail.com>","Jairo <kidandcat@gmail.com>","Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>","Jairo Caro-Accino Viciana <jairo@galax.be>","Carlos Caballero <carlos.caballero.gonzalez@gmail.com>","hc <hheennrryy@gmail.com>","Muhammad Asif <capripio@gmail.com>","PrashoonB <prashoonbhattacharjee@gmail.com>","Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>","akotynski <aleksanderkotbury@gmail.com>","lmb <i@lmb.io>","Jairooo <jairocaro@msn.com>","Moritz St\xFCckler <moritz.stueckler@gmail.com>","Simon <crydotsnakegithub@gmail.com>","Denis Lukov <denismassters@gmail.com>","Philipp Hancke <fippo@andyet.net>","Hans Oksendahl <hansoksendahl@gmail.com>","Jess <jessachandler@gmail.com>","khankuan <khankuan@gmail.com>","DUODVK <kurmanov.work@gmail.com>","XiZhao <kwang1imsa@gmail.com>","Matthias Lohr <matthias@lohr.me>","=frank tree <=frnktrb@googlemail.com>","Andre Eckardt <aeckardt@outlook.com>","Chris Cowan <agentme49@gmail.com>","Alex Chuev <alex@chuev.com>","alxnull <alxnull@e.mail.de>","Yemel Jardi <angel.jardi@gmail.com>","Ben Parnell <benjaminparnell.94@gmail.com>","Benny Lichtner <bennlich@gmail.com>","fresheneesz <bitetrudpublic@gmail.com>","bob.barstead@exaptive.com <bob.barstead@exaptive.com>","chandika <chandika@gmail.com>","emersion <contact@emersion.fr>","Christopher Van <cvan@users.noreply.github.com>","eddieherm <edhermoso@gmail.com>","Eduardo Pinho <enet4mikeenet@gmail.com>","Evandro Zanatta <ezanatta@tray.net.br>","Gardner Bickford <gardner@users.noreply.github.com>","Gian Luca <gianluca.cecchi@cynny.com>","PatrickJS <github@gdi2290.com>","jonnyf <github@jonathanfoss.co.uk>","Hizkia Felix <hizkifw@gmail.com>","Hristo Oskov <hristo.oskov@gmail.com>","Isaac Madwed <i.madwed@gmail.com>","Ilya Konanykhin <ilya.konanykhin@gmail.com>","jasonbarry <jasbarry@me.com>","Jonathan Burke <jonathan.burke.1311@googlemail.com>","Josh Hamit <josh.hamit@gmail.com>","Jordan Austin <jrax86@gmail.com>","Joel Wetzell <jwetzell@yahoo.com>","xizhao <kevin.wang@cloudera.com>","Alberto Torres <kungfoobar@gmail.com>","Jonathan Mayol <mayoljonathan@gmail.com>","Jefferson Felix <me@jsfelix.dev>","Rolf Erik Lekang <me@rolflekang.com>","Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>","Pepijn de Vos <pepijndevos@gmail.com>","JooYoung <qkdlql@naver.com>","Tobias Speicher <rootcommander@gmail.com>","Steve Blaurock <sblaurock@gmail.com>","Kyrylo Shegeda <shegeda@ualberta.ca>","Diwank Singh Tomer <singh@diwank.name>","So\u0308ren Balko <Soeren.Balko@gmail.com>","Arpit Solanki <solankiarpit1997@gmail.com>","Yuki Ito <yuki@gnnk.net>","Artur Zayats <zag2art@gmail.com>"],"funding":{"type":"opencollective","url":"https://opencollective.com/peer"},"collective":{"type":"opencollective","url":"https://opencollective.com/peer"},"files":["dist/*"],"sideEffects":["lib/global.ts","lib/supports.ts"],"main":"dist/bundler.cjs","module":"dist/bundler.mjs","browser-minified":"dist/peerjs.min.js","browser-unminified":"dist/peerjs.js","types":"dist/types.d.ts","engines":{"node":">= 10"},"targets":{"types":{"source":"lib/exports.ts"},"main":{"source":"lib/exports.ts","sourceMap":{"inlineSources":true}},"module":{"source":"lib/exports.ts","includeNodeModules":["eventemitter3"],"sourceMap":{"inlineSources":true}},"browser-minified":{"context":"browser","outputFormat":"global","optimize":true,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"},"browser-unminified":{"context":"browser","outputFormat":"global","optimize":false,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"}},"scripts":{"contributors":"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\"chore(contributors): update and sort contributors list\\"","check":"tsc --noEmit","watch":"parcel watch","build":"rm -rf dist && parcel build","prepublishOnly":"npm run build","test":"mocha -r ts-node/register -r jsdom-global/register test/**/*.ts","format":"prettier --write .","semantic-release":"semantic-release"},"devDependencies":{"@parcel/config-default":"^2.5.0","@parcel/packager-ts":"^2.5.0","@parcel/transformer-typescript-tsc":"^2.5.0","@parcel/transformer-typescript-types":"^2.5.0","@semantic-release/changelog":"^6.0.1","@semantic-release/git":"^10.0.1","@types/chai":"^4.3.0","@types/mocha":"^9.1.0","@types/node":"^17.0.18","chai":"^4.3.6","git-authors-cli":"^1.0.40","jsdom":"^19.0.0","jsdom-global":"^3.0.2","mocha":"^9.2.0","mock-socket":"8.0.5","parcel":"^2.5.0","parcel-transformer-tsc-sourcemaps":"^1.0.2","prettier":"^2.6.2","semantic-release":"^19.0.2","standard":"^16.0.4","ts-node":"^10.5.0","typescript":"^4.5.5"},"dependencies":{"@swc/helpers":"^0.3.13","eventemitter3":"^4.0.7","peerjs-js-binarypack":"1.0.1","webrtc-adapter":"^7.7.1"}}');var Vde=function(){var n=function(e,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,r){s.__proto__=r}||function(s,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(s[o]=r[o])},n(e,i)};return function(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(e,i);function s(){this.constructor=e}e.prototype=i===null?Object.create(i):(s.prototype=i.prototype,new s)}}(),Xde=function(n,e){var i=typeof Symbol=="function"&&n[Symbol.iterator];if(!i)return n;var s=i.call(n),r,o=[],a;try{for(;(e===void 0||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(l){a={error:l}}finally{try{r&&!r.done&&(i=s.return)&&i.call(s)}finally{if(a)throw a.error}}return o},Wde=function(n,e,i){if(i||arguments.length===2)for(var s=0,r=e.length,o;s<r;s++)(o||!(s in e))&&(o||(o=Array.prototype.slice.call(e,0,s)),o[s]=e[s]);return n.concat(o||Array.prototype.slice.call(e))},Hde=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,i=e&&n[e],s=0;if(i)return i.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&s>=n.length&&(n=void 0),{value:n&&n[s++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},MH=function(n){Vde(e,n);function e(i,s,r,o,a,l){l===void 0&&(l=5e3);var c=n.call(this)||this;c.pingInterval=l,c._disconnected=!0,c._messagesQueue=[];var h=i?"wss://":"ws://";return c._baseUrl=h+s+":"+r+o+"peerjs?key="+a,c}return e.prototype.start=function(i,s){var r=this;this._id=i;var o="".concat(this._baseUrl,"&id=").concat(i,"&token=").concat(s);this._socket||!this._disconnected||(this._socket=new WebSocket(o+"&version="+eB.version),this._disconnected=!1,this._socket.onmessage=function(a){var l;try{l=JSON.parse(a.data),pt.default.log("Server message received:",l)}catch{pt.default.log("Invalid server message",a.data);return}r.emit(Gh.Message,l)},this._socket.onclose=function(a){r._disconnected||(pt.default.log("Socket closed.",a),r._cleanup(),r._disconnected=!0,r.emit(Gh.Disconnected))},this._socket.onopen=function(){r._disconnected||(r._sendQueuedMessages(),pt.default.log("Socket open"),r._scheduleHeartbeat())})},e.prototype._scheduleHeartbeat=function(){var i=this;this._wsPingTimer=setTimeout(function(){i._sendHeartbeat()},this.pingInterval)},e.prototype._sendHeartbeat=function(){if(!this._wsOpen()){pt.default.log("Cannot send heartbeat, because socket closed");return}var i=JSON.stringify({type:tr.Heartbeat});this._socket.send(i),this._scheduleHeartbeat()},e.prototype._wsOpen=function(){return!!this._socket&&this._socket.readyState===1},e.prototype._sendQueuedMessages=function(){var i,s,r=Wde([],Xde(this._messagesQueue),!1);this._messagesQueue=[];try{for(var o=Hde(r),a=o.next();!a.done;a=o.next()){var l=a.value;this.send(l)}}catch(c){i={error:c}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}},e.prototype.send=function(i){if(!this._disconnected){if(!this._id){this._messagesQueue.push(i);return}if(!i.type){this.emit(Gh.Error,"Invalid message");return}if(this._wsOpen()){var s=JSON.stringify(i);this._socket.send(s)}}},e.prototype.close=function(){this._disconnected||(this._cleanup(),this._disconnected=!0)},e.prototype._cleanup=function(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)},e}(Rb.EventEmitter),tB={};gc(tB,"MediaConnection",()=>RH,n=>RH=n);var iB={};gc(iB,"Negotiator",()=>EH,n=>EH=n);var kS=function(){return kS=Object.assign||function(n){for(var e,i=1,s=arguments.length;i<s;i++){e=arguments[i];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r])}return n},kS.apply(this,arguments)},DS=function(n,e,i,s){function r(o){return o instanceof i?o:new i(function(a){a(o)})}return new(i||(i=Promise))(function(o,a){function l(u){try{h(s.next(u))}catch(d){a(d)}}function c(u){try{h(s.throw(u))}catch(d){a(d)}}function h(u){u.done?o(u.value):r(u.value).then(l,c)}h((s=s.apply(n,e||[])).next())})},OS=function(n,e){var i={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},s,r,o,a;return a={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(h){return function(u){return c([h,u])}}function c(h){if(s)throw new TypeError("Generator is already executing.");for(;i;)try{if(s=1,r&&(o=h[0]&2?r.return:h[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,h[1])).done)return o;switch(r=0,o&&(h=[h[0]&2,o.value]),h[0]){case 0:case 1:o=h;break;case 4:return i.label++,{value:h[1],done:!1};case 5:i.label++,r=h[1],h=[0];continue;case 7:h=i.ops.pop(),i.trys.pop();continue;default:if(o=i.trys,!(o=o.length>0&&o[o.length-1])&&(h[0]===6||h[0]===2)){i=0;continue}if(h[0]===3&&(!o||h[1]>o[0]&&h[1]<o[3])){i.label=h[1];break}if(h[0]===6&&i.label<o[1]){i.label=o[1],o=h;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(h);break}o[2]&&i.ops.pop(),i.trys.pop();continue}h=e.call(n,i)}catch(u){h=[6,u],r=0}finally{s=o=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}},EH=function(){function n(e){this.connection=e}return n.prototype.startConnection=function(e){var i=this._startPeerConnection();if(this.connection.peerConnection=i,this.connection.type===Ll.Media&&e._stream&&this._addTracksToConnection(e._stream,i),e.originator){if(this.connection.type===Ll.Data){var s=this.connection,r={ordered:!!e.reliable},o=i.createDataChannel(s.label,r);s.initialize(o)}this._makeOffer()}else this.handleSDP("OFFER",e.sdp)},n.prototype._startPeerConnection=function(){pt.default.log("Creating RTCPeerConnection.");var e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e},n.prototype._setupListeners=function(e){var i=this,s=this.connection.peer,r=this.connection.connectionId,o=this.connection.type,a=this.connection.provider;pt.default.log("Listening for ICE candidates."),e.onicecandidate=function(l){!l.candidate||!l.candidate.candidate||(pt.default.log("Received ICE candidates for ".concat(s,":"),l.candidate),a.socket.send({type:tr.Candidate,payload:{candidate:l.candidate,type:o,connectionId:r},dst:s}))},e.oniceconnectionstatechange=function(){switch(e.iceConnectionState){case"failed":pt.default.log("iceConnectionState is failed, closing connections to "+s),i.connection.emit("error",new Error("Negotiation of connection to "+s+" failed.")),i.connection.close();break;case"closed":pt.default.log("iceConnectionState is closed, closing connections to "+s),i.connection.emit("error",new Error("Connection to "+s+" closed.")),i.connection.close();break;case"disconnected":pt.default.log("iceConnectionState changed to disconnected on the connection with "+s);break;case"completed":e.onicecandidate=Mi.noop;break}i.connection.emit("iceStateChanged",e.iceConnectionState)},pt.default.log("Listening for data channel"),e.ondatachannel=function(l){pt.default.log("Received data channel");var c=l.channel,h=a.getConnection(s,r);h.initialize(c)},pt.default.log("Listening for remote stream"),e.ontrack=function(l){pt.default.log("Received remote stream");var c=l.streams[0],h=a.getConnection(s,r);if(h.type===Ll.Media){var u=h;i._addStreamToMediaConnection(c,u)}}},n.prototype.cleanup=function(){pt.default.log("Cleaning up PeerConnection to "+this.connection.peer);var e=this.connection.peerConnection;if(e){this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=function(){};var i=e.signalingState!=="closed",s=!1;if(this.connection.type===Ll.Data){var r=this.connection,o=r.dataChannel;o&&(s=!!o.readyState&&o.readyState!=="closed")}(i||s)&&e.close()}},n.prototype._makeOffer=function(){return DS(this,void 0,Promise,function(){var e,i,s,r,o,a,l;return OS(this,function(c){switch(c.label){case 0:e=this.connection.peerConnection,i=this.connection.provider,c.label=1;case 1:return c.trys.push([1,7,,8]),[4,e.createOffer(this.connection.options.constraints)];case 2:s=c.sent(),pt.default.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(s.sdp=this.connection.options.sdpTransform(s.sdp)||s.sdp),c.label=3;case 3:return c.trys.push([3,5,,6]),[4,e.setLocalDescription(s)];case 4:return c.sent(),pt.default.log("Set localDescription:",s,"for:".concat(this.connection.peer)),r={sdp:s,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata,browser:Mi.browser},this.connection.type===Ll.Data&&(o=this.connection,r=kS(kS({},r),{label:o.label,reliable:o.reliable,serialization:o.serialization})),i.socket.send({type:tr.Offer,payload:r,dst:this.connection.peer}),[3,6];case 5:return a=c.sent(),a!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(i.emitError(Wn.WebRTC,a),pt.default.log("Failed to setLocalDescription, ",a)),[3,6];case 6:return[3,8];case 7:return l=c.sent(),i.emitError(Wn.WebRTC,l),pt.default.log("Failed to createOffer, ",l),[3,8];case 8:return[2]}})})},n.prototype._makeAnswer=function(){return DS(this,void 0,Promise,function(){var e,i,s,r,o;return OS(this,function(a){switch(a.label){case 0:e=this.connection.peerConnection,i=this.connection.provider,a.label=1;case 1:return a.trys.push([1,7,,8]),[4,e.createAnswer()];case 2:s=a.sent(),pt.default.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(s.sdp=this.connection.options.sdpTransform(s.sdp)||s.sdp),a.label=3;case 3:return a.trys.push([3,5,,6]),[4,e.setLocalDescription(s)];case 4:return a.sent(),pt.default.log("Set localDescription:",s,"for:".concat(this.connection.peer)),i.socket.send({type:tr.Answer,payload:{sdp:s,type:this.connection.type,connectionId:this.connection.connectionId,browser:Mi.browser},dst:this.connection.peer}),[3,6];case 5:return r=a.sent(),i.emitError(Wn.WebRTC,r),pt.default.log("Failed to setLocalDescription, ",r),[3,6];case 6:return[3,8];case 7:return o=a.sent(),i.emitError(Wn.WebRTC,o),pt.default.log("Failed to create answer, ",o),[3,8];case 8:return[2]}})})},n.prototype.handleSDP=function(e,i){return DS(this,void 0,Promise,function(){var s,r,o,a;return OS(this,function(l){switch(l.label){case 0:i=new RTCSessionDescription(i),s=this.connection.peerConnection,r=this.connection.provider,pt.default.log("Setting remote description",i),o=this,l.label=1;case 1:return l.trys.push([1,5,,6]),[4,s.setRemoteDescription(i)];case 2:return l.sent(),pt.default.log("Set remoteDescription:".concat(e," for:").concat(this.connection.peer)),e!=="OFFER"?[3,4]:[4,o._makeAnswer()];case 3:l.sent(),l.label=4;case 4:return[3,6];case 5:return a=l.sent(),r.emitError(Wn.WebRTC,a),pt.default.log("Failed to setRemoteDescription, ",a),[3,6];case 6:return[2]}})})},n.prototype.handleCandidate=function(e){return DS(this,void 0,Promise,function(){var i,s,r,o,a,l;return OS(this,function(c){switch(c.label){case 0:pt.default.log("handleCandidate:",e),i=e.candidate,s=e.sdpMLineIndex,r=e.sdpMid,o=this.connection.peerConnection,a=this.connection.provider,c.label=1;case 1:return c.trys.push([1,3,,4]),[4,o.addIceCandidate(new RTCIceCandidate({sdpMid:r,sdpMLineIndex:s,candidate:i}))];case 2:return c.sent(),pt.default.log("Added ICE candidate for:".concat(this.connection.peer)),[3,4];case 3:return l=c.sent(),a.emitError(Wn.WebRTC,l),pt.default.log("Failed to handleCandidate, ",l),[3,4];case 4:return[2]}})})},n.prototype._addTracksToConnection=function(e,i){if(pt.default.log("add tracks from stream ".concat(e.id," to peer connection")),!i.addTrack)return pt.default.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach(function(s){i.addTrack(s,e)})},n.prototype._addStreamToMediaConnection=function(e,i){pt.default.log("add stream ".concat(e.id," to media connection ").concat(i.connectionId)),i.addStream(e)},n}(),nB={};gc(nB,"BaseConnection",()=>TH,n=>TH=n);var jde=function(){var n=function(e,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,r){s.__proto__=r}||function(s,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(s[o]=r[o])},n(e,i)};return function(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(e,i);function s(){this.constructor=e}e.prototype=i===null?Object.create(i):(s.prototype=i.prototype,new s)}}(),TH=function(n){jde(e,n);function e(i,s,r){var o=n.call(this)||this;return o.peer=i,o.provider=s,o.options=r,o._open=!1,o.metadata=r.metadata,o}return Object.defineProperty(e.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),e}(Rb.EventEmitter),Qde=function(){var n=function(e,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,r){s.__proto__=r}||function(s,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(s[o]=r[o])},n(e,i)};return function(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(e,i);function s(){this.constructor=e}e.prototype=i===null?Object.create(i):(s.prototype=i.prototype,new s)}}(),GS=function(){return GS=Object.assign||function(n){for(var e,i=1,s=arguments.length;i<s;i++){e=arguments[i];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r])}return n},GS.apply(this,arguments)},Zde=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,i=e&&n[e],s=0;if(i)return i.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&s>=n.length&&(n=void 0),{value:n&&n[s++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},RH=function(n){Qde(e,n);function e(i,s,r){var o=n.call(this,i,s,r)||this;return o._localStream=o.options._stream,o.connectionId=o.options.connectionId||e.ID_PREFIX+Mi.randomToken(),o._negotiator=new iB.Negotiator(o),o._localStream&&o._negotiator.startConnection({_stream:o._localStream,originator:!0}),o}return Object.defineProperty(e.prototype,"type",{get:function(){return Ll.Media},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"localStream",{get:function(){return this._localStream},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"remoteStream",{get:function(){return this._remoteStream},enumerable:!1,configurable:!0}),e.prototype.addStream=function(i){pt.default.log("Receiving stream",i),this._remoteStream=i,n.prototype.emit.call(this,"stream",i)},e.prototype.handleMessage=function(i){var s=i.type,r=i.payload;switch(i.type){case tr.Answer:this._negotiator.handleSDP(s,r.sdp),this._open=!0;break;case tr.Candidate:this._negotiator.handleCandidate(r.candidate);break;default:pt.default.warn("Unrecognized message type:".concat(s," from peer:").concat(this.peer));break}},e.prototype.answer=function(i,s){var r,o;if(s===void 0&&(s={}),this._localStream){pt.default.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=i,s&&s.sdpTransform&&(this.options.sdpTransform=s.sdpTransform),this._negotiator.startConnection(GS(GS({},this.options._payload),{_stream:i}));var a=this.provider._getMessages(this.connectionId);try{for(var l=Zde(a),c=l.next();!c.done;c=l.next()){var h=c.value;this.handleMessage(h)}}catch(u){r={error:u}}finally{try{c&&!c.done&&(o=l.return)&&o.call(l)}finally{if(r)throw r.error}}this._open=!0},e.prototype.close=function(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,n.prototype.emit.call(this,"close"))},e.ID_PREFIX="mc_",e}(nB.BaseConnection),sB={};gc(sB,"DataConnection",()=>PH,n=>PH=n);var IH={};gc(IH,"EncodingQueue",()=>LH,n=>LH=n);var Yde=function(){var n=function(e,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,r){s.__proto__=r}||function(s,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(s[o]=r[o])},n(e,i)};return function(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(e,i);function s(){this.constructor=e}e.prototype=i===null?Object.create(i):(s.prototype=i.prototype,new s)}}(),LH=function(n){Yde(e,n);function e(){var i=n.call(this)||this;return i.fileReader=new FileReader,i._queue=[],i._processing=!1,i.fileReader.onload=function(s){i._processing=!1,s.target&&i.emit("done",s.target.result),i.doNextTask()},i.fileReader.onerror=function(s){pt.default.error("EncodingQueue error:",s),i._processing=!1,i.destroy(),i.emit("error",s)},i}return Object.defineProperty(e.prototype,"queue",{get:function(){return this._queue},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"processing",{get:function(){return this._processing},enumerable:!1,configurable:!0}),e.prototype.enque=function(i){this.queue.push(i),!this.processing&&this.doNextTask()},e.prototype.destroy=function(){this.fileReader.abort(),this._queue=[]},e.prototype.doNextTask=function(){this.size!==0&&(this.processing||(this._processing=!0,this.fileReader.readAsArrayBuffer(this.queue.shift())))},e}(Rb.EventEmitter),Kde=function(){var n=function(e,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,r){s.__proto__=r}||function(s,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(s[o]=r[o])},n(e,i)};return function(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(e,i);function s(){this.constructor=e}e.prototype=i===null?Object.create(i):(s.prototype=i.prototype,new s)}}(),Jde=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,i=e&&n[e],s=0;if(i)return i.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&s>=n.length&&(n=void 0),{value:n&&n[s++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},PH=function(n){Kde(e,n);function e(i,s,r){var o=n.call(this,i,s,r)||this;return o.stringify=JSON.stringify,o.parse=JSON.parse,o._buffer=[],o._bufferSize=0,o._buffering=!1,o._chunkedData={},o._encodingQueue=new IH.EncodingQueue,o.connectionId=o.options.connectionId||e.ID_PREFIX+Mi.randomToken(),o.label=o.options.label||o.connectionId,o.serialization=o.options.serialization||Oh.Binary,o.reliable=!!o.options.reliable,o._encodingQueue.on("done",function(a){o._bufferedSend(a)}),o._encodingQueue.on("error",function(){pt.default.error("DC#".concat(o.connectionId,": Error occured in encoding from blob to arraybuffer, close DC")),o.close()}),o._negotiator=new iB.Negotiator(o),o._negotiator.startConnection(o.options._payload||{originator:!0}),o}return Object.defineProperty(e.prototype,"type",{get:function(){return Ll.Data},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dataChannel",{get:function(){return this._dc},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bufferSize",{get:function(){return this._bufferSize},enumerable:!1,configurable:!0}),e.prototype.initialize=function(i){this._dc=i,this._configureDataChannel()},e.prototype._configureDataChannel=function(){var i=this;(!Mi.supports.binaryBlob||Mi.supports.reliable)&&(this.dataChannel.binaryType="arraybuffer"),this.dataChannel.onopen=function(){pt.default.log("DC#".concat(i.connectionId," dc connection success")),i._open=!0,i.emit("open")},this.dataChannel.onmessage=function(s){pt.default.log("DC#".concat(i.connectionId," dc onmessage:"),s.data),i._handleDataMessage(s)},this.dataChannel.onclose=function(){pt.default.log("DC#".concat(i.connectionId," dc closed for:"),i.peer),i.close()}},e.prototype._handleDataMessage=function(i){var s=this,r=i.data,o=r.constructor,a=this.serialization===Oh.Binary||this.serialization===Oh.BinaryUTF8,l=r;if(a){if(o===Blob){Mi.blobToArrayBuffer(r,function(h){var u=Mi.unpack(h);s.emit("data",u)});return}else if(o===ArrayBuffer)l=Mi.unpack(r);else if(o===String){var c=Mi.binaryStringToArrayBuffer(r);l=Mi.unpack(c)}}else this.serialization===Oh.JSON&&(l=this.parse(r));if(l.__peerData){this._handleChunk(l);return}n.prototype.emit.call(this,"data",l)},e.prototype._handleChunk=function(i){var s=i.__peerData,r=this._chunkedData[s]||{data:[],count:0,total:i.total};if(r.data[i.n]=i.data,r.count++,this._chunkedData[s]=r,r.total===r.count){delete this._chunkedData[s];var o=new Blob(r.data);this._handleDataMessage({data:o})}},e.prototype.close=function(){this._buffer=[],this._bufferSize=0,this._chunkedData={},this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this._dc=null),this._encodingQueue&&(this._encodingQueue.destroy(),this._encodingQueue.removeAllListeners(),this._encodingQueue=null),this.open&&(this._open=!1,n.prototype.emit.call(this,"close"))},e.prototype.send=function(i,s){if(!this.open){n.prototype.emit.call(this,"error",new Error("Connection is not open. You should listen for the `open` event before sending messages."));return}if(this.serialization===Oh.JSON)this._bufferedSend(this.stringify(i));else if(this.serialization===Oh.Binary||this.serialization===Oh.BinaryUTF8){var r=Mi.pack(i);if(!s&&r.size>Mi.chunkedMTU){this._sendChunks(r);return}Mi.supports.binaryBlob?this._bufferedSend(r):this._encodingQueue.enque(r)}else this._bufferedSend(i)},e.prototype._bufferedSend=function(i){(this._buffering||!this._trySend(i))&&(this._buffer.push(i),this._bufferSize=this._buffer.length)},e.prototype._trySend=function(i){var s=this;if(!this.open)return!1;if(this.dataChannel.bufferedAmount>e.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(function(){s._buffering=!1,s._tryBuffer()},50),!1;try{this.dataChannel.send(i)}catch(r){return pt.default.error("DC#:".concat(this.connectionId," Error when sending:"),r),this._buffering=!0,this.close(),!1}return!0},e.prototype._tryBuffer=function(){if(this.open&&this._buffer.length!==0){var i=this._buffer[0];this._trySend(i)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}},e.prototype._sendChunks=function(i){var s,r,o=Mi.chunk(i);pt.default.log("DC#".concat(this.connectionId," Try to send ").concat(o.length," chunks..."));try{for(var a=Jde(o),l=a.next();!l.done;l=a.next()){var c=l.value;this.send(c,!0)}}catch(h){s={error:h}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(s)throw s.error}}},e.prototype.handleMessage=function(i){var s=i.payload;switch(i.type){case tr.Answer:this._negotiator.handleSDP(i.type,s.sdp);break;case tr.Candidate:this._negotiator.handleCandidate(s.candidate);break;default:pt.default.warn("Unrecognized message type:",i.type,"from peer:",this.peer);break}},e.ID_PREFIX="dc_",e.MAX_BUFFERED_AMOUNT=8388608,e}(nB.BaseConnection),BH={};gc(BH,"API",()=>OH,n=>OH=n);var kH=function(n,e,i,s){function r(o){return o instanceof i?o:new i(function(a){a(o)})}return new(i||(i=Promise))(function(o,a){function l(u){try{h(s.next(u))}catch(d){a(d)}}function c(u){try{h(s.throw(u))}catch(d){a(d)}}function h(u){u.done?o(u.value):r(u.value).then(l,c)}h((s=s.apply(n,e||[])).next())})},DH=function(n,e){var i={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},s,r,o,a;return a={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(h){return function(u){return c([h,u])}}function c(h){if(s)throw new TypeError("Generator is already executing.");for(;i;)try{if(s=1,r&&(o=h[0]&2?r.return:h[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,h[1])).done)return o;switch(r=0,o&&(h=[h[0]&2,o.value]),h[0]){case 0:case 1:o=h;break;case 4:return i.label++,{value:h[1],done:!1};case 5:i.label++,r=h[1],h=[0];continue;case 7:h=i.ops.pop(),i.trys.pop();continue;default:if(o=i.trys,!(o=o.length>0&&o[o.length-1])&&(h[0]===6||h[0]===2)){i=0;continue}if(h[0]===3&&(!o||h[1]>o[0]&&h[1]<o[3])){i.label=h[1];break}if(h[0]===6&&i.label<o[1]){i.label=o[1],o=h;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(h);break}o[2]&&i.ops.pop(),i.trys.pop();continue}h=e.call(n,i)}catch(u){h=[6,u],r=0}finally{s=o=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}},OH=function(){function n(e){this._options=e}return n.prototype._buildRequest=function(e){var i=this._options.secure?"https":"http",s=this._options,r=s.host,o=s.port,a=s.path,l=s.key,c=new URL("".concat(i,"://").concat(r,":").concat(o).concat(a).concat(l,"/").concat(e));return c.searchParams.set("ts","".concat(Date.now()).concat(Math.random())),c.searchParams.set("version",eB.version),fetch(c.href,{referrerPolicy:this._options.referrerPolicy})},n.prototype.retrieveId=function(){return kH(this,void 0,Promise,function(){var e,i,s;return DH(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this._buildRequest("id")];case 1:if(e=r.sent(),e.status!==200)throw new Error("Error. Status:".concat(e.status));return[2,e.text()];case 2:throw i=r.sent(),pt.default.error("Error retrieving ID",i),s="",this._options.path==="/"&&this._options.host!==Mi.CLOUD_HOST&&(s=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+s);case 3:return[2]}})})},n.prototype.listAllPeers=function(){return kH(this,void 0,Promise,function(){var e,i,s;return DH(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this._buildRequest("peers")];case 1:if(e=r.sent(),e.status!==200)throw e.status===401?(i="",this._options.host===Mi.CLOUD_HOST?i="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":i="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+i)):new Error("Error. Status:".concat(e.status));return[2,e.json()];case 2:throw s=r.sent(),pt.default.error("Error retrieving list peers",s),new Error("Could not get list peers from the server."+s);case 3:return[2]}})})},n}(),qde=function(){var n=function(e,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,r){s.__proto__=r}||function(s,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(s[o]=r[o])},n(e,i)};return function(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(e,i);function s(){this.constructor=e}e.prototype=i===null?Object.create(i):(s.prototype=i.prototype,new s)}}(),Lb=function(){return Lb=Object.assign||function(n){for(var e,i=1,s=arguments.length;i<s;i++){e=arguments[i];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r])}return n},Lb.apply(this,arguments)},Pb=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,i=e&&n[e],s=0;if(i)return i.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&s>=n.length&&(n=void 0),{value:n&&n[s++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},$de=function(n,e){var i=typeof Symbol=="function"&&n[Symbol.iterator];if(!i)return n;var s=i.call(n),r,o=[],a;try{for(;(e===void 0||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(l){a={error:l}}finally{try{r&&!r.done&&(i=s.return)&&i.call(s)}finally{if(a)throw a.error}}return o},rB=function(n){qde(e,n);function e(i,s){var r=n.call(this)||this;r._id=null,r._lastServerId=null,r._destroyed=!1,r._disconnected=!1,r._open=!1,r._connections=new Map,r._lostMessages=new Map;var o;return i&&i.constructor==Object?s=i:i&&(o=i.toString()),s=Lb({debug:0,host:Mi.CLOUD_HOST,port:Mi.CLOUD_PORT,path:"/",key:e.DEFAULT_KEY,token:Mi.randomToken(),config:Mi.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin"},s),r._options=s,r._options.host==="/"&&(r._options.host=window.location.hostname),r._options.path&&(r._options.path[0]!=="/"&&(r._options.path="/"+r._options.path),r._options.path[r._options.path.length-1]!=="/"&&(r._options.path+="/")),r._options.secure===void 0&&r._options.host!==Mi.CLOUD_HOST?r._options.secure=Mi.isSecure():r._options.host==Mi.CLOUD_HOST&&(r._options.secure=!0),r._options.logFunction&&pt.default.setLogFunction(r._options.logFunction),pt.default.logLevel=r._options.debug||0,r._api=new BH.API(s),r._socket=r._createServerConnection(),!Mi.supports.audioVideo&&!Mi.supports.data?(r._delayedAbort(Wn.BrowserIncompatible,"The current browser does not support WebRTC"),r):o&&!Mi.validateId(o)?(r._delayedAbort(Wn.InvalidID,'ID "'.concat(o,'" is invalid')),r):(o?r._initialize(o):r._api.retrieveId().then(function(a){return r._initialize(a)}).catch(function(a){return r._abort(Wn.ServerError,a)}),r)}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"socket",{get:function(){return this._socket},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"connections",{get:function(){var i,s,r=Object.create(null);try{for(var o=Pb(this._connections),a=o.next();!a.done;a=o.next()){var l=$de(a.value,2),c=l[0],h=l[1];r[c]=h}}catch(u){i={error:u}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}return r},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"disconnected",{get:function(){return this._disconnected},enumerable:!1,configurable:!0}),e.prototype._createServerConnection=function(){var i=this,s=new CH.Socket(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return s.on(Gh.Message,function(r){i._handleMessage(r)}),s.on(Gh.Error,function(r){i._abort(Wn.SocketError,r)}),s.on(Gh.Disconnected,function(){i.disconnected||(i.emitError(Wn.Network,"Lost connection to server."),i.disconnect())}),s.on(Gh.Close,function(){i.disconnected||i._abort(Wn.SocketClosed,"Underlying socket is already closed.")}),s},e.prototype._initialize=function(i){this._id=i,this.socket.start(i,this._options.token)},e.prototype._handleMessage=function(i){var s,r,o=i.type,a=i.payload,l=i.src;switch(o){case tr.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case tr.Error:this._abort(Wn.ServerError,a.msg);break;case tr.IdTaken:this._abort(Wn.UnavailableID,'ID "'.concat(this.id,'" is taken'));break;case tr.InvalidKey:this._abort(Wn.InvalidKey,'API KEY "'.concat(this._options.key,'" is invalid'));break;case tr.Leave:pt.default.log("Received leave message from ".concat(l)),this._cleanupPeer(l),this._connections.delete(l);break;case tr.Expire:this.emitError(Wn.PeerUnavailable,"Could not connect to peer ".concat(l));break;case tr.Offer:var g=a.connectionId,y=this.getConnection(l,g);if(y&&(y.close(),pt.default.warn("Offer received for existing Connection ID:".concat(g))),a.type===Ll.Media){var c=new tB.MediaConnection(l,this,{connectionId:g,_payload:a,metadata:a.metadata});y=c,this._addConnection(l,y),this.emit("call",c)}else if(a.type===Ll.Data){var h=new sB.DataConnection(l,this,{connectionId:g,_payload:a,metadata:a.metadata,label:a.label,serialization:a.serialization,reliable:a.reliable});y=h,this._addConnection(l,y),this.emit("connection",h)}else{pt.default.warn("Received malformed connection type:".concat(a.type));return}var u=this._getMessages(g);try{for(var d=Pb(u),m=d.next();!m.done;m=d.next()){var f=m.value;y.handleMessage(f)}}catch(v){s={error:v}}finally{try{m&&!m.done&&(r=d.return)&&r.call(d)}finally{if(s)throw s.error}}break;default:if(!a){pt.default.warn("You received a malformed message from ".concat(l," of type ").concat(o));return}var g=a.connectionId,y=this.getConnection(l,g);y&&y.peerConnection?y.handleMessage(i):g?this._storeMessage(g,i):pt.default.warn("You received an unrecognized message:",i);break}},e.prototype._storeMessage=function(i,s){this._lostMessages.has(i)||this._lostMessages.set(i,[]),this._lostMessages.get(i).push(s)},e.prototype._getMessages=function(i){var s=this._lostMessages.get(i);return s?(this._lostMessages.delete(i),s):[]},e.prototype.connect=function(i,s){if(s===void 0&&(s={}),this.disconnected){pt.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(Wn.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}var r=new sB.DataConnection(i,this,s);return this._addConnection(i,r),r},e.prototype.call=function(i,s,r){if(r===void 0&&(r={}),this.disconnected){pt.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(Wn.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!s){pt.default.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}var o=new tB.MediaConnection(i,this,Lb(Lb({},r),{_stream:s}));return this._addConnection(i,o),o},e.prototype._addConnection=function(i,s){pt.default.log("add connection ".concat(s.type,":").concat(s.connectionId," to peerId:").concat(i)),this._connections.has(i)||this._connections.set(i,[]),this._connections.get(i).push(s)},e.prototype._removeConnection=function(i){var s=this._connections.get(i.peer);if(s){var r=s.indexOf(i);r!==-1&&s.splice(r,1)}this._lostMessages.delete(i.connectionId)},e.prototype.getConnection=function(i,s){var r,o,a=this._connections.get(i);if(!a)return null;try{for(var l=Pb(a),c=l.next();!c.done;c=l.next()){var h=c.value;if(h.connectionId===s)return h}}catch(u){r={error:u}}finally{try{c&&!c.done&&(o=l.return)&&o.call(l)}finally{if(r)throw r.error}}return null},e.prototype._delayedAbort=function(i,s){var r=this;setTimeout(function(){r._abort(i,s)},0)},e.prototype._abort=function(i,s){pt.default.error("Aborting!"),this.emitError(i,s),this._lastServerId?this.disconnect():this.destroy()},e.prototype.emitError=function(i,s){pt.default.error("Error:",s);var r;typeof s=="string"?r=new Error(s):r=s,r.type=i,this.emit("error",r)},e.prototype.destroy=function(){this.destroyed||(pt.default.log("Destroy peer with ID:".concat(this.id)),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))},e.prototype._cleanup=function(){var i,s;try{for(var r=Pb(this._connections.keys()),o=r.next();!o.done;o=r.next()){var a=o.value;this._cleanupPeer(a),this._connections.delete(a)}}catch(l){i={error:l}}finally{try{o&&!o.done&&(s=r.return)&&s.call(r)}finally{if(i)throw i.error}}this.socket.removeAllListeners()},e.prototype._cleanupPeer=function(i){var s,r,o=this._connections.get(i);if(o)try{for(var a=Pb(o),l=a.next();!l.done;l=a.next()){var c=l.value;c.close()}}catch(h){s={error:h}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(s)throw s.error}}},e.prototype.disconnect=function(){if(!this.disconnected){var i=this.id;pt.default.log("Disconnect peer with ID:".concat(i)),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=i,this._id=null,this.emit("disconnected",i)}},e.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)pt.default.log("Attempting reconnection to server with ID ".concat(this._lastServerId)),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)pt.default.error("In a hurry? We're still trying to make the initial connection!");else throw new Error("Peer ".concat(this.id," cannot reconnect because it is not disconnected from the server!"))}},e.prototype.listAllPeers=function(i){var s=this;i===void 0&&(i=function(r){}),this._api.listAllPeers().then(function(r){return i(r)}).catch(function(r){return s._abort(Wn.ServerError,r)})},e.DEFAULT_KEY="peerjs",e}(Rb.EventEmitter),oB=wH.Peer;const epe=Object.freeze(Object.defineProperty({__proto__:null,get Peer(){return rB},default:oB,util:Mi},Symbol.toStringTag,{value:"Module"}));let aB;function tpe(){return aB}function ipe(n){aB=n}function GH(n,e){return e||(e={}),e={...aB,...e},n?new oB(n,e):new oB(e)}async function zH(){const n=await Promise.resolve().then(()=>epe);return console.log(n),n.default===void 0?n:n.default}class FH{constructor(){p(this,"_host"),p(this,"_client"),p(this,"_clientData"),this.onEnable()}get isHost(){return this._host!==void 0}onEnable(){const e="HOST-5980e65c-8438-453e-8b35-f13c736dcd81";this.trySetupHost(e)}async trySetupHost(e){const i=await zH(),s=new i(e);s.on("error",r=>{console.error(r),this._host=void 0,this.trySetupClient(e)}),s.on("open",r=>{this._host=new spe(s)})}async trySetupClient(e){const i=await zH();this._client=new i,this._client.on("error",s=>{console.error("Client error",s)}),this._client.on("open",s=>{console.log("client connected",s),this._clientData=this._client.connect(e,{metadata:{id:s}}),this._clientData.on("open",()=>{console.log("Connected to host")}),this._clientData.on("data",r=>{console.log("<<",r)})})}}class npe{constructor(e){p(this,"_peer"),this._peer=e}}class spe extends npe{constructor(e){var i;super(e),p(this,"_connections",[]),console.log("I AM THE HOST"),(i=this._peer)==null||i.on("connection",this.onConnection.bind(this)),this._peer.on("close",()=>{this.broadcast("BYE")}),setInterval(()=>{this.broadcast("HELLO")},2e3)}get isHost(){return!0}onConnection(e){console.log("host connection",e),e.on("open",()=>{this._connections.push(e),this.broadcastConnection(e)})}broadcastConnection(e){const i=this._connections.map(s=>{var r;return(r=s.metadata)==null?void 0:r.id}).filter(s=>s!==void 0);this.broadcast({type:"connection-list",connections:i})}broadcast(e){if(e!=null){console.log(">>",e);for(const i in this._peer.connections){const s=this._peer.connections[i];if(s)if(Array.isArray(s))for(const r of s)r&&r.send(e);else console.warn(s)}}}}var Pl=(n=>(n[n.OnConnection=0]="OnConnection",n[n.OnRoomJoin=1]="OnRoomJoin",n[n.Queued=2]="Queued",n[n.Immediate=3]="Immediate",n))(Pl||{});const NH="https://urls.needle.tools/default-networking-backend/index";let zh="wss://needle-tiny-starter.glitch.me/socket";const lo=!!te("debugnet"),Bb=!!(lo||te("debugowner")),lB=te("debugnetbin");var UH=(n=>(n.ConnectionInfo="connection-start-info",n))(UH||{}),Xt=(n=>(n.Join="join-room",n.Leave="leave-room",n.JoinedRoom="joined-room",n.LeftRoom="left-room",n.UserJoinedRoom="user-joined-room",n.UserLeftRoom="user-left-room",n.RoomStateSent="room-state-sent",n))(Xt||{});class rpe{constructor(){p(this,"room"),p(this,"viewId"),p(this,"allowEditing"),p(this,"inRoom")}}class ope{constructor(){p(this,"room")}}class ape{constructor(){p(this,"userId")}}var VH=(n=>(n.RequestHasOwner="request-has-owner",n.ResponseHasOwner="response-has-owner",n.RequestIsOwner="request-is-owner",n.ResponseIsOwner="response-is-owner",n.RequestOwnership="request-ownership",n.GainedOwnership="gained-ownership",n.RemoveOwnership="remove-ownership",n.LostOwnership="lost-ownership",n.GainedOwnershipBroadcast="gained-ownership-broadcast",n.LostOwnershipBroadcast="lost-ownership-broadcast",n))(VH||{});class cB{constructor(e,i){p(this,"guid"),p(this,"connection"),p(this,"_hasOwnership",!1),p(this,"_isOwned"),p(this,"_gainSubscription"),p(this,"_lostSubscription"),p(this,"_hasOwnerResponse"),p(this,"_isWaitingForOwnershipResponseCallback",null),this.connection=e,this.guid=i,this._gainSubscription=this.onGainedOwnership.bind(this),this._lostSubscription=this.onLostOwnership.bind(this),e.beginListen("lost-ownership",this._lostSubscription),e.beginListen("gained-ownership-broadcast",this._gainSubscription),this._hasOwnerResponse=this.onHasOwnerResponse.bind(this),e.beginListen("response-has-owner",this._hasOwnerResponse)}get hasOwnership(){return this._hasOwnership}get isOwned(){return this._isOwned}get isConnected(){return this.connection.isConnected}updateIsOwned(){this.connection.send("request-has-owner",{guid:this.guid})}onHasOwnerResponse(e){e.guid===this.guid&&(this._isOwned=e.value)}requestOwnershipIfNotOwned(){return this._isWaitingForOwnershipResponseCallback!==null?this:(this._isWaitingForOwnershipResponseCallback=this.waitForHasOwnershipRequestResponse.bind(this),this.connection.beginListen("response-has-owner",this._isWaitingForOwnershipResponseCallback),this.connection.send("request-has-owner",{guid:this.guid}),this)}waitForHasOwnershipRequestResponse(e){e.guid===this.guid&&(this._isWaitingForOwnershipResponseCallback&&(this.connection.stopListen("response-has-owner",this._isWaitingForOwnershipResponseCallback),this._isWaitingForOwnershipResponseCallback=null),this._isOwned=e.value,e.value||(Bb&&console.log("request ownership",this.guid),this.requestOwnership()))}requestOwnershipAsync(){return new Promise((e,i)=>{this.requestOwnership();let s=0;const r=()=>{if(s++>10)return i("Timeout");setTimeout(()=>{this.hasOwnership?e(this):r()},100)};r()})}requestOwnership(){return Bb&&console.log("Request ownership",this.guid),this.connection.send("request-ownership",{guid:this.guid}),this}freeOwnership(){return this.connection.send("remove-ownership",{guid:this.guid}),this._isWaitingForOwnershipResponseCallback&&(this.connection.stopListen("response-has-owner",this._isWaitingForOwnershipResponseCallback),this._isWaitingForOwnershipResponseCallback=null),this}destroy(){this.connection.stopListen("gained-ownership",this._gainSubscription),this.connection.stopListen("lost-ownership",this._lostSubscription),this.connection.stopListen("response-has-owner",this._hasOwnerResponse),this._isWaitingForOwnershipResponseCallback&&(this.connection.stopListen("response-has-owner",this._isWaitingForOwnershipResponseCallback),this._isWaitingForOwnershipResponseCallback=null)}onGainedOwnership(e){e.guid===this.guid&&(this._isOwned=!0,this.connection.connectionId===e.owner?(Bb&&console.log("GAINED OWNERSHIP",this.guid),this._hasOwnership=!0):this._hasOwnership=!1)}onLostOwnership(e){e===this.guid&&(Bb&&console.log("LOST OWNERSHIP",this.guid),this._hasOwnership=!1,this._isOwned=!1)}}class XH{constructor(e){p(this,"context"),p(this,"_peer",null),p(this,"_usersInRoomCopy",[]),p(this,"_defaultMessagesBuffer",[]),p(this,"_defaultMessagesBufferArray",[]),p(this,"netWebSocketUrlProvider"),p(this,"_listeners",{}),p(this,"_listenersBinary",{}),p(this,"connected",!1),p(this,"channelId"),p(this,"_connectionId",null),p(this,"_ws"),p(this,"_waitingForSocket",{}),p(this,"_isInRoom",!1),p(this,"_currentRoomName",null),p(this,"_currentRoomViewId",null),p(this,"_currentRoomAllowEditing",!0),p(this,"_currentInRoom",[]),p(this,"_state",{}),p(this,"_currentDelay",-1),p(this,"_connectingToWebsocketPromise",null),this.context=e}get peer(){return this._peer||(this._peer=new FH),this._peer}tryGetState(e){return e==="invalid"?null:this._state[e]}get connectionId(){return this._connectionId}get isDebugEnabled(){return lo}get isConnected(){return this.connected}get currentRoomName(){return this._currentRoomName}get allowEditing(){return this._currentRoomAllowEditing}get currentRoomViewId(){return this._currentRoomViewId}getViewOnlyUrl(){if(this.currentRoomViewId===null)return null;const e=new URL(window.location.href);return e.searchParams.set("view",this.currentRoomViewId),e.href}get isInRoom(){return this._isInRoom}get currentLatency(){return this._currentDelay}get currentServerUrl(){var e;return((e=this._ws)==null?void 0:e.url)??null}sendPing(){this.send("ping",{time:this.context.time.time})}userIsInRoom(e){return this._currentInRoom.indexOf(e)!==-1}usersInRoom(e=null){e||(e=this._usersInRoomCopy),e.length=0;for(const i of this._currentInRoom)e.push(i);return e}joinRoom(e,i=!1){return e?e.length>1024?(console.error('Room name too long, can not join: "'+e+'". Max length is 1024 characters.'),!1):(this.connect(),lo&&console.log("join: "+e),this.send("join-room",{room:e,viewOnly:i},Pl.OnConnection),!0):(console.error('Missing room name, can not join: "'+e+'"'),!1)}leaveRoom(e=null){return e||(e=this.currentRoomName),e?(this.send("leave-room",{room:e}),!0):(console.error('Missing room name, can not join: "'+e+'"'),!1)}send(e,i=null,s=Pl.Queued){if(i===null&&(i={}),s===Pl.Queued){this._defaultMessagesBuffer.push({key:e,value:i});return}return this.sendWithWebsocket(e,i,s)}sendDeleteRemoteState(e){this.send("delete-state",{guid:e,dontSave:!0}),delete this._state[e]}sendDeleteRemoteStateAll(){this.send("delete-all-state"),this._state={}}sendBinary(e){var i;lB&&console.log("<< send binary",this.context.time.frame,e.length/1024+" KB"),(i=this._ws)==null||i.send(e)}sendBufferedMessagesNow(){var e;if(!this._ws)return;this._defaultMessagesBufferArray.length=0;const i=Object.keys(this._defaultMessagesBuffer).length;for(const r in this._defaultMessagesBuffer){const o=this._defaultMessagesBuffer[r];if(i<=1){this.sendWithWebsocket(o.key,o.value,Pl.Immediate);break}const a=this.toMessage(o.key,o.value);this._defaultMessagesBufferArray.push(a)}if(this._defaultMessagesBuffer.length=0,this._defaultMessagesBufferArray.length>0&&lo&&console.log("SEND BUFFERED",this._defaultMessagesBufferArray.length),this._defaultMessagesBufferArray.length<=0)return;const s=JSON.stringify(this._defaultMessagesBufferArray);(e=this._ws)==null||e.send(s)}beginListen(e,i){return this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].push(i),i}stopListening(e,i){return this.stopListen(e,i)}stopListen(e,i){if(!i||!this._listeners[e])return;const s=this._listeners[e].indexOf(i);s>=0&&this._listeners[e].splice(s,1)}beginListenBinary(e,i){return this._listenersBinary[e]||(this._listenersBinary[e]=[]),this._listenersBinary[e].push(i),i}stopListenBinary(e,i){if(!this._listenersBinary[e])return;const s=this._listenersBinary[e].indexOf(i);s>=0&&this._listenersBinary[e].splice(s,1)}registerProvider(e){this.netWebSocketUrlProvider=e}async connect(){var e;if(this.connected)return Promise.resolve(!0);lo&&console.log("connecting");const i=(e=this.netWebSocketUrlProvider)==null?void 0:e.getWebsocketUrl();return i?zh=i:sU()&&(zh="wss://"+window.location.host+"/socket"),this.connectWebsocket()}disconnect(){var e;(e=this._ws)==null||e.close(),this._ws=void 0}connectWebsocket(){return this._connectingToWebsocketPromise?this._connectingToWebsocketPromise:this._connectingToWebsocketPromise=new Promise(async(e,i)=>{var s,r;let o=!1;const a=d=>{o||(o=!0,e(d))};if(zh===void 0&&(console.log("Fetch default backend url: "+NH),zh=await(await fetch(NH)).text()),zh===void 0){a(!1);return}console.debug(`\u22A1 Connecting to networking backend on
`+zh);const l=await Promise.resolve().then(()=>KSe),c=((s=l.default)==null?void 0:s.WebsocketBuilder)??l.WebsocketBuilder,h=((r=l.default)==null?void 0:r.ExponentialBackoff)??l.ExponentialBackoff,u=new c(zh).withMaxRetries(3).withBackoff(new h(2e3,2)).onOpen(()=>{this._connectingToWebsocketPromise=null,this._ws=u,this.connected=!0,Ye()||lo?console.log(`\u229E Connected to networking backend
`+zh):console.debug("\u229E Connected to networking backend",zh),a(!0),this.onSendQueued(Pl.OnConnection)}).onClose(d=>{this._connectingToWebsocketPromise=null,this.connected=!1,this._isInRoom=!1,a(!1)}).onError(d=>{console.error("\u22A0 Websocket error"),a(!1)}).onRetry(()=>{console.log("Retry connecting to networking websocket")}).build();u.addEventListener(l.WebsocketEvent.message,(d,m)=>{this.onMessage(d,m)})})}onMessage(e,i){const s=i.data;try{if(typeof s!="string"){s.size&&this.handleIncomingBinaryMessage(s);return}const r=JSON.parse(s);if(Array.isArray(r))for(const o of r)this.handleIncomingStringMessage(o);else this.handleIncomingStringMessage(r);return}catch(r){lo&&s==="pong"?console.log("<<",s):Ye()&&console.error("Failed to parse message",r)}}async handleIncomingBinaryMessage(e){lB&&console.log("<< bin",this.context.time.frame);const i=await e.arrayBuffer();var s=new Uint8Array(i);const r=new p1(s),o=r.getBufferIdentifier(),a=this._listenersBinary[o],l=_W(r),c=SW(l);if(c&&typeof c=="string"&&(this._state[c]=l),!a)return;const h=l??r;for(const u of a)u(h)}handleIncomingStringMessage(e){var i,s;if(lo&&console.log("<<",e.key??e),e.key)switch(e.key){case"connection-start-info":if(e.data){const l=e.data;l&&(console.assert(l.id!==void 0&&l.id!==null&&l.id.length>0,"server did not send connection id",l.id),console.debug("Your id is: "+l.id,this.context.alias??""),this._connectionId=l.id)}else console.warn("Expected connection id in "+e.key);break;case"joined-room":if(lo&&console.log(e),e){this._isInRoom=!0;const l=e;this._currentRoomName=l.room,this._currentRoomViewId=l.viewId,this._currentRoomAllowEditing=l.allowEditing??!0,this._currentInRoom.length=0,this._currentInRoom.push(...l.inRoom),(lB||Ye())&&console.debug("Joined Needle Engine Room: "+l.room);const c=new URL(window.location.href);c.searchParams.has("room")&&c.searchParams.delete("room"),c.searchParams.set("view",this._currentRoomViewId),console.debug(`Room view id: ${this._currentRoomViewId}
${c.href}`)}this.onSendQueued(Pl.OnRoomJoin);break;case"left-room":e.room===this.currentRoomName&&(this._isInRoom=!1,this._currentRoomName=null,this._currentInRoom.length=0);break;case"user-joined-room":if(e.data){const l=e.data;this._currentInRoom.push(l.userId),lo&&console.log(l.userId+" joined","now in room:",this._currentInRoom)}break;case"user-left-room":if(e.data){const l=e.data,c=this._currentInRoom.indexOf(l.userId);c>=0&&(lo&&console.log(l.userId+" left","now in room:",this._currentInRoom),this._currentInRoom.splice(c,1)),l.userId===this.connectionId&&console.log("you left the room")}break;case"all-room-state-deleted":lo&&console.log("RECEIVED all-room-state-deleted"),this._state={};break;case"ping":case"pong":const a=(i=e.data)==null?void 0:i.time;a&&(this._currentDelay=this.context.time.time-a),lo&&console.log("Current latency: "+this._currentDelay.toFixed(4)+" sec","Clients in room: "+((s=this._currentInRoom)==null?void 0:s.length));break}const r=e.data;r&&(this._state[r.guid]=r);let o=this._listeners[e.key];if(o){o=[...o];for(const a of o)try{a(e.data)}catch(l){console.error('Error invoking callback for "'+e.key+'"',l)}}}toMessage(e,i){return{key:e,data:i}}sendWithWebsocket(e,i,s=Pl.OnRoomJoin){if(!this._ws){const o=this._waitingForSocket[s]||[];o.push(()=>this.sendWithWebsocket(e,i,s)),this._waitingForSocket[s]=o;return}const r=JSON.stringify(this.toMessage(e,i));lo&&console.log(">>",e),this._ws.send(r)}onSendQueued(e){const i=this._waitingForSocket[e];if(i){for(const s of i)s();i.length=0}}}const kb=te("debugwebxr");class hB{constructor(e,i){p(this,"controllerStates",[]),p(this,"userId"),p(this,"context"),p(this,"userStateEvtName"),p(this,"onReceivedControllerState",s=>{kb&&console.log(`XRSync: Received change for ${this.userId}: ${s.type} ${s.handedness}; tracked=${s.isTracking}`);let r=!1;for(let o=0;o<this.controllerStates.length;o++)if(this.controllerStates[o].index===s.index){this.controllerStates[o]=s,r=!0;break}r||this.controllerStates.push(s)}),this.userId=e,this.context=i,this.userStateEvtName="xr-sync-user-state-"+e,this.context.connection.beginListen(this.userStateEvtName,this.onReceivedControllerState)}dispose(){this.context.connection.stopListen(this.userStateEvtName,this.onReceivedControllerState)}update(e){if(this.context.connection.isConnected!=!1){for(let i=this.controllerStates.length-1;i>=0;i--){const s=this.controllerStates[i];let r=!1;for(let o=0;o<e.controllers.length;o++)e.controllers[o].index===s.index&&(r=!0);r||(kb&&console.log(`XRSync: ${s.type} ${s.handedness} removed`,s.index),this.controllerStates.splice(i,1),this.sendControllerRemoved(s))}for(const i of e.controllers)this.updateControllerStates(i)}}onExitXR(e){for(const i of this.controllerStates)this.sendControllerRemoved(i);this.controllerStates.length=0}sendControllerRemoved(e){e.isTracking=!1,e.guid="",this.context.connection.send(this.userStateEvtName,e),this.context.connection.sendDeleteRemoteState(e.guid)}updateControllerStates(e){const i=this.controllerStates.find(s=>s.index===e.index);if(i){let s=!1;s||(s=i.isTracking!=e.isTracking),s&&(i.isTracking=e.isTracking,this.context.connection.send(this.userStateEvtName,i))}else{const s={guid:this.userId+"-"+e.index,isTracking:e.isTracking,handedness:e.side,index:e.index,type:e.hand?"hand":"controller"};this.controllerStates.push(s),this.context.connection.send(this.userStateEvtName,s),kb&&console.log(`XRSync: ${s.type} ${s.handedness} added`,s.index)}}}class WH{constructor(e){p(this,"context"),p(this,"onJoinedRoom",()=>{if(this.context.connection.connectionId){this._states.has(this.context.connection.connectionId)||(kb&&console.log("XRSync: Local user joined room",this.context.connection.connectionId),this._states.set(this.context.connection.connectionId,new hB(this.context.connection.connectionId,this.context)));for(const i of this.context.connection.usersInRoom())this._states.has(i)||this._states.set(i,new hB(i,this.context))}}),p(this,"onLeftRoom",()=>{if(this.context.connection.connectionId&&!this._states.has(this.context.connection.connectionId)){const i=this._states.get(this.context.connection.connectionId);i?.dispose(),this._states.delete(this.context.connection.connectionId)}}),p(this,"onOtherUserJoinedRoom",i=>{const s=i.userId;this._states.has(s)||(kb&&console.log("XRSync: Remote user joined room",s),this._states.set(s,new hB(s,this.context)))}),p(this,"onOtherUserLeftRoom",i=>{const s=i.userId;if(!this._states.has(s)){const r=this._states.get(s);r?.dispose(),this._states.delete(s)}}),p(this,"_states",new Map),this.context=e,this.context.connection.beginListen(Xt.JoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(Xt.LeftRoom,this.onLeftRoom),this.context.connection.beginListen(Xt.UserJoinedRoom,this.onOtherUserJoinedRoom),this.context.connection.beginListen(Xt.UserLeftRoom,this.onOtherUserLeftRoom)}hasState(e){return e?this._states.has(e):!1}isTracking(e,i){if(!e)return;const s=this._states.get(e);if(!s)return;const r=s.controllerStates.find(o=>o.handedness===i);return r?.isTracking||!1}getDeviceType(e,i){if(!e)return;const s=this._states.get(e);if(!s)return;const r=s.controllerStates.find(o=>o.handedness===i);return r?.type||"unknown"}destroy(){this.context.connection.stopListen(Xt.JoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(Xt.LeftRoom,this.onLeftRoom),this.context.connection.stopListen(Xt.UserJoinedRoom,this.onOtherUserJoinedRoom),this.context.connection.stopListen(Xt.UserLeftRoom,this.onOtherUserLeftRoom)}onUpdate(e){if(this.context.connection.isConnected&&this.context.connection.connectionId){const i=this._states.get(this.context.connection.connectionId);i?.update(e)}}onExitXR(e){if(this.context.connection.isConnected&&this.context.connection.connectionId){const i=this._states.get(this.context.connection.connectionId);i?.onExitXR(e)}}}class HH{constructor(){p(this,"_fadeToColorQuad"),p(this,"_fadeToColorMaterial"),p(this,"_requestedFadeValue",0),p(this,"_transitionPromise",null),p(this,"_transitionResolve",null),this._fadeToColorMaterial=new Qt({color:0,transparent:!0,depthTest:!1,fog:!1,side:xi}),this._fadeToColorQuad=new pe(new ds(10,10),this._fadeToColorMaterial)}dispose(){this._fadeToColorQuad.geometry.dispose(),this._fadeToColorMaterial.dispose()}update(e,i){const s=this._fadeToColorQuad,r=this._fadeToColorMaterial;s.parent!==e&&r.opacity>0?e.add(s):r.opacity===0&&s.removeFromParent(),s.layers.set(2),s.material=this._fadeToColorMaterial,s.position.z=-1,s.renderOrder=1/0;const o=this._requestedFadeValue;r.opacity=tt.lerp(r.opacity,o,i/.03),Math.abs(r.opacity-o)<=.01&&this._transitionResolve&&(this._transitionResolve(),this._transitionResolve=null,this._transitionPromise=null,this._requestedFadeValue=0)}remove(){this._fadeToColorQuad.removeFromParent()}fadeTransition(){if(this._transitionPromise)return this._transitionPromise;this._requestedFadeValue=1;const e=new Promise(i=>{this._transitionResolve=i});return this._transitionPromise=e,e}}class lpe extends Fy{constructor(e,i={}){const s=i.font;if(s===void 0)super();else{const r=s.generateShapes(e,i.size);i.depth=i.height!==void 0?i.height:50,i.bevelThickness===void 0&&(i.bevelThickness=10),i.bevelSize===void 0&&(i.bevelSize=8),i.bevelEnabled===void 0&&(i.bevelEnabled=!1),super(r,i)}this.type="TextGeometry"}}class cpe extends es{constructor(e){super(e)}load(e,i,s,r){const o=this,a=new qs(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){const c=o.parse(JSON.parse(l));i&&i(c)},s,r)}parse(e){return new jH(e)}}class jH{constructor(e){this.isFont=!0,this.type="Font",this.data=e}generateShapes(e,i=100){const s=[],r=hpe(e,i,this.data);for(let o=0,a=r.length;o<a;o++)s.push(...r[o].toShapes());return s}}function hpe(n,e,i){const s=Array.from(n),r=e/i.resolution,o=(i.boundingBox.yMax-i.boundingBox.yMin+i.underlineThickness)*r,a=[];let l=0,c=0;for(let h=0;h<s.length;h++){const u=s[h];if(u===`
`)l=0,c-=o;else{const d=upe(u,r,l,c,i);l+=d.offsetX,a.push(d.path)}}return a}function upe(n,e,i,s,r){const o=r.glyphs[n]||r.glyphs["?"];if(!o){console.error('THREE.Font: character "'+n+'" does not exists in font family '+r.familyName+".");return}const a=new tU;let l,c,h,u,d,m,f,g;if(o.o){const y=o._cachedOutline||(o._cachedOutline=o.o.split(" "));for(let v=0,b=y.length;v<b;)switch(y[v++]){case"m":l=y[v++]*e+i,c=y[v++]*e+s,a.moveTo(l,c);break;case"l":l=y[v++]*e+i,c=y[v++]*e+s,a.lineTo(l,c);break;case"q":h=y[v++]*e+i,u=y[v++]*e+s,d=y[v++]*e+i,m=y[v++]*e+s,a.quadraticCurveTo(d,m,h,u);break;case"b":h=y[v++]*e+i,u=y[v++]*e+s,d=y[v++]*e+i,m=y[v++]*e+s,f=y[v++]*e+i,g=y[v++]*e+s,a.bezierCurveTo(d,m,f,g,h,u);break}}return{offsetX:o.ha*e,path:a}}function dpe(n,e=1e-4){e=Math.max(e,Number.EPSILON);const i={},s=n.getIndex(),r=n.getAttribute("position"),o=s?s.count:r.count;let a=0;const l=Object.keys(n.attributes),c={},h={},u=[],d=["getX","getY","getZ","getW"],m=["setX","setY","setZ","setW"];for(let A=0,x=l.length;A<x;A++){const w=l[A],_=n.attributes[w];c[w]=new qe(new _.array.constructor(_.count*_.itemSize),_.itemSize,_.normalized);const S=n.morphAttributes[w];S&&(h[w]=new qe(new S.array.constructor(S.count*S.itemSize),S.itemSize,S.normalized))}const f=e*.5,g=Math.log10(1/e),y=Math.pow(10,g),v=f*y;for(let A=0;A<o;A++){const x=s?s.getX(A):A;let w="";for(let _=0,S=l.length;_<S;_++){const M=l[_],R=n.getAttribute(M),P=R.itemSize;for(let C=0;C<P;C++)w+=`${~~(R[d[C]](x)*y+v)},`}if(w in i)u.push(i[w]);else{for(let _=0,S=l.length;_<S;_++){const M=l[_],R=n.getAttribute(M),P=n.morphAttributes[M],C=R.itemSize,L=c[M],B=h[M];for(let z=0;z<C;z++){const D=d[z],W=m[z];if(L[W](a,R[D](x)),P)for(let O=0,F=P.length;O<F;O++)B[O][W](a,P[O][D](x))}}i[w]=a,u.push(a),a++}}const b=n.clone();for(const A in n.attributes){const x=c[A];if(b.setAttribute(A,new qe(x.array.slice(0,a*x.itemSize),x.itemSize,x.normalized)),A in h)for(let w=0;w<h[A].length;w++){const _=h[A][w];b.morphAttributes[A][w]=new qe(_.array.slice(0,a*_.itemSize),_.itemSize,_.normalized)}}return b.setIndex(u),b}function QH(n,e){if(e===lz)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),n;if(e===N1||e===TR){let i=n.getIndex();if(i===null){const a=[],l=n.getAttribute("position");if(l!==void 0){for(let c=0;c<l.count;c++)a.push(c);n.setIndex(a),i=n.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}const s=i.count-2,r=[];if(e===N1)for(let a=1;a<=s;a++)r.push(i.getX(0)),r.push(i.getX(a)),r.push(i.getX(a+1));else for(let a=0;a<s;a++)a%2===0?(r.push(i.getX(a)),r.push(i.getX(a+1)),r.push(i.getX(a+2))):(r.push(i.getX(a+2)),r.push(i.getX(a+1)),r.push(i.getX(a)));r.length/3!==s&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=n.clone();return o.setIndex(r),o.clearGroups(),o}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),n}class Fh extends es{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(i){return new ype(i)}),this.register(function(i){return new Mpe(i)}),this.register(function(i){return new Epe(i)}),this.register(function(i){return new Tpe(i)}),this.register(function(i){return new bpe(i)}),this.register(function(i){return new Ape(i)}),this.register(function(i){return new xpe(i)}),this.register(function(i){return new wpe(i)}),this.register(function(i){return new gpe(i)}),this.register(function(i){return new _pe(i)}),this.register(function(i){return new vpe(i)}),this.register(function(i){return new Cpe(i)}),this.register(function(i){return new Spe(i)}),this.register(function(i){return new mpe(i)}),this.register(function(i){return new Rpe(i)}),this.register(function(i){return new Ipe(i)})}load(e,i,s,r){const o=this;let a;if(this.resourcePath!=="")a=this.resourcePath;else if(this.path!==""){const h=Ah.extractUrlBase(e);a=Ah.resolveURL(h,this.path)}else a=Ah.extractUrlBase(e);this.manager.itemStart(e);const l=function(h){r?r(h):console.error(h),o.manager.itemError(e),o.manager.itemEnd(e)},c=new qs(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,function(h){try{o.parse(h,a,function(u){i(u),o.manager.itemEnd(e)},l)}catch(u){l(u)}},s,l)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,i,s,r){let o;const a={},l={},c=new TextDecoder;if(typeof e=="string")o=JSON.parse(e);else if(e instanceof ArrayBuffer)if(c.decode(new Uint8Array(e,0,4))===ZH){try{a[fi.KHR_BINARY_GLTF]=new Lpe(e)}catch(u){r&&r(u);return}o=JSON.parse(a[fi.KHR_BINARY_GLTF].content)}else o=JSON.parse(c.decode(e));else o=e;if(o.asset===void 0||o.asset.version[0]<2){r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const h=new Wpe(o,{path:i||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});h.fileLoader.setRequestHeader(this.requestHeader);for(let u=0;u<this.pluginCallbacks.length;u++){const d=this.pluginCallbacks[u](h);d.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),l[d.name]=d,a[d.name]=!0}if(o.extensionsUsed)for(let u=0;u<o.extensionsUsed.length;++u){const d=o.extensionsUsed[u],m=o.extensionsRequired||[];switch(d){case fi.KHR_MATERIALS_UNLIT:a[d]=new fpe;break;case fi.KHR_DRACO_MESH_COMPRESSION:a[d]=new Ppe(o,this.dracoLoader);break;case fi.KHR_TEXTURE_TRANSFORM:a[d]=new Bpe;break;case fi.KHR_MESH_QUANTIZATION:a[d]=new kpe;break;default:m.indexOf(d)>=0&&l[d]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}h.setExtensions(a),h.setPlugins(l),h.parse(s,r)}parseAsync(e,i){const s=this;return new Promise(function(r,o){s.parse(e,i,r,o)})}}function ppe(){let n={};return{get:function(e){return n[e]},add:function(e,i){n[e]=i},remove:function(e){delete n[e]},removeAll:function(){n={}}}}const fi={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class mpe{constructor(e){this.parser=e,this.name=fi.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,i=this.parser.json.nodes||[];for(let s=0,r=i.length;s<r;s++){const o=i[s];o.extensions&&o.extensions[this.name]&&o.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,o.extensions[this.name].light)}}_loadLight(e){const i=this.parser,s="light:"+e;let r=i.cache.get(s);if(r)return r;const o=i.json,a=((o.extensions&&o.extensions[this.name]||{}).lights||[])[e];let l;const c=new Ae(16777215);a.color!==void 0&&c.setRGB(a.color[0],a.color[1],a.color[2],Bi);const h=a.range!==void 0?a.range:0;switch(a.type){case"directional":l=new Hp(c),l.target.position.set(0,0,-1),l.add(l.target);break;case"point":l=new Wp(c),l.distance=h;break;case"spot":l=new Pv(c),l.distance=h,a.spot=a.spot||{},a.spot.innerConeAngle=a.spot.innerConeAngle!==void 0?a.spot.innerConeAngle:0,a.spot.outerConeAngle=a.spot.outerConeAngle!==void 0?a.spot.outerConeAngle:Math.PI/4,l.angle=a.spot.outerConeAngle,l.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,l.target.position.set(0,0,-1),l.add(l.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}return l.position.set(0,0,0),l.decay=2,ud(l,a),a.intensity!==void 0&&(l.intensity=a.intensity),l.name=i.createUniqueName(a.name||"light_"+e),r=Promise.resolve(l),i.cache.add(s,r),r}getDependency(e,i){if(e==="light")return this._loadLight(i)}createNodeAttachment(e){const i=this,s=this.parser,r=s.json.nodes[e],o=(r.extensions&&r.extensions[this.name]||{}).light;return o===void 0?null:this._loadLight(o).then(function(a){return s._getNodeRef(i.cache,o,a)})}}let fpe=class{constructor(){this.name=fi.KHR_MATERIALS_UNLIT}getMaterialType(){return Qt}extendParams(n,e,i){const s=[];n.color=new Ae(1,1,1),n.opacity=1;const r=e.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const o=r.baseColorFactor;n.color.setRGB(o[0],o[1],o[2],Bi),n.opacity=o[3]}r.baseColorTexture!==void 0&&s.push(i.assignTexture(n,"map",r.baseColorTexture,vt))}return Promise.all(s)}},gpe=class{constructor(n){this.parser=n,this.name=fi.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(n,e){const i=this.parser.json.materials[n];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name].emissiveStrength;return s!==void 0&&(e.emissiveIntensity=s),Promise.resolve()}},ype=class{constructor(n){this.parser=n,this.name=fi.KHR_MATERIALS_CLEARCOAT}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:Ro}extendMaterialParams(n,e){const i=this.parser,s=i.json.materials[n];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];if(o.clearcoatFactor!==void 0&&(e.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&r.push(i.assignTexture(e,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(e.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&r.push(i.assignTexture(e,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(r.push(i.assignTexture(e,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const a=o.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new Y(a,a)}return Promise.all(r)}},vpe=class{constructor(n){this.parser=n,this.name=fi.KHR_MATERIALS_IRIDESCENCE}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:Ro}extendMaterialParams(n,e){const i=this.parser,s=i.json.materials[n];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.iridescenceFactor!==void 0&&(e.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&r.push(i.assignTexture(e,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(e.iridescenceIOR=o.iridescenceIor),e.iridescenceThicknessRange===void 0&&(e.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(e.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(e.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&r.push(i.assignTexture(e,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(r)}},bpe=class{constructor(n){this.parser=n,this.name=fi.KHR_MATERIALS_SHEEN}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:Ro}extendMaterialParams(n,e){const i=this.parser,s=i.json.materials[n];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[];e.sheenColor=new Ae(0,0,0),e.sheenRoughness=0,e.sheen=1;const o=s.extensions[this.name];if(o.sheenColorFactor!==void 0){const a=o.sheenColorFactor;e.sheenColor.setRGB(a[0],a[1],a[2],Bi)}return o.sheenRoughnessFactor!==void 0&&(e.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&r.push(i.assignTexture(e,"sheenColorMap",o.sheenColorTexture,vt)),o.sheenRoughnessTexture!==void 0&&r.push(i.assignTexture(e,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(r)}},Ape=class{constructor(n){this.parser=n,this.name=fi.KHR_MATERIALS_TRANSMISSION}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:Ro}extendMaterialParams(n,e){const i=this.parser,s=i.json.materials[n];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.transmissionFactor!==void 0&&(e.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&r.push(i.assignTexture(e,"transmissionMap",o.transmissionTexture)),Promise.all(r)}},xpe=class{constructor(n){this.parser=n,this.name=fi.KHR_MATERIALS_VOLUME}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:Ro}extendMaterialParams(n,e){const i=this.parser,s=i.json.materials[n];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];e.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&r.push(i.assignTexture(e,"thicknessMap",o.thicknessTexture)),e.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return e.attenuationColor=new Ae().setRGB(a[0],a[1],a[2],Bi),Promise.all(r)}},wpe=class{constructor(n){this.parser=n,this.name=fi.KHR_MATERIALS_IOR}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:Ro}extendMaterialParams(n,e){const i=this.parser.json.materials[n];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name];return e.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}},_pe=class{constructor(n){this.parser=n,this.name=fi.KHR_MATERIALS_SPECULAR}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:Ro}extendMaterialParams(n,e){const i=this.parser,s=i.json.materials[n];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];e.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&r.push(i.assignTexture(e,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return e.specularColor=new Ae().setRGB(a[0],a[1],a[2],Bi),o.specularColorTexture!==void 0&&r.push(i.assignTexture(e,"specularColorMap",o.specularColorTexture,vt)),Promise.all(r)}},Spe=class{constructor(n){this.parser=n,this.name=fi.EXT_MATERIALS_BUMP}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:Ro}extendMaterialParams(n,e){const i=this.parser,s=i.json.materials[n];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return e.bumpScale=o.bumpFactor!==void 0?o.bumpFactor:1,o.bumpTexture!==void 0&&r.push(i.assignTexture(e,"bumpMap",o.bumpTexture)),Promise.all(r)}},Cpe=class{constructor(n){this.parser=n,this.name=fi.KHR_MATERIALS_ANISOTROPY}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:Ro}extendMaterialParams(n,e){const i=this.parser,s=i.json.materials[n];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.anisotropyStrength!==void 0&&(e.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(e.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&r.push(i.assignTexture(e,"anisotropyMap",o.anisotropyTexture)),Promise.all(r)}};class Mpe{constructor(e){this.parser=e,this.name=fi.KHR_TEXTURE_BASISU}loadTexture(e){const i=this.parser,s=i.json,r=s.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const o=r.extensions[this.name],a=i.options.ktx2Loader;if(!a){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return i.loadTextureImage(e,o.source,a)}}class Epe{constructor(e){this.parser=e,this.name=fi.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const i=this.name,s=this.parser,r=s.json,o=r.textures[e];if(!o.extensions||!o.extensions[i])return null;const a=o.extensions[i],l=r.images[a.source];let c=s.textureLoader;if(l.uri){const h=s.options.manager.getHandler(l.uri);h!==null&&(c=h)}return this.detectSupport().then(function(h){if(h)return s.loadTextureImage(e,a.source,c);if(r.extensionsRequired&&r.extensionsRequired.indexOf(i)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const i=new Image;i.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",i.onload=i.onerror=function(){e(i.height===1)}})),this.isSupported}}class Tpe{constructor(e){this.parser=e,this.name=fi.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const i=this.name,s=this.parser,r=s.json,o=r.textures[e];if(!o.extensions||!o.extensions[i])return null;const a=o.extensions[i],l=r.images[a.source];let c=s.textureLoader;if(l.uri){const h=s.options.manager.getHandler(l.uri);h!==null&&(c=h)}return this.detectSupport().then(function(h){if(h)return s.loadTextureImage(e,a.source,c);if(r.extensionsRequired&&r.extensionsRequired.indexOf(i)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const i=new Image;i.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",i.onload=i.onerror=function(){e(i.height===1)}})),this.isSupported}}class Rpe{constructor(e){this.name=fi.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const i=this.parser.json,s=i.bufferViews[e];if(s.extensions&&s.extensions[this.name]){const r=s.extensions[this.name],o=this.parser.getDependency("buffer",r.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return o.then(function(l){const c=r.byteOffset||0,h=r.byteLength||0,u=r.count,d=r.byteStride,m=new Uint8Array(l,c,h);return a.decodeGltfBufferAsync?a.decodeGltfBufferAsync(u,d,m,r.mode,r.filter).then(function(f){return f.buffer}):a.ready.then(function(){const f=new ArrayBuffer(u*d);return a.decodeGltfBuffer(new Uint8Array(f),u,d,m,r.mode,r.filter),f})})}else return null}}let Ipe=class{constructor(n){this.name=fi.EXT_MESH_GPU_INSTANCING,this.parser=n}createNodeMesh(n){const e=this.parser.json,i=e.nodes[n];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const s=e.meshes[i.mesh];for(const l of s.primitives)if(l.mode!==Va.TRIANGLES&&l.mode!==Va.TRIANGLE_STRIP&&l.mode!==Va.TRIANGLE_FAN&&l.mode!==void 0)return null;const r=i.extensions[this.name].attributes,o=[],a={};for(const l in r)o.push(this.parser.getDependency("accessor",r[l]).then(c=>(a[l]=c,a[l])));return o.length<1?null:(o.push(this.parser.createNodeMesh(n)),Promise.all(o).then(l=>{const c=l.pop(),h=c.isGroup?c.children:[c],u=l[0].count,d=[];for(const m of h){const f=new he,g=new E,y=new Se,v=new E(1,1,1),b=new x2(m.geometry,m.material,u);for(let A=0;A<u;A++)a.TRANSLATION&&g.fromBufferAttribute(a.TRANSLATION,A),a.ROTATION&&y.fromBufferAttribute(a.ROTATION,A),a.SCALE&&v.fromBufferAttribute(a.SCALE,A),b.setMatrixAt(A,f.compose(g,y,v));for(const A in a)if(A==="_COLOR_0"){const x=a[A];b.instanceColor=new To(x.array,x.itemSize,x.normalized)}else A!=="TRANSLATION"&&A!=="ROTATION"&&A!=="SCALE"&&m.geometry.setAttribute(A,a[A]);ye.prototype.copy.call(b,m),this.parser.assignFinalMaterial(b),d.push(b)}return c.isGroup?(c.clear(),c.add(...d),c):d[0]}))}};const ZH="glTF",Db=12,YH={JSON:1313821514,BIN:5130562};class Lpe{constructor(e){this.name=fi.KHR_BINARY_GLTF,this.content=null,this.body=null;const i=new DataView(e,0,Db),s=new TextDecoder;if(this.header={magic:s.decode(new Uint8Array(e.slice(0,4))),version:i.getUint32(4,!0),length:i.getUint32(8,!0)},this.header.magic!==ZH)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-Db,o=new DataView(e,Db);let a=0;for(;a<r;){const l=o.getUint32(a,!0);a+=4;const c=o.getUint32(a,!0);if(a+=4,c===YH.JSON){const h=new Uint8Array(e,Db+a,l);this.content=s.decode(h)}else if(c===YH.BIN){const h=Db+a;this.body=e.slice(h,h+l)}a+=l}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Ppe{constructor(e,i){if(!i)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=fi.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=i,this.dracoLoader.preload()}decodePrimitive(e,i){const s=this.json,r=this.dracoLoader,o=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,l={},c={},h={};for(const u in a){const d=dB[u]||u.toLowerCase();l[d]=a[u]}for(const u in e.attributes){const d=dB[u]||u.toLowerCase();if(a[u]!==void 0){const m=s.accessors[e.attributes[u]],f=n0[m.componentType];h[d]=f.name,c[d]=m.normalized===!0}}return i.getDependency("bufferView",o).then(function(u){return new Promise(function(d,m){r.decodeDracoFile(u,function(f){for(const g in f.attributes){const y=f.attributes[g],v=c[g];v!==void 0&&(y.normalized=v)}d(f)},l,h,Bi,m)})})}}class Bpe{constructor(){this.name=fi.KHR_TEXTURE_TRANSFORM}extendTexture(e,i){return(i.texCoord===void 0||i.texCoord===e.channel)&&i.offset===void 0&&i.rotation===void 0&&i.scale===void 0||(e=e.clone(),i.texCoord!==void 0&&(e.channel=i.texCoord),i.offset!==void 0&&e.offset.fromArray(i.offset),i.rotation!==void 0&&(e.rotation=i.rotation),i.scale!==void 0&&e.repeat.fromArray(i.scale),e.needsUpdate=!0),e}}class kpe{constructor(){this.name=fi.KHR_MESH_QUANTIZATION}}class KH extends pg{constructor(e,i,s,r){super(e,i,s,r)}copySampleValue_(e){const i=this.resultBuffer,s=this.sampleValues,r=this.valueSize,o=e*r*3+r;for(let a=0;a!==r;a++)i[a]=s[o+a];return i}interpolate_(e,i,s,r){const o=this.resultBuffer,a=this.sampleValues,l=this.valueSize,c=l*2,h=l*3,u=r-i,d=(s-i)/u,m=d*d,f=m*d,g=e*h,y=g-h,v=-2*f+3*m,b=f-m,A=1-v,x=b-m+d;for(let w=0;w!==l;w++){const _=a[y+w+l],S=a[y+w+c]*u,M=a[g+w+l],R=a[g+w]*u;o[w]=A*_+x*S+v*M+b*R}return o}}const Dpe=new Se;class Ope extends KH{interpolate_(e,i,s,r){const o=super.interpolate_(e,i,s,r);return Dpe.fromArray(o).normalize().toArray(o),o}}const Va={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},n0={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},JH={9728:Dt,9729:Ot,9984:Pf,9985:wp,9986:ah,9987:So},qH={33071:qn,33648:oh,10497:_o},uB={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},dB={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},hd={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Gpe={CUBICSPLINE:void 0,LINEAR:ec,STEP:Mu},pB={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function zpe(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new vs({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Un})),n.DefaultMaterial}function vm(n,e,i){for(const s in i.extensions)n[s]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[s]=i.extensions[s])}function ud(n,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(n.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Fpe(n,e,i){let s=!1,r=!1,o=!1;for(let h=0,u=e.length;h<u;h++){const d=e[h];if(d.POSITION!==void 0&&(s=!0),d.NORMAL!==void 0&&(r=!0),d.COLOR_0!==void 0&&(o=!0),s&&r&&o)break}if(!s&&!r&&!o)return Promise.resolve(n);const a=[],l=[],c=[];for(let h=0,u=e.length;h<u;h++){const d=e[h];if(s){const m=d.POSITION!==void 0?i.getDependency("accessor",d.POSITION):n.attributes.position;a.push(m)}if(r){const m=d.NORMAL!==void 0?i.getDependency("accessor",d.NORMAL):n.attributes.normal;l.push(m)}if(o){const m=d.COLOR_0!==void 0?i.getDependency("accessor",d.COLOR_0):n.attributes.color;c.push(m)}}return Promise.all([Promise.all(a),Promise.all(l),Promise.all(c)]).then(function(h){const u=h[0],d=h[1],m=h[2];return s&&(n.morphAttributes.position=u),r&&(n.morphAttributes.normal=d),o&&(n.morphAttributes.color=m),n.morphTargetsRelative=!0,n})}function Npe(n,e){if(n.updateMorphTargets(),e.weights!==void 0)for(let i=0,s=e.weights.length;i<s;i++)n.morphTargetInfluences[i]=e.weights[i];if(e.extras&&Array.isArray(e.extras.targetNames)){const i=e.extras.targetNames;if(n.morphTargetInfluences.length===i.length){n.morphTargetDictionary={};for(let s=0,r=i.length;s<r;s++)n.morphTargetDictionary[i[s]]=s}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Upe(n){let e;const i=n.extensions&&n.extensions[fi.KHR_DRACO_MESH_COMPRESSION];if(i?e="draco:"+i.bufferView+":"+i.indices+":"+mB(i.attributes):e=n.indices+":"+mB(n.attributes)+":"+n.mode,n.targets!==void 0)for(let s=0,r=n.targets.length;s<r;s++)e+=":"+mB(n.targets[s]);return e}function mB(n){let e="";const i=Object.keys(n).sort();for(let s=0,r=i.length;s<r;s++)e+=i[s]+":"+n[i[s]]+";";return e}function fB(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Vpe(n){return n.search(/\.jpe?g($|\?)/i)>0||n.search(/^data\:image\/jpeg/)===0?"image/jpeg":n.search(/\.webp($|\?)/i)>0||n.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const Xpe=new he;class Wpe{constructor(e={},i={}){this.json=e,this.extensions={},this.plugins={},this.options=i,this.cache=new ppe,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let s=!1,r=!1,o=-1;typeof navigator<"u"&&(s=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,r=navigator.userAgent.indexOf("Firefox")>-1,o=r?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||s||r&&o<98?this.textureLoader=new sc(this.options.manager):this.textureLoader=new PN(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new qs(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,i){const s=this,r=this.json,o=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(a){return a._markDefs&&a._markDefs()}),Promise.all(this._invokeAll(function(a){return a.beforeRoot&&a.beforeRoot()})).then(function(){return Promise.all([s.getDependencies("scene"),s.getDependencies("animation"),s.getDependencies("camera")])}).then(function(a){const l={scene:a[0][r.scene||0],scenes:a[0],animations:a[1],cameras:a[2],asset:r.asset,parser:s,userData:{}};return vm(o,l,r),ud(l,r),Promise.all(s._invokeAll(function(c){return c.afterRoot&&c.afterRoot(l)})).then(function(){e(l)})}).catch(i)}_markDefs(){const e=this.json.nodes||[],i=this.json.skins||[],s=this.json.meshes||[];for(let r=0,o=i.length;r<o;r++){const a=i[r].joints;for(let l=0,c=a.length;l<c;l++)e[a[l]].isBone=!0}for(let r=0,o=e.length;r<o;r++){const a=e[r];a.mesh!==void 0&&(this._addNodeRef(this.meshCache,a.mesh),a.skin!==void 0&&(s[a.mesh].isSkinnedMesh=!0)),a.camera!==void 0&&this._addNodeRef(this.cameraCache,a.camera)}}_addNodeRef(e,i){i!==void 0&&(e.refs[i]===void 0&&(e.refs[i]=e.uses[i]=0),e.refs[i]++)}_getNodeRef(e,i,s){if(e.refs[i]<=1)return s;const r=s.clone(),o=(a,l)=>{const c=this.associations.get(a);c!=null&&this.associations.set(l,c);for(const[h,u]of a.children.entries())o(u,l.children[h])};return o(s,r),r.name+="_instance_"+e.uses[i]++,r}_invokeOne(e){const i=Object.values(this.plugins);i.push(this);for(let s=0;s<i.length;s++){const r=e(i[s]);if(r)return r}return null}_invokeAll(e){const i=Object.values(this.plugins);i.unshift(this);const s=[];for(let r=0;r<i.length;r++){const o=e(i[r]);o&&s.push(o)}return s}getDependency(e,i){const s=e+":"+i;let r=this.cache.get(s);if(!r){switch(e){case"scene":r=this.loadScene(i);break;case"node":r=this._invokeOne(function(o){return o.loadNode&&o.loadNode(i)});break;case"mesh":r=this._invokeOne(function(o){return o.loadMesh&&o.loadMesh(i)});break;case"accessor":r=this.loadAccessor(i);break;case"bufferView":r=this._invokeOne(function(o){return o.loadBufferView&&o.loadBufferView(i)});break;case"buffer":r=this.loadBuffer(i);break;case"material":r=this._invokeOne(function(o){return o.loadMaterial&&o.loadMaterial(i)});break;case"texture":r=this._invokeOne(function(o){return o.loadTexture&&o.loadTexture(i)});break;case"skin":r=this.loadSkin(i);break;case"animation":r=this._invokeOne(function(o){return o.loadAnimation&&o.loadAnimation(i)});break;case"camera":r=this.loadCamera(i);break;default:if(r=this._invokeOne(function(o){return o!=this&&o.getDependency&&o.getDependency(e,i)}),!r)throw new Error("Unknown type: "+e);break}this.cache.add(s,r)}return r}getDependencies(e){let i=this.cache.get(e);if(!i){const s=this,r=this.json[e+(e==="mesh"?"es":"s")]||[];i=Promise.all(r.map(function(o,a){return s.getDependency(e,a)})),this.cache.add(e,i)}return i}loadBuffer(e){const i=this.json.buffers[e],s=this.fileLoader;if(i.type&&i.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+i.type+" buffer type is not supported.");if(i.uri===void 0&&e===0)return Promise.resolve(this.extensions[fi.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(o,a){s.load(Ah.resolveURL(i.uri,r.path),o,void 0,function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+i.uri+'".'))})})}loadBufferView(e){const i=this.json.bufferViews[e];return this.getDependency("buffer",i.buffer).then(function(s){const r=i.byteLength||0,o=i.byteOffset||0;return s.slice(o,o+r)})}loadAccessor(e){const i=this,s=this.json,r=this.json.accessors[e];if(r.bufferView===void 0&&r.sparse===void 0){const a=uB[r.type],l=n0[r.componentType],c=r.normalized===!0,h=new l(r.count*a);return Promise.resolve(new qe(h,a,c))}const o=[];return r.bufferView!==void 0?o.push(this.getDependency("bufferView",r.bufferView)):o.push(null),r.sparse!==void 0&&(o.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(o).then(function(a){const l=a[0],c=uB[r.type],h=n0[r.componentType],u=h.BYTES_PER_ELEMENT,d=u*c,m=r.byteOffset||0,f=r.bufferView!==void 0?s.bufferViews[r.bufferView].byteStride:void 0,g=r.normalized===!0;let y,v;if(f&&f!==d){const b=Math.floor(m/f),A="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+b+":"+r.count;let x=i.cache.get(A);x||(y=new h(l,b*f,r.count*f/u),x=new yv(y,f/u),i.cache.add(A,x)),v=new Ho(x,c,m%f/u,g)}else l===null?y=new h(r.count*c):y=new h(l,m,r.count*c),v=new qe(y,c,g);if(r.sparse!==void 0){const b=uB.SCALAR,A=n0[r.sparse.indices.componentType],x=r.sparse.indices.byteOffset||0,w=r.sparse.values.byteOffset||0,_=new A(a[1],x,r.sparse.count*b),S=new h(a[2],w,r.sparse.count*c);l!==null&&(v=new qe(v.array.slice(),v.itemSize,v.normalized));for(let M=0,R=_.length;M<R;M++){const P=_[M];if(v.setX(P,S[M*c]),c>=2&&v.setY(P,S[M*c+1]),c>=3&&v.setZ(P,S[M*c+2]),c>=4&&v.setW(P,S[M*c+3]),c>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return v})}loadTexture(e){const i=this.json,s=this.options,r=i.textures[e].source,o=i.images[r];let a=this.textureLoader;if(o.uri){const l=s.manager.getHandler(o.uri);l!==null&&(a=l)}return this.loadTextureImage(e,r,a)}loadTextureImage(e,i,s){const r=this,o=this.json,a=o.textures[e],l=o.images[i],c=(l.uri||l.bufferView)+":"+a.sampler;if(this.textureCache[c])return this.textureCache[c];const h=this.loadImageSource(i,s).then(function(u){u.flipY=!1,u.name=a.name||l.name||"",u.name===""&&typeof l.uri=="string"&&l.uri.startsWith("data:image/")===!1&&(u.name=l.uri);const d=(o.samplers||{})[a.sampler]||{};return u.magFilter=JH[d.magFilter]||Ot,u.minFilter=JH[d.minFilter]||So,u.wrapS=qH[d.wrapS]||_o,u.wrapT=qH[d.wrapT]||_o,u.anisotropy=4,r.associations.set(u,{textures:e}),u}).catch(function(){return null});return this.textureCache[c]=h,h}loadImageSource(e,i){const s=this,r=this.json,o=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(d=>d.clone());const a=r.images[e],l=self.URL||self.webkitURL;let c=a.uri||"",h=!1;if(a.bufferView!==void 0)c=s.getDependency("bufferView",a.bufferView).then(function(d){h=!0;const m=new Blob([d],{type:a.mimeType});return c=l.createObjectURL(m),c});else if(a.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const u=Promise.resolve(c).then(function(d){return new Promise(function(m,f){let g=m;i.isImageBitmapLoader===!0&&(g=function(y){const v=new Vt(y);v.needsUpdate=!0,m(v)}),i.load(Ah.resolveURL(d,o.path),g,void 0,f)})}).then(function(d){return h===!0&&l.revokeObjectURL(c),d.userData.mimeType=a.mimeType||Vpe(a.uri),d}).catch(function(d){throw console.error("THREE.GLTFLoader: Couldn't load texture",c),d});return this.sourceCache[e]=u,u}assignTexture(e,i,s,r){const o=this;return this.getDependency("texture",s.index).then(function(a){if(!a)return null;if(s.texCoord!==void 0&&s.texCoord>0&&(a=a.clone(),a.channel=s.texCoord),o.extensions[fi.KHR_TEXTURE_TRANSFORM]){const l=s.extensions!==void 0?s.extensions[fi.KHR_TEXTURE_TRANSFORM]:void 0;if(l){const c=o.associations.get(a);a=o.extensions[fi.KHR_TEXTURE_TRANSFORM].extendTexture(a,l),o.associations.set(a,c)}}return r!==void 0&&(a.colorSpace=r),e[i]=a,a})}assignFinalMaterial(e){const i=e.geometry;let s=e.material;const r=i.attributes.tangent===void 0,o=i.attributes.color!==void 0,a=i.attributes.normal===void 0;if(e.isPoints){const l="PointsMaterial:"+s.uuid;let c=this.cache.get(l);c||(c=new Ou,Ft.prototype.copy.call(c,s),c.color.copy(s.color),c.map=s.map,c.sizeAttenuation=!1,this.cache.add(l,c)),s=c}else if(e.isLine){const l="LineBasicMaterial:"+s.uuid;let c=this.cache.get(l);c||(c=new Vi,Ft.prototype.copy.call(c,s),c.color.copy(s.color),c.map=s.map,this.cache.add(l,c)),s=c}if(r||o||a){let l="ClonedMaterial:"+s.uuid+":";r&&(l+="derivative-tangents:"),o&&(l+="vertex-colors:"),a&&(l+="flat-shading:");let c=this.cache.get(l);c||(c=s.clone(),o&&(c.vertexColors=!0),a&&(c.flatShading=!0),r&&(c.normalScale&&(c.normalScale.y*=-1),c.clearcoatNormalScale&&(c.clearcoatNormalScale.y*=-1)),this.cache.add(l,c),this.associations.set(c,this.associations.get(s))),s=c}e.material=s}getMaterialType(){return vs}loadMaterial(e){const i=this,s=this.json,r=this.extensions,o=s.materials[e];let a;const l={},c=o.extensions||{},h=[];if(c[fi.KHR_MATERIALS_UNLIT]){const d=r[fi.KHR_MATERIALS_UNLIT];a=d.getMaterialType(),h.push(d.extendParams(l,o,i))}else{const d=o.pbrMetallicRoughness||{};if(l.color=new Ae(1,1,1),l.opacity=1,Array.isArray(d.baseColorFactor)){const m=d.baseColorFactor;l.color.setRGB(m[0],m[1],m[2],Bi),l.opacity=m[3]}d.baseColorTexture!==void 0&&h.push(i.assignTexture(l,"map",d.baseColorTexture,vt)),l.metalness=d.metallicFactor!==void 0?d.metallicFactor:1,l.roughness=d.roughnessFactor!==void 0?d.roughnessFactor:1,d.metallicRoughnessTexture!==void 0&&(h.push(i.assignTexture(l,"metalnessMap",d.metallicRoughnessTexture)),h.push(i.assignTexture(l,"roughnessMap",d.metallicRoughnessTexture))),a=this._invokeOne(function(m){return m.getMaterialType&&m.getMaterialType(e)}),h.push(Promise.all(this._invokeAll(function(m){return m.extendMaterialParams&&m.extendMaterialParams(e,l)})))}o.doubleSided===!0&&(l.side=xi);const u=o.alphaMode||pB.OPAQUE;if(u===pB.BLEND?(l.transparent=!0,l.depthWrite=!1):(l.transparent=!1,u===pB.MASK&&(l.alphaTest=o.alphaCutoff!==void 0?o.alphaCutoff:.5)),o.normalTexture!==void 0&&a!==Qt&&(h.push(i.assignTexture(l,"normalMap",o.normalTexture)),l.normalScale=new Y(1,1),o.normalTexture.scale!==void 0)){const d=o.normalTexture.scale;l.normalScale.set(d,d)}if(o.occlusionTexture!==void 0&&a!==Qt&&(h.push(i.assignTexture(l,"aoMap",o.occlusionTexture)),o.occlusionTexture.strength!==void 0&&(l.aoMapIntensity=o.occlusionTexture.strength)),o.emissiveFactor!==void 0&&a!==Qt){const d=o.emissiveFactor;l.emissive=new Ae().setRGB(d[0],d[1],d[2],Bi)}return o.emissiveTexture!==void 0&&a!==Qt&&h.push(i.assignTexture(l,"emissiveMap",o.emissiveTexture,vt)),Promise.all(h).then(function(){const d=new a(l);return o.name&&(d.name=o.name),ud(d,o),i.associations.set(d,{materials:e}),o.extensions&&vm(r,d,o),d})}createUniqueName(e){const i=Jt.sanitizeNodeName(e||"");return i in this.nodeNamesUsed?i+"_"+ ++this.nodeNamesUsed[i]:(this.nodeNamesUsed[i]=0,i)}loadGeometries(e){const i=this,s=this.extensions,r=this.primitiveCache;function o(l){return s[fi.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(l,i).then(function(c){return $H(c,l,i)})}const a=[];for(let l=0,c=e.length;l<c;l++){const h=e[l],u=Upe(h),d=r[u];if(d)a.push(d.promise);else{let m;h.extensions&&h.extensions[fi.KHR_DRACO_MESH_COMPRESSION]?m=o(h):m=$H(new dt,h,i),r[u]={primitive:h,promise:m},a.push(m)}}return Promise.all(a)}loadMesh(e){const i=this,s=this.json,r=this.extensions,o=s.meshes[e],a=o.primitives,l=[];for(let c=0,h=a.length;c<h;c++){const u=a[c].material===void 0?zpe(this.cache):this.getDependency("material",a[c].material);l.push(u)}return l.push(i.loadGeometries(a)),Promise.all(l).then(function(c){const h=c.slice(0,c.length-1),u=c[c.length-1],d=[];for(let f=0,g=u.length;f<g;f++){const y=u[f],v=a[f];let b;const A=h[f];if(v.mode===Va.TRIANGLES||v.mode===Va.TRIANGLE_STRIP||v.mode===Va.TRIANGLE_FAN||v.mode===void 0)b=o.isSkinnedMesh===!0?new Eo(y,A):new pe(y,A),b.isSkinnedMesh===!0&&b.normalizeSkinWeights(),v.mode===Va.TRIANGLE_STRIP?b.geometry=QH(b.geometry,TR):v.mode===Va.TRIANGLE_FAN&&(b.geometry=QH(b.geometry,N1));else if(v.mode===Va.LINES)b=new Ir(y,A);else if(v.mode===Va.LINE_STRIP)b=new mn(y,A);else if(v.mode===Va.LINE_LOOP)b=new C2(y,A);else if(v.mode===Va.POINTS)b=new hg(y,A);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+v.mode);Object.keys(b.geometry.morphAttributes).length>0&&Npe(b,o),b.name=i.createUniqueName(o.name||"mesh_"+e),ud(b,o),v.extensions&&vm(r,b,v),i.assignFinalMaterial(b),d.push(b)}for(let f=0,g=d.length;f<g;f++)i.associations.set(d[f],{meshes:e,primitives:f});if(d.length===1)return o.extensions&&vm(r,d[0],o),d[0];const m=new Vn;o.extensions&&vm(r,m,o),i.associations.set(m,{meshes:e});for(let f=0,g=d.length;f<g;f++)m.add(d[f]);return m})}loadCamera(e){let i;const s=this.json.cameras[e],r=s[s.type];if(!r){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return s.type==="perspective"?i=new Lt(oi.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):s.type==="orthographic"&&(i=new ic(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),s.name&&(i.name=this.createUniqueName(s.name)),ud(i,s),Promise.resolve(i)}loadSkin(e){const i=this.json.skins[e],s=[];for(let r=0,o=i.joints.length;r<o;r++)s.push(this._loadNodeShallow(i.joints[r]));return i.inverseBindMatrices!==void 0?s.push(this.getDependency("accessor",i.inverseBindMatrices)):s.push(null),Promise.all(s).then(function(r){const o=r.pop(),a=r,l=[],c=[];for(let h=0,u=a.length;h<u;h++){const d=a[h];if(d){l.push(d);const m=new he;o!==null&&m.fromArray(o.array,h*16),c.push(m)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',i.joints[h])}return new xv(l,c)})}loadAnimation(e){const i=this.json,s=this,r=i.animations[e],o=r.name?r.name:"animation_"+e,a=[],l=[],c=[],h=[],u=[];let d=0,m=r.channels.length;for(d=0,m=r.channels.length;d<m;d++){const f=r.channels[d],g=r.samplers[f.sampler],y=f.target,v=y.node,b=r.parameters!==void 0?r.parameters[g.input]:g.input,A=r.parameters!==void 0?r.parameters[g.output]:g.output;y.node!==void 0&&(a.push(this.getDependency("node",v)),l.push(this.getDependency("accessor",b)),c.push(this.getDependency("accessor",A)),h.push(g),u.push(y))}return Promise.all([Promise.all(a),Promise.all(l),Promise.all(c),Promise.all(h),Promise.all(u)]).then(function(f){const g=f[0],y=f[1],v=f[2],b=f[3],A=f[4],x=[];for(d=0,m=g.length;d<m;d++){const w=g[d],_=y[d],S=v[d],M=b[d],R=A[d];if(w===void 0)continue;w.updateMatrix&&w.updateMatrix();const P=s._createAnimationTracks(w,_,S,M,R);if(P)for(let C=0;C<P.length;C++)x.push(P[C])}return new to(o,void 0,x)})}createNodeMesh(e){const i=this.json,s=this,r=i.nodes[e];return r.mesh===void 0?null:s.getDependency("mesh",r.mesh).then(function(o){const a=s._getNodeRef(s.meshCache,r.mesh,o);return r.weights!==void 0&&a.traverse(function(l){if(l.isMesh)for(let c=0,h=r.weights.length;c<h;c++)l.morphTargetInfluences[c]=r.weights[c]}),a})}loadNode(e){const i=this.json,s=this,r=i.nodes[e],o=s._loadNodeShallow(e),a=[],l=r.children||[];for(let h=0,u=l.length;h<u;h++)a.push(s.getDependency("node",l[h]));const c=r.skin===void 0?Promise.resolve(null):s.getDependency("skin",r.skin);return Promise.all([o,Promise.all(a),c]).then(function(h){const u=h[0],d=h[1],m=h[2];m!==null&&u.traverse(function(f){f.isSkinnedMesh&&f.bind(m,Xpe)});for(let f=0,g=d.length;f<g;f++)u.add(d[f]);return u})}_loadNodeShallow(e){const i=this.json,s=this.extensions,r=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const o=i.nodes[e],a=o.name?r.createUniqueName(o.name):"",l=[],c=r._invokeOne(function(h){return h.createNodeMesh&&h.createNodeMesh(e)});return c&&l.push(c),o.camera!==void 0&&l.push(r.getDependency("camera",o.camera).then(function(h){return r._getNodeRef(r.cameraCache,o.camera,h)})),r._invokeAll(function(h){return h.createNodeAttachment&&h.createNodeAttachment(e)}).forEach(function(h){l.push(h)}),this.nodeCache[e]=Promise.all(l).then(function(h){let u;if(o.isBone===!0?u=new zp:h.length>1?u=new Vn:h.length===1?u=h[0]:u=new ye,u!==h[0])for(let d=0,m=h.length;d<m;d++)u.add(h[d]);if(o.name&&(u.userData.name=o.name,u.name=a),ud(u,o),o.extensions&&vm(s,u,o),o.matrix!==void 0){const d=new he;d.fromArray(o.matrix),u.applyMatrix4(d)}else o.translation!==void 0&&u.position.fromArray(o.translation),o.rotation!==void 0&&u.quaternion.fromArray(o.rotation),o.scale!==void 0&&u.scale.fromArray(o.scale);return r.associations.has(u)||r.associations.set(u,{}),r.associations.get(u).nodes=e,u}),this.nodeCache[e]}loadScene(e){const i=this.extensions,s=this.json.scenes[e],r=this,o=new Vn;s.name&&(o.name=r.createUniqueName(s.name)),ud(o,s),s.extensions&&vm(i,o,s);const a=s.nodes||[],l=[];for(let c=0,h=a.length;c<h;c++)l.push(r.getDependency("node",a[c]));return Promise.all(l).then(function(c){for(let u=0,d=c.length;u<d;u++)o.add(c[u]);const h=u=>{const d=new Map;for(const[m,f]of r.associations)(m instanceof Ft||m instanceof Vt)&&d.set(m,f);return u.traverse(m=>{const f=r.associations.get(m);f!=null&&d.set(m,f)}),d};return r.associations=h(o),o})}_createAnimationTracks(e,i,s,r,o){const a=[],l=e.name?e.name:e.uuid,c=[];hd[o.path]===hd.weights?e.traverse(function(m){m.morphTargetInfluences&&c.push(m.name?m.name:m.uuid)}):c.push(l);let h;switch(hd[o.path]){case hd.weights:h=yh;break;case hd.rotation:h=gl;break;case hd.position:case hd.scale:h=nc;break;default:switch(s.itemSize){case 1:h=yh;break;case 2:case 3:default:h=nc;break}break}const u=r.interpolation!==void 0?Gpe[r.interpolation]:ec,d=this._getArrayFromAccessor(s);for(let m=0,f=c.length;m<f;m++){const g=new h(c[m]+"."+hd[o.path],i.array,d,u);r.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(g),a.push(g)}return a}_getArrayFromAccessor(e){let i=e.array;if(e.normalized){const s=fB(i.constructor),r=new Float32Array(i.length);for(let o=0,a=i.length;o<a;o++)r[o]=i[o]*s;i=r}return i}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(i){const s=this instanceof gl?Ope:KH;return new s(this.times,this.values,this.getValueSize()/3,i)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Hpe(n,e,i){const s=e.attributes,r=new Wt;if(s.POSITION!==void 0){const l=i.json.accessors[s.POSITION],c=l.min,h=l.max;if(c!==void 0&&h!==void 0){if(r.set(new E(c[0],c[1],c[2]),new E(h[0],h[1],h[2])),l.normalized){const u=fB(n0[l.componentType]);r.min.multiplyScalar(u),r.max.multiplyScalar(u)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const o=e.targets;if(o!==void 0){const l=new E,c=new E;for(let h=0,u=o.length;h<u;h++){const d=o[h];if(d.POSITION!==void 0){const m=i.json.accessors[d.POSITION],f=m.min,g=m.max;if(f!==void 0&&g!==void 0){if(c.setX(Math.max(Math.abs(f[0]),Math.abs(g[0]))),c.setY(Math.max(Math.abs(f[1]),Math.abs(g[1]))),c.setZ(Math.max(Math.abs(f[2]),Math.abs(g[2]))),m.normalized){const y=fB(n0[m.componentType]);c.multiplyScalar(y)}l.max(c)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(l)}n.boundingBox=r;const a=new tn;r.getCenter(a.center),a.radius=r.min.distanceTo(r.max)/2,n.boundingSphere=a}function $H(n,e,i){const s=e.attributes,r=[];function o(a,l){return i.getDependency("accessor",a).then(function(c){n.setAttribute(l,c)})}for(const a in s){const l=dB[a]||a.toLowerCase();l in n.attributes||r.push(o(s[a],l))}if(e.indices!==void 0&&!n.index){const a=i.getDependency("accessor",e.indices).then(function(l){n.setIndex(l)});r.push(a)}return Ci.workingColorSpace!==Bi&&"COLOR_0"in s&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${Ci.workingColorSpace}" not supported.`),ud(n,e),Hpe(n,e,i),Promise.all(r).then(function(){return e.targets!==void 0?Fpe(n,e.targets,i):n})}var bm=(n=>(n[n.Quad=0]="Quad",n[n.Cube=1]="Cube",n[n.Sphere=2]="Sphere",n[n.RoundedCube=10]="RoundedCube",n))(bm||{}),zS,gB;class dd{static createText(e,i){let s=null;const r=i?.font||Qpe(i?.familyFamily||null);r instanceof jH?s=Mf(this,zS,gB).call(this,e,r,i):s==null&&(s=new dt);const o=i?.color||16777215,a=new pe(s,i?.material??new vs({color:o}));return this.applyDefaultObjectOptions(a,i),r instanceof Promise?r.then(l=>{a.geometry=Mf(this,zS,gB).call(this,e,l,i),i!=null&&i.onGeometry&&i.onGeometry(a)}):i!=null&&i.onGeometry&&i.onGeometry(a),a}static createOccluder(e){const i=new Qt({colorWrite:!1,depthWrite:!0,side:xi});return this.createPrimitive(e,{material:i})}static createPrimitive(e,i){let s;const r=i?.color||16777215;switch(e){case"Quad":case 0:{const o=new ds(1,1,1,1),a=i?.material??new vs({color:r});i!=null&&i.texture&&"map"in a&&(a.map=i.texture),s=new pe(o,a),s.name="Quad"}break;case"Cube":case 1:{const o=new $i(1,1,1),a=i?.material??new vs({color:r});i!=null&&i.texture&&"map"in a&&(a.map=i.texture),s=new pe(o,a),s.name="Cube"}break;case 10:case"RoundedCube":{const o=jpe(1,1,1,.1,2),a=i?.material??new vs({color:r});i!=null&&i.texture&&"map"in a&&(a.map=i.texture),s=new pe(o,a),s.name="RoundedCube"}break;case"Sphere":case 2:{const o=new al(.5,16,16),a=i?.material??new vs({color:r});i!=null&&i.texture&&"map"in a&&(a.map=i.texture),s=new pe(o,a),s.name="Sphere"}break;case"ShaderBall":s=new Vn,s.name="ShaderBall",Zpe(s,i);break}return this.applyDefaultObjectOptions(s,i),s}static createSprite(e){const i=new bw({color:16777215});e!=null&&e.texture&&"map"in i&&(i.map=e.texture);const s=new y2(i);return this.applyDefaultObjectOptions(s,e),s}static applyDefaultObjectOptions(e,i){e.receiveShadow=!0,e.castShadow=!0,i!=null&&i.name&&(e.name=i.name),i!=null&&i.position&&(Array.isArray(i.position)?e.position.set(i.position[0],i.position[1],i.position[2]):e.position.set(i.position.x,i.position.y,i.position.z)),i!=null&&i.rotation&&(Array.isArray(i.rotation)?e.rotation.set(i.rotation[0],i.rotation[1],i.rotation[2]):e.rotation.set(i.rotation.x,i.rotation.y,i.rotation.z)),i!=null&&i.scale&&(typeof i.scale=="number"?e.scale.set(i.scale,i.scale,i.scale):e.scale.set(i.scale.x,i.scale.y,i.scale.z)),i?.receiveShadow!=null&&(e.receiveShadow=i.receiveShadow),i?.castShadow!=null&&(e.castShadow=i.castShadow),i!=null&&i.parent&&i.parent.add(e)}}zS=new WeakSet,gB=function(n,e,i){const s=i?.depth||.1;return new lpe(n,{font:e,size:1,depth:s,height:s,bevelEnabled:i?.bevel||!1,bevelThickness:.01,bevelOffset:.01,bevelSize:.01})},Ea(dd,zS);function jpe(n,e,i,s,r){const o=new zu,a=1e-5,l=s-a;o.absarc(a,a,a,-Math.PI/2,-Math.PI,!0),o.absarc(a,e-l*2,a,Math.PI,Math.PI/2,!0),o.absarc(n-l*2,e-l*2,a,Math.PI/2,0,!0),o.absarc(n-l*2,a,a,0,-Math.PI/2,!0);const c=new Fy(o,{bevelEnabled:!0,bevelSegments:r*2,steps:1,bevelSize:l,bevelThickness:s,curveSegments:r});return c.scale(1,1,1-s),c.center(),c.computeVertexNormals(),c}const FS=new Map;function Qpe(n){let e="";switch(n){default:case"OpenSans":e="https://cdn.needle.tools/static/fonts/facetype/Open Sans_Regular_ascii.json";break;case"Helvetiker":e="https://raw.githubusercontent.com/mrdoob/three.js/master/examples/fonts/helvetiker_regular.typeface.json";break}if(FS.has(e)){const r=FS.get(e);if(r)return r}const i=new cpe,s=new Promise((r,o)=>{i.load(e,a=>{FS.set(e,a),r(a)},void 0,o)});return FS.set(e,s),s}let yB=!1,vB=null;function Zpe(n,e){if(vB===null){const i="https://cdn.needle.tools/static/models/shaderball.glb",s=new Fh,r=IP(null);s.setDRACOLoader(r.dracoLoader),s.setKTX2Loader(r.ktx2Loader),yB=!0,vB=s.loadAsync(i).then(o=>{const a=o.scene;return a.position.y-=.5,a}).catch(o=>(console.warn("Failed to load shaderball mesh: "+o.message),t9())).finally(()=>{yB=!1})}if(yB){const i=t9();i.name="ShaderBall-Placeholder";const s=i.children[0];s?.type==="Mesh"&&e9(s,e),n.add(i)}vB.then(i=>{n.children.forEach(o=>{o.name==="ShaderBall-Placeholder"&&n.remove(o)});const s=i.clone(),r=s.children[0];r?.type==="Mesh"&&e9(r,e),n.add(s)})}function e9(n,e){var i;if(e?.color||e?.material||e?.texture){const s=e?.material??((i=n.material)==null?void 0:i.clone())??new vs;e.color&&"color"in s&&s.color instanceof Ae&&s.color.set(e.color),e!=null&&e.texture&&"map"in s&&(s.map=e.texture),n.material=s}}function t9(){return new Vn().add(dd.createPrimitive("Sphere",{material:new Qt({transparent:!0,opacity:.1})}))}const i9=class{constructor(n,e,i){p(this,"_session"),p(this,"_mode"),p(this,"_init"),p(this,"_renderer"),p(this,"_camera"),p(this,"_scene"),p(this,"onEnd",()=>{var s;(s=this._session)==null||s.removeEventListener("end",this.onEnd),this._renderer.setAnimationLoop(null),this._renderer.dispose(),this._scene.clear()}),p(this,"_lastTime",0),p(this,"onFrame",(s,r)=>{const o=s-this._lastTime;this.update(s,o),this._camera.parent!==this._scene&&this._scene.add(this._camera),this._renderer.render(this._scene,this._camera)}),p(this,"_objects",[]),this._mode=n,this._init=e,this._session=i,this._session.addEventListener("end",this.onEnd),this._renderer=new gh({alpha:!0}),this._renderer.setAnimationLoop(this.onFrame),this._renderer.xr.setSession(i),this._renderer.xr.enabled=!0,this._camera=new Lt,this._scene=new Ls,this._scene.fog=new vw(4473924,10,250),this._scene.add(this._camera),this.setupScene()}static get active(){return this._active}static async start(n,e){if(this._active)return console.error("Cannot start a new XR session while one is already active"),null;if(this._requestInFlight)return console.error("Cannot start a new XR session while a request is already in flight"),null;if("xr"in navigator&&navigator.xr){if(!e)return console.error("XRSessionInit must be provided"),null;this._requestInFlight=!0;const i=await navigator.xr.requestSession(n,e);return i.addEventListener("end",()=>{this._active=null}),this._requestInFlight?(this._requestInFlight=!1,this._active=new i9(n,e,i),this._active):(i.end(),null)}return null}static async handoff(){return this._active?this._active.handoff():null}static async stop(){this._requestInFlight=!1,this._active&&(await this._active.end(),await oc(100)),this._active=null}get isAR(){return this._mode==="immersive-ar"}end(){return this._session?this._session.end():Promise.resolve()}async handoff(){if(!this._session)throw new Error("Cannot handoff a session that has already ended");const n={session:this._session,mode:this._mode,init:this._init};return await this.onBeforeHandoff(),this.onEnd(),this._session=null,n}async onBeforeHandoff(){await oc(1e3),this._scene.clear()}setupScene(){this._scene.background=new Ae(0),this._scene.add(new t_(5,10,1118481,1118481));const n=new Hp(16777215,1);n.position.set(0,20,0),n.castShadow=!1,this._scene.add(n);const e=new Hp(16777215,1);e.position.set(0,-1,0),e.castShadow=!1,this._scene.add(e);const i=new Wp(16777215,1,100,1);i.position.set(0,2,0),i.castShadow=!1,i.distance=200,this._scene.add(i);const s=50;for(let r=0;r<100;r++){const o=new vs({color:2236962,metalness:1,roughness:.8});this.isAR&&(o.emissive=new Ae(Math.random(),Math.random(),Math.random()),o.emissiveIntensity=Math.random());const a=tt.random(0,1)>.5?bm.Sphere:bm.Cube,l=dd.createPrimitive(a,{material:o});l.position.x=tt.random(-s,s),l.position.y=tt.random(-2,s),l.position.z=tt.random(-s,s),l.rotation.x=tt.random(0,Math.PI*2),l.rotation.y=tt.random(0,Math.PI*2),l.rotation.z=tt.random(0,Math.PI*2),l.scale.multiplyScalar(.5+Math.random()*10);const c=l.position.distanceTo(this._camera.position)-l.scale.x;c<1&&l.position.multiplyScalar(1+1/c),this._objects.push(l),this._scene.add(l)}}update(n,e){const i=n*4e-4;for(let s=0;s<this._objects.length;s++){const r=this._objects[s];r.position.y+=Math.sin(i+s*.5)*.005,r.rotateY(.002)}}};let s0=i9;p(s0,"_active",null),p(s0,"_requestInFlight",!1);var Ob;(n=>{const e=[];function i(){if(!(e!=null&&e.length))return!1;for(const o of e)o.exportAndOpen();return!0}n.exportAndOpen=i;function s(o){e.push(o)}n.registerExporter=s;function r(o){if(!e)return;const a=e.indexOf(o);a>=0&&e.splice(a,1)}n.unregisterExporter=r})(Ob||(Ob={}));const n9="NeedleXRSession onStart",s9="NeedleXRSession onEnd",ss=te("debugwebxr"),r9=te("stats");let bB=0;function Ype(n){let e=null;const i=n;return i.getAROverlayContainer?e=i.getAROverlayContainer():e=n,e}Kpe();async function Kpe(){var n;if(te("debugasap")){let e=globalThis["needle:XRSession"];if(e instanceof Promise){delete globalThis["needle:XRSession"],yi.addContextCreatedCallback(async i=>{if(!e)return;tm(!0);const s=await e;if(s){const r=Et.getDefaultSessionInit("immersive-vr");Et.setSession("immersive-vr",s,r,i.context)}else console.error("NeedleXRSession: ASAP session was rejected");e=void 0});return}}if("xr"in navigator){if(/WebXRViewer\//i.test(navigator.userAgent)){console.warn("WebXRViewer does not support addEventListener");return}(n=navigator.xr)==null||n.addEventListener("sessiongranted",async()=>{tm(!0),console.log("Received Session Granted..."),await oc(100);const e=sessionStorage.getItem("needle_xr_session_mode"),i=sessionStorage.getItem("needle_xr_session_init")??null,s=i?JSON.parse(i):null;let r=null;if(o9()&&(await s0.start(e||"immersive-vr",s||Et.getDefaultSessionInit("immersive-vr")),await $pe(),r=await s0.handoff()),r)Et.setSession(r.mode,r.session,r.init,Pt.Current);else if(e&&i){console.log("Session Granted: Restore last session");const o=JSON.parse(i);Et.start(e,o).catch(a=>console.warn(a))}else Et.start("immersive-vr").catch(o=>console.warn("Session Granted failed:",o))},{once:!0})}}function Jpe(n,e){sessionStorage.setItem("needle_xr_session_mode",n),sessionStorage.setItem("needle_xr_session_init",JSON.stringify(e))}function qpe(){sessionStorage.removeItem("needle_xr_session_mode"),sessionStorage.removeItem("needle_xr_session_init")}const AB=new Set;yi.registerCallback(wi.ContextCreationStart,async n=>{AB.add(n.context)}),yi.registerCallback(wi.ContextCreated,async n=>{AB.delete(n.context)});function o9(){return AB.size>0}function $pe(){return new Promise(n=>{const e=Date.now(),i=setInterval(()=>{(!o9()||Date.now()-e>6e4)&&(clearInterval(i),n())},100)})}xt.isDesktop()&&Ye()&&window.addEventListener("keydown",n=>{(n.key==="x"||n.key==="Escape")&&Et.active&&Et.stop()});const pd=class{constructor(n,e,i,s){p(this,"context"),p(this,"session"),p(this,"mode"),p(this,"controllers",[]),p(this,"_rigScale",1),p(this,"_lastRigScaleUpdate",-1),p(this,"_rigs",[]),p(this,"_viewerHitTestSource",null),p(this,"_defaultRig"),p(this,"_xr_scripts"),p(this,"_xr_update_scripts",[]),p(this,"_inactive_scripts",[]),p(this,"_controllerAdded"),p(this,"_controllerRemoved"),p(this,"_originalCameraWorldPosition"),p(this,"_originalCameraWorldRotation"),p(this,"_originalCameraWorldScale"),p(this,"_originalCameraParent"),p(this,"_mainCamera",null),p(this,"onRendererSessionSet",()=>{var a;this.running&&(this.context.renderer.xr.enabled=!0,this.context.renderer.xr.updateCamera(this.context.mainCamera),(a=this.context.mainCameraComponent)==null||a.applyClearFlags())}),p(this,"onInputSourceAdded",a=>{if(a.targetRayMode==="screen")return;let l=0;for(let h=0;h<this.session.inputSources.length;h++)if(this.session.inputSources[h]===a){l=h;break}if(this.controllers.find(h=>h.inputSource===a)){console.warn("Controller already exists for input source",l);return}ss&&console.log("Adding controller",l);const c=new zP(this,a,l);this._newControllers.push(c)}),p(this,"_ended",!1),p(this,"_newControllers",[]),p(this,"onEnd",a=>{var l,c,h;if(this._ended)return;this._ended=!0,ss&&console.log("XR Session ended"),qpe(),this.onAfterRender(),this.revertCustomForward(),this._didStart=!1,this._previousCameraParent=null,ld(this.onBefore,Yi.LateUpdate);const u=this.context.pre_render_callbacks.indexOf(this.onBeforeRender);u>=0&&this.context.pre_render_callbacks.splice(u,1);const d=this.context.post_render_callbacks.indexOf(this.onAfterRender);d>=0&&this.context.post_render_callbacks.splice(d,1),this.context.xr=null,this.context.renderer.xr.enabled=!1,this.context.pre_update_oneshot_callbacks.push(()=>{var m,f;(m=this.context.mainCameraComponent)==null||m.applyClearFlags(),(f=this.context.mainCameraComponent)==null||f.applyClippingPlane()}),dW({session:this});for(const m of pd._xrEndListeners)m({xr:this});for(let m=0;m<this.controllers.length;m++)this.disconnectInputSource(this.controllers[m].inputSource);for(const m of this._xr_scripts)(l=m?.onLeaveXR)==null||l.call(m,{xr:this});(c=this.sync)==null||c.onExitXR(this),this.context.mainCamera&&((h=this._originalCameraParent)==null||h.add(this.context.mainCamera),this._originalCameraWorldPosition&&bs(this.context.mainCamera,this._originalCameraWorldPosition),this._originalCameraWorldRotation&&La(this.context.mainCamera,this._originalCameraWorldRotation),this._originalCameraWorldScale&&vg(this.context.mainCamera,this._originalCameraWorldScale)),this.context.requestSizeUpdate(),this._defaultRig.gameObject.removeFromParent(),tm(!1),performance.mark(s9),performance.measure("NeedleXRSession",n9,s9)}),p(this,"_didStart",!1),p(this,"onBefore",a=>{var l,c,h,u,d,m,f,g;const y=a.xrFrame;if(!y)return;performance.mark("NeedleXRSession onBefore start"),this.context.xr=this,this.context.mainCameraComponent&&this.context.mainCameraComponent!==this._mainCamera&&(this._mainCamera=this.context.mainCameraComponent),((l=this.rig)==null?void 0:l.isActive)==!1&&(ss&&console.warn("Latest rig is not active - trying to activate a different rig",this.rig),this.updateActiveXRRig()),this.rig&&(c=this._mainCamera)!=null&&c.gameObject&&((u=(h=this._mainCamera)==null?void 0:h.gameObject)==null?void 0:u.parent)!==this.rig.gameObject&&this.rig.gameObject.add((d=this._mainCamera)==null?void 0:d.gameObject),this.internalUpdateState(),this.applyCustomForward();const v={xr:this};if(this._didStart){if(this.context.new_scripts_xr.length>0){const b=[...this.context.new_scripts_xr];for(let A=0;A<b.length;A++){const x=this.context.new_scripts_xr[A];if(!x||x.destroyed||((m=x.supportsXR)==null?void 0:m.call(x,this.mode))==!1){this.context.new_scripts_xr.splice(A,1);continue}if(!x.activeAndEnabled){this.context.new_scripts_xr.splice(A,1),this.markInactive(x);continue}if(this.addScript(x)){this.invokeCallback_EnterXR(x);for(const w of this.controllers)this.invokeCallback_ControllerAdded(x,w)}}}}else{if(this._didStart=!0,this.mode==="immersive-vr"){const A=Ba(this.context.scene.children);if(A){const x=A.getSize(mt());if(x.length()>0){const w=this._defaultRig.gameObject;w.position.set(A.min.x+x.x*.5,A.min.y,A.max.z+x.z*.5+1.5);const _=A.getCenter(mt());_.y=w.position.y,w.lookAt(_)}}}uW({session:this});for(const A of pd._xrStartListeners)A(v);const b=[...this._xr_scripts];ss&&console.log("NeedleXRSession start, handle scripts:",b);for(const A of b){if(A.destroyed){this._script_to_remove.push(A);continue}if(!A.activeAndEnabled){this.markInactive(A);continue}this.invokeCallback_EnterXR(A);for(const x of this.controllers)this.invokeCallback_ControllerAdded(A,x)}}this.syncCameraCullingMask();for(const b of this.controllers)b.onUpdate(y);if(this._newControllers.length>0){const b=[...this._newControllers];this._newControllers.length=0;for(const A of b){if(!A.connected){console.warn("New controller is not connected",A);continue}this.controllers.push(A);for(const x of this._xr_scripts){if(x.destroyed){this._script_to_remove.push(x);continue}x.activeAndEnabled!==!1&&this.invokeCallback_ControllerAdded(x,A)}}this.controllers.sort((A,x)=>A.index-x.index)}ss&&this.context.time.frame%30===0&&this.controllers.length<=0&&this.session.inputSources.length>0&&(tm(!0),console.error("XRControllers are not added but inputSources are present")),performance.mark("NeedleXRSession update scripts start");for(const b of this._xr_update_scripts){if(b.destroyed===!0){this._script_to_remove.push(b);continue}if(b.activeAndEnabled===!1){this.markInactive(b);continue}b.onUpdateXR&&b.onUpdateXR(v)}if(performance.mark("NeedleXRSession update scripts end"),performance.measure("NeedleXRSession update scripts","NeedleXRSession update scripts start","NeedleXRSession update scripts end"),this.handleInactiveScripts(),this._script_to_remove.length>0){const b=[...new Set(this._script_to_remove)];this._script_to_remove.length=0;for(const A of b)!A.destroyed&&this.running&&((f=A.onLeaveXR)==null||f.call(A,v)),this.removeScript(A)}(g=this.sync)==null||g.onUpdate(this),this.onRenderDebug(),performance.mark("NeedleXRSession onBefore end"),performance.measure("NE XR frame","NeedleXRSession onBefore start","NeedleXRSession onBefore end")}),p(this,"onBeforeRender",()=>{this.context.mainCamera&&this.updateFade(this.context.mainCamera)}),p(this,"onAfterRender",()=>{if(this.onUpdateFade_PostRender(),xt.isDesktop()||!this._renderOnceOnDevice){const a=this.context.renderer;if(a.xr.isPresenting&&this.context.mainCamera){this._renderOnceOnDevice=!0;const l=a.xr.enabled,c=a.getRenderTarget(),h=this.context.scene.background;a.xr.enabled=!1,a.setRenderTarget(null),this.isPassThrough&&(this.context.scene.background=null),this.context.composer?this.context.composer.render(this.context.time.deltaTime):a.render(this.context.scene,this.context.mainCamera),a.xr.enabled=l,a.setRenderTarget(c),this.context.scene.background=h}}}),p(this,"_script_to_remove",[]),p(this,"_camera"),p(this,"_cameraRenderParent",new ye().rotateY(Math.PI)),p(this,"_previousCameraParent"),p(this,"_customforward",!0),p(this,"originalCameraNearPlane"),p(this,"_viewerPose"),p(this,"_transformOrientation",new Se),p(this,"_transformPosition",new E),p(this,"_transition");var r,o;performance.mark(n9),Jpe(n,s.init),this.session=e,this.mode=n,this.context=i,(ss||te("console"))&&tm(!0),this._xr_scripts=[...s.scripts],this._xr_update_scripts=this._xr_scripts.filter(a=>typeof a.onUpdateXR=="function"),this._controllerAdded=s.controller_added,this._controllerRemoved=s.controller_removed,ad(this.onBefore,Yi.LateUpdate),this.context.pre_render_callbacks.push(this.onBeforeRender),this.context.post_render_callbacks.push(this.onAfterRender),((r=s.init.optionalFeatures)!=null&&r.includes("hit-test")||(o=s.init.requiredFeatures)!=null&&o.includes("hit-test"))&&e.requestReferenceSpace("viewer").then(a=>{var l,c;return(c=(l=e.requestHitTestSource)==null?void 0:l.call(e,{space:a}))==null?void 0:c.then(h=>this._viewerHitTestSource=h).catch(h=>console.error(h))}).catch(a=>console.error(a)),this.context.mainCamera&&(this._originalCameraWorldPosition=zt(this.context.mainCamera,new E),this._originalCameraWorldRotation=ki(this.context.mainCamera,new Se),this._originalCameraWorldScale=Qi(this.context.mainCamera,new E),this._originalCameraParent=this.context.mainCamera.parent),this._defaultRig=new fde,this.context.scene.add(this._defaultRig.gameObject),this.addRig(this._defaultRig);for(let a=0;a<e.inputSources.length;a++){const l=e.inputSources[a];if(!l.handedness){console.warn("Input source in xr session has no handedness - ignoring",a);continue}this.onInputSourceAdded(l)}this.session.addEventListener("end",this.onEnd),this.session.addEventListener("inputsourceschange",a=>{for(const l of a.removed)this.disconnectInputSource(l);for(const l of a.added)this.onInputSourceAdded(l)}),this.context.xr=this,this.context.renderer.xr.setSession(this.session).then(this.onRendererSessionSet),"controllerAutoUpdate"in this.context.renderer.xr?(console.debug("Disabling three.js controllerAutoUpdate"),this.context.renderer.xr.controllerAutoUpdate=!1):ss&&console.warn("controllerAutoUpdate is not available in three.js - cannot disable it")}static getXRSync(n){return this._sync||(this._sync=new WH(n)),this._sync}static get currentSessionRequest(){return this._currentSessionRequestMode}static get active(){return this._activeSession}static get activeMode(){var n;return((n=this._activeSession)==null?void 0:n.mode)??null}static get xrSystem(){return"xr"in navigator?navigator.xr:void 0}static isXRSupported(){return Promise.all([this.isVRSupported(),this.isARSupported()]).then(n=>n.some(e=>e)).catch(()=>!1)}static isVRSupported(){return this.isSessionSupported("immersive-vr")}static isARSupported(){return this.isSessionSupported("immersive-ar")}static isSessionSupported(n){var e;return((e=this.xrSystem)==null?void 0:e.isSessionSupported(n).catch(i=>(ss&&console.error(i),!1)))??Promise.resolve(!1)}static onSessionRequestStart(n){this._sessionRequestStartListeners.push(n)}static offSessionRequestStart(n){const e=this._sessionRequestStartListeners.indexOf(n);e>=0&&this._sessionRequestStartListeners.splice(e,1)}static onSessionRequestEnd(n){this._sessionRequestEndListeners.push(n)}static offSessionRequestEnd(n){const e=this._sessionRequestEndListeners.indexOf(n);e>=0&&this._sessionRequestEndListeners.splice(e,1)}static onXRSessionStart(n){this._xrStartListeners.push(n)}static offXRSessionStart(n){const e=this._xrStartListeners.indexOf(n);e>=0&&this._xrStartListeners.splice(e,1)}static onXRSessionEnd(n){this._xrEndListeners.push(n)}static offXRSessionEnd(n){const e=this._xrEndListeners.indexOf(n);e>=0&&this._xrEndListeners.splice(e,1)}static onControllerAdded(n){this._controllerAddedListeners.push(n)}static offControllerAdded(n){const e=this._controllerAddedListeners.indexOf(n);e>=0&&this._controllerAddedListeners.splice(e,1)}static onControllerRemoved(n){this._controllerRemovedListeners.push(n)}static offControllerRemoved(n){const e=this._controllerRemovedListeners.indexOf(n);e>=0&&this._controllerRemovedListeners.splice(e,1)}static offerSession(n,e,i){return"xr"in navigator&&navigator.xr&&"offerSession"in navigator.xr?(typeof navigator.xr.offerSession=="function"&&(console.log("WebXR offerSession is available - requesting mode: "+n),e=="default"&&(e=this.getDefaultSessionInit(n)),navigator.xr.offerSession(n,{...e}).then(s=>pd.setSession(n,s,e,i)).catch(s=>{console.log("XRSession offer rejected (perhaps because another call to offerSession was made or a call to requestSession was made)")})),!0):!1}static getDefaultSessionInit(n){switch(n){case"immersive-ar":return{optionalFeatures:["anchors","local-floor","hand-tracking","layers","dom-overlay","hit-test","unbounded"]};case"immersive-vr":return{optionalFeatures:["local-floor","bounded-floor","hand-tracking","high-fixed-foveation-level","layers"]};default:return console.warn("No default session init for mode",n),{}}}static async start(n,e,i){var s,r,o,a;if(xt.isiOS()){if(n==="ar")if(await this.isARSupported())n="immersive-ar";else return Ob.exportAndOpen(),null}else n=="ar"&&(n="immersive-ar");if(Ye()&&te("debugxrpreroom"))return console.warn("Debug: Starting temporary XR session"),await s0.start(n,e||pd.getDefaultSessionInit(n)),null;if(this._currentSessionRequest)return console.warn("A XRSession is already being requested"),(ss||Ye())&&zi("A XRSession is already being requested"),this._currentSessionRequest.then(()=>this._activeSession);if(this._activeSession)return console.error("A XRSession is already running"),this._activeSession;if(i||(i=Pt.Current),i||(i=yi.All[0]),!i)throw new Error("No Needle Engine Context found");switch(performance.mark("NeedleXRSession start"),e||(e={}),n){case"immersive-ar":{if(await((s=this.xrSystem)==null?void 0:s.isSessionSupported("immersive-ar"))!==!0)return console.error(n+" is not supported by this browser."),null;const u=this.getDefaultSessionInit(n),d=Ype(i.domElement);d&&!xt.isQuest()&&(u.domOverlay={root:d},u.optionalFeatures.push("dom-overlay")),e={...u,...e}}break;case"immersive-vr":{if(await((r=this.xrSystem)==null?void 0:r.isSessionSupported("immersive-vr"))!==!0)return console.error(n+" is not supported by this browser."),null;e={...this.getDefaultSessionInit(n),...e}}break;default:console.warn("No default session init for mode",n);break}e.optionalFeatures??(e.optionalFeatures=[]),e.requiredFeatures??(e.requiredFeatures=[]),await s0.stop();const l=n=="immersive-ar"?i.scripts_immersive_ar:i.scripts_immersive_vr;ss?console.log(`%cRequesting ${n} session`,"font-weight:bold;",e,l):console.log(`%cRequesting ${n} session`,"font-weight:bold;");for(const u of l)u.onBeforeXR&&u.onBeforeXR(n,e);for(const u of this._sessionRequestStartListeners)u({mode:n,init:e});ss&&gn("Requesting "+n+" session ("+Date.now()+")"),this._currentSessionRequest=(o=navigator.xr)==null?void 0:o.requestSession(n,e),this._currentSessionRequestMode=n;const c=await((a=this._currentSessionRequest)==null?void 0:a.catch(u=>{console.error(u,"Code: "+u.code),u.code===9&&zi("Make sure your device has the required permissions (e.g. camera access)"),console.log("If the specified XR configuration is not supported (e.g. entering AR doesnt work) - make sure you access the website on a secure connection (HTTPS) and your device has the required permissions (e.g. camera access)"),location.protocol==="http:"&&zi("XR requires a secure connection (HTTPS)")}));this._currentSessionRequest=void 0,this._currentSessionRequestMode=null;for(const u of this._sessionRequestEndListeners)u({mode:n,init:e,newSession:c||null});if(!c)return console.warn("XR Session request was rejected"),null;const h=this.setSession(n,c,e,i);return performance.mark("NeedleXRSession end"),performance.measure("NeedleXRSession Startup","NeedleXRSession start","NeedleXRSession end"),h}static setSession(n,e,i,s){if(this._activeSession)return console.error("A XRSession is already running"),this._activeSession;const r=n=="immersive-ar"?s.scripts_immersive_ar:s.scripts_immersive_vr;return this._activeSession=new pd(n,e,s,{scripts:r,controller_added:this._controllerAddedListeners,controller_removed:this._controllerRemovedListeners,init:i}),e.addEventListener("end",this.onEnd),ss?console.log(`%cStarted ${n} session`,"font-weight:bold;",r):console.log(`%cStarted ${n} session`,"font-weight:bold;"),this._activeSession}static stop(){var n;(n=this._activeSession)==null||n.end()}get sync(){return pd._sync}get running(){return!this._ended&&this.session!=null}get interactionMode(){return this.session.interactionMode}get visibilityState(){return this.session.visibilityState}get isVisibleBlurred(){return this.session.visibilityState==="visible-blurred"}get isSystemKeyboardSupported(){return this.session.isSystemKeyboardSupported}get environmentBlendMode(){return this.session.environmentBlendMode}get frame(){return this.context.xrFrame}get leftController(){return this.controllers.find(n=>n.side==="left")}get rightController(){return this.controllers.find(n=>n.side==="right")}getController(n){return typeof n=="number"?this.controllers[n]||null:this.controllers.find(e=>e.side===n)||null}get isPassThrough(){return!!(this.environmentBlendMode!=="opaque"&&this.interactionMode==="world-space"||this.mode==="immersive-ar"&&this.environmentBlendMode!=="opaque"&&this.controllers.some(n=>n.inputSource.targetRayMode==="tracked-pointer")||Ye()&&xt.isDesktop()&&this.mode==="immersive-ar")}get isAR(){return this.mode==="immersive-ar"}get isVR(){return this.mode==="immersive-vr"}get isScreenBasedAR(){return this.isAR&&!this.isPassThrough}get posePosition(){return this._transformPosition}get poseOrientation(){return this._transformOrientation}get referenceSpace(){return this.context.renderer.xr.getReferenceSpace()}get viewerPose(){return this._viewerPose}get isTrackingImages(){if(this.frame&&"getImageTrackingResults"in this.frame&&typeof this.frame.getImageTrackingResults=="function")try{const n=this.frame.getImageTrackingResults();for(const e of n)if(e.trackingState==="tracked")return!0}catch{return!1}return!1}get rig(){const n=this._rigs[0]??null;return n!=null&&n.gameObject&&Em(n.gameObject)||n?.isActive===!1?(this.updateActiveXRRig(),this._rigs[0]??null):n}get rigScale(){return this._rigs[0]?(this._lastRigScaleUpdate!==this.context.time.frame&&(this._lastRigScaleUpdate=this.context.time.frame,this._rigScale=this._rigs[0].gameObject.worldScale.x),this._rigScale):1}addRig(n){this._rigs.indexOf(n)>=0||(n.priority===void 0&&(n.priority=0),this._rigs.push(n),this.updateActiveXRRig())}removeRig(n){const e=this._rigs.indexOf(n);e!==-1&&(this._rigs.splice(e,1),this.updateActiveXRRig())}setRigActive(n){const e=this._rigs.indexOf(n);this._rigs.splice(e,1),this._rigs.unshift(n),this.updateActiveXRRig()}getUserOffsetInRig(){var n;const e=(n=this.context.mainCamera)==null?void 0:n.position;if(!e||!this.rig)return mt(0,0,0);const i=mt(e);return i.x*=-1,i.z*=-1,i.applyQuaternion(bl(this.rig.gameObject.quaternion)),i}updateActiveXRRig(){const n=this._rigs[0]??null;this._defaultRig.gameObject.parent!==this.context.scene&&this.context.scene.add(this._defaultRig.gameObject),this._defaultRig.gameObject.visible=!0,this._rigs.includes(this._defaultRig)||this._rigs.push(this._defaultRig);let e=this._rigs[0];e&&e.priority===void 0&&(e.priority=0);for(let i=1;i<this._rigs.length;i++){const s=this._rigs[i];if(s.isActive){if(Em(s.gameObject)){this._rigs.splice(i,1),i--;continue}(!e||e.isActive===!1||s.priority!==void 0&&s.priority>e.priority)&&(e=s)}}if(n!==e){const i=this._rigs.indexOf(e);i>=0&&this._rigs.splice(i,1),this._rigs.unshift(e)}ss&&(n===e?console.log("Updated Active XR Rig:",e,"prev:",n):console.log("Updated Active XRRig:",e," (the same as before)"))}getHitTest(n){if(n)return this.getControllerHitTest(n);if(!this._viewerHitTestSource)return null;const e=this._viewerHitTestSource,i=this.frame.getHitTestResults(e);if(i.length>0){const s=i[0];return this.convertHitTestResult(s)}return null}getControllerHitTest(n){const e=n.getHitTestSource();if(!e)return null;const i=this.frame.getHitTestResultsForTransientInput(e);for(const s of i)if(s.inputSource===n.inputSource)for(const r of s.results)return this.convertHitTestResult(r);return null}convertHitTestResult(n){const e=this.context.renderer.xr.getReferenceSpace(),i=e&&n.getPose(e);if(i){const s=mt(i.transform.position),r=bl(i.transform.orientation),o=this.context.mainCamera;if(o?.parent!==this._cameraRenderParent&&s.applyMatrix4($g),o!=null&&o.parent){s.applyMatrix4(o.parent.matrixWorld),r.multiply(Ua);const a=ki(o.parent);a.premultiply(Ua),r.premultiply(a)}return{hit:n,position:s,quaternion:r}}return null}convertSpace(n){const e=mt(n.position);e.applyMatrix4($g);const i=bl(n.orientation);return i.premultiply(Ua),{position:e,quaternion:i}}disconnectInputSource(n){const e=(i,s,r)=>{if(i.inputSource===n){ss&&console.log("Disconnecting controller",i.index),this.controllers.splice(r,1),this.invokeControllerEvent(i,this._controllerRemoved,"removed");const o={xr:this,controller:i,change:"removed"};for(const a of this._xr_scripts)a.onXRControllerRemoved&&a.onXRControllerRemoved(o);i.onDisconnected()}};for(let i=this.controllers.length-1;i>=0;i--){const s=this.controllers[i];e(s,this.controllers,i)}for(let i=this._newControllers.length-1;i>=0;i--){const s=this._newControllers[i];e(s,this._newControllers,i)}}end(){this._ended||this.session.end().catch(n=>console.warn(n))}onRenderDebug(){if(ss)for(const n of this.controllers)n.onRenderDebug();if((ss||r9)&&this.rig&&(bB++,bB>=20)){const n=this.rig.gameObject.worldPosition,e=this.rig.gameObject.worldForward;n.add(e.multiplyScalar(1.5));const i=this.rig.gameObject.worldUp;n.add(i.multiplyScalar(2.5));let s="";if(s+=`${this.context.time.smoothedFps.toFixed(0)} FPS`,s+=`, calls: ${this.context.renderer.info.render.calls}, tris: ${this.context.renderer.info.render.triangles.toLocaleString()}`,ss||r9)for(const r of this.controllers)s+=`
${r.hand?"hand":"ctrl"} ${r.inputSource.handedness}[${r.index}] con:${r.connected} tr:${r.isTracking} hts:${r.hasHitTestSource?"yes":"no"}`;bB=0,ft.DrawLabel(n,s,void 0,1/60*20)}}addScript(n){return this._xr_scripts.includes(n)?!1:(ss&&console.log("Register new XRScript",n),this._xr_scripts.push(n),typeof n.onUpdateXR=="function"&&this._xr_update_scripts.push(n),!0)}markInactive(n){if(!(this._inactive_scripts.indexOf(n)>=0)){this.removeScript(n,!1),this._inactive_scripts.push(n);for(const e of this.controllers)this.invokeCallback_ControllerRemoved(n,e);this.invokeCallback_LeaveXR(n)}}handleInactiveScripts(){if(this._inactive_scripts.length>0)for(let n=this._inactive_scripts.length-1;n>=0;n--){const e=this._inactive_scripts[n];if(e.activeAndEnabled){this._inactive_scripts.splice(n,1),this.addScript(e),this.invokeCallback_EnterXR(e);for(const i of this.controllers)this.invokeCallback_ControllerAdded(e,i)}}}removeScript(n,e=!0){ss&&console.log("Remove XRScript",n);const i=this._xr_scripts.indexOf(n);i>=0&&this._xr_scripts.splice(i,1);const s=this._xr_update_scripts.indexOf(n);if(s>=0&&this._xr_update_scripts.splice(s,1),e){const r=this._inactive_scripts.indexOf(n);r>=0&&this._inactive_scripts.splice(r,1)}}invokeCallback_EnterXR(n){n.onEnterXR&&n.onEnterXR({xr:this})}invokeCallback_ControllerAdded(n,e){n.onXRControllerAdded&&n.onXRControllerAdded({xr:this,controller:e,change:"added"})}invokeCallback_ControllerRemoved(n,e){n.onXRControllerRemoved&&n.onXRControllerRemoved({xr:this,controller:e,change:"removed"})}invokeCallback_LeaveXR(n){n.onLeaveXR&&!n.destroyed&&n.onLeaveXR({xr:this})}syncCameraCullingMask(){var n;const e=this.context.xrCamera,i=(n=this.context.mainCameraComponent)==null?void 0:n.cullingMask;if(e&&i!==void 0){for(const s of e.cameras)s.layers.mask=i;e.layers.mask=i}else if(e){for(const s of e.cameras)s.layers.enableAll();e.layers.enableAll()}}invokeControllerEvent(n,e,i){for(let s=e.length-1;s>=0;s--){const r=e[s];if(r)try{r({xr:this,controller:n,change:i})}catch(o){console.error(o)}}}applyCustomForward(){var n;if(this.context.mainCamera&&this._customforward){this._camera=this.context.mainCamera,this._camera.parent!==this._cameraRenderParent&&(this._previousCameraParent=this._camera.parent,(n=this._previousCameraParent)==null||n.add(this._cameraRenderParent)),this._cameraRenderParent.name="XR Camera Render Parent",this._cameraRenderParent.add(this._camera);let e=.02;if(this.rig){const i=Qi(this.rig.gameObject);e*=i.x}this._camera instanceof Lt&&this._camera.near>e&&(this.originalCameraNearPlane=this._camera.near,this._camera.near=e)}}revertCustomForward(){this._camera&&this._previousCameraParent&&this._previousCameraParent.add(this._camera),this._previousCameraParent=null,this._camera instanceof Lt&&this.originalCameraNearPlane!=null&&(this._camera.near=this.originalCameraNearPlane)}internalUpdateState(){const n=this.context.renderer.xr.getReferenceSpace();if(!n){this._viewerPose=void 0;return}if(this._viewerPose=this.frame.getViewerPose(n),this._viewerPose){const e=this._viewerPose.transform;this._transformPosition.set(e.position.x,e.position.y,e.position.z),this._transformOrientation.set(e.orientation.x,e.orientation.y,e.orientation.z,e.orientation.w)}}get transition(){return this._transition||(this._transition=new HH),this._transition}fadeTransition(){return this._transition||(this._transition=new HH),this._transition.fadeTransition()}updateFade(n){this._transition&&n instanceof Lt&&this._transition.update(n,this.context.time.deltaTime)}onUpdateFade_PostRender(){var n;(n=this._transition)==null||n.remove()}};let Et=pd;p(Et,"_sync",null),p(Et,"_currentSessionRequestMode",null),p(Et,"_currentSessionRequest"),p(Et,"_activeSession"),p(Et,"_sessionRequestStartListeners",[]),p(Et,"_sessionRequestEndListeners",[]),p(Et,"_xrStartListeners",[]),p(Et,"_xrEndListeners",[]),p(Et,"_controllerAddedListeners",[]),p(Et,"_controllerRemovedListeners",[]),p(Et,"onEnd",()=>{ss&&console.log("XR Session ended"),pd._activeSession=null});const xB=te("debugwebxr");class a9{static tryFindAvatarObjects(e,i,s){if(s.head&&s.leftHand&&s.rightHand)return;const r=e.name.toLocaleLowerCase();!s.head&&r.includes("head")&&(xB&&console.log("FOUND AVATAR HEAD",e.name),s.head=new ei("",i,e)),r.includes("hand")&&(!s.leftHand&&r.includes("left")&&(xB&&console.log("FOUND AVATAR LEFT HAND",e.name),s.leftHand=new ei("",i,e)),!s.rightHand&&r.includes("right")&&(xB&&console.log("FOUND AVATAR RIGHT HAND",e.name),s.rightHand=new ei("",i,e)));for(let o=0;o<e.children.length;o++){if(s.head&&s.leftHand&&s.rightHand)return;const a=e.children[o];this.tryFindAvatarObjects(a,i,s)}}}const Gr=new E,l9=new E,c9=new Se,eme=te("debuggizmos"),Bl=8947848,wB=32,kl=class{constructor(){}static isGizmo(n){return n[SB]!==void 0}static DrawLabel(n,e,i=.05,s=0,r,o,a){var l;if(!kl.enabled)return null;r||(r=Bl);const c=((l=Et.active)==null?void 0:l.rigScale)??1,h=rn.getTextLabel(s,e,i*c,r,o);return a instanceof ye&&a.add(h),h.position.x=n.x,h.position.y=n.y,h.position.z=n.z,h}static DrawRay(n,e,i=Bl,s=0,r=!0){if(!kl.enabled)return;const o=rn.getLine(s),a=o.geometry.getAttribute("position");a.setXYZ(0,n.x,n.y,n.z),Gr.set(e.x,e.y,e.z).multiplyScalar(999999999),a.setXYZ(1,n.x+Gr.x,n.y+Gr.y,n.z+Gr.z),a.needsUpdate=!0,o.material.color.set(i),o.material.depthTest=r,o.material.depthWrite=!1}static DrawDirection(n,e,i=Bl,s=0,r=!0,o=1){if(!kl.enabled)return;const a=rn.getLine(s),l=a.geometry.getAttribute("position");l.setXYZ(0,n.x,n.y,n.z),e.w!==void 0?(Gr.set(0,0,-o),c9.set(e.x,e.y,e.z,e.w),Gr.applyQuaternion(c9)):(Gr.set(e.x,e.y,e.z),Gr.multiplyScalar(o)),l.setXYZ(1,n.x+Gr.x,n.y+Gr.y,n.z+Gr.z),l.needsUpdate=!0,a.material.color.set(i),a.material.depthTest=r,a.material.depthWrite=!1}static DrawLine(n,e,i=Bl,s=0,r=!0){if(!kl.enabled)return;const o=rn.getLine(s),a=o.geometry.getAttribute("position");a.setXYZ(0,n.x,n.y,n.z),a.setXYZ(1,e.x,e.y,e.z),a.needsUpdate=!0,o.material.color.set(i),o.material.depthTest=r,o.material.depthWrite=!1,o.material.fog=!1}static DrawCircle(n,e,i,s=Bl,r=0,o=!0){if(!kl.enabled)return;const a=rn.getCircle(r);a.position.set(n.x,n.y,n.z),a.scale.set(i,i,i),a.quaternion.setFromUnitVectors(this._up,Gr.set(e.x,e.y,e.z).normalize()),a.material.color.set(s),a.material.depthTest=o,a.material.depthWrite=!1,a.material.fog=!1}static DrawWireSphere(n,e,i=Bl,s=0,r=!0){if(!kl.enabled)return;const o=rn.getSphere(e,s,!0);$p(o,n.x,n.y,n.z),o.material.color.set(i),o.material.depthTest=r,o.material.depthWrite=!1,o.material.fog=!1}static DrawSphere(n,e,i=Bl,s=0,r=!0){if(!kl.enabled)return;const o=rn.getSphere(e,s,!1);$p(o,n.x,n.y,n.z),o.material.color.set(i),o.material.depthTest=r,o.material.depthWrite=!1}static DrawWireBox(n,e,i=Bl,s=0,r=!0){if(!kl.enabled)return;const o=rn.getBox(s);o.position.set(n.x,n.y,n.z),o.scale.set(e.x,e.y,e.z),o.material.color.set(i),o.material.depthTest=r,o.material.wireframe=!0,o.material.depthWrite=!1,o.material.fog=!1}static DrawWireBox3(n,e=Bl,i=0,s=!0){if(!kl.enabled)return;const r=rn.getBox(i);r.position.copy(n.getCenter(Gr)),r.scale.copy(n.getSize(Gr)),r.material.color.set(e),r.material.depthTest=s,r.material.wireframe=!0,r.material.depthWrite=!1,r.material.fog=!1}static DrawArrow(n,e,i=Bl,s=0,r=!0,o=!1){if(!kl.enabled)return;const a=rn.getArrowHead(s);a.position.set(e.x,e.y,e.z),a.quaternion.setFromUnitVectors(this._up.set(0,1,0),Gr.set(e.x,e.y,e.z).sub(l9.set(n.x,n.y,n.z)).normalize());const l=Gr.set(e.x,e.y,e.z).sub(l9.set(n.x,n.y,n.z)).length()*.1;a.scale.set(l,l,l),a.material.color.set(i),a.material.depthTest=r,a.material.wireframe=o,this.DrawLine(n,e,i,s,r)}static DrawWireMesh(n){const e=rn.getMesh(n.duration??0);"mesh"in n?(e.geometry=n.mesh.geometry,e.matrix.copy(n.mesh.matrixWorld)):(e.geometry=n.geometry,e.matrix.copy(n.matrix)),e.matrixAutoUpdate=!1,e.matrixWorldAutoUpdate=!1,e.material.color.set(n.color??Bl),e.material.depthTest=n.depthTest??!0,e.material.wireframe=!0}static setVisible(n){for(const e of rn.timedObjectsBuffer)e.visible=n}};let ft=kl;p(ft,"enabled",!0),p(ft,"_up",new E(0,1,0));const tme=new $i(1,1,1);function _B(n=null){const e=new Ae(n??14540253),i=new z2(tme);return new Ir(i,new Vi({color:e}))}const SB=Symbol("GizmoCache");class rn{static ensureFont(){let e=Xi.FontLibrary.getFontFamily(this.familyName);if(!e){e=Xi.FontLibrary.addFontFamily(this.familyName);const i=e.addVariant("normal","normal","https://uploads.needle.tools/include/font-msdf.json","https://uploads.needle.tools/include/font.png");i?.addEventListener("ready",()=>{Xi.update()})}}static getTextLabel(e,i,s,r,o){this.ensureFont();let a=this.textLabelCache.pop(),l=1;o&&typeof o=="string"&&o?.length>=8&&o.startsWith("#")?(l=parseInt(o.substring(7),16)/255,o=o.substring(0,7),eme&&console.log(o,l)):typeof o=="object"&&o.a!==void 0&&(l=o.a);const c={boxSizing:"border-box",fontFamily:this.familyName,width:"auto",fontSize:s,color:r,lineHeight:1,backgroundColor:o??void 0,backgroundOpacity:l,textContent:i,borderRadius:.5*s,padding:.8*s,whiteSpace:"pre",offset:.05*s};if(a)a.set(c);else{a=new YI(c);const h=this,u=a;u.setText=function(d){this.set({textContent:d}),h.tmuiNeedsUpdate=!0}}return this.tmuiNeedsUpdate=!0,this.registerTimedObject(Pt.Current,a,e,this.textLabelCache),a}static getBox(e){let i=this.boxesCache.pop();if(!i){const s=new $i(1,1,1);i=new pe(s)}return this.registerTimedObject(Pt.Current,i,e,this.boxesCache),i}static getLine(e){let i=this.linesCache.pop();if(!i){i=new mn;let s=i.geometry.getAttribute("position");s||(s=new qe(new Float32Array(2*3),3),i.geometry.setAttribute("position",s))}return i.frustumCulled=!1,this.registerTimedObject(Pt.Current,i,e,this.linesCache),i}static getCircle(e){let i=this.circlesCache.pop();if(!i){i=new mn;let s=i.geometry.getAttribute("position");if(!s){s=new qe(new Float32Array(wB*3),3),i.geometry.setAttribute("position",s);const r=mt(0,1,0),o=mt(0,0,1),a=mt(o);a.cross(r).normalize();const l=mt(a),c=Math.PI*2/(wB-1);for(let h=0;h<wB+1;h++){const u=c*h;r.copy(l).multiplyScalar(Math.cos(u)*1),a.copy(o).multiplyScalar(Math.sin(u)*1);const d=r.add(a);s.setXYZ(h,d.x,d.y,d.z)}}}return i.frustumCulled=!1,this.registerTimedObject(Pt.Current,i,e,this.circlesCache),i}static getSphere(e,i,s){let r=this.spheresCache.pop();return r||(r=new pe(new al(1,8,8))),r.scale.set(e,e,e),r.material.wireframe=s,this.registerTimedObject(Pt.Current,r,i,this.spheresCache),r}static getArrowHead(e){let i=this.arrowHeadsCache.pop();return i||(i=new pe(new Yn(0,.5,1,8))),this.registerTimedObject(Pt.Current,i,e,this.arrowHeadsCache),i}static getMesh(e){let i=this.mesh.pop();return i||(i=new pe,i.material=new Qt),this.registerTimedObject(Pt.Current,i,e,this.mesh),i}static registerTimedObject(e,i,s,r){if(!e){console.error("No Needle Engine context available. Did you call a Gizmos function in global scope?");return}const o=this.contextBeforeRenderCallbacks.get(e),a=this.contextPostRenderCallbacks.get(e);if(o){if(e.pre_render_callbacks[e.pre_render_callbacks.length-1]!==o){const l=e.pre_render_callbacks.indexOf(o);l>=0&&e.pre_render_callbacks.splice(l,1),e.pre_render_callbacks.push(o)}}else{const l=()=>{this.onBeforeRender(e,this.timedObjectsBuffer)};this.contextBeforeRenderCallbacks.set(e,l),e.pre_render_callbacks.push(l)}if(a){if(e.post_render_callbacks[e.post_render_callbacks.length-1]!==a){const l=e.post_render_callbacks.indexOf(a);l>=0&&e.post_render_callbacks.splice(l,1),e.post_render_callbacks.push(a)}}else{const l=()=>{this.onPostRender(e,this.timedObjectsBuffer,this.timesBuffer)};this.contextPostRenderCallbacks.set(e,l),e.post_render_callbacks.push(l)}i.traverse(l=>{l.layers.disableAll(),l.layers.enable(2)}),i.renderOrder=999999,i[SB]=r,i.castShadow=!1,i.receiveShadow=!1,i.isGizmo=!0,this.timedObjectsBuffer.push(i),this.timesBuffer.push(Pt.Current.time.realtimeSinceStartup+s),e.scene.add(i)}static onBeforeRender(e,i){this.tmuiNeedsUpdate&&(this.tmuiNeedsUpdate=!1,Xi.update());for(let s=0;s<i.length;s++){const r=i[s];if(e.mainCamera&&r instanceof Xi.MeshUIBaseElement){if(Em(r))continue;const o=e.isInVR,a=!1,l=!o;Uv(r,e.mainCamera,a,l)}}}static onPostRender(e,i,s){const r=e.time.realtimeSinceStartup;for(let o=i.length-1;o>=0;o--){const a=i[o];r>=s[o]-1e-6&&(i.splice(o,1),s.splice(o,1),a.removeFromParent(),Em(a)!=!0&&a[SB].push(a))}}}p(rn,"familyName","needle-gizmos"),p(rn,"linesCache",[]),p(rn,"circlesCache",[]),p(rn,"spheresCache",[]),p(rn,"boxesCache",[]),p(rn,"arrowHeadsCache",[]),p(rn,"mesh",[]),p(rn,"textLabelCache",[]),p(rn,"timedObjectsBuffer",new Array),p(rn,"timesBuffer",new Array),p(rn,"contextPostRenderCallbacks",new Map),p(rn,"contextBeforeRenderCallbacks",new Map),p(rn,"tmuiNeedsUpdate",!1);const Dl=te("debugphysics"),h9=new Mr;class yc{constructor(){p(this,"ray"),p(this,"cam"),p(this,"screenPoint"),p(this,"raycaster"),p(this,"results"),p(this,"targets"),p(this,"recursive",!0),p(this,"minDistance"),p(this,"maxDistance"),p(this,"lineThreshold"),p(this,"layerMask"),p(this,"ignore"),p(this,"testObject"),p(this,"useAcceleratedRaycast")}screenPointFromOffset(e,i){this.screenPoint===void 0&&(this.screenPoint=new Y),this.screenPoint.x=e/window.innerWidth*2-1,this.screenPoint.y=-(i/window.innerHeight)*2+1}setLayer(e){h9.set(e),this.layerMask=h9}setMask(e){this.layerMask||(this.layerMask=new Mr);const i=this.layerMask;i?i.mask=e:this.layerMask=e}}p(yc,"AllLayers",4294967295);class CB{constructor(e,i,s){p(this,"distance"),p(this,"point"),p(this,"object"),this.object=e,this.distance=i,this.point=s}}const MB=class{constructor(n){p(this,"context"),p(this,"engine"),p(this,"raycaster",new Nu),p(this,"defaultRaycastOptions",new yc),p(this,"targetBuffer",new Array(1)),p(this,"defaultThresholds",{Mesh:{},Line:{threshold:-1},LOD:{},Points:{threshold:0},Sprite:{}}),p(this,"sphereResults",new Array),p(this,"sphereMask",new Mr),p(this,"sphere",new tn),p(this,"tempBoundingBox",new Wt),this.context=n}static get raycasting(){return this._raycasting>0}raycastPhysicsFast(n,e=void 0,i=1/0,s=!0){var r;return((r=this.context.physics.engine)==null?void 0:r.raycast(n,e,{maxDistance:i,solid:s}))??null}raycastPhysicsFastAndGetNormal(n,e=void 0,i=1/0,s=!0){var r;return((r=this.context.physics.engine)==null?void 0:r.raycastAndGetNormal(n,e,{maxDistance:i,solid:s}))??null}sphereOverlapPhysics(n,e){var i;return((i=this.context.physics.engine)==null?void 0:i.sphereOverlap(n,e))??null}sphereOverlap(n,e,i=!0,s=!1,r=null){if(this.sphereResults.length=0,!this.context.scene)return this.sphereResults;const o=this.sphereMask;o.enableAll(),o.disable(2);for(const a of this.context.scene.children)this.intersectSphere(a,n,e,o,this.sphereResults,i,s,r);return this.sphereResults.sort((a,l)=>a.distance-l.distance)}raycastFromRay(n,e=null){const i=e??this.defaultRaycastOptions;i.ray=n;const s=this.raycast(i);return i===this.defaultRaycastOptions&&(i.ray=void 0),s}raycast(n=null){Dl&&performance.mark("raycast.start"),n||(n=this.defaultRaycastOptions);const e=n.screenPoint??this.context.input.mousePositionRC,i=n.raycaster??this.raycaster;if(i.near=n.minDistance??0,i.far=n.maxDistance??1/0,i.params=this.defaultThresholds,n.lineThreshold===void 0&&(n.lineThreshold=-1),i.params.Line={threshold:n.lineThreshold},n.ray)i.ray.copy(n.ray);else{const a=n.cam??this.context.mainCamera;if(!a)return Dl&&console.error("Can not perform raycast - no main camera found"),this.defaultRaycastOptions.results&&(this.defaultRaycastOptions.results.length=0),this.defaultRaycastOptions.results??[];const l=this.context.xrCamera;this.context.isInXR&&l instanceof m2&&l.cameras.length>0?i.setFromCamera(e,l.cameras[0]):i.setFromCamera(e,a)}let s=n.targets;s||(s=this.targetBuffer,s.length=1,s[0]=this.context.scene);let r=n.results;this.defaultRaycastOptions.results&&(this.defaultRaycastOptions.results.length=0),r||(this.defaultRaycastOptions.results||(this.defaultRaycastOptions.results=new Array),r=this.defaultRaycastOptions.results),n.layerMask!==void 0?n.layerMask instanceof Mr?i.layers.mask=n.layerMask.mask:i.layers.mask=n.layerMask:(i.layers.enableAll(),i.layers.disable(2)),Dl&&(ft.DrawRay(i.ray.origin,i.ray.direction,16711680,2),console.time("raycast")),r.length=0,MB._raycasting++,this.intersect(this.raycaster,s,r,n),r.sort((a,l)=>a.distance-l.distance);const o=n.ignore;return o!==void 0&&o.length>0&&(r=r.filter(a=>!o.includes(a.object))),MB._raycasting--,Dl&&(console.timeEnd("raycast"),console.warn("#"+this.context.time.frame+", hits:",r!=null&&r.length?[...r]:"nothing"),performance.mark("raycast.end"),performance.measure("raycast","raycast.start","raycast.end")),r}intersect(n,e,i,s){var r,o,a;for(const l of e){if(!l||l.visible===!1||ft.isGizmo(l)||s.lineThreshold!==void 0&&s.lineThreshold<0&&l instanceof mn)continue;let c=!0;const h=l,u=h.geometry;if(s.testObject){const d=(r=s.testObject)==null?void 0:r.call(s,l);if(d===!1)continue;d==="continue in children"&&(c=!1)}if(c&&(u&&u9(u)||(c=!1)),c){const d=xb(l);d&&(h.geometry=d);const m=i.length;let f=!0;s.precise===!1&&(f=!1),f||(f=((a=(o=u.getAttribute("position"))==null?void 0:o.array)==null?void 0:a.length)<64),h instanceof yg&&(f=!1),!f&&nme(h,n,i)||(s.useAcceleratedRaycast!==!1?VS.runMeshBVHRaycast(n,h,i,this.context):n.intersectObject(h,!1,i)),Dl&&i.length!=m&&ft.DrawWireMesh({mesh:l,depthTest:!1,duration:.2,color:d?8969557:7798784}),h.geometry=u}s.recursive!==!1&&this.intersect(n,l.children,i,s)}return i}intersectSphere(n,e,i,s,r,o,a,l){let c=n&&n.isMesh&&n.layers.test(s)&&!ft.isGizmo(n);c&&(c=n.visible),c&&(c=!(n instanceof mn)),c&&(c=!(n instanceof yg));const h=n,u=h.geometry;if(c&&l){const d=l(n);if(d===!1)return;d==="continue in children"&&(c=!1)}if(u&&u9(u)||(c=!1),c){if(a){const d=this.sphere;d.center.copy(e),d.radius=i;const m=r.length;if(VS.runMeshBVHRaycast(this.sphere,h,r,this.context),m!=r.length&&!o)return}else if(u.boundingBox||u.computeBoundingBox(),u.boundingBox){h.matrixWorldNeedsUpdate&&h.updateWorldMatrix(!1,!1);const d=this.tempBoundingBox.copy(u.boundingBox).applyMatrix4(h.matrixWorld),m=this.sphere;if(m.center.copy(e),m.radius=i,m.intersectsBox(d)){const f=zt(n),g=f.distanceTo(m.center),y=new CB(n,g,f);if(r.push(y),!o)return}}}if(n.children)for(const d of n.children){const m=r.length;if(this.intersectSphere(d,e,i,s,r,o,a,l),m!=r.length&&!o)return}}};let NS=MB;p(NS,"_raycasting",0);function u9(n){return!(n.index&&n.index.array.length<3)}const Am=new tn,US=new fs,ime=new Gt;function nme(n,e,i){const s=n._computeIntersections;if(!s)return!1;let r=n["_computeIntersections:Needle"];return r||(r=n["_computeIntersections:Needle"]=function(o,a,l){const c=this,h=c.geometry.boundingSphere;if(h){if(c instanceof yg){US.setFromNormalAndCoplanarPoint(mt(0,1,0),mt(0,-c.position.y,0)),US.applyMatrix4(c.matrixWorld,ime);const d=o.ray.intersectPlane(US,mt());if(d){Am.copy(h),Am.applyMatrix4(c.matrixWorld);const m=mt(d).sub(o.ray.origin).length(),f=Am.radius*.5;m<f&&a.push({distance:m,point:d,object:c,normal:US.normal.clone()})}return}Am.copy(h),Am.applyMatrix4(c.matrixWorld);const u=o.ray.intersectSphere(Am,mt());if(u){const d=mt(u).sub(o.ray.origin),m=d.length();if(m>Am.radius){const f=d.clone().normalize();a.push({distance:m,point:u,object:c,normal:f})}}}}),n._computeIntersections=r,e.intersectObject(n,!1,i),n._computeIntersections=s,!0}var VS;(n=>{function e(b,A,x,w){var _,S,M;if(!A.geometry||!A.geometry.hasAttribute("position"))return!1;const R=A.geometry;if(A!=null&&A.isSkinnedMesh){const P=A,C=P.bvhNeedsUpdate;if(!P.staticGenerator)l(),o&&(P.staticGenerator=new o(A),P.staticGenerator.applyWorldTransforms=!1,P.staticGeometry=P.staticGenerator.generate(),R.boundsTree=a?.call(P.staticGeometry),P.staticGeometryLastUpdate=performance.now()+Math.random()*200,P.autoUpdateMeshBVH===void 0&&(P.autoUpdateMeshBVH=!1));else if(R.boundsTree&&(P.autoUpdateMeshBVH===!0||C===!0)){const L=performance.now(),B=L-P.staticGeometryLastUpdate;(C||B>100)&&(P.bvhNeedsUpdate=!1,P.staticGeometryLastUpdate=L,(_=P.staticGenerator)==null||_.generate(P.staticGeometry),R.boundsTree.refit())}}else if(!R.boundsTree){h||v();let P=!0;if((w.xr||R[f]===!1||(S=R.getAttribute("position"))!=null&&S.isInterleavedBufferAttribute||R.index&&(M=R.index)!=null&&M.isInterleavedBufferAttribute)&&(P=!1),P&&d){if(R[m]===void 0){let C=null;if(y.length>0){const L=y.shift();L&&!L.running&&(C=L)}if(!C&&g.length<3&&(C=new d,g.push(C)),C!=null&&!C.running){Dl&&console.log("<<<< worker start",C),R[m]="queued",performance.mark("bvh.create.start");const L=R.clone();C.generate(L).then(B=>{R[m]="done",R.boundsTree=B}).catch(B=>{R[m]="failed - "+B?.message,R[f]=!1}).finally(()=>{Dl&&console.log(">>>>> worker done"),y.push(C),L.dispose(),performance.mark("bvh.create.end"),performance.measure("bvh.create (worker)","bvh.create.start","bvh.create.end")})}else Dl&&console.warn("No worker available")}}else(!u||!P)&&(l(),r&&(performance.mark("bvh.create.start"),R.boundsTree=new r(R),performance.mark("bvh.create.end"),performance.measure("bvh.create","bvh.create.start","bvh.create.end")))}if(b instanceof Nu){const P=b,C=A.raycast;s&&R.boundsTree?(A.acceleratedRaycast||(A.acceleratedRaycast=s.bind(A)),A.raycast=A.acceleratedRaycast):Dl&&console.warn("No bounds tree found for mesh",A.name);const L=P.firstHitOnly;return P.firstHitOnly=!1,P.intersectObject(A,!1,x),P.firstHitOnly=L,A.raycast=C,!0}else if(b instanceof tn){const P=R.boundsTree;if(P){const C=b;if(c.copy(A.matrixWorld).invert(),C.applyMatrix4(c),P.intersectsSphere(C)){const L=zt(A),B=L.distanceTo(C.center),z=new CB(A,B,L);x.push(z)}}return!0}return!1}n.runMeshBVHRaycast=e;let i=!1,s=null,r=null,o=null,a=null;function l(){i||(i=!0,Promise.resolve().then(()=>CMe).then(b=>{s=b.acceleratedRaycast,r=b.MeshBVH,o=b.StaticGeometryGenerator,a=b.computeBoundsTree}).catch(b=>{(Dl||Ye())&&console.warn("Failed to load mesh bvh library")}))}const c=new he;let h=!1,u=!1,d=null;const m=Symbol("Needle:MeshBVH-Worker"),f=Symbol("Needle:MeshBVH-CanUseWorker"),g=[],y=[];function v(){h=!0,u=!0,Promise.resolve().then(()=>RMe).then(b=>{d=b.GenerateMeshBVHWorker}).catch(b=>{(Dl||Ye())&&console.warn("Failed to setup mesh bvh worker")}).finally(()=>{u=!1})}})(VS||(VS={}));const d9=Symbol("gltf-loader-internal-usage-tracker"),sme=te("debugusers"),XS=class{constructor(n){p(this,"parser"),p(this,"_getDependency"),p(this,"_loadingId"),p(this,"_loadedObjects",new Set),this.parser=n,this._getDependency=this.parser.getDependency,this._loadingId=Date.now().toString()}get name(){return"NEEDLE_internal_usage_tracker"}static isLoading(n){return XS._loadingProcesses>0}beforeRoot(){XS._loadingProcesses++;const n=this,e=this._getDependency;return this.parser.getDependency=function(i,s){const r=e.call(this,i,s);return r.then(o=>(o&&(n._loadedObjects.add(o),o[d9]=n._loadingId),o)),r},null}afterRoot(n){XS._loadingProcesses--,this.parser.getDependency=this._getDependency;for(const e of this._loadedObjects)delete e[d9],e instanceof ye&&(e.parent||e instanceof pe&&setTimeout(()=>{sme&&console.warn("> GLTF LOADER: Mesh not used in scene!",e),e.material=null,e.geometry=null},1e3));return null}};let EB=XS;p(EB,"_loadingProcesses",0);class p9{constructor(){window.addEventListener("unhandledrejection",e=>{var i;if(e.defaultPrevented)return;const s=(i=e?.reason)==null?void 0:i.path;if(s){const r=s[0];r&&r.tagName==="IMG"&&(console.warn(`Could not load image:
`+r.src),e.preventDefault())}})}}const WS=te("trackresources");function m9(){return WS==="dispose"}let xm=!0;WS===0&&(xm=!1);function rme(n){xm=n}function f9(){return xm}const g9=Symbol("disposable");function TB(n,e){n&&(n[g9]=e,wm&&console.warn("Set disposable",e,n))}const y9=Symbol("disposed");function ome(n){return n[y9]===!0}function Zi(n){var e;if(n){if(n[g9]===!1){wm&&console.warn("Object is marked as not disposable",n);return}if(n[y9]=!0,n instanceof Ls)Zi(n.environment),Zi(n.background),Zi(n.customDepthMaterial),Zi(n.customDistanceMaterial);else if(n instanceof Eo)Zi(n.geometry),Zi(n.material),Zi(n.skeleton),Zi(n.bindMatrix),Zi(n.bindMatrixInverse),Zi(n.customDepthMaterial),Zi(n.customDistanceMaterial),n.geometry=null,n.material=null,n.visible=!1;else if(n instanceof pe)Zi(n.geometry),Zi(n.material),Zi(n.customDepthMaterial),Zi(n.customDistanceMaterial),n.geometry=null,n.material=null,n.visible=!1;else if(n instanceof dt){r0(n);for(const i of Object.keys(n.attributes)){const s=n.attributes[i];Zi(s)}}else if(n instanceof qe||n instanceof Ho)wm&&console.warn("BufferAttribute dispose not supported",n.count);else if(n instanceof Array)for(const i of n)i instanceof Ft&&Zi(i);else if(n instanceof Ft){r0(n);for(const s of Object.keys(n)){const r=n[s];r instanceof Vt&&(Zi(r),n[s]=null)}const i=n.uniforms;if(i)for(const s of Object.keys(i)){const r=i[s];r instanceof Vt?(Zi(r),i[s]=null):r instanceof Ce&&(Zi(r.value),r.value=null)}}else n instanceof Vt?(r0(n),r0(n.source),((e=n.source)==null?void 0:e.data)instanceof ImageBitmap&&r0(n.source.data)):n instanceof xv?(r0(n.boneTexture),n.boneTexture=null):n instanceof zp||!(n instanceof ye)&&wm&&console.warn("Unknown object type",n)}}function r0(n){n&&((wm||m9()||WS)&&console.warn("\u{1F9E8} FREE",n),n instanceof ImageBitmap?n.close():n instanceof ch?n.data=null:n.dispose())}function v9(n){(n instanceof pe||n instanceof Eo)&&(n.material=null,n.geometry=null)}const ame=new Set;function RB(n,e,i=null,s){if(s||(s=ame,s.clear()),!n)return s;const r=n[Gb];if(r)for(const o of r)s.has(o)||i?.call(null,o)!==!1&&(s.add(o),e&&RB(o,!0,i,s));return s}function lme(n){return n[zb]}const wm=te("debugresourceusers")||te("debugmemory"),Gb=Symbol("needle-resource-users"),zb=Symbol("needle-resource-users-count");function co(n,e){D_(n,e,function(i,s){xm&&!NS.raycasting&&(HS(Gb,this,i,!1),HS(Gb,this,s,!0))})}xm&&(co(pe.prototype,"material"),co(pe.prototype,"geometry"),co(Ft.prototype,"map"),co(Ft.prototype,"bumpMap"),co(Ft.prototype,"alphaMap"),co(Ft.prototype,"normalMap"),co(Ft.prototype,"displacementMap"),co(Ft.prototype,"roughnessMap"),co(Ft.prototype,"metalnessMap"),co(Ft.prototype,"emissiveMap"),co(Ft.prototype,"specularMap"),co(Ft.prototype,"envMap"),co(Ft.prototype,"lightMap"),co(Ft.prototype,"aoMap"),co(Ft.prototype,"gradientMap"));function cme(n){if(xm===!1)return;const e=n[Gb];if(e)for(const i of e)HS(Gb,i,n,!1)}xm&&D_(Ft.prototype,"dispose",function(){cme(this)});let IB=0;function HS(n,e,i,s){if(IB>0)return;if(Array.isArray(i)){for(const o of i)HS(n,e,o,s);return}if(!i)return;let r=i[n];if(r||(r=new Set),s){if(e&&!r.has(e)){r.add(e);let o=i[zb]||0;o+=1,i[zb]=o,wm&&console.warn(`\u{1F7E2} Added user of "${i.type}"`,e,i,o,"users:",r)}}else if(e&&r.has(e)){r.delete(e);let o=i[zb]||0;o>0&&(o-=1,i[zb]=o),wm&&console.warn(`\u{1F534} Removed user of "${i.type}"`,e,i,o,"users:",r),o<=0&&(EB.isLoading(i)||(WS&&console.warn(`\u{1F534} Removed all user of "${i.type}"`,i),m9()&&Zi(i)))}i[n]=r}try{D_(gh.prototype,"render",function(){IB++},function(){IB--})}catch(n){console.warn("Could not wrap WebGLRenderer.render",n)}var Fb=(n=>(n.Added="component-added",n.Removing="removing-component",n))(Fb||{});const b9=te("debugcomponentevents");class Nb{static addComponentLifecylceEventListener(e,i){this.eventListeners.has(e)&&this.eventListeners.set(e,[]);let s=this.eventListeners.get(e);s||(s=[]),s.push(i),this.eventListeners.set(e,s),b9&&console.log("Added event listener for "+e,this.eventListeners)}static removeComponentLifecylceEventListener(e,i){const s=this.eventListeners.get(e);if(!s)return;const r=s.indexOf(i);r<0||s.splice(r,1)}static dispatchComponentLifecycleEvent(e,i){const s=this.eventListeners.get(e);if(b9&&console.log("Dispatching event "+e,s),!!s)for(const r of s)r(i)}}p(Nb,"eventListeners",new Map);const Ub=Symbol("NEEDLE_NEED_UPDATE_INSTANCE"),A9=Symbol("isUsingInstancing"),x9=Symbol("instancingRenderer"),Vb=Symbol("instancingAutoUpdateBounds");class hl{static isUsingInstancing(e){return e[A9]===!0}static getRenderer(e){return e[x9]||null}setAutoUpdateBounds(e,i){const s=hl.getRenderer(e);s&&(s[Vb]=i)}static markDirty(e,i=!0){if(e&&(this.isUsingInstancing(e)&&(e[Ub]=!0,e.matrixWorldNeedsUpdate=!0),i))for(const s of e.children)hl.markDirty(s,!0)}}function o0(n,e){try{e?n(e):n()}catch(i){return console.error(i),!1}return!0}const LB=te("debugnewscripts"),hme=te("debughierarchy"),vn=[];function ume(){return vn.length>0}function jS(n){if(!(n.new_scripts.length<=0)){if(LB&&console.log("Register new components",n.new_scripts.length,[...n.new_scripts],n.alias?"element: "+n.alias:n.hash,n),n.new_scripts_pre_setup_callbacks.length>0){for(const e of n.new_scripts_pre_setup_callbacks)e&&e();n.new_scripts_pre_setup_callbacks.length=0}vn.length=0,n.new_scripts.length>0&&vn.push(...n.new_scripts),n.new_scripts.length=0;for(let e=0;e<vn.length;e++)try{const i=vn[e];if(i.isComponent!==!0){(Ye()||LB)&&console.error(`Registered script is not a Needle Engine component. 
The script will be ignored. Please make sure your component extends "Behaviour" imported from "@needle-tools/engine"
`,i),vn.splice(e,1),e--;continue}if(i.destroyed)continue;if(!i.gameObject){console.warn(`Component can not be initialized: no GameObject assigned.
Did you add and remove a component in the same frame?`),vn.splice(e,1),e--;continue}i.context=n,Xb(i.gameObject),PB(i,n)}catch(i){console.error(i),Nh(vn[e],n),vn.splice(e,1),e--}for(let e=0;e<vn.length;e++)try{const i=vn[e];if(i.destroyed){Nh(vn[e],n),vn.splice(e,1),e--;continue}if(i.registering)try{i.registering()}catch(s){console.error(s)}i.__internalAwake!==void 0&&(i.gameObject||console.error("Calling awake for a component without a GameObject",i,i.gameObject),Xb(i.gameObject),i.activeAndEnabled&&o0(i.__internalAwake.bind(i)))}catch(i){console.error(i),Nh(vn[e],n),vn.splice(e,1),e--}for(let e=0;e<vn.length;e++)try{const i=vn[e];if(i.destroyed||i.enabled===!1||(Xb(i.gameObject),i.activeAndEnabled===!1))continue;i.__internalEnable!==void 0&&(i.enabled=!0,o0(i.__internalEnable.bind(i)))}catch(i){console.error(i),Nh(vn[e],n),vn.splice(e,1),e--}for(let e=0;e<vn.length;e++)try{const i=vn[e];if(i.destroyed||!i.gameObject)continue;n.new_script_start.push(i)}catch(i){console.error(i),Nh(vn[e],n),vn.splice(e,1),e--}vn.length=0;for(const e of n.new_scripts_post_setup_callbacks)e&&e();n.new_scripts_post_setup_callbacks.length=0}}function dme(n){n&&(n.__internalDisable(!0),Nh(n,n.context))}function w9(n,e){for(let i=0;i<n.new_script_start.length;i++)try{const s=n.new_script_start[i];if(e!==void 0&&s.gameObject!==e||s.destroyed||s.activeAndEnabled===!1)continue;o0(s.__internalAwake.bind(s)),s.enabled&&(o0(s.__internalEnable.bind(s)),o0(s.__internalStart.bind(s)),n.new_script_start.splice(i,1),i--)}catch(s){console.error(s),Nh(n.new_script_start[i],n),n.new_script_start.splice(i,1),i--}}function PB(n,e){e.scripts.indexOf(n)===-1&&(e.scripts.push(n),n.earlyUpdate&&e.scripts_earlyUpdate.push(n),n.update&&e.scripts_update.push(n),n.lateUpdate&&e.scripts_lateUpdate.push(n),n.onBeforeRender&&e.scripts_onBeforeRender.push(n),n.onAfterRender&&e.scripts_onAfterRender.push(n),n.onPausedChanged&&e.scripts_pausedChanged.push(n),BB(n,null)&&e.new_scripts_xr.push(n),BB(n,"immersive-vr")&&e.scripts_immersive_vr.push(n),BB(n,"immersive-ar")&&e.scripts_immersive_ar.push(n))}function Nh(n,e){Xa(n,e.new_scripts),Xa(n,e.new_script_start),Xa(n,e.scripts),Xa(n,e.scripts_earlyUpdate),Xa(n,e.scripts_update),Xa(n,e.scripts_lateUpdate),Xa(n,e.scripts_onBeforeRender),Xa(n,e.scripts_onAfterRender),Xa(n,e.scripts_pausedChanged),Xa(n,e.new_scripts_xr),Xa(n,e.scripts_immersive_vr),Xa(n,e.scripts_immersive_ar),e.stopAllCoroutinesFrom(n)}function Xa(n,e){const i=e.indexOf(n);i>=0&&e.splice(i,1)}function BB(n,e){var i;if(n){const s=n;if(s.onBeforeXR||s.onEnterXR||s.onUpdateXR||s.onLeaveXR||s.onXRControllerAdded||s.onXRControllerRemoved)return!(e!=null&&((i=s.supportsXR)==null?void 0:i.call(s,e))===!1)}return!1}function QS(n){if(n||(n=yi.Current.scene),!n){console.trace("Invalid call - no current context.");return}const e=c0(n);_9(n,e,!0)||(LB||Ye()?console.error(`Error updating hierarchy
Do you have circular references in your project? <a target="_blank" href="https://docs.needle.tools/circular-reference"> Click here for more information.`,n):console.error('Failed to update active state in hierarchy of "'+n.name+'"',n),console.warn(" \u2191 this error might be caused by circular references. Please make sure you don't have files with circular references (e.g. one GLB 1 is loading GLB 2 which is then loading GLB 1 again)."))}function _9(n,e,i,s=0){if(s>1e3)return console.warn("Hierarchy is too deep (> 1000 level) - will abort updating active state"),!1;const r=c0(n);if(e&&(e=r,e&&n.parent)){const l=n.parent;e=l[_h],e===void 0&&(l instanceof Ls||(e=!0))}const o=n[_h]!==e;n[_h]=e,o&&(hme&&console.warn("ACTIVE CHANGE",n.name,r,n.visible,e,"changed?"+o,n),i&&pme(n,l=>{e?l.enabled&&(o0(l.__internalAwake.bind(l)),l.enabled&&(l.__didEnable=!0,l.onEnable())):l.__didAwake&&l.enabled&&(l.__didEnable=!1,l.onDisable())}));let a=!0;if(n.children){const l=s+1;for(const c of n.children)_9(c,e,i,l)===!1&&(a=!1)}return a}function Xb(n){let e=!0,i=n,s=!1;for(;i&&i;){if(i.type==="Scene"&&(s=!0),!c0(i)){e=!1;break}i=i.parent}if(!n){console.error("GO is null");return}n[_h]=e&&s}function pme(n,e){var i;if((i=n.userData)!=null&&i.components)for(const s of n.userData.components)e(s)}const ZS=new Map,S9=Symbol("prewarmFlag"),kB=Symbol("waitingForPrewarm"),DB=te("debugprewarm");function mme(n,e){!n||n[S9]===!0||n[kB]===!0||(ZS.has(e)||ZS.set(e,[]),n[kB]=!0,ZS.get(e).push(n),DB&&console.debug("register prewarm",n.name))}let OB=null,GB=null;function fme(n){if(!n)return;const e=ZS.get(n);if(!(e!=null&&e.length))return;const i=n.mainCamera;if(i){DB&&console.log("prewarm",e.length,"objects",[...e]);const s=n.renderer;if(s.compile){const r=n.scene;s.compile(r,i),OB??(OB=new i2(64)),GB??(GB=new t2(.001,9999999,OB)),GB.update(s,r);for(const o of e)o[S9]=!0,o[kB]=!1;e.length=0,DB&&console.log("prewarm done")}}}const gme=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function yme(n){return typeof n=="string"&&gme.test(n)}const ir=[];for(let n=0;n<256;++n)ir.push((n+256).toString(16).slice(1));function vme(n,e=0){return ir[n[e+0]]+ir[n[e+1]]+ir[n[e+2]]+ir[n[e+3]]+"-"+ir[n[e+4]]+ir[n[e+5]]+"-"+ir[n[e+6]]+ir[n[e+7]]+"-"+ir[n[e+8]]+ir[n[e+9]]+"-"+ir[n[e+10]]+ir[n[e+11]]+ir[n[e+12]]+ir[n[e+13]]+ir[n[e+14]]+ir[n[e+15]]}function bme(n){if(!yme(n))throw TypeError("Invalid UUID");let e;const i=new Uint8Array(16);return i[0]=(e=parseInt(n.slice(0,8),16))>>>24,i[1]=e>>>16&255,i[2]=e>>>8&255,i[3]=e&255,i[4]=(e=parseInt(n.slice(9,13),16))>>>8,i[5]=e&255,i[6]=(e=parseInt(n.slice(14,18),16))>>>8,i[7]=e&255,i[8]=(e=parseInt(n.slice(19,23),16))>>>8,i[9]=e&255,i[10]=(e=parseInt(n.slice(24,36),16))/1099511627776&255,i[11]=e/4294967296&255,i[12]=e>>>24&255,i[13]=e>>>16&255,i[14]=e>>>8&255,i[15]=e&255,i}function Ame(n){n=unescape(encodeURIComponent(n));const e=[];for(let i=0;i<n.length;++i)e.push(n.charCodeAt(i));return e}const xme="6ba7b810-9dad-11d1-80b4-00c04fd430c8",wme="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function _me(n,e,i){function s(r,o,a,l){var c;if(typeof r=="string"&&(r=Ame(r)),typeof o=="string"&&(o=bme(o)),((c=o)===null||c===void 0?void 0:c.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let h=new Uint8Array(16+r.length);if(h.set(o),h.set(r,o.length),h=i(h),h[6]=h[6]&15|e,h[8]=h[8]&63|128,a){l=l||0;for(let u=0;u<16;++u)a[l+u]=h[u];return a}return vme(h)}try{s.name=n}catch{}return s.DNS=xme,s.URL=wme,s}function Sme(n,e,i,s){switch(n){case 0:return e&i^~e&s;case 1:return e^i^s;case 2:return e&i^e&s^i&s;case 3:return e^i^s}}function zB(n,e){return n<<e|n>>>32-e}function Cme(n){const e=[1518500249,1859775393,2400959708,3395469782],i=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof n=="string"){const a=unescape(encodeURIComponent(n));n=[];for(let l=0;l<a.length;++l)n.push(a.charCodeAt(l))}else Array.isArray(n)||(n=Array.prototype.slice.call(n));n.push(128);const s=n.length/4+2,r=Math.ceil(s/16),o=new Array(r);for(let a=0;a<r;++a){const l=new Uint32Array(16);for(let c=0;c<16;++c)l[c]=n[a*64+c*4]<<24|n[a*64+c*4+1]<<16|n[a*64+c*4+2]<<8|n[a*64+c*4+3];o[a]=l}o[r-1][14]=(n.length-1)*8/Math.pow(2,32),o[r-1][14]=Math.floor(o[r-1][14]),o[r-1][15]=(n.length-1)*8&4294967295;for(let a=0;a<r;++a){const l=new Uint32Array(80);for(let f=0;f<16;++f)l[f]=o[a][f];for(let f=16;f<80;++f)l[f]=zB(l[f-3]^l[f-8]^l[f-14]^l[f-16],1);let c=i[0],h=i[1],u=i[2],d=i[3],m=i[4];for(let f=0;f<80;++f){const g=Math.floor(f/20),y=zB(c,5)+Sme(g,h,u,d)+m+e[g]+l[f]>>>0;m=d,d=u,u=zB(h,30)>>>0,h=c,c=y}i[0]=i[0]+c>>>0,i[1]=i[1]+h>>>0,i[2]=i[2]+u>>>0,i[3]=i[3]+d>>>0,i[4]=i[4]+m>>>0}return[i[0]>>24&255,i[0]>>16&255,i[0]>>8&255,i[0]&255,i[1]>>24&255,i[1]>>16&255,i[1]>>8&255,i[1]&255,i[2]>>24&255,i[2]>>16&255,i[2]>>8&255,i[2]&255,i[3]>>24&255,i[3]>>16&255,i[3]>>8&255,i[3]&255,i[4]>>24&255,i[4]>>16&255,i[4]>>8&255,i[4]&255]}const Mme=_me("v5",80,Cme),C9=Mme;yi.registerCallback(wi.ContextCreated,n=>{const e=n.context;I9(e),T9(e)});const YS=te("debugcomponents"),M9="eff8ba80-635d-11ec-90d6-0242ac120003";class Es{constructor(e){p(this,"_originalSeed"),p(this,"_seed"),typeof e=="string"&&(e=Es.hash(e)),this._originalSeed=e,this._seed=e}get seed(){return this._seed}set seed(e){this._seed=e}reset(){this._seed=this._originalSeed}generateUUID(e){if(typeof e=="string")return C9(e,M9);const i=this._seed;return this._seed-=1,C9(i.toString(),M9)}initialize(e){typeof e=="string"?this._seed=Es.hash(e):this._seed=e}static createFromString(e){return new Es(this.hash(e))}static hash(e){let i=0;for(let s=0;s<e.length;s++)i=e.charCodeAt(s)+((i<<5)-i);return i}}var E9=(n=>(n.NewInstanceCreated="new-instance-created",n.InstanceDestroyed="instance-destroyed",n))(E9||{});class Eme{constructor(e){p(this,"guid"),p(this,"dontSave"),this.guid=e}}function Wb(n,e,i=!0,s){if(!n)return;const r=n;if(ia(n,i),!e){console.warn("Can not send destroy: No networking connection provided",n.guid);return}if(!e.isConnected){Ye()&&console.debug("Can not send destroy: not connected",n.guid);return}let o=n.guid;if(!o&&r.uuid&&(o=r.uuid),!o){console.warn("Can not send destroy: failed to find guid",n);return}FB(o,e,s)}function FB(n,e,i){const s=new Eme(n);i?.saveInRoom===!1&&(s.dontSave=!0),e.send("instance-destroyed",s,Pl.Queued)}function T9(n){n.connection.beginListen("instance-destroyed",e=>{YS&&console.log("[Remote] Destroyed",n.scene,e);const i=tA(e.guid,n.scene);i&&ia(i)})}class Tme{constructor(e,i,s){p(this,"filename"),p(this,"hash"),p(this,"size"),this.filename=e,this.hash=i,this.size=s}}class R9{constructor(e,i){p(this,"guid"),p(this,"originalGuid"),p(this,"seed"),p(this,"visible"),p(this,"hostData"),p(this,"dontSave"),p(this,"parent"),p(this,"position"),p(this,"rotation"),p(this,"scale"),p(this,"preventCreation"),p(this,"deleteStateOnDisconnect"),this.originalGuid=e,this.guid=i}}function NB(n,e,i,s){var r,o;const a=n;if(!a.guid)return console.warn("Can not instantiate: No guid",a),null;if(e.context||(e.context=Pt.Current),!e.context)return console.error("Missing network instantiate options / reference to network connection in sync instantiate"),null;const l=e?{...e}:null,{instance:c,seed:h}=Rme(a,e);if(c){const u=c;if(u.guid){YS&&console.log("[Local] new instance","gameobject:",c?.guid);const d=new R9(a.guid,u.guid);d.seed=h,e.deleteOnDisconnect===!0&&(d.deleteStateOnDisconnect=!0),l&&(l.position&&(d.position={x:l.position.x,y:l.position.y,z:l.position.z}),l.rotation&&(d.rotation={x:l.rotation.x,y:l.rotation.y,z:l.rotation.z,w:l.rotation.w}),l.scale&&(d.scale={x:l.scale.x,y:l.scale.y,z:l.scale.z})),d.position||(d.position={x:u.position.x,y:u.position.y,z:u.position.z}),d.rotation||(d.rotation={x:u.quaternion.x,y:u.quaternion.y,z:u.quaternion.z,w:u.quaternion.w}),d.scale||(d.scale={x:u.scale.x,y:u.scale.y,z:u.scale.z}),d.visible=a.visible,l!=null&&l.parent&&(typeof l.parent=="string"?d.parent=l.parent:d.parent=l.parent.guid),d.hostData=i,s===!1&&(d.dontSave=!0),!((r=e?.context)!=null&&r.connection)&&Ye()&&console.debug("Object will be instantiated but it will not be synced: not connected",a.guid),(o=e?.context)==null||o.connection.send("new-instance-created",d)}else console.warn("Missing guid, can not send new instance event",u)}return c}function KS(){return Math.random()*9999999}function I9(n){n.connection.beginListen("new-instance-created",async e=>{const i=await Ime(e.originalGuid,n.scene);if(e.preventCreation===!0)return;if(!i){console.warn("could not find object that was instantiated: "+e.guid);return}const s=new Jl;e.position&&(s.position=new E(e.position.x,e.position.y,e.position.z)),e.rotation&&(s.rotation=new Se(e.rotation.x,e.rotation.y,e.rotation.z,e.rotation.w)),e.scale&&(s.scale=new E(e.scale.x,e.scale.y,e.scale.z)),s.parent=e.parent,e.seed&&(s.idProvider=new Es(e.seed)),s.visible=e.visible,s.context=n,YS&&n.alias&&console.log("[Remote] instantiate in: "+n.alias);const r=h0(i,s);r&&(e.parent==="scene"&&n.scene.add(r),YS&&console.log("[Remote] new instance","gameobject:",r?.guid,i))})}function Rme(n,e){const i=KS(),s=e??new Jl;s.idProvider=new Es(i);const r=h0(n,s);return{seed:i,instance:r}}const L9={};function P9(n,e){L9[n]=e}async function Ime(n,e){const i=L9[n];if(i!=null){const s=await i(n);if(s)return s}return B9(n,e)}function B9(n,e){if(e===null||!n)return null;if(e.guid===n)return e;if(e.children)for(const i of e.children){const s=B9(n,i);if(s)return s}return null}const Hb=te("gizmos"),Os=te("debugextension"),UB=te("debugtypes");class Lme{constructor(){p(this,"_types",new Map),UB&&console.warn("TypeStore: Created",this)}add(e,i){UB&&console.warn("ADD TYPE",e);const s=this._types.get(e);s?UB&&s!==i&&console.warn("Type name exists multiple times in your project and may lead to runtime errors:",e):this._types.set(e,i)}get(e){return this._types.get(e)||null}getKey(e){for(const[i,s]of this._types)if(s===e)return i;return null}}const Pme=Symbol("BuiltInType"),Z=new Lme,Bme=function(n){Z.get(n.name)||Z.add(n.name,n)},VB=te("debugresolvedependencies"),kme=["/extensions/","extensions/"],Dme=[{prefix:"/nodes/",dependencyName:"node"},{prefix:"/meshes/",dependencyName:"mesh"},{prefix:"/materials/",dependencyName:"material"},{prefix:"/textures/",dependencyName:"texture"},{prefix:"/animations/",dependencyName:"animation"},{prefix:"nodes/",dependencyName:"node"},{prefix:"meshes/",dependencyName:"mesh"},{prefix:"materials/",dependencyName:"material"},{prefix:"textures/",dependencyName:"texture"},{prefix:"animations/",dependencyName:"animation"}];async function XB(n,e){VB&&console.log(n,e);const i=[];WB(Dme,n,e,i);const s=await Promise.all(i);return typeof e=="string"&&s.length===1?s[0]:s}function k9(n,e){return!n||!e?!1:n["needle:identifier"]!=null&&e["needle:identifier"]!=null?n["needle:identifier"]===e["needle:identifier"]:!1}function Ome(n,e){n["needle:identifier"]=e}function WB(n,e,i,s){if(typeof i=="object"&&i!==void 0&&i!==null)for(const r of Object.keys(i)){const o=i[r];if(typeof o=="string"){const a=D9(e,o);if(a!=null)typeof a.then=="function"?s.push(a.then(l=>i[r]=l)):i[r]=a;else{const l=O9(n,e,o);if(l){s.push(l.then(c=>(i[r]=c,c)));continue}}}else if(Array.isArray(o))for(let a=0;a<o.length;a++){const l=o[a],c=D9(e,l);if(c!==null){typeof c.then=="function"?s.push(c.then(h=>o[a]=h)):o[a]=c;continue}for(const h of n){const u=G9(h.prefix,l);if(u>=0){VB&&console.log(h,u,h.dependencyName),s.push(e.getDependency(h.dependencyName,u).then(d=>o[a]=d));break}}typeof l=="object"&&WB(n,e,l,s)}else typeof o=="object"&&WB(n,e,o,s)}else if(typeof i=="string"){const r=O9(n,e,i);r&&s.push(r)}}function D9(n,e){if(n&&n.plugins&&typeof e=="string"){for(const i of kme)if(e.startsWith(i)){let s=e.substring(i.length);const r=s.indexOf("/");r>=0&&(s=s.substring(0,r));const o=n.plugins[s];if(Os&&console.log(s,o),typeof o?.resolve=="function"){const a=e.substring(i.length+s.length+1);return o.resolve(n,a)}break}}return null}function O9(n,e,i){for(const s of n){const r=G9(s.prefix,i);if(r>=0)return VB&&console.warn("GET DEPENDENCY",s,r,s.dependencyName),e.getDependency(s.dependencyName,r)}return null}function G9(n,e){if(typeof e=="string"&&e.startsWith(n)){const i=e.substring(n.length),s=Number.parseInt(i);if(s>=0)return s}return-1}const HB="NEEDLE_persistent_assets";function Gme(n){return n?.___persistentAsset===!0}class zme{constructor(e){p(this,"parser"),this.parser=e}get name(){return HB}async afterRoot(e){var i,s;if(!((s=(i=this.parser)==null?void 0:i.json)!=null&&s.extensions))return;const r=this.parser.json.extensions[HB];if(!r)return;Os&&console.log(r);const o=new Array;for(const a of r?.assets){const l=XB(this.parser,a);l&&o.push(l)}await Promise.all(o)}resolve(e,i){const s=Number.parseInt(i);if(s>=0){Os&&console.log(i);const r=e.json.extensions[HB];if(r){const o=r?.assets[s];if(o&&typeof o=="object"){o.___persistentAsset=!0;const a=o.__type;a&&Z.get(a)}return o}}return null}}const vc=te("debugserializer");class Fme{constructor(){p(this,"typeMap",new Map)}register(e,i){if(this.typeMap.has(e)){const s=this.typeMap.get(e);if(s===i)return;vc&&console.warn("Type: "+e+" is already registered",i,s)}vc&&console.log("Register type serializer",i.name,i,e),this.typeMap.set(e,i)}getSerializer(e){if(e)return this.typeMap.get(e)}getSerializerForConstructor(e,i=0){if(i>20)return;if(!e||!e.constructor){vc&&console.log("invalid type");return}const s=e.name,r=this.getSerializer(e);if(r!==void 0)return vc&&console.log("FOUND SERIALIZER",r?.name,e.name,e.constructor.name,"for type: "+s,r,e,this.typeMap),r;const o=Object.getPrototypeOf(e);if(o&&o!==e){const a=this.getSerializerForConstructor(o,++i);if(a){const l=o.constructor||o.prototype;vc&&console.log("FOUND SERIALIZER(in constructor) "+l.constructor.name,l.name,l,a),this.register(l,a)}return a}vc&&console.warn("No serializer found for "+s,e,e.name,e.constructor.name)}}const JS=new Fme;class Wa{constructor(e,i){if(p(this,"name"),this.name=i,Array.isArray(e))for(const s of e)JS.register(s,this);else JS.register(e,this)}}class Nme{constructor(){p(this,"isDevMode",no()),p(this,"cache",{})}registerDefinedKeys(e,i){if(this.isDevMode&&this.cache[e]===void 0){this.cache[e]=Object.keys(i);const s=i;s.$serializedTypes&&Object.keys(s.$serializedTypes)&&this.cache[e].push(...Object.keys(s.$serializedTypes)),vc&&console.log("registerDefinedKeys for "+e,this.cache[e],i)}}getDefinedKey(e,i){return this.cache[e]===void 0?!1:this.cache[e].includes(i)}}class jB{constructor(e){p(this,"root"),p(this,"gltf"),p(this,"gltfId"),p(this,"object"),p(this,"target"),p(this,"nodeId"),p(this,"nodeToObject"),p(this,"objectToNode"),p(this,"context"),p(this,"path"),p(this,"type"),p(this,"serializable"),p(this,"implementationInformation"),this.root=e}}function z9(n,e){const i=n.$serializedTypes;if(i===void 0)return null;const s={};for(const r in i){const o=n[r];if(o!=null&&typeof o=="object"){const a=JS.getSerializerForConstructor(o);if(a){s[r]=a.onSerialize(o,e);continue}}s[r]=o}return s.name=n.constructor.name,typeof n.guid=="string"&&(s.guid=n.guid),s}const qS=[];function F9(n,e){if(!n)return e;typeof n.$serializedTypes=="object"&&(e||(e={}),Object.assign(e,n.$serializedTypes));const i=Object.getPrototypeOf(n);return F9(i,e)}function $S(n,e,i){if(!n)return!1;if(i.target=n,n.onBeforeDeserialize!==void 0){const r=n.onBeforeDeserialize(e,i);if(typeof r=="boolean")return r}const s=F9(n);if(e){if(typeof e.guid=="string"&&(n.guid=e.guid),s)for(const r in s){let o=function(c){const h=c.type;return h?QB(l,h,i,void 0,n[r]):QB(l,c,i,void 0,n[r])};const a=s[r],l=e[r];if(vc&&console.log(r,l,n,a),!(n[r]!==void 0&&l===void 0)&&(i.type=void 0,i.path=r,i.serializable=a,!(n.onBeforeDeserializeMember!==void 0&&n.onBeforeDeserializeMember(r,l,i)===!0))){if(a===null)n[r]=l;else{if(Array.isArray(a))for(let c=0;c<a.length;c++){const h=a[c],u=o(h);if(u!==void 0||c===a.length-1){n[r]=u;break}}else n[r]=o(a);qS.length=0}n.onAfterDeserializeMember!==void 0&&n.onAfterDeserializeMember(r,l,i)}}Xme(n,e)}return Vme(n,e,i.implementationInformation),n.onAfterDeserialize!==void 0&&n.onAfterDeserialize(e,i),!0}const Ume=te("noerrors");function Vme(n,e,i){var s,r;if(Ume||!e||!no()||!n||n.constructor&&n.constructor[Pme]===!0)return;const o=(s=n.constructor)==null?void 0:s.name,a=Object.getOwnPropertyNames(e);for(const l of a){if(l==="sourceId")continue;const c=n[l];if(c==null)continue;const h=e[l];if(i?.getDefinedKey(o,l)===!1){const u=l.charAt(0).toUpperCase()+l.slice(1);i.getDefinedKey(o,u)&&(ac(Zo.Warn,'<strong>Please rename</strong> "'+u+'" to "'+l+'" in '+o),console.warn('Please use lowercase for field: "'+u+'" in '+o,h,n));continue}if(h!=null){if(typeof h=="object"&&(c===void 0||!c.isObject3D)){if(typeof h.node=="number"||typeof h.guid=="string"){if(h.could_not_resolve)continue;if(!(c!==void 0&&Object.keys(c).length>1)){ac(Zo.Warn,`<strong>Missing serialization for object reference!</strong>

Please change to: 
@serializable(Object3D)
${l}? : Object3D;

in script ${o}.ts
<a href="https://docs.needle.tools/serializable" target="_blank">documentation</a>`),console.warn(o,l,n[l],n);continue}}else if(!Array.isArray(c)){const u=(r=c.constructor)==null?void 0:r.name;if(u==="Object"&&!c.constructor["did_warn:missing_serializable"]){c.constructor["did_warn:missing_serializable"]=!0;const d='You might be missing a @serializable(Type) decorator for field "'+l+'" in '+o+".ts";console.warn(d+`
${l}:`,h,u),ac(Zo.Warn,"Dev Warning: Are you missing a type in @serializable? Please check the browser console for details")}}}if(typeof c=="string"&&typeof h=="string"&&(h.endsWith(".gltf")||h.endsWith(".glb"))){ac(Zo.Warn,`<strong>Missing serialization for object reference!</strong>

Please change to: 
@serializable(AssetReference)
${l}? : AssetReference;

in script ${o}.ts
<a href="https://docs.needle.tools/serializable" target="_blank">documentation</a>`),console.warn(o,l,n[l],n);continue}}}}function Xme(n,e){for(const i of Object.keys(e)){const s=e[i];if(typeof s=="object"&&s!==null&&s!==void 0){const r=n[i];if(!r){vc&&console.log(i,"is undefined on",n);continue}for(const o of Object.keys(s))if(r[o]===void 0&&N9(s[o])&&!N9(r)){const a=Wme(r,o);if(a&&(a?.writable===void 0||a?.writable===!1)&&a.set===void 0){vc&&console.warn('Property is not writable "'+o+'"',r,a,s[o],r[o]);continue}r[o]=s[o]}}}}function Wme(n,e){for(;n;){const i=Object.getOwnPropertyDescriptor(n,e);if(i)return i;n=Object.getPrototypeOf(n)}}function N9(n){switch(typeof n){case"number":case"string":case"boolean":return!0}return!1}function QB(n,e,i,s,r){let o=typeof e=="function"&&e.prototype===void 0,a=e;if(o)try{if(a=e?.call(e,r),o=!1,a==null)return}catch(u){console.error("Error in callback",u,n)}if(i.type=a,!o&&r instanceof a)return r;if(s||(s={serializer:JS.getSerializerForConstructor(a)}),r&&typeof r=="object"&&Gme(r)){if(r.__concreteInstance)return r.__concreteInstance;const u=r;if(!u.$serializedTypes&&a.prototype.$serializedTypes&&(u.$serializedTypes=a.prototype.$serializedTypes),u.$serializedTypes&&$S(u,n,i),r&&a!==void 0)try{let d=null;s.serializer&&(d=s.serializer.onDeserialize(n,i)),d||(d=new a,Os&&console.log("Create concrete instance for persistent asset",r,"instance:",d),a0(d,r)),r.__concreteInstance=d,r=d}catch(d){console.error("Error creating instance or creating values on instance",d,r,a)}return r}if(Array.isArray(n)){const u=[];for(let d=0;d<n.length;d++){const m=n[d],f=QB(m,e,i,s,m);u.push(f)}return u}const l=s?.serializer;if(l)return l.onDeserialize(n,i);let c;if(n&&(n.isMaterial||n.isTexture||n.isObject3D||n instanceof to))c=n;else{if(n===void 0)return;if(n===null&&(a===Ft||a===Vt||a===pe||a===to))return null;try{c=new a(...Hme(n))}catch(u){console.error("Error creating "+i.path,i.target,u);return}}const h=c;return h.$serializedTypes&&$S(h,n,i),c}function Hme(n){if(qS.length=0,typeof n=="object"&&n!==null&&n!==void 0)for(const e of Object.keys(n))qS.push(n[e]);return qS}const ZB=Symbol("assigned component properties");function a0(n,e,i){var s;if(e==null||n==null)return;n[ZB]=!0;const r=((s=n.constructor)==null?void 0:s.name)??"unknown";i?.registerDefinedKeys(r,n);for(const o of Object.keys(e)){const a=jme(n,o);typeof a?.value!="function"&&(!a||a.writable===!0||a?.set!==void 0)&&(n[o]=e[o])}delete n[ZB]}function jme(n,e){let i;do i=Object.getOwnPropertyDescriptor(n,e);while(!i&&(n=Object.getPrototypeOf(n)));return i}const U9=Symbol("customVisibilityFlag");function md(n,e){n.layers[U9]=e}const V9=Symbol("DidPatchLayers");function Qme(){const n=Mr.prototype;if(n[V9])return;n[V9]=!0;const e=n.test;n.test=function(i){return this[U9]===!1?!1:e.call(this,i)}}Qme(),Object.defineProperty(Lt.prototype,"fov",{get:function(){return this._fov},set:function(n){const e=n!==this._fov;this._fov=n,e&&this.view!==void 0&&this.updateProjectionMatrix()},configurable:!0}),Object.defineProperty(Lt.prototype,"near",{get:function(){return this._near},set:function(n){const e=n!==this._near;this._near=n,e&&this.view!==void 0&&this.updateProjectionMatrix()},configurable:!0}),Object.defineProperty(Lt.prototype,"far",{get:function(){return this._far},set:function(n){const e=n!==this._far;this._far=n,e&&this.view!==void 0&&this.updateProjectionMatrix()},configurable:!0});const X9=new Map;function W9(n,e){if(!n)return;if(!e){console.warn("No prototype found",n,n.prototype,n.constructor);return}const i=X9.get(e);i&&i.apply(n)}function H9(n){const e=Zme(n.prototype);X9.set(n,e)}function Zme(n){return new Yme(n)}class Yme{constructor(e){p(this,"$symbol"),p(this,"extensions"),p(this,"descriptors"),this.$symbol=Symbol("prototype-extension"),this.extensions=Object.keys(e),this.descriptors=new Array;for(let i=0;i<this.extensions.length;i++){const s=this.extensions[i],r=Object.getOwnPropertyDescriptor(e,s);r&&this.descriptors.push(r)}}apply(e){if(!e[this.$symbol]){e[this.$symbol]=!0;for(let i=0;i<this.extensions.length;i++){const s=this.extensions[i],r=this.descriptors[i];r&&Object.defineProperty(e,s,r)}}}}const _m=new Nu,zr=new E,fd=new E,bn=new Se,j9={X:new E(1,0,0),Y:new E(0,1,0),Z:new E(0,0,1)},YB={type:"change"},Q9={type:"mouseDown"},Z9={type:"mouseUp",mode:null},Y9={type:"objectChange"};class Kme extends ye{constructor(e,i){super(),i===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),i=document),this.isTransformControls=!0,this.visible=!1,this.domElement=i,this.domElement.style.touchAction="none";const s=new JB;this._gizmo=s,this.add(s);const r=new ife;this._plane=r,this.add(r);const o=this;function a(A,x){let w=x;Object.defineProperty(o,A,{get:function(){return w!==void 0?w:x},set:function(_){w!==_&&(w=_,r[A]=_,s[A]=_,o.dispatchEvent({type:A+"-changed",value:_}),o.dispatchEvent(YB))}}),o[A]=x,r[A]=x,s[A]=x}a("camera",e),a("object",void 0),a("enabled",!0),a("axis",null),a("mode","translate"),a("translationSnap",null),a("rotationSnap",null),a("scaleSnap",null),a("space","world"),a("size",1),a("dragging",!1),a("showX",!0),a("showY",!0),a("showZ",!0);const l=new E,c=new E,h=new Se,u=new Se,d=new E,m=new Se,f=new E,g=new E,y=new E,v=0,b=new E;a("worldPosition",l),a("worldPositionStart",c),a("worldQuaternion",h),a("worldQuaternionStart",u),a("cameraPosition",d),a("cameraQuaternion",m),a("pointStart",f),a("pointEnd",g),a("rotationAxis",y),a("rotationAngle",v),a("eye",b),this._offset=new E,this._startNorm=new E,this._endNorm=new E,this._cameraScale=new E,this._parentPosition=new E,this._parentQuaternion=new Se,this._parentQuaternionInv=new Se,this._parentScale=new E,this._worldScaleStart=new E,this._worldQuaternionInv=new Se,this._worldScale=new E,this._positionStart=new E,this._quaternionStart=new Se,this._scaleStart=new E,this._getPointer=Jme.bind(this),this._onPointerDown=$me.bind(this),this._onPointerHover=qme.bind(this),this._onPointerMove=efe.bind(this),this._onPointerUp=tfe.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;e!==null&&_m.setFromCamera(e,this.camera);const i=KB(this._gizmo.picker[this.mode],_m);i?this.axis=i.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e!=null&&e.button!==0)&&this.axis!==null){e!==null&&_m.setFromCamera(e,this.camera);const i=KB(this._plane,_m,!0);i&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(i.point).sub(this.worldPositionStart)),this.dragging=!0,Q9.mode=this.mode,this.dispatchEvent(Q9)}}pointerMove(e){const i=this.axis,s=this.mode,r=this.object;let o=this.space;if(s==="scale"?o="local":(i==="E"||i==="XYZE"||i==="XYZ")&&(o="world"),r===void 0||i===null||this.dragging===!1||e!==null&&e.button!==-1)return;e!==null&&_m.setFromCamera(e,this.camera);const a=KB(this._plane,_m,!0);if(a){if(this.pointEnd.copy(a.point).sub(this.worldPositionStart),s==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),o==="local"&&i!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),i.indexOf("X")===-1&&(this._offset.x=0),i.indexOf("Y")===-1&&(this._offset.y=0),i.indexOf("Z")===-1&&(this._offset.z=0),o==="local"&&i!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),r.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(o==="local"&&(r.position.applyQuaternion(bn.copy(this._quaternionStart).invert()),i.search("X")!==-1&&(r.position.x=Math.round(r.position.x/this.translationSnap)*this.translationSnap),i.search("Y")!==-1&&(r.position.y=Math.round(r.position.y/this.translationSnap)*this.translationSnap),i.search("Z")!==-1&&(r.position.z=Math.round(r.position.z/this.translationSnap)*this.translationSnap),r.position.applyQuaternion(this._quaternionStart)),o==="world"&&(r.parent&&r.position.add(zr.setFromMatrixPosition(r.parent.matrixWorld)),i.search("X")!==-1&&(r.position.x=Math.round(r.position.x/this.translationSnap)*this.translationSnap),i.search("Y")!==-1&&(r.position.y=Math.round(r.position.y/this.translationSnap)*this.translationSnap),i.search("Z")!==-1&&(r.position.z=Math.round(r.position.z/this.translationSnap)*this.translationSnap),r.parent&&r.position.sub(zr.setFromMatrixPosition(r.parent.matrixWorld))));else if(s==="scale"){if(i.search("XYZ")!==-1){let l=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(l*=-1),fd.set(l,l,l)}else zr.copy(this.pointStart),fd.copy(this.pointEnd),zr.applyQuaternion(this._worldQuaternionInv),fd.applyQuaternion(this._worldQuaternionInv),fd.divide(zr),i.search("X")===-1&&(fd.x=1),i.search("Y")===-1&&(fd.y=1),i.search("Z")===-1&&(fd.z=1);r.scale.copy(this._scaleStart).multiply(fd),this.scaleSnap&&(i.search("X")!==-1&&(r.scale.x=Math.round(r.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),i.search("Y")!==-1&&(r.scale.y=Math.round(r.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),i.search("Z")!==-1&&(r.scale.z=Math.round(r.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(s==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const l=20/this.worldPosition.distanceTo(zr.setFromMatrixPosition(this.camera.matrixWorld));let c=!1;i==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(zr.copy(this.rotationAxis).cross(this.eye))*l):(i==="X"||i==="Y"||i==="Z")&&(this.rotationAxis.copy(j9[i]),zr.copy(j9[i]),o==="local"&&zr.applyQuaternion(this.worldQuaternion),zr.cross(this.eye),zr.length()===0?c=!0:this.rotationAngle=this._offset.dot(zr.normalize())*l),(i==="E"||c)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),o==="local"&&i!=="E"&&i!=="XYZE"?(r.quaternion.copy(this._quaternionStart),r.quaternion.multiply(bn.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),r.quaternion.copy(bn.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),r.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(YB),this.dispatchEvent(Y9)}}pointerUp(e){e!==null&&e.button!==0||(this.dragging&&this.axis!==null&&(Z9.mode=this.mode,this.dispatchEvent(Z9)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(YB),this.dispatchEvent(Y9),this.pointStart.copy(this.pointEnd))}getRaycaster(){return _m}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function Jme(n){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:n.button};{const e=this.domElement.getBoundingClientRect();return{x:(n.clientX-e.left)/e.width*2-1,y:-(n.clientY-e.top)/e.height*2+1,button:n.button}}}function qme(n){if(this.enabled)switch(n.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(n));break}}function $me(n){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(n.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(n)),this.pointerDown(this._getPointer(n)))}function efe(n){this.enabled&&this.pointerMove(this._getPointer(n))}function tfe(n){this.enabled&&(this.domElement.releasePointerCapture(n.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(n)))}function KB(n,e,i){const s=e.intersectObject(n,!0);for(let r=0;r<s.length;r++)if(s[r].object.visible||i)return s[r];return!1}const eC=new si,Wi=new E(0,1,0),K9=new E(0,0,0),J9=new he,tC=new Se,iC=new Se,bc=new E,q9=new he,jb=new E(1,0,0),Sm=new E(0,1,0),Qb=new E(0,0,1),nC=new E,Zb=new E,Yb=new E;class JB extends ye{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new Qt({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=new Vi({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),s=e.clone();s.opacity=.15;const r=i.clone();r.opacity=.5;const o=e.clone();o.color.setHex(16711680);const a=e.clone();a.color.setHex(65280);const l=e.clone();l.color.setHex(255);const c=e.clone();c.color.setHex(16711680),c.opacity=.5;const h=e.clone();h.color.setHex(65280),h.opacity=.5;const u=e.clone();u.color.setHex(255),u.opacity=.5;const d=e.clone();d.opacity=.25;const m=e.clone();m.color.setHex(16776960),m.opacity=.25,e.clone().color.setHex(16776960);const f=e.clone();f.color.setHex(7895160);const g=new Yn(0,.04,.1,12);g.translate(0,.05,0);const y=new $i(.08,.08,.08);y.translate(0,.04,0);const v=new dt;v.setAttribute("position",new st([0,0,0,1,0,0],3));const b=new Yn(.0075,.0075,.5,3);b.translate(0,.25,0);function A(D,W){const O=new fu(D,.0075,3,64,W*Math.PI*2);return O.rotateY(Math.PI/2),O.rotateX(Math.PI/2),O}function x(){const D=new dt;return D.setAttribute("position",new st([0,0,0,1,1,1],3)),D}const w={X:[[new pe(g,o),[.5,0,0],[0,0,-Math.PI/2]],[new pe(g,o),[-.5,0,0],[0,0,Math.PI/2]],[new pe(b,o),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new pe(g,a),[0,.5,0]],[new pe(g,a),[0,-.5,0],[Math.PI,0,0]],[new pe(b,a)]],Z:[[new pe(g,l),[0,0,.5],[Math.PI/2,0,0]],[new pe(g,l),[0,0,-.5],[-Math.PI/2,0,0]],[new pe(b,l),null,[Math.PI/2,0,0]]],XYZ:[[new pe(new mu(.1,0),d.clone()),[0,0,0]]],XY:[[new pe(new $i(.15,.15,.01),u.clone()),[.15,.15,0]]],YZ:[[new pe(new $i(.15,.15,.01),c.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new pe(new $i(.15,.15,.01),h.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},_={X:[[new pe(new Yn(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new pe(new Yn(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new pe(new Yn(.2,0,.6,4),s),[0,.3,0]],[new pe(new Yn(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new pe(new Yn(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new pe(new Yn(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new pe(new mu(.2,0),s)]],XY:[[new pe(new $i(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new pe(new $i(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new pe(new $i(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]]},S={START:[[new pe(new mu(.01,2),r),null,null,null,"helper"]],END:[[new pe(new mu(.01,2),r),null,null,null,"helper"]],DELTA:[[new mn(x(),r),null,null,null,"helper"]],X:[[new mn(v,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new mn(v,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new mn(v,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},M={XYZE:[[new pe(A(.5,1),f),null,[0,Math.PI/2,0]]],X:[[new pe(A(.5,.5),o)]],Y:[[new pe(A(.5,.5),a),null,[0,0,-Math.PI/2]]],Z:[[new pe(A(.5,.5),l),null,[0,Math.PI/2,0]]],E:[[new pe(A(.75,1),m),null,[0,Math.PI/2,0]]]},R={AXIS:[[new mn(v,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},P={XYZE:[[new pe(new al(.25,10,8),s)]],X:[[new pe(new fu(.5,.1,4,24),s),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new pe(new fu(.5,.1,4,24),s),[0,0,0],[Math.PI/2,0,0]]],Z:[[new pe(new fu(.5,.1,4,24),s),[0,0,0],[0,0,-Math.PI/2]]],E:[[new pe(new fu(.75,.1,2,24),s)]]},C={X:[[new pe(y,o),[.5,0,0],[0,0,-Math.PI/2]],[new pe(b,o),[0,0,0],[0,0,-Math.PI/2]],[new pe(y,o),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new pe(y,a),[0,.5,0]],[new pe(b,a)],[new pe(y,a),[0,-.5,0],[0,0,Math.PI]]],Z:[[new pe(y,l),[0,0,.5],[Math.PI/2,0,0]],[new pe(b,l),[0,0,0],[Math.PI/2,0,0]],[new pe(y,l),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new pe(new $i(.15,.15,.01),u),[.15,.15,0]]],YZ:[[new pe(new $i(.15,.15,.01),c),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new pe(new $i(.15,.15,.01),h),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new pe(new $i(.1,.1,.1),d.clone())]]},L={X:[[new pe(new Yn(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new pe(new Yn(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new pe(new Yn(.2,0,.6,4),s),[0,.3,0]],[new pe(new Yn(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new pe(new Yn(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new pe(new Yn(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new pe(new $i(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new pe(new $i(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new pe(new $i(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new pe(new $i(.2,.2,.2),s),[0,0,0]]]},B={X:[[new mn(v,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new mn(v,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new mn(v,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function z(D){const W=new ye;for(const O in D)for(let F=D[O].length;F--;){const X=D[O][F][0].clone(),J=D[O][F][1],q=D[O][F][2],oe=D[O][F][3],_e=D[O][F][4];X.name=O,X.tag=_e,J&&X.position.set(J[0],J[1],J[2]),q&&X.rotation.set(q[0],q[1],q[2]),oe&&X.scale.set(oe[0],oe[1],oe[2]),X.updateMatrix();const ke=X.geometry.clone();ke.applyMatrix4(X.matrix),X.geometry=ke,X.renderOrder=1/0,X.position.set(0,0,0),X.rotation.set(0,0,0),X.scale.set(1,1,1),W.add(X)}return W}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=z(w)),this.add(this.gizmo.rotate=z(M)),this.add(this.gizmo.scale=z(C)),this.add(this.picker.translate=z(_)),this.add(this.picker.rotate=z(P)),this.add(this.picker.scale=z(L)),this.add(this.helper.translate=z(S)),this.add(this.helper.rotate=z(R)),this.add(this.helper.scale=z(B)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const i=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:iC;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let s=[];s=s.concat(this.picker[this.mode].children),s=s.concat(this.gizmo[this.mode].children),s=s.concat(this.helper[this.mode].children);for(let r=0;r<s.length;r++){const o=s[r];o.visible=!0,o.rotation.set(0,0,0),o.position.copy(this.worldPosition);let a;if(this.camera.isOrthographicCamera?a=(this.camera.top-this.camera.bottom)/this.camera.zoom:a=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),o.scale.set(1,1,1).multiplyScalar(a*this.size/4),o.tag==="helper"){o.visible=!1,o.name==="AXIS"?(o.visible=!!this.axis,this.axis==="X"&&(bn.setFromEuler(eC.set(0,0,0)),o.quaternion.copy(i).multiply(bn),Math.abs(Wi.copy(jb).applyQuaternion(i).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Y"&&(bn.setFromEuler(eC.set(0,0,Math.PI/2)),o.quaternion.copy(i).multiply(bn),Math.abs(Wi.copy(Sm).applyQuaternion(i).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Z"&&(bn.setFromEuler(eC.set(0,Math.PI/2,0)),o.quaternion.copy(i).multiply(bn),Math.abs(Wi.copy(Qb).applyQuaternion(i).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="XYZE"&&(bn.setFromEuler(eC.set(0,Math.PI/2,0)),Wi.copy(this.rotationAxis),o.quaternion.setFromRotationMatrix(J9.lookAt(K9,Wi,Sm)),o.quaternion.multiply(bn),o.visible=this.dragging),this.axis==="E"&&(o.visible=!1)):o.name==="START"?(o.position.copy(this.worldPositionStart),o.visible=this.dragging):o.name==="END"?(o.position.copy(this.worldPosition),o.visible=this.dragging):o.name==="DELTA"?(o.position.copy(this.worldPositionStart),o.quaternion.copy(this.worldQuaternionStart),zr.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),zr.applyQuaternion(this.worldQuaternionStart.clone().invert()),o.scale.copy(zr),o.visible=this.dragging):(o.quaternion.copy(i),this.dragging?o.position.copy(this.worldPositionStart):o.position.copy(this.worldPosition),this.axis&&(o.visible=this.axis.search(o.name)!==-1));continue}o.quaternion.copy(i),this.mode==="translate"||this.mode==="scale"?(o.name==="X"&&Math.abs(Wi.copy(jb).applyQuaternion(i).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Y"&&Math.abs(Wi.copy(Sm).applyQuaternion(i).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Z"&&Math.abs(Wi.copy(Qb).applyQuaternion(i).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XY"&&Math.abs(Wi.copy(Qb).applyQuaternion(i).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="YZ"&&Math.abs(Wi.copy(jb).applyQuaternion(i).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XZ"&&Math.abs(Wi.copy(Sm).applyQuaternion(i).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1)):this.mode==="rotate"&&(tC.copy(i),Wi.copy(this.eye).applyQuaternion(bn.copy(i).invert()),o.name.search("E")!==-1&&o.quaternion.setFromRotationMatrix(J9.lookAt(this.eye,K9,Sm)),o.name==="X"&&(bn.setFromAxisAngle(jb,Math.atan2(-Wi.y,Wi.z)),bn.multiplyQuaternions(tC,bn),o.quaternion.copy(bn)),o.name==="Y"&&(bn.setFromAxisAngle(Sm,Math.atan2(Wi.x,Wi.z)),bn.multiplyQuaternions(tC,bn),o.quaternion.copy(bn)),o.name==="Z"&&(bn.setFromAxisAngle(Qb,Math.atan2(Wi.y,Wi.x)),bn.multiplyQuaternions(tC,bn),o.quaternion.copy(bn))),o.visible=o.visible&&(o.name.indexOf("X")===-1||this.showX),o.visible=o.visible&&(o.name.indexOf("Y")===-1||this.showY),o.visible=o.visible&&(o.name.indexOf("Z")===-1||this.showZ),o.visible=o.visible&&(o.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),o.material._color=o.material._color||o.material.color.clone(),o.material._opacity=o.material._opacity||o.material.opacity,o.material.color.copy(o.material._color),o.material.opacity=o.material._opacity,this.enabled&&this.axis&&(o.name===this.axis||this.axis.split("").some(function(l){return o.name===l}))&&(o.material.color.setHex(16776960),o.material.opacity=1)}super.updateMatrixWorld(e)}}class ife extends pe{constructor(){super(new ds(1e5,1e5,2,2),new Qt({visible:!1,wireframe:!0,side:xi,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let i=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(i="local"),nC.copy(jb).applyQuaternion(i==="local"?this.worldQuaternion:iC),Zb.copy(Sm).applyQuaternion(i==="local"?this.worldQuaternion:iC),Yb.copy(Qb).applyQuaternion(i==="local"?this.worldQuaternion:iC),Wi.copy(Zb),this.mode){case"translate":case"scale":switch(this.axis){case"X":Wi.copy(this.eye).cross(nC),bc.copy(nC).cross(Wi);break;case"Y":Wi.copy(this.eye).cross(Zb),bc.copy(Zb).cross(Wi);break;case"Z":Wi.copy(this.eye).cross(Yb),bc.copy(Yb).cross(Wi);break;case"XY":bc.copy(Yb);break;case"YZ":bc.copy(nC);break;case"XZ":Wi.copy(Yb),bc.copy(Zb);break;case"XYZ":case"E":bc.set(0,0,0);break}break;case"rotate":default:bc.set(0,0,0)}bc.length()===0?this.quaternion.copy(this.cameraQuaternion):(q9.lookAt(zr.set(0,0,0),bc,Wi),this.quaternion.setFromRotationMatrix(q9)),super.updateMatrixWorld(e)}}const nfe=te("debuggetcomponent"),$9=()=>nfe||globalThis.NEEDLE_DEBUG_GETCOMPONENT===!0;function sfe(n){return n==null||n.isObject3D?n:n.object&&n.object.isObject3D?n.object:n}function qB(n,e){if(!n||!n.userData.components)return e;const i=n.userData.components.indexOf(e);return i<0||(Nb.dispatchComponentLifecycleEvent(Fb.Removing,e),e.gameObject=null,n.userData.components.splice(i,1)),e}function Kb(n,e,i){return Mm(n,e)||ta(n,e,i)}const e4=new Es("addComponentIdProvider");function Cm(n,e,i=!0){n.userData||(n.userData={}),n.userData.components||(n.userData.components=[]),n.userData.components.push(e),e.gameObject=n,(e.guid===void 0||e.guid==="invalid")&&(e.guid=e4.generateUUID()),oC(n),BC(e,e.context);try{i&&e.__internalAwake&&(Xb(n),e.activeAndEnabled&&e.__internalAwake()),Nb.dispatchComponentLifecycleEvent(Fb.Added,e)}catch(s){console.error(s)}return e}function ta(n,e,i,s){if(typeof e=="function"){const r=new e;i&&r.__internalNewInstanceCreated(i);let o=!0;return s?.callAwake!=null&&(o=s.callAwake),Cm(n,r,o)}if(e.destroyed)return console.warn("Can not move/add a destroyed component",e),e;if(e.gameObject===n)return e;if(e.gameObject&&e.gameObject.userData.components){const r=e.gameObject.userData.components.indexOf(e);e.gameObject.userData.components.splice(r,1)}if(!n.userData.components)n.userData.components=[];else if(n.userData.components.includes(e))return e;return n.userData.components.push(e),e.gameObject=n,(e.guid===void 0||e.guid==="invalid")&&(e.guid=e4.generateUUID()),i&&e._internalInit(i),BC(e,e.context),e}function t4(n){if(n.gameObject&&n.gameObject.userData.components){const e=n.gameObject.userData.components.indexOf(n);n.gameObject.userData.components.splice(e,1)}n.__internalDisable&&n.__internalDisable(),Nh(n,n.context??Pt.Current),n.destroy(),n.gameObject=null}let i4=!1;function n4(n,e,i){var s;if(n==null)return null;if(!n.isObject3D)return console.error("Object is not object3D"),null;if(!((s=n?.userData)!=null&&s.components)||(typeof e=="string"&&(i4||(i4=!0,console.warn(`Accessing components by name is not supported.
Please use the component type instead. This may keep working in local development but it will fail when bundling your application.

You can import other modules your main module to get access to types
or if you use npmdefs you can make types available globally using globalThis:
https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/globalThis`,e))),$9()&&console.log("[onGetComponent] FIND",e),e==null))return null;for(let r=0;r<n.userData.components.length;r++){const o=n.userData.components[r];let a=Object.getPrototypeOf(o);for(;a;){if(a===e.prototype)if($9()&&console.log("[onGetComponent] MATCH BY PROTOYPE",a),i)i.push(o);else return o;a=Object.getPrototypeOf(a)}}return i||null}function Mm(n,e){const i=n4(n,e);return i?Array.isArray(i)?i[0]:i:null}function Jb(n,e,i,s=!0){return i||(i=[]),s&&(i.length=0),n4(n,e,i),i}function qb(n,e,i){var s;const r=Mm(n,e);if(i===!1&&r?.enabled===!1)return null;if(r)return r;for(let o=0;o<((s=n?.children)==null?void 0:s.length);o++){const a=qb(n.children[o],e);if(a)return a}return null}function l0(n,e,i,s=!0){var r;i||(i=[]),s&&(i.length=0),Jb(n,e,i,!1);for(let o=0;o<((r=n?.children)==null?void 0:r.length);o++)l0(n.children[o],e,i,!1);return i}function $b(n,e){if(!n)return null;if(Array.isArray(n)){for(let s=0;s<n.length;s++){const r=sfe(n[s]),o=$b(r,e);if(o)return o}return null}return Mm(n,e)||(n.parent?$b(n.parent,e):null)}function sC(n,e,i,s=!0){return i||(i=[]),s&&(i.length=0),n?(Jb(n,e,i,!1),n.parent?sC(n.parent,e,i,!1):i):i}function rC(n,e=void 0,i=!0){if(!n)return null;if(!e&&(e=Pt.Current,!e))return console.error("Can not search object without any needle context or scene!!!"),null;let s=e;if(s.isScene||(s=e?.scene),!s)return null;for(const r in s.children){const o=s.children[r];if(i===!1&&o[_h]===!1)continue;const a=qb(o,n);if(a)return a}return null}function s4(n,e,i=void 0){if(!n)return e??[];if(e||(e=[]),e.length=0,!i&&(i=Pt.Current,!i))return console.error("Can not search object without any needle context or scene!!!"),e;"scene"in i&&(i=i.scene);const s=i;if(!s)return e;for(const r in s.children){const o=s.children[r];l0(o,n,e,!1)}return e}function oC(n){n&&n.isObject3D===!0&&W9(n,ye)}ye.prototype.SetActive=function(n){this.visible=n},ye.prototype.setActive=function(n){this.visible=n},ye.prototype.destroy=function(){ia(this)},ye.prototype.addComponent=function(n,e){return ta(this,n,e)},ye.prototype.addNewComponent=function(n,e){return ta(this,n,e)},ye.prototype.removeComponent=function(n){return qB(this,n)},ye.prototype.getOrAddComponent=function(n,e){return Kb(this,n,e)},ye.prototype.getComponent=function(n){return Mm(this,n)},ye.prototype.getComponents=function(n,e){return Jb(this,n,e)},ye.prototype.getComponentInChildren=function(n){return qb(this,n)},ye.prototype.getComponentsInChildren=function(n,e){return l0(this,n,e)},ye.prototype.getComponentInParent=function(n){return $b(this,n)},ye.prototype.getComponentsInParent=function(n,e){return sC(this,n,e)},Object.getOwnPropertyDescriptor(ye.prototype,"activeSelf")||Object.defineProperty(ye.prototype,"activeSelf",{get:function(){return c0(this)},set:function(n){eA(this,n)}}),Object.getOwnPropertyDescriptor(ye.prototype,"worldPosition")||Object.defineProperty(ye.prototype,"worldPosition",{get:function(){return this instanceof JB?zt(this.object):zt(this)},set:function(n){bs(this,n)}}),Object.getOwnPropertyDescriptor(ye.prototype,"worldQuaternion")||Object.defineProperty(ye.prototype,"worldQuaternion",{get:function(){return this instanceof JB?ki(this.object):ki(this)},set:function(n){La(this,n)}}),Object.getOwnPropertyDescriptor(ye.prototype,"worldRotation")||Object.defineProperty(ye.prototype,"worldRotation",{get:function(){return Vv(this)},set:function(n){aL(this,n)}}),Object.getOwnPropertyDescriptor(ye.prototype,"worldScale")||Object.defineProperty(ye.prototype,"worldScale",{get:function(){return Qi(this)},set:function(n){vg(this,n)}}),Object.getOwnPropertyDescriptor(ye.prototype,"worldForward")||Object.defineProperty(ye.prototype,"worldForward",{get:function(){return mt().set(0,0,1).applyQuaternion(ki(this))}}),Object.getOwnPropertyDescriptor(ye.prototype,"worldRight")||Object.defineProperty(ye.prototype,"worldRight",{get:function(){return mt().set(1,0,0).applyQuaternion(ki(this))}}),Object.getOwnPropertyDescriptor(ye.prototype,"worldUp")||Object.defineProperty(ye.prototype,"worldUp",{get:function(){return mt().set(0,1,0).applyQuaternion(ki(this))}}),H9(ye);class Ii extends Ae{constructor(e,i,s,r){var o=(...a)=>{super(...a),p(this,"alpha",1)};i!=null&&s!=null?(o(e,i,s),this.alpha=r):(o(e),this.alpha=1)}get isRGBAColor(){return!0}set a(e){this.alpha=e}get a(){return this.alpha}clone(){const e=super.clone();return e.alpha=this.alpha,e}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,"alpha"in e&&typeof e.alpha=="number"?this.alpha=e.alpha:typeof e.a=="number"&&(this.alpha=e.a),this}lerp(e,i){const s=e;return s.alpha!=null&&(this.alpha=tt.lerp(this.alpha,s.alpha,i)),super.lerp(e,i)}lerpColors(e,i,s){const r=e,o=i;return r.alpha!=null&&o.alpha!=null&&(this.alpha=tt.lerp(r.alpha,o.alpha,s)),super.lerpColors(e,i,s)}multiply(e){const i=e;return i.alpha!=null&&(this.alpha=this.alpha*i.alpha),super.multiply(e)}fromArray(e,i=0){return this.alpha=e[i+3],super.fromArray(e,i)}}const aC=te("debuggetcomponent"),lC=te("debuginstantiate");var r4=(n=>(n[n.None=0]="None",n[n.HideInHierarchy=1]="HideInHierarchy",n[n.HideInInspector=2]="HideInInspector",n[n.DontSaveInEditor=4]="DontSaveInEditor",n[n.NotEditable=8]="NotEditable",n[n.DontSaveInBuild=16]="DontSaveInBuild",n[n.DontUnloadUnusedAsset=32]="DontUnloadUnusedAsset",n[n.DontSave=52]="DontSave",n[n.HideAndDontSave=61]="HideAndDontSave",n))(r4||{});class Jl{constructor(){p(this,"idProvider"),p(this,"parent"),p(this,"keepWorldPosition"),p(this,"position"),p(this,"rotation"),p(this,"scale"),p(this,"visible"),p(this,"context"),p(this,"components")}clone(){var e,i,s;const r=new Jl;return r.idProvider=this.idProvider,r.parent=this.parent,r.keepWorldPosition=this.keepWorldPosition,r.position=(e=this.position)==null?void 0:e.clone(),r.rotation=(i=this.rotation)==null?void 0:i.clone(),r.scale=(s=this.scale)==null?void 0:s.clone(),r.visible=this.visible,r.context=this.context,r.components=this.components,r}cloneAssign(e){var i,s,r;this.idProvider=e.idProvider,this.parent=e.parent,this.keepWorldPosition=e.keepWorldPosition,this.position=(i=e.position)==null?void 0:i.clone(),this.rotation=(s=e.rotation)==null?void 0:s.clone(),this.scale=(r=e.scale)==null?void 0:r.clone(),this.visible=e.visible,this.context=e.context,this.components=e.components}}function c0(n){return n.visible}function eA(n,e){return typeof e=="number"&&(e=e>.5),n.visible=e,n.visible}function o4(n){return n[_h]||cC(n)}function a4(n,e){n[A9]=e}function cC(n){return hl.isUsingInstancing(n)}function tA(n,e){return mg(n,e,!0,!0)}const l4=Symbol("isDestroyed");function Em(n){return n[l4]}function c4(n,e){n[l4]=e}const $B=Symbol("isDontDestroy");function ek(n,e=!0){n[$B]=e}const hC=[],uC=[];function ia(n,e=!0,i=!1){hC.length=0,uC.length=0,tk(n,e,!0);for(const s of hC)s.gameObject=null,s.context=null;for(const s of uC)c4(s,!0),i&&Zi(s),v9(s);uC.length=0,hC.length=0}function tk(n,e=!0,i=!0){var s;if(n==null)return;const r=n;if(r.isComponent){if(r[$B])return;hC.push(r);const l=r.gameObject;r.__internalDisable(),r.__internalDestroy(),r.gameObject=l;return}if(n[$B])return;const o=n;aC&&console.log(o),uC.push(o);const a=(s=o.userData)==null?void 0:s.components;if(a!=null&&Array.isArray(a)){let l=a.length;for(let c=0;c<a.length;c++){const h=a[c];tk(h,e,!1),a.length<l&&(l=a.length,c--)}}if(e&&o.children)for(const l of o.children)tk(l,e,!1);i&&o.removeFromParent()}function Tm(n,e,i=!0){return h4(n,e,i)}function*dC(n,e,i=!1,s=999,r=0){if(n!=null&&n.userData.components&&!(r>s)){for(const o of n.userData.components)e&&o?.isComponent===!0&&o instanceof e?yield o:yield o;if(i===!0)for(const o of n.children)yield*dC(o,e,!0,s,r+1)}}function h4(n,e,i,s=0){var r;if(n){if(n.isObject3D,s>1e3){console.warn("Failed to iterate components: too many levels");return}if((r=n.userData)!=null&&r.components)for(let o=0;o<n.userData.components.length;o++){const a=n.userData.components[o];if(a?.isComponent===!0){const l=e(a);if(l!==void 0)return l}}if(i&&n.children){const o=s+1;for(let a=0;a<n.children.length;a++){const l=n.children[a];if(!l)continue;const c=h4(l,e,i,o);if(c!==void 0)return c}}}}function h0(n,e=null){let i=null;e!==null&&(e.x!==void 0?(i=new Jl,i.position=e):i=e);let s=Pt.Current;i!=null&&i.context&&(s=i.context),aC&&s.alias&&console.log("context",s.alias),i&&!i.idProvider&&(i.idProvider=new Es(Date.now()));const r=[],o={},a={},l=u4(s,n,i,r,o,a);l&&(ofe(o),rfe(a,o)),aC&&(E_(n,!0),E_(l,!0));const c={};if(i?.components!==!1){for(const h in r){const u=r[h],d=u.guid;i&&i.idProvider&&(u.guid=i.idProvider.generateUUID(),c[d]=u.guid,aC&&console.log(u.name,u.guid)),BC(u,s),u.__internalNewInstanceCreated&&u.__internalNewInstanceCreated()}for(const h in r){const u=r[h];u.resolveGuids&&u.resolveGuids(c),u.enabled!==!1&&(u.enabled=!0)}jS(s)}return l}function u4(n,e,i,s,r,o){var a;if(!e)return null;const l=e.userData;e.userData={};const c=e.children;e.children=[];const h=e.clone(!1);if(oC(h),e.userData=l,e.children=c,r[e.uuid]={original:e,clone:h},lC&&console.log("ADD",e,h),e.type==="SkinnedMesh"&&(o[e.uuid]={original:e,clone:h}),i?.visible!==void 0&&(h.visible=i.visible),i!=null&&i.idProvider){h.uuid=i.idProvider.generateUUID();const d=h;d&&(d.guid=h.uuid)}e.animations&&e.animations.length>0&&(h.animations=[...e.animations]);const u=e.parent;if(u&&u.add(h),i!=null&&i.position?bs(h,i.position):h.position.copy(e.position),i!=null&&i.rotation?La(h,i.rotation):h.quaternion.copy(e.quaternion),i!=null&&i.scale?h.scale.copy(i.scale):h.scale.copy(e.scale),i!=null&&i.parent&&i.parent!=="scene"){let d=null;if(typeof i.parent=="string"?d=mg(i.parent,n.scene,!0):d=i.parent,d){const m=i.keepWorldPosition===!0?d.attach:d.add;m?m.call(d,h):console.error("Invalid parent object",d,"received when instantiating:",e)}else console.warn("could not find parent:",i.parent)}for(const[d,m]of Object.entries(e.userData))d!=="components"&&(h.userData[d]=m);if((a=e.userData)!=null&&a.components){const d=e.userData.components,m=[];h.userData.components=m;for(let f=0;f<d.length;f++){const g=d[f],y=new g.constructor;a0(y,g),g[Qv]!==void 0&&(y[Qv]=g[Qv]),m.push(y),y.gameObject=h,s.push(y),r[g.guid]={original:g,clone:y},Nb.dispatchComponentLifecycleEvent(Fb.Added,y)}}i&&(i.position=void 0,i.rotation=void 0,i.scale=void 0,i.parent=void 0);for(const d in e.children){const m=e.children[d],f=u4(n,m,i,s,r,o);f&&h.add(f)}return h}function rfe(n,e){for(const i in n){const s=n[i],r=s.original,o=r.skeleton,a=s.clone;if(!o){console.warn("Skinned mesh has no skeleton?",s);continue}const l=o.bones,c=a.skeleton.clone();a.skeleton=c,a.bindMatrix.clone().copy(r.bindMatrix),a.bindMatrixInverse.copy(r.bindMatrixInverse);const h=[];c.bones=h;for(let u=0;u<l.length;u++){const d=l[u],m=e[d.uuid].clone;h.push(m)}}for(const i in n){const s=n[i].clone;s.skeleton.update(),s.bind(s.skeleton,s.bindMatrix),s.updateMatrixWorld(!0)}}function ofe(n){var e;for(const i in n){const s=n[i].clone;if(s!=null&&s.isObject3D&&(e=s?.userData)!=null&&e.components)for(let r=0;r<s.userData.components.length;r++){const o=s.userData.components[r],a=Object.entries(o);for(const[l,c]of a)if(Array.isArray(c)){const h=[];o[l]=h;for(let u=0;u<c.length;u++){const d=c[u];if(typeof d!="object"){h.push(d);continue}const m=d4(o,l,d,n);m!==void 0?h.push(m):h.push(d)}}else if(typeof c=="object"){const h=d4(o,l,c,n);h!==void 0&&(o[l]=h)}}}}function d4(n,e,i,s){var r,o;if(i!=null)if(i.isComponent===!0){const a=i.gameObject;if(a){const l=a.uuid,c=(r=s[l])==null?void 0:r.clone;if(!c){lC&&console.log("reference did not change",e,n,i);return}const h=a.userData.components.indexOf(i);if(h>=0&&c.isObject3D)return lC&&console.log(e,l),c.userData.components[h];console.warn("could not find component",e,i)}}else if(i.isObject3D===!0){if(e==="gameObject")return;const a=i;if(a){const l=a.uuid,c=(o=s[l])==null?void 0:o.clone;if(c)return lC&&console.log(e,"old",i,"new",c),c}}else{if(i.isVector4||i.isVector3||i.isVector2||i.isQuaternion||i.isEuler||i.isColor===!0)return i.clone();if(i.isEventList===!0)return i.__internalOnInstantiate(s)}}var p4={exports:{}},m4={exports:{}};(function(){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e={rotl:function(i,s){return i<<s|i>>>32-s},rotr:function(i,s){return i<<32-s|i>>>s},endian:function(i){if(i.constructor==Number)return e.rotl(i,8)&16711935|e.rotl(i,24)&4278255360;for(var s=0;s<i.length;s++)i[s]=e.endian(i[s]);return i},randomBytes:function(i){for(var s=[];i>0;i--)s.push(Math.floor(Math.random()*256));return s},bytesToWords:function(i){for(var s=[],r=0,o=0;r<i.length;r++,o+=8)s[o>>>5]|=i[r]<<24-o%32;return s},wordsToBytes:function(i){for(var s=[],r=0;r<i.length*32;r+=8)s.push(i[r>>>5]>>>24-r%32&255);return s},bytesToHex:function(i){for(var s=[],r=0;r<i.length;r++)s.push((i[r]>>>4).toString(16)),s.push((i[r]&15).toString(16));return s.join("")},hexToBytes:function(i){for(var s=[],r=0;r<i.length;r+=2)s.push(parseInt(i.substr(r,2),16));return s},bytesToBase64:function(i){for(var s=[],r=0;r<i.length;r+=3)for(var o=i[r]<<16|i[r+1]<<8|i[r+2],a=0;a<4;a++)r*8+a*6<=i.length*8?s.push(n.charAt(o>>>6*(3-a)&63)):s.push("=");return s.join("")},base64ToBytes:function(i){i=i.replace(/[^A-Z0-9+\/]/ig,"");for(var s=[],r=0,o=0;r<i.length;o=++r%4)o!=0&&s.push((n.indexOf(i.charAt(r-1))&Math.pow(2,-2*o+8)-1)<<o*2|n.indexOf(i.charAt(r))>>>6-o*2);return s}};m4.exports=e})();var afe=m4.exports,ik={utf8:{stringToBytes:function(n){return ik.bin.stringToBytes(unescape(encodeURIComponent(n)))},bytesToString:function(n){return decodeURIComponent(escape(ik.bin.bytesToString(n)))}},bin:{stringToBytes:function(n){for(var e=[],i=0;i<n.length;i++)e.push(n.charCodeAt(i)&255);return e},bytesToString:function(n){for(var e=[],i=0;i<n.length;i++)e.push(String.fromCharCode(n[i]));return e.join("")}}},f4=ik;/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var lfe=function(n){return n!=null&&(g4(n)||cfe(n)||!!n._isBuffer)};function g4(n){return!!n.constructor&&typeof n.constructor.isBuffer=="function"&&n.constructor.isBuffer(n)}function cfe(n){return typeof n.readFloatLE=="function"&&typeof n.slice=="function"&&g4(n.slice(0,0))}(function(){var n=afe,e=f4.utf8,i=lfe,s=f4.bin,r=function(o,a){o.constructor==String?a&&a.encoding==="binary"?o=s.stringToBytes(o):o=e.stringToBytes(o):i(o)?o=Array.prototype.slice.call(o,0):!Array.isArray(o)&&o.constructor!==Uint8Array&&(o=o.toString());for(var l=n.bytesToWords(o),c=o.length*8,h=1732584193,u=-271733879,d=-1732584194,m=271733878,f=0;f<l.length;f++)l[f]=(l[f]<<8|l[f]>>>24)&16711935|(l[f]<<24|l[f]>>>8)&4278255360;l[c>>>5]|=128<<c%32,l[(c+64>>>9<<4)+14]=c;for(var g=r._ff,y=r._gg,v=r._hh,b=r._ii,f=0;f<l.length;f+=16){var A=h,x=u,w=d,_=m;h=g(h,u,d,m,l[f+0],7,-680876936),m=g(m,h,u,d,l[f+1],12,-389564586),d=g(d,m,h,u,l[f+2],17,606105819),u=g(u,d,m,h,l[f+3],22,-1044525330),h=g(h,u,d,m,l[f+4],7,-176418897),m=g(m,h,u,d,l[f+5],12,1200080426),d=g(d,m,h,u,l[f+6],17,-1473231341),u=g(u,d,m,h,l[f+7],22,-45705983),h=g(h,u,d,m,l[f+8],7,1770035416),m=g(m,h,u,d,l[f+9],12,-1958414417),d=g(d,m,h,u,l[f+10],17,-42063),u=g(u,d,m,h,l[f+11],22,-1990404162),h=g(h,u,d,m,l[f+12],7,1804603682),m=g(m,h,u,d,l[f+13],12,-40341101),d=g(d,m,h,u,l[f+14],17,-1502002290),u=g(u,d,m,h,l[f+15],22,1236535329),h=y(h,u,d,m,l[f+1],5,-165796510),m=y(m,h,u,d,l[f+6],9,-1069501632),d=y(d,m,h,u,l[f+11],14,643717713),u=y(u,d,m,h,l[f+0],20,-373897302),h=y(h,u,d,m,l[f+5],5,-701558691),m=y(m,h,u,d,l[f+10],9,38016083),d=y(d,m,h,u,l[f+15],14,-660478335),u=y(u,d,m,h,l[f+4],20,-405537848),h=y(h,u,d,m,l[f+9],5,568446438),m=y(m,h,u,d,l[f+14],9,-1019803690),d=y(d,m,h,u,l[f+3],14,-187363961),u=y(u,d,m,h,l[f+8],20,1163531501),h=y(h,u,d,m,l[f+13],5,-1444681467),m=y(m,h,u,d,l[f+2],9,-51403784),d=y(d,m,h,u,l[f+7],14,1735328473),u=y(u,d,m,h,l[f+12],20,-1926607734),h=v(h,u,d,m,l[f+5],4,-378558),m=v(m,h,u,d,l[f+8],11,-2022574463),d=v(d,m,h,u,l[f+11],16,1839030562),u=v(u,d,m,h,l[f+14],23,-35309556),h=v(h,u,d,m,l[f+1],4,-1530992060),m=v(m,h,u,d,l[f+4],11,1272893353),d=v(d,m,h,u,l[f+7],16,-155497632),u=v(u,d,m,h,l[f+10],23,-1094730640),h=v(h,u,d,m,l[f+13],4,681279174),m=v(m,h,u,d,l[f+0],11,-358537222),d=v(d,m,h,u,l[f+3],16,-722521979),u=v(u,d,m,h,l[f+6],23,76029189),h=v(h,u,d,m,l[f+9],4,-640364487),m=v(m,h,u,d,l[f+12],11,-421815835),d=v(d,m,h,u,l[f+15],16,530742520),u=v(u,d,m,h,l[f+2],23,-995338651),h=b(h,u,d,m,l[f+0],6,-198630844),m=b(m,h,u,d,l[f+7],10,1126891415),d=b(d,m,h,u,l[f+14],15,-1416354905),u=b(u,d,m,h,l[f+5],21,-57434055),h=b(h,u,d,m,l[f+12],6,1700485571),m=b(m,h,u,d,l[f+3],10,-1894986606),d=b(d,m,h,u,l[f+10],15,-1051523),u=b(u,d,m,h,l[f+1],21,-2054922799),h=b(h,u,d,m,l[f+8],6,1873313359),m=b(m,h,u,d,l[f+15],10,-30611744),d=b(d,m,h,u,l[f+6],15,-1560198380),u=b(u,d,m,h,l[f+13],21,1309151649),h=b(h,u,d,m,l[f+4],6,-145523070),m=b(m,h,u,d,l[f+11],10,-1120210379),d=b(d,m,h,u,l[f+2],15,718787259),u=b(u,d,m,h,l[f+9],21,-343485551),h=h+A>>>0,u=u+x>>>0,d=d+w>>>0,m=m+_>>>0}return n.endian([h,u,d,m])};r._ff=function(o,a,l,c,h,u,d){var m=o+(a&l|~a&c)+(h>>>0)+d;return(m<<u|m>>>32-u)+a},r._gg=function(o,a,l,c,h,u,d){var m=o+(a&c|l&~c)+(h>>>0)+d;return(m<<u|m>>>32-u)+a},r._hh=function(o,a,l,c,h,u,d){var m=o+(a^l^c)+(h>>>0)+d;return(m<<u|m>>>32-u)+a},r._ii=function(o,a,l,c,h,u,d){var m=o+(l^(a|~c))+(h>>>0)+d;return(m<<u|m>>>32-u)+a},r._blocksize=16,r._digestsize=16,p4.exports=function(o,a){if(o==null)throw new Error("Illegal argument "+o);var l=n.wordsToBytes(r(o,a));return a&&a.asBytes?l:a&&a.asString?s.bytesToString(l):n.bytesToHex(l)}})();var hfe=p4.exports;const ufe=ES(hfe);class nk{constructor(e,i,s,r){p(this,"success"),p(this,"filename"),p(this,"hash"),p(this,"size"),p(this,"url"),this.success=e,this.filename=i,this.hash=s,this.size=r}}async function y4(n,e){const i=await n.arrayBuffer(),s=sk(i),r=n.name.split(".").pop(),o=s+"."+r,a=n.name.split(".").shift();console.assert(a!==void 0);const l={alias:a,filename:o},c=await(await fetch(e+"/exists",{method:"POST",body:JSON.stringify(l)})).json();if(c.success||console.warn("exists check did fail"),c.exists)return console.log("file already exists",s),new nk(!0,o,s,n.size);console.log("begin uploading file",a,n.size);const h=new FormData;h.append("file",n);const u={};u.filesize=n.size,a&&(u.alias=a);const d=await(await fetch(e+"/upload/file",{method:"POST",body:h,headers:u})).json();if(d?.success===!1)return d.message!==void 0?console.error("Upload failed:",d.message):console.error("Upload failed"),null;console.assert(d.hash_sum===s,"hash sum did not match","received:",d.hash_sum,"expected:",s),d.success&&console.log("successfully uploaded",s,d.id);const m=new nk(d.success,o,s,n.size);return m.url=e,m}function sk(n){return ufe(new Uint8Array(n))}async function rk(n,e,i,s,r=!1){try{const o=await fetch(s+"/download/file",{method:"POST",body:n});if(o.status!==200)return console.error("download failed",o),null;const a=await o.blob(),l=await a.arrayBuffer();r||console.assert(a.size===i,"size mismatch","expected:",i,"got:",a.size);const c=sk(l);return r||console.assert(c===e,"hash mismatch, downloaded file is invalid"),a.arrayBuffer()}catch(o){console.error(o)}return null}async function v4(n,e){var i;const s=await fetch(n),r=(i=s.body)==null?void 0:i.getReader(),o=s.headers.get("Content-Length"),a=o?parseInt(o):0;if(!r)return null;let l=0;const c=[];for(;;){const{done:d,value:m}=await r.read();if(m&&(c.push(m),l+=m.length,e.call(null,new ProgressEvent("progress",{loaded:l,total:a}))),d)break}const h=new Uint8Array(l);let u=0;for(const d of c)h.set(d,u),u+=d.length;return h}const gd=te("debugaddressables");class b4{constructor(e){p(this,"_context"),p(this,"_assetReferences",{}),p(this,"preUpdate",()=>{}),this._context=e,this._context.pre_update_callbacks.push(this.preUpdate)}dispose(){const e=this._context.pre_update_callbacks.indexOf(this.preUpdate);e>=0&&this._context.pre_update_callbacks.splice(e,1);for(const i in this._assetReferences){const s=this._assetReferences[i];s?.unload()}this._assetReferences={}}findAssetReference(e){return this._assetReferences[e]||null}registerAssetReference(e){return e.url&&(this._assetReferences[e.url]?console.warn("Asset reference already registered",e):this._assetReferences[e.url]=e),e}unregisterAssetReference(e){e.url&&delete this._assetReferences[e.url]}}const ok=Symbol("assetReference"),u0=class{constructor(n,e,i=null){p(this,"_loading"),p(this,"_asset"),p(this,"_glbRoot"),p(this,"_url"),p(this,"_progressListeners",[]),p(this,"_hash"),p(this,"_hashedUri"),p(this,"_isLoadingRawBinary",!1),p(this,"_rawBinary"),this._url=n,this._hash=e,n.includes("?v=")?this._hashedUri=n:this._hashedUri=e?n+"?v="+e:n,i!==null&&(this.asset=i),P9(this._url,this.onResolvePrefab.bind(this))}static getOrCreateFromUrl(n,e){if(!e&&(e=Pt.Current,!e))throw new Error('Context is required when sourceId is a string. When you call this method from a component you can call it with "getOrCreate(this, url)" where "this" is the component.');const i=e.addressables,s=i.findAssetReference(n);if(s)return s;const r=new u0(n,e.hash);return i.registerAssetReference(r),r}static getOrCreate(n,e,i){if(typeof n=="string"){if(!i&&(i=Pt.Current,!i))throw new Error('Context is required when sourceId is a string. When you call this method from a component you can call it with "getOrCreate(this, url)" where "this" is the component.')}else i=n.context,n=n.sourceId;const s=Vu(n,e);gd&&console.log("GetOrCreate Addressable from",n,e,"FinalPath=",s);const r=i.addressables,o=r.findAssetReference(s);if(o)return o;const a=new u0(s,i.hash);return r.registerAssetReference(a),a}get asset(){return this._glbRoot??this._asset}set asset(n){this._asset=n}get uri(){return this._url}get url(){return this._url}get hasUrl(){return this._url!==void 0&&(this._url.startsWith("http")||this._url.startsWith("blob:")||this._url.startsWith("www.")||this._url.includes("/"))}get rawAsset(){return this._asset}async onResolvePrefab(n){return n===this.url&&(this.mustLoad&&await this.loadAssetAsync(),this.asset)?this.asset:null}get mustLoad(){return!this.asset||this.asset.__destroyed===!0||Em(this.asset)===!0}isLoaded(){return this._rawBinary||this.asset!==void 0}unload(){this.asset&&(gd&&console.log("Unload",this.asset),this.asset.scene&&ia(this.asset.scene,!0,!0),ia(this.asset,!0,!0)),this.asset=null,this._rawBinary=void 0,this._glbRoot=null,this._loading=void 0,Pt.Current&&Pt.Current.addressables.unregisterAssetReference(this)}async preload(){if(!this.mustLoad||this._isLoadingRawBinary)return null;if(this._rawBinary!==void 0)return this._rawBinary;this._isLoadingRawBinary=!0,gd&&console.log("Preload",this._hashedUri);const n=await v4(this._hashedUri,e=>{this.raiseProgressEvent(e)});return this._rawBinary=n?.buffer??null,this._isLoadingRawBinary=!1,this._rawBinary}async loadAssetAsync(n){if(gd&&console.log("loadAssetAsync",this.url),!this.mustLoad)return this.asset;if(n&&this._progressListeners.push(n),this._loading!==void 0)return this._loading.then(s=>this.asset);const e=Pt.Current;this._rawBinary?(this._loading=yl().parseSync(e,this._rawBinary,this.url,null),this.raiseProgressEvent(new ProgressEvent("progress",{loaded:this._rawBinary.byteLength,total:this._rawBinary.byteLength}))):(gd&&console.log("Load async",this.url),this._loading=yl().loadSync(e,this._hashedUri,this.url,null,s=>{this.raiseProgressEvent(s)}));const i=await this._loading;if(this._progressListeners.length=0,this._glbRoot=this.tryGetActualGameObjectRoot(i),this._loading=void 0,i)return i[ok]=this,this._glbRoot&&(this._glbRoot[ok]=this),this.asset&&(this.asset[ok]=this),jS(e),i.scene!==void 0&&(this.asset=i),this.asset}async instantiate(n){return this.onInstantiate(n,!1)}async instantiateSynced(n,e=!0){return this.onInstantiate(n,!0,e)}beginListenDownload(n){this._progressListeners.indexOf(n)<0&&this._progressListeners.push(n)}endListenDownload(n){const e=this._progressListeners.indexOf(n);e>=0&&this._progressListeners.splice(e,1)}raiseProgressEvent(n){for(const e of this._progressListeners)e(this,n)}async onInstantiate(n,e=!1,i){const s=Pt.Current,r=new Jl;if(n instanceof ye?r.parent=n:n&&(Object.assign(r,n),r.cloneAssign(n)),r.parent||(r.parent=s.scene),this.mustLoad&&await this.loadAssetAsync(),gd&&console.log("Instantiate",this.url,"parent:",n),this.asset){gd&&console.log("Add to scene",this.asset);let o=u0.currentlyInstantiating.get(this.url);if(o!==void 0&&o>=1e4)return console.error("Recursive or too many instantiations of "+this.url+" in the same frame ("+o+")"),null;try{if(o===void 0&&(o=0),o+=1,u0.currentlyInstantiating.set(this.url,o),e){r.context=s;const a=this.asset;a.guid=this.url;const l=NB(a,r,void 0,i);if(l)return l}else{const a=h0(this.asset,r);if(a)return a}}finally{s.post_render_callbacks.push(()=>{o===void 0||o<0?o=0:o-=1,u0.currentlyInstantiating.set(this.url,o)})}}else gd&&console.warn("Failed to load asset",this.url);return null}tryGetActualGameObjectRoot(n){if(n&&n.scene){const e=n.scene;return e.isGroup&&e.children.length===1&&e.children[0].name+"glb"===e.name?e.children[0]:e}return null}};let ei=u0;p(ei,"currentlyInstantiating",new Map);class dfe extends Wa{constructor(){super([ei],"AssetReferenceSerializer")}onSerialize(e,i){if(e&&e.uri!==void 0&&typeof e.uri=="string")return e.uri}onDeserialize(e,i){if(typeof e=="string")return i.context?i.gltfId?ei.getOrCreate(i.gltfId,e,i.context):(console.error("Missing source id"),null):(console.error("Missing context"),null);if(e instanceof ye){if(!i.context)return console.error("Missing context"),null;if(!i.gltfId)return console.error("Missing source id"),null;const s=e,r=i.context,o=s.guid??s.uuid,a=r.addressables.findAssetReference(o);if(a)return a;const l=new ei(o,void 0,s);return r.addressables.registerAssetReference(l),l}return null}}new dfe;const pfe=Promise.resolve(null),pC=class{constructor(n){p(this,"url"),p(this,"_bitmap"),p(this,"_bitmapObject"),p(this,"loader",null),this.url=n}static getOrCreate(n){let e=pC.imageReferences.get(n);return e||(e=new pC(n),pC.imageReferences.set(n,e)),e}dispose(){this._bitmapObject&&this._bitmapObject.close(),this._bitmap=void 0}createHTMLImage(){const n=new Image;return n.src=this.url,n}createTexture(){return this.url?(this.loader||(this.loader=new sc),this.loader.setCrossOrigin("anonymous"),this.loader.loadAsync(this.url)):pfe}getBitmap(){return this._bitmap?this._bitmap:(this._bitmap=new Promise((n,e)=>{const i=document.createElement("img");i.addEventListener("load",()=>{this._bitmap=createImageBitmap(i).then(s=>(this._bitmapObject=s,n(s),s))}),i.addEventListener("error",s=>{console.error("Failed to load image:"+this.url,s),n(null)}),i.src=this.url}),this._bitmap)}};let mC=pC;p(mC,"imageReferences",new Map);class A4 extends Wa{constructor(){super([mC],"ImageReferenceSerializer")}onSerialize(e,i){return null}onDeserialize(e,i){if(typeof e=="string"){const s=Vu(i.gltfId,e);return mC.getOrCreate(s)}}}new A4;const fC=class{constructor(n){p(this,"url"),p(this,"res"),this.url=n}static getOrCreate(n){let e=fC.cache.get(n);return e||(e=new fC(n),fC.cache.set(n,e)),e}async loadRaw(){return this.res||(this.res=fetch(this.url)),this.res.then(n=>n.blob())}async loadText(){return this.res||(this.res=fetch(this.url)),this.res.then(n=>n.text())}};let gC=fC;p(gC,"cache",new Map);class x4 extends Wa{constructor(){super([gC],"FileReferenceSerializer")}onSerialize(e,i){return null}onDeserialize(e,i){if(typeof e=="string"){const s=Vu(i.gltfId,e);return gC.getOrCreate(s)}}}new x4;class mfe{constructor(e){p(this,"context"),p(this,"mixers",[]),this.context=e}onDestroy(){this.mixers.forEach(e=>e.stopAllAction()),this.mixers.length=0}registerAnimationMixer(e){if(!e){console.warn("AnimationsRegistry.registerAnimationMixer called with null or undefined mixer");return}this.mixers.includes(e)||this.mixers.push(e)}unregisterAnimationMixer(e){if(!e){console.warn("AnimationsRegistry.unregisterAnimationMixer called with null or undefined mixer");return}const i=this.mixers.indexOf(e);i!==-1&&this.mixers.splice(i,1)}}class d0{static tryGetActionsFromMixer(e){return e._actions||null}static tryGetAnimationClipsFromObjectHierarchy(e,i){if(i||(i=new Array),e)e.animations&&i.push(...e.animations);else return i;if(e.children)for(const s of e.children)this.tryGetAnimationClipsFromObjectHierarchy(s,i);return i}static assignAnimationsFromFile(e,i){if(!e||!e.animations){console.debug("No animations found in file");return}for(let r=0;r<e.animations.length;r++){const o=e.animations[r];if(!o.tracks||o.tracks.length<=0){console.warn("Animation has no tracks");continue}for(const a in o.tracks){const l=o.tracks[a],c=Jt.parseTrackName(l.name);let h=Jt.findNode(e.scene,c.nodeName);if(!h){const d=l.__objectName??l.name.substring(0,l.name.indexOf("."));if(h=e.scene.getObjectByProperty("uuid",d),!h)continue}let u=s(h);if(!u){if(!(i!=null&&i.createAnimationComponent)){console.warn("No AnimationComponent found in parent hierarchy of object and no 'createAnimationComponent' callback was provided in options.");continue}u=i.createAnimationComponent(e.scene,o)}u.addClip&&u.addClip(o)}}function s(r){var o;if(!r)return null;const a=(o=r.userData)==null?void 0:o.components;if(a&&a.length>0){for(let l=0;l<a.length;l++)if(a[l].isAnimationComponent===!0)return r}return s(r.parent)}}}var yC=(n=>(n.Visible="application-visible",n.Hidden="application-hidden",n.MuteChanged="application-mutechanged",n))(yC||{});let vC=!1;const p0=[];function Rm(){if(vC)return;Ye()&&console.debug("User interaction registered: audio can now be played"),vC=!0;const n=[...p0];p0.length=0,n.forEach(e=>e())}document.addEventListener("mousedown",Rm),document.addEventListener("pointerup",Rm),document.addEventListener("click",Rm),document.addEventListener("dragstart",Rm),document.addEventListener("touchend",Rm),document.addEventListener("keydown",Rm),Et.onXRSessionStart(()=>{Rm()});const w4=class extends EventTarget{constructor(n){super(),p(this,"_mute",!1),p(this,"context"),p(this,"_isVisible",!0),this.context=n,window.addEventListener("visibilitychange",this.onVisiblityChanged.bind(this),!1)}static get userInteractionRegistered(){return vC}static registerWaitForInteraction(n){if(n!==null){if(vC){n();return}p0.indexOf(n)===-1&&p0.push(n)}}static unregisterWaitForInteraction(n){const e=p0.indexOf(n);e!==-1&&p0.splice(e,1)}get muted(){return this._mute}set muted(n){n!==this._mute&&(this._mute=n,this.dispatchEvent(new Event("application-mutechanged")))}get hasFocus(){return document.hasFocus()}get isVisible(){return this._isVisible}onVisiblityChanged(n){switch(n.target.visibilityState){case"hidden":this._isVisible=!1,this.dispatchEvent(new Event("application-hidden"));break;case"visible":this._isVisible=!0,this.dispatchEvent(new Event("application-visible"));break}}};let Uh=w4;p(Uh,"registerWaitForAllowAudio",w4.registerWaitForInteraction);function*_4(n,e=null){const i=e?e.time:Pt.Current.time,s=i.time;for(;i.time-s<n;)yield}function*ffe(n){for(let e=0;e<n;e++)yield}function*S4(n){let e=!0;for(n.then(()=>e=!1),n.catch(()=>e=!1);e;)yield}/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/var C4=function(n){return URL.createObjectURL(new Blob([n],{type:"text/javascript"}))};try{URL.revokeObjectURL(C4(""))}catch{C4=function(n){return"data:application/javascript;charset=UTF-8,"+encodeURI(n)}}var rs=Uint8Array,ho=Uint16Array,m0=Uint32Array,bC=new rs([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),AC=new rs([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ak=new rs([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),M4=function(n,e){for(var i=new ho(31),s=0;s<31;++s)i[s]=e+=1<<n[s-1];for(var r=new m0(i[30]),s=1;s<30;++s)for(var o=i[s];o<i[s+1];++o)r[o]=o-i[s]<<5|s;return[i,r]},E4=M4(bC,2),T4=E4[0],lk=E4[1];T4[28]=258,lk[258]=28;for(var R4=M4(AC,0),gfe=R4[0],I4=R4[1],ck=new ho(32768),cn=0;cn<32768;++cn){var yd=(cn&43690)>>>1|(cn&21845)<<1;yd=(yd&52428)>>>2|(yd&13107)<<2,yd=(yd&61680)>>>4|(yd&3855)<<4,ck[cn]=((yd&65280)>>>8|(yd&255)<<8)>>>1}for(var Ac=function(n,e,i){for(var s=n.length,r=0,o=new ho(e);r<s;++r)++o[n[r]-1];var a=new ho(e);for(r=0;r<e;++r)a[r]=a[r-1]+o[r-1]<<1;var l;if(i){l=new ho(1<<e);var c=15-e;for(r=0;r<s;++r)if(n[r])for(var h=r<<4|n[r],u=e-n[r],d=a[n[r]-1]++<<u,m=d|(1<<u)-1;d<=m;++d)l[ck[d]>>>c]=h}else for(l=new ho(s),r=0;r<s;++r)n[r]&&(l[r]=ck[a[n[r]-1]++]>>>15-n[r]);return l},vd=new rs(288),cn=0;cn<144;++cn)vd[cn]=8;for(var cn=144;cn<256;++cn)vd[cn]=9;for(var cn=256;cn<280;++cn)vd[cn]=7;for(var cn=280;cn<288;++cn)vd[cn]=8;for(var iA=new rs(32),cn=0;cn<32;++cn)iA[cn]=5;var yfe=Ac(vd,9,0),vfe=Ac(vd,9,1),bfe=Ac(iA,5,0),Afe=Ac(iA,5,1),hk=function(n){for(var e=n[0],i=1;i<n.length;++i)n[i]>e&&(e=n[i]);return e},Ol=function(n,e,i){var s=e/8|0;return(n[s]|n[s+1]<<8)>>(e&7)&i},uk=function(n,e){var i=e/8|0;return(n[i]|n[i+1]<<8|n[i+2]<<16)>>(e&7)},dk=function(n){return(n/8|0)+(n&7&&1)},pk=function(n,e,i){(e==null||e<0)&&(e=0),(i==null||i>n.length)&&(i=n.length);var s=new(n instanceof ho?ho:n instanceof m0?m0:rs)(i-e);return s.set(n.subarray(e,i)),s},xfe=function(n,e,i){var s=n.length;if(!s||i&&!i.l&&s<5)return e||new rs(0);var r=!e||i,o=!i||i.i;i||(i={}),e||(e=new rs(s*3));var a=function(Me){var it=e.length;if(Me>it){var je=new rs(Math.max(it*2,Me));je.set(e),e=je}},l=i.f||0,c=i.p||0,h=i.b||0,u=i.l,d=i.d,m=i.m,f=i.n,g=s*8;do{if(!u){i.f=l=Ol(n,c,1);var y=Ol(n,c+1,3);if(c+=3,y)if(y==1)u=vfe,d=Afe,m=9,f=5;else if(y==2){var v=Ol(n,c,31)+257,b=Ol(n,c+10,15)+4,A=v+Ol(n,c+5,31)+1;c+=14;for(var x=new rs(A),w=new rs(19),_=0;_<b;++_)w[ak[_]]=Ol(n,c+_*3,7);c+=b*3;for(var S=hk(w),M=(1<<S)-1,R=Ac(w,S,1),_=0;_<A;){var P=R[Ol(n,c,M)];c+=P&15;var C=P>>>4;if(C<16)x[_++]=C;else{var L=0,B=0;for(C==16?(B=3+Ol(n,c,3),c+=2,L=x[_-1]):C==17?(B=3+Ol(n,c,7),c+=3):C==18&&(B=11+Ol(n,c,127),c+=7);B--;)x[_++]=L}}var z=x.subarray(0,v),D=x.subarray(v);m=hk(z),f=hk(D),u=Ac(z,m,1),d=Ac(D,f,1)}else throw"invalid block type";else{var C=dk(c)+4,W=n[C-4]|n[C-3]<<8,O=C+W;if(O>s){if(o)throw"unexpected EOF";break}r&&a(h+W),e.set(n.subarray(C,O),h),i.b=h+=W,i.p=c=O*8;continue}if(c>g){if(o)throw"unexpected EOF";break}}r&&a(h+131072);for(var F=(1<<m)-1,X=(1<<f)-1,J=c;;J=c){var L=u[uk(n,c)&F],q=L>>>4;if(c+=L&15,c>g){if(o)throw"unexpected EOF";break}if(!L)throw"invalid length/literal";if(q<256)e[h++]=q;else if(q==256){J=c,u=null;break}else{var oe=q-254;if(q>264){var _=q-257,_e=bC[_];oe=Ol(n,c,(1<<_e)-1)+T4[_],c+=_e}var ke=d[uk(n,c)&X],re=ke>>>4;if(!ke)throw"invalid distance";c+=ke&15;var D=gfe[re];if(re>3){var _e=AC[re];D+=uk(n,c)&(1<<_e)-1,c+=_e}if(c>g){if(o)throw"unexpected EOF";break}r&&a(h+131072);for(var we=h+oe;h<we;h+=4)e[h]=e[h-D],e[h+1]=e[h+1-D],e[h+2]=e[h+2-D],e[h+3]=e[h+3-D];h=we}}i.l=u,i.p=J,i.b=h,u&&(l=1,i.m=m,i.d=d,i.n=f)}while(!l);return h==e.length?e:pk(e,0,h)},Vh=function(n,e,i){i<<=e&7;var s=e/8|0;n[s]|=i,n[s+1]|=i>>>8},nA=function(n,e,i){i<<=e&7;var s=e/8|0;n[s]|=i,n[s+1]|=i>>>8,n[s+2]|=i>>>16},mk=function(n,e){for(var i=[],s=0;s<n.length;++s)n[s]&&i.push({s,f:n[s]});var r=i.length,o=i.slice();if(!r)return[gk,0];if(r==1){var a=new rs(i[0].s+1);return a[i[0].s]=1,[a,1]}i.sort(function(_,S){return _.f-S.f}),i.push({s:-1,f:25001});var l=i[0],c=i[1],h=0,u=1,d=2;for(i[0]={s:-1,f:l.f+c.f,l,r:c};u!=r-1;)l=i[i[h].f<i[d].f?h++:d++],c=i[h!=u&&i[h].f<i[d].f?h++:d++],i[u++]={s:-1,f:l.f+c.f,l,r:c};for(var m=o[0].s,s=1;s<r;++s)o[s].s>m&&(m=o[s].s);var f=new ho(m+1),g=fk(i[u-1],f,0);if(g>e){var s=0,y=0,v=g-e,b=1<<v;for(o.sort(function(S,M){return f[M.s]-f[S.s]||S.f-M.f});s<r;++s){var A=o[s].s;if(f[A]>e)y+=b-(1<<g-f[A]),f[A]=e;else break}for(y>>>=v;y>0;){var x=o[s].s;f[x]<e?y-=1<<e-f[x]++-1:++s}for(;s>=0&&y;--s){var w=o[s].s;f[w]==e&&(--f[w],++y)}g=e}return[new rs(f),g]},fk=function(n,e,i){return n.s==-1?Math.max(fk(n.l,e,i+1),fk(n.r,e,i+1)):e[n.s]=i},L4=function(n){for(var e=n.length;e&&!n[--e];);for(var i=new ho(++e),s=0,r=n[0],o=1,a=function(c){i[s++]=c},l=1;l<=e;++l)if(n[l]==r&&l!=e)++o;else{if(!r&&o>2){for(;o>138;o-=138)a(32754);o>2&&(a(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(a(r),--o;o>6;o-=6)a(8304);o>2&&(a(o-3<<5|8208),o=0)}for(;o--;)a(r);o=1,r=n[l]}return[i.subarray(0,s),e]},sA=function(n,e){for(var i=0,s=0;s<e.length;++s)i+=n[s]*e[s];return i},xC=function(n,e,i){var s=i.length,r=dk(e+2);n[r]=s&255,n[r+1]=s>>>8,n[r+2]=n[r]^255,n[r+3]=n[r+1]^255;for(var o=0;o<s;++o)n[r+o+4]=i[o];return(r+4+s)*8},P4=function(n,e,i,s,r,o,a,l,c,h,u){Vh(e,u++,i),++r[256];for(var d=mk(r,15),m=d[0],f=d[1],g=mk(o,15),y=g[0],v=g[1],b=L4(m),A=b[0],x=b[1],w=L4(y),_=w[0],S=w[1],M=new ho(19),R=0;R<A.length;++R)M[A[R]&31]++;for(var R=0;R<_.length;++R)M[_[R]&31]++;for(var P=mk(M,7),C=P[0],L=P[1],B=19;B>4&&!C[ak[B-1]];--B);var z=h+5<<3,D=sA(r,vd)+sA(o,iA)+a,W=sA(r,m)+sA(o,y)+a+14+3*B+sA(M,C)+(2*M[16]+3*M[17]+7*M[18]);if(z<=D&&z<=W)return xC(e,u,n.subarray(c,c+h));var O,F,X,J;if(Vh(e,u,1+(W<D)),u+=2,W<D){O=Ac(m,f,0),F=m,X=Ac(y,v,0),J=y;var q=Ac(C,L,0);Vh(e,u,x-257),Vh(e,u+5,S-1),Vh(e,u+10,B-4),u+=14;for(var R=0;R<B;++R)Vh(e,u+3*R,C[ak[R]]);u+=3*B;for(var oe=[A,_],_e=0;_e<2;++_e)for(var ke=oe[_e],R=0;R<ke.length;++R){var re=ke[R]&31;Vh(e,u,q[re]),u+=C[re],re>15&&(Vh(e,u,ke[R]>>>5&127),u+=ke[R]>>>12)}}else O=yfe,F=vd,X=bfe,J=iA;for(var R=0;R<l;++R)if(s[R]>255){var re=s[R]>>>18&31;nA(e,u,O[re+257]),u+=F[re+257],re>7&&(Vh(e,u,s[R]>>>23&31),u+=bC[re]);var we=s[R]&31;nA(e,u,X[we]),u+=J[we],we>3&&(nA(e,u,s[R]>>>5&8191),u+=AC[we])}else nA(e,u,O[s[R]]),u+=F[s[R]];return nA(e,u,O[256]),u+F[256]},wfe=new m0([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),gk=new rs(0),_fe=function(n,e,i,s,r,o){var a=n.length,l=new rs(s+a+5*(1+Math.ceil(a/7e3))+r),c=l.subarray(s,l.length-r),h=0;if(!e||a<8)for(var u=0;u<=a;u+=65535){var d=u+65535;d<a?h=xC(c,h,n.subarray(u,d)):(c[u]=o,h=xC(c,h,n.subarray(u,a)))}else{for(var m=wfe[e-1],f=m>>>13,g=m&8191,y=(1<<i)-1,v=new ho(32768),b=new ho(y+1),A=Math.ceil(i/3),x=2*A,w=function(Re){return(n[Re]^n[Re+1]<<A^n[Re+2]<<x)&y},_=new m0(25e3),S=new ho(288),M=new ho(32),R=0,P=0,u=0,C=0,L=0,B=0;u<a;++u){var z=w(u),D=u&32767,W=b[z];if(v[D]=W,b[z]=D,L<=u){var O=a-u;if((R>7e3||C>24576)&&O>423){h=P4(n,c,0,_,S,M,P,C,B,u-B,h),C=R=P=0,B=u;for(var F=0;F<286;++F)S[F]=0;for(var F=0;F<30;++F)M[F]=0}var X=2,J=0,q=g,oe=D-W&32767;if(O>2&&z==w(u-oe))for(var _e=Math.min(f,O)-1,ke=Math.min(32767,u),re=Math.min(258,O);oe<=ke&&--q&&D!=W;){if(n[u+X]==n[u+X-oe]){for(var we=0;we<re&&n[u+we]==n[u+we-oe];++we);if(we>X){if(X=we,J=oe,we>_e)break;for(var Me=Math.min(oe,we-2),it=0,F=0;F<Me;++F){var je=u-oe+F+32768&32767,Ge=v[je],rt=je-Ge+32768&32767;rt>it&&(it=rt,W=je)}}}D=W,W=v[D],oe+=D-W+32768&32767}if(J){_[C++]=268435456|lk[X]<<18|I4[J];var ge=lk[X]&31,Q=I4[J]&31;P+=bC[ge]+AC[Q],++S[257+ge],++M[Q],L=u+X,++R}else _[C++]=n[u],++S[n[u]]}}h=P4(n,c,o,_,S,M,P,C,B,u-B,h),!o&&h&7&&(h=xC(c,h+1,gk))}return pk(l,0,s+dk(h)+r)},Sfe=function(){for(var n=new m0(256),e=0;e<256;++e){for(var i=e,s=9;--s;)i=(i&1&&3988292384)^i>>>1;n[e]=i}return n}(),Cfe=function(){var n=-1;return{p:function(e){for(var i=n,s=0;s<e.length;++s)i=Sfe[i&255^e[s]]^i>>>8;n=i},d:function(){return~n}}},Mfe=function(n,e,i,s,r){return _fe(n,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(n.length)))*1.5):12+e.mem,i,s,!r)},B4=function(n,e){var i={};for(var s in n)i[s]=n[s];for(var s in e)i[s]=e[s];return i},nr=function(n,e,i){for(;i;++e)n[e]=i,i>>>=8},Efe=function(n){if((n[0]&15)!=8||n[0]>>>4>7||(n[0]<<8|n[1])%31)throw"invalid zlib data";if(n[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function Tfe(n,e){return Mfe(n,e||{},0,0)}function rA(n,e){return xfe((Efe(n),n.subarray(2,-4)),e)}var k4=function(n,e,i,s){for(var r in n){var o=n[r],a=e+r;o instanceof rs?i[a]=[o,s]:Array.isArray(o)?i[a]=[o[0],B4(s,o[1])]:k4(o,a+"/",i,s)}},D4=typeof TextEncoder<"u"&&new TextEncoder,Rfe=typeof TextDecoder<"u"&&new TextDecoder,Ife=0;try{Rfe.decode(gk,{stream:!0}),Ife=1}catch{}function wC(n,e){if(e){for(var i=new rs(n.length),s=0;s<n.length;++s)i[s]=n.charCodeAt(s);return i}if(D4)return D4.encode(n);for(var r=n.length,o=new rs(n.length+(n.length>>1)),a=0,l=function(d){o[a++]=d},s=0;s<r;++s){if(a+5>o.length){var c=new rs(a+8+(r-s<<1));c.set(o),o=c}var h=n.charCodeAt(s);h<128||e?l(h):h<2048?(l(192|h>>6),l(128|h&63)):h>55295&&h<57344?(h=65536+(h&1047552)|n.charCodeAt(++s)&1023,l(240|h>>18),l(128|h>>12&63),l(128|h>>6&63),l(128|h&63)):(l(224|h>>12),l(128|h>>6&63),l(128|h&63))}return pk(o,0,a)}var yk=function(n){var e=0;if(n)for(var i in n){var s=n[i].length;if(s>65535)throw"extra field too long";e+=s+4}return e},O4=function(n,e,i,s,r,o,a,l){var c=s.length,h=i.extra,u=l&&l.length,d=yk(h);nr(n,e,a!=null?33639248:67324752),e+=4,a!=null&&(n[e++]=20,n[e++]=i.os),n[e]=20,e+=2,n[e++]=i.flag<<1|(o==null&&8),n[e++]=r&&8,n[e++]=i.compression&255,n[e++]=i.compression>>8;var m=new Date(i.mtime==null?Date.now():i.mtime),f=m.getFullYear()-1980;if(f<0||f>119)throw"date not in range 1980-2099";if(nr(n,e,f<<25|m.getMonth()+1<<21|m.getDate()<<16|m.getHours()<<11|m.getMinutes()<<5|m.getSeconds()>>>1),e+=4,o!=null&&(nr(n,e,i.crc),nr(n,e+4,o),nr(n,e+8,i.size)),nr(n,e+12,c),nr(n,e+14,d),e+=16,a!=null&&(nr(n,e,u),nr(n,e+6,i.attrs),nr(n,e+10,a),e+=14),n.set(s,e),e+=c,d)for(var g in h){var y=h[g],v=y.length;nr(n,e,+g),nr(n,e+2,v),n.set(y,e+4),e+=4+v}return u&&(n.set(l,e),e+=u),e},Lfe=function(n,e,i,s,r){nr(n,e,101010256),nr(n,e+8,i),nr(n,e+10,i),nr(n,e+12,s),nr(n,e+16,r)};function Pfe(n,e){e||(e={});var i={},s=[];k4(n,"",i,e);var r=0,o=0;for(var a in i){var l=i[a],c=l[0],h=l[1],u=h.level==0?0:8,d=wC(a),m=d.length,f=h.comment,g=f&&wC(f),y=g&&g.length,v=yk(h.extra);if(m>65535)throw"filename too long";var b=u?Tfe(c,h):c,A=b.length,x=Cfe();x.p(c),s.push(B4(h,{size:c.length,crc:x.d(),c:b,f:d,m:g,u:m!=a.length||g&&f.length!=y,o:r,compression:u})),r+=30+m+v+A,o+=76+2*(m+v)+(y||0)+A}for(var w=new rs(o+22),_=r,S=o-r,M=0;M<s.length;++M){var d=s[M];O4(w,d.o,d,d.f,d.u,d.c.length);var R=30+d.f.length+yk(d.extra);w.set(d.c,d.o+R),O4(w,r,d,d.f,d.u,d.c.length,d.o,d.m),r+=16+R+(d.m?d.m.length:0)}return Lfe(w,r,s.length,S,_),w}class oA extends j2{constructor(e){super(e),this.type=ms}parse(e){const i=Math.pow(2.7182818,2.2);function s(I,k){let V=0;for(let U=0;U<65536;++U)(U==0||I[U>>3]&1<<(U&7))&&(k[V++]=U);const ee=V-1;for(;V<65536;)k[V++]=0;return ee}function r(I){for(let k=0;k<16384;k++)I[k]={},I[k].len=0,I[k].lit=0,I[k].p=null}const o={l:0,c:0,lc:0};function a(I,k,V,ee,U){for(;V<I;)k=k<<8|Q(ee,U),V+=8;V-=I,o.l=k>>V&(1<<I)-1,o.c=k,o.lc=V}const l=new Array(59);function c(I){for(let V=0;V<=58;++V)l[V]=0;for(let V=0;V<65537;++V)l[I[V]]+=1;let k=0;for(let V=58;V>0;--V){const ee=k+l[V]>>1;l[V]=k,k=ee}for(let V=0;V<65537;++V){const ee=I[V];ee>0&&(I[V]=ee|l[ee]++<<6)}}function h(I,k,V,ee,U,K){const j=k;let ae=0,ce=0;for(;ee<=U;ee++){if(j.value-k.value>V)return!1;a(6,ae,ce,I,j);const xe=o.l;if(ae=o.c,ce=o.lc,K[ee]=xe,xe==63){if(j.value-k.value>V)throw new Error("Something wrong with hufUnpackEncTable");a(8,ae,ce,I,j);let Ie=o.l+6;if(ae=o.c,ce=o.lc,ee+Ie>U+1)throw new Error("Something wrong with hufUnpackEncTable");for(;Ie--;)K[ee++]=0;ee--}else if(xe>=59){let Ie=xe-59+2;if(ee+Ie>U+1)throw new Error("Something wrong with hufUnpackEncTable");for(;Ie--;)K[ee++]=0;ee--}}c(K)}function u(I){return I&63}function d(I){return I>>6}function m(I,k,V,ee){for(;k<=V;k++){const U=d(I[k]),K=u(I[k]);if(U>>K)throw new Error("Invalid table entry");if(K>14){const j=ee[U>>K-14];if(j.len)throw new Error("Invalid table entry");if(j.lit++,j.p){const ae=j.p;j.p=new Array(j.lit);for(let ce=0;ce<j.lit-1;++ce)j.p[ce]=ae[ce]}else j.p=new Array(1);j.p[j.lit-1]=k}else if(K){let j=0;for(let ae=1<<14-K;ae>0;ae--){const ce=ee[(U<<14-K)+j];if(ce.len||ce.p)throw new Error("Invalid table entry");ce.len=K,ce.lit=k,j++}}}return!0}const f={c:0,lc:0};function g(I,k,V,ee){I=I<<8|Q(V,ee),k+=8,f.c=I,f.lc=k}const y={c:0,lc:0};function v(I,k,V,ee,U,K,j,ae,ce){if(I==k){ee<8&&(g(V,ee,U,K),V=f.c,ee=f.lc),ee-=8;let xe=V>>ee;if(xe=new Uint8Array([xe])[0],ae.value+xe>ce)return!1;const Ie=j[ae.value-1];for(;xe-- >0;)j[ae.value++]=Ie}else if(ae.value<ce)j[ae.value++]=I;else return!1;y.c=V,y.lc=ee}function b(I){return I&65535}function A(I){const k=b(I);return k>32767?k-65536:k}const x={a:0,b:0};function w(I,k){const V=A(I),ee=A(k),U=V+(ee&1)+(ee>>1),K=U,j=U-ee;x.a=K,x.b=j}function _(I,k){const V=b(I),ee=b(k),U=V-(ee>>1)&65535,K=ee+U-32768&65535;x.a=K,x.b=U}function S(I,k,V,ee,U,K,j){const ae=j<16384,ce=V>U?U:V;let xe=1,Ie,Ke;for(;xe<=ce;)xe<<=1;for(xe>>=1,Ie=xe,xe>>=1;xe>=1;){Ke=0;const Qe=Ke+K*(U-Ie),$e=K*xe,bt=K*Ie,ot=ee*xe,St=ee*Ie;let ti,Ui,hn,Ts;for(;Ke<=Qe;Ke+=bt){let Gi=Ke;const di=Ke+ee*(V-Ie);for(;Gi<=di;Gi+=St){const Fn=Gi+ot,wo=Gi+$e,Jn=wo+ot;ae?(w(I[Gi+k],I[wo+k]),ti=x.a,hn=x.b,w(I[Fn+k],I[Jn+k]),Ui=x.a,Ts=x.b,w(ti,Ui),I[Gi+k]=x.a,I[Fn+k]=x.b,w(hn,Ts),I[wo+k]=x.a,I[Jn+k]=x.b):(_(I[Gi+k],I[wo+k]),ti=x.a,hn=x.b,_(I[Fn+k],I[Jn+k]),Ui=x.a,Ts=x.b,_(ti,Ui),I[Gi+k]=x.a,I[Fn+k]=x.b,_(hn,Ts),I[wo+k]=x.a,I[Jn+k]=x.b)}if(V&xe){const Fn=Gi+$e;ae?w(I[Gi+k],I[Fn+k]):_(I[Gi+k],I[Fn+k]),ti=x.a,I[Fn+k]=x.b,I[Gi+k]=ti}}if(U&xe){let Gi=Ke;const di=Ke+ee*(V-Ie);for(;Gi<=di;Gi+=St){const Fn=Gi+ot;ae?w(I[Gi+k],I[Fn+k]):_(I[Gi+k],I[Fn+k]),ti=x.a,I[Fn+k]=x.b,I[Gi+k]=ti}}Ie=xe,xe>>=1}return Ke}function M(I,k,V,ee,U,K,j,ae,ce){let xe=0,Ie=0;const Ke=j,Qe=Math.trunc(ee.value+(U+7)/8);for(;ee.value<Qe;)for(g(xe,Ie,V,ee),xe=f.c,Ie=f.lc;Ie>=14;){const bt=xe>>Ie-14&16383,ot=k[bt];if(ot.len)Ie-=ot.len,v(ot.lit,K,xe,Ie,V,ee,ae,ce,Ke),xe=y.c,Ie=y.lc;else{if(!ot.p)throw new Error("hufDecode issues");let St;for(St=0;St<ot.lit;St++){const ti=u(I[ot.p[St]]);for(;Ie<ti&&ee.value<Qe;)g(xe,Ie,V,ee),xe=f.c,Ie=f.lc;if(Ie>=ti&&d(I[ot.p[St]])==(xe>>Ie-ti&(1<<ti)-1)){Ie-=ti,v(ot.p[St],K,xe,Ie,V,ee,ae,ce,Ke),xe=y.c,Ie=y.lc;break}}if(St==ot.lit)throw new Error("hufDecode issues")}}const $e=8-U&7;for(xe>>=$e,Ie-=$e;Ie>0;){const bt=k[xe<<14-Ie&16383];if(bt.len)Ie-=bt.len,v(bt.lit,K,xe,Ie,V,ee,ae,ce,Ke),xe=y.c,Ie=y.lc;else throw new Error("hufDecode issues")}return!0}function R(I,k,V,ee,U,K){const j={value:0},ae=V.value,ce=ge(k,V),xe=ge(k,V);V.value+=4;const Ie=ge(k,V);if(V.value+=4,ce<0||ce>=65537||xe<0||xe>=65537)throw new Error("Something wrong with HUF_ENCSIZE");const Ke=new Array(65537),Qe=new Array(16384);r(Qe);const $e=ee-(V.value-ae);if(h(I,V,$e,ce,xe,Ke),Ie>8*(ee-(V.value-ae)))throw new Error("Something wrong with hufUncompress");m(Ke,ce,xe,Qe),M(Ke,Qe,I,V,Ie,xe,K,U,j)}function P(I,k,V){for(let ee=0;ee<V;++ee)k[ee]=I[k[ee]]}function C(I){for(let k=1;k<I.length;k++){const V=I[k-1]+I[k]-128;I[k]=V}}function L(I,k){let V=0,ee=Math.floor((I.length+1)/2),U=0;const K=I.length-1;for(;!(U>K||(k[U++]=I[V++],U>K));)k[U++]=I[ee++]}function B(I){let k=I.byteLength;const V=new Array;let ee=0;const U=new DataView(I);for(;k>0;){const K=U.getInt8(ee++);if(K<0){const j=-K;k-=j+1;for(let ae=0;ae<j;ae++)V.push(U.getUint8(ee++))}else{const j=K;k-=2;const ae=U.getUint8(ee++);for(let ce=0;ce<j+1;ce++)V.push(ae)}}return V}function z(I,k,V,ee,U,K){let j=new DataView(K.buffer);const ae=V[I.idx[0]].width,ce=V[I.idx[0]].height,xe=3,Ie=Math.floor(ae/8),Ke=Math.ceil(ae/8),Qe=Math.ceil(ce/8),$e=ae-(Ke-1)*8,bt=ce-(Qe-1)*8,ot={value:0},St=new Array(xe),ti=new Array(xe),Ui=new Array(xe),hn=new Array(xe),Ts=new Array(xe);for(let di=0;di<xe;++di)Ts[di]=k[I.idx[di]],St[di]=di<1?0:St[di-1]+Ke*Qe,ti[di]=new Float32Array(64),Ui[di]=new Uint16Array(64),hn[di]=new Uint16Array(Ke*64);for(let di=0;di<Qe;++di){let Fn=8;di==Qe-1&&(Fn=bt);let wo=8;for(let N=0;N<Ke;++N){N==Ke-1&&(wo=$e);for(let ne=0;ne<xe;++ne)Ui[ne].fill(0),Ui[ne][0]=U[St[ne]++],D(ot,ee,Ui[ne]),W(Ui[ne],ti[ne]),O(ti[ne]);F(ti);for(let ne=0;ne<xe;++ne)X(ti[ne],hn[ne],N*64)}let Jn=0;for(let N=0;N<xe;++N){const ne=V[I.idx[N]].type;for(let fe=8*di;fe<8*di+Fn;++fe){Jn=Ts[N][fe];for(let ve=0;ve<Ie;++ve){const le=ve*64+(fe&7)*8;j.setUint16(Jn+0*2*ne,hn[N][le+0],!0),j.setUint16(Jn+1*2*ne,hn[N][le+1],!0),j.setUint16(Jn+2*2*ne,hn[N][le+2],!0),j.setUint16(Jn+3*2*ne,hn[N][le+3],!0),j.setUint16(Jn+4*2*ne,hn[N][le+4],!0),j.setUint16(Jn+5*2*ne,hn[N][le+5],!0),j.setUint16(Jn+6*2*ne,hn[N][le+6],!0),j.setUint16(Jn+7*2*ne,hn[N][le+7],!0),Jn+=8*2*ne}}if(Ie!=Ke)for(let fe=8*di;fe<8*di+Fn;++fe){const ve=Ts[N][fe]+8*Ie*2*ne,le=Ie*64+(fe&7)*8;for(let et=0;et<wo;++et)j.setUint16(ve+et*2*ne,hn[N][le+et],!0)}}}const Gi=new Uint16Array(ae);j=new DataView(K.buffer);for(let di=0;di<xe;++di){V[I.idx[di]].decoded=!0;const Fn=V[I.idx[di]].type;if(V[di].type==2)for(let wo=0;wo<ce;++wo){const Jn=Ts[di][wo];for(let N=0;N<ae;++N)Gi[N]=j.getUint16(Jn+N*2*Fn,!0);for(let N=0;N<ae;++N)j.setFloat32(Jn+N*2*Fn,be(Gi[N]),!0)}}}function D(I,k,V){let ee,U=1;for(;U<64;)ee=k[I.value],ee==65280?U=64:ee>>8==255?U+=ee&255:(V[U]=ee,U++),I.value++}function W(I,k){k[0]=be(I[0]),k[1]=be(I[1]),k[2]=be(I[5]),k[3]=be(I[6]),k[4]=be(I[14]),k[5]=be(I[15]),k[6]=be(I[27]),k[7]=be(I[28]),k[8]=be(I[2]),k[9]=be(I[4]),k[10]=be(I[7]),k[11]=be(I[13]),k[12]=be(I[16]),k[13]=be(I[26]),k[14]=be(I[29]),k[15]=be(I[42]),k[16]=be(I[3]),k[17]=be(I[8]),k[18]=be(I[12]),k[19]=be(I[17]),k[20]=be(I[25]),k[21]=be(I[30]),k[22]=be(I[41]),k[23]=be(I[43]),k[24]=be(I[9]),k[25]=be(I[11]),k[26]=be(I[18]),k[27]=be(I[24]),k[28]=be(I[31]),k[29]=be(I[40]),k[30]=be(I[44]),k[31]=be(I[53]),k[32]=be(I[10]),k[33]=be(I[19]),k[34]=be(I[23]),k[35]=be(I[32]),k[36]=be(I[39]),k[37]=be(I[45]),k[38]=be(I[52]),k[39]=be(I[54]),k[40]=be(I[20]),k[41]=be(I[22]),k[42]=be(I[33]),k[43]=be(I[38]),k[44]=be(I[46]),k[45]=be(I[51]),k[46]=be(I[55]),k[47]=be(I[60]),k[48]=be(I[21]),k[49]=be(I[34]),k[50]=be(I[37]),k[51]=be(I[47]),k[52]=be(I[50]),k[53]=be(I[56]),k[54]=be(I[59]),k[55]=be(I[61]),k[56]=be(I[35]),k[57]=be(I[36]),k[58]=be(I[48]),k[59]=be(I[49]),k[60]=be(I[57]),k[61]=be(I[58]),k[62]=be(I[62]),k[63]=be(I[63])}function O(I){const k=.5*Math.cos(.7853975),V=.5*Math.cos(3.14159/16),ee=.5*Math.cos(3.14159/8),U=.5*Math.cos(3*3.14159/16),K=.5*Math.cos(5*3.14159/16),j=.5*Math.cos(3*3.14159/8),ae=.5*Math.cos(7*3.14159/16),ce=new Array(4),xe=new Array(4),Ie=new Array(4),Ke=new Array(4);for(let Qe=0;Qe<8;++Qe){const $e=Qe*8;ce[0]=ee*I[$e+2],ce[1]=j*I[$e+2],ce[2]=ee*I[$e+6],ce[3]=j*I[$e+6],xe[0]=V*I[$e+1]+U*I[$e+3]+K*I[$e+5]+ae*I[$e+7],xe[1]=U*I[$e+1]-ae*I[$e+3]-V*I[$e+5]-K*I[$e+7],xe[2]=K*I[$e+1]-V*I[$e+3]+ae*I[$e+5]+U*I[$e+7],xe[3]=ae*I[$e+1]-K*I[$e+3]+U*I[$e+5]-V*I[$e+7],Ie[0]=k*(I[$e+0]+I[$e+4]),Ie[3]=k*(I[$e+0]-I[$e+4]),Ie[1]=ce[0]+ce[3],Ie[2]=ce[1]-ce[2],Ke[0]=Ie[0]+Ie[1],Ke[1]=Ie[3]+Ie[2],Ke[2]=Ie[3]-Ie[2],Ke[3]=Ie[0]-Ie[1],I[$e+0]=Ke[0]+xe[0],I[$e+1]=Ke[1]+xe[1],I[$e+2]=Ke[2]+xe[2],I[$e+3]=Ke[3]+xe[3],I[$e+4]=Ke[3]-xe[3],I[$e+5]=Ke[2]-xe[2],I[$e+6]=Ke[1]-xe[1],I[$e+7]=Ke[0]-xe[0]}for(let Qe=0;Qe<8;++Qe)ce[0]=ee*I[16+Qe],ce[1]=j*I[16+Qe],ce[2]=ee*I[48+Qe],ce[3]=j*I[48+Qe],xe[0]=V*I[8+Qe]+U*I[24+Qe]+K*I[40+Qe]+ae*I[56+Qe],xe[1]=U*I[8+Qe]-ae*I[24+Qe]-V*I[40+Qe]-K*I[56+Qe],xe[2]=K*I[8+Qe]-V*I[24+Qe]+ae*I[40+Qe]+U*I[56+Qe],xe[3]=ae*I[8+Qe]-K*I[24+Qe]+U*I[40+Qe]-V*I[56+Qe],Ie[0]=k*(I[Qe]+I[32+Qe]),Ie[3]=k*(I[Qe]-I[32+Qe]),Ie[1]=ce[0]+ce[3],Ie[2]=ce[1]-ce[2],Ke[0]=Ie[0]+Ie[1],Ke[1]=Ie[3]+Ie[2],Ke[2]=Ie[3]-Ie[2],Ke[3]=Ie[0]-Ie[1],I[0+Qe]=Ke[0]+xe[0],I[8+Qe]=Ke[1]+xe[1],I[16+Qe]=Ke[2]+xe[2],I[24+Qe]=Ke[3]+xe[3],I[32+Qe]=Ke[3]-xe[3],I[40+Qe]=Ke[2]-xe[2],I[48+Qe]=Ke[1]-xe[1],I[56+Qe]=Ke[0]-xe[0]}function F(I){for(let k=0;k<64;++k){const V=I[0][k],ee=I[1][k],U=I[2][k];I[0][k]=V+1.5747*U,I[1][k]=V-.1873*ee-.4682*U,I[2][k]=V+1.8556*ee}}function X(I,k,V){for(let ee=0;ee<64;++ee)k[V+ee]=Ip.toHalfFloat(J(I[ee]))}function J(I){return I<=1?Math.sign(I)*Math.pow(Math.abs(I),2.2):Math.sign(I)*Math.pow(i,Math.abs(I)-1)}function q(I){return new DataView(I.array.buffer,I.offset.value,I.size)}function oe(I){const k=I.viewer.buffer.slice(I.offset.value,I.offset.value+I.size),V=new Uint8Array(B(k)),ee=new Uint8Array(V.length);return C(V),L(V,ee),new DataView(ee.buffer)}function _e(I){const k=I.array.slice(I.offset.value,I.offset.value+I.size),V=rA(k),ee=new Uint8Array(V.length);return C(V),L(V,ee),new DataView(ee.buffer)}function ke(I){const k=I.viewer,V={value:I.offset.value},ee=new Uint16Array(I.width*I.scanlineBlockSize*(I.channels*I.type)),U=new Uint8Array(8192);let K=0;const j=new Array(I.channels);for(let bt=0;bt<I.channels;bt++)j[bt]={},j[bt].start=K,j[bt].end=j[bt].start,j[bt].nx=I.width,j[bt].ny=I.lines,j[bt].size=I.type,K+=j[bt].nx*j[bt].ny*j[bt].size;const ae=nt(k,V),ce=nt(k,V);if(ce>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(ae<=ce)for(let bt=0;bt<ce-ae+1;bt++)U[bt+ae]=Ne(k,V);const xe=new Uint16Array(65536),Ie=s(U,xe),Ke=ge(k,V);R(I.array,k,V,Ke,ee,K);for(let bt=0;bt<I.channels;++bt){const ot=j[bt];for(let St=0;St<j[bt].size;++St)S(ee,ot.start+St,ot.nx,ot.size,ot.ny,ot.nx*ot.size,Ie)}P(xe,ee,K);let Qe=0;const $e=new Uint8Array(ee.buffer.byteLength);for(let bt=0;bt<I.lines;bt++)for(let ot=0;ot<I.channels;ot++){const St=j[ot],ti=St.nx*St.size,Ui=new Uint8Array(ee.buffer,St.end*2,ti*2);$e.set(Ui,Qe),Qe+=ti*2,St.end+=ti}return new DataView($e.buffer)}function re(I){const k=I.array.slice(I.offset.value,I.offset.value+I.size),V=rA(k),ee=I.lines*I.channels*I.width,U=I.type==1?new Uint16Array(ee):new Uint32Array(ee);let K=0,j=0;const ae=new Array(4);for(let ce=0;ce<I.lines;ce++)for(let xe=0;xe<I.channels;xe++){let Ie=0;switch(I.type){case 1:ae[0]=K,ae[1]=ae[0]+I.width,K=ae[1]+I.width;for(let Ke=0;Ke<I.width;++Ke){const Qe=V[ae[0]++]<<8|V[ae[1]++];Ie+=Qe,U[j]=Ie,j++}break;case 2:ae[0]=K,ae[1]=ae[0]+I.width,ae[2]=ae[1]+I.width,K=ae[2]+I.width;for(let Ke=0;Ke<I.width;++Ke){const Qe=V[ae[0]++]<<24|V[ae[1]++]<<16|V[ae[2]++]<<8;Ie+=Qe,U[j]=Ie,j++}break}}return new DataView(U.buffer)}function we(I){const k=I.viewer,V={value:I.offset.value},ee=new Uint8Array(I.width*I.lines*(I.channels*I.type*2)),U={version:Re(k,V),unknownUncompressedSize:Re(k,V),unknownCompressedSize:Re(k,V),acCompressedSize:Re(k,V),dcCompressedSize:Re(k,V),rleCompressedSize:Re(k,V),rleUncompressedSize:Re(k,V),rleRawSize:Re(k,V),totalAcUncompressedCount:Re(k,V),totalDcUncompressedCount:Re(k,V),acCompression:Re(k,V)};if(U.version<2)throw new Error("EXRLoader.parse: "+qt.compression+" version "+U.version+" is unsupported");const K=new Array;let j=nt(k,V)-2;for(;j>0;){const ot=Me(k.buffer,V),St=Ne(k,V),ti=St>>2&3,Ui=(St>>4)-1,hn=new Int8Array([Ui])[0],Ts=Ne(k,V);K.push({name:ot,index:hn,type:Ts,compression:ti}),j-=ot.length+3}const ae=qt.channels,ce=new Array(I.channels);for(let ot=0;ot<I.channels;++ot){const St=ce[ot]={},ti=ae[ot];St.name=ti.name,St.compression=0,St.decoded=!1,St.type=ti.pixelType,St.pLinear=ti.pLinear,St.width=I.width,St.height=I.lines}const xe={idx:new Array(3)};for(let ot=0;ot<I.channels;++ot){const St=ce[ot];for(let ti=0;ti<K.length;++ti){const Ui=K[ti];St.name==Ui.name&&(St.compression=Ui.compression,Ui.index>=0&&(xe.idx[Ui.index]=ot),St.offset=ot)}}let Ie,Ke,Qe;if(U.acCompressedSize>0)switch(U.acCompression){case 0:Ie=new Uint16Array(U.totalAcUncompressedCount),R(I.array,k,V,U.acCompressedSize,Ie,U.totalAcUncompressedCount);break;case 1:const ot=I.array.slice(V.value,V.value+U.totalAcUncompressedCount),St=rA(ot);Ie=new Uint16Array(St.buffer),V.value+=U.totalAcUncompressedCount;break}if(U.dcCompressedSize>0){const ot={array:I.array,offset:V,size:U.dcCompressedSize};Ke=new Uint16Array(_e(ot).buffer),V.value+=U.dcCompressedSize}if(U.rleRawSize>0){const ot=I.array.slice(V.value,V.value+U.rleCompressedSize),St=rA(ot);Qe=B(St.buffer),V.value+=U.rleCompressedSize}let $e=0;const bt=new Array(ce.length);for(let ot=0;ot<bt.length;++ot)bt[ot]=new Array;for(let ot=0;ot<I.lines;++ot)for(let St=0;St<ce.length;++St)bt[St].push($e),$e+=ce[St].width*I.type*2;z(xe,bt,ce,Ie,Ke,ee);for(let ot=0;ot<ce.length;++ot){const St=ce[ot];if(!St.decoded)switch(St.compression){case 2:let ti=0,Ui=0;for(let hn=0;hn<I.lines;++hn){let Ts=bt[ot][ti];for(let Gi=0;Gi<St.width;++Gi){for(let di=0;di<2*St.type;++di)ee[Ts++]=Qe[Ui+di*St.width*St.height];Ui++}ti++}break;case 1:default:throw new Error("EXRLoader.parse: unsupported channel compression")}}return new DataView(ee.buffer)}function Me(I,k){const V=new Uint8Array(I);let ee=0;for(;V[k.value+ee]!=0;)ee+=1;const U=new TextDecoder().decode(V.slice(k.value,k.value+ee));return k.value=k.value+ee+1,U}function it(I,k,V){const ee=new TextDecoder().decode(new Uint8Array(I).slice(k.value,k.value+V));return k.value=k.value+V,ee}function je(I,k){const V=rt(I,k),ee=ge(I,k);return[V,ee]}function Ge(I,k){const V=ge(I,k),ee=ge(I,k);return[V,ee]}function rt(I,k){const V=I.getInt32(k.value,!0);return k.value=k.value+4,V}function ge(I,k){const V=I.getUint32(k.value,!0);return k.value=k.value+4,V}function Q(I,k){const V=I[k.value];return k.value=k.value+1,V}function Ne(I,k){const V=I.getUint8(k.value);return k.value=k.value+1,V}const Re=function(I,k){let V;return"getBigInt64"in DataView.prototype?V=Number(I.getBigInt64(k.value,!0)):V=I.getUint32(k.value+4,!0)+Number(I.getUint32(k.value,!0)<<32),k.value+=8,V};function Te(I,k){const V=I.getFloat32(k.value,!0);return k.value+=4,V}function We(I,k){return Ip.toHalfFloat(Te(I,k))}function be(I){const k=(I&31744)>>10,V=I&1023;return(I>>15?-1:1)*(k?k===31?V?NaN:1/0:Math.pow(2,k-15)*(1+V/1024):6103515625e-14*(V/1024))}function nt(I,k){const V=I.getUint16(k.value,!0);return k.value+=2,V}function ct(I,k){return be(nt(I,k))}function It(I,k,V,ee){const U=V.value,K=[];for(;V.value<U+ee-1;){const j=Me(k,V),ae=rt(I,V),ce=Ne(I,V);V.value+=3;const xe=rt(I,V),Ie=rt(I,V);K.push({name:j,pixelType:ae,pLinear:ce,xSampling:xe,ySampling:Ie})}return V.value+=1,K}function H(I,k){const V=Te(I,k),ee=Te(I,k),U=Te(I,k),K=Te(I,k),j=Te(I,k),ae=Te(I,k),ce=Te(I,k),xe=Te(I,k);return{redX:V,redY:ee,greenX:U,greenY:K,blueX:j,blueY:ae,whiteX:ce,whiteY:xe}}function G(I,k){const V=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],ee=Ne(I,k);return V[ee]}function ue(I,k){const V=ge(I,k),ee=ge(I,k),U=ge(I,k),K=ge(I,k);return{xMin:V,yMin:ee,xMax:U,yMax:K}}function Ee(I,k){const V=["INCREASING_Y"],ee=Ne(I,k);return V[ee]}function De(I,k){const V=Te(I,k),ee=Te(I,k);return[V,ee]}function Le(I,k){const V=Te(I,k),ee=Te(I,k),U=Te(I,k);return[V,ee,U]}function At(I,k,V,ee,U){if(ee==="string"||ee==="stringvector"||ee==="iccProfile")return it(k,V,U);if(ee==="chlist")return It(I,k,V,U);if(ee==="chromaticities")return H(I,V);if(ee==="compression")return G(I,V);if(ee==="box2i")return ue(I,V);if(ee==="lineOrder")return Ee(I,V);if(ee==="float")return Te(I,V);if(ee==="v2f")return De(I,V);if(ee==="v3f")return Le(I,V);if(ee==="int")return rt(I,V);if(ee==="rational")return je(I,V);if(ee==="timecode")return Ge(I,V);if(ee==="preview")return V.value+=U,"skipped";V.value+=U}function ht(I,k,V){const ee={};if(I.getUint32(0,!0)!=20000630)throw new Error("THREE.EXRLoader: Provided file doesn't appear to be in OpenEXR format.");ee.version=I.getUint8(4);const U=I.getUint8(5);ee.spec={singleTile:!!(U&2),longName:!!(U&4),deepFormat:!!(U&8),multiPart:!!(U&16)},V.value=8;let K=!0;for(;K;){const j=Me(k,V);if(j==0)K=!1;else{const ae=Me(k,V),ce=ge(I,V),xe=At(I,k,V,ae,ce);xe===void 0?console.warn(`THREE.EXRLoader: Skipped unknown header attribute type '${ae}'.`):ee[j]=xe}}if(U&-5)throw console.error("THREE.EXRHeader:",ee),new Error("THREE.EXRLoader: Provided file is currently unsupported.");return ee}function Ue(I,k,V,ee,U){const K={size:0,viewer:k,array:V,offset:ee,width:I.dataWindow.xMax-I.dataWindow.xMin+1,height:I.dataWindow.yMax-I.dataWindow.yMin+1,channels:I.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:I.channels[0].pixelType,uncompress:null,getter:null,format:null,colorSpace:Bi};switch(I.compression){case"NO_COMPRESSION":K.lines=1,K.uncompress=q;break;case"RLE_COMPRESSION":K.lines=1,K.uncompress=oe;break;case"ZIPS_COMPRESSION":K.lines=1,K.uncompress=_e;break;case"ZIP_COMPRESSION":K.lines=16,K.uncompress=_e;break;case"PIZ_COMPRESSION":K.lines=32,K.uncompress=ke;break;case"PXR24_COMPRESSION":K.lines=16,K.uncompress=re;break;case"DWAA_COMPRESSION":K.lines=32,K.uncompress=we;break;case"DWAB_COMPRESSION":K.lines=256,K.uncompress=we;break;default:throw new Error("EXRLoader.parse: "+I.compression+" is unsupported")}if(K.scanlineBlockSize=K.lines,K.type==1)switch(U){case Hi:K.getter=ct,K.inputSize=2;break;case ms:K.getter=nt,K.inputSize=2;break}else if(K.type==2)switch(U){case Hi:K.getter=Te,K.inputSize=4;break;case ms:K.getter=We,K.inputSize=4}else throw new Error("EXRLoader.parse: unsupported pixelType "+K.type+" for "+I.compression+".");K.blockCount=(I.dataWindow.yMax+1)/K.scanlineBlockSize;for(let ae=0;ae<K.blockCount;ae++)Re(k,ee);K.outputChannels=K.channels==3?4:K.channels;const j=K.width*K.height*K.outputChannels;switch(U){case Hi:K.byteArray=new Float32Array(j),K.channels<K.outputChannels&&K.byteArray.fill(1,0,j);break;case ms:K.byteArray=new Uint16Array(j),K.channels<K.outputChannels&&K.byteArray.fill(15360,0,j);break;default:console.error("THREE.EXRLoader: unsupported type: ",U);break}return K.bytesPerLine=K.width*K.inputSize*K.channels,K.outputChannels==4?(K.format=_i,K.colorSpace=Bi):(K.format=Sp,K.colorSpace=Co),K}const Xe=new DataView(e),Ct=new Uint8Array(e),ze={value:0},qt=ht(Xe,e,ze),Oe=Ue(qt,Xe,Ct,ze,this.type),_t={value:0},ut={R:0,G:1,B:2,A:3,Y:0};for(let I=0;I<Oe.height/Oe.scanlineBlockSize;I++){const k=ge(Xe,ze);Oe.size=ge(Xe,ze),Oe.lines=k+Oe.scanlineBlockSize>Oe.height?Oe.height-k:Oe.scanlineBlockSize;const V=Oe.size<Oe.lines*Oe.bytesPerLine?Oe.uncompress(Oe):q(Oe);ze.value+=Oe.size;for(let ee=0;ee<Oe.scanlineBlockSize;ee++){const U=ee+I*Oe.scanlineBlockSize;if(U>=Oe.height)break;for(let K=0;K<Oe.channels;K++){const j=ut[qt.channels[K].name];for(let ae=0;ae<Oe.width;ae++){_t.value=(ee*(Oe.channels*Oe.width)+K*Oe.width+ae)*Oe.inputSize;const ce=(Oe.height-1-U)*(Oe.width*Oe.outputChannels)+ae*Oe.outputChannels+j;Oe.byteArray[ce]=Oe.getter(V,_t)}}}}return{header:qt,width:Oe.width,height:Oe.height,data:Oe.byteArray,format:Oe.format,colorSpace:Oe.colorSpace,type:this.type}}setDataType(e){return this.type=e,this}load(e,i,s,r){function o(a,l){a.colorSpace=l.colorSpace,a.minFilter=Ot,a.magFilter=Ot,a.generateMipmaps=!1,a.flipY=!1,i&&i(a,l)}return super.load(e,o,s,r)}}const Bfe=Object.freeze(Object.defineProperty({__proto__:null,EXRLoader:oA},Symbol.toStringTag,{value:"Module"}));class _C extends j2{constructor(e){super(e),this.type=ms}parse(e){const i=function(b,A){switch(b){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(A||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(A||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(A||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(A||""))}},s=`
`,r=function(b,A,x){A=A||1024;let w=b.pos,_=-1,S=0,M="",R=String.fromCharCode.apply(null,new Uint16Array(b.subarray(w,w+128)));for(;0>(_=R.indexOf(s))&&S<A&&w<b.byteLength;)M+=R,S+=R.length,w+=128,R+=String.fromCharCode.apply(null,new Uint16Array(b.subarray(w,w+128)));return-1<_?(x!==!1&&(b.pos+=S+_+1),M+R.slice(0,_)):!1},o=function(b){const A=/^#\?(\S+)/,x=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,w=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,_=/^\s*FORMAT=(\S+)\s*$/,S=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,M={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let R,P;for((b.pos>=b.byteLength||!(R=r(b)))&&i(1,"no header found"),(P=R.match(A))||i(3,"bad initial token"),M.valid|=1,M.programtype=P[1],M.string+=R+`
`;R=r(b),R!==!1;){if(M.string+=R+`
`,R.charAt(0)==="#"){M.comments+=R+`
`;continue}if((P=R.match(x))&&(M.gamma=parseFloat(P[1])),(P=R.match(w))&&(M.exposure=parseFloat(P[1])),(P=R.match(_))&&(M.valid|=2,M.format=P[1]),(P=R.match(S))&&(M.valid|=4,M.height=parseInt(P[1],10),M.width=parseInt(P[2],10)),M.valid&2&&M.valid&4)break}return M.valid&2||i(3,"missing format specifier"),M.valid&4||i(3,"missing image size specifier"),M},a=function(b,A,x){const w=A;if(w<8||w>32767||b[0]!==2||b[1]!==2||b[2]&128)return new Uint8Array(b);w!==(b[2]<<8|b[3])&&i(3,"wrong scanline width");const _=new Uint8Array(4*A*x);_.length||i(4,"unable to allocate buffer space");let S=0,M=0;const R=4*w,P=new Uint8Array(4),C=new Uint8Array(R);let L=x;for(;L>0&&M<b.byteLength;){M+4>b.byteLength&&i(1),P[0]=b[M++],P[1]=b[M++],P[2]=b[M++],P[3]=b[M++],(P[0]!=2||P[1]!=2||(P[2]<<8|P[3])!=w)&&i(3,"bad rgbe scanline format");let B=0,z;for(;B<R&&M<b.byteLength;){z=b[M++];const W=z>128;if(W&&(z-=128),(z===0||B+z>R)&&i(3,"bad scanline data"),W){const O=b[M++];for(let F=0;F<z;F++)C[B++]=O}else C.set(b.subarray(M,M+z),B),B+=z,M+=z}const D=w;for(let W=0;W<D;W++){let O=0;_[S]=C[W+O],O+=w,_[S+1]=C[W+O],O+=w,_[S+2]=C[W+O],O+=w,_[S+3]=C[W+O],S+=4}L--}return _},l=function(b,A,x,w){const _=b[A+3],S=Math.pow(2,_-128)/255;x[w+0]=b[A+0]*S,x[w+1]=b[A+1]*S,x[w+2]=b[A+2]*S,x[w+3]=1},c=function(b,A,x,w){const _=b[A+3],S=Math.pow(2,_-128)/255;x[w+0]=Ip.toHalfFloat(Math.min(b[A+0]*S,65504)),x[w+1]=Ip.toHalfFloat(Math.min(b[A+1]*S,65504)),x[w+2]=Ip.toHalfFloat(Math.min(b[A+2]*S,65504)),x[w+3]=Ip.toHalfFloat(1)},h=new Uint8Array(e);h.pos=0;const u=o(h),d=u.width,m=u.height,f=a(h.subarray(h.pos),d,m);let g,y,v;switch(this.type){case Hi:v=f.length/4;const b=new Float32Array(v*4);for(let x=0;x<v;x++)l(f,x*4,b,x*4);g=b,y=Hi;break;case ms:v=f.length/4;const A=new Uint16Array(v*4);for(let x=0;x<v;x++)c(f,x*4,A,x*4);g=A,y=ms;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:d,height:m,data:g,header:u.string,gamma:u.gamma,exposure:u.exposure,type:y}}setDataType(e){return this.type=e,this}load(e,i,s,r){function o(a,l){switch(a.type){case Hi:case ms:a.colorSpace=Bi,a.minFilter=Ot,a.magFilter=Ot,a.generateMipmaps=!1,a.flipY=!0;break}i&&i(a,l)}return super.load(e,o,s,r)}}const kfe=Object.freeze(Object.defineProperty({__proto__:null,RGBELoader:_C},Symbol.toStringTag,{value:"Module"})),G4="NEEDLE_lightmaps",aA=te("debuglightmapsextension")||te("debuglightmaps");var bd=(n=>(n[n.Lightmap=0]="Lightmap",n[n.Skybox=1]="Skybox",n[n.Reflection=2]="Reflection",n))(bd||{});class Dfe{constructor(e,i,s){p(this,"parser"),p(this,"registry"),p(this,"source"),this.parser=e,this.registry=i,this.source=s}get name(){return G4}afterRoot(e){const i=this.parser.json.extensions;if(i){const s=i[G4];if(s){const r=s.textures;return r!=null&&r.length?(aA&&console.log(s),new Promise(async(o,a)=>{const l=[];for(const h of r)if(h.pointer){aA&&console.log(h);let u=null;if(h.pointer.startsWith("/textures/"))aA&&console.log("Load texture from gltf",h.pointer),u=XB(this.parser,h.pointer).then(d=>this.resolveTexture(h,d));else if(typeof h.pointer=="string"){aA&&console.log("Load texture from path",h.pointer);const d=Vu(this.source,h.pointer);let m;d.endsWith(".exr")?m=new oA(this.parser.options.manager):d.endsWith(".hdr")?m=new _C(this.parser.options.manager):m=new sc(this.parser.options.manager),u=m.loadAsync(d,void 0).then(f=>this.resolveTexture(h,f))}else h.pointer;u&&l.push(u)}const c=await h_(l);c!=null&&c.anyFailed&&Ye()&&console.error("Failed to load lightmap extension",c),o()})):null}}return null}resolveTexture(e,i){const s=i;aA&&console.log("Lightmap loaded:",s),s!=null&&s.isTexture&&(this.registry?(s.colorSpace=Bi,this.registry.registerTexture(this.source,e.type,s,e.index)):console.log(bd[e.type],e.pointer,s))}}const z4=!!te("debuglightmaps");class Ofe{constructor(e){p(this,"_context"),p(this,"_lightmaps",new Map),this._context=e}clear(){this._lightmaps.clear()}registerTexture(e,i,s,r){z4&&console.log("Registering ",bd[i]+' "'+e+'"',s),this._lightmaps.has(e)||this._lightmaps.set(e,new Map);const o=this._lightmaps.get(e),a=o?.get(i)??[];a.length<r&&(a.length=r+1),a[r]=s,o?.set(i,a)}tryGetLightmap(e,i=0){return this.tryGet(e,bd.Lightmap,i)}tryGetSkybox(e){return this.tryGet(e,bd.Skybox,0)}tryGetReflection(e){return this.tryGet(e,bd.Reflection,0)}tryGet(e,i,s){if(!e)return z4&&console.warn("Missing source id"),null;const r=this._lightmaps.get(e);if(!r)return null;const o=r.get(i);return o===void 0||!(o!=null&&o.length)||o.length<=s?null:o[s]}}Mt.lights_fragment_maps=Mt.lights_fragment_maps.replace("vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );",`
    vec2 lUv = vLightMapUv.xy * lightmapScaleOffset.xy + vec2(lightmapScaleOffset.z, (1. - (lightmapScaleOffset.y + lightmapScaleOffset.w)));
    vec4 lightMapTexel = texture2D( lightMap, lUv);
    // The range of RGBM lightmaps goes from 0 to 34.49 (5^2.2) in linear space, and from 0 to 5 in gamma space.
    lightMapTexel.rgb *= lightMapTexel.a * 8.; // no idea where that "8" comes from... heuristically derived
    lightMapTexel.a = 1.;
    lightMapTexel = conv_sRGBToLinear(lightMapTexel);
    `),Mt.lightmap_pars_fragment=`
    #ifdef USE_LIGHTMAP
        uniform sampler2D lightMap;
        uniform float lightMapIntensity;
        uniform vec4 lightmapScaleOffset;
        
        // took from threejs 05fc79cd52b79e8c3e8dec1e7dca72c5c39983a4
        vec4 conv_sRGBToLinear( in vec4 value ) {
            return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
        }
    #endif
    `,Mt.lights_fragment_begin=Mt.lights_fragment_begin.replace("irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );",`
#if defined(USE_LIGHTMAP)
irradiance += 0.;
#else
irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
#endif`),Ve.lightmap.lightmapScaleOffset={value:new Ze(1,1,0,0)};const vk=te("debugprogressive"),SC=new Wt,CC=new tn;class Gfe{constructor(e){p(this,"context"),p(this,"_lodsManager"),this.context=e}get manager(){return this._lodsManager}get targetTriangleDensity(){var e;return((e=this._lodsManager)==null?void 0:e.targetTriangleDensity)??-1}set targetTriangleDensity(e){this._lodsManager&&(this._lodsManager.targetTriangleDensity=e)}setRenderer(e){var i;(i=this._lodsManager)==null||i.disable(),Na.removePlugin(this),Na.addPlugin(this),Na.debugDrawLine=ft.DrawLine,this._lodsManager=Na.get(e),this._lodsManager.enable()}onAfterUpdatedLOD(e,i,s,r,o){vk&&this.onRenderDebug(s,r,o)}onRenderDebug(e,i,s){var r,o,a;if(!i.geometry||!mi.hasLODLevelAvailable(i.geometry)&&!mi.hasLODLevelAvailable(i.material))return;const l=Na.getObjectLODState(i);if(!l)return;let c=s.mesh_lod;const h=s.mesh_lod!=l.lastLodLevel_Mesh||s.texture_lod!=l.lastLodLevel_Texture;if(vk&&i.geometry.boundingSphere){const u=i.geometry.boundingSphere;CC.copy(u),CC.applyMatrix4(i.matrixWorld);const d=CC.center,m=CC.radius,f=["#76c43e","#bcc43e","#c4ac3e","#c4673e","#ff3e3e"];if(h)ft.DrawWireSphere(d,m,f[c],.1);else{const g=((r=i.geometry.index)==null?void 0:r.count)??0,y=(o=mi.getMeshLODInformation(i.geometry))==null?void 0:o.lods;c=y?Math.min(y?.length-1,c):0;let v="";if(y&&l.lastScreenCoverage>0)for(let x=0;x<y.length;x++){const w=y[x].density,_=x==y.length-1;v+=w.toFixed(0)+">"+(w/l.lastScreenCoverage).toFixed(0)+(_?"":",")}const b=y?(a=y[c])==null?void 0:a.density:-1;let A="LOD "+s.mesh_lod+`
TEX `+s.texture_lod;if(vk=="density"&&(A+=`
`+g+` tris
`+(b/l.lastScreenCoverage).toFixed(0)+` dens
`+(l.lastScreenCoverage*100).toFixed(1)+`% cov
`+(l.lastCentrality*100).toFixed(1)+`% centr
`+(SC.min.x.toFixed(2)+"-"+SC.max.x.toFixed(2)+"x"+SC.min.y.toFixed(2)+"-"+SC.max.y.toFixed(2))+" scr"),l.lastScreenCoverage>.1){const x=e,w=x.worldForward,_=x.worldPosition,S=mt(w).multiplyScalar(m*.7).add(d),M=S.distanceTo(_),R=f[Math.min(f.length-1,Math.max(0,c))]+"88",P=this.context.domHeight>0?screen.height/this.context.domHeight:1,C=e.isPerspectiveCamera?Math.tan(e.fov*Math.PI/180/2):1;ft.DrawLabel(S,A,M*.012*P*C,void 0,16777215,R)}}}}}const zfe=te("debugplayerview");var Ad=(n=>(n.Browser="browser",n.Headset="headset",n.Handheld="handheld",n))(Ad||{});class F4{constructor(e,i){p(this,"userId"),p(this,"context"),p(this,"viewDevice","browser"),p(this,"removed",!1),p(this,"_object"),this.userId=e,this.context=i}get currentObject(){return this._object}set currentObject(e){this._object=e}get isConnected(){return this.context.connection.userIsInRoom(this.userId)}}class N4{constructor(e){p(this,"context"),p(this,"playerViews",new Map),this.context=e}setPlayerView(e,i,s){let r=this.playerViews.get(e);r||(r=new F4(e,this.context),this.playerViews.set(e,r)),r.viewDevice=s,r.currentObject=i,r.removed=!1}getPlayerView(e){if(!!e){if(!this.context.connection.userIsInRoom(e)){this.playerViews.delete(e);return}return this.playerViews.get(e)}}removePlayerView(e,i){const s=this.playerViews.get(e);s?.viewDevice===i&&(zfe&&console.log("REMOVE",e),s.removed=!0,this.playerViews.delete(e))}}new qs;const lA=new Uint8Array(4);lA[0]=255,lA[1]=255,lA[2]=255,lA[3]=255;const Ffe=new Tr(lA,1,1,_i);function bk(n,e=1){const i="alpha"in n,s=e*e,r=new Uint8Array(4*s),o=Math.floor(n.r*255),a=Math.floor(n.g*255),l=Math.floor(n.b*255);for(let h=0;h<s;h++){const u=h*4;r[u+0]=o,r[u+1]=a,r[u+2]=l,i?r[u+3]=Math.floor(n.alpha*255):r[u+3]=255}const c=new Tr(r,e,e);return c.needsUpdate=!0,c}function Nfe(n,e,i,s=1,r=3){const o=s*r,a=[n,e,i],l=a.length,c=new Uint8Array(4*l*o),h=new Ae;for(let d=0;d<r;d++){const m=Math.floor(d/r*l),f=tt.clamp(m+1,0,l-1),g=a[m],y=a[f],v=d/r*l%1;h.lerpColors(g,y,v);const b=Math.floor(h.r*255),A=Math.floor(h.g*255),x=Math.floor(h.b*255);for(let w=0;w<s;w++){const _=(d*s+w)*4;c[_+0]=b,c[_+1]=A,c[_+2]=x,c[_+3]=255}}const u=new Tr(c,s,r);return u.needsUpdate=!0,u}function MC(n,e){const i=n.elements;e||(e=[]),e.length=0;for(let s=0;s<16;s+=4){const r=i[s],o=i[s+1],a=i[s+2],l=i[s+3],c=new Ze(r,o,a,l);e.push(c)}return e}const Ak=[],U4=[];function Ufe(n,e){if(Ak.length===0)for(let i=0;i<27;i++)Ak.push(0);e||(e=Ak);for(let i=0;i<27;i++)U4[i]=e[i];e=U4,n.unity_SHAr={value:new Ze(e[9],e[3],e[6],e[0])},n.unity_SHBr={value:new Ze(e[12],e[15],e[18],e[21])},n.unity_SHAg={value:new Ze(e[10],e[4],e[7],e[1])},n.unity_SHBg={value:new Ze(e[13],e[16],e[19],e[22])},n.unity_SHAb={value:new Ze(e[11],e[5],e[8],e[2])},n.unity_SHBb={value:new Ze(e[14],e[17],e[20],e[23])},n.unity_SHC={value:new Ze(e[24],e[25],e[26],1)}}class Vfe{constructor(e,i,s){p(this,"vertexShader"),p(this,"fragmentShader"),p(this,"technique"),this.vertexShader=e,this.fragmentShader=i,this.technique=s}}async function Xfe(n,e){if(!n)return console.error("Can not find technique: no shader data"),null;const i=n.programs[e],s=i.vertexShader,r=i.fragmentShader;if(s!==void 0&&r!==void 0){const o=n.shaders[s],a=n.shaders[r];if(o.uri&&a.uri||o.code&&a.code){if(!o.code&&o.uri&&await V4(o),!a.code&&a.uri&&await V4(a),!o.code||!a.code)return null;const l=n.techniques[e];return new Vfe(o.code,a.code,l)}}return console.error("Shader technique not found",e),null}async function V4(n){const e=n.uri;if(e)if(e.endsWith(".glsl")){const i=await new qs().loadAsync(e);n.code=i.toString()}else n.code=Wfe(n.uri)}function Wfe(n){return decodeURIComponent(Array.prototype.map.call(atob(n),function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""))}const Gl=te("debugenvlight");var f0=(n=>(n[n.Skybox=0]="Skybox",n[n.Trilight=1]="Trilight",n[n.Flat=3]="Flat",n[n.Custom=4]="Custom",n))(f0||{}),EC=(n=>(n[n.Skybox=0]="Skybox",n[n.Custom=1]="Custom",n))(EC||{});class X4{constructor(e){p(this,"context"),p(this,"_currentLightSettingsId"),p(this,"_sceneLightSettings"),p(this,"_timevec4",new Ze),p(this,"__currentReflectionId",null),p(this,"_lighting",{}),this.context=e,this.context.pre_update_callbacks.push(this.preUpdate.bind(this))}preUpdate(){const e=this.context.time;this._timevec4.x=e.time,this._timevec4.y=Math.sin(e.time),this._timevec4.z=Math.cos(e.time),this._timevec4.w=e.deltaTime}get timeVec4(){return this._timevec4}get environmentIntensity(){if(!this._sceneLightSettings||!this._currentLightSettingsId)return 1;const e=this._sceneLightSettings.get(this._currentLightSettingsId);return e?e.ambientIntensity:1}get sceneLightSettings(){var e;return(e=this._sceneLightSettings)==null?void 0:e.values()}enable(e){var i;e instanceof ei&&(e=e.url);const s=(i=this._sceneLightSettings)==null?void 0:i.get(e);return s?(Gl&&console.log("Enable scene light settings",e,s),e!==this._currentLightSettingsId&&this._currentLightSettingsId&&this.disable(this._currentLightSettingsId),this._currentLightSettingsId=e,s.enabled=!0,!0):(Gl&&console.warn("No light settings found for",e),!1)}disable(e){var i;if(e instanceof ei&&(e=e.url),e==null)return!1;const s=(i=this._sceneLightSettings)==null?void 0:i.get(e);return s?(Gl&&console.log("Disable scene light settings",e,s),s.enabled=!1,!0):!1}disableCurrent(){if(this._currentLightSettingsId){const e=this._currentLightSettingsId;return this.disable(this._currentLightSettingsId),e}return null}internalRegisterSceneLightSettings(e){const i=e.sourceId;if(!i){console.error("Missing source id for scene light settings, can not register:",e);return}Gl&&console.log("Register "+e?.sourceId+" lighting",e),this._sceneLightSettings||(this._sceneLightSettings=new Map),this._sceneLightSettings.set(i,e)}internalUnregisterSceneLightSettings(e){const i=e.sourceId;if(!i){console.error("Missing source id for scene light settings, can not unregister:",e);return}Gl&&console.log("Unregister "+e?.sourceId+" lighting",e),this._sceneLightSettings&&this._sceneLightSettings.delete(i)}internalRegisterReflection(e,i){Gl&&console.log("Register reflection",e,i);const s=new W4(this.context,i,1);this._lighting[e]=s}internalGetReflection(e){return this._lighting[e]}internalEnableReflection(e){var i;this.__currentReflectionId=e;const s=(i=this._sceneLightSettings)==null?void 0:i.get(e);switch(Gl&&console.log("Enable reflection",e,s?f0[s.ambientMode]:"Unknown ambient mode",s),s?.ambientMode){case 0:case 4:const r=this.internalGetReflection(e);if(r&&r.Source){Gl&&console.log("Setting environment reflection",r);const o=this.context.scene,a=r.Source;a.mapping=Kr,o.environment=a;return}else Gl&&console.warn("Could not find reflection for source",e);break}if(s?.environmentReflectionSource===1)switch(s?.ambientMode){case 1:if(s.ambientTrilight){const r=s.ambientTrilight,o=Nfe(r[0],r[1],r[2],64,64);o.colorSpace=vt,o.mapping=Kr,this.context.scene.environment=o}else console.error("Missing ambient trilight",s.sourceId);return;case 3:if(s.ambientLight){const r=bk(s.ambientLight,64);r.colorSpace=vt,r.mapping=Kr,this.context.scene.environment=r}else console.error("Missing ambientlight",s.sourceId);return;default:return}}internalDisableReflection(e){if(e&&e!==this.__currentReflectionId){Gl&&console.log("Not disabling reflection for",e,"because it is not the current light settings id",this.__currentReflectionId);return}Gl&&console.log("Disable reflection",e);const i=this.context.scene;i.environment=null}}class W4{constructor(e,i,s=1){p(this,"_source"),this._source=i,i.mapping=Kr}get Source(){return this._source}}const H4=te("timescale");let xk=1;typeof H4=="number"&&(xk=H4);class j4{constructor(){p(this,"_time",0),p(this,"_deltaTime",0),p(this,"_deltaTimeUnscaled",0),p(this,"timeScale",1),p(this,"_frame",0),p(this,"clock",new J2),p(this,"_smoothedFps",0),p(this,"_smoothedDeltaTime",0),p(this,"_fpsSamples",[]),p(this,"_fpsSampleIndex",0),typeof xk=="number"&&(this.timeScale=xk)}get time(){return this._time}set time(e){this._time=e}get deltaTime(){return this._deltaTime}set deltaTime(e){this._deltaTime=e}get deltaTimeUnscaled(){return this._deltaTimeUnscaled}get frame(){return this._frame}set frame(e){this._frame=e}get frameCount(){return this.frame}get realtimeSinceStartup(){return this.clock.elapsedTime}get smoothedFps(){return this._smoothedFps}get smoothedDeltaTime(){return 1/this._smoothedFps}update(){this.deltaTime=this.clock.getDelta(),this.deltaTime=Math.min(.1,this.deltaTime),this._deltaTimeUnscaled=this.deltaTime,this.deltaTime<=0&&(this.deltaTime=1e-12),this.deltaTime*=this.timeScale,this.frame+=1,this.time+=this.deltaTime,this._fpsSamples.length<60?this._fpsSamples.push(this.deltaTime):this._fpsSamples[this._fpsSampleIndex++%60]=this.deltaTime;let e=0;for(let i=0;i<this._fpsSamples.length;i++)e+=this._fpsSamples[i];this._smoothedDeltaTime=e/this._fpsSamples.length,this._smoothedFps=1/this._smoothedDeltaTime}}let Q4=!1;function Z4(n){Q4||(Q4=!0,Hfe(),jfe())}Z4();function Hfe(){const n=`
float startCompression = 0.8;
float desaturation = 0.5;
// Patched tonemapping function
vec3 NeutralToneMapping( vec3 color ) {
    color *= toneMappingExposure;
    
    float d = 1. - startCompression;
    // float peak = dot(color, vec3(0.299, 0.587, 0.114));
    float peak = max(color.r, max(color.g, color.b));
    if (peak < startCompression) return color;
    float newPeak = 1. - d * d / (peak + d - startCompression);
    float invPeak = 1. / peak;
    
    float extraBrightness = dot(color * (1. - startCompression * invPeak), vec3(1, 1, 1));
    
    color *= newPeak * invPeak;
    float g = 1. - 3. / (desaturation * extraBrightness + 3.);
    return mix(color, vec3(1, 1, 1), g);
}
`,e="vec3 NeutralToneMapping( vec3 color ) {",i=`return mix(color, vec3(1, 1, 1), g);
}`,s=Mt.tonemapping_pars_fragment.indexOf(e),r=Mt.tonemapping_pars_fragment.indexOf(i,s);if(s>=0&&r>=0){const o=Mt.tonemapping_pars_fragment.substring(s,r+i.length);Mt.tonemapping_pars_fragment=Mt.tonemapping_pars_fragment.replace(o,n)}}function jfe(){const n=`
// 0: Default, 1: Golden, 2: Punchy
#define AGX_LOOK 0        

vec3 userSlope = vec3(1.0);
vec3 userOffset = vec3(0.0);
vec3 userPower = vec3(1.0);
float userSaturation = 1.0;

// Mean error^2: 3.6705141e-06
vec3 _agxDefaultContrastApprox(vec3 x) {
    vec3 x2 = x * x;
    vec3 x4 = x2 * x2;
    
    return  + 15.5     * x4 * x2
            - 40.14    * x4 * x
            + 31.96    * x4
            - 6.868    * x2 * x
            + 0.4298   * x2
            + 0.1191   * x
            - 0.00232;
}

vec3 _agx(vec3 val) {
    const mat3 agx_mat = mat3(
        0.842479062253094, 0.0423282422610123, 0.0423756549057051,
        0.0784335999999992,  0.878468636469772,  0.0784336,
        0.0792237451477643, 0.0791661274605434, 0.879142973793104);
    
    const float min_ev = -12.47393f;
    const float max_ev = 4.026069f;

    // val = pow(val, vec3(2.2)); 

    // Input transform (inset)
    val = agx_mat * val;
    
    // Log2 space encoding
    val = clamp(log2(val), min_ev, max_ev);
    val = (val - min_ev) / (max_ev - min_ev);
    
    // Apply sigmoid function approximation
    val = _agxDefaultContrastApprox(val);

    return val;
}

vec3 _agxEotf(vec3 val) {
    const mat3 agx_mat_inv = mat3(
        1.19687900512017, -0.0528968517574562, -0.0529716355144438,
        -0.0980208811401368, 1.15190312990417, -0.0980434501171241,
        -0.0990297440797205, -0.0989611768448433, 1.15107367264116);
        
    // Inverse input transform (outset)
    val = agx_mat_inv * val;
    
    // sRGB IEC 61966-2-1 2.2 Exponent Reference EOTF Display
    // NOTE: We're linearizing the output here. Comment/adjust when
    // *not* using a sRGB render target
    val = pow(val, vec3(2.2)); 

    return val;
}

vec3 _agxLook(vec3 val) {
    const vec3 lw = vec3(0.2126, 0.7152, 0.0722);
    float luma = dot(val, lw);
    
    // Default
    vec3 offset = vec3(0.0);
    vec3 slope = vec3(1.0);
    vec3 power = vec3(1.0);
    float sat = 1.0;
    
    #if AGX_LOOK == 1
    // Golden
    slope = vec3(1.0, 0.9, 0.5);
    power = vec3(0.8);
    sat = 0.8;
    #elif AGX_LOOK == 2
    // Punchy
    slope = vec3(1.0);
    power = vec3(1.35, 1.35, 1.35);
    sat = 1.4;
    #endif        
    
    // Needle
    slope = vec3(1.05);
    power = vec3(1.10, 1.10, 1.10);
    sat = 1.15;

    // User
    // slope = userSlope;
    // offset = userOffset;
    // power = userPower;
    // sat = userSaturation;
    
    // ASC CDL
    val = pow(val * slope + offset, power);
    return luma + sat * (val - luma);
}


vec3 AgXToneMapping( vec3 color ) {
    // apply AGX
    color *= toneMappingExposure;
    color = _agx(color);
    color = _agxLook(color); // Optional
    color = _agxEotf(color);
    return color;
}`,e="vec3 AgXToneMapping( vec3 color ) {",i=`	return color;
}`,s=Mt.tonemapping_pars_fragment.indexOf(e),r=Mt.tonemapping_pars_fragment.indexOf(i,s);if(s>=0&&r>=0){const o=Mt.tonemapping_pars_fragment.substring(s,r+i.length);Mt.tonemapping_pars_fragment=Mt.tonemapping_pars_fragment.replace(o,n)}}function sr(n){const e=document.createElement("span");return e.style.maxWidth="48px",e.style.maxHeight="48px",e.style.overflow="hidden",e.classList.add("material-symbols-outlined","notranslate"),e.setAttribute("translate","no"),e.innerText=n,e}function Y4(n){var e;return((e=n.classList)==null?void 0:e.contains("material-symbols-outlined"))||!1}const TC=new Map;async function wk(n){const e="Material Symbols Outlined";if(document.fonts.check(`1em '${e}'`)||(console.log("Font not loaded yet"),await document.fonts.ready),TC.has(n))return TC.get(n);const i=document.createElement("canvas"),s=48;i.width=s,i.height=s;const r=i.getContext("2d");if(r){r.font=`${s}px '${e}'`,r.fillStyle="black",r.fillText(n,0,s);const o=i.toDataURL(),a=new Vt;return a.name=n+" icon",a.image=new Image,a.image.src=o,a.needsUpdate=!0,TC.set(n,a),a}return TC.set(n,null),null}const _k=class{constructor(){p(this,"_fullscreenButton"),p(this,"_muteButton"),p(this,"_qrButton")}static getOrCreate(){return this._instance||(this._instance=new _k),this._instance}static create(){return new _k}get fullscreenButton(){return this._fullscreenButton}createFullscreenButton(n){if(this._fullscreenButton)return this._fullscreenButton;if(!document.fullscreenEnabled)return Ye()&&console.warn("NeedleMenu: Fullscreen button could not be created, device doesn't support the Fullscreen API"),null;const e=document.createElement("button");this._fullscreenButton=e,e.classList.add("fullscreen-button"),e.title="Click to enter fullscreen mode";const i=sr("fullscreen"),s=sr("fullscreen_exit");return e.appendChild(i),e.onclick=()=>{document.fullscreenElement?document.exitFullscreen():"webkitRequestFullscreen"in n.domElement&&typeof n.domElement.webkitRequestFullscreen=="function"?n.domElement.webkitRequestFullscreen():"requestFullscreen"in n.domElement&&n.domElement.requestFullscreen()},document.addEventListener("fullscreenchange",()=>{document.fullscreenElement?(i.remove(),e.appendChild(s),e.title="Click to enter fullscreen mode"):(s.remove(),e.appendChild(i),e.title="Click to exit fullscreen mode")}),globalThis.addEventListener("needle-xrsession-start",()=>{e.style.display="none"}),globalThis.addEventListener("needle-xrsession-end",()=>{e.style.display=""}),e}get muteButton(){return this._muteButton}createMuteButton(n){if(this._muteButton)return this._muteButton;const e=document.createElement("button");this._muteButton=e,e.classList.add("mute-button"),e.title="Click to mute/unmute";const i=sr("volume_off"),s=sr("volume_up");return n.application.muted?e.appendChild(i):e.appendChild(s),e.onclick=()=>{n.application.muted?(i.remove(),e.appendChild(s),n.application.muted=!1):(s.remove(),e.appendChild(i),n.application.muted=!0)},e}get qrButton(){return this._qrButton}createQRCode(){if(this._qrButton)return this._qrButton;const n=document.createElement("button");this._qrButton=n,n.innerText="QR Code",n.prepend(sr("qr_code")),n.title="Scan this QR code with your phone to open this page",this.hideElementDuringXRSession(n);const e=document.createElement("div");e.style.cssText=`
            position: fixed;
            display: inline-block;
            padding: 1rem;
            background-color: white;
            border-radius: 0.4rem;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 0 12px rgba(0, 0, 0, 0.2);
        `;const i=document.createElement("div");i.classList.add("qr-code-container"),e.appendChild(i),n.addEventListener("click",()=>{if(e.parentNode)return r();window.location.href.includes("://localhost")&&zi("To access your website from another device in the same local network you have to use the IP address instead of localhost."),s()});async function s(){await o(),document.body.appendChild(e);const a=i.getBoundingClientRect(),l=n.getBoundingClientRect();e.style.left=l.left+l.width*.5-a.width*.5+"px",l.top<a.height?e.style.top=`calc(${l.bottom}px + ${e.style.padding} * .6)`:e.style.top=`calc(${l.top-a.height}px - ${e.style.padding} * 2.5)`,e.style.opacity="0",e.style.pointerEvents="all",e.style.transition="opacity 0.2s ease-in-out",setTimeout(()=>{e.style.opacity="1",window.addEventListener("click",r,{once:!0})}),window.addEventListener("resize",r),window.addEventListener("scroll",r),document.fullscreenElement?document.fullscreenElement.appendChild(e):document.body.appendChild(e)}function r(){e.style.pointerEvents="none",e.style.transition="opacity 0.2s",e.style.opacity="0",setTimeout(()=>{var a;return(a=e.parentNode)==null?void 0:a.removeChild(e)},500),window.removeEventListener("click",r),window.removeEventListener("resize",r),window.removeEventListener("scroll",r)}async function o(){const a=await mU({text:window.location.href,width:200,height:200});i.innerHTML="",i.appendChild(a)}return n.addEventListener("pointerenter",()=>{o()},{once:!0}),n}hideElementDuringXRSession(n){wS(e=>{n["previous-display"]=n.style.display,n.style.display="none"}),GP(e=>{n["previous-display"]!=null&&(n.style.display=n["previous-display"])})}};let Xh=_k;p(Xh,"_instance");function RC(n,e){const i=e?.element||document.head,s=Array.from(i.querySelectorAll(`link[rel=stylesheet][href*='${n}']`));if(s.length<=0){const r=document.createElement("link");r.href=n,r.rel="stylesheet",i.appendChild(r),s.push(r)}if(e!=null&&e.loadedCallback)for(let r=0;r<s.length;r++)e!=null&&e.loadedCallback&&s[r].addEventListener("load",e.loadedCallback)}function K4(){RC("https://fonts.googleapis.com/css2?family=Roboto+Flex:opsz,wght@8..144,100..1000&display=swap")}const Sk="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0",IC="needle-logo-element";class J4 extends HTMLElement{constructor(){super(),p(this,"_root"),p(this,"wrapper"),p(this,"logoElement",document.createElement("img")),p(this,"textElement",document.createElement("span")),this._root=this.attachShadow({mode:"closed"});const e=document.createElement("template");e.innerHTML=`<style>
        :host {
            position: relative;
            min-width: fit-content;
            /* height: 100%; can not have height 100% because of align-items: stretch; in the parent */
            display: flex;
        }

        .wrapper {
            position: relative;
            display: grid;
            grid-template-columns: auto auto;
            padding: .1rem;
        }
        .wrapper:hover {
            cursor: pointer;
        }
        img {
            width: 95px;
            height: 100%;
            align-self: end;
            margin-left: 0.6rem;
        }
        span {
            font-size: 1rem;
            white-space: nowrap;
        }
        </style>
        <div class="wrapper">
            <img class="logo" src=${eae} />
        </div>
        `,this._root.appendChild(e.content.cloneNode(!0)),this.wrapper=this._root.querySelector(".wrapper"),this._root.appendChild(this.wrapper),this.addEventListener("click",()=>{globalThis.open("https://needle.tools","_blank")}),this.wrapper.setAttribute("title","Made with Needle Engine")}static get elementName(){return IC}static create(){return document.createElement(IC)}setLogoVisible(e){this.logoElement.style.display=e?"block":"none"}}customElements.get(IC)||customElements.define(IC,J4);const Ck=te("debugspatialmenu");class Qfe{constructor(e,i){p(this,"_context"),p(this,"needleMenu"),p(this,"htmlButtonsMap",new Map),p(this,"enabled",!0),p(this,"userRequestedMenu",!1),p(this,"uiisDirty",!1),p(this,"_showNeedleLogo"),p(this,"_wasInXR",!1),p(this,"preRender",()=>{var o;if(!this.enabled){(o=this.menu)==null||o.removeFromParent();return}Ck&&xt.isDesktop()&&this.updateMenu();const a=this._context.xr;if(!(a!=null&&a.running)){this._wasInXR&&(this._wasInXR=!1,this.onExitXR());return}this._wasInXR||(this._wasInXR=!0,this.onEnterXR()),this.updateMenu()}),p(this,"_menuTarget",new ye),p(this,"positionFilter",new KI(90,.5)),p(this,"familyName","Needle Spatial Menu"),p(this,"menu"),p(this,"_poweredByNeedleElement");var s;this._context=e,this._context.pre_render_callbacks.push(this.preRender),this.needleMenu=i;const r=(s=this.needleMenu.shadowRoot)==null?void 0:s.querySelector(".options");r?new MutationObserver(o=>{if(this.enabled&&!(this._context.isInXR==!1&&!Ck))for(const a of o)a.type==="childList"&&(a.addedNodes.forEach(l=>{this.createButtonFromHTMLNode(l)}),a.removedNodes.forEach(l=>{const c=l,h=this.htmlButtonsMap.get(c);h&&(this.htmlButtonsMap.delete(c),h.remove(),Xi.update())}))}).observe(r,{childList:!0}):console.error("Could not find options container in needle menu")}setEnabled(e){var i;this.enabled=e,e||(i=this.menu)==null||i.removeFromParent()}setDisplay(e){return this.enabled?(this.userRequestedMenu=e,!0):!1}onDestroy(){const e=this._context.pre_render_callbacks.indexOf(this.preRender);e>-1&&this._context.pre_render_callbacks.splice(e,1)}markDirty(){this.uiisDirty=!0}showNeedleLogo(e){this._showNeedleLogo=e}onEnterXR(){var e;const i=(e=this.needleMenu.shadowRoot)==null?void 0:e.querySelector(".options");i&&i.childNodes.forEach(s=>{this.createButtonFromHTMLNode(s)})}onExitXR(){var e;(e=this.menu)==null||e.removeFromParent()}createButtonFromHTMLNode(e){const i=this.getMenu(),s=this.htmlButtonsMap.get(e);if(s){s.add();return}if(e instanceof HTMLButtonElement){const r=this.createButton(i,e);this.htmlButtonsMap.set(e,r),r.add()}else e instanceof HTMLSlotElement&&e.assignedNodes().forEach(r=>{this.createButtonFromHTMLNode(r)})}updateMenu(){var e,i;performance.mark("NeedleSpatialMenu updateMenu start");const s=this.getMenu();this.handleNeedleWatermark(),this._context.scene.add(s);const r=this._context.mainCamera,o=this._context.xr,a=o?.rigScale||1;if(r){const l=r.worldPosition,c=r.worldForward.multiplyScalar(-1),h=c.y>.6,u=c.y>.4,d=(s.visible?u:h)||this.userRequestedMenu,m=!s.visible&&d;s.visible=d||xt.isDesktop()&&Ck,c.multiplyScalar(3*a),l.add(c),m&&(s.position.copy(this._menuTarget.position),s.position.y+=.25,this._menuTarget.position.copy(s.position),this.positionFilter.reset(s.position),s.quaternion.copy(this._menuTarget.quaternion),this.markDirty());const f=this._menuTarget.position.distanceTo(l);(m||f>1.5*a)&&(this.ensureRenderOnTop(this.menu),this._menuTarget.position.copy(l),this._context.scene.add(this._menuTarget),Uv(this._menuTarget,this._context.mainCamera,!0,!0),this._menuTarget.removeFromParent()),this.positionFilter.filter(this._menuTarget.position,s.position,this._context.time.time);const g=5;(e=this.menu)==null||e.quaternion.slerp(this._menuTarget.quaternion,this._context.time.deltaTime*g),(i=this.menu)==null||i.scale.setScalar(a)}this.uiisDirty&&(performance.mark("SpatialMenu.update.uiisDirty.start"),this.uiisDirty=!1,Xi.update(),performance.mark("SpatialMenu.update.uiisDirty.end"),performance.measure("SpatialMenu.update.uiisDirty","SpatialMenu.update.uiisDirty.start","SpatialMenu.update.uiisDirty.end")),performance.mark("NeedleSpatialMenu updateMenu end"),performance.measure("SpatialMenu.update","NeedleSpatialMenu updateMenu start","NeedleSpatialMenu updateMenu end")}ensureRenderOnTop(e,i=0){e instanceof pe&&(e.material.depthTest=!1,e.material.depthWrite=!1),e.renderOrder=1e3+i*2;for(const s of e.children)this.ensureRenderOnTop(s,i+1)}get isVisible(){var e;return(e=this.menu)==null?void 0:e.visible}getMenu(){if(this.menu)return this.menu;this.ensureFont(),this.menu=new Xi.Block({boxSizing:"border-box",fontFamily:this.familyName,height:"auto",fontSize:.1,color:0,lineHeight:1,backgroundColor:16777215,backgroundOpacity:.55,borderRadius:1,whiteSpace:"pre-wrap",flexDirection:"row",alignItems:"center",padding:new Ze(0,.05,0,.05),borderColor:0,borderOpacity:.05,borderWidth:.005});const e=Z.get("ObjectRaycaster");return e&&Cm(this.menu,new e),this.menu}handleNeedleWatermark(){var e;if(!this._poweredByNeedleElement){this._poweredByNeedleElement=new Xi.Block({width:"auto",height:"auto",fontSize:.05,whiteSpace:"pre-wrap",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",margin:.02,borderRadius:.02,padding:.02,backgroundColor:16777215,backgroundOpacity:1}),this._poweredByNeedleElement["needle:use_eventsystem"]=!0;const i=new q4(this._context,()=>globalThis.open("https://needle.tools","_self"));Cm(this._poweredByNeedleElement,i);const s=new Xi.Text({textContent:"Powered by",width:"auto",height:"auto"}),r=new Xi.Text({textContent:"needle",width:"auto",height:"auto",fontSize:.07,margin:new Ze(0,0,0,.02)});this._poweredByNeedleElement.add(s),this._poweredByNeedleElement.add(r),(e=this.menu)==null||e.add(this._poweredByNeedleElement),this.markDirty(),new sc().load("./include/needle/poweredbyneedle.webp",o=>{var a;i.allowModifyUI=!1,s.removeFromParent(),r.removeFromParent();const l=o.image.width/o.image.height;(a=this._poweredByNeedleElement)==null||a.set({backgroundImage:o,backgroundOpacity:1,width:.1*l,height:.1}),this.markDirty()})}if(this.menu){const i=this.menu.children.indexOf(this._poweredByNeedleElement);if(!this._showNeedleLogo&&xd())i>=0&&(this._poweredByNeedleElement.removeFromParent(),this.markDirty());else{this._poweredByNeedleElement.visible=!0,this.menu.add(this._poweredByNeedleElement);const s=this.menu.children.indexOf(this._poweredByNeedleElement);i!==s&&this.markDirty()}}}ensureFont(){let e=Xi.FontLibrary.getFontFamily(this.familyName);if(!e){e=Xi.FontLibrary.addFontFamily(this.familyName);const i=e.addVariant("normal","normal","./include/needle/arial-msdf.json","./include/needle/arial.png");i?.addEventListener("ready",()=>{this.markDirty()})}}createButton(e,i){const s=new Xi.Block({width:"auto",height:"auto",whiteSpace:"pre-wrap",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",backgroundColor:16777215,backgroundOpacity:0,padding:.02,margin:.01,borderRadius:.02,cursor:"pointer",fontSize:.05}),r=new Xi.Text({textContent:"",width:"auto",justifyContent:"center",alignItems:"center",backgroundOpacity:0,backgroundColor:16777215,fontFamily:this.familyName,color:0,borderRadius:.02,padding:.01});s.add(r),s["needle:use_eventsystem"]=!0;const o=new q4(this._context,()=>i.click());return Cm(s,o),new Zfe(this,e,i,s,r)}}class Zfe{constructor(e,i,s,r,o){p(this,"menu"),p(this,"root"),p(this,"htmlbutton"),p(this,"spatialContainer"),p(this,"spatialText"),p(this,"spatialIcon"),p(this,"_lastText",""),p(this,"_lastTexture"),this.menu=e,this.root=i,this.htmlbutton=s,this.spatialContainer=r,this.spatialText=o,new MutationObserver(a=>{for(const l of a)l.type==="attributes"?l.attributeName==="style"&&this.updateVisible():l.type==="childList"&&this.updateText()}).observe(s,{attributes:!0,childList:!0}),this.updateText()}add(){this.spatialContainer.parent!=this.root&&(this.root.add(this.spatialContainer),this.menu.markDirty(),this.updateVisible(),this.updateText())}remove(){this.spatialContainer.parent&&(this.spatialContainer.removeFromParent(),this.menu.markDirty())}updateVisible(){const e=this.spatialContainer.visible;this.spatialContainer.visible=this.htmlbutton.style.display!=="none",e!==this.spatialContainer.visible&&this.menu.markDirty()}updateText(){let e="",i="";this.htmlbutton.childNodes.forEach(s=>{s.nodeType===Node.TEXT_NODE?e+=s.textContent:s instanceof HTMLElement&&Y4(s)&&s.textContent&&(i=s.textContent)}),this._lastText!==e&&(this._lastText=e,this.spatialText.name=e,this.spatialText.set({textContent:e}),this.menu.markDirty()),e.length<=0?this.spatialText.parent&&(this.spatialText.removeFromParent(),this.menu.markDirty()):this.spatialText.parent||(this.spatialContainer.add(this.spatialText),this.menu.markDirty()),i&&this.createIcon(i)}async createIcon(e){var i;if(!this.spatialIcon){const r=await wk(e);if(r&&!this.spatialIcon){const o=new Xi.Block({width:.08,height:.08,backgroundColor:16777215,backgroundImage:r,backgroundOpacity:1,margin:new Ze(0,.005,0,0)});this.spatialIcon=o,this.spatialContainer.add(o),this.menu.markDirty()}}if(e!=this._lastTexture){this._lastTexture=e;const r=await wk(e);r&&((i=this.spatialIcon)==null||i.set({backgroundImage:r}),this.menu.markDirty())}const s=this.spatialContainer.children.indexOf(this.spatialIcon);s>0&&(this.spatialContainer.children.splice(s,1),this.spatialContainer.children.unshift(this.spatialIcon),this.menu.markDirty())}}class q4{constructor(e,i){p(this,"isComponent",!0),p(this,"enabled",!0),p(this,"gameObject"),p(this,"allowModifyUI",!0),p(this,"context"),p(this,"onclick"),this.context=e,this.onclick=i}get activeAndEnabled(){return!0}__internalAwake(){}__internalEnable(){}__internalDisable(){}__internalStart(){}onEnable(){}onDisable(){}get element(){return this.gameObject}onPointerEnter(){this.context.input.setCursorPointer(),this.allowModifyUI&&(this.element.set({backgroundOpacity:1}),Xi.update())}onPointerExit(){this.context.input.setCursorNormal(),this.allowModifyUI&&(this.element.set({backgroundOpacity:0}),Xi.update())}onPointerDown(e){e.use()}onPointerUp(e){e.use()}onPointerClick(e){e.use(),this.onclick()}}const g0="needle-menu",cA=te("debugmenu"),$4=te("debugnoncommercial");let Yfe=class{constructor(n){p(this,"_context"),p(this,"_menu"),p(this,"_spatialMenu"),p(this,"onPostMessage",e=>{if(e.origin===globalThis.location.origin&&typeof e.data=="object"){const i=e.data,s=i.type;if(s==="needle:menu"){const r=i.button;if(r){if(!r.label)return console.error("NeedleMenu: buttoninfo.label is required");if(!r.onclick)return console.error("NeedleMenu: buttoninfo.onclick is required");const o=document.createElement("button");if(o.textContent=r.label,r.icon){const a=sr(r.icon);o.prepend(a)}r.priority&&o.setAttribute("priority",r.priority.toString()),o.onclick=()=>{if(r.onclick){const a=r.onclick.startsWith("http")||r.onclick.startsWith("www."),l=r.target||"_blank";a?globalThis.open(r.onclick,l):console.error("NeedleMenu: onclick is not a valid link",r.onclick)}},this._menu.appendChild(o)}else cA&&console.error("NeedleMenu: unknown postMessage event",i)}else cA&&console.warn("NeedleMenu: unknown postMessage type",s,i)}}),p(this,"onStartXR",e=>{e.session.isScreenBasedAR&&(this._menu.previousParent=this._menu.parentNode,this._context.arOverlayElement.appendChild(this._menu),e.session.session.addEventListener("end",this.onExitXR),this._menu.closeFoldout())}),p(this,"onExitXR",()=>{this._menu.previousParent&&(this._menu.previousParent.appendChild(this._menu),delete this._menu.previousParent)}),p(this,"_muteButton"),p(this,"_fullscreenButton"),this._menu=tj.getOrCreate(n.domElement,n),this._context=n,this._spatialMenu=new Qfe(n,this._menu),window.addEventListener("message",this.onPostMessage),wS(this.onStartXR)}onDestroy(){window.removeEventListener("message",this.onPostMessage),this._menu.remove(),this._spatialMenu.onDestroy()}setPosition(n){this._menu.setPosition(n)}setVisible(n){this._menu.setVisible(n)}showNeedleLogo(n){var e;this._menu.showNeedleLogo(n),(e=this._spatialMenu)==null||e.showNeedleLogo(n)}showSpatialMenu(n){this._spatialMenu.setEnabled(n)}setSpatialMenuVisible(n){this._spatialMenu.setDisplay(n)}get spatialMenuIsVisible(){return this._spatialMenu.isVisible}showQRCodeButton(n){if(n==="desktop-only"&&(n=!xt.isMobileDevice()),n){const e=Xh.getOrCreate().createQRCode();return e.style.display="",this._menu.appendChild(e),e}else{const e=Xh.getOrCreate().qrButton;return e&&(e.style.display="none"),e??null}}showAudioPlaybackOption(n){var e;if(!n){(e=this._muteButton)==null||e.remove();return}this._muteButton=Xh.getOrCreate().createMuteButton(this._context),this._muteButton.setAttribute("priority","100"),this._menu.appendChild(this._muteButton)}showFullscreenOption(n){var e;if(!n){(e=this._fullscreenButton)==null||e.remove();return}this._fullscreenButton=Xh.getOrCreate().createFullscreenButton(this._context),this._fullscreenButton&&(this._fullscreenButton.setAttribute("priority","150"),this._menu.appendChild(this._fullscreenButton))}appendChild(n){return this._menu.appendChild(n)}};var LC,PC,Mk;const ej=class extends HTMLElement{constructor(){var n,e,i,s,r,o;super(),Ea(this,PC),p(this,"_domElement",null),p(this,"_context",null),p(this,"_sizeChangeInterval"),Ea(this,LC,g=>{if(!g.defaultPrevented&&g.target==this._domElement&&g instanceof PointerEvent&&g.button===0&&this.root.classList.contains("open")){const y=this.foldout.getBoundingClientRect(),v=g;v.clientX>y.left&&v.clientX<y.right&&v.clientY>y.top&&v.clientY<y.bottom||this.root.classList.toggle("open",!1)}}),p(this,"_userRequestedLogoVisible"),p(this,"_userRequestedMenuVisible"),p(this,"root"),p(this,"wrapper"),p(this,"options"),p(this,"logoContainer"),p(this,"compactMenuButton"),p(this,"foldout"),p(this,"_isHandlingChange",!1),p(this,"_didSort",new Map),p(this,"_lastAvailableWidthChange",0),p(this,"_timeoutHandle",0),p(this,"handleSizeChange",(g,y)=>{if(!this._domElement)return;const v=this._domElement.clientWidth;if(v<100){clearTimeout(this._timeoutHandle),this.root.classList.add("compact"),this.foldout.classList.add("floating-panel-style");return}const b=20*2,A=v-b;if(!y&&Math.abs(A-this._lastAvailableWidthChange)<1)return;this._lastAvailableWidthChange=A,clearTimeout(this._timeoutHandle),this._timeoutHandle=setTimeout(()=>{const _=w();_<0?(this.root.classList.add("compact"),this.foldout.classList.add("floating-panel-style")):_>0&&(this.root.classList.remove("compact"),this.foldout.classList.remove("floating-panel-style"),w()<0&&(this.root.classList.add("compact"),this.foldout.classList.add("floating-panel-style")))},5);const x=()=>this.options.clientWidth+this.logoContainer.clientWidth,w=()=>A-x()});const a=document.createElement("template");a.innerHTML=`<style>

        #root {
            position: absolute;
            width: auto;
            max-width: 95%;
            left: 50%;
            transform: translateX(-50%);
            top: min(20px, 10vh);
            padding: 0.3rem;
            display: flex;
            visibility: visible;
            flex-direction: row-reverse; /* if we overflow this should be right aligned so the logo is always visible */
            pointer-events: all;
            z-index: 1000;
        }

        /** hide the menu if it's empty **/
        #root.has-no-options.logo-hidden {
            display: none; 
        }

        /** using a div here because then we can change the class for placement **/
        #root.bottom {
            top: auto;
            bottom: min(30px, 10vh);
        }
        #root.top {
            top: calc(.7rem + env(safe-area-inset-top));
        }
        
        .wrapper {
            position: relative;
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: stretch;
            gap: 0px;
            padding: 0 0rem;
        }

        .wrapper > *, .options > button, .options > select, ::slotted(*) {
            position: relative;
            border: none;
            border-radius: 0;
            outline: 1px solid rgba(0,0,0,0);
            display: flex;
            justify-content: center;
            align-items: center;
            max-height: 2.3rem;
            max-width: 100%;

            /** basic font settings for all entries **/
            font-size: 1rem;
            font-family: 'Roboto Flex', sans-serif;
            font-optical-sizing: auto;
            font-weight: 500;
            font-weight: 200;
            font-variation-settings: "wdth" 100;
            color: rgb(20,20,20);
        }

        .floating-panel-style {
            background: rgba(255, 255, 255, .4);
            outline: rgb(0 0 0 / 5%) 1px solid;
            border: 1px solid rgba(255, 255, 255, .1);
            box-shadow: 0px 7px 0.5rem 0px rgb(0 0 0 / 6%), inset 0px 0px 1.3rem rgba(0,0,0,.05);
            border-radius: 1.5rem;
            /** 
             * to make nested background filter work 
             * https://stackoverflow.com/questions/60997948/backdrop-filter-not-working-for-nested-elements-in-chrome 
             **/
            &::before {
                content: '';
                position: absolute;
                width: 100%;
                height: 100%;
                top: 0;
                left: 0;
                z-index: -1;
                border-radius: 1.5rem;
                -webkit-backdrop-filter: blur(8px);
                backdrop-filter: blur(8px);
            }
        }

        a {
            color: inherit;
            text-decoration: none;
        }

        .options {
            display: flex;
            flex-direction: row;
            align-items: center;
        }

        .options > *, ::slotted(*) {
            max-height: 2.25rem;
            padding: .4rem .5rem;
        }
        
        :host .options > *, ::slotted(*) {
            background: transparent;
            border: none;
            white-space: nowrap;
            transition: all 0.1s linear .02s;
            border-radius: 1.5rem;
            user-select: none;
        }
        :host .options > *:hover, ::slotted(*:hover) {
            cursor: pointer;
            color: black;
            background: rgba(245, 245, 245, .8);
            box-shadow: inset 0 0 1rem rgba(0,0,30,.2);
            outline: rgba(0,0,0,.1) 1px solid;
        }
        :host .options > *:active, ::slotted(*:active) {
            background: rgba(255, 255, 255, .8);
            box-shadow: inset 0px 1px 1px rgba(255,255,255,.5), inset 0 0 2rem rgba(0,0,30,.2), inset 0px 2px 4px rgba(0,0,20,.5);
            transition: all 0.05s linear;
        }
        :host .options > *:focus, ::slotted(*:focus) {
            outline: rgba(255,255,255,.5) 1px solid;
        }

        :host .options > *:disabled, ::slotted(*:disabled) {
            background: rgba(0,0,0,.05);
            color: rgba(60,60,60,.7);
            pointer-events: none;
        }

        button, ::slotted(button) {
            gap: 0.3rem;
        }

        /** XR button animation **/
        :host button.this-mode-is-requested {
            background: repeating-linear-gradient(to right, #fff 0%, #fff 40%, #aaffff 55%, #fff 80%);
            background-size: 200% auto;
            background-position: 0 100%;
            animation: AnimationName .7s ease infinite forwards;
        }
        :host button.other-mode-is-requested {
            opacity: .5;
        }
        
        @keyframes AnimationName {
            0% { background-position: 0% 0 }
            100% { background-position: -200% 0 }
        }




        .logo {
            cursor: pointer;
            padding-left: 0.6rem;
            padding-bottom: .02rem;
            margin-right: 0.5rem;
        }
        .logo-hidden {
            .logo {
                display: none;
            }
        }
        :host .has-options .logo {
            border-left: 1px solid rgba(40,40,40,.4);
            margin-left: 0.3rem;
            margin-right: 0.5rem;
        }

        .logo > span {
            white-space: nowrap;
        }



        /** COMPACT */

        /** Hide the menu button normally **/
        .compact-menu-button { display: none; }
        /** And show it when we're in compact mode **/
        .compact .compact-menu-button {
            position: relative;
            display: block;
            background: none;
            border: none;
            border-radius: 2rem;

            margin: 0;
            padding: 0 .3rem;
            padding-top: .2rem;

            z-index: 100;

            color: #000;

            &:hover {
                background: rgba(255,255,255,.2);
                cursor: pointer;
            }
            &:focus {
                outline: 1px solid rgba(255,255,255,.5);
            }
            & .expanded-click-area {
                position: absolute;
                left: 0;
                right: 0;
                top: 10%;
                bottom: 10%;
                transform: scale(1.8);
            }
        }  
        .has-no-options .compact-menu-button {
            display: none;
        }
        .open .compact-menu-button {
            background: rgba(255,255,255,.2);
        }
        .logo-visible .compact-menu-button { 
            margin-left: .2rem;
        }
        
        /** Open and hide menu **/
        .compact .foldout { 
            display: none;
        }
        .open .options, .open .foldout {
            display: flex;
            justify-content: center;
        }
        .compact .wrapper {
            padding: 0;
        }
        .compact .wrapper, .compact .options {
            height: auto;
            max-height: initial;
            flex-direction: row;
            gap: .12rem;
        }
        .compact .options { 
            flex-wrap: wrap;
            gap: .3rem;
        }
        .compact .top .options {
            height: auto;
            flex-direction: row;
        }
        .compact .bottom .wrapper {
            height: auto;
            flex-direction: column;
        }

        .compact .foldout {
            max-height: min(100ch, calc(100vh - 100px));
            overflow: auto;
            overflow-x: hidden;
            align-items: center;

            position: fixed;
            bottom: calc(100% + 5px);
            z-index: 100;
            width: auto;
            left: .2rem;
            right: .2rem;
            padding: .2rem;

        }
        .compact.logo-hidden .foldout {
            /** for when there's no logo we want to center the foldout **/
            min-width: 24ch;
            margin-left: 50%;
            transform: translateX(calc(-50% - .2rem));
        }
        
        .compact.top .foldout {
            top: calc(100% + 5px);
            bottom: auto;
        }

        ::-webkit-scrollbar {
            max-width: 7px;
            background: rgba(100,100,100,.2);
            border-radius: .2rem;
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, .3);
            border-radius: .2rem;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: rgb(150,150,150);
        }

        .compact .options > *, .compact .options > ::slotted(*) {
            font-size: 1.2rem;
            padding: .6rem .5rem;
            width: 100%;
        }
        .compact.has-options .logo {
            border: none;
            padding-left: 0;
            margin-left: 1rem;
            margin-bottom: .02rem;
        }
        .compact .options { 
            /** e.g. if we have a very wide menu item like a select with long option names we don't want to overflow **/
            max-width: 100%;
            
            & > button, & > select {
                display: flex;
                flex-basis: 100%;
                min-height: 3rem;
            }
            & > button.row2 {
                //border: 1px solid red !important;
                display: flex;
                flex: 1;
                flex-basis: 30%;
            }
        }

        /** If there's really not enough space then just hide all options **/
        @media (max-width: 100px) or (max-height: 100px){
            .foldout {
                display: none !important;
            }
            .compact-menu-button {
                display: none !important;
            }
        }
        
        /* dark mode */
        /*
        @media (prefers-color-scheme: dark) {
            :host {
                background: rgba(0,0,0, .6);
            }
            :host button {
                color: rgba(200,200,200);
            }
            :host button:hover {
                background: rgba(100,100,100, .8);
            }
        }
        */

        </style>
        
        <div id="root" class="logo-visible floating-panel-style bottom">
            <div class="wrapper">
                <div class="foldout">
                    <div class="options" part="options">
                        <slot></slot>
                    </div>
                    <div class="options" part="options">
                        <slot name="end"></slot>
                    </div>
                </div>
                <div style="user-select:none" class="logo">
                    <span class="madewith notranslate">powered by</span>
                </div>
            </div>
            <button class="compact-menu-button">
                <div class="expanded-click-area"></div>
            </button>
        </div>
        `;const l=this.attachShadow({mode:"open"});K4(),RC(Sk,{loadedCallback:()=>{this.handleSizeChange()}}),RC(Sk,{element:l});const c=a.content.cloneNode(!0);l?.appendChild(c),this.root=l.querySelector("#root"),this.wrapper=(n=this.root)==null?void 0:n.querySelector(".wrapper"),this.options=(e=this.root)==null?void 0:e.querySelector(".options"),this.logoContainer=(i=this.root)==null?void 0:i.querySelector(".logo"),this.compactMenuButton=(s=this.root)==null?void 0:s.querySelector(".compact-menu-button"),this.compactMenuButton.append(sr("more_vert")),this.foldout=(r=this.root)==null?void 0:r.querySelector(".foldout"),(o=this.root)==null||o.appendChild(this.wrapper),this.wrapper.classList.add("wrapper");const h=J4.create();h.style.minHeight="1rem",this.logoContainer.append(h),this.logoContainer.addEventListener("click",()=>{globalThis.open("https://needle.tools","_blank")});try{ige(g=>{if(g==!0&&Wh()&&!$4){let y=this._userRequestedLogoVisible;y===void 0&&(y=!1),Mf(this,PC,Mk).call(this,y)}})}catch(g){console.error("[Needle Menu] License check failed.",g)}this.compactMenuButton.addEventListener("click",g=>{g.preventDefault(),this.root.classList.toggle("open")});let u=this._context;setTimeout(()=>u=this._context);let d=0;const m=(g,y)=>{var v,b,A;cA&&console.log("Set menu visible",y),u!=null&&u.isInAR&&u.arOverlayElement?g!=u.arOverlayElement&&u.arOverlayElement.appendChild(this):this.parentNode!=((v=this._domElement)==null?void 0:v.shadowRoot)&&((A=(b=this._domElement)==null?void 0:b.shadowRoot)==null||A.appendChild(this)),this.style.display=y?"flex":"none",this.style.visibility="visible",this.style.opacity="1"};let f=!1;new MutationObserver(g=>{var y;if(!f)try{f=!0,this.onChangeDetected(g);const v=this==null?void 0:this.parentNode;if((this.style.display!="flex"||this.style.visibility!="visible"||this.style.opacity!="1"||v!=((y=this._domElement)==null?void 0:y.shadowRoot))&&!Wh()){const b=d++;no()&&this._userRequestedMenuVisible===!1?(b===0&&m(v,this._userRequestedMenuVisible),b===1&&console.warn("Needle Menu Warning: You need a PRO license to hide the Needle Engine menu \u2192 The menu will be visible in your deployed website if you don't have a PRO license. See https://needle.tools/pricing for details.")):b===0?m(v,!0):setTimeout(()=>m(v,!0),5)}}finally{f=!1}}).observe(this.root,{childList:!0,subtree:!0,attributes:!0}),cA&&this.___insertDebugOptions()}static create(){return document.createElement(g0,{is:g0})}static getOrCreate(n,e){let i=n.querySelector(g0);return!i&&n.shadowRoot&&(i=n.shadowRoot.querySelector(g0)),i||(i=ej.create(),n.shadowRoot?n.shadowRoot.appendChild(i):n.appendChild(i)),i._domElement=n,i._context=e,i}connectedCallback(){window.addEventListener("resize",this.handleSizeChange),this.handleMenuVisible(),this._sizeChangeInterval=setInterval(()=>this.handleSizeChange(void 0,!0),5e3),setTimeout(()=>{var n,e;(n=this._domElement)==null||n.addEventListener("resize",this.handleSizeChange),(e=this._domElement)==null||e.addEventListener("click",Ai(this,LC))},1)}disconnectedCallback(){var n,e;window.removeEventListener("resize",this.handleSizeChange),clearInterval(this._sizeChangeInterval),(n=this._domElement)==null||n.removeEventListener("resize",this.handleSizeChange),(e=this._context)==null||e.domElement.removeEventListener("click",Ai(this,LC))}showNeedleLogo(n){this._userRequestedLogoVisible=n,!(!n&&(!Wh()||$4)&&(console.warn("Needle Menu: You need a PRO license to hide the Needle Engine logo."),!no()))&&Mf(this,PC,Mk).call(this,n)}setPosition(n){if(n!=="top"&&n!=="bottom")return console.error("NeedleMenu.setPosition: invalid position",n);this.root.classList.remove("top","bottom"),this.root.classList.add(n)}setVisible(n){this._userRequestedMenuVisible=n,this.style.display=n?"flex":"none"}closeFoldout(){this.root.classList.remove("open")}append(...n){for(const e of n)if(typeof e=="string"){const i=document.createTextNode(e);this.options.appendChild(i)}else this.options.appendChild(e)}appendChild(n){var e;if(!(n instanceof Node)){const i=document.createElement("button");if(i.textContent=n.label,i.onclick=n.onClick,i.setAttribute("priority",((e=n.priority)==null?void 0:e.toString())??"0"),n.title&&(i.title=n.title),n.icon){const s=sr(n.icon);n.iconSide==="right"?i.appendChild(s):i.prepend(s)}n.class&&i.classList.add(n.class),n=i}return this.options.appendChild(n)}prepend(...n){for(const e of n)if(typeof e=="string"){const i=document.createTextNode(e);this.options.prepend(i)}else this.options.prepend(e)}onChangeDetected(n){if(!this._isHandlingChange){this._isHandlingChange=!0;try{this.handleMenuVisible();for(const e of n)e.target==this.options&&this.onOptionsChildrenChanged(e)}finally{this._isHandlingChange=!1}}}onOptionsChildrenChanged(n){if(this.root.classList.toggle("has-options",this.hasAnyVisibleOptions),this.root.classList.toggle("has-no-options",!this.hasAnyVisibleOptions),this.handleSizeChange(void 0,!0),n.type==="childList"&&n.addedNodes.length>0){const e=Array.from(this.options.children);e.sort((s,r)=>{const o=parseInt(s.getAttribute("priority")||"0"),a=parseInt(r.getAttribute("priority")||"0");return o-a});let i=!1;for(let s=0;s<e.length;s++){const r=this.options.children[s],o=e[s];if(r!==o){i=!0;break}}if(i)for(const s of e)this.options.appendChild(s)}}handleMenuVisible(){cA&&console.log("Update VisibleState: Any Content?",this.hasAnyContent),this.hasAnyContent?this.root.style.display="":this.root.style.display="none",this.root.classList.toggle("has-options",this.hasAnyVisibleOptions),this.root.classList.toggle("has-no-options",!this.hasAnyVisibleOptions)}get hasAnyContent(){return!!(this.logoContainer.style.display!="none"||this.hasAnyVisibleOptions)}get hasAnyVisibleOptions(){for(let n=0;n<this.options.children.length;n++){const e=this.options.children[n];if(e.tagName==="SLOT"){const i=e.assignedNodes();for(const s of i)if(s instanceof HTMLElement&&s.style.display!="none")return!0}else if(e.style.display!="none")return!0}return!1}___insertDebugOptions(){window.addEventListener("keydown",i=>{i.key==="p"&&this.setPosition(this.root.classList.contains("top")?"bottom":"top")});const n=document.createElement("button");n.textContent="Hide Buttons",n.onclick=()=>{const i=new Array(this.options.children.length);for(let s=0;s<this.options.children.length;s++)i[s]=this.options.children[s];for(const s of i)this.options.removeChild(s);setTimeout(()=>{for(const s of i)this.options.appendChild(s)},1e3)},this.appendChild(n);const e=document.createElement("button");e.textContent="Toggle Logo",e.addEventListener("click",()=>{this.logoContainer.style.display=this.logoContainer.style.display==="none"?"":"none"}),this.appendChild(e)}};let tj=ej;LC=new WeakMap,PC=new WeakSet,Mk=function(n){this.logoContainer.style.display="",this.logoContainer.style.opacity="1",this.logoContainer.style.visibility="visible",n?(this.root.classList.remove("logo-hidden"),this.root.classList.add("logo-visible")):(this.root.classList.remove("logo-visible"),this.root.classList.add("logo-hidden"))},customElements.get(g0)||customElements.define(g0,tj);const ws=te("debugcontext"),Kfe=te("stats"),Jfe=te("debugactive"),qfe=te("debugframerate"),$fe=te("debugcoroutine"),ege={};class tge{constructor(){p(this,"name"),p(this,"alias"),p(this,"hash"),p(this,"runInBackground"),p(this,"domElement"),p(this,"renderer"),p(this,"camera"),p(this,"scene")}}var Yi=(n=>(n[n.Start=-1]="Start",n[n.EarlyUpdate=0]="EarlyUpdate",n[n.Update=1]="Update",n[n.LateUpdate=2]="LateUpdate",n[n.OnBeforeRender=3]="OnBeforeRender",n[n.OnAfterRender=4]="OnAfterRender",n[n.PrePhysicsStep=9]="PrePhysicsStep",n[n.PostPhysicsStep=10]="PostPhysicsStep",n[n.Undefined=-1]="Undefined",n))(Yi||{});function BC(n,e){if(!n)return;if(!n.isComponent){(Ye()||ws)&&console.error(`Registered script is not a Needle Engine component. 
The script will be ignored. Please make sure your component extends "Behaviour" imported from "@needle-tools/engine"
`,n);return}e||(e=Pt.Current,ws&&console.warn("> Registering component without context"));const i=e?.new_scripts;i.includes(n)||i.push(n)}const on=class{constructor(n){p(this,"name"),p(this,"alias"),p(this,"isManagedExternally",!1),p(this,"isPaused",!1),p(this,"runInBackground",!1),p(this,"targetFrameRate"),p(this,"physicsSteps",1),p(this,"hash"),p(this,"domElement"),p(this,"_resolutionScaleFactor",1),p(this,"_boundingClientRectFrame",-1),p(this,"_boundingClientRect",null),p(this,"_domX"),p(this,"_domY"),p(this,"xr",null),p(this,"_xrFrame",null),p(this,"_currentFrameEvent",-1),p(this,"scene"),p(this,"renderer"),p(this,"composer",null),p(this,"scripts",[]),p(this,"scripts_pausedChanged",[]),p(this,"scripts_earlyUpdate",[]),p(this,"scripts_update",[]),p(this,"scripts_lateUpdate",[]),p(this,"scripts_onBeforeRender",[]),p(this,"scripts_onAfterRender",[]),p(this,"scripts_WithCorroutines",[]),p(this,"scripts_immersive_vr",[]),p(this,"scripts_immersive_ar",[]),p(this,"coroutines",{}),p(this,"post_setup_callbacks",[]),p(this,"pre_update_callbacks",[]),p(this,"pre_render_callbacks",[]),p(this,"post_render_callbacks",[]),p(this,"pre_update_oneshot_callbacks",[]),p(this,"new_scripts",[]),p(this,"new_script_start",[]),p(this,"new_scripts_pre_setup_callbacks",[]),p(this,"new_scripts_post_setup_callbacks",[]),p(this,"new_scripts_xr",[]),p(this,"mainCameraComponent"),p(this,"_mainCamera",null),p(this,"_fallbackCamera",null),p(this,"application"),p(this,"animations"),p(this,"time"),p(this,"input"),p(this,"physics"),p(this,"connection"),p(this,"assets"),p(this,"mainLight",null),p(this,"sceneLighting"),p(this,"addressables"),p(this,"lightmaps"),p(this,"players"),p(this,"lodsManager"),p(this,"menu"),p(this,"_sizeChanged",!1),p(this,"_isCreated",!1),p(this,"_isCreating",!1),p(this,"_isVisible",!1),p(this,"_stats",Kfe?new Kle:null),p(this,"_intersectionObserver",null),p(this,"_disposeCallbacks",[]),p(this,"maxRenderResolution"),p(this,"_originalCreationArgs"),p(this,"onUnhandledRejection",s=>{this.onError(s.reason)}),p(this,"_cameraStack",[]),p(this,"_onBeforeRenderListeners",new Map),p(this,"_onAfterRenderListeners",new Map),p(this,"_requireDepthTexture",!1),p(this,"_requireColorTexture",!1),p(this,"_renderTarget"),p(this,"_isRendering",!1),p(this,"_createId",0),p(this,"_renderlooperrors",0),p(this,"_lastTimestamp",0),p(this,"_accumulatedTime",0),p(this,"_dispatchReadyAfterFrame",!1),p(this,"_wasPaused",!1),this.name=n?.name||"",this.alias=n?.alias,this.domElement=n?.domElement||document.body,this.hash=n?.hash,n!=null&&n.renderer&&(this.renderer=n.renderer,this.isManagedExternally=!0),n?.runInBackground!==void 0&&(this.runInBackground=n.runInBackground),n!=null&&n.scene?this.scene=n.scene:this.scene=new Ls,n!=null&&n.camera&&(this._mainCamera=n.camera),this.application=new Uh(this),this.time=new j4,this.input=new mW(this),this.physics=new NS(this),this.connection=new XH(this),this.assets=new p9,this.sceneLighting=new X4(this),this.addressables=new b4(this),this.lightmaps=new Ofe(this),this.players=new N4(this),this.menu=new Yfe(this),this.lodsManager=new Gfe(this),this.animations=new mfe(this);const e=()=>this._sizeChanged=!0;window.addEventListener("resize",e),this._disposeCallbacks.push(()=>window.removeEventListener("resize",e));const i=new ResizeObserver(s=>this._sizeChanged=!0);i.observe(this.domElement),this._disposeCallbacks.push(()=>i.disconnect()),this._intersectionObserver=new IntersectionObserver(s=>{this._isVisible=s[0].isIntersecting}),this._disposeCallbacks.push(()=>{var s;return(s=this._intersectionObserver)==null?void 0:s.disconnect()}),yi.register(this)}static get DefaultTargetFrameRate(){return on._defaultTargetFramerate.value}static set DefaultTargetFrameRate(n){on._defaultTargetFramerate.value=n}static get DefaultWebGLRendererParameters(){return on._defaultWebglRendererParameters}get version(){return xl}static get Current(){return yi.Current}static set Current(n){yi.Current=n}appendHTMLElement(n){return this.domElement.shadowRoot?this.domElement.shadowRoot.appendChild(n):this.domElement.appendChild(n)}get resolutionScaleFactor(){return this._resolutionScaleFactor}set resolutionScaleFactor(n){if(n!==this._resolutionScaleFactor&&typeof n=="number"){if(n<=0){console.error("Invalid resolution scale factor",n);return}this._resolutionScaleFactor=n,this.updateSize()}}calculateBoundingClientRect(){if(this.xr){this._domX=0,this._domY=0;return}this._boundingClientRectFrame!==this.time.frame&&(this._boundingClientRectFrame=this.time.frame,this._boundingClientRect=this.domElement.getBoundingClientRect(),this._domX=this._boundingClientRect.x,this._domY=this._boundingClientRect.y)}get domWidth(){return this.isInAR?window.innerWidth:this.domElement.clientWidth}get domHeight(){return this.isInAR?window.innerHeight:this.domElement.clientHeight}get domX(){return this.calculateBoundingClientRect(),this._domX}get domY(){return this.calculateBoundingClientRect(),this._domY}get isInXR(){var n,e;return((e=(n=this.renderer)==null?void 0:n.xr)==null?void 0:e.isPresenting)||!1}get xrSessionMode(){var n;return(n=this.xr)==null?void 0:n.mode}get isInVR(){return this.xrSessionMode==="immersive-vr"}get isInAR(){return this.xrSessionMode==="immersive-ar"}get isInPassThrough(){return this.xr?this.xr.isPassThrough:!1}get xrSession(){var n,e;return(e=(n=this.renderer)==null?void 0:n.xr)==null?void 0:e.getSession()}get xrFrame(){return this._xrFrame}get xrCamera(){var n,e;return this.renderer.xr.isPresenting?(e=(n=this.renderer)==null?void 0:n.xr)==null?void 0:e.getCamera():void 0}get arOverlayElement(){const n=this.domElement;return typeof n.getAROverlayContainer=="function"?n.getAROverlayContainer():this.domElement}get currentFrameEvent(){return this._currentFrameEvent}get mainCamera(){if(this._mainCamera)return this._mainCamera;if(this.mainCameraComponent){const n=this.mainCameraComponent;return n.threeCamera||n.buildCamera(),n.threeCamera}return this._fallbackCamera||(this._fallbackCamera=new Lt(75,this.domWidth/this.domHeight,.1,1e3)),this._fallbackCamera}set mainCamera(n){this._mainCamera=n}get rendererData(){return this.sceneLighting}get isCreated(){return this._isCreated}createNewRenderer(n){var e,i,s;if((e=this.renderer)==null||e.dispose(),n={...on.DefaultWebGLRendererParameters,...n},!n.canvas){const r=(s=(i=this.domElement)==null?void 0:i.shadowRoot)==null?void 0:s.querySelector("canvas");r&&(n.canvas=r,ws&&console.log("Using canvas from shadow root",r))}ws&&console.log("Using Renderer Parameters:",n,this.domElement),this.renderer=new gh(n),this.renderer.debug.checkShaderErrors=Ye()||te("checkshadererrors")===!0,this.renderer.toneMappingExposure=1,this.renderer.toneMapping=Yr,this.renderer.setClearColor(new Ae("lightgrey"),0),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=WT,this.renderer.setSize(this.domWidth,this.domHeight),this.renderer.outputColorSpace=vt,this.lodsManager.setRenderer(this.renderer),this.input.bindEvents()}internalOnUpdateVisible(){var n,e;(n=this._intersectionObserver)==null||n.disconnect(),(e=this._intersectionObserver)==null||e.observe(this.domElement)}requestSizeUpdate(){this._sizeChanged=!0}updateSize(n=!1){var e,i,s;if(n||!this.isManagedExternally&&((e=this.renderer.xr)==null?void 0:e.isPresenting)===!1){this._sizeChanged=!1;const r=this.resolutionScaleFactor;let o=this.domWidth*r,a=this.domHeight*r;this.maxRenderResolution&&(this.maxRenderResolution.x=Math.max(1,this.maxRenderResolution.x),o=Math.min(this.maxRenderResolution.x,o),this.maxRenderResolution.y=Math.max(1,this.maxRenderResolution.y),a=Math.min(this.maxRenderResolution.y,a));const l=this.mainCamera;this.updateAspect(l),this.renderer.setSize(o,a,!0),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.domElement.style.width="100%",this.renderer.domElement.style.height="100%",this.composer&&((i=this.composer.setSize)==null||i.call(this.composer,o,a),"setPixelRatio"in this.composer&&typeof this.composer.setPixelRatio=="function"&&((s=this.composer.setPixelRatio)==null||s.call(this.composer,window.devicePixelRatio)))}}updateAspect(n,e,i){if(!n)return;e===void 0&&(e=this.domWidth),i===void 0&&(i=this.domHeight);const s=n.aspect;n.aspect=e/i,s!==n.aspect&&n.updateProjectionMatrix()}recreate(){this.clear(),this.create(this._originalCreationArgs)}async onCreate(n){return this.create(n)}async create(n){try{this._isCreating=!0,n!==this._originalCreationArgs&&(this._originalCreationArgs=Dv(n)),window.addEventListener("unhandledrejection",this.onUnhandledRejection);const e=await this.internalOnCreate(n);return this._isCreated=e,e}finally{window.removeEventListener("unhandledrejection",this.onUnhandledRejection),this._isCreating=!1}}onError(n){this.domElement.dispatchEvent(new CustomEvent("error",{detail:n}))}clear(){var n,e,i,s;yi.dispatchCallback(wi.ContextClearing,this),mc(this,wi.ContextClearing),ia(this.scene,!0,!0),this.scene=new Ls,(n=this.addressables)==null||n.dispose(),(e=this.lightmaps)==null||e.clear(),(s=(i=this.physics)==null?void 0:i.engine)==null||s.clearCaches(),this.isManagedExternally||this.renderer&&(this.renderer.renderLists.dispose(),this.renderer.state.reset(),this.renderer.resetState()),yi.dispatchCallback(wi.ContextCleared,this)}dispose(){this.internalOnDestroy()}onDestroy(){this.internalOnDestroy()}internalOnDestroy(){var n,e;on.Current=this,yi.dispatchCallback(wi.ContextDestroying,this),mc(this,wi.ContextDestroying),this.clear(),(n=this.renderer)==null||n.setAnimationLoop(null),this.renderer&&(this.renderer.setClearAlpha(0),this.renderer.clear(),this.isManagedExternally||(ws&&console.log("Disposing renderer"),this.renderer.dispose())),this.scene=null,this.renderer=null,this.input.dispose(),this.menu.onDestroy(),this.animations.onDestroy();for(const i of this._disposeCallbacks)try{i()}catch(s){console.error("Error in on dispose callback:",s,i)}(e=this.domElement)!=null&&e.parentElement&&this.domElement.parentElement.removeChild(this.domElement),this._isCreated=!1,yi.dispatchCallback(wi.ContextDestroyed,this),mc(this,wi.ContextDestroyed),yi.unregister(this),on.Current===this&&(on.Current=null)}registerCoroutineUpdate(n,e,i){return typeof e?.next!="function"?(console.error("Registered invalid coroutine function from "+n.name+`
Coroutine functions must be generators: "*myCoroutine() {...}"
Start a coroutine from a component by calling "this.startCoroutine(myCoroutine())"`),e):(this.coroutines[i]||(this.coroutines[i]=[]),this.coroutines[i].push({comp:n,main:e}),e)}unregisterCoroutineUpdate(n,e){if(!this.coroutines[e])return;const i=this.coroutines[e].findIndex(s=>s.main===n);i>=0&&this.coroutines[e].splice(i,1)}stopAllCoroutinesFrom(n){for(const e in this.coroutines){const i=this.coroutines[e];for(let s=i.length-1;s>=0;s--)i[s].comp===n&&i.splice(s,1)}}setCurrentCamera(n){var e;if(!n)return;if(n.threeCamera||n.buildCamera(),!n.threeCamera){console.warn("Camera component is missing camera",n);return}const i=this._cameraStack.indexOf(n);i>=0&&this._cameraStack.splice(i,1),this._cameraStack.push(n),this.mainCameraComponent=n;const s=n.threeCamera;s.isPerspectiveCamera&&this.updateAspect(s),(e=this.mainCameraComponent)==null||e.applyClearFlagsIfIsActiveCamera()}removeCamera(n){if(!n)return;const e=this._cameraStack.indexOf(n);if(e>=0&&this._cameraStack.splice(e,1),this.mainCameraComponent===n&&(this.mainCameraComponent=void 0,this._cameraStack.length>0)){const i=this._cameraStack[this._cameraStack.length-1];this.setCurrentCamera(i)}}addBeforeRenderListener(n,e){this._onBeforeRenderListeners.has(n.uuid)||(this._onBeforeRenderListeners.set(n.uuid,[]),n.onBeforeRender=this._createRenderCallbackWrapper(n,this._onBeforeRenderListeners)),this._onBeforeRenderListeners.get(n.uuid).push(e)}removeBeforeRenderListener(n,e){if(this._onBeforeRenderListeners.has(n.uuid)){const i=this._onBeforeRenderListeners.get(n.uuid),s=i.indexOf(e);s>=0&&i.splice(s,1)}}addAfterRenderListener(n,e){var i;this._onAfterRenderListeners.has(n.uuid)||(this._onAfterRenderListeners.set(n.uuid,[]),n.onAfterRender=this._createRenderCallbackWrapper(n,this._onAfterRenderListeners)),(i=this._onAfterRenderListeners.get(n.uuid))==null||i.push(e)}removeAfterRenderListener(n,e){if(this._onAfterRenderListeners.has(n.uuid)){const i=this._onAfterRenderListeners.get(n.uuid),s=i.indexOf(e);s>=0&&i.splice(s,1)}}_createRenderCallbackWrapper(n,e){return(i,s,r,o,a,l)=>{const c=e.get(n.uuid);if(c)for(let h=0;h<c.length;h++){const u=c[h];u(i,s,r,o,a,l)}}}get isRendering(){return this._isRendering}setRequireDepth(n){this._requireDepthTexture=n}setRequireColor(n){this._requireColorTexture=n}get depthTexture(){var n;return((n=this._renderTarget)==null?void 0:n.depthTexture)||null}get opaqueColorTexture(){var n;return((n=this._renderTarget)==null?void 0:n.texture)||null}get isVisibleToUser(){if(this.isInXR)return!0;if(!this._isVisible)return!1;const n=getComputedStyle(this.domElement);return n.visibility!=="hidden"&&n.display!=="none"&&n.opacity!=="0"}async internalOnCreate(n){var e,i,s,r,o,a,l,c;const h=++this._createId;ws&&console.log("Creating context",this.name,n);const u=globalThis["needle:dependencies:ready"];u instanceof Promise&&(ws&&console.log("Waiting for dependencies to be ready"),await u.catch(g=>{if(ws||Ye()){if(R_("Needle Engine dependencies failed to load. Please check the console for more details"),g instanceof ReferenceError){let y="YourComponentName";const v=g.message.indexOf("'");if(v>0){const b=g.message.indexOf("'",v+1);if(b>0){const A=g.message.substring(v+1,b);A.length>3&&(y=A)}}console.error(`Needle Engine dependencies failed to load:

# Make sure you don't have circular imports in your scripts!
\u2192 Possible solution: Replace @serializable(${y}) in your script with @serializable(Behaviour)

---`,g);return}console.error("Needle Engine dependencies failed to load",g)}}).then(()=>{ws&&console.log("Needle Engine dependencies are ready")})),this.clear(),this.isManagedExternally===!1&&(this.createNewRenderer(),(e=this.renderer)==null||e.setAnimationLoop(null)),await oc(1),on.Current=this,await yi.dispatchCallback(wi.ContextCreationStart,this);let d=!0,m;try{on.Current=this,n?m=await this.internalLoadInitialContent(h,n):m=[]}catch(g){console.error(g),d=!1}if(!d)return this.onError("Failed to load initial content"),!1;if(h!==this._createId||(i=n?.abortSignal)!=null&&i.aborted)return!1;if(this.internalOnUpdateVisible(),!this.renderer)return ws&&console.warn("Context has no renderer (perhaps it was disconnected?",this.domElement.isConnected),!1;!this.isManagedExternally&&!this.domElement.shadowRoot&&this.domElement.prepend(this.renderer.domElement),on.Current=this,on.Current=this;for(let g=0;g<this.new_scripts.length;g++){const y=this.new_scripts[g];if(y.gameObject!==void 0&&y.gameObject!==null){y.gameObject.userData===void 0&&(y.gameObject.userData={}),y.gameObject.userData.components===void 0&&(y.gameObject.userData.components=[]);const v=y.gameObject.userData.components;v.includes(y)||v.push(y)}}if(this.post_setup_callbacks)for(let g=0;g<this.post_setup_callbacks.length;g++)on.Current=this,await this.post_setup_callbacks[g](this);if(!this._mainCamera){on.Current=this;let g=null;Tm(this.scene,y=>{const v=y;if(v!=null&&v.isCamera){if(Xb(v.gameObject),!v.activeAndEnabled)return;if(v.tag==="MainCamera")return g=v,!0;g=v}}),g?this.setCurrentCamera(g):!yi.dispatchCallback(wi.MissingCamera,this,{files:m})&&!this.mainCamera&&!this.isManagedExternally&&console.warn("Missing camera in main scene",this)}if(this.input.bindEvents(),on.Current=this,jS(this),this.physics.engine&&((s=this.physics.engine)==null||s.step(0),(r=this.physics.engine)==null||r.postStep()),!this.isManagedExternally&&this.composer&&this.mainCamera){const g=new B_(this.scene,this.mainCamera);this.renderer.setSize(this.domWidth,this.domHeight),this.composer.addPass(g),this.composer.setSize(this.domWidth,this.domHeight)}this._sizeChanged=!0,this._stats&&(this._stats.showPanel(0),this._stats.dom.style.position="absolute",(o=this.domElement.shadowRoot)==null||o.appendChild(this._stats.dom)),ws&&E_(this.scene,!0),this.targetFrameRate===void 0?(ws&&console.warn("No target framerate set, using default",on.DefaultTargetFrameRate),this.targetFrameRate=on._defaultTargetFramerate):ws&&console.log("Target framerate set to",this.targetFrameRate),this._dispatchReadyAfterFrame=!0;const f=yi.dispatchCallback(wi.ContextCreated,this,{files:m});return f&&("internalSetLoadingMessage"in this.domElement&&typeof this.domElement.internalSetLoadingMessage=="function"&&((a=this.domElement)==null||a.internalSetLoadingMessage("finish loading")),await f),(l=n?.abortSignal)!=null&&l.aborted?!1:(mc(this,wi.ContextCreated),ws&&console.log("Context Created...",this.renderer,this.renderer.domElement),this._isCreating=!1,!this.isManagedExternally&&!((c=n?.abortSignal)!=null&&c.aborted)&&this.restartRenderLoop(),!0)}async internalLoadInitialContent(n,e){var i,s,r,o;const a=new Array;if(e.files.length===0)return a;const l=[...e.files],c={name:"",progress:null,index:0,count:l.length},h=yl(),u=0;for(let d=0;d<l.length;d++){if((i=e.abortSignal)!=null&&i.aborted){ws&&console.log("Aborting loading because of abort signal");break}if(n!==this._createId){ws&&console.log("Aborting loading because create id changed",n,this._createId);break}const m=l[d];(s=e?.onLoadingStart)==null||s.call(this,d,m),ws&&console.log("Context Load "+m);const f=await h.loadSync(this,m,m,u,g=>{var y,v;(y=e.abortSignal)!=null&&y.aborted||(c.name=m,c.progress=g,c.index=d,c.count=l.length,(v=e.onLoadingProgress)==null||v.call(this,c))});(r=e?.onLoadingFinished)==null||r.call(this,d,m,f??null),f?a.push({src:m,file:f}):console.warn("Could not load file: "+m)}if(n!==this._createId||(o=e.abortSignal)!=null&&o.aborted){for(const d of a)if(d&&d.file)for(const m of d.file.scenes)ia(m,!0,!0)}else{let d=!1;for(const m of a)m&&m.file&&(m.file.scene?(d=!0,this.scene.add(m.file.scene)):console.warn("No scene found in loaded file"));if(!d){for(const m of a)if(m&&m.file){let f=0;for(let g=0;g<m.file.parser.json.materials.length;g++){const y=await m.file.parser.getDependency("material",g),v=new ye;v.position.x=g*1.1,v.position.y=f,this.scene.add(v),dd.createPrimitive("ShaderBall",{parent:v,material:y})}f+=1}}}return a}restartRenderLoop(){return this.renderer?this._isCreating?(console.warn("Can not start render loop while creating context"),!1):(this.renderer.setAnimationLoop((n,e)=>{this.isManagedExternally||this.update(n,e)}),!0):(console.error("Can not start render loop without renderer"),!1)}update(n,e){if(e===void 0&&(e=null),Ye()||ws||ume())try{performance.mark("update.start"),this.internalStep(n,e),this._renderlooperrors=0,performance.mark("update.end"),performance.measure("NE Frame","update.start","update.end")}catch(i){this._renderlooperrors+=1,(Ye()||ws)&&(i instanceof Error||i instanceof TypeError)&&gn("Caught unhandled exception during render-loop - see console for details.",Zo.Error),console.error("Frame #"+this.time.frame+`
`,i),this._renderlooperrors>=3&&(console.warn("Stopping render loop due to error"),this.renderer.setAnimationLoop(null)),this.domElement.dispatchEvent(new CustomEvent("error",{detail:i}))}else this.internalStep(n,e)}updatePhysics(n){this.internalUpdatePhysics(n)}internalStep(n,e){this.internalOnBeforeRender(n,e)!==!1&&(this.internalOnRender(),this.internalOnAfterRender())}internalOnBeforeRender(n,e){var i;this.renderer.info.autoReset=!0;const s=e!==null&&this._xrFrame===null;if(this._xrFrame=e,s&&this.domElement.dispatchEvent(new CustomEvent("xr-session-started",{detail:{context:this,session:this.xrSession,frame:e}})),this._currentFrameEvent=-1,this.isManagedExternally===!1&&this.isInXR===!1&&this.targetFrameRate!==void 0){this._lastTimestamp===0&&(this._lastTimestamp=n),this._accumulatedTime+=(n-this._lastTimestamp)/1e3,this._lastTimestamp=n;let r=this.targetFrameRate;if(typeof r=="object"&&(r=r.value),this._accumulatedTime<1/(r+1))return!1;this._accumulatedTime=0}if((i=this._stats)==null||i.begin(),on.Current=this,this.onHandlePaused())return!1;for(on.Current=this,this.time.update(),qfe&&console.log("FPS",this.time.smoothedFps.toFixed(0)),jS(this),QS(this.scene),w9(this),mc(this,-1);this._cameraStack.length>0&&(!this.mainCameraComponent||this.mainCameraComponent.destroyed);){this._cameraStack.splice(this._cameraStack.length-1,1);const r=this._cameraStack[this._cameraStack.length-1];this.setCurrentCamera(r)}if(this.pre_update_oneshot_callbacks){for(const r in this.pre_update_oneshot_callbacks)this.pre_update_oneshot_callbacks[r]();this.pre_update_oneshot_callbacks.length=0}if(this.pre_update_callbacks)for(const r in this.pre_update_callbacks)this.pre_update_callbacks[r]();this._currentFrameEvent=0;for(let r=0;r<this.scripts_earlyUpdate.length;r++){const o=this.scripts_earlyUpdate[r];o.activeAndEnabled&&o.earlyUpdate!==void 0&&(on.Current=this,o.earlyUpdate())}if(this.executeCoroutines(0),mc(this,0),this.onHandlePaused())return!1;this._currentFrameEvent=1;for(let r=0;r<this.scripts_update.length;r++){const o=this.scripts_update[r];o.activeAndEnabled&&o.update!==void 0&&(on.Current=this,o.update())}if(this.executeCoroutines(1),mc(this,1),this.onHandlePaused())return!1;this._currentFrameEvent=2;for(let r=0;r<this.scripts_lateUpdate.length;r++){const o=this.scripts_lateUpdate[r];o.activeAndEnabled&&o.lateUpdate!==void 0&&(on.Current=this,o.lateUpdate())}if(this.executeCoroutines(2),mc(this,2),this.onHandlePaused()||(this.physicsSteps===void 0&&(this.physicsSteps=1),this.physics.engine&&this.physicsSteps>0&&this.internalUpdatePhysics(this.physicsSteps),this.onHandlePaused()))return!1;if(this.isVisibleToUser||this.runInBackground){this._currentFrameEvent=3;for(let r=0;r<this.scripts_onBeforeRender.length;r++){const o=this.scripts_onBeforeRender[r];o.activeAndEnabled&&o.onBeforeRender!==void 0&&(on.Current=this,o.onBeforeRender(e))}if(this.executeCoroutines(3),mc(this,3),this._sizeChanged&&this.updateSize(),this.pre_render_callbacks)for(const r in this.pre_render_callbacks)this.pre_render_callbacks[r](e)}return!0}internalUpdatePhysics(n){if(!this.physics.engine)return!1;const e=n,i=this.time.deltaTime/e;for(let s=0;s<e;s++)this._currentFrameEvent=9,this.executeCoroutines(9),this.physics.engine.step(i),this._currentFrameEvent=10,this.executeCoroutines(10);return this.physics.engine.postStep(),!0}internalOnRender(){this.isManagedExternally||(fme(this),this._currentFrameEvent=-1,this.renderNow(),this._currentFrameEvent=4)}internalOnAfterRender(){if(this.isVisibleToUser||this.runInBackground){for(let n=0;n<this.scripts_onAfterRender.length;n++){const e=this.scripts_onAfterRender[n];e.activeAndEnabled&&e.onAfterRender!==void 0&&(on.Current=this,e.onAfterRender())}if(this.executeCoroutines(4),mc(this,4),this.post_render_callbacks)for(const n in this.post_render_callbacks)this.post_render_callbacks[n]()}this._currentFrameEvent=-1,this.connection.sendBufferedMessagesNow(),this._stats&&(this._stats.end(),this.time.frameCount%150===0&&console.log(this.renderer.info.render.calls+" DrawCalls",`
Render:`,{...this.renderer.info.render},`
Memory:`,{...this.renderer.info.memory},`
Target Framerate: `+this.targetFrameRate)),this._dispatchReadyAfterFrame&&(this._dispatchReadyAfterFrame=!1,this.domElement.dispatchEvent(new CustomEvent("ready")),yi.dispatchCallback(wi.ContextFirstFrameRendered,this))}renderNow(n){return!n&&(n=this.mainCamera,!n)?!1:(this.handleRendererContextLost(),this._isRendering=!0,this.renderRequiredTextures(),this.renderer.toneMapping!==Yr&&Z4(),this.composer&&!this.isInXR?this.composer.render(this.time.deltaTime):n&&(this.isInXR&&xt.isMacOS()&&this.renderer.clearDepth(),this.renderer.render(this.scene,n)),this._isRendering=!1,!0)}handleRendererContextLost(){this.renderer.getContext().isContextLost()&&(console.warn("Attempting to recover WebGL context..."),this.renderer.forceContextRestore())}onHandlePaused(){const n=this.evaluatePaused();if(this._wasPaused!==n){Jfe&&console.log("Paused?",n,"context:"+this.alias);for(let e=0;e<this.scripts_pausedChanged.length;e++){const i=this.scripts_pausedChanged[e];i.activeAndEnabled&&i.onPausedChanged!==void 0&&(on.Current=this,i.onPausedChanged(n,this._wasPaused))}}return this._wasPaused=n,n}evaluatePaused(){return this.isInXR?!1:this.isPaused?!0:this.runInBackground?!1:!this.isVisibleToUser}renderRequiredTextures(){if(!this.mainCamera||!this._requireDepthTexture&&!this._requireColorTexture)return;if(!this._renderTarget){if(this._renderTarget=new Zt(this.domWidth,this.domHeight),this._requireDepthTexture){const i=new tg(this.domWidth,this.domHeight);this._renderTarget.depthTexture=i}this._requireColorTexture&&(this._renderTarget.texture=new Vt,this._renderTarget.texture.generateMipmaps=!1,this._renderTarget.texture.minFilter=Dt,this._renderTarget.texture.magFilter=Dt,this._renderTarget.texture.format=_i)}const n=this._renderTarget;n.texture&&(n.texture.colorSpace=this.renderer.outputColorSpace);const e=this.renderer.getRenderTarget();this.renderer.setRenderTarget(n),this.renderer.render(this.scene,this.mainCamera),this.renderer.setRenderTarget(e)}executeCoroutines(n){var e;if(this.coroutines[n]){const s=this.coroutines[n];for(let r=0;r<s.length;r++)try{const o=s[r];if(!o.comp||o.comp.destroyed||!o.main||o.comp.enabled===!1){$fe&&console.log("Removing coroutine",o.comp,o.comp.enabled),s.splice(r,1),--r;continue}const a=o.chained;if(a&&a.length>0){const h=a[a.length-1].next();if(h.done&&a.pop(),i(h)&&(o.chained||(o.chained=[]),o.chained.push(h.value)),!h.done)continue}const l=o.main.next();if(l.done===!0){s.splice(r,1),--r;continue}const c=l.value;if(i(c)){if(c.next().done)continue;o.chained||(o.chained=[]),o.chained.push(c)}else if(c instanceof Promise){const h=c;o.chained||(o.chained=[]);const u=S4(h);(e=o.chained)==null||e.push(u);continue}}catch(o){console.error(o)}}function i(s){return!!(s&&s.next&&s.return)}}};let Pt=on;p(Pt,"_defaultTargetFramerate",{value:90,toString(){return this.value}}),p(Pt,"_defaultWebglRendererParameters",{antialias:!0,alpha:!1,powerPreference:xt.isiOS()||xt.isMacOS()?"default":"high-performance"});const Ha=te("debuglicense");let Im="basic";Ha&&console.log("License Type: "+Im);function xd(){switch(Im){case"pro":case"enterprise":return!0}return!1}function Ek(){switch(Im){case"indie":return!0}return!1}function Wh(){return xd()||Ek()}const ij=[];function ige(n){if(xd()||Ek())return n(!0);ij.push(n)}function nge(n){for(const e of ij)try{e(n)}catch{}}yi.registerCallback(wi.ContextRegistered,n=>{oge(n.context),lge(),rge(n.context)});let Lm,Tk=!1,kC="";async function sge(){if(Lm)return Lm;if(Im==="basic")try{const n="https://engine.needle.tools/licensing/check?location="+encodeURIComponent(window.location.href)+"&version="+xl+"&generator="+encodeURIComponent(I_),e=await fetch(n,{method:"GET"}).catch(i=>{Ha&&console.error("License check failed",i)});e?.status===200?(Tk=!1,Ha&&console.log("License check succeeded"),Im="pro",nge(!0)):e?.status===403?(Tk=!0,kC=await e.text()):Ha&&console.log("License check failed with status "+e?.status)}catch(n){Ha&&console.error("License check failed",n)}else Ha&&console.log('Runtime license check is skipped because license is already applied as "'+Im+'"')}Lm=sge();async function rge(n){function e(){const r=document.createElement("div");r.className="needle-forbidden",r.style.cssText=`
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: all;
        zIndex: 2147483647;
        line-height: 1.5;
        backdrop-filter: blur(15px);
        -webkit-backdrop-filter: blur(15px);
        `;const o=r.style.cssText,a=document.createElement("div");r.appendChild(a),a.style.cssText=`
        position: absolute;
        left: 0;
        right: 0;
        top:0;
        bottom: 0;
        padding: 10%;
        color: white;
        font-size: 20px;
        font-family: sans-serif;
        text-align: center;
        pointer-events: all;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: rgba(0,0,0,.3);
        text-shadow: 0 0 2px black;
        `;const l=a.style.cssText,c=kC?.length>1?kC:"This web application has been paused.<br/>You might be in violation of the Needle Engine terms of use.<br/>Please contact the Needle support if you think this is a mistake.";return a.innerHTML=c,setInterval(()=>{a.innerHTML!==c&&(a.innerHTML=c),a.parentNode!==r&&r.appendChild(a),r.style.cssText!==o&&(r.style.cssText=o),a.style.cssText!==l&&(a.style.cssText=l)},500),r}let i=e();const s=i.style.cssText;setInterval(()=>{var r;Tk===!0&&(i.style.cssText!==s&&(i=e()),n.domElement.shadowRoot?i.parentNode!==n.domElement.shadowRoot&&((r=n.domElement.shadowRoot)==null||r.appendChild(i)):i.parentNode!=document.body&&document.body.appendChild(i))},500)}async function oge(n){try{if(Wh()!==!0)return Rk(n)}catch(e){return Ha&&console.log("License check failed",e),Rk(n)}Ha&&Rk(n)}async function Rk(n){n.domElement.addEventListener("ready",()=>!0),await Lm?.catch(()=>{}),!Wh()&&age()}let nj=0;async function age(n){var e;const i=Date.now();if(i-nj<2e3)return;nj=i;const s=`
        position: relative;
        display: block;
        font-size: 18px;
        background-size: 20px;
        background-position: 10px 5px;
        background-repeat:no-repeat;
        background-image:url('data:image/webp;base64,UklGRrABAABXRUJQVlA4WAoAAAAQAAAAHwAAHwAAQUxQSKEAAAARN6CmbSM4WR7vdARON11EBDq3fLiNbVtVzpMCPlKAEzsx0Y/x+Ovuv4dn0EFE/ydAvz6YggXzgh5sVgXM/zOC/4sii7qgGvB5N7hmuQYwkvazWAu1JPW41FXSHq6pnaQWvqYH18Fc0j1hO/BFTtIeSBlJi5w6qIIO7IOrwhFsB2Yxukif0FTRLpXswHR8MxbslKe9VZsn/Ub5C7YFOpqSTABWUDgg6AAAAFAGAJ0BKiAAIAA+7VyoTqmkpCI3+qgBMB2JbACdMt69DwMIQBLhkTO6XwY00UEDK6cNIDnuNibPf0EgAP7Y1myuiQHLDsF/0h5unrGh6WAbv7aegg2ZMd3uRKfT/3SJztcaujYfTvMXspfCTmYcoO6a+vhC3ss4M8uM58t4siiu59I4aOl59e9Sr6xoxYlHf2v+NnBNpJYeJf8jABQAId/PXuBkLEFkiCucgSGEcfhvajql/j3reCGl0M5/9gQWy7ayNPs+wlvIxFnNfSlfuND4CZOCyxOHhRqOmHN4ULHo3tCSrUNvgAA=');
        background-max-size: 40px;
        margin-bottom: 5px;
        margin-top: .3em;
        margin-bottom: .5em;
        padding: .2em;
        padding-left: 25px;
        border-radius: .5em;
        border: 2px solid rgba(160,160,160,.3);
    `,r=`Needle Engine \u2014 No license active, commercial use is not allowed. Visit https://needle.tools/pricing for more information and licensing options! v${xl}`;(e=Pt.Current)!=null&&e.xr?console.log(r):console.log("%c "+r,s)}async function lge(){var n;try{const e="https://needle-engine-analytics-v2-r26roub2hq-lz.a.run.app";if(e){Ha&&console.log("Analytics backend url",e);const i=window.location.href.split("?")[0];let s="api/v2/new/request";e.endsWith("/")||(s="/"+s);const r=Im,o=`${e}${s}`;Ha&&console.log("Sending non-commercial usage message to analytics backend",o);const a={license:r,url:i,hostname:window.location.hostname,pathname:window.location.pathname,version:xl,generator:I_,build_time:fL},l=(n=navigator.sendBeacon)==null?void 0:n.call(navigator,o,JSON.stringify(a));Ha&&console.log("Send beacon result",l)}}catch(e){Ha&&console.log("Failed to send non-commercial usage message to analytics backend",e)}}const Pm=te("debugloading"),hA=te("debugloadingrendering"),sj=te("debuglicense");class cge{constructor(){p(this,"className"),p(this,"additionalClasses")}}let uA=0,rj;function Ik(n){Pm&&console.log(n.progress.loaded.toFixed(0)+"/"+n.progress.total.toFixed(0),n);const e=n.count,i=n.progress.total;i===0||i===void 0?(rj!==n.name&&(uA=0),rj=n.name,uA+=(1-uA)*.001,Pm&&zi("Loading "+n.name+" did not report total size")):uA=n.progress.loaded/i;const s=n.index/e+uA/e;return tt.clamp01(s)}const Lk=class{constructor(n,e){p(this,"loadingProgress",0),p(this,"_element"),p(this,"_progress",0),p(this,"_allowCustomLoadingElement",!0),p(this,"_loadingElement"),p(this,"_loadingTextContainer",null),p(this,"_loadingBar",null),p(this,"_messageContainer",null),p(this,"_loadingElementOptions"),p(this,"_progressLoop"),this._element=n,this._loadingElementOptions=e}async onLoadingBegin(n){const e=this._element.shadowRoot||this._element;if(Pm&&console.warn("Begin Loading"),!this._loadingElement){for(let i=0;i<e.children.length;i++){const s=e.children[i];if(s.classList.contains(Lk.LoadingContainerClassName)){if(!this._allowCustomLoadingElement){Pm&&console.warn("Remove custom loading container"),e.removeChild(s);continue}this._loadingElement=this.createLoadingElement(s)}}this._loadingElement||(this._loadingElement=this.createLoadingElement())}this._progress=0,this.loadingProgress=0,this._loadingElement.style.display="flex",e.appendChild(this._loadingElement),this.smoothProgressLoop(),this.setMessage(n??"")}onLoadingUpdate(n,e){var i;if(!((i=this._loadingElement)!=null&&i.parentNode))return;let s=0;typeof n=="number"?s=n:("index"in n&&(s=Ik(n)),!e&&"name"in n&&this.setMessage("loading "+n.name)),this.loadingProgress=s,e&&this.setMessage(e),this.updateDisplay()}onLoadingFinished(){Pm&&console.warn("Finished Loading"),hA||(this.loadingProgress=1,this.onDoneLoading())}setMessage(n){this._messageContainer&&(this._messageContainer.innerText=n)}smoothProgressLoop(){if(this._progressLoop)return;let n=1/12;hA&&(n=1/500,typeof hA=="number"&&(n*=hA)),this._progressLoop=setInterval(()=>{this.loadingProgress>=.95&&!hA&&(n=.9),this._progress=tt.lerp(this._progress,this.loadingProgress,n*this.loadingProgress),this.updateDisplay()},n)}onDoneLoading(){this._loadingElement&&(Pm&&console.log("Hiding loading element"),this._loadingElement.style.display="none",this._loadingElement.remove()),this._progressLoop&&clearInterval(this._progressLoop),this._progressLoop=null}updateDisplay(){const n=this._progress,e=(n*100).toFixed(0)+"%";this._loadingBar&&(this._loadingBar.style.width=n*100+"%"),this._loadingTextContainer&&(this._loadingTextContainer.textContent=e)}createLoadingElement(n){var e,i;Pm&&!n&&console.log("Creating loading element"),this._loadingElement=n||document.createElement("div");let s=this._element.getAttribute("loading-style");(!s||s==="auto")&&(window.matchMedia("(prefers-color-scheme: dark)").matches?s="dark":s="light");const r=xd();if(!n&&(this._loadingElement.style.position="absolute",this._loadingElement.style.width="100%",this._loadingElement.style.height="100%",this._loadingElement.style.left="0",this._loadingElement.style.top="0",s==="light"?this._loadingElement.style.backgroundColor="#ddd":this._loadingElement.style.backgroundColor="#222",this._loadingElement.style.display="flex",this._loadingElement.style.alignItems="center",this._loadingElement.style.justifyContent="center",this._loadingElement.style.zIndex=Number.MAX_SAFE_INTEGER.toString(),this._loadingElement.style.flexDirection="column",this._loadingElement.style.pointerEvents="none",this._loadingElement.style.color="white",this._loadingElement.style.fontFamily='system-ui, Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',this._loadingElement.style.fontSize="1rem",s==="light"?this._loadingElement.style.color="rgba(0,0,0,.6)":this._loadingElement.style.color="rgba(255,255,255,.3)",r&&this._element)){const y=this._element.getAttribute("loading-background-color");y&&(this._loadingElement.style.backgroundColor=y);const v=this._element.getAttribute("loading-text-color");v&&(this._loadingElement.style.color=v)}const o=((e=this._loadingElementOptions)==null?void 0:e.className)??Lk.LoadingContainerClassName;if(this._loadingElement.classList.add(o),(i=this._loadingElementOptions)!=null&&i.additionalClasses)for(const y of this._loadingElementOptions.additionalClasses)this._loadingElement.classList.add(y);const a=document.createElement("div");this._loadingElement.appendChild(a);const l=document.createElement("img"),c=120;l.style.width=`${c}px`,l.style.height=`${c}px`,l.style.paddingTop="20px",l.style.paddingBottom="10px",l.style.margin="0px",l.style.userSelect="none",l.style.objectFit="contain",l.style.transition="transform 1.5s ease-out, opacity .3s ease-in-out",l.style.transform="translateY(30px)",l.style.opacity="0.05",setTimeout(()=>{l.style.opacity="1",l.style.transform="translateY(0px)"},1),l.src=Yoe;let h=!1;if(r&&this._element){const y=this._element.getAttribute("loading-logo-src");y&&(h=!0,l.src=y)}h||(l.style.cursor="pointer",l.style.pointerEvents="all",l.addEventListener("click",()=>window.open("https://needle.tools","_blank"))),a.appendChild(l);const u=document.createElement("div");u.style.cssText=`
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: 100%;
        opacity: 0;
        transition: opacity 1s ease-in-out 4s;
        `,setTimeout(()=>{u.style.opacity="1"},1),this._loadingElement.appendChild(u);const d=document.createElement("div"),m=100;d.style.display="flex",d.style.width=m+"%",d.style.height="3px",d.style.position="absolute",d.style.left="0",d.style.bottom="0px",d.style.opacity="0",d.style.transition="opacity 1s ease-in-out 2s",setTimeout(()=>{d.style.opacity="1"},1),s==="light"?d.style.backgroundColor="rgba(0,0,0,.2)":d.style.backgroundColor="rgba(255,255,255,.2)",this._loadingElement.appendChild(d),this._loadingBar=document.createElement("div"),d.appendChild(this._loadingBar);const f=function(y){return tt.lerp(0,m,y)+"%"};if(this._loadingBar.style.background=`linear-gradient(90deg, #204f49 ${f(0)}, #0BA398 ${f(.3)}, #66A22F ${f(.6)}, #D7DB0A ${f(1)})`,this._loadingBar.style.backgroundAttachment="fixed",this._loadingBar.style.width="0%",this._loadingBar.style.height="100%",r&&this._element){const y=this._element.getAttribute("primary-color"),v=this._element.getAttribute("secondary-color");y&&v?this._loadingBar.style.background=`linear-gradient(90deg, ${y} ${f(0)}, ${v} ${f(1)})`:y?this._loadingBar.style.background=y:v&&(this._loadingBar.style.background=v)}this._loadingTextContainer=document.createElement("div"),this._loadingTextContainer.style.display="flex",this._loadingTextContainer.style.justifyContent="center",this._loadingTextContainer.style.marginTop=".2rem",u.appendChild(this._loadingTextContainer);const g=document.createElement("div");if(this._messageContainer=g,g.style.display="flex",g.style.fontSize=".8rem",g.style.paddingTop=".1rem",g.style.justifyContent="center",u.appendChild(g),r&&this._element){const y=this._element.getAttribute("loading-text-color");y&&(g.style.color=y)}return this.handleRuntimeLicense(this._loadingElement),this._loadingElement}async handleRuntimeLicense(n){let e=Wh();if(e)return;sj&&console.log("Loading UI has commercial license?",e);const i=document.createElement("div");i.style.paddingTop=".6em",i.style.fontSize=".8em",i.style.textTransform="uppercase",i.innerText=`NEEDLE ENGINE NON COMMERCIAL VERSION
CLICK HERE TO GET A LICENSE`,i.style.cursor="pointer",i.style.userSelect="none",i.style.textAlign="center",i.style.pointerEvents="all",i.addEventListener("click",()=>window.open("https://needle.tools/pricing","_self")),i.style.opacity="0",n.appendChild(i),!Ye()&&Lm&&(sj&&console.log("Waiting for runtime license check"),await Lm,e=Wh()),!e&&(i.style.transition="opacity .5s ease-in-out",i.style.opacity="1")}};let Pk=Lk;p(Pk,"LoadingContainerClassName","loading");const dA=te("debugoverlay"),oj="ar",hge="quit-ar";class uge{constructor(){p(this,"arContainer",null),p(this,"currentSession",null),p(this,"_createdAROnlyElements",[]),p(this,"_reparentedObjects",[]),p(this,"contentElement",null),p(this,"originalDomOverlayParent",null),p(this,"requestEndAR",()=>{this.onRequestedEndAR()})}get ARContainer(){return this.arContainer}onBegin(e,i,s){var r;if(this.currentSession=s,this.arContainer=i,xt.isMozillaXR()){const o=e.domElement.children;for(let a=0;a<o?.length;a++){const l=o[a];if(!l||l===this.arContainer)return;this._reparentedObjects.push({el:l,previousParent:l.parentElement}),(r=this.arContainer)==null||r.appendChild(l)}i?(this.originalDomOverlayParent=i.parentNode,this.originalDomOverlayParent&&(console.log("Reparent DOM Overlay to body",i,i.style.display),i.style.display="",i.style.visibility="",document.body.appendChild(i))):console.warn("WebXRViewer: No DOM Overlay found")}this.ensureQuitARButton(this.arContainer)}onEnd(e){var i;for(const s of this._createdAROnlyElements)s.remove&&s.remove();for(const s of this._reparentedObjects){const r=s.el;(i=s.previousParent)==null||i.appendChild(r)}this._reparentedObjects.length=0,xt.isMozillaXR()&&setTimeout(()=>{var s;const r=e.renderer.domElement;r&&((s=e.domElement.shadowRoot)==null||s.prepend(r));const o=document.querySelectorAll("*");for(var a=0;a<o.length;a++){const l=o[a];l&&l._displayChanged!==void 0&&l._displayWas!==void 0&&(l.style.display=l._displayWas)}},10)}createOverlayContainer(e){if(this.contentElement)return this.contentElement;dA&&console.log("Setup overlay container");const i=e.shadowRoot.querySelector(".content");this.contentElement=i;const s=e.shadowRoot.querySelector(".overlay-content");return s&&i.appendChild(s),dA&&!xt.isMobileDevice()&&this.ensureQuitARButton(i),i}onRequestedEndAR(){this.currentSession&&(this.currentSession.end(),this.currentSession=null)}ensureQuitARButton(e){const i=document.createElement("slot");i.setAttribute("name","quit-ar"),this.appendElement(i,e),this._createdAROnlyElements.push(i),i.style.pointerEvents="auto";const s=document.querySelector(`.${hge}`);if(s){s.addEventListener("click",this.requestEndAR),dA&&s.addEventListener("click",()=>console.log("Clicked quit-ar button"));return}i.addEventListener("click",this.requestEndAR),dA&&i.addEventListener("click",()=>console.log("Clicked fallback close button"));const r=document.createElement("div");r.style.cssText=`
            position: fixed;
            top: 0;
            right: 0;
            z-index: 600;
            pointer-events: all;
        `,this.appendElement(r,i);var o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.classList.add("quit-ar-button"),o.setAttribute("width","40px"),o.setAttribute("height","40px"),o.style.cssText=`
            background: rgba(255, 255, 255, .4);
            -webkit-backdrop-filter: blur(8px);
            backdrop-filter: blur(8px);
            border-radius: 50%;
            box-shadow: 0 0 5px rgba(0,0,0,.3);
            outline: 1px solid rgba(255, 255, 255, .6);
            display: flex;
            justify-content: center;
            align-items: center;
        `,r.appendChild(o);var a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttribute("d","M 12,12 L 28,28 M 28,12 12,28"),a.setAttribute("stroke","#000000"),a.setAttribute("stroke-width","2px"),a.style.cssText=`
            /**filter: drop-shadow(0 0px 1.2px rgba(0,0,0,.7));**/
        `,o.appendChild(a),dA&&console.log("Created fallback close button",o,e)}appendElement(e,i){return i.shadowRoot?i.shadowRoot.appendChild(e):i.appendChild(e)}}const DC=te("debugdecoders");let Bk,kk=null;function OC(){if(!kk){const n=IP(null);kk={dracoLoader:n.dracoLoader,ktx2Loader:n.ktx2Loader,meshoptDecoder:n.meshoptDecoder}}return kk}function aj(n){if(n!==void 0&&typeof n=="string"){Hue(n);const e=OC();DC&&console.log("Setting draco decoder path to",n),e.dracoLoader.setDecoderPath(n)}}function lj(n){if(n!==void 0&&typeof n=="string"){const e=OC();DC&&console.log("Setting draco decoder type to",n),e.dracoLoader.setDecoderConfig({type:n})}}function cj(n){if(n!==void 0&&typeof n=="string"){jue(n);const e=OC();DC&&console.log("Setting ktx2 transcoder path to",n),e.ktx2Loader.setTranscoderPath(n)}}function GC(n,e){const i=OC();return Bk||(Bk=i.meshoptDecoder,DC&&console.log("Using the default meshopt decoder")),e.renderer?i.ktx2Loader.detectSupport(e.renderer):console.warn("No renderer provided to detect ktx2 support - loading KTX2 textures will probably fail"),n.dracoLoader||n.setDRACOLoader(i.dracoLoader),n.ktx2Loader||n.setKTX2Loader(i.ktx2Loader),n.meshoptDecoder||n.setMeshoptDecoder(Bk),n}function hj(n,e,i){const s=i.length-n-1;if(e>=i[s])return s-1;if(e<=i[n])return n;let r=n,o=s,a=Math.floor((r+o)/2);for(;e<i[a]||e>=i[a+1];)e<i[a]?o=a:r=a,a=Math.floor((r+o)/2);return a}function dge(n,e,i,s){const r=[],o=[],a=[];r[0]=1;for(let l=1;l<=i;++l){o[l]=e-s[n+1-l],a[l]=s[n+l]-e;let c=0;for(let h=0;h<l;++h){const u=a[h+1],d=o[l-h],m=r[h]/(u+d);r[h]=c+u*m,c=d*m}r[l]=c}return r}function pge(n,e,i,s){const r=hj(n,s,e),o=dge(r,s,n,e),a=new Ze(0,0,0,0);for(let l=0;l<=n;++l){const c=i[r-n+l],h=o[l],u=c.w*h;a.x+=c.x*u,a.y+=c.y*u,a.z+=c.z*u,a.w+=c.w*h}return a}function mge(n,e,i,s,r){const o=[];for(let d=0;d<=i;++d)o[d]=0;const a=[];for(let d=0;d<=s;++d)a[d]=o.slice(0);const l=[];for(let d=0;d<=i;++d)l[d]=o.slice(0);l[0][0]=1;const c=o.slice(0),h=o.slice(0);for(let d=1;d<=i;++d){c[d]=e-r[n+1-d],h[d]=r[n+d]-e;let m=0;for(let f=0;f<d;++f){const g=h[f+1],y=c[d-f];l[d][f]=g+y;const v=l[f][d-1]/l[d][f];l[f][d]=m+g*v,m=y*v}l[d][d]=m}for(let d=0;d<=i;++d)a[0][d]=l[d][i];for(let d=0;d<=i;++d){let m=0,f=1;const g=[];for(let y=0;y<=i;++y)g[y]=o.slice(0);g[0][0]=1;for(let y=1;y<=s;++y){let v=0;const b=d-y,A=i-y;d>=y&&(g[f][0]=g[m][0]/l[A+1][b],v=g[f][0]*l[b][A]);const x=b>=-1?1:-b,w=d-1<=A?y-1:i-d;for(let S=x;S<=w;++S)g[f][S]=(g[m][S]-g[m][S-1])/l[A+1][b+S],v+=g[f][S]*l[b+S][A];d<=A&&(g[f][y]=-g[m][y-1]/l[A+1][d],v+=g[f][y]*l[d][A]),a[y][d]=v;const _=m;m=f,f=_}}let u=i;for(let d=1;d<=s;++d){for(let m=0;m<=i;++m)a[d][m]*=u;u*=i-d}return a}function fge(n,e,i,s,r){const o=r<n?r:n,a=[],l=hj(n,s,e),c=mge(l,s,n,o,e),h=[];for(let u=0;u<i.length;++u){const d=i[u].clone(),m=d.w;d.x*=m,d.y*=m,d.z*=m,h[u]=d}for(let u=0;u<=o;++u){const d=h[l-n].clone().multiplyScalar(c[u][0]);for(let m=1;m<=n;++m)d.add(h[l-n+m].clone().multiplyScalar(c[u][m]));a[u]=d}for(let u=o+1;u<=r+1;++u)a[u]=new Ze(0,0,0);return a}function gge(n,e){let i=1;for(let r=2;r<=n;++r)i*=r;let s=1;for(let r=2;r<=e;++r)s*=r;for(let r=2;r<=n-e;++r)s*=r;return i/s}function yge(n){const e=n.length,i=[],s=[];for(let o=0;o<e;++o){const a=n[o];i[o]=new E(a.x,a.y,a.z),s[o]=a.w}const r=[];for(let o=0;o<e;++o){const a=i[o].clone();for(let l=1;l<=o;++l)a.sub(r[o-l].clone().multiplyScalar(gge(o,l)*s[l]));r[o]=a.divideScalar(s[0])}return r}function vge(n,e,i,s,r){const o=fge(n,e,i,s,r);return yge(o)}class bge extends Ra{constructor(e,i,s,r,o){super(),this.degree=e,this.knots=i,this.controlPoints=[],this.startKnot=r||0,this.endKnot=o||this.knots.length-1;for(let a=0;a<s.length;++a){const l=s[a];this.controlPoints[a]=new Ze(l.x,l.y,l.z,l.w)}}getPoint(e,i=new E){const s=i,r=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),o=pge(this.degree,this.knots,this.controlPoints,r);return o.w!==1&&o.divideScalar(o.w),s.set(o.x,o.y,o.z)}getTangent(e,i=new E){const s=i,r=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),o=vge(this.degree,this.knots,this.controlPoints,r,1);return s.copy(o[1]).normalize(),s}}let ri,Hn,uo;class uj extends es{constructor(e){super(e)}load(e,i,s,r){const o=this,a=o.path===""?Ah.extractUrlBase(e):o.path,l=new qs(this.manager);l.setPath(o.path),l.setResponseType("arraybuffer"),l.setRequestHeader(o.requestHeader),l.setWithCredentials(o.withCredentials),l.load(e,function(c){try{i(o.parse(c,a))}catch(h){r?r(h):console.error(h),o.manager.itemError(e)}},s,r)}parse(e,i){if(Cge(e))ri=new Sge().parse(e);else{const r=yj(e);if(!Mge(r))throw new Error("THREE.FBXLoader: Unknown format.");if(mj(r)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+mj(r));ri=new _ge().parse(r)}const s=new sc(this.manager).setPath(this.resourcePath||i).setCrossOrigin(this.crossOrigin);return new Age(s,this.manager).parse(ri)}}class Age{constructor(e,i){this.textureLoader=e,this.manager=i}parse(){Hn=this.parseConnections();const e=this.parseImages(),i=this.parseTextures(e),s=this.parseMaterials(i),r=this.parseDeformers(),o=new xge().parse(r);return this.parseScene(r,o,s),uo}parseConnections(){const e=new Map;return"Connections"in ri&&ri.Connections.connections.forEach(function(i){const s=i[0],r=i[1],o=i[2];e.has(s)||e.set(s,{parents:[],children:[]});const a={ID:r,relationship:o};e.get(s).parents.push(a),e.has(r)||e.set(r,{parents:[],children:[]});const l={ID:s,relationship:o};e.get(r).children.push(l)}),e}parseImages(){const e={},i={};if("Video"in ri.Objects){const s=ri.Objects.Video;for(const r in s){const o=s[r],a=parseInt(r);if(e[a]=o.RelativeFilename||o.Filename,"Content"in o){const l=o.Content instanceof ArrayBuffer&&o.Content.byteLength>0,c=typeof o.Content=="string"&&o.Content!=="";if(l||c){const h=this.parseImage(s[r]);i[o.RelativeFilename||o.Filename]=h}}}}for(const s in e){const r=e[s];i[r]!==void 0?e[s]=i[r]:e[s]=e[s].split("\\").pop()}return e}parseImage(e){const i=e.Content,s=e.RelativeFilename||e.Filename,r=s.slice(s.lastIndexOf(".")+1).toLowerCase();let o;switch(r){case"bmp":o="image/bmp";break;case"jpg":case"jpeg":o="image/jpeg";break;case"png":o="image/png";break;case"tif":o="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",s),o="image/tga";break;default:console.warn('FBXLoader: Image type "'+r+'" is not supported.');return}if(typeof i=="string")return"data:"+o+";base64,"+i;{const a=new Uint8Array(i);return window.URL.createObjectURL(new Blob([a],{type:o}))}}parseTextures(e){const i=new Map;if("Texture"in ri.Objects){const s=ri.Objects.Texture;for(const r in s){const o=this.parseTexture(s[r],e);i.set(parseInt(r),o)}}return i}parseTexture(e,i){const s=this.loadTexture(e,i);s.ID=e.id,s.name=e.attrName;const r=e.WrapModeU,o=e.WrapModeV,a=r!==void 0?r.value:0,l=o!==void 0?o.value:0;if(s.wrapS=a===0?_o:qn,s.wrapT=l===0?_o:qn,"Scaling"in e){const c=e.Scaling.value;s.repeat.x=c[0],s.repeat.y=c[1]}if("Translation"in e){const c=e.Translation.value;s.offset.x=c[0],s.offset.y=c[1]}return s}loadTexture(e,i){let s;const r=this.textureLoader.path,o=Hn.get(e.id).children;o!==void 0&&o.length>0&&i[o[0].ID]!==void 0&&(s=i[o[0].ID],(s.indexOf("blob:")===0||s.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let a;const l=e.FileName.slice(-3).toLowerCase();if(l==="tga"){const c=this.manager.getHandler(".tga");c===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),a=new Vt):(c.setPath(this.textureLoader.path),a=c.load(s))}else if(l==="dds"){const c=this.manager.getHandler(".dds");c===null?(console.warn("FBXLoader: DDS loader not found, creating placeholder texture for",e.RelativeFilename),a=new Vt):(c.setPath(this.textureLoader.path),a=c.load(s))}else l==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),a=new Vt):a=this.textureLoader.load(s);return this.textureLoader.setPath(r),a}parseMaterials(e){const i=new Map;if("Material"in ri.Objects){const s=ri.Objects.Material;for(const r in s){const o=this.parseMaterial(s[r],e);o!==null&&i.set(parseInt(r),o)}}return i}parseMaterial(e,i){const s=e.id,r=e.attrName;let o=e.ShadingModel;if(typeof o=="object"&&(o=o.value),!Hn.has(s))return null;const a=this.parseParameters(e,i,s);let l;switch(o.toLowerCase()){case"phong":l=new dg;break;case"lambert":l=new V2;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',o),l=new dg;break}return l.setValues(a),l.name=r,l}parseParameters(e,i,s){const r={};e.BumpFactor&&(r.bumpScale=e.BumpFactor.value),e.Diffuse?r.color=new Ae().fromArray(e.Diffuse.value).convertSRGBToLinear():e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(r.color=new Ae().fromArray(e.DiffuseColor.value).convertSRGBToLinear()),e.DisplacementFactor&&(r.displacementScale=e.DisplacementFactor.value),e.Emissive?r.emissive=new Ae().fromArray(e.Emissive.value).convertSRGBToLinear():e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(r.emissive=new Ae().fromArray(e.EmissiveColor.value).convertSRGBToLinear()),e.EmissiveFactor&&(r.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(r.opacity=parseFloat(e.Opacity.value)),r.opacity<1&&(r.transparent=!0),e.ReflectionFactor&&(r.reflectivity=e.ReflectionFactor.value),e.Shininess&&(r.shininess=e.Shininess.value),e.Specular?r.specular=new Ae().fromArray(e.Specular.value).convertSRGBToLinear():e.SpecularColor&&e.SpecularColor.type==="Color"&&(r.specular=new Ae().fromArray(e.SpecularColor.value).convertSRGBToLinear());const o=this;return Hn.get(s).children.forEach(function(a){const l=a.relationship;switch(l){case"Bump":r.bumpMap=o.getTexture(i,a.ID);break;case"Maya|TEX_ao_map":r.aoMap=o.getTexture(i,a.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":r.map=o.getTexture(i,a.ID),r.map!==void 0&&(r.map.colorSpace=vt);break;case"DisplacementColor":r.displacementMap=o.getTexture(i,a.ID);break;case"EmissiveColor":r.emissiveMap=o.getTexture(i,a.ID),r.emissiveMap!==void 0&&(r.emissiveMap.colorSpace=vt);break;case"NormalMap":case"Maya|TEX_normal_map":r.normalMap=o.getTexture(i,a.ID);break;case"ReflectionColor":r.envMap=o.getTexture(i,a.ID),r.envMap!==void 0&&(r.envMap.mapping=Kr,r.envMap.colorSpace=vt);break;case"SpecularColor":r.specularMap=o.getTexture(i,a.ID),r.specularMap!==void 0&&(r.specularMap.colorSpace=vt);break;case"TransparentColor":case"TransparencyFactor":r.alphaMap=o.getTexture(i,a.ID),r.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",l);break}}),r}getTexture(e,i){return"LayeredTexture"in ri.Objects&&i in ri.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),i=Hn.get(i).children[0].ID),e.get(i)}parseDeformers(){const e={},i={};if("Deformer"in ri.Objects){const s=ri.Objects.Deformer;for(const r in s){const o=s[r],a=Hn.get(parseInt(r));if(o.attrType==="Skin"){const l=this.parseSkeleton(a,s);l.ID=r,a.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),l.geometryID=a.parents[0].ID,e[r]=l}else if(o.attrType==="BlendShape"){const l={id:r};l.rawTargets=this.parseMorphTargets(a,s),l.id=r,a.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),i[r]=l}}}return{skeletons:e,morphTargets:i}}parseSkeleton(e,i){const s=[];return e.children.forEach(function(r){const o=i[r.ID];if(o.attrType!=="Cluster")return;const a={ID:r.ID,indices:[],weights:[],transformLink:new he().fromArray(o.TransformLink.a)};"Indexes"in o&&(a.indices=o.Indexes.a,a.weights=o.Weights.a),s.push(a)}),{rawBones:s,bones:[]}}parseMorphTargets(e,i){const s=[];for(let r=0;r<e.children.length;r++){const o=e.children[r],a=i[o.ID],l={name:a.attrName,initialWeight:a.DeformPercent,id:a.id,fullWeights:a.FullWeights.a};if(a.attrType!=="BlendShapeChannel")return;l.geoID=Hn.get(parseInt(o.ID)).children.filter(function(c){return c.relationship===void 0})[0].ID,s.push(l)}return s}parseScene(e,i,s){uo=new Vn;const r=this.parseModels(e.skeletons,i,s),o=ri.Objects.Model,a=this;r.forEach(function(c){var h;const u=o[c.ID];a.setLookAtProperties(c,u);const d=(h=Hn.get(c.ID))==null?void 0:h.parents;d?.forEach(function(m){const f=r.get(m.ID);f!==void 0&&f.add(c)}),c.parent===null&&uo.add(c)}),this.bindSkeleton(e.skeletons,i,r),this.addGlobalSceneSettings(),uo.traverse(function(c){if(c.userData.transformData){c.parent&&(c.userData.transformData.parentMatrix=c.parent.matrix,c.userData.transformData.parentMatrixWorld=c.parent.matrixWorld);const h=fj(c.userData.transformData);c.applyMatrix4(h),c.updateWorldMatrix()}});const l=new wge().parse();uo.children.length===1&&uo.children[0].isGroup&&(uo.children[0].animations=l,uo=uo.children[0]),uo.animations=l}parseModels(e,i,s){const r=new Map,o=ri.Objects.Model;for(const a in o){const l=parseInt(a),c=o[a],h=Hn.get(l);let u=this.buildSkeleton(h,e,l,c.attrName);if(!u){switch(c.attrType){case"Camera":u=this.createCamera(h);break;case"Light":u=this.createLight(h);break;case"Mesh":u=this.createMesh(h,i,s);break;case"NurbsCurve":u=this.createCurve(h,i);break;case"LimbNode":case"Root":u=new zp;break;case"Null":default:u=new Vn;break}u.name=c.attrName?Jt.sanitizeNodeName(c.attrName):"",u.userData.originalName=c.attrName,u.ID=l}this.getTransformData(u,c),r.set(l,u)}return r}buildSkeleton(e,i,s,r){let o=null;return e?.parents.forEach(function(a){for(const l in i){const c=i[l];c.rawBones.forEach(function(h,u){if(h.ID===a.ID){const d=o;o=new zp,o.matrixWorld.copy(h.transformLink),o.name=r?Jt.sanitizeNodeName(r):"",o.userData.originalName=r,o.ID=s,c.bones[u]=o,d!==null&&o.add(d)}})}}),o}createCamera(e){let i,s;if(e.children.forEach(function(r){const o=ri.Objects.NodeAttribute[r.ID];o!==void 0&&(s=o)}),s===void 0)i=new ye;else{let r=0;s.CameraProjectionType!==void 0&&s.CameraProjectionType.value===1&&(r=1);let o=1;s.NearPlane!==void 0&&(o=s.NearPlane.value/1e3);let a=1e3;s.FarPlane!==void 0&&(a=s.FarPlane.value/1e3);let l=window.innerWidth,c=window.innerHeight;s.AspectWidth!==void 0&&s.AspectHeight!==void 0&&(l=s.AspectWidth.value,c=s.AspectHeight.value);const h=l/c;let u=45;s.FieldOfView!==void 0&&(u=s.FieldOfView.value);const d=s.FocalLength?s.FocalLength.value:null;switch(r){case 0:i=new Lt(u,h,o,a),d!==null&&i.setFocalLength(d);break;case 1:i=new ic(-l/2,l/2,c/2,-c/2,o,a);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+r+"."),i=new ye;break}}return i}createLight(e){let i,s;if(e.children.forEach(function(r){const o=ri.Objects.NodeAttribute[r.ID];o!==void 0&&(s=o)}),s===void 0)i=new ye;else{let r;s.LightType===void 0?r=0:r=s.LightType.value;let o=16777215;s.Color!==void 0&&(o=new Ae().fromArray(s.Color.value).convertSRGBToLinear());let a=s.Intensity===void 0?1:s.Intensity.value/100;s.CastLightOnObject!==void 0&&s.CastLightOnObject.value===0&&(a=0);let l=0;s.FarAttenuationEnd!==void 0&&(s.EnableFarAttenuation!==void 0&&s.EnableFarAttenuation.value===0?l=0:l=s.FarAttenuationEnd.value);const c=1;switch(r){case 0:i=new Wp(o,a,l,c);break;case 1:i=new Hp(o,a);break;case 2:let h=Math.PI/3;s.InnerAngle!==void 0&&(h=oi.degToRad(s.InnerAngle.value));let u=0;s.OuterAngle!==void 0&&(u=oi.degToRad(s.OuterAngle.value),u=Math.max(u,1)),i=new Pv(o,a,l,h,u,c);break;default:console.warn("THREE.FBXLoader: Unknown light type "+s.LightType.value+", defaulting to a PointLight."),i=new Wp(o,a);break}s.CastShadows!==void 0&&s.CastShadows.value===1&&(i.castShadow=!0)}return i}createMesh(e,i,s){let r,o=null,a=null;const l=[];return e.children.forEach(function(c){i.has(c.ID)&&(o=i.get(c.ID)),s.has(c.ID)&&l.push(s.get(c.ID))}),l.length>1?a=l:l.length>0?a=l[0]:(a=new dg({name:es.DEFAULT_MATERIAL_NAME,color:13421772}),l.push(a)),"color"in o.attributes&&l.forEach(function(c){c.vertexColors=!0}),o.FBX_Deformer?(r=new Eo(o,a),r.normalizeSkinWeights()):r=new pe(o,a),r}createCurve(e,i){const s=e.children.reduce(function(o,a){return i.has(a.ID)&&(o=i.get(a.ID)),o},null),r=new Vi({name:es.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new mn(s,r)}getTransformData(e,i){const s={};"InheritType"in i&&(s.inheritType=parseInt(i.InheritType.value)),"RotationOrder"in i?s.eulerOrder=gj(i.RotationOrder.value):s.eulerOrder="ZYX","Lcl_Translation"in i&&(s.translation=i.Lcl_Translation.value),"PreRotation"in i&&(s.preRotation=i.PreRotation.value),"Lcl_Rotation"in i&&(s.rotation=i.Lcl_Rotation.value),"PostRotation"in i&&(s.postRotation=i.PostRotation.value),"Lcl_Scaling"in i&&(s.scale=i.Lcl_Scaling.value),"ScalingOffset"in i&&(s.scalingOffset=i.ScalingOffset.value),"ScalingPivot"in i&&(s.scalingPivot=i.ScalingPivot.value),"RotationOffset"in i&&(s.rotationOffset=i.RotationOffset.value),"RotationPivot"in i&&(s.rotationPivot=i.RotationPivot.value),e.userData.transformData=s}setLookAtProperties(e,i){"LookAtProperty"in i&&Hn.get(e.ID).children.forEach(function(s){if(s.relationship==="LookAtProperty"){const r=ri.Objects.Model[s.ID];if("Lcl_Translation"in r){const o=r.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(o),uo.add(e.target)):e.lookAt(new E().fromArray(o))}}})}bindSkeleton(e,i,s){const r=this.parsePoseNodes();for(const o in e){const a=e[o];Hn.get(parseInt(a.ID)).parents.forEach(function(l){if(i.has(l.ID)){const c=l.ID;Hn.get(c).parents.forEach(function(h){s.has(h.ID)&&s.get(h.ID).bind(new xv(a.bones),r[h.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in ri.Objects){const i=ri.Objects.Pose;for(const s in i)if(i[s].attrType==="BindPose"&&i[s].NbPoseNodes>0){const r=i[s].PoseNode;Array.isArray(r)?r.forEach(function(o){e[o.Node]=new he().fromArray(o.Matrix.a)}):e[r.Node]=new he().fromArray(r.Matrix.a)}}return e}addGlobalSceneSettings(){if("GlobalSettings"in ri){if("AmbientColor"in ri.GlobalSettings){const e=ri.GlobalSettings.AmbientColor.value,i=e[0],s=e[1],r=e[2];if(i!==0||s!==0||r!==0){const o=new Ae(i,s,r).convertSRGBToLinear();uo.add(new jw(o,1))}}"UnitScaleFactor"in ri.GlobalSettings&&(uo.userData.unitScaleFactor=ri.GlobalSettings.UnitScaleFactor.value)}}}class xge{constructor(){this.negativeMaterialIndices=!1}parse(e){const i=new Map;if("Geometry"in ri.Objects){const s=ri.Objects.Geometry;for(const r in s){const o=Hn.get(parseInt(r)),a=this.parseGeometry(o,s[r],e);i.set(parseInt(r),a)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),i}parseGeometry(e,i,s){switch(i.attrType){case"Mesh":return this.parseMeshGeometry(e,i,s);case"NurbsCurve":return this.parseNurbsGeometry(i)}}parseMeshGeometry(e,i,s){const r=s.skeletons,o=[],a=e.parents.map(function(d){return ri.Objects.Model[d.ID]});if(a.length===0)return;const l=e.children.reduce(function(d,m){return r[m.ID]!==void 0&&(d=r[m.ID]),d},null);e.children.forEach(function(d){s.morphTargets[d.ID]!==void 0&&o.push(s.morphTargets[d.ID])});const c=a[0],h={};"RotationOrder"in c&&(h.eulerOrder=gj(c.RotationOrder.value)),"InheritType"in c&&(h.inheritType=parseInt(c.InheritType.value)),"GeometricTranslation"in c&&(h.translation=c.GeometricTranslation.value),"GeometricRotation"in c&&(h.rotation=c.GeometricRotation.value),"GeometricScaling"in c&&(h.scale=c.GeometricScaling.value);const u=fj(h);return this.genGeometry(i,l,o,u)}genGeometry(e,i,s,r){const o=new dt;e.attrName&&(o.name=e.attrName);const a=this.parseGeoNode(e,i),l=this.genBuffers(a),c=new st(l.vertex,3);if(c.applyMatrix4(r),o.setAttribute("position",c),l.colors.length>0&&o.setAttribute("color",new st(l.colors,3)),i&&(o.setAttribute("skinIndex",new sw(l.weightsIndices,4)),o.setAttribute("skinWeight",new st(l.vertexWeights,4)),o.FBX_Deformer=i),l.normal.length>0){const h=new Gt().getNormalMatrix(r),u=new st(l.normal,3);u.applyNormalMatrix(h),o.setAttribute("normal",u)}if(l.uvs.forEach(function(h,u){const d=u===0?"uv":`uv${u}`;o.setAttribute(d,new st(l.uvs[u],2))}),a.material&&a.material.mappingType!=="AllSame"){let h=l.materialIndex[0],u=0;if(l.materialIndex.forEach(function(d,m){d!==h&&(o.addGroup(u,m-u,h),h=d,u=m)}),o.groups.length>0){const d=o.groups[o.groups.length-1],m=d.start+d.count;m!==l.materialIndex.length&&o.addGroup(m,l.materialIndex.length-m,h)}o.groups.length===0&&o.addGroup(0,l.materialIndex.length,l.materialIndex[0])}return this.addMorphTargets(o,e,s,r),o}parseGeoNode(e,i){const s={};if(s.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],s.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(s.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(s.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(s.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){s.uv=[];let r=0;for(;e.LayerElementUV[r];)e.LayerElementUV[r].UV&&s.uv.push(this.parseUVs(e.LayerElementUV[r])),r++}return s.weightTable={},i!==null&&(s.skeleton=i,i.rawBones.forEach(function(r,o){r.indices.forEach(function(a,l){s.weightTable[a]===void 0&&(s.weightTable[a]=[]),s.weightTable[a].push({id:o,weight:r.weights[l]})})})),s}genBuffers(e){const i={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let s=0,r=0,o=!1,a=[],l=[],c=[],h=[],u=[],d=[];const m=this;return e.vertexIndices.forEach(function(f,g){let y,v=!1;f<0&&(f=f^-1,v=!0);let b=[],A=[];if(a.push(f*3,f*3+1,f*3+2),e.color){const x=zC(g,s,f,e.color);c.push(x[0],x[1],x[2])}if(e.skeleton){if(e.weightTable[f]!==void 0&&e.weightTable[f].forEach(function(x){A.push(x.weight),b.push(x.id)}),A.length>4){o||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),o=!0);const x=[0,0,0,0],w=[0,0,0,0];A.forEach(function(_,S){let M=_,R=b[S];w.forEach(function(P,C,L){if(M>P){L[C]=M,M=P;const B=x[C];x[C]=R,R=B}})}),b=x,A=w}for(;A.length<4;)A.push(0),b.push(0);for(let x=0;x<4;++x)u.push(A[x]),d.push(b[x])}if(e.normal){const x=zC(g,s,f,e.normal);l.push(x[0],x[1],x[2])}e.material&&e.material.mappingType!=="AllSame"&&(y=zC(g,s,f,e.material)[0],y<0&&(m.negativeMaterialIndices=!0,y=0)),e.uv&&e.uv.forEach(function(x,w){const _=zC(g,s,f,x);h[w]===void 0&&(h[w]=[]),h[w].push(_[0]),h[w].push(_[1])}),r++,v&&(m.genFace(i,e,a,y,l,c,h,u,d,r),s++,r=0,a=[],l=[],c=[],h=[],u=[],d=[])}),i}getNormalNewell(e){const i=new E(0,0,0);for(let s=0;s<e.length;s++){const r=e[s],o=e[(s+1)%e.length];i.x+=(r.y-o.y)*(r.z+o.z),i.y+=(r.z-o.z)*(r.x+o.x),i.z+=(r.x-o.x)*(r.y+o.y)}return i.normalize(),i}getNormalTangentAndBitangent(e){const i=this.getNormalNewell(e),s=(Math.abs(i.z)>.5?new E(0,1,0):new E(0,0,1)).cross(i).normalize(),r=i.clone().cross(s).normalize();return{normal:i,tangent:s,bitangent:r}}flattenVertex(e,i,s){return new Y(e.dot(i),e.dot(s))}genFace(e,i,s,r,o,a,l,c,h,u){let d;if(u>3){const m=[];for(let v=0;v<s.length;v+=3)m.push(new E(i.vertexPositions[s[v]],i.vertexPositions[s[v+1]],i.vertexPositions[s[v+2]]));const{tangent:f,bitangent:g}=this.getNormalTangentAndBitangent(m),y=[];for(const v of m)y.push(this.flattenVertex(v,f,g));d=Yl.triangulateShape(y,[])}else d=[[0,1,2]];for(const[m,f,g]of d)e.vertex.push(i.vertexPositions[s[m*3]]),e.vertex.push(i.vertexPositions[s[m*3+1]]),e.vertex.push(i.vertexPositions[s[m*3+2]]),e.vertex.push(i.vertexPositions[s[f*3]]),e.vertex.push(i.vertexPositions[s[f*3+1]]),e.vertex.push(i.vertexPositions[s[f*3+2]]),e.vertex.push(i.vertexPositions[s[g*3]]),e.vertex.push(i.vertexPositions[s[g*3+1]]),e.vertex.push(i.vertexPositions[s[g*3+2]]),i.skeleton&&(e.vertexWeights.push(c[m*4]),e.vertexWeights.push(c[m*4+1]),e.vertexWeights.push(c[m*4+2]),e.vertexWeights.push(c[m*4+3]),e.vertexWeights.push(c[f*4]),e.vertexWeights.push(c[f*4+1]),e.vertexWeights.push(c[f*4+2]),e.vertexWeights.push(c[f*4+3]),e.vertexWeights.push(c[g*4]),e.vertexWeights.push(c[g*4+1]),e.vertexWeights.push(c[g*4+2]),e.vertexWeights.push(c[g*4+3]),e.weightsIndices.push(h[m*4]),e.weightsIndices.push(h[m*4+1]),e.weightsIndices.push(h[m*4+2]),e.weightsIndices.push(h[m*4+3]),e.weightsIndices.push(h[f*4]),e.weightsIndices.push(h[f*4+1]),e.weightsIndices.push(h[f*4+2]),e.weightsIndices.push(h[f*4+3]),e.weightsIndices.push(h[g*4]),e.weightsIndices.push(h[g*4+1]),e.weightsIndices.push(h[g*4+2]),e.weightsIndices.push(h[g*4+3])),i.color&&(e.colors.push(a[m*3]),e.colors.push(a[m*3+1]),e.colors.push(a[m*3+2]),e.colors.push(a[f*3]),e.colors.push(a[f*3+1]),e.colors.push(a[f*3+2]),e.colors.push(a[g*3]),e.colors.push(a[g*3+1]),e.colors.push(a[g*3+2])),i.material&&i.material.mappingType!=="AllSame"&&(e.materialIndex.push(r),e.materialIndex.push(r),e.materialIndex.push(r)),i.normal&&(e.normal.push(o[m*3]),e.normal.push(o[m*3+1]),e.normal.push(o[m*3+2]),e.normal.push(o[f*3]),e.normal.push(o[f*3+1]),e.normal.push(o[f*3+2]),e.normal.push(o[g*3]),e.normal.push(o[g*3+1]),e.normal.push(o[g*3+2])),i.uv&&i.uv.forEach(function(y,v){e.uvs[v]===void 0&&(e.uvs[v]=[]),e.uvs[v].push(l[v][m*2]),e.uvs[v].push(l[v][m*2+1]),e.uvs[v].push(l[v][f*2]),e.uvs[v].push(l[v][f*2+1]),e.uvs[v].push(l[v][g*2]),e.uvs[v].push(l[v][g*2+1])})}addMorphTargets(e,i,s,r){if(s.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const o=this;s.forEach(function(a){a.rawTargets.forEach(function(l){const c=ri.Objects.Geometry[l.geoID];c!==void 0&&o.genMorphGeometry(e,i,c,r,l.name)})})}genMorphGeometry(e,i,s,r,o){const a=i.PolygonVertexIndex!==void 0?i.PolygonVertexIndex.a:[],l=s.Vertices!==void 0?s.Vertices.a:[],c=s.Indexes!==void 0?s.Indexes.a:[],h=e.attributes.position.count*3,u=new Float32Array(h);for(let g=0;g<c.length;g++){const y=c[g]*3;u[y]=l[g*3],u[y+1]=l[g*3+1],u[y+2]=l[g*3+2]}const d={vertexIndices:a,vertexPositions:u},m=this.genBuffers(d),f=new st(m.vertex,3);f.name=o||s.attrName,f.applyMatrix4(r),e.morphAttributes.position.push(f)}parseNormals(e){const i=e.MappingInformationType,s=e.ReferenceInformationType,r=e.Normals.a;let o=[];return s==="IndexToDirect"&&("NormalIndex"in e?o=e.NormalIndex.a:"NormalsIndex"in e&&(o=e.NormalsIndex.a)),{dataSize:3,buffer:r,indices:o,mappingType:i,referenceType:s}}parseUVs(e){const i=e.MappingInformationType,s=e.ReferenceInformationType,r=e.UV.a;let o=[];return s==="IndexToDirect"&&(o=e.UVIndex.a),{dataSize:2,buffer:r,indices:o,mappingType:i,referenceType:s}}parseVertexColors(e){if(!e.Colors)return;const i=e.MappingInformationType,s=e.ReferenceInformationType,r=e.Colors.a;let o=[];s==="IndexToDirect"&&(o=e.ColorIndex.a);for(let a=0,l=new Ae;a<r.length;a+=4)l.fromArray(r,a).convertSRGBToLinear().toArray(r,a);return{dataSize:4,buffer:r,indices:o,mappingType:i,referenceType:s}}parseMaterialIndices(e){const i=e.MappingInformationType,s=e.ReferenceInformationType;if(i==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:s};const r=e.Materials.a,o=[];for(let a=0;a<r.length;++a)o.push(a);return{dataSize:1,buffer:r,indices:o,mappingType:i,referenceType:s}}parseNurbsGeometry(e){const i=parseInt(e.Order);if(isNaN(i))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new dt;const s=i-1,r=e.KnotVector.a,o=[],a=e.Points.a;for(let u=0,d=a.length;u<d;u+=4)o.push(new Ze().fromArray(a,u));let l,c;if(e.Form==="Closed")o.push(o[0]);else if(e.Form==="Periodic"){l=s,c=r.length-1-l;for(let u=0;u<s;++u)o.push(o[u])}const h=new bge(s,r,o,l,c).getPoints(o.length*12);return new dt().setFromPoints(h)}}class wge{parse(){const e=[],i=this.parseClips();if(i!==void 0)for(const s in i){const r=i[s],o=this.addClip(r);e.push(o)}return e}parseClips(){if(ri.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const i=this.parseAnimationLayers(e);return this.parseAnimStacks(i)}parseAnimationCurveNodes(){const e=ri.Objects.AnimationCurveNode,i=new Map;for(const s in e){const r=e[s];if(r.attrName.match(/S|R|T|DeformPercent/)!==null){const o={id:r.id,attr:r.attrName,curves:{}};i.set(o.id,o)}}return i}parseAnimationCurves(e){const i=ri.Objects.AnimationCurve;for(const s in i){const r={id:i[s].id,times:i[s].KeyTime.a.map(Ege),values:i[s].KeyValueFloat.a},o=Hn.get(r.id);if(o!==void 0){const a=o.parents[0].ID,l=o.parents[0].relationship;l.match(/X/)?e.get(a).curves.x=r:l.match(/Y/)?e.get(a).curves.y=r:l.match(/Z/)?e.get(a).curves.z=r:l.match(/DeformPercent/)&&e.has(a)&&(e.get(a).curves.morph=r)}}}parseAnimationLayers(e){const i=ri.Objects.AnimationLayer,s=new Map;for(const r in i){const o=[],a=Hn.get(parseInt(r));a!==void 0&&(a.children.forEach(function(l,c){if(e.has(l.ID)){const h=e.get(l.ID);if(h.curves.x!==void 0||h.curves.y!==void 0||h.curves.z!==void 0){if(o[c]===void 0){const u=Hn.get(l.ID).parents.filter(function(d){return d.relationship!==void 0})[0].ID;if(u!==void 0){const d=ri.Objects.Model[u.toString()];if(d===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",l);return}const m={modelName:d.attrName?Jt.sanitizeNodeName(d.attrName):"",ID:d.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};uo.traverse(function(f){f.ID===d.id&&(m.transform=f.matrix,f.userData.transformData&&(m.eulerOrder=f.userData.transformData.eulerOrder))}),m.transform||(m.transform=new he),"PreRotation"in d&&(m.preRotation=d.PreRotation.value),"PostRotation"in d&&(m.postRotation=d.PostRotation.value),o[c]=m}}o[c]&&(o[c][h.attr]=h)}else if(h.curves.morph!==void 0){if(o[c]===void 0){const u=Hn.get(l.ID).parents.filter(function(v){return v.relationship!==void 0})[0].ID,d=Hn.get(u).parents[0].ID,m=Hn.get(d).parents[0].ID,f=Hn.get(m).parents[0].ID,g=ri.Objects.Model[f],y={modelName:g.attrName?Jt.sanitizeNodeName(g.attrName):"",morphName:ri.Objects.Deformer[u].attrName};o[c]=y}o[c][h.attr]=h}}}),s.set(parseInt(r),o))}return s}parseAnimStacks(e){const i=ri.Objects.AnimationStack,s={};for(const r in i){const o=Hn.get(parseInt(r)).children;o.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const a=e.get(o[0].ID);s[r]={name:i[r].attrName,layer:a}}return s}addClip(e){let i=[];const s=this;return e.layer.forEach(function(r){i=i.concat(s.generateTracks(r))}),new to(e.name,-1,i)}generateTracks(e){const i=[];let s=new E,r=new E;if(e.transform&&e.transform.decompose(s,new Se,r),s=s.toArray(),r=r.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const o=this.generateVectorTrack(e.modelName,e.T.curves,s,"position");o!==void 0&&i.push(o)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const o=this.generateRotationTrack(e.modelName,e.R.curves,e.preRotation,e.postRotation,e.eulerOrder);o!==void 0&&i.push(o)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const o=this.generateVectorTrack(e.modelName,e.S.curves,r,"scale");o!==void 0&&i.push(o)}if(e.DeformPercent!==void 0){const o=this.generateMorphTrack(e);o!==void 0&&i.push(o)}return i}generateVectorTrack(e,i,s,r){const o=this.getTimesForAllAxes(i),a=this.getKeyframeTrackValues(o,i,s);return new nc(e+"."+r,o,a)}generateRotationTrack(e,i,s,r,o){let a,l;if(i.x===void 0||i.y===void 0||i.z===void 0){console.warn("THREE.FBXLoader: Missing rotation curves "+(i.x===void 0?"x ":"")+(i.y===void 0?"y ":"")+(i.z===void 0?"z ":"")+" for animation of "+e+". This is currently not supported.");return}if(i.x!==void 0&&i.y!==void 0&&i.z!==void 0){const d=this.interpolateRotations(i.x,i.y,i.z,o);a=d[0],l=d[1]}s!==void 0&&(s=s.map(oi.degToRad),s.push(o),s=new si().fromArray(s),s=new Se().setFromEuler(s)),r!==void 0&&(r=r.map(oi.degToRad),r.push(o),r=new si().fromArray(r),r=new Se().setFromEuler(r).invert());const c=new Se,h=new si,u=[];if(!(!l||!a)){for(let d=0;d<l.length;d+=3)h.set(l[d],l[d+1],l[d+2],o),c.setFromEuler(h),s!==void 0&&c.premultiply(s),r!==void 0&&c.multiply(r),d>2&&new Se().fromArray(u,(d-3)/3*4).dot(c)<0&&c.set(-c.x,-c.y,-c.z,-c.w),c.toArray(u,d/3*4);return new gl(e+".quaternion",a,u)}}generateMorphTrack(e){const i=e.DeformPercent.curves.morph,s=i.values.map(function(o){return o/100}),r=uo.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new yh(e.modelName+".morphTargetInfluences["+r+"]",i.times,s)}getTimesForAllAxes(e){let i=[];if(e.x!==void 0&&(i=i.concat(e.x.times)),e.y!==void 0&&(i=i.concat(e.y.times)),e.z!==void 0&&(i=i.concat(e.z.times)),i=i.sort(function(s,r){return s-r}),i.length>1){let s=1,r=i[0];for(let o=1;o<i.length;o++){const a=i[o];a!==r&&(i[s]=a,r=a,s++)}i=i.slice(0,s)}return i}getKeyframeTrackValues(e,i,s){const r=s,o=[];let a=-1,l=-1,c=-1;return e.forEach(function(h){if(i.x&&(a=i.x.times.indexOf(h)),i.y&&(l=i.y.times.indexOf(h)),i.z&&(c=i.z.times.indexOf(h)),a!==-1){const u=i.x.values[a];o.push(u),r[0]=u}else o.push(r[0]);if(l!==-1){const u=i.y.values[l];o.push(u),r[1]=u}else o.push(r[1]);if(c!==-1){const u=i.z.values[c];o.push(u),r[2]=u}else o.push(r[2])}),o}interpolateRotations(e,i,s,r){const o=[],a=[];o.push(e.times[0]),a.push(oi.degToRad(e.values[0])),a.push(oi.degToRad(i.values[0])),a.push(oi.degToRad(s.values[0]));for(let l=1;l<e.values.length;l++){const c=[e.values[l-1],i.values[l-1],s.values[l-1]];if(isNaN(c[0])||isNaN(c[1])||isNaN(c[2]))continue;const h=c.map(oi.degToRad),u=[e.values[l],i.values[l],s.values[l]];if(isNaN(u[0])||isNaN(u[1])||isNaN(u[2]))continue;const d=u.map(oi.degToRad),m=[u[0]-c[0],u[1]-c[1],u[2]-c[2]],f=[Math.abs(m[0]),Math.abs(m[1]),Math.abs(m[2])];if(f[0]>=180||f[1]>=180||f[2]>=180){const g=Math.max(...f)/180,y=new si(...h,r),v=new si(...d,r),b=new Se().setFromEuler(y),A=new Se().setFromEuler(v);b.dot(A)&&A.set(-A.x,-A.y,-A.z,-A.w);const x=e.times[l-1],w=e.times[l]-x,_=new Se,S=new si;for(let M=0;M<1;M+=1/g)_.copy(b.clone().slerp(A.clone(),M)),o.push(x+M*w),S.setFromQuaternion(_,r),a.push(S.x),a.push(S.y),a.push(S.z)}else o.push(e.times[l]),a.push(oi.degToRad(e.values[l])),a.push(oi.degToRad(i.values[l])),a.push(oi.degToRad(s.values[l]))}return[o,a]}}class _ge{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,i){this.currentProp=e,this.currentPropName=i}parse(e){this.currentIndent=0,this.allNodes=new pj,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const i=this,s=e.split(/[\r\n]+/);return s.forEach(function(r,o){const a=r.match(/^[\s\t]*;/),l=r.match(/^[\s\t]*$/);if(a||l)return;const c=r.match("^\\t{"+i.currentIndent+"}(\\w+):(.*){",""),h=r.match("^\\t{"+i.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),u=r.match("^\\t{"+(i.currentIndent-1)+"}}");c?i.parseNodeBegin(r,c):h?i.parseNodeProperty(r,h,s[++o]):u?i.popStack():r.match(/^[^\s\t}]/)&&i.parseNodePropertyContinued(r)}),this.allNodes}parseNodeBegin(e,i){const s=i[1].trim().replace(/^"/,"").replace(/"$/,""),r=i[2].split(",").map(function(c){return c.trim().replace(/^"/,"").replace(/"$/,"")}),o={name:s},a=this.parseNodeAttr(r),l=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(s,o):s in l?(s==="PoseNode"?l.PoseNode.push(o):l[s].id!==void 0&&(l[s]={},l[s][l[s].id]=l[s]),a.id!==""&&(l[s][a.id]=o)):typeof a.id=="number"?(l[s]={},l[s][a.id]=o):s!=="Properties70"&&(s==="PoseNode"?l[s]=[o]:l[s]=o),typeof a.id=="number"&&(o.id=a.id),a.name!==""&&(o.attrName=a.name),a.type!==""&&(o.attrType=a.type),this.pushStack(o)}parseNodeAttr(e){let i=e[0];e[0]!==""&&(i=parseInt(e[0]),isNaN(i)&&(i=e[0]));let s="",r="";return e.length>1&&(s=e[1].replace(/^(\w+)::/,""),r=e[2]),{id:i,name:s,type:r}}parseNodeProperty(e,i,s){let r=i[1].replace(/^"/,"").replace(/"$/,"").trim(),o=i[2].replace(/^"/,"").replace(/"$/,"").trim();r==="Content"&&o===","&&(o=s.replace(/"/g,"").replace(/,$/,"").trim());const a=this.getCurrentNode();if(a.name==="Properties70"){this.parseNodeSpecialProperty(e,r,o);return}if(r==="C"){const l=o.split(",").slice(1),c=parseInt(l[0]),h=parseInt(l[1]);let u=o.split(",").slice(3);u=u.map(function(d){return d.trim().replace(/^"/,"")}),r="connections",o=[c,h],Rge(o,u),a[r]===void 0&&(a[r]=[])}r==="Node"&&(a.id=o),r in a&&Array.isArray(a[r])?a[r].push(o):r!=="a"?a[r]=o:a.a=o,this.setCurrentProp(a,r),r==="a"&&o.slice(-1)!==","&&(a.a=Ok(o))}parseNodePropertyContinued(e){const i=this.getCurrentNode();i.a+=e,e.slice(-1)!==","&&(i.a=Ok(i.a))}parseNodeSpecialProperty(e,i,s){const r=s.split('",').map(function(u){return u.trim().replace(/^\"/,"").replace(/\s/,"_")}),o=r[0],a=r[1],l=r[2],c=r[3];let h=r[4];switch(a){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":h=parseFloat(h);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":h=Ok(h);break}this.getPrevNode()[o]={type:a,type2:l,flag:c,value:h},this.setCurrentProp(this.getPrevNode(),o)}}class Sge{parse(e){const i=new dj(e);i.skip(23);const s=i.getUint32();if(s<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+s);const r=new pj;for(;!this.endOfContent(i);){const o=this.parseNode(i,s);o!==null&&r.add(o.name,o)}return r}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,i){const s={},r=i>=7500?e.getUint64():e.getUint32(),o=i>=7500?e.getUint64():e.getUint32();i>=7500?e.getUint64():e.getUint32();const a=e.getUint8(),l=e.getString(a);if(r===0)return null;const c=[];for(let m=0;m<o;m++)c.push(this.parseProperty(e));const h=c.length>0?c[0]:"",u=c.length>1?c[1]:"",d=c.length>2?c[2]:"";for(s.singleProperty=o===1&&e.getOffset()===r;r>e.getOffset();){const m=this.parseNode(e,i);m!==null&&this.parseSubNode(l,s,m)}return s.propertyList=c,typeof h=="number"&&(s.id=h),u!==""&&(s.attrName=u),d!==""&&(s.attrType=d),l!==""&&(s.name=l),s}parseSubNode(e,i,s){if(s.singleProperty===!0){const r=s.propertyList[0];Array.isArray(r)?(i[s.name]=s,s.a=r):i[s.name]=r}else if(e==="Connections"&&s.name==="C"){const r=[];s.propertyList.forEach(function(o,a){a!==0&&r.push(o)}),i.connections===void 0&&(i.connections=[]),i.connections.push(r)}else if(s.name==="Properties70")Object.keys(s).forEach(function(r){i[r]=s[r]});else if(e==="Properties70"&&s.name==="P"){let r=s.propertyList[0],o=s.propertyList[1];const a=s.propertyList[2],l=s.propertyList[3];let c;r.indexOf("Lcl ")===0&&(r=r.replace("Lcl ","Lcl_")),o.indexOf("Lcl ")===0&&(o=o.replace("Lcl ","Lcl_")),o==="Color"||o==="ColorRGB"||o==="Vector"||o==="Vector3D"||o.indexOf("Lcl_")===0?c=[s.propertyList[4],s.propertyList[5],s.propertyList[6]]:c=s.propertyList[4],i[r]={type:o,type2:a,flag:l,value:c}}else i[s.name]===void 0?typeof s.id=="number"?(i[s.name]={},i[s.name][s.id]=s):i[s.name]=s:s.name==="PoseNode"?(Array.isArray(i[s.name])||(i[s.name]=[i[s.name]]),i[s.name].push(s)):i[s.name][s.id]===void 0&&(i[s.name][s.id]=s)}parseProperty(e){const i=e.getString(1);let s;switch(i){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return s=e.getUint32(),e.getArrayBuffer(s);case"S":return s=e.getUint32(),e.getString(s);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const r=e.getUint32(),o=e.getUint32(),a=e.getUint32();if(o===0)switch(i){case"b":case"c":return e.getBooleanArray(r);case"d":return e.getFloat64Array(r);case"f":return e.getFloat32Array(r);case"i":return e.getInt32Array(r);case"l":return e.getInt64Array(r)}const l=rA(new Uint8Array(e.getArrayBuffer(a))),c=new dj(l.buffer);switch(i){case"b":case"c":return c.getBooleanArray(r);case"d":return c.getFloat64Array(r);case"f":return c.getFloat32Array(r);case"i":return c.getInt32Array(r);case"l":return c.getInt64Array(r)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+i)}}}class dj{constructor(e,i){this.dv=new DataView(e),this.offset=0,this.littleEndian=i!==void 0?i:!0,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){const i=[];for(let s=0;s<e;s++)i.push(this.getBoolean());return i}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const i=[];for(let s=0;s<e;s++)i.push(this.getInt32());return i}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,i;return this.littleEndian?(e=this.getUint32(),i=this.getUint32()):(i=this.getUint32(),e=this.getUint32()),i&2147483648?(i=~i&4294967295,e=~e&4294967295,e===4294967295&&(i=i+1&4294967295),e=e+1&4294967295,-(i*4294967296+e)):i*4294967296+e}getInt64Array(e){const i=[];for(let s=0;s<e;s++)i.push(this.getInt64());return i}getUint64(){let e,i;return this.littleEndian?(e=this.getUint32(),i=this.getUint32()):(i=this.getUint32(),e=this.getUint32()),i*4294967296+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const i=[];for(let s=0;s<e;s++)i.push(this.getFloat32());return i}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const i=[];for(let s=0;s<e;s++)i.push(this.getFloat64());return i}getArrayBuffer(e){const i=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,i}getString(e){const i=this.offset;let s=new Uint8Array(this.dv.buffer,i,e);this.skip(e);const r=s.indexOf(0);return r>=0&&(s=new Uint8Array(this.dv.buffer,i,r)),this._textDecoder.decode(s)}}class pj{add(e,i){this[e]=i}}function Cge(n){const e="Kaydara FBX Binary  \0";return n.byteLength>=e.length&&e===yj(n,0,e.length)}function Mge(n){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let i=0;function s(r){const o=n[r-1];return n=n.slice(i+r),i++,o}for(let r=0;r<e.length;++r)if(s(1)===e[r])return!1;return!0}function mj(n){const e=/FBXVersion: (\d+)/,i=n.match(e);if(i)return parseInt(i[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function Ege(n){return n/46186158e3}const Tge=[];function zC(n,e,i,s){let r;switch(s.mappingType){case"ByPolygonVertex":r=n;break;case"ByPolygon":r=e;break;case"ByVertice":r=i;break;case"AllSame":r=s.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+s.mappingType)}s.referenceType==="IndexToDirect"&&(r=s.indices[r]);const o=r*s.dataSize,a=o+s.dataSize;return Ige(Tge,s.buffer,o,a)}const Dk=new si,y0=new E;function fj(n){const e=new he,i=new he,s=new he,r=new he,o=new he,a=new he,l=new he,c=new he,h=new he,u=new he,d=new he,m=new he,f=n.inheritType?n.inheritType:0;if(n.translation&&e.setPosition(y0.fromArray(n.translation)),n.preRotation){const C=n.preRotation.map(oi.degToRad);C.push(n.eulerOrder||si.DEFAULT_ORDER),i.makeRotationFromEuler(Dk.fromArray(C))}if(n.rotation){const C=n.rotation.map(oi.degToRad);C.push(n.eulerOrder||si.DEFAULT_ORDER),s.makeRotationFromEuler(Dk.fromArray(C))}if(n.postRotation){const C=n.postRotation.map(oi.degToRad);C.push(n.eulerOrder||si.DEFAULT_ORDER),r.makeRotationFromEuler(Dk.fromArray(C)),r.invert()}n.scale&&o.scale(y0.fromArray(n.scale)),n.scalingOffset&&l.setPosition(y0.fromArray(n.scalingOffset)),n.scalingPivot&&a.setPosition(y0.fromArray(n.scalingPivot)),n.rotationOffset&&c.setPosition(y0.fromArray(n.rotationOffset)),n.rotationPivot&&h.setPosition(y0.fromArray(n.rotationPivot)),n.parentMatrixWorld&&(d.copy(n.parentMatrix),u.copy(n.parentMatrixWorld));const g=i.clone().multiply(s).multiply(r),y=new he;y.extractRotation(u);const v=new he;v.copyPosition(u);const b=v.clone().invert().multiply(u),A=y.clone().invert().multiply(b),x=o,w=new he;if(f===0)w.copy(y).multiply(g).multiply(A).multiply(x);else if(f===1)w.copy(y).multiply(A).multiply(g).multiply(x);else{const C=new he().scale(new E().setFromMatrixScale(d)).clone().invert(),L=A.clone().multiply(C);w.copy(y).multiply(g).multiply(L).multiply(x)}const _=h.clone().invert(),S=a.clone().invert();let M=e.clone().multiply(c).multiply(h).multiply(i).multiply(s).multiply(r).multiply(_).multiply(l).multiply(a).multiply(o).multiply(S);const R=new he().copyPosition(M),P=u.clone().multiply(R);return m.copyPosition(P),M=m.clone().multiply(w),M.premultiply(u.invert()),M}function gj(n){n=n||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return n===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[n]}function Ok(n){return n.split(",").map(function(e){return parseFloat(e)})}function yj(n,e,i){return e===void 0&&(e=0),i===void 0&&(i=n.byteLength),new TextDecoder().decode(new Uint8Array(n,e,i))}function Rge(n,e){for(let i=0,s=n.length,r=e.length;i<r;i++,s++)n[s]=e[i]}function Ige(n,e,i,s){for(let r=i,o=0;r<s;r++,o++)n[o]=e[r];return n}const Lge=/^[og]\s*(.+)?/,Pge=/^mtllib /,Bge=/^usemtl /,kge=/^usemap /,vj=/\s+/,bj=new E,Gk=new E,Aj=new E,xj=new E,ja=new E,FC=new Ae;function Dge(){const n={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,i){if(this.object&&this.object.fromDeclaration===!1){this.object.name=e,this.object.fromDeclaration=i!==!1;return}const s=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:i!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(r,o){const a=this._finalize(!1);a&&(a.inherited||a.groupCount<=0)&&this.materials.splice(a.index,1);const l={index:this.materials.length,name:r||"",mtllib:Array.isArray(o)&&o.length>0?o[o.length-1]:"",smooth:a!==void 0?a.smooth:this.smooth,groupStart:a!==void 0?a.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(c){const h={index:typeof c=="number"?c:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return h.clone=this.clone.bind(h),h}};return this.materials.push(l),l},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(r){const o=this.currentMaterial();if(o&&o.groupEnd===-1&&(o.groupEnd=this.geometry.vertices.length/3,o.groupCount=o.groupEnd-o.groupStart,o.inherited=!1),r&&this.materials.length>1)for(let a=this.materials.length-1;a>=0;a--)this.materials[a].groupCount<=0&&this.materials.splice(a,1);return r&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),o}},s&&s.name&&typeof s.clone=="function"){const r=s.clone(0);r.inherited=!0,this.object.materials.push(r)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(e,i){const s=parseInt(e,10);return(s>=0?s-1:s+i/3)*3},parseNormalIndex:function(e,i){const s=parseInt(e,10);return(s>=0?s-1:s+i/3)*3},parseUVIndex:function(e,i){const s=parseInt(e,10);return(s>=0?s-1:s+i/2)*2},addVertex:function(e,i,s){const r=this.vertices,o=this.object.geometry.vertices;o.push(r[e+0],r[e+1],r[e+2]),o.push(r[i+0],r[i+1],r[i+2]),o.push(r[s+0],r[s+1],r[s+2])},addVertexPoint:function(e){const i=this.vertices;this.object.geometry.vertices.push(i[e+0],i[e+1],i[e+2])},addVertexLine:function(e){const i=this.vertices;this.object.geometry.vertices.push(i[e+0],i[e+1],i[e+2])},addNormal:function(e,i,s){const r=this.normals,o=this.object.geometry.normals;o.push(r[e+0],r[e+1],r[e+2]),o.push(r[i+0],r[i+1],r[i+2]),o.push(r[s+0],r[s+1],r[s+2])},addFaceNormal:function(e,i,s){const r=this.vertices,o=this.object.geometry.normals;bj.fromArray(r,e),Gk.fromArray(r,i),Aj.fromArray(r,s),ja.subVectors(Aj,Gk),xj.subVectors(bj,Gk),ja.cross(xj),ja.normalize(),o.push(ja.x,ja.y,ja.z),o.push(ja.x,ja.y,ja.z),o.push(ja.x,ja.y,ja.z)},addColor:function(e,i,s){const r=this.colors,o=this.object.geometry.colors;r[e]!==void 0&&o.push(r[e+0],r[e+1],r[e+2]),r[i]!==void 0&&o.push(r[i+0],r[i+1],r[i+2]),r[s]!==void 0&&o.push(r[s+0],r[s+1],r[s+2])},addUV:function(e,i,s){const r=this.uvs,o=this.object.geometry.uvs;o.push(r[e+0],r[e+1]),o.push(r[i+0],r[i+1]),o.push(r[s+0],r[s+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const i=this.uvs;this.object.geometry.uvs.push(i[e+0],i[e+1])},addFace:function(e,i,s,r,o,a,l,c,h){const u=this.vertices.length;let d=this.parseVertexIndex(e,u),m=this.parseVertexIndex(i,u),f=this.parseVertexIndex(s,u);if(this.addVertex(d,m,f),this.addColor(d,m,f),l!==void 0&&l!==""){const g=this.normals.length;d=this.parseNormalIndex(l,g),m=this.parseNormalIndex(c,g),f=this.parseNormalIndex(h,g),this.addNormal(d,m,f)}else this.addFaceNormal(d,m,f);if(r!==void 0&&r!==""){const g=this.uvs.length;d=this.parseUVIndex(r,g),m=this.parseUVIndex(o,g),f=this.parseUVIndex(a,g),this.addUV(d,m,f),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const i=this.vertices.length;for(let s=0,r=e.length;s<r;s++){const o=this.parseVertexIndex(e[s],i);this.addVertexPoint(o),this.addColor(o)}},addLineGeometry:function(e,i){this.object.geometry.type="Line";const s=this.vertices.length,r=this.uvs.length;for(let o=0,a=e.length;o<a;o++)this.addVertexLine(this.parseVertexIndex(e[o],s));for(let o=0,a=i.length;o<a;o++)this.addUVLine(this.parseUVIndex(i[o],r))}};return n.startObject("",!1),n}class zk extends es{constructor(e){super(e),this.materials=null}load(e,i,s,r){const o=this,a=new qs(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){try{i(o.parse(l))}catch(c){r?r(c):console.error(c),o.manager.itemError(e)}},s,r)}setMaterials(e){return this.materials=e,this}parse(e){const i=new Dge;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));const s=e.split(`
`);let r=[];for(let a=0,l=s.length;a<l;a++){const c=s[a].trimStart();if(c.length===0)continue;const h=c.charAt(0);if(h!=="#")if(h==="v"){const u=c.split(vj);switch(u[0]){case"v":i.vertices.push(parseFloat(u[1]),parseFloat(u[2]),parseFloat(u[3])),u.length>=7?(FC.setRGB(parseFloat(u[4]),parseFloat(u[5]),parseFloat(u[6])).convertSRGBToLinear(),i.colors.push(FC.r,FC.g,FC.b)):i.colors.push(void 0,void 0,void 0);break;case"vn":i.normals.push(parseFloat(u[1]),parseFloat(u[2]),parseFloat(u[3]));break;case"vt":i.uvs.push(parseFloat(u[1]),parseFloat(u[2]));break}}else if(h==="f"){const u=c.slice(1).trim().split(vj),d=[];for(let f=0,g=u.length;f<g;f++){const y=u[f];if(y.length>0){const v=y.split("/");d.push(v)}}const m=d[0];for(let f=1,g=d.length-1;f<g;f++){const y=d[f],v=d[f+1];i.addFace(m[0],y[0],v[0],m[1],y[1],v[1],m[2],y[2],v[2])}}else if(h==="l"){const u=c.substring(1).trim().split(" ");let d=[];const m=[];if(c.indexOf("/")===-1)d=u;else for(let f=0,g=u.length;f<g;f++){const y=u[f].split("/");y[0]!==""&&d.push(y[0]),y[1]!==""&&m.push(y[1])}i.addLineGeometry(d,m)}else if(h==="p"){const u=c.slice(1).trim().split(" ");i.addPointGeometry(u)}else if((r=Lge.exec(c))!==null){const u=(" "+r[0].slice(1).trim()).slice(1);i.startObject(u)}else if(Bge.test(c))i.object.startMaterial(c.substring(7).trim(),i.materialLibraries);else if(Pge.test(c))i.materialLibraries.push(c.substring(7).trim());else if(kge.test(c))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(h==="s"){if(r=c.split(" "),r.length>1){const d=r[1].trim().toLowerCase();i.object.smooth=d!=="0"&&d!=="off"}else i.object.smooth=!0;const u=i.object.currentMaterial();u&&(u.smooth=i.object.smooth)}else{if(c==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+c+'"')}}i.finalize();const o=new Vn;if(o.materialLibraries=[].concat(i.materialLibraries),!(i.objects.length===1&&i.objects[0].geometry.vertices.length===0))for(let a=0,l=i.objects.length;a<l;a++){const c=i.objects[a],h=c.geometry,u=c.materials,d=h.type==="Line",m=h.type==="Points";let f=!1;if(h.vertices.length===0)continue;const g=new dt;g.setAttribute("position",new st(h.vertices,3)),h.normals.length>0&&g.setAttribute("normal",new st(h.normals,3)),h.colors.length>0&&(f=!0,g.setAttribute("color",new st(h.colors,3))),h.hasUVIndices===!0&&g.setAttribute("uv",new st(h.uvs,2));const y=[];for(let b=0,A=u.length;b<A;b++){const x=u[b],w=x.name+"_"+x.smooth+"_"+f;let _=i.materials[w];if(this.materials!==null){if(_=this.materials.create(x.name),d&&_&&!(_ instanceof Vi)){const S=new Vi;Ft.prototype.copy.call(S,_),S.color.copy(_.color),_=S}else if(m&&_&&!(_ instanceof Ou)){const S=new Ou({size:10,sizeAttenuation:!1});Ft.prototype.copy.call(S,_),S.color.copy(_.color),S.map=_.map,_=S}}_===void 0&&(d?_=new Vi:m?_=new Ou({size:1,sizeAttenuation:!1}):_=new dg,_.name=x.name,_.flatShading=!x.smooth,_.vertexColors=f,i.materials[w]=_),y.push(_)}let v;if(y.length>1){for(let b=0,A=u.length;b<A;b++){const x=u[b];g.addGroup(x.groupStart,x.groupCount,b)}d?v=new Ir(g,y):m?v=new hg(g,y):v=new pe(g,y)}else d?v=new Ir(g,y[0]):m?v=new hg(g,y[0]):v=new pe(g,y[0]);v.name=c.name,o.add(v)}else if(i.vertices.length>0){const a=new Ou({size:1,sizeAttenuation:!1}),l=new dt;l.setAttribute("position",new st(i.vertices,3)),i.colors.length>0&&i.colors[0]!==void 0&&(l.setAttribute("color",new st(i.colors,3)),a.vertexColors=!0);const c=new hg(l,a);o.add(c)}return o}}typeof globalThis!==void 0&&!("OffscreenCanvas"in globalThis)&&(globalThis.OffscreenCanvas=class{constructor(n,e){return p(this,"canvas"),this.canvas=document.createElement("canvas"),this.canvas.width=n,this.canvas.height=e,this.canvas.convertToBlob=(i,s)=>new Promise(r=>{this.canvas.toBlob(r,i,s)}),this.canvas}});const Oge=te("debugprogress");function wj(n){n=n||new Date;const e=n.getMonth()+1,i=n.getDate(),s=n.getHours(),r=n.getMinutes(),o=n.getSeconds(),a=(e<10?"0":"")+e,l=(i<10?"0":"")+i,c=(s<10?"0":"")+s,h=(r<10?"0":"")+r,u=(o<10?"0":"")+o;return n.getFullYear()+a+l+"-"+c+h+u}class ai{static start(e,i){typeof i=="string"&&(i={parentScope:i});const s=new Gge(e,i);pA.set(e,s)}static report(e,i){const s=pA.get(e);if(!s){console.warn("Reporting progress for non-existing scope",e);return}typeof i=="string"&&(i={message:i,autoStep:!0}),s.report(i)}static end(e){const i=pA.get(e);i&&(i.end(),pA.delete(e))}}const pA=new Map;class Gge{constructor(e,i){p(this,"scopeLabel"),p(this,"parentScope"),p(this,"childScopes",[]),p(this,"parentDepth",0),p(this,"lastStep",0),p(this,"lastAutoStepWeight",1),p(this,"lastTotalSteps",0),p(this,"onProgress"),p(this,"showLogs",!1),p(this,"selfProgress",0),p(this,"totalProgress",0),p(this,"selfReports",0),p(this,"totalReports",0),this.parentScope=i!=null&&i.parentScope?pA.get(i.parentScope):void 0,this.parentScope&&(this.parentScope.childScopes.push(this),this.parentDepth=this.parentScope.parentDepth+1),this.scopeLabel=" ".repeat(this.parentDepth*2)+e,this.showLogs=i?.logTimings??!!Oge,this.showLogs&&console.time(this.scopeLabel),this.onProgress=i?.onProgress}report(e,i=!1){if(e){if(e.totalSteps!==void 0&&(this.lastTotalSteps=e.totalSteps),e.currentStep!==void 0&&(this.lastStep=e.currentStep),e.autoStep!==void 0){if(e.currentStep===void 0){this.lastStep===void 0&&(this.lastStep=0);const r=typeof e.autoStep=="number"?e.autoStep:1;this.lastStep+=this.lastAutoStepWeight,this.lastAutoStepWeight=r,e.currentStep=this.lastStep}e.totalSteps=this.lastTotalSteps}e.progress!==void 0?this.selfProgress=e.progress:e.currentStep!==void 0&&e.totalSteps!==void 0&&(this.selfProgress=e.currentStep/e.totalSteps)}if(this.childScopes.length>0){let r=0,o=0;for(const l of this.childScopes)r+=l.selfProgress,o+=1;o>0&&(r/=o);const a=this.lastAutoStepWeight/(this.lastTotalSteps??1);this.totalProgress=this.selfProgress+r*a}else this.totalProgress=this.selfProgress;this.selfProgress=Math.min(1,this.selfProgress),this.totalProgress=Math.min(1,this.totalProgress);let s=(this.totalProgress*100).toFixed(3)+"%";this.childScopes.length>0&&(s+=" ("+(this.selfProgress*100).toFixed(3)+"% self)"),e!=null&&e.message&&(s=e.message+" \u2013 "+s),this.lastStep!==void 0&&this.lastTotalSteps!==void 0&&(s="Step "+(this.lastStep+(this.lastAutoStepWeight!=1?"\u2013"+(this.lastStep+this.lastAutoStepWeight):"")+"/"+this.lastTotalSteps)+" "+s),i?this.totalReports++:(this.selfReports++,this.totalReports++),this.showLogs&&console.timeLog(this.scopeLabel,s),this.onProgress&&this.onProgress(this.totalProgress),this.parentScope&&this.parentScope.report(void 0,!0)}end(){this.report({progress:1,autoStep:!0},!0),this.showLogs&&(console.timeLog(this.scopeLabel,"Total reports: "+this.totalReports,"Self reports: "+this.selfReports),console.timeEnd(this.scopeLabel));let e=!1;for(const i of this.childScopes)if(!(i.selfProgress>=1)){e=!0;break}e&&console.warn("Progress end with child scopes that are still running",this),this.onProgress=void 0}}function zl(n){return n=n.replace(/[^a-zA-Z0-9_]/g,""),n.match(/^[a-zA-Z_]/)||(n="_"+n),n}function _j(n){if(n.length===0)return null;const e=n.map(i=>{const s=new Array;for(;i.parent;)s.unshift(i.parent),i=i.parent;return s});return e[0].findLast(i=>e.every(s=>s.includes(i)))||null}function Sj(n){const e=_j(n),i=new Set;for(const s of n){let r=s.parent;for(;r&&r!==e;)n.includes(r)||i.add(r),r=r.parent}return i}const zge=new E,Fge=new Se,Nge=new E(1,1,1),v0=class{constructor(n,e,i=null,s=null,r=null,o=null,a=null,l=null){p(this,"uuid"),p(this,"name"),p(this,"type"),p(this,"extraSchemas",[]),p(this,"displayName"),p(this,"visibility"),p(this,"transform",null),p(this,"_isDynamic"),p(this,"geometry"),p(this,"material"),p(this,"camera"),p(this,"parent"),p(this,"skinnedMesh"),p(this,"children",[]),p(this,"animations"),p(this,"_eventListeners"),p(this,"needsTranslate",!1),p(this,"needsOrient",!1),p(this,"needsScale",!1);var c,h,u;this.uuid=n,this.name=zl(e),this.displayName=e,i?this.transform={position:((c=i.position)==null?void 0:c.clone())||null,quaternion:((h=i.quaternion)==null?void 0:h.clone())||null,scale:((u=i.scale)==null?void 0:u.clone())||null}:this.transform=null,this.geometry=s,this.material=r,this.camera=o,this.parent=null,this.children=[],this._eventListeners={},this._isDynamic=!1,this.skinnedMesh=a,this.animations=l}getMatrix(){if(!this.transform)return new he;const{position:n,quaternion:e,scale:i}=this.transform,s=new he;return s.compose(n||zge,e||Fge,i||Nge),s}setMatrix(n){if(!n||!(n instanceof he)){this.transform=null;return}const e=new E,i=new Se,s=new E;n.decompose(e,i,s),this.transform={position:e,quaternion:i,scale:s}}get matrix(){return this.getMatrix()}set matrix(n){this.setMatrix(n)}get isDynamic(){return this._isDynamic}set isDynamic(n){this._isDynamic=n}static createEmptyParent(n){const e=new v0(oi.generateUUID(),n.name+"_empty_"+v0.USDObject_export_id++,n.transform),i=n.parent;return i&&i.add(e),e.add(n),e.isDynamic=!0,n.transform=null,e}static createEmpty(){const n=new v0(oi.generateUUID(),"Empty_"+v0.USDObject_export_id++);return n.isDynamic=!0,n}is(n){return n?this.uuid===n.uuid:!1}isEmpty(){return!this.geometry}clone(){const n=new v0(oi.generateUUID(),this.name,this.transform,this.geometry,this.material);return n.isDynamic=this.isDynamic,n}deepClone(){const n=this.clone();for(const e of this.children)e&&n.add(e.deepClone());return n}getPath(){let n=this.parent,e=this.name;for(;n;)e=(n.parent?n.name:n.name+"/Scenes/Scene")+"/"+e,n=n.parent;return"</"+e+">"}add(n){n.parent&&n.parent.remove(n),n.parent=this,this.children.push(n)}remove(n){const e=this.children.indexOf(n);e>=0&&(n.parent===this&&(n.parent=null),this.children.splice(e,1))}addEventListener(n,e){this._eventListeners[n]||(this._eventListeners[n]=[]),this._eventListeners[n].push(e)}removeEventListener(n,e){if(!this._eventListeners[n])return;const i=this._eventListeners[n].indexOf(e);i>=0&&this._eventListeners[n].splice(i,1)}onSerialize(n,e){const i=this._eventListeners.serialize;i&&i.forEach(s=>s(n,e))}};let po=v0;p(po,"USDObject_export_id",0);class Cj extends po{constructor(){super(void 0,"StageRoot",null,null,null,null),p(this,"stageLength"),this.children=[],this.stageLength=200}get isDocumentRoot(){return!0}get isDynamic(){return!1}add(e){e.parent=this,this.children.push(e)}remove(e){const i=this.children.indexOf(e);i>=0&&(e.parent===this&&(e.parent=null),this.children.splice(i,1))}traverse(e,i=null){if(i!==null?e(i):i=this,i.children)for(const s of i.children)this.traverse(e,s)}findById(e){let i=!1;function s(r){if(!i){if(r.uuid===e)return i=!0,r;if(r.children)for(const o of r.children){if(!o)continue;const a=s(o);if(a)return a}}}return s(this)}buildHeader(e){var i,s;const r=(i=e.extensions)==null?void 0:i.find(c=>c?.extensionName==="animation"),o=(s=e.extensions)==null?void 0:s.find(c=>c?.extensionName==="Behaviour"),a=r?.getStartTimeCode()??0,l=r?.getEndTimeCode()??0;return`#usda 1.0
(
	customLayerData = {
		string creator = "Needle Engine ${xl}"
		dictionary Needle = {
			bool animations = ${r?1:0}
			bool interactive = ${o?1:0}
			bool quickLookCompatible = ${e.quickLookCompatible?1:0}
		}
	}
	defaultPrim = "${zl(this.name)}"
	metersPerUnit = 1
	upAxis = "Y"
	startTimeCode = ${a}
	endTimeCode = ${l}
	timeCodesPerSecond = 60
	framesPerSecond = 60
	doc = """Generated by Needle Engine USDZ Exporter ${xl}"""
)
`}}const b0=`
`,Bo="</StageRoot/Materials";class Mj{constructor(){p(this,"str"),p(this,"indent"),this.str="",this.indent=0}clear(){this.str="",this.indent=0}beginBlock(e=void 0,i="{",s=!0){e!==void 0?(e=this.applyIndent(e),this.str+=e,s?(this.str+=b0,this.str+=this.applyIndent(i)):this.str+=" "+i):this.str+=this.applyIndent(i),this.str+=b0,this.indent+=1}closeBlock(e="}"){this.indent-=1,this.str+=this.applyIndent(e)+b0}beginArray(e){e=this.applyIndent(e+" = ["),this.str+=e,this.str+=b0,this.indent+=1}closeArray(){this.indent-=1,this.str+=this.applyIndent("]")+b0}appendLine(e=""){e=this.applyIndent(e),this.str+=e,this.str+=b0}toString(){return this.str}applyIndent(e){let i="";for(let s=0;s<this.indent;s++)i+="	";return i+e}}class Uge{constructor(e,i,s){p(this,"root"),p(this,"exporter"),p(this,"extensions",[]),p(this,"quickLookCompatible"),p(this,"exportInvisible"),p(this,"materials"),p(this,"textures"),p(this,"files"),p(this,"document"),p(this,"output"),p(this,"animations"),this.root=e,this.exporter=i,this.quickLookCompatible=s.quickLookCompatible,this.exportInvisible=s.exportInvisible,s.extensions&&(this.extensions=s.extensions),this.materials=new Map,this.textures={},this.files={},this.document=new Cj,this.output="",this.animations=[]}}class Fk{constructor(){p(this,"ar",{anchoring:{type:"plane"},planeAnchoring:{alignment:"horizontal"}}),p(this,"quickLookCompatible",!1),p(this,"extensions",[]),p(this,"maxTextureSize",4096),p(this,"exportInvisible",!1)}}let Ej=class{constructor(){p(this,"debug"),p(this,"pruneUnusedNodes"),p(this,"sceneAnchoringOptions",new Fk),p(this,"extensions",[]),p(this,"keepObject"),this.debug=!1,this.pruneUnusedNodes=!0}async parse(n,e=new Fk){e=Object.assign(new Fk,e),this.sceneAnchoringOptions=e;const i=new Uge(n,this,e);this.extensions=i.extensions;const s=i.files,r="model.usda";s[r]=null;const o=i.materials,a=i.textures;ai.report("export-usdz","Invoking onBeforeBuildDocument"),await NC(i,"onBeforeBuildDocument"),ai.report("export-usdz","Done onBeforeBuildDocument"),ai.report("export-usdz","Reparent bones to common ancestor");const l=[],c=new Set;n?.traverse(v=>{if(!(!e.exportInvisible&&!v.visible)&&v instanceof Eo){const b=v.skeleton.bones,A=_j(b);if(A){const x={object:v,originalParent:v.parent,newParent:A};l.push(x),c.add(x.object.uuid),x.newParent&&c.add(x.newParent.uuid),x.originalParent&&c.add(x.originalParent.uuid)}}});for(const v of l){const{object:b,originalParent:A,newParent:x}=v;x.add(b)}ai.report("export-usdz","Traversing hierarchy"),n&&Tj(n,i.document,i,this.keepObject),ai.report("export-usdz","Invoking onAfterBuildDocument"),await NC(i,"onAfterBuildDocument");const h=i.extensions.find(v=>v.extensionName==="Behaviour"),u=h?.getAllTargetUuids()??new Set;if(this.pruneUnusedNodes){const v={allBehaviorTargets:u,debug:!1,boneReparentings:c,quickLookCompatible:i.quickLookCompatible};this.debug&&Rj(i.document,"Hierarchy BEFORE pruning",v),Ij(i.document,v),this.debug&&Rj(i.document,"Hierarchy AFTER pruning")}else this.debug&&console.log("Pruning of empty nodes is disabled. This may result in a larger USDZ file.");ai.report("export-usdz",{message:"Parsing document",autoStep:10}),await Vge(i,()=>(ai.report("export-usdz","Building materials"),Jge(o,a,e.quickLookCompatible))),ai.report("export-usdz","Invoking onAfterSerialize"),await NC(i,"onAfterSerialize");for(const v of l){const{object:b,originalParent:A,newParent:x}=v;A&&A.add(b)}const d=i.document.buildHeader(i)+`
`+i.output;this.debug&&console.log(d),s[r]=wC(d),i.output="",ai.report("export-usdz",{message:"Exporting textures",autoStep:10}),ai.start("export-usdz-textures","export-usdz");const m=new gh({antialias:!1,alpha:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!0}),f=Object.keys(a).length;ai.report("export-usdz-textures",{totalSteps:f*3,currentStep:0});const g=async v=>{const b=a[v],A=b.texture,x=Nj.includes(A.format);let w={imageData:A.image};ai.report("export-usdz-textures",{message:"read back texture",autoStep:!0});const _=b.scale!==void 0&&b.scale.x!==1&&b.scale.y!==1&&b.scale.z!==1&&b.scale.w!==1;(A.isCompressedTexture||A.isRenderTargetTexture||_)&&(w=await Xge(A,e.maxTextureSize,m,b.scale)),ai.report("export-usdz-textures",{message:"convert texture to canvas",autoStep:!0});const S=await Hge(w.imageBitmap||w.imageData,e.maxTextureSize).catch(M=>{console.error("Error converting texture to canvas",A,M)});if(S){ai.report("export-usdz-textures",{message:"convert canvas to blob",autoStep:!0});const M=await S.convertToBlob({type:x?"image/png":"image/jpeg",quality:.95});s[`textures/${v}.${x?"png":"jpg"}`]=new Uint8Array(await M.arrayBuffer())}else console.warn("Can`t export texture: ",A)};for(const v in a)await g(v);m.dispose(),ai.end("export-usdz-textures");let y=0;for(const v in s){const b=s[v],A=34+v.length;y+=A;const x=y&63;if(x!==4){const w=64-x,_=new Uint8Array(w);s[v]=[b,{extra:{12345:_}}]}y=b.length}return ai.report("export-usdz","zip archive"),Pfe(s,{level:0})}};function Tj(n,e,i,s){if(!i.exportInvisible&&!n.visible)return;let r,o,a;const l={position:n.position,quaternion:n.quaternion,scale:n.scale};if(n.position.x===0&&n.position.y===0&&n.position.z===0&&(l.position=null),n.quaternion.x===0&&n.quaternion.y===0&&n.quaternion.z===0&&n.quaternion.w===1&&(l.quaternion=null),n.scale.x===1&&n.scale.y===1&&n.scale.z===1&&(l.scale=null),(n instanceof pe||n instanceof Eo)&&(o=n.geometry,a=n.material),s&&!s(n)&&(o=void 0,a=void 0),(n instanceof pe||n instanceof Eo)&&a&&(a instanceof vs||a instanceof Qt||a instanceof Ft&&a.type==="MeshLineMaterial")){const c=XC(n),h=n instanceof Eo?n:null;r=new po(n.uuid,c,l,o,a,void 0,h,n.animations)}else if(n instanceof Lt||n instanceof ic){const c=XC(n);r=new po(n.uuid,c,l,void 0,void 0,n)}else{const c=XC(n);r=new po(n.uuid,c,l,void 0,void 0,void 0,void 0,n.animations)}if(r){if(r.displayName=n.name,r.visibility=n.visible?void 0:"invisible",e&&e.add(r),e=r,i.extensions)for(const c of i.extensions)c.onExportObject&&c.onExportObject.call(c,n,r,i)}else{const c=XC(n),h=new po(n.uuid,c,{position:n.position,quaternion:n.quaternion,scale:n.scale});e&&e.add(h),e=h}for(const c of n.children)Tj(c,e,i,s)}function Rj(n,e,...i){const s={};let r=0;function o(a,l){r++;let c=a.displayName||a.name;c+=" ("+a.uuid+")",(a.geometry||a.material||a.camera||a.skinnedMesh)&&(c+=" ("+(a.geometry?"geo, ":"")+(a.material?"mat, ":"")+(a.camera?"cam, ":"")+(a.skinnedMesh?"skin, ":"")+")"),l[c]={};const h={object:a};a.material&&(h.mat=!0),a.geometry&&(h.geo=!0),a.camera&&(h.cam=!0),a.skinnedMesh&&(h.skin=!0),l[c]._self=h;for(const u of a.children)u&&o(u,l[c])}o(n,s),console.log(e+" ("+r+" nodes)",s,...i)}function Ij(n,e){var i;let s=!0;const r=new Array,o=new Array;if(n.children.length===0)s=!0;else{const u=[...n.children];for(const d of u)if(d){const m=Ij(d,e);e.debug&&(m?r.push(d):o.push(d)),s=s&&m}}const a=e.allBehaviorTargets.has(n.uuid),l=n.geometry||n.material||n.camera&&!e.quickLookCompatible||n.skinnedMesh||!1,c=e.boneReparentings.has(n.uuid),h=s&&!a&&!l&&!c;return h?(e.debug&&console.log("Pruned object:",(n.displayName||n.name)+" ("+n.uuid+")",{isVisible:l,isBehaviorSourceOrTarget:a,allChildsWerePruned:s,isBoneReparenting:c,object:n,prunedChilds:r,keptChilds:o}),(i=n.parent)==null||i.remove(n)):e.debug&&console.log("Kept object:",(n.displayName||n.name)+" ("+n.uuid+")",{isVisible:l,isBehaviorSourceOrTarget:a,allChildsWerePruned:s,isBoneReparenting:c,object:n,prunedChilds:r,keptChilds:o}),h}async function Vge(n,e){ai.start("export-usdz-resources","export-usdz");const i=[];for(const c of n.document.children)Lj(c,n,i);const s=i.length;for(let c=0;c<s;c++)ai.report("export-usdz-resources",{totalSteps:s,currentStep:c}),await new Promise((h,u)=>{i[c](),h()});ai.end("export-usdz-resources");const r=new Mj,o=n.exporter.sceneAnchoringOptions.ar;r.beginBlock(`def Xform "${n.document.name}"`),r.beginBlock(`def Scope "Scenes" (
		kind = "sceneLibrary"
	)`),r.beginBlock('def Xform "Scene"',"(",!1),r.appendLine('apiSchemas = ["Preliminary_AnchoringAPI"]'),r.appendLine("customData = {"),r.appendLine("	bool preliminary_collidesWithEnvironment = 0"),r.appendLine('	string sceneName = "Scene"'),r.appendLine("}"),r.appendLine('sceneName = "Scene"'),r.closeBlock(")"),r.beginBlock(),r.appendLine(`token preliminary:anchoring:type = "${o.anchoring.type}"`),o.anchoring.type==="plane"&&r.appendLine(`token preliminary:planeAnchoring:alignment = "${o.planeAnchoring.alignment}"`),o.anchoring.type==="image"&&r.appendLine(`rel preliminary:imageAnchoring:referenceImage = </${n.document.name}/Scenes/Scene/AnchoringReferenceImage>`),r.appendLine();const a=c=>{if(!c)return 0;let h=1;for(const u of c.children)h+=a(u);return h},l=a(n.document);ai.start("export-usdz-xforms","export-usdz"),ai.report("export-usdz-xforms",{totalSteps:l,currentStep:1});for(const c of n.document.children)kj(c,r,n);ai.end("export-usdz-xforms"),ai.report("export-usdz","invoke onAfterHierarchy"),NC(n,"onAfterHierarchy",r),r.closeBlock(),r.closeBlock(),r.appendLine(e()),r.closeBlock(),ai.report("export-usdz","write to string"),n.output+=r.toString()}function Lj(n,e,i){if(!n)return;const s=n.geometry,r=n.material;if(s)if(r&&("isMeshStandardMaterial"in r&&r.isMeshStandardMaterial||"isMeshBasicMaterial"in r&&r.isMeshBasicMaterial||r.type==="MeshLineMaterial")){const o="geometries/"+Uk(s,n.name)+".usda";if(!(o in e.files)){const a=()=>{var l,c;const h=Zge(s,(c=(l=n.skinnedMesh)==null?void 0:l.skeleton)==null?void 0:c.bones,e.quickLookCompatible);e.files[o]=Qge(h)};i.push(a)}}else console.warn("NeedleUSDZExporter: Unsupported material type (USDZ only supports MeshStandardMaterial)",r?.name);r&&(r.uuid in e.materials||(e.materials[r.uuid]=r));for(const o of n.children)Lj(o,e,i)}async function NC(n,e,i=null){if(n.extensions){for(const s of n.extensions)if(s&&typeof s[e]=="function"){const r=s[e].call(s,n,i);r instanceof Promise&&await r}}}let UC=null,mo=null,Nk,A0,VC;async function Xge(n,e=1/0,i=null,s=void 0){Nk||(Nk=new ds(2,2,1,1)),A0||(A0=new kt({uniforms:{blitTexture:new Ce(n),flipY:new Ce(!1),scale:new Ce(new Ze(1,1,1,1))},vertexShader:`
            varying vec2 vUv;
			uniform bool flipY;
            void main(){
                vUv = uv;
				if (flipY)
					vUv.y = 1. - vUv.y;
                gl_Position = vec4(position.xy * 1.0,0.,.999999);
            }`,fragmentShader:`
            uniform sampler2D blitTexture;
			uniform vec4 scale; 
            varying vec2 vUv;

            void main(){ 
                gl_FragColor = vec4(vUv.xy, 0, 1);
                
                #ifdef IS_SRGB
                gl_FragColor = LinearTosRGB( texture2D( blitTexture, vUv) );
                #else
                gl_FragColor = texture2D( blitTexture, vUv);
                #endif
				
				gl_FragColor.rgba *= scale.rgba;
            }`}));const r=A0.uniforms;r.blitTexture.value=n,r.flipY.value=!1,r.scale.value=new Ze(1,1,1,1),s!==void 0&&r.scale.value.copy(s),A0.defines.IS_SRGB=n.colorSpace==vt,A0.needsUpdate=!0,VC||(VC=new pe(Nk,A0),VC.frustumCulled=!1);const o=new Lt,a=new Ls;a.add(VC),i||(i=UC=new gh({antialias:!1,alpha:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!0}));const l=Math.min(n.image.width,e),c=Math.min(n.image.height,e);mo&&(mo.width!==l||mo.height!==c)&&(mo.dispose(),mo=null),mo||(mo=new Zt(l,c,{format:_i,type:pn,minFilter:Ot,magFilter:Ot})),i.setRenderTarget(mo),i.setSize(l,c),i.clear(),i.render(a,o),UC&&(UC.dispose(),UC=null);const h=new Uint8ClampedArray(mo.width*mo.height*4);i.readRenderTargetPixels(mo,0,0,mo.width,mo.height,h);const u=new ImageData(h,mo.width,mo.height,void 0),d=await createImageBitmap(u,{premultiplyAlpha:"none"});return{imageData:u,imageBitmap:d}}function Wge(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas||typeof ImageBitmap<"u"&&n instanceof ImageBitmap}async function Hge(n,e=4096){const i=e/Math.max(n.width,n.height),s=n.width*Math.min(1,i),r=n.height*Math.min(1,i),o=new OffscreenCanvas(s,r),a={premultiplyAlpha:"none"};n.width!==s&&(a.resizeWidth=s),n.height!==r&&(a.resizeHeight=r);const l=await createImageBitmap(n,a),c=o.getContext("bitmaprenderer");return c&&c.transferFromImageBitmap(l),o}async function Pj(n,e=void 0,i=!1,s=4096){if(Wge(n)){const r=s/Math.max(n.width,n.height),o=new OffscreenCanvas(n.width*Math.min(1,r),n.height*Math.min(1,r)),a=o.getContext("2d",{alpha:!0,premultipliedAlpha:!1});if(!a)throw new Error("Could not get canvas 2D context");if(i===!0&&(a.translate(0,o.height),a.scale(1,-1)),a.drawImage(n,0,0,o.width,o.height),e!==void 0){const l=e.x,c=e.y,h=e.z,u=e.w,d=a.getImageData(0,0,o.width,o.height),m=d.data;for(let f=0;f<m.length;f+=4)m[f+0]=m[f+0]*l,m[f+1]=m[f+1]*c,m[f+2]=m[f+2]*h,m[f+3]=m[f+3]*u;a.putImageData(d,0,0)}return o}else throw new Error("NeedleUSDZExporter: No valid image data found. Unable to process texture.")}const an=7;function jge(){return`#usda 1.0
(
    customLayerData = {
        string creator = "Needle Engine USDZExporter"
    }
    metersPerUnit = 1
    upAxis = "Y"
)
`}function Qge(n,e){let i=jge();return i+=n,wC(i)}function XC(n){return n.name.replace(/[-<>\(\)\[\]$%&\/\\\=\?\,\;]/g,"")+"_"+n.id}function Bj(n){return zl(n.name||"bone_"+n.uuid)}function Uk(n,e){return zl(n.name||"Geometry")+"_"+n.id}function Vk(n){return zl(n.name||"Material")+"_"+n.id}function x0(n,e){let i=Bj(n),s=n.parent;for(;s&&s!==e;)i=Bj(s)+"/"+i,s=s.parent;return i}function kj(n,e,i){var s;if(n==null)return;ai.report("export-usdz-xforms",{message:"buildXform "+n.displayName||n.name,autoStep:!0});const r=n.transform,o=n.geometry,a=n.material,l=n.camera,c=n.name;if(n.animations)for(const g of n.animations)i.animations.push(g);const h=o&&o.isBufferGeometry&&o.attributes.skinIndex!==void 0&&o.attributes.skinIndex.count>0,u=h?"SkelRoot":"Xform",d=new Array,m=a&&a instanceof Qt&&a.color&&a.color.r===1&&a.color.g===1&&a.color.b===1&&!a.map&&a.opacity===1&&o?.attributes.color;if(o!=null&&o.attributes.color&&!m&&console.warn("NeedleUSDZExporter: Geometry has vertex colors. Vertex colors will only be shown in QuickLook for unlit materials with white color and no texture. Otherwise, they will be ignored.",n.displayName),e.appendLine(),o?(e.beginBlock(`def ${u} "${c}"`,"(",!1),i.quickLookCompatible&&a&&a.side===xi&&!h?e.appendLine(`prepend references = @./geometries/${Uk(o)}.usda@</Geometry_doubleSided>`):e.appendLine(`prepend references = @./geometries/${Uk(o)}.usda@</Geometry>`),m||d.push("MaterialBindingAPI"),h&&d.push("SkelBindingAPI")):l&&!i.quickLookCompatible?e.beginBlock(`def Camera "${c}"`,"(",!1):n.type!==void 0?e.beginBlock(`def ${n.type} "${c}"`):e.beginBlock(`def Xform "${c}"`,"(",!1),n.type===void 0&&((s=n.extraSchemas)!=null&&s.length&&d.push(...n.extraSchemas),d.length&&e.appendLine(`prepend apiSchemas = [${d.map(g=>`"${g}"`).join(", ")}]`)),n.displayName&&e.appendLine(`displayName = "${n.displayName}"`),(l||n.type===void 0)&&(e.closeBlock(")"),e.beginBlock()),o&&a){if(!m){const g=Vk(a);e.appendLine(`rel material:binding = </StageRoot/Materials/${g}>`)}!i.quickLookCompatible&&a.side===xi&&(e.beginBlock('over "Geometry" '),e.appendLine("uniform bool doubleSided = 1"),e.closeBlock())}let f=!1;if(h?(e.appendLine("rel skel:skeleton = <Rig>"),e.appendLine("rel skel:animationSource = <Rig/_anim>"),f=!1):n.type===void 0&&r&&(f=f||r.position!==null||r.quaternion!==null||r.scale!==null,r.position&&(n.needsTranslate=!0,e.appendLine(`double3 xformOp:translate = (${li(r.position.x)}, ${li(r.position.y)}, ${li(r.position.z)})`)),r.quaternion&&(n.needsOrient=!0,e.appendLine(`quatf xformOp:orient = (${li(r.quaternion.w)}, ${li(r.quaternion.x)}, ${li(r.quaternion.y)}, ${li(r.quaternion.z)})`)),r.scale&&(n.needsScale=!0,e.appendLine(`double3 xformOp:scale = (${li(r.scale.x)}, ${li(r.scale.y)}, ${li(r.scale.z)})`))),n.visibility!==void 0&&e.appendLine(`token visibility = "${n.visibility}"`),l&&!i.quickLookCompatible&&("isOrthographicCamera"in l&&l.isOrthographicCamera?(e.appendLine(`float2 clippingRange = (${l.near}, ${l.far})`),e.appendLine(`float horizontalAperture = ${((Math.abs(l.left)+Math.abs(l.right))*10).toPrecision(an)}`),e.appendLine(`float verticalAperture = ${((Math.abs(l.top)+Math.abs(l.bottom))*10).toPrecision(an)}`),e.appendLine('token projection = "orthographic"')):"isPerspectiveCamera"in l&&l.isPerspectiveCamera&&(e.appendLine(`float2 clippingRange = (${l.near.toPrecision(an)}, ${l.far.toPrecision(an)})`),e.appendLine(`float focalLength = ${l.getFocalLength().toPrecision(an)}`),e.appendLine(`float focusDistance = ${l.focus.toPrecision(an)}`),e.appendLine(`float horizontalAperture = ${l.getFilmWidth().toPrecision(an)}`),e.appendLine('token projection = "perspective"'),e.appendLine(`float verticalAperture = ${l.getFilmHeight().toPrecision(an)}`))),n.onSerialize&&n.onSerialize(e,i),n.type===void 0){const g=new Array;n.needsTranslate&&g.push('"xformOp:translate"'),n.needsOrient&&g.push('"xformOp:orient"'),n.needsScale&&g.push('"xformOp:scale"'),g.length&&e.appendLine(`uniform token[] xformOpOrder = [${g.join(", ")}]`)}if(n.children){e.appendLine();for(const g of n.children)kj(g,e,i)}e.closeBlock()}function li(n){return Number.isInteger(n)?n.toString():n.toFixed(10)}function Dj(n){const e=n.elements;return`( ${WC(e,0)}, ${WC(e,4)}, ${WC(e,8)}, ${WC(e,12)} )`}function WC(n,e){return`(${li(n[e+0])}, ${li(n[e+1])}, ${li(n[e+2])}, ${li(n[e+3])})`}function Zge(n,e=[],i=!0){return`
def "Geometry"
${Yge(n,e,i)}
`}function Yge(n,e=[],i=!0){const s="Geometry",r=n.attributes,o=r.position.count,a=e&&e.length>0,l=[],c=[];let h=new Array,u=r.skinIndex;if(a){const m=[];for(const y of e)y.parent.type!=="Bone"&&(l.push({bone:y,index:e.indexOf(y)}),m.push(y.uuid));for(;m.length<e.length;)for(const y of l){const v=y.bone.children;for(const b of v)m.indexOf(b.uuid)===-1&&e.indexOf(b)!==-1&&(l.push({bone:b,index:e.indexOf(b)}),m.push(b.uuid))}for(const y of Sj(e))l.push({bone:y,index:l.length});const f=l[0].bone.parent;l.sort((y,v)=>x0(y.bone,f)>x0(v.bone,f)?1:-1),l.map(y=>'"'+x0(y.bone,f)+'"').join(", ");for(const y in l)c[l[y].index]=parseInt(y);const g=r.skinIndex;h=new Array;for(let y=0;y<g.count;y++){const v=g.getX(y),b=g.getY(y),A=g.getZ(y),x=g.getW(y);h.push(c[v],c[b],c[A],c[x])}u=new qe(new Uint16Array(h),4)}const d=r.skinWeight&&r.skinIndex;return`
{	
    def Mesh "${s}" ${d?`(
        prepend apiSchemas = ["SkelBindingAPI"]
    )`:""}
    {
        int[] faceVertexCounts = [${Xk(n)}]
        int[] faceVertexIndices = [${Wk(n)}]
		${r.normal||i?`normal3f[] normals = [${HC(r.normal,o)}] (
            interpolation = "vertex"
        )`:""}
        point3f[] points = [${HC(r.position,o)}]
        ${r.uv?`texCoord2f[] primvars:st = [${Gj(r.uv,o,!0)}] (
            interpolation = "vertex"
        )`:""}
		${r.uv1?Hk("st1",r.uv1):""}
		${r.uv2?Hk("st2",r.uv2):""}
		${r.uv3?Hk("st3",r.uv3):""}
		${d?`matrix4d primvars:skel:geomBindTransform = ( (1, 0, 0, 0), (0, 1, 0, 0), (0, 0, 1, 0), (0, 0, 0, 1) ) (
				elementSize = 1
				interpolation = "constant"
			)`:""}
		${r.skinIndex?`int[] primvars:skel:jointIndices = [${Oj(u,!0)}] (
			elementSize = 4
			interpolation = "vertex"
		)`:""}
		${r.skinWeight?`float[] primvars:skel:jointWeights = [${Oj(r.skinWeight)}] (
			elementSize = 4
			interpolation = "vertex"
		)`:""}
		${r.color?`color3f[] primvars:displayColor = [${HC(r.color,o)}] (
			interpolation = "vertex"
		)`:""}
        uniform token subdivisionScheme = "none"
    }
}
${i?`
# This is a workaround for QuickLook/RealityKit not supporting the doubleSided attribute. We're adding a second
# geometry definition here, that uses the same mesh data but appends extra faces with reversed winding order.
def "${s}_doubleSided" (
	prepend references = </Geometry>
)
{
	over "Geometry"
	{
		int[] faceVertexCounts = [${Xk(n)+", "+Xk(n)}]
		int[] faceVertexIndices = [${Wk(n)+", "+Wk(n,!0)}]
	}
}
`:""}
`}function Xk(n){const e=n.index!==null?n.index.count:n.attributes.position.count;return Array(Math.floor(e/3)).fill(3).join(", ")}function Wk(n,e=!1){const i=n.index,s=[];if(i!==null)for(let r=0;r<i.count;r++){let o=r;e&&(o=r%3===0?r+2:r%3===2?r-2:r),s.push(i.getX(o))}else{const r=n.attributes.position.count;for(let o=0;o<r;o++){let a=o;e&&(a=o%3===0?o+2:o%3===2?o-2:o),s.push(a)}}return s.join(", ")}function Hk(n,e){const i=e.itemSize;switch(i){case 2:return`texCoord2f[] primvars:${n} = [${Gj(e,i,!0)}] (
				interpolation = "vertex"
			)`;case 3:return`texCoord3f[] primvars:${n} = [${HC(e,i)}] (
				interpolation = "vertex"
			)`;case 4:return`double4[] primvars:${n} = [${Kge(e,i)}] (
				interpolation = "vertex"
			)`;default:return console.warn("USDZExporter: Attribute with "+i+" components are currently not supported. Results may be undefined for "+n+"."),""}}function HC(n,e){if(n===void 0)return console.warn("USDZExporter: Attribute is missing. Results may be undefined."),Array(e).fill("(0, 0, 1)").join(", ");const i=[];for(let s=0;s<n.count;s++){const r=n.getX(s),o=n.getY(s),a=n.getZ(s);i.push(`(${r.toPrecision(an)}, ${o.toPrecision(an)}, ${a.toPrecision(an)})`)}return i.join(", ")}function Kge(n,e){if(n===void 0)return console.warn("USDZExporter: Attribute is missing. Results may be undefined."),Array(e).fill("(0, 0, 0, 0)").join(", ");const i=[];for(let s=0;s<n.count;s++){const r=n.getX(s),o=n.getY(s),a=n.getZ(s)||0,l=n.getW(s)||0;i.push(`(${r.toPrecision(an)}, ${o.toPrecision(an)}, ${a.toPrecision(an)}, ${l.toPrecision(an)})`)}return i.join(", ")}function Oj(n,e=!1){const i=[];for(let s=0;s<n.count;s++){const r=n.getX(s),o=n.getY(s),a=n.getZ(s),l=n.getW(s);i.push(`${e?r:r.toPrecision(an)}`),i.push(`${e?o:o.toPrecision(an)}`),i.push(`${e?a:a.toPrecision(an)}`),i.push(`${e?l:l.toPrecision(an)}`)}return i.join(", ")}function Gj(n,e,i=!1){if(n===void 0)return console.warn("USDZExporter: UVs missing."),Array(e).fill("(0, 0)").join(", ");const s=[];for(let r=0;r<n.count;r++){const o=n.getX(r);let a=n.getY(r);i&&(a=1-a),s.push(`(${o.toPrecision(an)}, ${a.toPrecision(an)})`)}return s.join(", ")}function Jge(n,e,i=!1){const s=[];for(const r in n){const o=n[r];s.push(qge(o,e,i))}return`
	def "Materials"
    {
${s.join("")}
    }`}function qge(n,e,i=!1){var s;const r="                ",o=[],a=[],l=Vk(n),c=new Set;function h(g){var y;return zl(g.name)+"_"+(((y=g.source)==null?void 0:y.id)??g.id)}function u(g,y,v=void 0,b=void 0){const A=h(g),x=A+(b!==void 0&&b!==1?"_"+b:""),w=i&&b!==void 0&&b!==1,_=w?new Ze(1,1,1,b):void 0;b===void 0&&(b=1),w&&(b=1),_&&_.w<=.05&&(_.w=.05),e[x]={texture:g,scale:_};const S=g.channel>0?"st"+g.channel:"st";c.add(g.channel);const M=Nj.includes(g.format),R={1e3:"repeat",1001:"clamp",1002:"mirror"},P=g.repeat.clone(),C=g.offset.clone(),L=g.rotation,B=Math.sin(L),z=Math.cos(L);C.y=1-C.y-P.y,i?(P.x===0&&(P.x=1e-4),P.y===0&&(P.y=1e-4),C.x=C.x/P.x,C.y=C.y/P.y,C.x+=B/P.x,C.y+=z-1):(C.x+=B*P.x,C.y+=(1-z)*P.y);const D=P.x!=1||P.y!=1||C.x!=0||C.y!=0||L!=0,W=`${Bo}/${l}/${"uvReader_"+S}.outputs:result>`,O=`${Bo}/${l}/Transform2d_${y}.outputs:result>`,F=y!=="normal"&&v&&(v.r!==1||v.g!==1||v.b!==1||b!==1)||!1,X=y==="normal",J=n instanceof vs&&n.normalScale?n.normalScale.x*2:2,q=J.toFixed(an),oe=(-1*(J/2)).toFixed(an),_e=(1-J).toFixed(an);return`
			${D?`def Shader "Transform2d_${y}" (
				sdrMetadata = {
					string role = "math"
				}
			)
			{
				uniform token info:id = "UsdTransform2d"
				float2 inputs:in.connect = ${W}
				float2 inputs:scale = ${Fj(P)}
				float2 inputs:translation = ${Fj(C)}
				float inputs:rotation = ${(L/Math.PI*180).toFixed(an)}
				float2 outputs:result
			}
			`:""}
			def Shader "${A}_${y}"
			{
				uniform token info:id = "UsdUVTexture"
				asset inputs:file = @textures/${x}.${M?"png":"jpg"}@
				token inputs:sourceColorSpace = "${g.colorSpace==="srgb"?"sRGB":"raw"}"
				float2 inputs:st.connect = ${D?O:W}
				${F?`
				float4 inputs:scale = (${v?v.r+", "+v.g+", "+v.b:"1, 1, 1"}, ${b})
				`:""}
				${X?`
				float4 inputs:scale = (${q}, ${q}, ${q}, 1)
				float4 inputs:bias = (${oe}, ${oe}, ${_e}, 0)
				`:""}
				token inputs:wrapS = "${R[g.wrapS]}"
				token inputs:wrapT = "${R[g.wrapT]}"
				float outputs:r
				float outputs:g
				float outputs:b
				float3 outputs:rgb
				${n.transparent||n.alphaTest>0?"float outputs:a":""}
			}`}let d=n.transparent||n.alphaTest?n.opacity:1,m=!1,f=!1;if(n instanceof Ro&&n.transmission!==void 0&&(d*=1-n.transmission*(1-n.roughness*.5)),n.map?(o.push(`${r}color3f inputs:diffuseColor.connect = ${Bo}/${l}/${h(n.map)}_diffuse.outputs:rgb>`),n instanceof Qt&&n.transparent&&n.alphaTest==0&&i?(o.push(`${r}float inputs:opacity.connect = ${Bo}/${l}/${h(n.map)}_diffuse.outputs:a>`),m=!0,o.push(`${r}float inputs:opacityThreshold = ${1e-10}`),f=!0):n.transparent?(o.push(`${r}float inputs:opacity.connect = ${Bo}/${l}/${h(n.map)}_diffuse.outputs:a>`),m=!0):n.alphaTest>0&&(o.push(`${r}float inputs:opacity.connect = ${Bo}/${l}/${h(n.map)}_diffuse.outputs:a>`),m=!0,o.push(`${r}float inputs:opacityThreshold = ${n.alphaTest}`),f=!0),a.push(u(n.map,"diffuse",n.color,d))):o.push(`${r}color3f inputs:diffuseColor = ${zj(n.color)}`),n.alphaHash&&i&&(f?console.warn("Opacity threshold for "+n.name+" was already connected. Skipping alphaHash opacity threshold."):(o.push(`${r}float inputs:opacityThreshold = 0.0000000001`),f=!0)),n.aoMap&&(o.push(`${r}float inputs:occlusion.connect = ${Bo}/${l}/${h(n.aoMap)}_occlusion.outputs:r>`),a.push(u(n.aoMap,"occlusion"))),n.alphaMap?(o.push(`${r}float inputs:opacity.connect = ${Bo}/${l}/${h(n.alphaMap)}_opacity.outputs:r>`),o.push(`${r}float inputs:opacityThreshold = 0.0000000001`),m=!0,f=!0,a.push(u(n.alphaMap,"opacity",new Ae(1,1,1),d))):(m?console.warn("Opacity for "+n.name+" was already connected. Skipping default opacity."):(o.push(`${r}float inputs:opacity = ${d}`),m=!0),n.alphaTest>0&&(f?console.warn("Opacity threshold for "+n.name+" was already connected. Skipping default opacity threshold."):(o.push(`${r}float inputs:opacityThreshold = ${n.alphaTest}`),f=!0))),n instanceof vs){if(n.emissiveMap){o.push(`${r}color3f inputs:emissiveColor.connect = ${Bo}/${l}/${h(n.emissiveMap)}_emissive.outputs:rgb>`);const g=n.emissive.clone();g.multiplyScalar(n.emissiveIntensity),a.push(u(n.emissiveMap,"emissive",g))}else if(((s=n.emissive)==null?void 0:s.getHex())>0){const g=n.emissive.clone();g.multiplyScalar(n.emissiveIntensity),o.push(`${r}color3f inputs:emissiveColor = ${zj(g)}`)}n.normalMap&&(o.push(`${r}normal3f inputs:normal.connect = ${Bo}/${l}/${h(n.normalMap)}_normal.outputs:rgb>`),a.push(u(n.normalMap,"normal"))),n.roughnessMap&&n.roughness===1?(o.push(`${r}float inputs:roughness.connect = ${Bo}/${l}/${h(n.roughnessMap)}_roughness.outputs:g>`),a.push(u(n.roughnessMap,"roughness"))):o.push(`${r}float inputs:roughness = ${n.roughness!==void 0?n.roughness:1}`),n.metalnessMap&&n.metalness===1?(o.push(`${r}float inputs:metallic.connect = ${Bo}/${l}/${h(n.metalnessMap)}_metallic.outputs:b>`),a.push(u(n.metalnessMap,"metallic"))):o.push(`${r}float inputs:metallic = ${n.metalness!==void 0?n.metalness:0}`)}return n instanceof Ro&&(o.push(`${r}float inputs:clearcoat = ${n.clearcoat}`),o.push(`${r}float inputs:clearcoatRoughness = ${n.clearcoatRoughness}`),o.push(`${r}float inputs:ior = ${n.ior}`),!n.transparent&&!(n.alphaTest>0)&&n.transmissionMap&&(o.push(`${r}float inputs:opacity.connect = ${Bo}/${l}/${h(n.transmissionMap)}_transmission.outputs:r>`),a.push(u(n.transmissionMap,"transmission")))),c.size>2?console.warn("USDZExporter: Material "+n.name+" uses more than 2 UV channels. Currently, only UV0 and UV1 are supported."):c.size===2&&(!c.has(0)||!c.has(1))&&console.warn("USDZExporter: Material "+n.name+" uses UV channels other than 0 and 1. Currently, only UV0 and UV1 are supported."),`

		def Material "${l}" ${n.name?`(
			displayName = "${n.name}"
		)`:""}
		{
			token outputs:surface.connect = ${Bo}/${l}/PreviewSurface.outputs:surface>

			def Shader "PreviewSurface"
			{
				uniform token info:id = "UsdPreviewSurface"
${o.join(`
`)}
				int inputs:useSpecularWorkflow = ${n instanceof Qt?"1":"0"}
				token outputs:surface
			}
${a.length>0?`
${c.has(0)?`
			def Shader "uvReader_st"
			{
				uniform token info:id = "UsdPrimvarReader_float2"
				token inputs:varname = "st"
				float2 inputs:fallback = (0.0, 0.0)
				float2 outputs:result
			}
`:""}
${c.has(1)?`
			def Shader "uvReader_st1"
			{
				uniform token info:id = "UsdPrimvarReader_float2"
				token inputs:varname = "st1"
				float2 inputs:fallback = (0.0, 0.0)
				float2 outputs:result
			}
`:""}
${a.join(`
`)}`:""}
		}`}function zj(n){return`(${n.r}, ${n.g}, ${n.b})`}function Fj(n){return`(${n.x}, ${n.y})`}const Nj=[1023,33777,33778,33779,35842,35843,37496,37808,37809,37810,37811,37812,37813,37814,37815,37816,37817,37818,37819,37820,37821,36492];te("debugusdz");const Uj=class{constructor(n,e,i){p(this,"id"),p(this,"trigger"),p(this,"action"),p(this,"exclusive",!1),this.id="Behavior_"+zl(n)+"_"+Uj.global_id++,this.trigger=e,this.action=i}makeExclusive(n){return this.exclusive=n,this}writeTo(n,e,i){if(!this.trigger||!this.action)return;i.beginBlock(`def Preliminary_Behavior "${this.id}"`);let s="";if(Array.isArray(this.trigger)){s="[";for(let r=0;r<this.trigger.length;r++){const o=this.trigger[r];s+="<"+o.id+">",r+1<this.trigger.length&&(s+=", ")}s+="]"}else s=`<${this.trigger.id}>`;if(i.appendLine(`rel triggers = ${s}`),i.appendLine(`rel actions = <${this.action.id}>`),i.appendLine(`uniform bool exclusive = ${this.exclusive?1:0}`),i.appendLine(),Array.isArray(this.trigger))for(const r of this.trigger)r.writeTo(e,i),i.appendLine();else this.trigger.writeTo(e,i);i.appendLine(),this.action.writeTo(e,i),i.closeBlock()}};let Gs=Uj;p(Gs,"global_id",0);const w0=new Set;function jk(n,e){var i,s;let r="";if(Array.isArray(n)){w0.clear();let o="[ ";for(let a=0;a<n.length;a++){let l=n[a];if(!l){console.warn("Invalid target object in behavior",n+". Is the object exported?");continue}if(typeof l=="string"){if(w0.has(l))continue;o+=l,w0.add(l)}else if(typeof l=="object"){if(l.isObject3D&&(l=e.findById(l.uuid),!l)){console.warn("Invalid target object in behavior",n+". Is the object exported?");continue}const c=(i=l.getPath)==null?void 0:i.call(l);if(w0.has(c))continue;o+=c,w0.add(c)}a+1<n.length&&(o+=", ")}o+=" ]",r=o,w0.clear()}else if(typeof n=="object"){const o=n;if(o.isObject3D&&(n=e.findById(o.uuid)),!n)throw console.error("Invalid target object in behavior, the target object is likely missing from USDZ export. Is the object exported?",o),new Error(`Invalid target object in behavior, the target object is likely missing from USDZ export. Please report a bug. uuid: ${o.uuid}.`);r=(s=n.getPath)==null?void 0:s.call(n)}return r}const Vj=class{constructor(n,e){p(this,"id"),p(this,"targetId"),p(this,"tokenId"),p(this,"type"),p(this,"distance"),n&&(this.targetId=n),e?this.id=e:this.id="Trigger_"+Vj.global_id++}writeTo(n,e){e.beginBlock(`def Preliminary_Trigger "${this.id}"`),this.targetId&&(typeof this.targetId!="string"&&(this.targetId=jk(this.targetId,n)),e.appendLine("rel affectedObjects = "+this.targetId)),this.tokenId&&e.appendLine(`token info:id = "${this.tokenId}"`),this.type&&e.appendLine(`token type = "${this.type}"`),typeof this.distance=="number"&&e.appendLine(`double distance = ${this.distance}`),e.closeBlock()}};let wd=Vj;p(wd,"global_id",0);function Xj(n,e={direct:!0,indirect:!0}){const i=po.createEmpty();i.name="InputTarget_"+i.name,i.displayName=void 0,i.type="RealityKitComponent",i.onSerialize=s=>{s.appendLine("bool allowsDirectInput = "+(e.direct?1:0)),s.appendLine("bool allowsIndirectInput = "+(e.indirect?1:0)),s.appendLine('uniform token info:id = "RealityKit.InputTarget"')},n.add(i)}class zs{static sceneStartTrigger(){const e=new wd;return e.targetId=void 0,e.tokenId="SceneTransition",e.type="enter",e}static tapTrigger(e,i={direct:!0,indirect:!0}){const s=new wd(e);if(Array.isArray(e)&&e.length>1)for(const r of e)r instanceof po&&Xj(r,i);else e instanceof po&&Xj(e,i);return s.tokenId="TapGesture",s}static isTapTrigger(e){return e?.tokenId==="TapGesture"}static proximityToCameraTrigger(e,i){const s=new wd(e);return s.tokenId="ProximityToCamera",s.distance=i,s}}class Hh{constructor(e,i){p(this,"id"),p(this,"actions"),p(this,"loops",0),p(this,"performCount",1),p(this,"type","serial"),p(this,"multiplePerformOperation"),this.id=e,this.actions=i}static getId(){return this.global_id++}addAction(e){return this.actions.push(e),this}makeParallel(){return this.type="parallel",this}makeSequence(){return this.type="serial",this}makeLooping(){return this.loops=1,this.performCount=0,this}makeRepeat(e){return this.performCount=e,this}writeTo(e,i){i.beginBlock(`def Preliminary_Action "${this.id}"`),i.beginArray("rel actions");for(const s of this.actions){if(!s)continue;const r=s===this.actions[this.actions.length-1];i.appendLine("<"+s.id+">"+(r?"":", "))}i.closeArray(),i.appendLine(),i.appendLine('token info:id = "Group"'),i.appendLine(`bool loops = ${this.loops}`),i.appendLine(`int performCount = ${this.loops>0?0:Math.max(0,this.performCount)}`),i.appendLine(`token type = "${this.type}"`),typeof this.multiplePerformOperation=="string"&&i.appendLine(`token multiplePerformOperation = "${this.multiplePerformOperation}"`),i.appendLine();for(const s of this.actions)s&&(s.writeTo(e,i),i.appendLine());i.closeBlock()}}p(Hh,"global_id",0);const Qk=class{constructor(n,e){p(this,"id"),p(this,"tokenId"),p(this,"affectedObjects"),p(this,"easeType"),p(this,"motionType"),p(this,"duration"),p(this,"moveDistance"),p(this,"style"),p(this,"type"),p(this,"front"),p(this,"up"),p(this,"start"),p(this,"animationSpeed"),p(this,"reversed"),p(this,"pingPong"),p(this,"xFormTarget"),p(this,"audio"),p(this,"gain"),p(this,"auralMode"),p(this,"multiplePerformOperation"),p(this,"velocity"),n&&(this.affectedObjects=n),e?this.id=e:this.id="Action",this.id+="_"+Qk.global_id++}clone(){const n=new Qk,e=n.id;return Object.assign(n,this),n.id=e,n}writeTo(n,e){e.beginBlock(`def Preliminary_Action "${this.id}"`),this.affectedObjects&&(typeof this.affectedObjects!="string"&&(this.affectedObjects=jk(this.affectedObjects,n)),e.appendLine("rel affectedObjects = "+this.affectedObjects)),typeof this.duration=="number"&&(typeof this.animationSpeed=="number"&&this.animationSpeed!==1?e.appendLine(`double duration = ${this.duration/this.animationSpeed} `):e.appendLine(`double duration = ${this.duration} `)),this.easeType&&e.appendLine(`token easeType = "${this.easeType}"`),this.tokenId&&e.appendLine(`token info:id = "${this.tokenId}"`),this.tokenId==="ChangeScene"&&e.appendLine("rel scene = </StageRoot/Scenes/Scene>"),this.motionType!==void 0&&e.appendLine(`token motionType = "${this.motionType}"`),typeof this.moveDistance=="number"&&e.appendLine(`double moveDistance = ${this.moveDistance} `),this.style&&e.appendLine(`token style = "${this.style}"`),this.type&&e.appendLine(`token type = "${this.type}"`),this.front&&e.appendLine(`vector3d front = (${this.front.x}, ${this.front.y}, ${this.front.z})`),this.up&&e.appendLine(`vector3d upVector = (${this.up.x}, ${this.up.y}, ${this.up.z})`),typeof this.start=="number"&&e.appendLine(`double start = ${this.start} `),typeof this.animationSpeed=="number"&&e.appendLine(`double animationSpeed = ${this.animationSpeed.toFixed(2)} `),typeof this.reversed=="boolean"&&e.appendLine(`bool reversed = ${this.reversed}`),typeof this.pingPong=="boolean"&&e.appendLine(`bool reverses = ${this.pingPong}`),this.xFormTarget&&(typeof this.xFormTarget!="string"&&(this.xFormTarget=jk(this.xFormTarget,n)),e.appendLine(`rel xformTarget = ${this.xFormTarget}`)),typeof this.audio=="string"&&e.appendLine(`asset audio = @${this.audio}@`),typeof this.gain=="number"&&e.appendLine(`double gain = ${this.gain}`),typeof this.auralMode=="string"&&e.appendLine(`token auralMode = "${this.auralMode}"`),typeof this.multiplePerformOperation=="string"&&e.appendLine(`token multiplePerformOperation = "${this.multiplePerformOperation}"`),typeof this.velocity=="object"&&e.appendLine(`vector3d velocity = (${this.velocity.x}, ${this.velocity.y}, ${this.velocity.z})`),e.closeBlock()}};let na=Qk;p(na,"global_id",0);let _0=class zy{constructor(e,i,s){p(this,"x",0),p(this,"y",0),p(this,"z",0),this.x=e,this.y=i,this.z=s}static get up(){return new zy(0,1,0)}static get right(){return new zy(1,0,0)}static get forward(){return new zy(0,0,1)}static get back(){return new zy(0,0,-1)}static get zero(){return new zy(0,0,0)}};class bi{static sequence(...e){return new Hh("Group_"+Hh.getId(),e).makeSequence()}static parallel(...e){return new Hh("Group_"+Hh.getId(),e).makeParallel()}static fadeAction(e,i,s){const r=new na(e);return r.tokenId="Visibility",r.type=s?"show":"hide",r.duration=i,r.style="basic",r.motionType="none",r.moveDistance=0,r.easeType="none",r}static startAnimationAction(e,i,s=0,r=1,o=!1,a=!1){const l=new na(e);if(l.tokenId="StartAnimation",l.start=i,l.duration=s,l.animationSpeed=r,l.reversed=o,l.pingPong=a,l.multiplePerformOperation="allow",o&&(l.start-=s),a){l.pingPong=!1;const c=l.clone();return c.reversed=!o,c.start=l.start,c.reversed&&(c.start-=s),bi.sequence(l,c)}return l}static waitAction(e){const i=new na;return i.tokenId="Wait",i.duration=e,i.motionType=void 0,i}static lookAtCameraAction(e,i,s,r){const o=new na(e);return o.tokenId="LookAtCamera",o.duration=i===void 0?9999999999999:i,o.front=s??_0.forward,o.up=r??_0.up,o}static emphasize(e,i,s="bounce",r=1,o="basic"){const a=new na(e);return a.tokenId="Emphasize",a.duration=i,a.style=o??"basic",a.motionType=s,a.moveDistance=r,a}static transformAction(e,i,s,r,o="inout"){const a=new na(e);return a.tokenId="Transform",a.duration=s,a.duration=Math.max(1e-6,s),a.type=r,a.easeType=s>0?o:"none",Array.isArray(i)&&console.error("Transform target must not be an array",i),a.xFormTarget=i,a}static playAudioAction(e,i,s="play",r=1,o="spatial"){const a=new na(e);return a.tokenId="Audio",a.type=s,a.audio=i,a.gain=r,a.auralMode=o,a.multiplePerformOperation="allow",a}static impulseAction(e,i){const s=new na(e);return s.tokenId="Impulse",s.velocity=i,s}}class $ge{constructor(e){p(this,"object"),p(this,"model"),this.object=e}get id(){return this.object.uuid}apply(e){if(!this.model&&(this.model=e.findById(this.object.uuid),!this.model)){console.error("could not find model with id "+this.object.uuid);return}this.onApply(e)}}class Zk extends $ge{constructor(e,i,s,r){super(e),p(this,"matrix"),p(this,"material"),p(this,"geometry"),p(this,"_enableAction"),p(this,"_disableAction"),this.matrix=i,this.material=s,this.geometry=r}onApply(e){var i,s;const r=this.model;if(!r)return;(i=r.parent)!=null&&i.isDynamic||po.createEmptyParent(r);const o=r.clone();this.matrix&&o.setMatrix(this.matrix),this.material&&(o.material=this.material),this.geometry&&(o.geometry=this.geometry),(s=r.parent)==null||s.add(o)}enable(){return this._enableAction?this._enableAction:(this._enableAction=bi.fadeAction(this.object,0,!0),this._enableAction)}disable(){return this._disableAction?this._disableAction:(this._disableAction=bi.fadeAction(this.object,0,!1),this._disableAction)}}class Yk{constructor(e){p(this,"actions"),p(this,"sortedActions"),this.actions=[...e]}organize(){this.sortedActions={};for(const e of this.actions){const i=e.id;this.sortedActions[i]||(this.sortedActions[i]=[]),this.sortedActions[i].push(e)}}getActions(e){return this.sortedActions||this.organize(),this.sortedActions[e.uuid]}}const S0=function(n){return T(n)},T=function(n){if(n===void 0&&(n=null),!Array.isArray(n))n=Wj(n);else for(let e=0;e<n.length;e++){const i=n[e];n[e]=Wj(i)}return function(e,i){typeof i!="string"&&(i=i.name),Object.getOwnPropertyDescriptor(e,"$serializedTypes")||(e.$serializedTypes={});const s=e.$serializedTypes=e.$serializedTypes||{};s[i]=n}};function Wj(n){var e,i;switch((i=(e=n?.prototype)==null?void 0:e.constructor)==null?void 0:i.name){case"Number":case"String":case"Boolean":return null}return n}class ie extends ye{constructor(){super(...arguments),p(this,"guid")}static isDestroyed(e){return Em(e)}static setActive(e,i,s=!0){e&&(eA(e,i),QS(e),i&&s&&w9(Pt.Current,e))}static isActiveSelf(e){return c0(e)}static isActiveInHierarchy(e){return o4(e)}static markAsInstancedRendered(e,i){a4(e,i)}static isUsingInstancing(e){return cC(e)}static foreachComponent(e,i,s=!0){return Tm(e,i,s)}static instantiateSynced(e,i){return e?NB(e,i):null}static instantiate(e,i=null){return h0(e,i)}static destroySynced(e,i,s=!0){if(!e)return;const r=e;i=i??Pt.Current,Wb(r,i.connection,s)}static destroy(e,i=!0){return ia(e,i)}static add(e,i,s){if(!(!e||!i)){if(e===i){console.warn("Can not add object to self",e);return}s||(s=Pt.Current),i.add(e),eA(e,!0),QS(e),s?ie.foreachComponent(e,r=>{PB(r,s),!r.__internalDidAwakeAndStart&&s.new_script_start.includes(r)===!1&&s.new_script_start.push(r)},!0):console.warn("Missing context")}}static remove(e){var i;e&&((i=e.parent)==null||i.remove(e),eA(e,!1),QS(e),ie.foreachComponent(e,s=>{dme(s)},!0))}static invokeOnChildren(e,i,...s){this.invoke(e,i,!0,s)}static invoke(e,i,s=!1,...r){e&&this.foreachComponent(e,o=>{const a=o[i];a&&typeof a=="function"&&a?.call(o,...r)},s)}static addNewComponent(e,i,s,r=!0){return ta(e,i,s,{callAwake:r})}static addComponent(e,i,s,r){return ta(e,i,s,r)}static moveComponent(e,i){return ta(e,i)}static removeComponent(e){return qB(e.gameObject,e),e}static getOrAddComponent(e,i){return Kb(e,i)}static getComponent(e,i){return e===null?null:Mm(e,i)}static getComponents(e,i,s=null){return e===null?s??[]:Jb(e,i,s)}static findByGuid(e,i){return tA(e,i)}static findObjectOfType(e,i,s=!0){return rC(e,i??Pt.Current,s)}static findObjectsOfType(e,i){const s=[];return s4(e,s,i),s}static getComponentInChildren(e,i){return qb(e,i)}static getComponentsInChildren(e,i,s=null){return l0(e,i,s??void 0)}static getComponentInParent(e,i){return $b(e,i)}static getComponentsInParent(e,i,s=null){return sC(e,i,s)}static getAllComponents(e){var i;const s=(i=e.userData)==null?void 0:i.components;return s?[...s]:[]}static*iterateComponents(e){var i;const s=(i=e?.userData)==null?void 0:i.components;if(s&&Array.isArray(s))for(let r=0;r<s.length;r++)yield s[r]}}var _d;let Pe=(_d=class{constructor(n){p(this,"__context"),p(this,"__name"),p(this,"gameObject"),p(this,"guid","invalid"),p(this,"sourceId"),p(this,"__didAwake",!1),p(this,"__didStart",!1),p(this,"__didEnable",!1),p(this,"__isEnabled"),p(this,"__destroyed",!1),p(this,"_eventListeners",new Map),this.__didAwake=!1,this.__didStart=!1,this.__didEnable=!1,this.__isEnabled=void 0,this.__destroyed=!1,this._internalInit(n)}get isComponent(){return!0}get context(){return this.__context??Pt.Current}set context(n){this.__context=n}get scene(){return this.context.scene}get layer(){var n,e;return(e=(n=this.gameObject)==null?void 0:n.userData)==null?void 0:e.layer}get name(){var n,e;return(n=this.gameObject)!=null&&n.name?this.gameObject.name:(e=this.gameObject)==null?void 0:e.userData.name}set name(n){this.gameObject?(this.gameObject.userData||(this.gameObject.userData={}),this.gameObject.userData.name=n,this.__name=n):this.__name=n}get tag(){var n;return(n=this.gameObject)==null?void 0:n.userData.tag}set tag(n){this.gameObject&&(this.gameObject.userData||(this.gameObject.userData={}),this.gameObject.userData.tag=n)}get static(){var n;return(n=this.gameObject)==null?void 0:n.userData.static}set static(n){this.gameObject&&(this.gameObject.userData||(this.gameObject.userData={}),this.gameObject.userData.static=n)}get hideFlags(){var n;return(n=this.gameObject)==null?void 0:n.userData.hideFlags}get activeAndEnabled(){return!(this.destroyed||this.__isEnabled===!1||!this.__isActiveInHierarchy)}get __isActive(){return this.gameObject.visible}get __isActiveInHierarchy(){if(!this.gameObject)return!1;const n=this.gameObject[_h];return n===void 0?!0:n}set __isActiveInHierarchy(n){this.gameObject&&(this.gameObject[_h]=n)}awake(){}onEnable(){}onDisable(){}onDestroy(){this.__destroyed=!0}startCoroutine(n,e=Yi.Update){return this.context.registerCoroutineUpdate(this,n,e)}stopCoroutine(n,e=Yi.Update){this.context.unregisterCoroutineUpdate(n,e)}get destroyed(){return this.__destroyed}destroy(){this.__destroyed||this.__internalDestroy()}get __internalDidAwakeAndStart(){return this.__didAwake&&this.__didStart}__internalNewInstanceCreated(n){return this.__didAwake=!1,this.__didStart=!1,this.__didEnable=!1,this.__isEnabled=void 0,this.__destroyed=!1,this._internalInit(n),this}_internalInit(n){if(typeof n=="object")for(const e of Object.keys(n)){const i=n[e];typeof i!="function"&&(this[e]=i)}}__internalAwake(){this.__didAwake||(this.__didAwake=!0,this.awake())}__internalStart(){this.__didStart||(this.__didStart=!0,this.start&&this.start())}__internalEnable(n){return this.__destroyed?(Ye()&&console.warn("[Needle Engine Dev] Trying to enable destroyed component"),!1):this.__didAwake?this.__didEnable?(n!==!0&&(this.__isEnabled=!0),!1):(this.__didEnable=!0,this.__isEnabled=!0,this.onEnable(),!0):!1}__internalDisable(n){if(this.__didAwake){if(!this.__didEnable){n!==!0&&(this.__isEnabled=!1);return}this.__didEnable=!1,this.__isEnabled=!1,this.onDisable()}}__internalDestroy(){var n;this.__destroyed||(this.__destroyed=!0,this.__didAwake&&((n=this.onDestroy)==null||n.call(this),this.dispatchEvent(new CustomEvent("destroyed",{detail:this}))),t4(this))}get enabled(){return typeof this.__isEnabled=="boolean"?this.__isEnabled:!0}set enabled(n){if(this.__destroyed){Ye()&&console.warn(`[Needle Engine Dev] Trying to ${n?"enable":"disable"} destroyed component`);return}if(typeof n=="number"&&(n>=.5?n=!0:n=!1),!this.__didAwake){this.__isEnabled=n;return}n?this.__internalEnable():this.__internalDisable()}get worldPosition(){return zt(this.gameObject)}set worldPosition(n){bs(this.gameObject,n)}setWorldPosition(n,e,i){$p(this.gameObject,n,e,i)}get worldQuaternion(){return ki(this.gameObject)}set worldQuaternion(n){La(this.gameObject,n)}setWorldQuaternion(n,e,i,s){nL(this.gameObject,n,e,i,s)}get worldEuler(){return rL(this.gameObject)}set worldEuler(n){oL(this.gameObject,n)}get worldRotation(){return this.gameObject.worldRotation}set worldRotation(n){this.setWorldRotation(n.x,n.y,n.z,!0)}setWorldRotation(n,e,i,s=!0){Xv(this.gameObject,n,e,i,s)}get forward(){return _d._forward.set(0,0,-1).applyQuaternion(this.worldQuaternion)}get right(){return _d._right.set(1,0,0).applyQuaternion(this.worldQuaternion)}get up(){return _d._up.set(0,1,0).applyQuaternion(this.worldQuaternion)}addEventListener(n,e){this._eventListeners[n]=this._eventListeners[n]||[],this._eventListeners[n].push(e)}removeEventListener(n,e){if(!this._eventListeners[n])return;const i=this._eventListeners[n].indexOf(e);i>=0&&this._eventListeners[n].splice(i,1)}dispatchEvent(n){if(!n||!this._eventListeners[n.type])return!1;const e=this._eventListeners[n.type];for(let i=0;i<e.length;i++)e[i](n);return!1}},p(_d,"_forward",new E),p(_d,"_right",new E),p(_d,"_up",new E),_d);const e0e=Object.freeze(Object.defineProperty({__proto__:null,Behaviour:Pe,Component:Pe,GameObject:ie},Symbol.toStringTag,{value:"Module"}));var t0e=Object.defineProperty,i0e=Object.getOwnPropertyDescriptor,Hj=(n,e,i,s)=>{for(var r=s>1?void 0:s?i0e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&t0e(e,i,r),r};class mA extends Pe{constructor(){super(...arguments),p(this,"from"),p(this,"to"),p(this,"width",0),p(this,"centered",!0),p(this,"_centerPos")}awake(){this._centerPos=new E}update(){if(!this.from||!this.to)return;const e=zt(this.from).clone(),i=zt(this.to).clone(),s=e.distanceTo(i);this._centerPos.copy(e),this._centerPos.add(i),this._centerPos.multiplyScalar(.5),bs(this.gameObject,this.centered?this._centerPos:e),this.gameObject.lookAt(zt(this.to).clone()),this.gameObject.scale.set(this.width,this.width,s)}}Hj([T(ie)],mA.prototype,"from",2),Hj([T(ie)],mA.prototype,"to",2);var n0e=Object.defineProperty,s0e=Object.getOwnPropertyDescriptor,Bm=(n,e,i,s)=>{for(var r=s>1?void 0:s?s0e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&n0e(e,i,r),r};const Sd=te("debuganimation");let jj=class{constructor(){p(this,"x"),p(this,"y")}};class Fr extends Pe{constructor(){super(...arguments),p(this,"playAutomatically",!0),p(this,"randomStartTime",!0),p(this,"minMaxSpeed"),p(this,"minMaxOffsetNormalized"),p(this,"loop",!0),p(this,"clampWhenFinished",!1),p(this,"_tempAnimationClipBeforeGameObjectExisted",null),p(this,"_tempAnimationsArray"),p(this,"mixer"),p(this,"_actions"),p(this,"_handles")}get isAnimationComponent(){return!0}addClip(e){this.animations||(this.animations=[]),this.animations.push(e)}get time(){if(this.actions){for(const e of this.actions)if(e.isRunning())return e.time}return 0}set time(e){if(this.actions)for(const i of this.actions)i.time=e}get clip(){var e;return(e=this.animations)!=null&&e.length?this.animations[0]:null}set clip(e){if(!this.__didAwake){Sd&&console.warn("Assign clip during serialization",e),this._tempAnimationClipBeforeGameObjectExisted=e;return}e&&(this.gameObject.animations||(this.gameObject.animations=[]),!this.animations.includes(e)&&(this.animations.length>0?this.animations.splice(0,0,e):this.animations.push(e)))}set clips(e){this.animations=e}set animations(e){e==null||!Array.isArray(e)||(this.gameObject?this.gameObject.animations=e:this._tempAnimationsArray=e)}get animations(){return this.gameObject.animations||this._tempAnimationsArray||[]}get actions(){return this._actions}set actions(e){this._actions=e}awake(){this.mixer=void 0,Sd&&console.log("Animation Awake",this.name,this),this._tempAnimationsArray&&(this.animations=this._tempAnimationsArray,this._tempAnimationsArray=void 0),this._tempAnimationClipBeforeGameObjectExisted&&(this.clip=this._tempAnimationClipBeforeGameObjectExisted,this._tempAnimationClipBeforeGameObjectExisted=null),this.actions=[],this._handles=[]}onEnable(){var e;if(this.playAutomatically&&((e=this.animations)==null?void 0:e.length)>0){const i=Math.floor(Math.random()*this.animations.length),s=this.animations[i];this.play(i,{exclusive:!0,fadeDuration:0,startTime:this.randomStartTime?Math.random()*s.duration:0,loop:this.loop,clampWhenFinished:this.clampWhenFinished})}}update(){this.mixer&&(this.mixer.update(this.context.time.deltaTime),this._handles.forEach(e=>e.update()))}onDisable(){this.mixer&&this.mixer.stopAllAction()}onDestroy(){this.context.animations.unregisterAnimationMixer(this.mixer)}getAction(e){var i;return((i=this.actions)==null?void 0:i.find(s=>s.getClip().name===e))||null}get isPlaying(){if(this.actions){for(let e=0;e<this.actions.length;e++)if(this.actions[e].isRunning())return!0}return!1}stopAll(e){if(this.actions)for(const i of this.actions)e!=null&&e.fadeDuration?i.fadeOut(e.fadeDuration):i.stop()}stop(e,i){if(e===void 0){this.stopAll();return}else if(typeof e=="number"){if(e>=this.animations.length){Sd&&console.log("No animation at index",e);return}e=this.animations[e]}else typeof e=="string"&&(e=this.animations.find(r=>r.name===e));if(!e){console.error("Could not find clip",e);return}const s=this.actions.find(r=>r.getClip()===e);if(!s){console.error("Could not find action",e);return}i!=null&&i.fadeDuration?s.fadeOut(i.fadeDuration):s.stop()}pause(e,i=!1){if(e===void 0){for(const r of this.actions)r.paused=!i;return}else if(typeof e=="number"){if(e>=this.animations.length){Sd&&console.log("No animation at index",e);return}e=this.animations[e]}else typeof e=="string"&&(e=this.animations.find(r=>r.name===e));if(!e){console.error("Could not find clip",e);return}const s=this.actions.find(r=>r.getClip()===e);if(!s){console.error("Could not find action",e);return}s.paused=!i}resume(){for(const e of this.actions)e.paused=!1}play(e=0,i){if(Sd&&console.log("PLAY",e),this.ensureMixer(),!this.mixer){Sd&&console.warn("Missing mixer",this);return}e===void 0&&(e=0);let s=e;if(typeof e=="number"){if(e>=this.animations.length){Sd&&console.log("No animation at index",e);return}s=this.animations[e]}else typeof e=="string"&&(s=this.animations.find(o=>o.name===e));if(!s){console.error("Could not find clip",e);return}i||(i={});for(const o of this.actions)if(o.getClip()===s)return this.internalOnPlay(o,i);if(!s.tracks){console.warn("Clip is no AnimationClip",s);return}const r=this.mixer.clipAction(s);return this.actions.push(r),this.internalOnPlay(r,i)}internalOnPlay(e,i){var s=this.actions.find(o=>o===e);if(s===e&&s.isRunning()&&s.time<s.getClip().duration){const o=this.tryFindHandle(e);if(s.paused&&(s.paused=!1),o)return o.waitForFinish()}if(i.loop===void 0&&(i.loop=this.loop),i.clampWhenFinished===void 0&&(i.clampWhenFinished=this.clampWhenFinished),i.minMaxOffsetNormalized===void 0&&this.randomStartTime&&(i.minMaxOffsetNormalized=this.minMaxOffsetNormalized),i.minMaxSpeed===void 0&&(i.minMaxSpeed=this.minMaxSpeed),i?.exclusive??!0)for(const o of this.actions)o!=s&&(i.fadeDuration?o.fadeOut(i.fadeDuration):o.stop());if(i!=null&&i.fadeDuration&&e.fadeIn(i.fadeDuration),e.enabled=!0,i?.startTime!=null)e.time=i.startTime;else if(i!=null&&i.minMaxOffsetNormalized&&i.minMaxOffsetNormalized.x!=0&&i.minMaxOffsetNormalized.y!=0){const o=e.getClip();e.time=tt.lerp(i.minMaxOffsetNormalized.x,i.minMaxOffsetNormalized.y,Math.random())*o.duration}else e.time>=e.getClip().duration&&(e.time=0);i!=null&&i.minMaxSpeed?e.timeScale=tt.lerp(i.minMaxSpeed.x,i.minMaxSpeed.y,Math.random()):e.timeScale=i?.speed??1,i?.loop!=null?e.loop=i.loop?MR:$y:e.loop=$y,i!=null&&i.clampWhenFinished&&(e.clampWhenFinished=!0),e.paused=!1,e.play(),Sd&&console.log("PLAY",e.getClip().name,e);const r=new r0e(e,this.mixer,i,o=>{this._handles.splice(this._handles.indexOf(r),1)});return this._handles.push(r),r.waitForFinish()}tryFindHandle(e){for(const i of this._handles)if(i.action===e)return i}ensureMixer(){if(!this.mixer){const e="animationMixer";this.gameObject[e]&&(this.mixer=this.gameObject[e]),(!this.mixer||!this.mixer.clipAction)&&(this.mixer=new Jw(this.gameObject),this.gameObject[e]=this.mixer)}this.context.animations.registerAnimationMixer(this.mixer)}}Bm([T()],Fr.prototype,"playAutomatically",2),Bm([T()],Fr.prototype,"randomStartTime",2),Bm([T(jj)],Fr.prototype,"minMaxSpeed",2),Bm([T(jj)],Fr.prototype,"minMaxOffsetNormalized",2),Bm([T()],Fr.prototype,"loop",2),Bm([T()],Fr.prototype,"clampWhenFinished",2),Bm([T(to)],Fr.prototype,"clips",1);class r0e{constructor(e,i,s,r){p(this,"mixer"),p(this,"action"),p(this,"promise",null),p(this,"_options"),p(this,"_resolveCallback",null),p(this,"_resolvedOrRejectedCallback"),p(this,"onLoop",o=>{}),p(this,"onFinished",o=>{o.action===this.action&&this.onResolve()}),this.action=e,this.mixer=i,this._resolvedOrRejectedCallback=r,this._options=s}waitForFinish(){return this.promise?this.promise:(this.promise=new Promise(e=>{this._resolveCallback=e}),this.mixer.addEventListener("loop",this.onLoop),this.mixer.addEventListener("finished",this.onFinished),this.promise)}update(){this._options&&this._options.endTime!==void 0&&this.action.time>this._options.endTime&&(this._options.loop===!0?this.action.time=this._options.startTime??0:(this.action.time=this._options.endTime,this.action.timeScale=0,this.onResolve()))}onResolve(){var e,i;this.dispose(),(e=this._resolvedOrRejectedCallback)==null||e.call(this,this),(i=this._resolveCallback)==null||i.call(this,this.action)}dispose(){this.mixer.removeEventListener("loop",this.onLoop),this.mixer.removeEventListener("finished",this.onFinished)}}var o0e=Object.defineProperty,a0e=Object.getOwnPropertyDescriptor,Cd=(n,e,i,s)=>{for(var r=s>1?void 0:s?a0e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&o0e(e,i,r),r};class fo{constructor(e=0,i=0){p(this,"time",0),p(this,"value",0),p(this,"inTangent",1/0),p(this,"inWeight"),p(this,"outTangent",1/0),p(this,"outWeight"),p(this,"weightedMode"),this.time=e,this.value=i}}Cd([T()],fo.prototype,"time",2),Cd([T()],fo.prototype,"value",2),Cd([T()],fo.prototype,"inTangent",2),Cd([T()],fo.prototype,"inWeight",2),Cd([T()],fo.prototype,"outTangent",2),Cd([T()],fo.prototype,"outWeight",2),Cd([T()],fo.prototype,"weightedMode",2);const fA=class{constructor(){p(this,"keys",[])}static linearFromTo(n,e,i){const s=new fA,r=new fo;r.time=0,r.value=n;const o=new fo;return o.time=i,o.value=e,s.keys.push(r,o),s}static constant(n){const e=new fA,i=new fo;return i.time=0,i.value=n,e.keys.push(i),e}clone(){var n;const e=new fA;return e.keys=((n=this.keys)==null?void 0:n.map(i=>{const s=new fo;return s.time=i.time,s.value=i.value,s.inTangent=i.inTangent,s.inWeight=i.inWeight,s.outTangent=i.outTangent,s.outWeight=i.outWeight,s.weightedMode=i.weightedMode,s}))||[],e}get duration(){return!this.keys||this.keys.length==0?0:this.keys[this.keys.length-1].time}evaluate(n){if(!this.keys||this.keys.length==0)return 0;if(this.keys.length===1)return this.keys[0].value;if(this.keys[0].time>=n)return this.keys[0].value;for(let e=0;e<this.keys.length;e++){const i=this.keys[e];if(i.time<=n)if(e+1<this.keys.length){const s=this.keys[e+1];if(s.time<n)continue;return!isFinite(i.outTangent)||!isFinite(s.inTangent)?i.value:fA.interpolateValue(n,i,s)}else return i.value}return this.keys[this.keys.length-1].value}static interpolateValue(n,e,i){const s=e.time,r=e.value,o=e.outTangent,a=i.time,l=i.value,c=i.inTangent,h=a-s,u=h*h,d=u*h,m=((o+c)*h-2*(l-r))/d,f=(3*(l-r)-(c+2*o)*h)/u,g=o,y=r,v=n-s,b=v*v,A=b*v;return m*A+f*b+g*v+y}};let km=fA;Cd([T(fo)],km.prototype,"keys",2);const jC=Symbol("objectIsAnimatedData");function Qj(n,e,i){if(!n)return;if(n[jC]===void 0){if(!i)return;n[jC]=new Set}const s=n[jC];i?s.add(e):s.has(e)&&s.delete(e)}function l0e(n){if(!n)return!1;const e=n[jC];return e!==void 0&&e.size>0}class c0e{constructor(){p(this,"_context")}get context(){return this._context??Pt.Current}get isStateMachineBehaviour(){return!0}}class gA{constructor(e,i,s,r){p(this,"name"),p(this,"nameHash"),p(this,"normalizedTime"),p(this,"length"),p(this,"speed"),p(this,"action"),p(this,"hasTransitions");var o;this.name=e.name,this.nameHash=e.hash,this.normalizedTime=i,this.length=s,this.speed=r,this.action=e.motion.action||null,this.hasTransitions=((o=e.transitions)==null?void 0:o.length)>0||!1}}function Zj(n,e){return{name:"Empty",isLooping:!1,guid:e?.generateUUID()??oi.generateUUID(),index:-1,clip:new to(n,0,[])}}var Md=(n=>(n[n.If=1]="If",n[n.IfNot=2]="IfNot",n[n.Greater=3]="Greater",n[n.Less=4]="Less",n[n.Equals=6]="Equals",n[n.NotEqual=7]="NotEqual",n))(Md||{}),Kk=(n=>(n[n.Float=1]="Float",n[n.Int=3]="Int",n[n.Bool=4]="Bool",n[n.Trigger=9]="Trigger",n))(Kk||{});const _s=te("debuganimatorcontroller"),QC=te("debugrootmotion");class Sa{constructor(e){p(this,"_speed",1),p(this,"normalizedStartOffset",0),p(this,"animator"),p(this,"model"),p(this,"_mixer"),p(this,"_activeState"),p(this,"_activeStates",[]),p(this,"_heldActions",[]),p(this,"rootMotionHandler"),this.model=e,_s&&console.log(this)}static createFromClips(e,i={looping:!1,autoTransition:!0,transitionDuration:0}){const s=[];for(let o=0;o<e.length;o++){const a=e[o],l=[];if(i.autoTransition!==!1){const h=i.transitionDuration??0,u=h/a.duration;let d=o;(i.autoTransition===void 0||i.autoTransition===!0)&&(d=(o+1)%e.length),l.push({exitTime:1-u,offset:0,duration:h,hasExitTime:!0,destinationState:d,conditions:[]})}const c={name:a.name,hash:o,motion:{name:a.name,clip:a,isLooping:i?.looping??!1},transitions:l,behaviours:[]};s.push(c)}const r={name:"AnimatorController",guid:new Es(Date.now()).generateUUID(),parameters:[],layers:[{name:"Base Layer",stateMachine:{defaultState:0,states:s}}]};return new Sa(r)}play(e,i=-1,s=Number.NEGATIVE_INFINITY,r=0){if(i<0)i=0;else if(i>=this.model.layers.length){console.warn("invalid layer");return}const o=this.model.layers[i].stateMachine;for(const a of o.states)if(a.name===e||a.hash===e){_s&&console.log("transition to ",a),this.transitionTo(a,r,s);return}console.warn("Could not find "+e+" to play")}reset(){this.setStartTransition()}setBool(e,i){var s,r;const o=typeof e=="string"?"name":"hash";return(r=(s=this.model)==null?void 0:s.parameters)==null?void 0:r.filter(a=>a[o]===e).forEach(a=>a.value=i)}getBool(e){var i,s,r;const o=typeof e=="string"?"name":"hash";return((r=(s=(i=this.model)==null?void 0:i.parameters)==null?void 0:s.find(a=>a[o]===e))==null?void 0:r.value)??!1}setFloat(e,i){var s,r;const o=typeof e=="string"?"name":"hash",a=(r=(s=this.model)==null?void 0:s.parameters)==null?void 0:r.filter(l=>l[o]===e);return a.forEach(l=>l.value=i),a?.length>0}getFloat(e){var i,s,r;const o=typeof e=="string"?"name":"hash";return((r=(s=(i=this.model)==null?void 0:i.parameters)==null?void 0:s.find(a=>a[o]===e))==null?void 0:r.value)??0}setInteger(e,i){var s,r;const o=typeof e=="string"?"name":"hash";return(r=(s=this.model)==null?void 0:s.parameters)==null?void 0:r.filter(a=>a[o]===e).forEach(a=>a.value=i)}getInteger(e){var i,s,r;const o=typeof e=="string"?"name":"hash";return((r=(s=(i=this.model)==null?void 0:i.parameters)==null?void 0:s.find(a=>a[o]===e))==null?void 0:r.value)??0}setTrigger(e){var i,s;_s&&console.log("SET TRIGGER",e);const r=typeof e=="string"?"name":"hash";return(s=(i=this.model)==null?void 0:i.parameters)==null?void 0:s.filter(o=>o[r]===e).forEach(o=>o.value=!0)}resetTrigger(e){var i,s;const r=typeof e=="string"?"name":"hash";return(s=(i=this.model)==null?void 0:i.parameters)==null?void 0:s.filter(o=>o[r]===e).forEach(o=>o.value=!1)}getTrigger(e){var i,s,r;const o=typeof e=="string"?"name":"hash";return((r=(s=(i=this.model)==null?void 0:i.parameters)==null?void 0:s.find(a=>a[o]===e))==null?void 0:r.value)??!1}isInTransition(){return this._activeStates.length>1}setSpeed(e){this._speed=e}FindState(e){return this.findState(e)}findState(e){if(!e)return null;if(Array.isArray(this.model.layers)){for(const i of this.model.layers)for(const s of i.stateMachine.states)if(s.name===e||s.hash==e)return s}return null}getCurrentStateInfo(){if(!this._activeState)return null;const e=this._activeState.motion.action;if(!e)return null;const i=this._activeState.motion.clip.duration,s=i<=0?0:Math.abs(e.time/i);return new gA(this._activeState,s,i,this._speed)}get currentAction(){return this._activeState&&this._activeState.motion.action||null}get context(){var e;return(e=this.animator)==null?void 0:e.context}get mixer(){return this._mixer}dispose(){var e;if(this._mixer.stopAllAction(),this.animator){this._mixer.uncacheRoot(this.animator.gameObject);for(const i of this._activeStates)i.motion.clip&&this.mixer.uncacheAction(i.motion.clip,this.animator.gameObject)}(e=this.context)==null||e.animations.unregisterAnimationMixer(this._mixer)}bind(e){var i,s;e?this.animator!==e&&(this._mixer&&(this._mixer.stopAllAction(),(i=this.context)==null||i.animations.unregisterAnimationMixer(this._mixer)),this.animator=e,this._mixer=new Jw(this.animator.gameObject),(s=this.context)==null||s.animations.registerAnimationMixer(this._mixer),this.createActions(this.animator)):console.error("AnimatorController.bind: animator is null")}clone(){if(typeof this.model=="string")return console.warn("AnimatorController has not been resolved, can not create model from string",this.model),null;_s&&console.warn("AnimatorController clone()",this.model);const e=Dv(this.model,(i,s,r)=>r==null?!0:!(r.type==="Object3D"||r.isObject3D===!0||L5(r)||r.tracks!==void 0||r instanceof Sa));return console.assert(e!==this.model),new Sa(e)}update(e){var i,s;if(!this.animator)return;this.evaluateTransitions(),this.updateActiveStates(e);const r=this.animator.context.time.deltaTime;this.animator.applyRootMotion&&((i=this.rootMotionHandler)==null||i.onBeforeUpdate(e)),this._mixer.update(r),this.animator.applyRootMotion&&((s=this.rootMotionHandler)==null||s.onAfterUpdate(e))}get activeState(){return this._activeState}updateActiveStates(e){for(let i=0;i<this._activeStates.length;i++){const s=this._activeStates[i],r=s.motion;if(!r.action)this._activeStates.splice(i,1),i--;else{const o=r.action;o.weight=e,o.getEffectiveWeight()<=0&&!o.isRunning()&&(_s&&console.debug("REMOVE",s.name,o.getEffectiveWeight(),o.isRunning(),o.isScheduled()),this._activeStates.splice(i,1),i--)}}}setStartTransition(){var e;this.model.layers.length>1&&(_s||Ye())&&console.warn("Multiple layers are not supported yet "+((e=this.animator)==null?void 0:e.name));for(const i of this.model.layers){const s=i.stateMachine;s.defaultState===void 0&&(_s&&console.warn("AnimatorController default state is undefined, will assign state 0 as default",i),s.defaultState=0);const r=s.states[s.defaultState];this.transitionTo(r,0,this.normalizedStartOffset);break}}evaluateTransitions(){var e;let i=!1;if(!this._activeState){if(this.setStartTransition(),!this._activeState)return;i=!0}const s=this._activeState,r=s.motion.action;for(const a of s.transitions){if(!a.hasExitTime&&a.conditions.length<=0)continue;let l=!0;for(const c of a.conditions)if(!this.evaluateCondition(c)){l=!1;break}if(l)if(r){const c=s.motion.clip.duration,h=c<=0?1:Math.abs(r.time/c);let u=a.exitTime;r.timeScale<0&&(u=1-u);let d=!1;if(a.hasExitTime?r.timeScale>0?d=h>=a.exitTime:r.timeScale<0&&(d=1-h>=a.exitTime):d=!0,d){for(const m of a.conditions){const f=this.model.parameters.find(g=>g.name===m.parameter);f?.type===Kk.Trigger&&f.value&&(f.value=!1)}if(r.clampWhenFinished=!0,_s){const m=this.getState(a.destinationState,0);console.log(`Transition to ${a.destinationState} / ${m?.name}`,a,`
Timescale: `+r.timeScale,`
Normalized time: `+h.toFixed(3),`
Exit Time: `+u,a.hasExitTime)}this.transitionTo(a.destinationState,a.duration,a.offset);return}}else{this.transitionTo(a.destinationState,a.duration,a.offset);return}}r&&this.setTimescale(r,s);let o=!1;if(s.motion.isLooping&&r&&(r.time>=r.getClip().duration?(o=!0,r.reset(),r.time=0,r.play()):r.time<=0&&r.timeScale<0&&(o=!0,r.reset(),r.time=r.getClip().duration,r.play())),!o&&s&&!i&&r&&this.animator&&s.behaviours){const a=r?.getClip().duration,l=r.time/a,c=new gA(this._activeState,l,a,this._speed);for(const h of s.behaviours)h.instance&&((e=h.instance.onStateUpdate)==null||e.call(h.instance,this.animator,c,0))}}setTimescale(e,i){let s=i.speed??1;i.speedParameter&&(s*=this.getFloat(i.speedParameter)),s!==void 0&&(e.timeScale=s*this._speed)}getState(e,i){return typeof e=="number"&&(e==-1&&(e=this.model.layers[i].stateMachine.defaultState,e===void 0&&(_s&&console.warn("AnimatorController default state is undefined: ",this.model,"Layer: "+i),e=0)),e=this.model.layers[i].stateMachine.states[e]),e}releaseHeldActions(e){for(const i of this._heldActions)i.fadeOut(e);this._heldActions.length=0}transitionTo(e,i,s){var r,o,a,l,c,h,u,d;if(!this.animator)return;const m=0;if(e=this.getState(e,m),!(e!=null&&e.motion)||!e.motion.clip||!(e.motion.clip instanceof to))return;const f=this._activeState===e;if(f){const A=e.motion;if(!A.action_loopback&&A.clip){const x=this.rootMotionHandler?this.animator.gameObject.matrix.clone():null;this._mixer.uncacheAction(A.clip,this.animator.gameObject),x&&x.decompose(this.animator.gameObject.position,this.animator.gameObject.quaternion,this.animator.gameObject.scale),A.action_loopback=this.createAction(A.clip)}}if((r=this._activeState)!=null&&r.behaviours&&this._activeState.motion.action){const A=(o=this._activeState)==null?void 0:o.motion.clip.duration,x=this._activeState.motion.action.time/A,w=new gA(this._activeState,x,A,this._speed);for(const _ of this._activeState.behaviours)(l=(a=_.instance)==null?void 0:a.onStateExit)==null||l.call(_.instance,this.animator,w,m)}const g=(c=this._activeState)==null?void 0:c.motion.action;f&&(e.motion.action=e.motion.action_loopback,e.motion.action_loopback=g);const y=this._activeState;this._activeState=e;const v=(h=e.motion)==null?void 0:h.action,b=e.motion.clip;if(b?.duration<=0&&b.tracks.length<=0?g&&this._heldActions.push(g):g&&(g.fadeOut(i),this.releaseHeldActions(i)),v){if(s=Math.max(0,Math.min(1,s)),e.cycleOffsetParameter){let x=this.getFloat(e.cycleOffsetParameter);typeof x=="number"?(x<0&&(x+=1),s+=x,s%=1):_s&&console.warn("AnimatorController cycle offset parameter is not a number",e.cycleOffsetParameter)}else typeof e.cycleOffset=="number"&&(s+=e.cycleOffset,s%=1);v.isRunning()&&v.stop(),v.reset(),v.enabled=!0,this.setTimescale(v,e);const A=e.motion.clip.duration;if(v.time=f?0:s*A,v.timeScale<0&&(v.time=A-v.time),v.clampWhenFinished=!0,v.setLoop($y,0),i>0?v.fadeIn(i):v.weight=1,v.play(),this.rootMotionHandler&&this.rootMotionHandler.onStart(v),this._activeStates.includes(e)||this._activeStates.push(e),this._activeState.behaviours){const x=new gA(e,s,A,this._speed);for(const w of this._activeState.behaviours)(d=(u=w.instance)==null?void 0:u.onStateEnter)==null||d.call(w.instance,this.animator,x,m)}}else _s&&(e.__warned_no_motion||(e.__warned_no_motion=!0,console.warn("No action",e.motion,this)));_s&&console.log("TRANSITION FROM "+y?.name+" TO "+e.name,i,g,v,v?.getEffectiveTimeScale(),v?.getEffectiveWeight(),v?.isRunning(),v?.isScheduled(),v?.paused)}createAction(e){var i,s;if(this._mixer.existingAction(e)&&this._mixer.uncacheAction(e,(i=this.animator)==null?void 0:i.gameObject),(s=this.animator)!=null&&s.applyRootMotion){this.rootMotionHandler||(this.rootMotionHandler=new h0e(this));const r=this.animator.gameObject;return this.rootMotionHandler.createClip(this._mixer,r,e)}else return this._mixer.clipAction(e)}evaluateCondition(e){const i=this.model.parameters.find(s=>s.name===e.parameter);if(!i)return!1;switch(e.mode){case Md.If:return i.value===!0;case Md.IfNot:return i.value===!1;case Md.Greater:return i.value>e.threshold;case Md.Less:return i.value<e.threshold;case Md.Equals:return i.value===e.threshold;case Md.NotEqual:return i.value!==e.threshold}return!1}createActions(e){var i,s,r,o;_s&&console.log("AnimatorController createActions",this.model);for(const a of this.model.layers){const l=a.stateMachine;for(let c=0;c<l.states.length;c++){const h=l.states[c];h.transitions||(h.transitions=[]);for(const u of h.transitions)u.conditions||(u.conditions=[]);if(h.motion||(_s&&console.warn("No motion",h),h.motion=Zj(h.name)),this.animator&&h.motion.clips){const u=(i=h.motion.clips)==null?void 0:i.find(d=>{var m,f;return d.node.name===((f=(m=this.animator)==null?void 0:m.gameObject)==null?void 0:f.name)});u?h.motion.clip=u.clip:(_s||Ye())&&console.warn('Could not find clip for animator "'+((r=(s=this.animator)==null?void 0:s.gameObject)==null?void 0:r.name)+'"',h.motion.clips.map(d=>d.node.name))}if(!h.motion.clip){_s&&console.warn("No clip assigned to state",h);const u=new to(void 0,void 0,[]);h.motion.clip=u}if((o=h.motion)!=null&&o.clip){const u=h.motion.clip;if(u instanceof to){const d=this.createAction(u);h.motion.action=d}else(_s||Ye())&&console.warn("No valid animationclip assigned",h)}if(h.behaviours&&Array.isArray(h.behaviours))for(const u of h.behaviours){if(!(u!=null&&u.typeName))continue;const d=Z.get(u.typeName);if(d){const m=new d;m.isStateMachineBehaviour&&(m._context=this.context??void 0,a0(m,u.properties),u.instance=m),_s&&console.log("Created animator controller behaviour",h.name,u.typeName,u.properties,m)}else(_s||Ye())&&console.warn("Could not find AnimatorBehaviour type: "+u.typeName)}}}}*enumerateActions(){if(this.model.layers)for(const e of this.model.layers){const i=e.stateMachine;for(let s=0;s<i.states.length;s++){const r=i.states[s];r!=null&&r.motion&&(r.motion.action&&(yield r.motion.action),r.motion.action_loopback&&(yield r.motion.action_loopback))}}}}class Yj{constructor(e,i){p(this,"track"),p(this,"createdInterpolant"),p(this,"originalEvaluate"),p(this,"customEvaluate"),this.track=e;const s=e,r=s.createInterpolant.bind(e);s.createInterpolant=()=>(s.createInterpolant=r,this.createdInterpolant=r(),this.originalEvaluate=this.createdInterpolant.evaluate.bind(this.createdInterpolant),this.customEvaluate=o=>{if(!this.originalEvaluate)return;const a=this.originalEvaluate(o);return i(o,a)},this.createdInterpolant.evaluate=this.customEvaluate,this.createdInterpolant)}dispose(){this.createdInterpolant&&this.originalEvaluate&&(this.createdInterpolant.evaluate=this.originalEvaluate),this.track=void 0,this.createdInterpolant=null,this.originalEvaluate=void 0,this.customEvaluate=void 0}}const Fs=class{constructor(n,e,i,s,r){if(p(this,"_action"),p(this,"root"),p(this,"clip"),p(this,"positionWrapper",null),p(this,"rotationWrapper",null),p(this,"context"),p(this,"positionChange",new E),p(this,"rotationChange",new Se),p(this,"_prevTime",0),this.context=n,this.root=e,this.clip=i,Fs.firstKeyframeRotation[this.cacheId]||(Fs.firstKeyframeRotation[this.cacheId]=new Se),r){const o=r.values;Fs.firstKeyframeRotation[this.cacheId].set(o[0],o[1],o[2],o[3])}Fs.spaceRotation[this.cacheId]||(Fs.spaceRotation[this.cacheId]=new Se),Fs.effectiveSpaceRotation[this.cacheId]||(Fs.effectiveSpaceRotation[this.cacheId]=new Se),Fs.clipOffsetRotation[this.cacheId]=new Se,r&&Fs.clipOffsetRotation[this.cacheId].set(r.values[0],r.values[1],r.values[2],r.values[3]).invert(),this.handlePosition(i,s),this.handleRotation(i,r)}set action(n){this._action=n}get action(){return this._action}get cacheId(){return this.root.uuid}onStart(n){if(n.getClip()!==this.clip)return;Fs.lastObjRotation[this.cacheId]||(Fs.lastObjRotation[this.cacheId]=this.root.quaternion.clone());const e=Fs.lastObjRotation[this.cacheId];if(Fs.spaceRotation[this.cacheId].copy(e),QC){const i=new si().setFromQuaternion(e);console.log("START",this.clip.name,tt.toDegrees(i.y),this.root.position.z)}}getClipRotationOffset(){return Fs.clipOffsetRotation[this.cacheId]}handlePosition(n,e){if(e){const i=this.root;QC&&i.add(new io),Fs.lastObjPosition[this.cacheId]||(Fs.lastObjPosition[this.cacheId]=this.root.position.clone());const s=new E,r=new E;this.positionWrapper=new Yj(e,(o,a)=>{const l=this.action.getEffectiveWeight();return QC&&i.position.length()>8&&i.position.set(0,i.position.y,0),o>this._prevTime&&(s.set(a[0],a[1],a[2]),s.sub(r),s.multiplyScalar(l),s.applyQuaternion(this.getClipRotationOffset()),s.applyQuaternion(i.quaternion),this.positionChange.copy(s)),r.fromArray(a),this._prevTime=o,a[0]=0,a[1]=0,a[2]=0,a})}}handleRotation(n,e){if(e){if(QC){const o=e.values,a=new si().setFromQuaternion(new Se(o[0],o[1],o[2],o[3]));console.log(n.name,e.name,"FIRST ROTATION IN TRACK",tt.toDegrees(a.y));const l=e.values.length-4,c=new Se().set(o[l],o[l+1],o[l+2],o[l+3]),h=new si().setFromQuaternion(c);console.log(n.name,e.name,"LAST ROTATION IN TRACK",tt.toDegrees(h.y))}let i=0;const s=new Se,r=new Se;this.rotationWrapper=new Yj(e,(o,a)=>(o>i&&(r.set(a[0],a[1],a[2],a[3]),s.invert(),r.multiply(s),this.rotationChange.copy(r)),s.fromArray(a),i=o,a[0]=0,a[1]=0,a[2]=0,a[3]=1,a))}}onBeforeUpdate(n){this.positionChange.set(0,0,0),this.rotationChange.set(0,0,0,1)}onAfterUpdate(n){return!this.action||(n*=this.action.getEffectiveWeight(),n<=0)?!1:(this.positionChange.multiplyScalar(n),this.rotationChange.slerp(Fs.identityQuaternion,1-n),!0)}};let Ed=Fs;p(Ed,"lastObjPosition",{}),p(Ed,"lastObjRotation",{}),p(Ed,"firstKeyframeRotation",{}),p(Ed,"spaceRotation",{}),p(Ed,"effectiveSpaceRotation",{}),p(Ed,"clipOffsetRotation",{}),p(Ed,"identityQuaternion",new Se);class h0e{constructor(e){p(this,"controller"),p(this,"handler",[]),p(this,"root"),p(this,"basePosition",new E),p(this,"baseQuaternion",new Se),p(this,"baseRotation",new si),p(this,"summedPosition",new E),p(this,"summedRotation",new Se),this.controller=e}createClip(e,i,s){this.root=i,i&&"name"in i&&i.name;const r=this.findRootTrack(s,".position"),o=this.findRootTrack(s,".quaternion"),a=new Ed(this.controller.context,i,s,r,o);this.handler.push(a);const l=e.clipAction(s);return a.action=l,l}onStart(e){for(const i of this.handler)i.onStart(e)}onBeforeUpdate(e){this.basePosition.copy(this.root.position),this.baseQuaternion.copy(this.root.quaternion);for(const i of this.handler)i.onBeforeUpdate(e)}onAfterUpdate(e){if(!(e<=0)){this.root.position.copy(this.basePosition),this.root.quaternion.copy(this.baseQuaternion),this.summedPosition.set(0,0,0),this.summedRotation.set(0,0,0,1);for(const i of this.handler)i.onAfterUpdate(e)&&(this.summedPosition.add(i.positionChange),this.summedRotation.multiply(i.rotationChange));this.root.position.add(this.summedPosition),this.root.quaternion.multiply(this.summedRotation)}}findRootTrack(e,i){const s=e.tracks;if(!s)return null;for(const r of s)if(r.name.endsWith(i))return r;return null}}class u0e extends Wa{onSerialize(e,i){}onDeserialize(e,i){if(i.type===Sa&&e?.__type==="AnimatorController")return new Sa(e)}}new u0e(Sa);var d0e=Object.defineProperty,p0e=Object.getOwnPropertyDescriptor,ZC=(n,e,i,s)=>{for(var r=s>1?void 0:s?p0e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&d0e(e,i,r),r};const Qa=te("debuganimator");class rr extends Pe{constructor(){super(...arguments),p(this,"applyRootMotion",!1),p(this,"hasRootMotion",!1),p(this,"keepAnimatorControllerStateOnDisable",!1),p(this,"_parametersAreDirty",!1),p(this,"_isDirty",!1),p(this,"_speed",1),p(this,"_normalizedStartOffset",0),p(this,"_animatorController",null),p(this,"_initializeWithRuntimeAnimatorController")}get isAnimationComponent(){return!0}set runtimeAnimatorController(e){var i;this._animatorController&&this._animatorController.model===e||(e?e instanceof Sa?(e.animator&&e.animator!==this&&(console.warn("AnimatorController can not be bound to multiple animators",(i=e.model)==null?void 0:i.name),e.model||console.error("AnimatorController has no model"),e=new Sa(e.model)),this._animatorController=e,this._animatorController.bind(this)):(Qa&&console.log("Assign animator controller",e,this),this._animatorController=new Sa(e),this.__didAwake&&this._animatorController.bind(this)):this._animatorController=null)}get runtimeAnimatorController(){return this._animatorController}getCurrentStateInfo(){var e;return(e=this.runtimeAnimatorController)==null?void 0:e.getCurrentStateInfo()}get currentAction(){var e;return((e=this.runtimeAnimatorController)==null?void 0:e.currentAction)||null}get parametersAreDirty(){return this._parametersAreDirty}get isDirty(){return this._isDirty}Play(e,i=-1,s=Number.NEGATIVE_INFINITY,r=0){this.play(e,i,s,r)}play(e,i=-1,s=Number.NEGATIVE_INFINITY,r=0){var o;(o=this.runtimeAnimatorController)==null||o.play(e,i,s,r),this._isDirty=!0}Reset(){this.reset()}reset(){var e;(e=this._animatorController)==null||e.reset(),this._isDirty=!0}SetBool(e,i){this.setBool(e,i)}setBool(e,i){var s,r;Qa&&console.log("setBool",e,i),((s=this.runtimeAnimatorController)==null?void 0:s.getBool(e))!==i&&(this._parametersAreDirty=!0),(r=this.runtimeAnimatorController)==null||r.setBool(e,i)}GetBool(e){return this.getBool(e)}getBool(e){var i;const s=((i=this.runtimeAnimatorController)==null?void 0:i.getBool(e))??!1;return Qa&&console.log("getBool",e,s),s}toggleBool(e){this.setBool(e,!this.getBool(e))}SetFloat(e,i){this.setFloat(e,i)}setFloat(e,i){var s,r;((s=this.runtimeAnimatorController)==null?void 0:s.getFloat(e))!==i&&(this._parametersAreDirty=!0),Qa&&console.log("setFloat",e,i),(r=this.runtimeAnimatorController)==null||r.setFloat(e,i)}GetFloat(e){return this.getFloat(e)}getFloat(e){var i;const s=((i=this.runtimeAnimatorController)==null?void 0:i.getFloat(e))??-1;return Qa&&console.log("getFloat",e,s),s}SetInteger(e,i){this.setInteger(e,i)}setInteger(e,i){var s,r;((s=this.runtimeAnimatorController)==null?void 0:s.getInteger(e))!==i&&(this._parametersAreDirty=!0),Qa&&console.log("setInteger",e,i),(r=this.runtimeAnimatorController)==null||r.setInteger(e,i)}GetInteger(e){return this.getInteger(e)}getInteger(e){var i;const s=((i=this.runtimeAnimatorController)==null?void 0:i.getInteger(e))??-1;return Qa&&console.log("getInteger",e,s),s}SetTrigger(e){this.setTrigger(e)}setTrigger(e){var i;this._parametersAreDirty=!0,Qa&&console.log("setTrigger",e),(i=this.runtimeAnimatorController)==null||i.setTrigger(e)}ResetTrigger(e){this.resetTrigger(e)}resetTrigger(e){var i;this._parametersAreDirty=!0,Qa&&console.log("resetTrigger",e),(i=this.runtimeAnimatorController)==null||i.resetTrigger(e)}GetTrigger(e){this.getTrigger(e)}getTrigger(e){var i;const s=(i=this.runtimeAnimatorController)==null?void 0:i.getTrigger(e);return Qa&&console.log("getTrigger",e,s),s}IsInTransition(){return this.isInTransition()}isInTransition(){var e;return((e=this.runtimeAnimatorController)==null?void 0:e.isInTransition())??!1}SetSpeed(e){return this.setSpeed(e)}setSpeed(e){var i;e!==this._speed&&(Qa&&console.log("setSpeed",e),this._speed=e,((i=this._animatorController)==null?void 0:i.animator)==this&&this._animatorController.setSpeed(e))}set minMaxSpeed(e){var i;this._speed=tt.lerp(e.x,e.y,Math.random()),((i=this._animatorController)==null?void 0:i.animator)==this&&this._animatorController.setSpeed(this._speed)}set minMaxOffsetNormalized(e){var i;this._normalizedStartOffset=tt.lerp(e.x,e.y,Math.random()),((i=this.runtimeAnimatorController)==null?void 0:i.animator)==this&&(this.runtimeAnimatorController.normalizedStartOffset=this._normalizedStartOffset)}awake(){Qa&&console.log("ANIMATOR",this.name,this),this.gameObject&&this.initializeRuntimeAnimatorController()}initializeRuntimeAnimatorController(e=!1){const i=e||this.runtimeAnimatorController!==this._initializeWithRuntimeAnimatorController;if(this.runtimeAnimatorController&&i){const s=this.runtimeAnimatorController.clone();this._initializeWithRuntimeAnimatorController=s,s?(console.assert(this.runtimeAnimatorController!==s),this.runtimeAnimatorController=s,console.assert(this.runtimeAnimatorController===s),this.runtimeAnimatorController.bind(this),this.runtimeAnimatorController.setSpeed(this._speed),this.runtimeAnimatorController.normalizedStartOffset=this._normalizedStartOffset):console.warn("Could not clone animator controller",this.runtimeAnimatorController)}}onDisable(){var e;this.keepAnimatorControllerStateOnDisable||(e=this._animatorController)==null||e.reset()}onBeforeRender(){this._isDirty=!1,this._parametersAreDirty=!1,!l0e(this.gameObject)&&this._animatorController&&this._animatorController.update(1)}}ZC([T()],rr.prototype,"applyRootMotion",2),ZC([T()],rr.prototype,"hasRootMotion",2),ZC([T()],rr.prototype,"keepAnimatorControllerStateOnDisable",2),ZC([T()],rr.prototype,"runtimeAnimatorController",1);const xc=te("debugusdzanimation"),Jk=te("debugusdzanimationserialization");class YC{constructor(e,i,s){p(this,"_start"),p(this,"ext"),p(this,"root"),p(this,"clip"),p(this,"speed"),this.ext=e,this.root=i,this.clip=s}get start(){return this._start===void 0&&(this._start=this.ext.getStartTime01(this.root,this.clip)),this._start}get duration(){var e;return((e=this.clip)==null?void 0:e.duration)??Ns.restPoseClipDuration}}const Kj=class{constructor(n,e,i){p(this,"clip"),p(this,"pos"),p(this,"rot"),p(this,"scale"),p(this,"root"),p(this,"target"),p(this,"duration",0),p(this,"useRootMotion",!1),this.root=n,this.target=e,this.clip=i,i?this.duration=i.duration:this.duration=Kj.restPoseClipDuration;const s=ie.getComponent(n,rr);s&&(this.useRootMotion=s.applyRootMotion)}get frameRate(){return 60}addTrack(n){var e,i;if(!this.clip){console.error("This is a rest clip but you're trying to add tracks to it \u2013 this is likely a bug");return}n.name.endsWith("position")?this.pos=n:n.name.endsWith("quaternion")?this.rot=n:n.name.endsWith("scale")?this.scale=n:(n.name.endsWith("activeSelf")?console.warn("[USDZ] Animation of enabled/disabled state is not supported for USDZ export and will NOT be exported: "+n.name+" on "+(((e=this.root)==null?void 0:e.name)??this.target.name)+". Animate scale 0/1 instead."):console.warn("[USDZ] Animation track type not supported for USDZ export and will NOT be exported: "+n.name+" on "+(((i=this.root)==null?void 0:i.name)??this.target.name)+". Only .position, .rotation, .scale are supported."),Ye()&&zi("[USDZ] Some animations can't be exported. See console for details."))}getFrames(){var n,e,i,s,r,o;return this.clip?Math.max(((e=(n=this.pos)==null?void 0:n.times)==null?void 0:e.length)??0,((s=(i=this.rot)==null?void 0:i.times)==null?void 0:s.length)??0,((o=(r=this.scale)==null?void 0:r.times)==null?void 0:o.length)??0):2}getDuration(){return this.duration}getSortedTimesArray(n=!0,e=!0,i=!0){var s,r,o;if(!this.clip)return[0,this.duration];const a=(s=this.pos)==null?void 0:s.times,l=(r=this.rot)==null?void 0:r.times,c=(o=this.scale)==null?void 0:o.times,h=[];if(n&&a)for(const u of a)h.push(u);if(e&&l)for(const u of l)h.push(u);if(i&&c)for(const u of c)h.push(u);return h.includes(0)||h.push(0),h.sort((u,d)=>u-d),[...new Set(h)]}*getValues(n,e=!0,i=!0,s=!0){var r,o,a;const l=new E,c=new Se,h=new E(1,1,1),u=this.target,d=e?(r=this.pos)==null?void 0:r.createInterpolant():void 0,m=i?(o=this.rot)==null?void 0:o.createInterpolant():void 0,f=s?(a=this.scale)==null?void 0:a.createInterpolant():void 0;d||l.set(u.position.x,u.position.y,u.position.z),m||c.set(u.quaternion.x,u.quaternion.y,u.quaternion.z,u.quaternion.w),f||h.set(u.scale.x,u.scale.y,u.scale.z);for(let g=0;g<n.length;g++){const y=n[g];if(d){const v=d.evaluate(y);l.set(v[0],v[1],v[2])}if(m){const v=m.evaluate(y);c.set(v[0],v[1],v[2],v[3])}if(f){const v=f.evaluate(y);h.set(v[0],v[1],v[2])}if(this.useRootMotion&&u===this.root){const v=new he;v.compose(l,c,h),v.multiply(u.matrix),v.decompose(l,c,h)}yield{time:y,translation:l,rotation:c,scale:h,index:g}}}};let Ns=Kj;p(Ns,"animationDurationPadding",1/60),p(Ns,"restPoseClipDuration",1/60);class yA{constructor(e){p(this,"dict",new Map),p(this,"rootTargetMap",new Map),p(this,"rootAndClipToRegisteredAnimationMap",new Map),p(this,"rootToRegisteredClip",new Map),p(this,"serializers",[]),p(this,"injectRestPoses",!1),p(this,"injectImplicitBehaviours",!1),this.injectRestPoses=e,this.injectImplicitBehaviours=e}get extensionName(){return"animation"}getStartTimeCode(){return!this.injectRestPoses||this.rootAndClipToRegisteredAnimationMap.size===0?0:(Ns.restPoseClipDuration+Ns.animationDurationPadding)*60}getEndTimeCode(){let e=0;for(const[i,s]of this.rootAndClipToRegisteredAnimationMap){const r=s.start+s.duration;r>e&&(e=r)}return e*60}getClipCount(e){var i;return((i=this.rootToRegisteredClip.get(e))==null?void 0:i.length)??0??0}getStartTime01(e,i){if(!i)return 0;const s=this.rootTargetMap.get(e);if(!s)return 0;const r=this.dict.get(s[0]);if(!r)return console.error("Trying to get start time for root that has no animation data",e,i,...this.dict),0;let o=0;for(let a=0;a<r.length&&r[a].clip!==i;a++)o+=r[a].getDuration()+Ns.animationDurationPadding;return o}registerAnimation(e,i){var s;if(!e)return null;this.rootTargetMap.has(e)||this.rootTargetMap.set(e,[]);const r=e.uuid+(i?.uuid??"-rest");if(this.rootAndClipToRegisteredAnimationMap.has(r))return this.rootAndClipToRegisteredAnimationMap.get(r);xc&&console.log("registerAnimation",e,i);const o=this.injectRestPoses?1:0,a=(((s=this.rootToRegisteredClip.get(e))==null?void 0:s.length)??0)+o,l=this.rootTargetMap.get(e),c=new Set(l);if(i&&i.tracks)for(const u of i.tracks){const d=Jt.parseTrackName(u.name),m=Jt.findNode(e,d.nodeName);if(!m){console.warn("no object found for track",u.name,"using "+e.name+" instead");continue}this.dict.has(m)||this.dict.set(m,[]);const f=this.dict.get(m);if(!f){console.warn("no transform data found for target ",m,"at slot "+a+", this is likely a bug");continue}c.delete(m),this.injectRestPoses&&!f[0]&&(f[0]=new Ns(null,m,null));let g=f[a];g||(g=new Ns(e,m,i),f[a]=g),g.addTrack(u),l!=null&&l.includes(m)||l==null||l.push(m)}xc&&console.log("Unregistered nodes for this clip",c,"clip",i,"at slot",a,"for root",e,"targets",l);for(const u of c){const d=this.dict.get(u);if(!d)continue;if(this.injectRestPoses&&!d[0]){console.warn("Adding rest pose for ",u,i,"at slot",a,"This is likely a bug, should have been added earlier.");const f=new Ns(null,u,null);d[0]=f}let m=d[a];m||(xc&&console.log("Adding padding clip for ",u,i,"at slot",a),m=new Ns(e,u,i),d[a]=m)}const h=new YC(this,e,i);if(this.rootAndClipToRegisteredAnimationMap.set(r,h),xc&&console.log({root:e,clip:i,info:h}),i){const u=this.rootToRegisteredClip.get(e);u?u.push(i):this.rootToRegisteredClip.set(e,[i])}return h}onAfterHierarchy(e){xc&&console.log("Animation clips per animation target node",this.dict)}onAfterBuildDocument(e){var i,s;xc&&console.log("Animation data",{dict:this.dict,rootTargetMap:this.rootTargetMap,rootToRegisteredClip:this.rootToRegisteredClip});for(const r of this.rootTargetMap.keys()){const o=this.rootTargetMap.get(r);if(!o)continue;let a;const l=[];for(const c of o){const h=this.dict.get(c);if(!h){console.error("No data found for target on USDZ export \u2013 please report a bug!",c);continue}a===void 0&&(a=h?.length),a!==h?.length&&console.error("Different array lengths for targets \u2013 please report a bug!",h);for(let u=0;u<h.length;u++){let d=h[u];if(!d){const f=u-(this.injectRestPoses?1:0);h[u]=new Ns(null,c,this.rootToRegisteredClip.get(r)[f]),d=h[u]}const m=d.getDuration();if(l[u]===void 0)l[u]=m;else if(l[u]!==m){console.error("Error during UDSZ export: Encountered different animation durations for animated targets. Please report a bug!",{datas:h,target:c}),l[u]=m;continue}}}}for(const r of this.serializers){const o=(i=r.model)==null?void 0:i.parent,a=o?.isDynamic===!0;Jk&&console.log(a,(s=r.model)==null?void 0:s.parent),a&&r.registerCallback(o)}}onExportObject(e,i,s){ie.foreachComponent(e,o=>{const a=o;typeof a.createAnimation=="function"&&a.createAnimation(this,i,s)},!1);const r=new m0e(e,this.dict);this.serializers.push(r),r.registerCallback(i)}}class m0e{constructor(e,i){p(this,"object"),p(this,"dict"),p(this,"model"),p(this,"callback"),this.object=e,this.dict=i}registerCallback(e){this.model&&this.callback&&this.model.removeEventListener("serialize",this.callback),this.callback||(this.callback=this.onSerialize.bind(this)),Jk&&console.log("REPARENT",e),this.model=e,this.callback&&this.model.addEventListener("serialize",this.callback)}skinnedMeshExport(e,i){var s;const r=this.model,o=this.dict;if(r&&r.skinnedMesh){let a=function(L){const B=[];for(const[z,D]of L){let W=`${z} : [`;const O=[];for(const F of D)O.push(`(${li(F.x)}, ${li(F.y)}, ${li(F.z)})`);W=W.concat(O.join(", ")),W=W.concat("],"),B.push(W)}return B},l=function(L){const B=[];for(const[z,D]of L){let W=`${z} : [`;const O=[];for(const F of D)O.push(`(${li(F.w)}, ${li(F.x)}, ${li(F.y)}, ${li(F.z)})`);W=W.concat(O.join(", ")),W=W.concat("],"),B.push(W)}return B},c=function(L){let B,z=!0;const D=new Map;for(const[O,F]of L){B===void 0&&(B=F.length),B!==F.length&&(z=!1);let X=0;for(const J of F)X++,J||(D.has(O)||D.set(O,[]),D.get(O).push(X))}xc&&console.log("Bone count: ",L.size,"TransformData entries per bone: ",B,"Undefined bone entries: ",D),console.assert(z,"All bones should have the same number of TransformData entries",L),console.assert(D.size===0,"All TransformData entries should be set",D);const W=[];for(const[O,F]of L){const X=new Array;let J=0;for(let q=0;q<F.length;q++)X.push(J),J+=F[q].getDuration()+Ns.animationDurationPadding;for(let q=0;q<F.length;q++){const oe=F[q],_e=X[q];W.length<=q&&W.push({pos:[],rot:[],scale:[],timeOffset:_e});const ke=W[q];ke.pos.push(...oe.getSortedTimesArray(!0,!1,!1)),ke.rot.push(...oe.getSortedTimesArray(!1,!0,!1)),ke.scale.push(...oe.getSortedTimesArray(!1,!1,!0))}}for(const O of W)O.pos.sort((F,X)=>F-X),O.rot.sort((F,X)=>F-X),O.scale.sort((F,X)=>F-X),O.pos=[...new Set(O.pos)],O.rot=[...new Set(O.rot)],O.scale=[...new Set(O.scale)];return W},h=function(L,B,z){const D=new Map,W=new Map,O=new Map,F=B.length;for(const X of z){const J=L.get(X);let q;J?console.assert(J.length===F,"We should have the same number of TransformData entries for each bone",J,B):q=new Ns(null,X,null);for(let oe=0;oe<F;oe++){const _e=J?J[oe]:q,ke=B[oe];for(const{time:re,translation:we}of _e.getValues(ke.pos,!0,!1,!1)){const Me=(re+ke.timeOffset)*60;D.has(Me)||D.set(Me,new Array),D.get(Me).push(we.clone())}for(const{time:re,rotation:we}of _e.getValues(ke.rot,!1,!0,!1)){const Me=(re+ke.timeOffset)*60;W.has(Me)||W.set(Me,new Array),W.get(Me).push(we.clone())}for(const{time:re,scale:we}of _e.getValues(ke.scale,!1,!1,!0)){const Me=(re+ke.timeOffset)*60;O.has(Me)||O.set(Me,new Array),O.get(Me).push(we.clone())}}}return{position:D.size==0?void 0:D,quaternion:W.size==0?void 0:W,scale:O.size==0?void 0:O}},u=function(L){const B=[];for(const z of L)B.push(`(${li(z.x)}, ${li(z.y)}, ${li(z.z)})`);return B.join(", ")},d=function(L){const B=[];for(const z of L)B.push(`(${li(z.w)}, ${li(z.x)}, ${li(z.y)}, ${li(z.z)})`);return B.join(", ")},m=function(L){const B=new Map;if(xc){const z=new Array;for(const[D,W]of o)z.push(D.uuid+": "+W.length+" "+W.map(O=>{var F;return(F=O.clip)==null?void 0:F.uuid.substring(0,6)}).join(" "));console.log(`getPerBoneTransformData
`+z.join(`
`))}for(const z of L){const D=o.get(z);D&&B.set(z,D)}return B},f=function(L){const B=m(L),z=c(B);return h(B,z,L)};const g=r.skinnedMesh.skeleton,y=new Array,v=[],b=[];for(const L of g.bones)if(L.parent.type!=="Bone"){v.push(L);const B=g.boneInverses[g.bones.indexOf(L)];y.push({bone:L,inverse:B}),b.push(L.uuid)}for(;b.length<g.bones.length;)for(const L of v){const B=L.children;for(const z of B)if(b.indexOf(z.uuid)===-1&&g.bones.indexOf(z)!==-1){v.push(z);const D=g.boneInverses[g.bones.indexOf(z)];y.push({bone:z,inverse:D}),b.push(z.uuid)}}for(const L of Sj(g.bones))y.push({bone:L,inverse:L.matrixWorld.clone().invert()});const A=y[0].bone.parent;A||console.error("No bone parent found for skinned mesh during USDZ export",r.skinnedMesh),y.sort((L,B)=>x0(L.bone,A)>x0(B.bone,A)?1:-1);const x=i.quickLookCompatible,w=[],_=[],S=[],M=[];for(const{bone:L}of y){if(x){const B=L.scale;B.x==0&&(B.x=1e-5),B.y==0&&(B.y=1e-5),B.z==0&&(B.z=1e-5),w.push(new he().compose(L.position,L.quaternion,L.scale))}else w.push(L.matrix.clone());_.push(L.position),S.push(L.quaternion),M.push(L.scale)}const R=y.map(L=>'"'+x0(L.bone,A)+'"').join(", "),P=y.map(L=>Dj(L.inverse.clone().invert())).join(", ");e.beginBlock('def Skeleton "Rig"'),e.appendLine(`uniform matrix4d[] bindTransforms = [${P}]`),e.appendLine(`uniform token[] joints = [${R}]`),e.appendLine('uniform token purpose = "guide"'),e.appendLine(`uniform matrix4d[] restTransforms = [${w.map(L=>Dj(L)).join(", ")}]`);const C=f(y.map(L=>L.bone));if(xc){let L=1e7,B=0;for(const z of((s=C.position)==null?void 0:s.keys())??[])L=Math.min(L,z),B=Math.max(B,z);console.log("Time samples",L,B,C)}if(e.beginBlock('def SkelAnimation "_anim"'),e.appendLine(`uniform token[] joints = [${R}]`),e.appendLine(`quatf[] rotations = [${d(S)}]`),C&&C.quaternion){e.beginBlock("quatf[] rotations.timeSamples = {","");const L=l(C.quaternion);for(const B of L)e.appendLine(B);e.closeBlock()}if(e.appendLine(`half3[] scales = [${u(M)}]`),C&&C.scale){e.beginBlock("half3[] scales.timeSamples = {","");const L=a(C.scale);for(const B of L)e.appendLine(B);e.closeBlock()}if(e.appendLine(`float3[] translations = [${u(_)}]`),C&&C.position){e.beginBlock("float3[] translations.timeSamples = {","");const L=a(C.position);for(const B of L)e.appendLine(B);e.closeBlock()}e.closeBlock(),e.closeBlock()}}onSerialize(e,i){if(!this.model)return;const s=this.dict.get(this.object);if(s)for(let d=0;d<s.length;d++)s[d]===void 0&&(s[d]=new Ns(null,this.object,null));this.skinnedMeshExport(e,i);const r=this.object,o=this.model,a=this.dict.get(r);if(!a||r.isSkinnedMesh)return;Jk&&console.log("SERIALIZE",this.model.name,this.object.type,a);const l=new Array;let c=0;for(let d=0;d<a.length;d++){if(l.push(c),a[d]===void 0){console.error("Got an undefined transform data, this is likely a bug.",r,a);continue}c+=a[d].getDuration()+Ns.animationDurationPadding}const h=Intl.NumberFormat("en-US",{maximumFractionDigits:3,minimumFractionDigits:0,useGrouping:!1});function u(d,m){var f;if(d.some(g=>g&&{position:g.pos,rotation:g.rot,scale:g.scale}[m])){switch(m){case"position":o.needsTranslate=!0,e.beginBlock("double3 xformOp:translate.timeSamples = {","");break;case"rotation":o.needsOrient=!0,e.beginBlock("quatf xformOp:orient.timeSamples = {","");break;case"scale":o.needsScale=!0,e.beginBlock("double3 xformOp:scale.timeSamples = {","");break}for(let g=0;g<d.length;g++){const y=d[g];if(!y)continue;const v=l[g],b=y.getSortedTimesArray(m==="position",m==="rotation",m==="scale");if(!b||b.length===0){console.error("got an animated object but no time values?",r,y);continue}{const A=((f=y.clip)==null?void 0:f.name)??"rest",x=y.getDuration();xc&&console.log("Write .timeSamples:",A,v,x,d),e.appendLine("# "+A+": start="+h.format(v*y.frameRate)+", length="+h.format(x*y.frameRate)+", frames="+y.getFrames())}if(m==="position"&&y.pos)for(const{time:A,translation:x}of y.getValues(b,!0,!1,!1)){const w=`${h.format((v+A)*y.frameRate)}: (${li(x.x)}, ${li(x.y)}, ${li(x.z)}),`;e.appendLine(w)}if(m==="rotation"&&y.rot)for(const{time:A,rotation:x}of y.getValues(b,!1,!0,!1)){const w=`${h.format((v+A)*y.frameRate)}: (${li(x.w)}, ${li(x.x)}, ${li(x.y)}, ${li(x.z)}),`;e.appendLine(w)}if(m==="scale"&&y.scale)for(const{time:A,scale:x}of y.getValues(b,!1,!1,!0)){const w=`${h.format((v+A)*y.frameRate)}: (${li(x.x)}, ${li(x.y)}, ${li(x.z)}),`;e.appendLine(w)}}e.closeBlock()}}u(a,"position"),u(a,"rotation"),u(a,"scale")}}class f0e extends mn{constructor(e,i=1,s=16,r=2){const o=new dt,a=s+r*2,l=new Float32Array((a*3+3)*3);o.setAttribute("position",new qe(l,3));const c=new Vi({color:65280}),h=new Vi({color:16776960});super(o,[h,c]),this.audio=e,this.range=i,this.divisionsInnerAngle=s,this.divisionsOuterAngle=r,this.type="PositionalAudioHelper",this.update()}update(){const e=this.audio,i=this.range,s=this.divisionsInnerAngle,r=this.divisionsOuterAngle,o=oi.degToRad(e.panner.coneInnerAngle),a=oi.degToRad(e.panner.coneOuterAngle),l=o/2,c=a/2;let h=0,u=0,d,m;const f=this.geometry,g=f.attributes.position;f.clearGroups();function y(v,b,A,x){const w=(b-v)/A;for(g.setXYZ(h,0,0,0),u++,d=v;d<b;d+=w)m=h+u,g.setXYZ(m,Math.sin(d)*i,0,Math.cos(d)*i),g.setXYZ(m+1,Math.sin(Math.min(d+w,b))*i,0,Math.cos(Math.min(d+w,b))*i),g.setXYZ(m+2,0,0,0),u+=3;f.addGroup(h,u,x),h+=u,u=0}y(-c,-l,r,0),y(-l,l,s,1),y(l,c,r,0),g.needsUpdate=!0,o===a&&(this.material[0].visible=!1)}dispose(){this.geometry.dispose(),this.material[0].dispose(),this.material[1].dispose()}}const Jj=Symbol("previous-visibility"),vA=class extends Zt{render(n,e,i){if(i instanceof yL)this._unsupported_effectcomposer_warning||(console.warn("RenderTexture.render() does not yet support EffectComposer"),this._unsupported_effectcomposer_warning=!0);else{this.onBeforeRender();const s=i.getRenderTarget(),r=i.xr.enabled;i.xr.enabled=!1,i.setRenderTarget(this),i.clear(!0,!0,!0),i.render(n,e),i.setRenderTarget(s),i.xr.enabled=r,this.onAfterRender()}}onBeforeRender(){vA._userSet.clear();const n=RB(this.texture,!0,null,vA._userSet);for(const e of n)e instanceof pe&&(e[Jj]=e.visible,e.visible=!1)}onAfterRender(){for(const n of vA._userSet)n instanceof pe&&(n.visible=n[Jj]);vA._userSet.clear()}};let C0=vA;p(C0,"_userSet",new Set);const qj={type:"change"},qk={type:"start"},$j={type:"end"},KC=new qr,eQ=new fs,g0e=Math.cos(70*oi.DEG2RAD);let tQ=class extends Rs{constructor(n,e){super(),this.object=n,this.domElement=e,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new E,this.cursor=new E,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:yp.ROTATE,MIDDLE:yp.DOLLY,RIGHT:yp.PAN},this.touches={ONE:vp.ROTATE,TWO:vp.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(I){I.addEventListener("keydown",ht),this._domElementKeyEvents=I},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",ht),this._domElementKeyEvents=null},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(qj),i.update(),r=s.NONE},this.update=function(){const I=new E,k=new Se().setFromUnitVectors(n.up,new E(0,1,0)),V=k.clone().invert(),ee=new E,U=new Se,K=new E,j=2*Math.PI;return function(ae=null){const ce=i.object.getWorldPosition(n.position);I.copy(ce).sub(i.target),I.applyQuaternion(k),a.setFromVector3(I),i.autoRotate&&r===s.NONE&&B(C(ae)),i.enableDamping?(a.theta+=l.theta*i.dampingFactor,a.phi+=l.phi*i.dampingFactor):(a.theta+=l.theta,a.phi+=l.phi);let xe=i.minAzimuthAngle,Ie=i.maxAzimuthAngle;isFinite(xe)&&isFinite(Ie)&&(xe<-Math.PI?xe+=j:xe>Math.PI&&(xe-=j),Ie<-Math.PI?Ie+=j:Ie>Math.PI&&(Ie-=j),xe<=Ie?a.theta=Math.max(xe,Math.min(Ie,a.theta)):a.theta=a.theta>(xe+Ie)/2?Math.max(xe,a.theta):Math.min(Ie,a.theta)),a.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,a.phi)),a.makeSafe(),i.enableDamping===!0?i.target.addScaledVector(u,i.dampingFactor):i.target.add(u),i.target.sub(i.cursor),i.target.clampLength(i.minTargetRadius,i.maxTargetRadius),i.target.add(i.cursor);let Ke=!1;if(i.zoomToCursor&&S||i.object.isOrthographicCamera)a.radius=q(a.radius);else{i.enableDamping?h=oi.lerp(h,c,i.dampingFactor):h=c;const Qe=a.radius;a.radius=q(a.radius*h),Ke=Qe!=a.radius}if(I.setFromSpherical(a),I.applyQuaternion(V),ce.copy(i.target).add(I),i.object.parent?i.object.parent.worldToLocal(ce):i.object.position.copy(ce),i.object.lookAt(i.target),i.enableDamping===!0?(l.theta*=1-i.dampingFactor,l.phi*=1-i.dampingFactor,u.multiplyScalar(1-i.dampingFactor)):(l.set(0,0,0),u.set(0,0,0)),i.zoomToCursor&&S){let Qe=null;if(i.object.isPerspectiveCamera){const $e=I.length();Qe=q($e*c);const bt=$e-Qe;i.object.position.addScaledVector(w,bt),i.object.updateMatrixWorld(),Ke=!!bt}else if(i.object.isOrthographicCamera){const $e=new E(_.x,_.y,0);$e.unproject(i.object);const bt=i.object.zoom;i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/c)),i.object.updateProjectionMatrix(),Ke=bt!==i.object.zoom;const ot=new E(_.x,_.y,0);ot.unproject(i.object),i.object.position.sub(ot).add($e),i.object.updateMatrixWorld(),Qe=I.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),i.zoomToCursor=!1;Qe!==null&&(this.screenSpacePanning?i.target.set(0,0,-1).transformDirection(i.object.matrix).multiplyScalar(Qe).add(i.object.position):(KC.origin.copy(i.object.position),KC.direction.set(0,0,-1).transformDirection(i.object.matrix),Math.abs(i.object.up.dot(KC.direction))<g0e?n.lookAt(i.target):(eQ.setFromNormalAndCoplanarPoint(i.object.up,i.target),KC.intersectPlane(eQ,i.target))))}else if(i.object.isOrthographicCamera){const Qe=i.object.zoom;i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/c)),Qe!==i.object.zoom&&(i.object.updateProjectionMatrix(),Ke=!0)}return c=1,S=!1,Ke||ee.distanceToSquared(i.object.position)>o||8*(1-U.dot(i.object.quaternion))>o||K.distanceToSquared(i.target)>o?(i.dispatchEvent(qj),ee.copy(i.object.position),U.copy(i.object.quaternion),K.copy(i.target),!0):!1}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",Ct),i.domElement.removeEventListener("pointerdown",ct),i.domElement.removeEventListener("pointercancel",H),i.domElement.removeEventListener("wheel",Ee),i.domElement.removeEventListener("pointermove",It),window.removeEventListener("pointerup",H),i.domElement.getRootNode().removeEventListener("keydown",Le,{capture:!0}),i._domElementKeyEvents!==null&&(i._domElementKeyEvents.removeEventListener("keydown",ht),i._domElementKeyEvents=null)};const i=this,s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let r=s.NONE;const o=1e-6,a=new iI,l=new iI;let c=1,h=1;const u=new E,d=new Y,m=new Y,f=new Y,g=new Y,y=new Y,v=new Y,b=new Y,A=new Y,x=new Y,w=new E,_=new Y;let S=!1;const M=[],R={};let P=!1;function C(I){return I!==null?2*Math.PI/60*i.autoRotateSpeed*I:2*Math.PI/60/60*i.autoRotateSpeed}function L(I){const k=Math.abs(I*.01);return Math.pow(.95,i.zoomSpeed*k)}function B(I){l.theta-=I}function z(I){l.phi-=I}const D=function(){const I=new E;return function(k,V){I.setFromMatrixColumn(V,0),I.multiplyScalar(-k),u.add(I)}}(),W=function(){const I=new E;return function(k,V){i.screenSpacePanning===!0?I.setFromMatrixColumn(V,1):(I.setFromMatrixColumn(V,0),I.crossVectors(i.object.up,I)),I.multiplyScalar(k),u.add(I)}}(),O=function(){const I=new E,k=new E;return function(V,ee){const U=i.domElement;if(i.object.isPerspectiveCamera){i.object.getWorldPosition(k),I.copy(k).sub(i.target);let K=I.length();K*=Math.tan(i.object.fov/2*Math.PI/180),D(2*V*K/U.clientHeight,i.object.matrixWorld),W(2*ee*K/U.clientHeight,i.object.matrixWorld)}else i.object.isOrthographicCamera?(D(V*(i.object.right-i.object.left)/i.object.zoom/U.clientWidth,i.object.matrixWorld),W(ee*(i.object.top-i.object.bottom)/i.object.zoom/U.clientHeight,i.object.matrixWorld)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function F(I){i.object.isPerspectiveCamera||i.object.isOrthographicCamera?c/=I:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function X(I){i.object.isPerspectiveCamera||i.object.isOrthographicCamera?c*=I:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function J(I,k){if(!i.zoomToCursor)return;S=!0;const V=i.domElement.getBoundingClientRect(),ee=I-V.left,U=k-V.top,K=V.width,j=V.height;_.x=ee/K*2-1,_.y=-(U/j)*2+1,w.set(_.x,_.y,1).unproject(i.object).sub(i.object.position).normalize()}function q(I){return Math.max(i.minDistance,Math.min(i.maxDistance,I))}function oe(I){d.set(I.clientX,I.clientY)}function _e(I){J(I.clientX,I.clientX),b.set(I.clientX,I.clientY)}function ke(I){g.set(I.clientX,I.clientY)}function re(I){m.set(I.clientX,I.clientY),f.subVectors(m,d).multiplyScalar(i.rotateSpeed);const k=i.domElement;B(2*Math.PI*f.x/k.clientHeight),z(2*Math.PI*f.y/k.clientHeight),d.copy(m),i.update()}function we(I){A.set(I.clientX,I.clientY),x.subVectors(A,b),x.y>0?F(L(x.y)):x.y<0&&X(L(x.y)),b.copy(A),i.update()}function Me(I){y.set(I.clientX,I.clientY),v.subVectors(y,g).multiplyScalar(i.panSpeed),O(v.x,v.y),g.copy(y),i.update()}function it(I){J(I.clientX,I.clientY),I.deltaY<0?X(L(I.deltaY)):I.deltaY>0&&F(L(I.deltaY)),i.update()}function je(I){let k=!1;switch(I.code){case i.keys.UP:I.ctrlKey||I.metaKey||I.shiftKey?z(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):O(0,i.keyPanSpeed),k=!0;break;case i.keys.BOTTOM:I.ctrlKey||I.metaKey||I.shiftKey?z(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):O(0,-i.keyPanSpeed),k=!0;break;case i.keys.LEFT:I.ctrlKey||I.metaKey||I.shiftKey?B(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):O(i.keyPanSpeed,0),k=!0;break;case i.keys.RIGHT:I.ctrlKey||I.metaKey||I.shiftKey?B(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):O(-i.keyPanSpeed,0),k=!0;break}k&&(I.preventDefault(),i.update())}function Ge(I){if(M.length===1)d.set(I.pageX,I.pageY);else{const k=ut(I),V=.5*(I.pageX+k.x),ee=.5*(I.pageY+k.y);d.set(V,ee)}}function rt(I){if(M.length===1)g.set(I.pageX,I.pageY);else{const k=ut(I),V=.5*(I.pageX+k.x),ee=.5*(I.pageY+k.y);g.set(V,ee)}}function ge(I){const k=ut(I),V=I.pageX-k.x,ee=I.pageY-k.y,U=Math.sqrt(V*V+ee*ee);b.set(0,U)}function Q(I){i.enableZoom&&ge(I),i.enablePan&&rt(I)}function Ne(I){i.enableZoom&&ge(I),i.enableRotate&&Ge(I)}function Re(I){if(M.length==1)m.set(I.pageX,I.pageY);else{const V=ut(I),ee=.5*(I.pageX+V.x),U=.5*(I.pageY+V.y);m.set(ee,U)}f.subVectors(m,d).multiplyScalar(i.rotateSpeed);const k=i.domElement;B(2*Math.PI*f.x/k.clientHeight),z(2*Math.PI*f.y/k.clientHeight),d.copy(m)}function Te(I){if(M.length===1)y.set(I.pageX,I.pageY);else{const k=ut(I),V=.5*(I.pageX+k.x),ee=.5*(I.pageY+k.y);y.set(V,ee)}v.subVectors(y,g).multiplyScalar(i.panSpeed),O(v.x,v.y),g.copy(y)}function We(I){const k=ut(I),V=I.pageX-k.x,ee=I.pageY-k.y,U=Math.sqrt(V*V+ee*ee);A.set(0,U),x.set(0,Math.pow(A.y/b.y,i.zoomSpeed)),F(x.y),b.copy(A);const K=(I.pageX+k.x)*.5,j=(I.pageY+k.y)*.5;J(K,j)}function be(I){i.enableZoom&&We(I),i.enablePan&&Te(I)}function nt(I){i.enableZoom&&We(I),i.enableRotate&&Re(I)}function ct(I){i.enabled!==!1&&(M.length===0&&(i.domElement.setPointerCapture(I.pointerId),i.domElement.addEventListener("pointermove",It),window.addEventListener("pointerup",H)),!Oe(I)&&(ze(I),I.pointerType==="touch"?Ue(I):G(I)))}function It(I){i.enabled!==!1&&(I.pointerType==="touch"?Xe(I):ue(I))}function H(I){switch(qt(I),M.length){case 0:i.domElement.releasePointerCapture(I.pointerId),i.domElement.removeEventListener("pointermove",It),i.domElement.removeEventListener("pointerup",H),i.dispatchEvent($j),r=s.NONE;break;case 1:const k=M[0],V=R[k];Ue({pointerId:k,pageX:V.x,pageY:V.y});break}}function G(I){let k;switch(I.button){case 0:k=i.mouseButtons.LEFT;break;case 1:k=i.mouseButtons.MIDDLE;break;case 2:k=i.mouseButtons.RIGHT;break;default:k=-1}switch(k){case yp.DOLLY:if(i.enableZoom===!1)return;_e(I),r=s.DOLLY;break;case yp.ROTATE:if(I.ctrlKey||I.metaKey||I.shiftKey){if(i.enablePan===!1)return;ke(I),r=s.PAN}else{if(i.enableRotate===!1)return;oe(I),r=s.ROTATE}break;case yp.PAN:if(I.ctrlKey||I.metaKey||I.shiftKey){if(i.enableRotate===!1)return;oe(I),r=s.ROTATE}else{if(i.enablePan===!1)return;ke(I),r=s.PAN}break;default:r=s.NONE}r!==s.NONE&&i.dispatchEvent(qk)}function ue(I){switch(r){case s.ROTATE:if(i.enableRotate===!1)return;re(I);break;case s.DOLLY:if(i.enableZoom===!1)return;we(I);break;case s.PAN:if(i.enablePan===!1)return;Me(I);break}}function Ee(I){i.enabled===!1||i.enableZoom===!1||r!==s.NONE||(I.preventDefault(),i.dispatchEvent(qk),it(De(I)),i.dispatchEvent($j))}function De(I){const k=I.deltaMode,V={clientX:I.clientX,clientY:I.clientY,deltaY:I.deltaY};switch(k){case 1:V.deltaY*=16;break;case 2:V.deltaY*=100;break}return I.ctrlKey&&!P&&(V.deltaY*=10),V}function Le(I){I.key==="Control"&&(P=!0,i.domElement.getRootNode().addEventListener("keyup",At,{passive:!0,capture:!0}))}function At(I){I.key==="Control"&&(P=!1,i.domElement.getRootNode().removeEventListener("keyup",At,{passive:!0,capture:!0}))}function ht(I){i.enabled===!1||i.enablePan===!1||je(I)}function Ue(I){switch(_t(I),M.length){case 1:switch(i.touches.ONE){case vp.ROTATE:if(i.enableRotate===!1)return;Ge(I),r=s.TOUCH_ROTATE;break;case vp.PAN:if(i.enablePan===!1)return;rt(I),r=s.TOUCH_PAN;break;default:r=s.NONE}break;case 2:switch(i.touches.TWO){case vp.DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;Q(I),r=s.TOUCH_DOLLY_PAN;break;case vp.DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;Ne(I),r=s.TOUCH_DOLLY_ROTATE;break;default:r=s.NONE}break;default:r=s.NONE}r!==s.NONE&&i.dispatchEvent(qk)}function Xe(I){switch(_t(I),r){case s.TOUCH_ROTATE:if(i.enableRotate===!1)return;Re(I),i.update();break;case s.TOUCH_PAN:if(i.enablePan===!1)return;Te(I),i.update();break;case s.TOUCH_DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;be(I),i.update();break;case s.TOUCH_DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;nt(I),i.update();break;default:r=s.NONE}}function Ct(I){i.enabled!==!1&&I.preventDefault()}function ze(I){M.push(I.pointerId)}function qt(I){delete R[I.pointerId];for(let k=0;k<M.length;k++)if(M[k]==I.pointerId){M.splice(k,1);return}}function Oe(I){for(let k=0;k<M.length;k++)if(M[k]==I.pointerId)return!0;return!1}function _t(I){let k=R[I.pointerId];k===void 0&&(k=new Y,R[I.pointerId]=k),k.set(I.pageX,I.pageY)}function ut(I){const k=I.pointerId===M[0]?M[1]:M[0];return R[k]}i.domElement.addEventListener("contextmenu",Ct),i.domElement.addEventListener("pointerdown",ct),i.domElement.addEventListener("pointercancel",H),i.domElement.addEventListener("wheel",Ee,{passive:!1}),i.domElement.getRootNode().addEventListener("keydown",Le,{passive:!0,capture:!0}),this.update()}};var y0e=Object.defineProperty,v0e=Object.getOwnPropertyDescriptor,bA=(n,e,i,s)=>{for(var r=s>1?void 0:s?v0e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&y0e(e,i,r),r};const $k=te("debuggroundprojection");class wc extends Pe{constructor(){super(...arguments),p(this,"applyOnAwake",!1),p(this,"autoFit",!0),p(this,"_radius",50),p(this,"_height",3),p(this,"_arblending",0),p(this,"_lastEnvironment"),p(this,"_lastRadius"),p(this,"_lastHeight"),p(this,"_projection"),p(this,"_watcher"),p(this,"_needsTextureUpdate",!1),p(this,"_blurrynessShader",null),p(this,"_lastBlurriness",-1)}set radius(e){this._radius=e,this.updateProjection()}get radius(){return this._radius}set height(e){this._height=e,this.updateProjection()}get height(){return this._height}set arBlending(e){this._arblending=e,this._needsTextureUpdate=!0}get arBlending(){return this._arblending}awake(){this.applyOnAwake&&this.updateAndCreate()}onEnable(){this.context.time.frameCount>0&&this.applyOnAwake&&this.updateAndCreate(),this._watcher||(this._watcher=new gu(this.context.scene,"environment"),this._watcher.subscribeWrite(e=>{this.updateProjection()}))}onDisable(){var e,i;(e=this._watcher)==null||e.revoke(),(i=this._projection)==null||i.removeFromParent()}onEnterXR(){this.activeAndEnabled&&(this._needsTextureUpdate=!0,this.updateProjection())}async onLeaveXR(){this.activeAndEnabled&&(await a_(1),this.updateProjection())}onBeforeRender(){this._projection&&this.scene.backgroundRotation&&this._projection.rotation.copy(this.scene.backgroundRotation),this.context.scene.backgroundBlurriness!==void 0&&this._lastBlurriness!=this.context.scene.backgroundBlurriness&&this.context.scene.backgroundBlurriness>.001?this.updateProjection():this._needsTextureUpdate&&this.updateBlurriness()}updateAndCreate(){var e;this.updateProjection(),(e=this._watcher)==null||e.apply()}updateProjection(){var e,i,s,r,o;if(!this.context.scene.environment){(e=this._projection)==null||e.removeFromParent();return}if(((i=this.context.xr)!=null&&i.isPassThrough||(s=this.context.xr)!=null&&s.isAR)&&this.arBlending===0){(r=this._projection)==null||r.removeFromParent();return}if(!this.gameObject||this.destroyed)return;let a=!0;const l=0;if(!this._projection||this.context.scene.environment!==this._lastEnvironment||this._height!==this._lastHeight||this._radius!==this._lastRadius){if($k&&console.log("Create/Update Ground Projection",this.context.scene.environment.name),(o=this._projection)==null||o.removeFromParent(),!this._projection||this.context.scene.environment!==this._lastEnvironment||this._lastHeight!==this._height||this._lastRadius!==this._radius)try{this._projection=new yg(this.context.scene.environment,this._height,this.radius,64)}catch(c){console.error("Failed to enable GroundProjection for environment",c);return}else a=!1;this._projection.position.y=this._height-l,this._projection.name="GroundProjection",lL(this._projection,!1)}else a=!1;if(this._projection.parent||this.gameObject.add(this._projection),this.autoFit&&a){this._projection.updateWorldMatrix(!0,!0);const c=Ba(this.context.scene.children,[this._projection]),h=c.min.y;if(h<1/0){const u=mt();u.x=c.min.x+(c.max.x-c.min.x)*.5;const d=Qi(this.gameObject).x;u.y=h+this._height*d-l,u.z=c.min.z+(c.max.z-c.min.z)*.5,bs(this._projection,u)}$k&&ft.DrawWireBox3(c,65280,5)}this.context.scene.backgroundBlurriness>.001&&this._needsTextureUpdate&&this.updateBlurriness(),this._lastEnvironment=this.context.scene.environment,this._lastHeight=this._height,this._lastRadius=this._radius,this._needsTextureUpdate=!1}updateBlurriness(){var e;if(this._projection){if(!this.context.scene.environment)return}else return;this._needsTextureUpdate=!1,$k&&console.log("Update Blurriness",this.context.scene.backgroundBlurriness),this._blurrynessShader??(this._blurrynessShader=new kt({name:"GroundProjectionBlurriness",uniforms:{map:{value:this.context.scene.environment},blurriness:{value:this.context.scene.backgroundBlurriness},blending:{value:0},alphaFactor:{value:1}},vertexShader:b0e,fragmentShader:A0e})),this._blurrynessShader.depthWrite=!1,this._blurrynessShader.uniforms.blurriness.value=this.context.scene.backgroundBlurriness,this._lastBlurriness=this.context.scene.backgroundBlurriness,this.context.scene.environment.needsPMREMUpdate=!0;const i=this._projection.material.transparent;this._projection.material.transparent=(((e=this.context.xr)==null?void 0:e.isAR)===!0&&this.arBlending>1e-6)??!1,this._projection.material.transparent?this._blurrynessShader.uniforms.blending.value=this.arBlending:this._blurrynessShader.uniforms.blending.value=0,this.context.isInPassThrough?this._blurrynessShader.uniforms.alphaFactor.value=.95:this._blurrynessShader.uniforms.alphaFactor.value=1,i!==this._projection.material.transparent&&(this._projection.material.needsUpdate=!0),this._projection.material.map=Pa.copyTexture(this.context.scene.environment,this._blurrynessShader),this._projection.material.depthTest=!0,this._projection.material.depthWrite=!1}}bA([T()],wc.prototype,"applyOnAwake",2),bA([T()],wc.prototype,"autoFit",2),bA([T()],wc.prototype,"radius",1),bA([T()],wc.prototype,"height",1),bA([T()],wc.prototype,"arBlending",1);const b0e=`
  varying vec2 vUv;

  void main() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }
`,A0e=`
  uniform sampler2D map;
  uniform float blurriness;
  uniform float alphaFactor;
  uniform float blending;
  varying vec2 vUv;

  const float PI = 3.14159265359;

  // Gaussian function
  float gaussian(float x, float sigma) {
    return exp(-(x * x) / (2.0 * sigma * sigma)) / (sqrt(2.0 * PI) * sigma);
  }

  // Custom smoothstep function for desired falloff
  float customSmoothstep(float edge0, float edge1, float x) {
    float t = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);
    return t * t * (3.0 - 2.0 * t);
  }

  void main() {
    vec2 center = vec2(0.0, 0.0);
    vec2 pos = vUv;
    pos.x = 0.0; // Only consider vertical distance
    float distance = length(pos - center);
    
    // Calculate blur amount based on custom falloff
    float blurAmount = customSmoothstep(0.5, 1.0, distance * 2.0);
    blurAmount = clamp(blurAmount, 0.0, 1.0); // Ensure blur amount is within valid range

    // Gaussian blur
    vec2 pixelSize = 1.0 / vec2(textureSize(map, 0));
    vec4 color = vec4(0.0);
    float totalWeight = 0.0;
    int blurSize = int(60.0 * min(1.0, blurriness) * blurAmount); // Adjust blur size based on distance and blurriness
    float lodLevel = log2(float(blurSize)) * 0.5; // Compute LOD level

    for (int x = -blurSize; x <= blurSize; x++) {
        for (int y = -blurSize; y <= blurSize; y++) {
            vec2 offset = vec2(float(x), float(y)) * pixelSize * blurAmount;
            float weight = gaussian(length(vec2(float(x), float(y))), 1000.0 * blurAmount); // Use a fixed sigma value
            color += textureLod(map, vUv + offset, lodLevel) * weight;
            totalWeight += weight;
        }
    }

    color = totalWeight > 0.0 ? color / totalWeight : texture2D(map, vUv);

    gl_FragColor = color;

    float brightness = dot(gl_FragColor.rgb, vec3(0.299, 0.587, 0.114));
    float stepFactor = blending - brightness * .1;
    gl_FragColor.a = pow(1.0 - blending * customSmoothstep(0.35 * stepFactor, 0.45 * stepFactor, distance), 5.);
    gl_FragColor.a *= alphaFactor;
    // gl_FragColor.rgb = vec3(1.0);

    // #include <tonemapping_fragment>
    // #include <colorspace_fragment>
    
    // Uncomment to visualize blur amount
    // gl_FragColor = vec4(blurAmount, 0.0, 0.0, 1.0);
  }
`;var x0e=Object.defineProperty,w0e=Object.getOwnPropertyDescriptor,eD=(n,e,i,s)=>{for(var r=s>1?void 0:s?w0e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&x0e(e,i,r),r};class Dm extends Pe{constructor(){super(...arguments),p(this,"constraintActive",!0),p(this,"locked",!1),p(this,"sources",[])}}eD([T()],Dm.prototype,"constraintActive",2),eD([T()],Dm.prototype,"locked",2),eD([T(ye)],Dm.prototype,"sources",2);function _0e(n,e){return ad(n,wi.ContextCreated,e),()=>ld(n,wi.ContextCreated)}function S0e(n,e){return ad(n,wi.ContextClearing,e),()=>ld(n,wi.ContextClearing)}function C0e(n,e){return ad(n,wi.ContextDestroying,e),()=>ld(n,wi.ContextDestroying)}function tD(n,e){return ad(n,Yi.Start,e),()=>ld(n,Yi.Start)}function iD(n,e){return ad(n,Yi.Update,e),()=>ld(n,Yi.Update)}function iQ(n,e){return ad(n,Yi.OnBeforeRender,e),()=>ld(n,Yi.OnBeforeRender)}function M0e(n,e){return ad(n,Yi.OnAfterRender,e),()=>ld(n,Yi.OnAfterRender)}class Om{constructor(){p(this,"bb",null),p(this,"bb_pos",0)}__init(e,i){return this.bb_pos=e,this.bb=i,this}x(){return this.bb.readFloat32(this.bb_pos)}y(){return this.bb.readFloat32(this.bb_pos+4)}z(){return this.bb.readFloat32(this.bb_pos+8)}static sizeOf(){return 12}static createVec3(e,i,s,r){return e.prep(4,12),e.writeFloat32(r),e.writeFloat32(s),e.writeFloat32(i),e.offset()}}class nQ{constructor(){p(this,"bb",null),p(this,"bb_pos",0)}__init(e,i){return this.bb_pos=e,this.bb=i,this}position(e){return(e||new Om).__init(this.bb_pos,this.bb)}rotation(e){return(e||new Om).__init(this.bb_pos+12,this.bb)}scale(e){return(e||new Om).__init(this.bb_pos+24,this.bb)}static sizeOf(){return 36}static createTransform(e,i,s,r,o,a,l,c,h,u){return e.prep(4,36),e.prep(4,12),e.writeFloat32(u),e.writeFloat32(h),e.writeFloat32(c),e.prep(4,12),e.writeFloat32(l),e.writeFloat32(a),e.writeFloat32(o),e.prep(4,12),e.writeFloat32(r),e.writeFloat32(s),e.writeFloat32(i),e.offset()}}class Au{constructor(){p(this,"bb",null),p(this,"bb_pos",0)}__init(e,i){return this.bb_pos=e,this.bb=i,this}static getRootAsSyncedTransformModel(e,i){return(i||new Au).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsSyncedTransformModel(e,i){return e.setPosition(e.position()+UP),(i||new Au).__init(e.readInt32(e.position())+e.position(),e)}guid(e){const i=this.bb.__offset(this.bb_pos,4);return i?this.bb.__string(this.bb_pos+i,e):null}fast(){const e=this.bb.__offset(this.bb_pos,6);return e?!!this.bb.readInt8(this.bb_pos+e):!1}transform(e){const i=this.bb.__offset(this.bb_pos,8);return i?(e||new nQ).__init(this.bb_pos+i,this.bb):null}dontSave(){const e=this.bb.__offset(this.bb_pos,10);return e?!!this.bb.readInt8(this.bb_pos+e):!1}static startSyncedTransformModel(e){e.startObject(4)}static addGuid(e,i){e.addFieldOffset(0,i,0)}static addFast(e,i){e.addFieldInt8(1,+i,0)}static addTransform(e,i){e.addFieldStruct(2,i,0)}static addDontSave(e,i){e.addFieldInt8(3,+i,0)}static endSyncedTransformModel(e){return e.endObject()}static finishSyncedTransformModelBuffer(e,i){e.finish(i)}static finishSizePrefixedSyncedTransformModelBuffer(e,i){e.finish(i,void 0,!0)}}var Us=(n=>(n[n.Average=0]="Average",n[n.Multiply=1]="Multiply",n[n.Minimum=2]="Minimum",n[n.Maximum=3]="Maximum",n))(Us||{}),JC=(n=>(n[n.Discrete=0]="Discrete",n[n.Continuous=1]="Continuous",n))(JC||{}),jn=(n=>(n[n.None=0]="None",n[n.FreezePositionX=2]="FreezePositionX",n[n.FreezePositionY=4]="FreezePositionY",n[n.FreezePositionZ=8]="FreezePositionZ",n[n.FreezePosition=14]="FreezePosition",n[n.FreezeRotationX=16]="FreezeRotationX",n[n.FreezeRotationY=32]="FreezeRotationY",n[n.FreezeRotationZ=64]="FreezeRotationZ",n[n.FreezeRotation=112]="FreezeRotation",n[n.FreezeAll=126]="FreezeAll",n))(jn||{}),M0=(n=>(n[n.None=0]="None",n[n.X=2]="X",n[n.Y=4]="Y",n[n.Z=8]="Z",n[n.All=-1]="All",n))(M0||{});const or=function(n,e){return function(i,s,r){E0e(i,s,r,n,e)}};function E0e(n,e,i,s,r){if(!r&&!s&&!n.onValidate)return;if(i!==void 0){console.error("Invalid usage of validate decorator. Only fields can be validated.",n,e,i),gn("Invalid usage of validate decorator. Only fields can be validated. Property: "+e,Zo.Error);return}let o="";if(typeof e=="string"?o=e:o=e.name,n.__internalAwake){const a=Symbol(o),l=n.__internalAwake;n.__internalAwake=function(){var c;if(!this.onValidate){Ye()&&console.warn('Usage of @validate decorate detected but there is no onValidate method in your class: "'+((c=n.constructor)==null?void 0:c.name)+'"');return}if(this[a]===void 0){this[a]=this[o];const h=this[o];if(h instanceof Y||h instanceof E||h instanceof Ze||h instanceof Se){const u=this[o];c_(u,()=>{this.onValidate(o)})}Object.defineProperty(this,o,{set:function(u){var d;if(this[ZB]===!0)this[a]=u;else{s?.call(this,u);const m=this[a];this[a]=u,(d=this.onValidate)==null||d.call(this,o,m)}},get:function(){return r?.call(this),this[a]}})}l.call(this)}}}const T0e=function(n){return function(e,i,s){let r="";typeof i=="string"?r=i:r=i.name;const o=n.prototype,a=Object.getOwnPropertyDescriptor(o,r);if(!(a!=null&&a.value)){console.warn("Can not apply prefix: type does not have method named",i,n);return}const l=a.value,c=e[r];Object.defineProperty(o,r,{value:function(...h){const u=c?.call(this,...h);if(u instanceof Promise){u.then(d=>{if(d!==!1)return l.call(this,...h)});return}if(u!==!1)return l.call(this,...h)}})}};var R0e=Object.defineProperty,I0e=Object.getOwnPropertyDescriptor,sa=(n,e,i,s)=>{for(var r=s>1?void 0:s?I0e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&R0e(e,i,r),r};class L0e{constructor(e,i){p(this,"positionChanged",!1),p(this,"rotationChanged",!1),p(this,"position"),p(this,"quaternion"),p(this,"_positionKeys",["x","y","z"]),p(this,"_quaternionKeys",["_x","_y","_z","_w"]),p(this,"mute",!1),p(this,"context"),p(this,"obj"),p(this,"_positionWatch"),p(this,"_rotationWatch"),this.context=i,this.obj=e}get isDirty(){return this.positionChanged||this.rotationChanged}reset(e=!1){if(this.positionChanged=!1,this.rotationChanged=!1,this.mute=!1,e){if(this.position)for(const i of this._positionKeys)delete this.position[i];if(this.quaternion)for(const i of this._quaternionKeys)delete this.quaternion[i]}}syncValues(){for(const e of this._positionKeys)this.position[e]=this.obj.position[e];for(const e of this._quaternionKeys)this.quaternion[e]=this.obj.quaternion[e]}applyValues(){if(this.positionChanged&&this.position)for(const e of this._positionKeys){const i=this.position[e];i!==void 0&&(this.obj.position[e]=i)}if(this.rotationChanged&&this.quaternion)for(const e of this._quaternionKeys){const i=this.quaternion[e];i!==void 0&&(this.obj.quaternion[e]=i)}}start(e,i){this.reset(),e&&(this._positionWatch||(this._positionWatch=new gu(this.obj.position,["x","y","z"])),this._positionWatch.apply(),this.position={},this._positionWatch.subscribeWrite((o,a)=>{var l;if((l=this.context.physics.engine)!=null&&l.isUpdating||this.mute)return;const c=this.position[a];Math.abs(c-o)<1e-5||(this.position[a]=o,this.positionChanged=!0)})),i&&(this._rotationWatch||(this._rotationWatch=new gu(this.obj.quaternion,["_x","_y","_z","_w"])),this._rotationWatch.apply(),this.quaternion={},this._rotationWatch.subscribeWrite((o,a)=>{var l;if((l=this.context.physics.engine)!=null&&l.isUpdating||this.mute)return;const c=this.quaternion[a];Math.abs(c-o)<1e-5||(this.quaternion[a]=o,this.rotationChanged=!0)}));const s=this.obj.matrixWorld.multiplyMatrices.bind(this.obj.matrixWorld),r=new he;this.obj.matrixWorld.multiplyMatrices=(o,a)=>{var l;return(l=this.context.physics.engine)!=null&&l.isUpdating||this.mute||r.equals(o)||(this.positionChanged=!0,this.rotationChanged=!0,r.copy(o)),s(o,a)}}stop(){var e,i;(e=this._positionWatch)==null||e.revoke(),(i=this._rotationWatch)==null||i.revoke()}}var nD;const sD=(nD=class extends Pe{constructor(){super(...arguments),p(this,"autoMass",!0),p(this,"_mass",0),p(this,"useGravity",!0),p(this,"centerOfMass",new E(0,0,0)),p(this,"constraints",jn.None),p(this,"isKinematic",!1),p(this,"drag",0),p(this,"angularDrag",1),p(this,"detectCollisions",!0),p(this,"sleepThreshold",.01),p(this,"collisionDetectionMode",JC.Discrete),p(this,"_gravityScale",1),p(this,"dominanceGroup",0),p(this,"_propertiesChanged",!1),p(this,"_currentVelocity",new E),p(this,"_smoothedVelocity",new E),p(this,"_smoothedVelocityGetter",new E),p(this,"_lastPosition",new E),p(this,"_watch")}set mass(n){n!==this._mass&&(this._mass=n,this._propertiesChanged=!0,this.__didAwake&&(this.autoMass=!1))}get mass(){var n,e;return this.autoMass?((e=(n=this.context.physics.engine)==null?void 0:n.getBody(this))==null?void 0:e.mass())??-1:this._mass}get lockPositionX(){return(this.constraints&jn.FreezePositionX)!==0}get lockPositionY(){return(this.constraints&jn.FreezePositionY)!==0}get lockPositionZ(){return(this.constraints&jn.FreezePositionZ)!==0}get lockRotationX(){return(this.constraints&jn.FreezeRotationX)!==0}get lockRotationY(){return(this.constraints&jn.FreezeRotationY)!==0}get lockRotationZ(){return(this.constraints&jn.FreezeRotationZ)!==0}set lockPositionX(n){n?this.constraints|=jn.FreezePositionX:this.constraints&=~jn.FreezePositionX}set lockPositionY(n){n?this.constraints|=jn.FreezePositionY:this.constraints&=~jn.FreezePositionY}set lockPositionZ(n){n?this.constraints|=jn.FreezePositionZ:this.constraints&=~jn.FreezePositionZ}set lockRotationX(n){n?this.constraints|=jn.FreezeRotationX:this.constraints&=~jn.FreezeRotationX}set lockRotationY(n){n?this.constraints|=jn.FreezeRotationY:this.constraints&=~jn.FreezeRotationY}set lockRotationZ(n){n?this.constraints|=jn.FreezeRotationZ:this.constraints&=~jn.FreezeRotationZ}set gravityScale(n){this._gravityScale=n}get gravityScale(){return this._gravityScale}awake(){this._watch=void 0,this._propertiesChanged=!1}onEnable(){var n;this._watch||(this._watch=new L0e(this.gameObject,this.context)),this._watch.start(!0,!0),this.startCoroutine(this.beforePhysics(),Yi.LateUpdate),Ye()&&!((n=this.context.physics.engine)!=null&&n.getBody(this))&&console.warn(`Rigidbody was not created: Does your object (${this.name}) have a collider?`)}onDisable(){var n,e;(n=this._watch)==null||n.stop(),(e=this.context.physics.engine)==null||e.removeBody(this)}onDestroy(){var n;(n=this.context.physics.engine)==null||n.removeBody(this)}onValidate(){this._propertiesChanged=!0}*beforePhysics(){for(var n,e,i,s;;)this._propertiesChanged&&(this._propertiesChanged=!1,(n=this.context.physics.engine)==null||n.updateProperties(this)),(e=this._watch)!=null&&e.isDirty?(this._watch.mute=!0,this._watch.applyValues(),(i=this.context.physics.engine)==null||i.updateBody(this,this._watch.positionChanged,this._watch.rotationChanged),this._watch.reset()):(s=this._watch)==null||s.syncValues(),this.captureVelocity(),yield}teleport(n,e=!0){var i;(i=this._watch)==null||i.reset(!0),e?this.gameObject.position.set(n.x,n.y,n.z):this.setWorldPosition(n.x,n.y,n.z),this.resetForcesAndTorques(),this.resetVelocities()}resetForces(n=!0){var e;(e=this.context.physics.engine)==null||e.resetForces(this,n)}resetTorques(n=!0){var e;(e=this.context.physics.engine)==null||e.resetTorques(this,n)}resetVelocities(){this.setVelocity(0,0,0),this.setAngularVelocity(0,0,0)}resetForcesAndTorques(){this.resetForces(),this.resetTorques()}wakeUp(){var n;(n=this.context.physics.engine)==null||n.wakeup(this)}get isSleeping(){var n;return(n=this.context.physics.engine)==null?void 0:n.isSleeping(this)}updateProperties(){var n;return this._propertiesChanged=!1,(n=this.context.physics.engine)==null?void 0:n.updateProperties(this)}applyForce(n,e,i=!0){var s;this._propertiesChanged&&this.updateProperties(),(s=this.context.physics.engine)==null||s.addForce(this,n,i)}applyImpulse(n,e=!0){var i;this._propertiesChanged&&this.updateProperties(),(i=this.context.physics.engine)==null||i.applyImpulse(this,n,e)}setForce(n,e,i,s=!0){var r,o,a;(r=this.context.physics.engine)==null||r.resetForces(this,s),typeof n=="number"?(e??(e=0),i??(i=0),(o=this.context.physics.engine)==null||o.addForce(this,{x:n,y:e,z:i},s)):(a=this.context.physics.engine)==null||a.addForce(this,n,s)}getVelocity(){var n;const e=(n=this.context.physics.engine)==null?void 0:n.getLinearVelocity(this);return e?(this._currentVelocity.x=e.x,this._currentVelocity.y=e.y,this._currentVelocity.z=e.z,this._currentVelocity):this._currentVelocity.set(0,0,0)}setVelocity(n,e,i,s=!0){var r,o;if(n instanceof E){const a=n;(r=this.context.physics.engine)==null||r.setLinearVelocity(this,a,s);return}e===void 0||i===void 0||(o=this.context.physics.engine)==null||o.setLinearVelocity(this,{x:n,y:e,z:i},s)}getAngularVelocity(){var n;const e=(n=this.context.physics.engine)==null?void 0:n.getAngularVelocity(this);return e?(this._currentVelocity.x=e.x,this._currentVelocity.y=e.y,this._currentVelocity.z=e.z,this._currentVelocity):this._currentVelocity.set(0,0,0)}setAngularVelocity(n,e,i,s=!0){var r,o;if(typeof n=="object"){const a=n;(r=this.context.physics.engine)==null||r.setAngularVelocity(this,a,s);return}if(e===void 0||i===void 0||typeof e=="boolean"){console.warn("setAngularVelocity expects either a Vec3 or 3 numbers");return}(o=this.context.physics.engine)==null||o.setAngularVelocity(this,{x:n,y:e,z:i},s)}setTorque(n,e,i){typeof n=="number"?this.setAngularVelocity(n,e,i):this.setAngularVelocity(n)}get smoothedVelocity(){return this._smoothedVelocityGetter.copy(this._smoothedVelocity),this._smoothedVelocityGetter.multiplyScalar(1/this.context.time.deltaTime)}setBodyFromGameObject(n=null){}captureVelocity(){const n=zt(this.gameObject);this.gameObject.matrixWorld.decompose(sD.tempPosition,P0e,B0e);const e=n.sub(this._lastPosition);this._lastPosition.copy(sD.tempPosition),this._smoothedVelocity.lerp(e,this.context.time.deltaTime/.1)}},p(nD,"tempPosition",new E),nD);let Li=sD;sa([or()],Li.prototype,"autoMass",2),sa([T()],Li.prototype,"mass",1),sa([or(),T()],Li.prototype,"useGravity",2),sa([T(E)],Li.prototype,"centerOfMass",2),sa([or(),T()],Li.prototype,"constraints",2),sa([or(),T()],Li.prototype,"isKinematic",2),sa([or(),T()],Li.prototype,"drag",2),sa([or(),T()],Li.prototype,"angularDrag",2),sa([or(),T()],Li.prototype,"detectCollisions",2),sa([or(),T()],Li.prototype,"sleepThreshold",2),sa([or(),T()],Li.prototype,"collisionDetectionMode",2),sa([or()],Li.prototype,"_gravityScale",2),sa([or()],Li.prototype,"dominanceGroup",2),new E;const P0e=new Se,B0e=new E,Td=te("debugsync"),AA="STRS";WP(AA,Au.getRootAsSyncedTransformModel);const _c=new m1;function sQ(n,e,i=!0){_c.clear();const s=_c.createString(n);Au.startSyncedTransformModel(_c),Au.addGuid(_c,s),Au.addFast(_c,i);const r=e.worldPosition,o=e.worldEuler,a=e.gameObject.scale;Au.addTransform(_c,nQ.createTransform(_c,r.x,r.y,r.z,o.x,o.y,o.z,a.x,a.y,a.z));const l=Au.endSyncedTransformModel(_c);return _c.finish(l,AA),_c.asUint8Array()}let rD=0,xA=0;iD(n=>{var e;const i=(e=n.connection.currentServerUrl)!=null&&e.includes("glitch")?10:40;xA=Math.floor(rD/i),rD=0,Td&&xA>0&&console.log("Sync Transform Fast Interval",xA)});class Sc extends Pe{constructor(){super(...arguments),p(this,"overridePhysics",!0),p(this,"interpolatePosition",!0),p(this,"interpolateRotation",!0),p(this,"fastMode",!1),p(this,"syncDestroy",!1),p(this,"_model",null),p(this,"_needsUpdate",!0),p(this,"rb",null),p(this,"_wasKinematic",!1),p(this,"_receivedDataBefore",!1),p(this,"_targetPosition"),p(this,"_targetRotation"),p(this,"_receivedFastUpdate",!1),p(this,"_shouldRequestOwnership",!1),p(this,"joinedRoomCallback",null),p(this,"receivedDataCallback",null),p(this,"tempEuler",new si),p(this,"receivedUpdate",!1),p(this,"lastWorldPos"),p(this,"lastWorldRotation")}requestOwnership(){Td&&console.log("Request ownership"),this._model?this._model.requestOwnership():(this._shouldRequestOwnership=!0,this._needsUpdate=!0)}hasOwnership(){var e;return((e=this._model)==null?void 0:e.hasOwnership)??void 0}isOwned(){var e;return(e=this._model)==null?void 0:e.isOwned}awake(){Td&&console.log("new instance",this.guid,this),this._receivedDataBefore=!1,this._targetPosition=new E,this._targetRotation=new Se,this.lastWorldPos=new E,this.lastWorldRotation=new Se,this.rb=ie.getComponentInChildren(this.gameObject,Li),this.rb&&(this._wasKinematic=this.rb.isKinematic),this.receivedUpdate=!0,this._model=new cB(this.context.connection,this.guid),this.context.connection.isConnected&&this.tryGetLastState(),this.joinedRoomCallback=this.tryGetLastState.bind(this),this.context.connection.beginListen(Xt.JoinedRoom,this.joinedRoomCallback),this.receivedDataCallback=this.onReceivedData.bind(this),this.context.connection.beginListenBinary(AA,this.receivedDataCallback)}onDestroy(){this.syncDestroy&&FB(this.guid,this.context.connection),this._model=null,this.context.connection.stopListen(Xt.JoinedRoom,this.joinedRoomCallback),this.context.connection.stopListenBinary(AA,this.receivedDataCallback)}tryGetLastState(){const e=this.context.connection.tryGetState(this.guid);e&&this.onReceivedData(e)}onReceivedData(e){var i;if(!this.destroyed&&typeof e.guid=="function"&&e.guid()===this.guid){Td&&console.log("new data",this.context.connection.connectionId,this.context.time.frameCount,this.guid,e),this.receivedUpdate=!0,this._receivedFastUpdate=e.fast();const s=e.transform();if(s){hl.markDirty(this.gameObject,!0);const r=s.position();r&&(this.interpolatePosition&&((i=this._targetPosition)==null||i.set(r.x(),r.y(),r.z())),(!this.interpolatePosition||!this._receivedDataBefore)&&this.setWorldPosition(r.x(),r.y(),r.z()));const o=s.rotation();o&&(this.tempEuler.set(o.x(),o.y(),o.z()),this.interpolateRotation&&this._targetRotation.setFromEuler(this.tempEuler),(!this.interpolateRotation||!this._receivedDataBefore)&&oL(this.gameObject,this.tempEuler))}this._receivedDataBefore=!0}}onEnable(){this.lastWorldPos.copy(this.worldPosition),this.lastWorldRotation.copy(this.worldQuaternion),this._needsUpdate=!0,this._model&&this._model.updateIsOwned()}onDisable(){this._model&&this._model.freeOwnership()}onBeforeRender(){if(!this.activeAndEnabled||!this.context.connection.isConnected)return;if(!this.context.connection.isInRoom||!this._model){Td&&console.log("no model or room",this.name,this.guid,this.context.connection.isInRoom);return}this._shouldRequestOwnership&&(this._shouldRequestOwnership=!1,this._model.requestOwnership());const e=this.worldPosition,i=this.worldQuaternion;if(this._model.isOwned&&!this.receivedUpdate){const o=e.distanceTo(this.lastWorldPos),a=i.angleTo(this.lastWorldRotation),l=this._model.hasOwnership||this.fastMode?1e-4:.001;(o>l||a>l)&&(this._model.hasOwnership?this._needsUpdate=!0:(Td&&console.log(this.guid,"reset because not owned but",this.gameObject.name,this.lastWorldPos),this.worldPosition=this.lastWorldPos,e.copy(this.lastWorldPos),this.worldQuaternion=this.lastWorldRotation,i.copy(this.lastWorldRotation),hl.markDirty(this.gameObject,!0),this._needsUpdate=!1))}if(this._model&&!this._model.hasOwnership&&this._model.isOwned&&this._receivedDataBefore){const o=this._receivedFastUpdate||this.fastMode?.5:.3;let a=!1;if(this.interpolatePosition&&this._targetPosition){const l=this.worldPosition;l.lerp(this._targetPosition,o),this.worldPosition=l,a=!0}if(this.interpolateRotation&&this._targetRotation){const l=this.worldQuaternion;l.slerp(this._targetRotation,o),this.worldQuaternion=l,a=!0}a&&hl.markDirty(this.gameObject,!0)}if(this.receivedUpdate=!1,this.lastWorldPos.copy(e),this.lastWorldRotation.copy(i),!this._model||!this._model||this._model.hasOwnership===void 0||!this._model.hasOwnership)return;this.rb&&this.overridePhysics&&this._wasKinematic!==void 0&&(Td&&console.log("reset kinematic",this.rb.name,this._wasKinematic),this.rb.isKinematic=this._wasKinematic);const s=10,r=this.rb||this.fastMode;if(this._needsUpdate&&(this.context.time.frameCount%s===0||r)){if(rD++,r&&xA>0&&this.context.time.frameCount%xA!==0)return;Td&&console.log("send update",this.context.connection.connectionId,this.guid,this.gameObject.name,this.gameObject.guid),this._needsUpdate=!1;const o=sQ(this.guid,this,!!r);this.context.connection.sendBinary(o)}}}const k0e=te("debugshadowcomponents");QI.prototype.interactable={get(){return this.interactive},set(n){this.interactable=n}};const Za=Symbol("shadowDomOwner");class cl extends Pe{constructor(){super(...arguments),p(this,"_shadowComponent",null),p(this,"_controlsChildLayout",!0),p(this,"_root"),p(this,"_parentComponent")}isRoot(){var e;return((e=this.Root)==null?void 0:e.gameObject)===this.gameObject}get canvas(){const e=this.Root;return e!=null&&e.isCanvas?e:null}get Canvas(){return this.canvas}markDirty(){Ya.markUIDirty(this.context)}get shadowComponent(){return this._shadowComponent}set shadowComponent(e){this._shadowComponent=e}get controlsChildLayout(){return this._controlsChildLayout}set controlsChildLayout(e){this._controlsChildLayout=e,this.shadowComponent&&(this.shadowComponent.autoLayout=e)}get Root(){return this._root===void 0&&(this._root=ie.getComponentInParent(this.gameObject,wA)),this._root}__internalNewInstanceCreated(e){return super.__internalNewInstanceCreated(e),this.shadowComponent=null,this._root=void 0,this._parentComponent=void 0,this}onEnable(){super.onEnable()}addShadowComponent(e,i){var s;if(!e)return;this.removeShadowComponent();const r=this.isRoot()?this.gameObject:this.gameObject.parent;if(this._parentComponent=ie.getComponentInParent(r,cl),!this._parentComponent){console.warn(`Component "${this.name}" doesn't have a UI parent anywhere. Do you have an UI element outside a Canvas? UI components must be a child of a Canvas component`,this);return}e.name=this.name+" ("+(this.constructor.name??"UI")+")",e.autoLayout=this._parentComponent.controlsChildLayout,e[Za]=this,this.setShadowComponentOwner(e);let o=!1;if(((s=this.Root)==null?void 0:s.gameObject)===this.gameObject)this.gameObject.add(e);else{const a=this._parentComponent.shadowComponent;a&&(a?.add(e),o=!0)}this.shadowComponent=e,i&&i.shadowComponent&&this.shadowComponent&&i.shadowComponent.add(this.shadowComponent),Hb&&e.add(new io(.5)),this.onAfterAddedToScene(),o&&b5(),k0e&&console.warn("Added shadow component",this.shadowComponent)}setShadowComponentOwner(e){if(e&&(e[Za]===void 0||e[Za]===this)&&(e[Za]=this,e.children))for(const i of e.children)this.setShadowComponentOwner(i)}traverseOwnedShadowComponents(e,i,s){if(e&&e[Za]===i){s(e);for(const r of e.children)this.traverseOwnedShadowComponents(r,i,s)}}removeShadowComponent(){this.shadowComponent&&this.shadowComponent.removeFromParent()}onAfterAddedToScene(){}setInteractable(e){this.shadowComponent&&(this.shadowComponent.interactable=e)}}class wA extends cl{awake(){super.awake()}}class Uy{constructor(e,i){p(this,"event"),p(this,"button"),p(this,"buttonName"),p(this,"_used",!1),p(this,"_propagationStopped",!1),p(this,"z__pointer_ctured",!1),p(this,"z__pointer_cture_rleased",!1),p(this,"inputSource"),p(this,"object"),p(this,"point"),p(this,"normal"),p(this,"face"),p(this,"distance"),p(this,"instanceId"),p(this,"intersection"),p(this,"isDown"),p(this,"isUp"),p(this,"isPressed"),p(this,"isClick"),p(this,"isDoubleClick"),p(this,"input"),this.event=i,this.input=e,this.button=i.button}get deviceIndex(){return this.event.deviceIndex}get pointerId(){return this.event.pointerId}get pressure(){return this.event.pressure}get used(){return this._used}use(){this._used||(this._used=!0,this.event.use())}get propagationStopped(){return this._propagationStopped}stopPropagation(){this._propagationStopped=!0,this.event.stopImmediatePropagation()}stopImmediatePropagation(){this._propagationStopped=!0,this.event.stopImmediatePropagation()}setPointerCapture(){this.z__pointer_ctured=!0}releasePointerCapture(){this.z__pointer_cture_rleased=!0}get mode(){return this.event.mode}clone(){const e=new Uy(this.input,this.event);return Object.assign(e,this),e}Use(){this.use()}StopPropagation(){this.event.stopImmediatePropagation()}}function qC(n,e){return ie.foreachComponent(n,i=>{if(!i.enabled)return;const s=i;if(e)switch(e){case"pointerdown":if(s.onPointerDown)return!0;break;case"pointerup":if(s.onPointerUp||s.onPointerClick)return!0;break;case"pointermove":if(s.onPointerEnter||s.onPointerExit||s.onPointerMove)return!0;break}else if(s.onPointerDown||s.onPointerUp||s.onPointerEnter||s.onPointerExit||s.onPointerClick)return!0},!1)===!0}const jh=new Array;class Cc{constructor(e,i,s,r){p(this,"enabled",!0),p(this,"target"),p(this,"methodName"),p(this,"arguments"),this.target=e,this.methodName=i||null,this.arguments=s,r!=null&&(this.enabled=r)}get canClone(){return this.target instanceof Object}invoke(...e){if(this.enabled!==!1){if(typeof this.target=="function")this.arguments?(jh.length=0,e!==void 0&&e.length>0&&jh.push(...e),jh.push(...this.arguments),this.target(...this.arguments),jh.length=0):this.target(...e);else if(this.methodName!=null){const i=this.target[this.methodName];typeof i=="function"?this.arguments?(jh.length=0,e!==void 0&&e.length>0&&jh.push(...e),jh.push(...this.arguments),i.call(this.target,...jh),jh.length=0):i.call(this.target,...e):this.arguments?this.target[this.methodName]=this.arguments[0]||e[0]:this.target[this.methodName]=e[0]}}}}const D0e=n=>/^[A-Z]*$/.test(n);class $C extends Event{constructor(){super(...arguments),p(this,"args")}}class en{constructor(e){if(p(this,"isEventList",!0),p(this,"target"),p(this,"key"),p(this,"_isInvoking",!1),p(this,"methods",[]),p(this,"_methodsCopy",[]),this.methods=[],Array.isArray(e))for(const i of e)i instanceof Cc?this.methods.push(i):typeof i=="function"&&this.methods.push(new Cc(i));else typeof e=="function"&&this.methods.push(new Cc(e))}__internalOnInstantiate(e){var i;const s=new Array;for(let r=0;r<this.methods.length;r++){const o=this.methods[r];if(!(o.target instanceof Function)){const a=o.target;let l=a?.uuid;if(a&&(l=a.guid),l){const c=e[l];if(c){const h=(i=o.arguments)==null?void 0:i.map(u=>u instanceof Object&&u.uuid?e[u.uuid]:u!=null&&u.isComponent?e[u.guid]:u);s.push(new Cc(c.clone,o.methodName,h,o.enabled))}else Ye()&&console.warn("Could not find target for event listener")}}}return new en(s)}setEventTarget(e,i){if(this.key=e,this.target=i,this.key!==void 0){let s="",r=!1;for(const o of this.key)r&&D0e(o)&&(s+="-"),r=!0,s+=o.toLowerCase();this.key=s}}get listenerCount(){var e;return((e=this.methods)==null?void 0:e.length)??0}get isInvoking(){return this._isInvoking}static from(...e){return new en(e)}invoke(...e){var i;if(this._isInvoking)return console.warn("Circular event invocation detected. Please check your event listeners for circular references.",this),!1;if(((i=this.methods)==null?void 0:i.length)<=0)return!1;this._isInvoking=!0;try{this._methodsCopy.length=0,this._methodsCopy.push(...this.methods);for(const s of this._methodsCopy)s.invoke(...e);if(typeof this.target=="object"&&typeof this.key=="string"){const s=this.target.dispatchEvent;if(typeof s=="function"){const r=new $C(this.key);r.args=e,s.call(this.target,r)}}}finally{this._isInvoking=!1,this._methodsCopy.length=0}return!0}addEventListener(e){return this.methods.push(new Cc(e)),e}removeEventListener(e){if(e)for(let i=this.methods.length-1;i>=0;i--)this.methods[i].target===e&&(this.methods[i].enabled=!1,this.methods.splice(i,1))}removeAllEventListeners(){this.methods.length=0}}class O0e extends Wa{constructor(){super([Ae,Ii],"ColorSerializer")}onDeserialize(e){if(e!=null)return e.a!==void 0?new Ii(e.r,e.g,e.b,e.a):e.alpha!==void 0?new Ii(e.r,e.g,e.b,e.alpha):new Ae(e.r,e.g,e.b)}onSerialize(e){if(e!=null)return e.a!==void 0?{r:e.r,g:e.g,b:e.b,a:e.a}:{r:e.r,g:e.g,b:e.b}}}const G0e=new O0e;class z0e extends Wa{constructor(){super([si],"EulerSerializer")}onDeserialize(e,i){if(e!=null){if(e.order)return new si(e.x,e.y,e.z,e.order);if(e.x!=null)return new si(e.x,e.y,e.z)}}onSerialize(e,i){return{x:e.x,y:e.y,z:e.z,order:e.order}}}const F0e=new z0e;class N0e extends Wa{constructor(){super(ye,"ObjectSerializer")}onSerialize(e,i){if(i.objectToNode!==void 0&&e.uuid){const s=i.objectToNode[e.uuid];return Os&&console.log(s,e.name,e.uuid),{node:s}}}onDeserialize(e,i){var s,r,o;if(typeof e=="string"){if(e.endsWith(".glb")||e.endsWith(".gltf")){if(i.serializable instanceof Array&&i.serializable.includes(ei))return;Ye()&&zi("Detected wrong usage of @serializable with Object3D or GameObject. Instead you should use AssetReference here! Please see the console for details.");const a=(r=(s=i.target)==null?void 0:s.constructor)==null?void 0:r.name;console.warn(`Wrong usage of @serializable detected in your script "${a}"

It looks like you used @serializable(Object3D) or @serializable(GameObject) for a prefab or scene reference which is exported to a separate glTF file.

To fix this please change your code to:

@serializable(AssetReference)
${i.path}! : AssetReference;
\0`)}return}if(e){if(e.node!==void 0&&i.nodeToObject){const a=i.nodeToObject[e.node];return Os&&console.log("Deserialized object reference?",e,a,i?.nodeToObject),a||console.warn("Did not find node: "+e.node,i.nodeToObject,i.object),a}else if(e.guid){if(!i.context){console.error("Missing context");return}let a;const l=(o=i.gltf)==null?void 0:o.scene;return l&&(a=ie.findByGuid(e.guid,l)),a||(a=ie.findByGuid(e.guid,i.context.scene)),a?(a&&a.isComponent===!0&&(Os&&console.warn("Deserialized object reference is a component"),a=a.gameObject),Os&&console.log("Deserialized object reference?",e,a,i?.nodeToObject)):((Ye()||Os)&&console.warn("Could not resolve object reference",i.path,e,i.target,i.context.scene),e.could_not_resolve=!0),a}}}}const rQ=new N0e;class U0e extends Wa{constructor(){super([Pe,Pe],"ComponentSerializer")}onSerialize(e,i){if(e!=null&&e.guid)return{guid:e.guid}}onDeserialize(e,i){var s;if(e!=null&&e.guid){if(e.___persistentAsset){Os&&console.log("Skipping component deserialization because it's a persistent asset",e);return}const r=i.path;Os&&console.log(e.guid,i.root,i.object,i.target);let o=this.findObjectForGuid(e.guid,i.root);if(o||i.context&&(o=this.findObjectForGuid(e.guid,(s=i.context)==null?void 0:s.scene),o))return o;(Ye()||Os)&&console.warn('Could not resolve component reference: "'+r+'" using guid '+e.guid,i.target),e.could_not_resolve=!0;return}}findObjectForGuid(e,i){if(i.guid===e)return i;const s=ie.foreachComponent(i,r=>{if(r.guid===e)return r},!1);if(s!==void 0)return s;for(let r=0;r<i.children.length;r++){const o=i.children[r],a=this.findObjectForGuid(e,o);if(a)return a}}}const eM=new U0e;class V0e extends Wa{constructor(){super([en])}onSerialize(e,i){console.log("TODO: SERIALIZE EVENT")}onDeserialize(e,i){var s,r,o;if(typeof e=="function")return new en([new Cc(e,null,[],!0)]);if(e&&e.type==="EventList"){Os&&console.log("DESERIALIZE EVENT",e);const a=new Array;if(e.calls&&Array.isArray(e.calls))for(const h of e.calls){let u=function(f){if(typeof f=="object"){let g=rQ.onDeserialize(f,i);if(g||(g=eM.onDeserialize(f,i)),g)return g}return f};Os&&console.log(h);let d=eM.findObjectForGuid(h.target,i.root);!d&&(s=i.context)!=null&&s.scene&&(d=eM.findObjectForGuid(h.target,(r=i.context)==null?void 0:r.scene));const m=((o=h.method)==null?void 0:o.length)>0;if(d&&m){const f=()=>{const g=h.method[0].toUpperCase()+h.method.slice(1);if(typeof d[g]=="function"){console.warn(`EventList method:
Could not find method ${h.method} on object ${d.name}. Please rename ${h.method} to ${g}?
`,d[g],`
 in script: `,d),zi("EventList methods must start with lowercase letter, see console for details");return}else console.warn(`EventList method:
Could not find method ${h.method} on object ${d.name}`,d,typeof d[h.method])};if(typeof d[h.method]!="function"){let g=!1,y=d;for(;y;){const v=Object.getOwnPropertyDescriptor(y,h.method);if(v&&(v.writable===!0||v.set)){g=!0;break}y=Object.getPrototypeOf(y)}!g&&(Ye()||Os)&&f()}}if(d){let f=h.argument;if(f!==void 0?f=u(f):h.arguments!==void 0&&(f=h.arguments.map(u)),!d[h.method])console.warn(`EventList method not found: "${h.method}" on ${d?.name}`);else{f!==void 0&&!Array.isArray(f)&&(f=[f]);const g=new Cc(d,h.method,f,h.enabled);a.push(g)}}else Ye()&&console.warn("[Debug] EventList: Could not find event listener in scene",h,i.object,e)}const l=new en(a);Os&&console.log(l);const c=i.target;return c!==void 0&&i.path!==void 0&&l.setEventTarget(i.path,c),l}}}const X0e=new V0e,tM=new WeakMap,W0e=Vt.prototype.clone;Vt.prototype.clone=function(){const n=W0e.call(this);return tM.has(n)||tM.set(n,this),n};class oQ extends Wa{constructor(){super([C0,Zt])}onSerialize(e,i){}onDeserialize(e,i){if(e instanceof Vt&&i.type===C0){let s=e;tM.has(s)&&(s=tM.get(s)),s.isRenderTargetTexture=!0,s.flipY=!0,s.offset.y=1,s.repeat.y=-1,s.needsUpdate=!0,s.mipmaps=[],s instanceof Gu&&(s.isCompressedTexture=!1,s.format=_i);const r=new C0(s.image.width,s.image.height,{colorSpace:Bi});return r.texture=s,r}}}new oQ;class aQ extends Wa{constructor(){super([URL])}onSerialize(e,i){return null}onDeserialize(e,i){if(typeof e=="string"&&e.length>0)return Vu(i.gltfId,e)}}new aQ;var H0e=Object.defineProperty,j0e=Object.getOwnPropertyDescriptor,Q0e=(n,e,i,s)=>{for(var r=s>1?void 0:s?j0e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&H0e(e,i,r),r};class _A extends Pe{awake(){Ya.createIfNoneExists(this.context)}onEnable(){var e;(e=Ya.get(this.context))==null||e.register(this)}onDisable(){var e;(e=Ya.get(this.context))==null||e.unregister(this)}}class ra extends _A{constructor(){super(...arguments),p(this,"targets",null),p(this,"raycastHits",[]),p(this,"ignoreSkinnedMeshes",!1)}start(){this.targets=[this.gameObject]}performRaycast(e=null){if(!this.targets)return null;e??(e=new yc),e.targets=this.targets,e.results=this.raycastHits,e.useAcceleratedRaycast=!0;const i=e.testObject;this.ignoreSkinnedMeshes&&(e.testObject=r=>r instanceof Eo?"continue in children":i?i(r):!0);const s=this.context.physics.raycast(e);return e.testObject=i,s}}Q0e([T()],ra.prototype,"ignoreSkinnedMeshes",2);class iM extends ra{constructor(){super(),this.ignoreSkinnedMeshes=!0}}const lQ=class extends _A{performRaycast(n){if(!Et.active||!lQ.allow||!(n!=null&&n.ray))return null;const e=n.ray.origin,i=.015;return this.context.physics.sphereOverlap(e,i,!1,!0)}};let E0=lQ;p(E0,"allow",!0);class nM{static getObject(e){const i=e[Za];return i&&(i.isComponent===!0?e=i.gameObject:e=i),e}static isInteractable(e,i){if(i&&(i.canvasGroup=void 0,i.graphic=void 0),e==null||!e.visible||(e=this.getObject(e),!e.visible))return!1;const s=this.tryFindCanvasGroup(e);if(s?.isCanvasGroup===!0&&(i&&(i.canvasGroup=s),s.blocksRaycasts===!1||s.interactable===!1))return!1;const r=Tm(e,o=>{if(o.isGraphic===!0)return o},!1);return i&&r?.isGraphic===!0&&(i.graphic=r),!(r?.raycastTarget===!1||r?.layer===2)}static tryFindCanvasGroup(e){if(!e)return null;const i=Tm(e,s=>{const r=s;if(r.blocksRaycasts!==void 0&&r.interactable!==void 0)return r},!1);return i!==void 0?i:this.tryFindCanvasGroup(e.parent)}}function oD(n){return n[Za]||(n.parent?oD(n.parent):null)}function Z0e(n){return n.isUI===!0||typeof n[Za]=="object"}function sM(n,e){if(!n)return;const i=n.material;if(i?.isMaterial===!0){const s=n.parent;s&&s.isText,i.side=e.doubleSided??!0?xi:Un,i.shadowSide=e.doubleSided?xi:Un,n.castShadow=e.castShadows?e.castShadows:!1,n.receiveShadow=e.receiveShadows?e.receiveShadows:!1}for(const s of n.children)sM(s,e)}function T0(n,e,i){n[e]===void 0&&console.warn("Field",e,"is undefined on",n);const s=Proxy.revocable(n[e],{set(a,l,c,h){const u=a[l],d=Reflect.set(a,l,c,h);return i(c,u),d}}),r=s.revoke,o=n[e];return s.revoke=()=>{n[e]=o,r()},n[e]=s.proxy,s}const cQ=Symbol("Scheduled action");function Y0e(n,e,i=Yi.OnBeforeRender){let s=n[cQ];s||(s=n[cQ]={});const r=e.name;s[i]||(s[i]={});const o=s[i];if(o[r])return;function*a(){e?.call(n),o[r]=null}const l=n.startCoroutine(a(),i);o[r]=l}const Qh=te("debugeventsystem");var aD=(n=>(n.BeforeHandleInput="BeforeHandleInput",n.AfterHandleInput="AfterHandleInput",n))(aD||{});const Zh=class extends Pe{constructor(){super(),p(this,"raycaster",[]),p(this,"pressedByID",new Map),p(this,"hoveredByID",new Map),p(this,"onPointerEvent",n=>{if(n===void 0||n.propagationStopped||n.defaultPrevented||n.used)return;const e=new Uy(this.context.input,n);this._currentPointerEventName=n.type,e.inputSource=this.context.input,e.isClick=n.isClick,e.isDoubleClick=n.isDoubleClick,e.isDown=n.type==yn.PointerDown,e.isUp=n.type==yn.PointerUp,e.isPressed=this.context.input.getPointerPressed(n.pointerId),Qh&&(e.isDown?console.log("DOWN",e.pointerId):e.isUp&&console.log("UP",e.pointerId),e.isClick&&console.log("CLICK",e.pointerId));const i=new yc;n.hasRay?i.ray=n.ray:i.screenPoint=this.context.input.getPointerPositionRC(n.pointerId);const s=this.performRaycast(i);if(s){for(const o of s)o.event=n,n.intersections.push(o);n.origin.onPointerHits&&n.origin.onPointerHits({sender:this,event:n,hits:s})}Qh&&e.isClick&&gn("EventSystem: "+e.pointerId+" - "+this.context.time.frame+" - Up:"+e.isUp+", Down:"+e.isDown);const r={sender:this,args:e,hasActiveUI:this.currentActiveMeshUIComponents.length>0};this.dispatchEvent(new CustomEvent("BeforeHandleInput",{detail:r})),this.handleIntersections(s,e),this.dispatchEvent(new CustomEvent("AfterHandleInput",{detail:r}))}),p(this,"_sortedHits",[]),p(this,"_testObjectsCache",new Map),p(this,"_currentlyActiveRaycaster",null),p(this,"_currentPointerEventName",null),p(this,"shouldRaycastObject",n=>{var e;let i=null;if(Z0e(n)&&(i=(e=n[Za])==null?void 0:e.gameObject),this._testObjectsCache.has(n)||i&&this._testObjectsCache.has(i))return this._testObjectsCache.get(n)===!1?"continue in children":!0;{let s=qC(n,this._currentPointerEventName);if(!s&&i&&(s=qC(i,this._currentPointerEventName)),s){this._testObjectsCache.set(n,!0);for(const r of n.children)this.shouldRaycastObject_AddToYesCache(r);return!0}return this._testObjectsCache.set(n,!1),"continue in children"}}),p(this,"_sortingBuffer",[]),p(this,"_noDepthTestingResults",[]),p(this,"out",{}),p(this,"_capturedPointer",{}),p(this,"pointerEnterSymbol",Symbol("pointerEnter")),p(this,"pointerExitSymbol",Symbol("pointerExit")),p(this,"currentActiveMeshUIComponents",[]),Zh.systems.push(this)}static createIfNoneExists(n){this.didSearchEventSystem||(this.didSearchEventSystem=!0,Zh.systems.length<=0&&Zh.systems.push(...ie.findObjectsOfType(Zh,n)));for(const i of Zh.systems)if(i.context===n)return;const e=new ye;ie.addComponent(e,Zh),n.scene.add(e)}static get systems(){const n=Pt.Current;return this._eventSystemMap.has(n)||this._eventSystemMap.set(n,[]),this._eventSystemMap.get(n)}static get(n){const e=this._eventSystemMap.get(n);return e&&e.length>0?e[0]:null}static get instance(){return this.systems[0]}static ensureUpdateMeshUI(n,e,i=!1){Rd.update(n,e,i)}static markUIDirty(n){Rd.markDirty()}get hasActiveUI(){return this.currentActiveMeshUIComponents.length>0}get isHoveringObjects(){return this.hoveredByID.size>0}onDestroy(){Zh.systems.splice(Zh.systems.indexOf(this),1)}start(){if(this.raycaster.length<=0&&!ie.findObjectOfType(_A,this.context)){const n=ie.addComponent(this.context.scene,ra);this.raycaster.push(n),(Ye()||Qh)&&console.warn("Added an ObjectRaycaster to the scene because no raycaster was found.")}}register(n){var e;n&&this.raycaster&&!this.raycaster.includes(n)&&((e=this.raycaster)==null||e.push(n))}unregister(n){var e,i;const s=(e=this.raycaster)==null?void 0:e.indexOf(n);s!==void 0&&s!==-1&&((i=this.raycaster)==null||i.splice(s,1))}onEnable(){this.context.input.addEventListener(yn.PointerDown,this.onPointerEvent),this.context.input.addEventListener(yn.PointerUp,this.onPointerEvent),this.context.input.addEventListener(yn.PointerMove,this.onPointerEvent)}onDisable(){this.context.input.removeEventListener(yn.PointerDown,this.onPointerEvent),this.context.input.removeEventListener(yn.PointerUp,this.onPointerEvent),this.context.input.removeEventListener(yn.PointerMove,this.onPointerEvent)}onBeforeRender(){this.resetMeshUIStates()}shouldRaycastObject_AddToYesCache(n){this._testObjectsCache.set(n,!0);for(const e of n.children)this.shouldRaycastObject_AddToYesCache(e)}performRaycast(n){if(!this.raycaster)return null;this._testObjectsCache.clear(),this._sortedHits.length=0,n||(n=new yc),n.testObject=this.shouldRaycastObject;for(const e of this.raycaster){if(!e.activeAndEnabled)continue;this._currentlyActiveRaycaster=e;const i=e.performRaycast(n);this._currentlyActiveRaycaster=null,i&&i.length>0&&this._sortedHits.push(...i)}return this._sortedHits.sort((e,i)=>e.distance-i.distance),this._sortedHits}assignHitInformation(n,e){e?(n.intersection=e,n.point=e.point,n.normal=e.normal,n.face=e.face,n.distance=e.distance,n.instanceId=e.instanceId):(n.intersection=void 0,n.point=void 0,n.normal=void 0,n.face=void 0,n.distance=void 0,n.instanceId=void 0)}handleIntersections(n,e){var i;if(n!=null&&n.length){n=this.sortCandidates(n);for(const r of n){if(e.event.immediatePropagationStopped)return!1;if(this.assignHitInformation(e,r),this.handleEventOnObject(r.object,e))return!0}}this.assignHitInformation(e,n?.[0]),this.invokePointerCapture(e);const s=this.hoveredByID.get(e.pointerId);return s&&this.propagatePointerExit(s.obj,s.data,null),this.hoveredByID.delete(e.pointerId),e.isUp&&((i=this.pressedByID.get(e.pointerId))==null||i.handlers.forEach(r=>this.invokeOnPointerUp(e,r)),this.pressedByID.delete(e.pointerId)),!1}sortCandidates(n){this._sortingBuffer.length=0,this._noDepthTestingResults.length=0;for(let e=0;e<n.length;e++){const i=n[e],s=i.object;if(s.material&&s.material.depthTest===!1){this._noDepthTestingResults.push(i);continue}this._sortingBuffer.push(i)}for(const e of this._sortingBuffer)this._noDepthTestingResults.push(e);return this._noDepthTestingResults}handleEventOnObject(n,e){if(!this.testIsVisible(n))return e.isClick&&Qh&&console.log("not allowed",n),!1;if(e.pointerId===void 0)return Qh&&console.error("Event without pointer can't be handled",e),!1;e.object=n;const i=n.parent,s=e.isClick??!1;let r=null;if(i&&i.isUI){const c=(e.isPressed||e.isClick)??!1;if(i[Za]){const h=i[Za].gameObject;if(h){if(!nM.isInteractable(h,this.out))return!1;r=this.out.canvasGroup??null,this.handleMeshUIIntersection(n,c),n=h}}}s&&Qh&&console.log(this.context.time.frame,n);const o=this.hoveredByID.get(e.pointerId),a=o?.obj;a!==n&&a&&this.propagatePointerExit(a,o.data,n);const l=this.hoveredByID.get(e.pointerId);if(l?(l.obj=n,l.data=e):this.hoveredByID.set(e.pointerId,{obj:n,data:e}),e.isDown){const c=this.pressedByID.get(e.pointerId);c?(c.obj=n,c.data=e):this.pressedByID.set(e.pointerId,{obj:n,data:e,handlers:new Set})}return(r===null||r.interactable)&&this.handleMainInteraction(n,e,a??null),!0}propagate(n,e){for(;n;)ie.foreachComponent(n,i=>{e(i)},!1),n=n.parent}handleMainInteraction(n,e,i){const s=this.pressedByID.get(e.pointerId),r=i!==n;let o=!0;switch(e.event.pointerType){case"mouse":case"touch":const a=this.context.input.getPointerPositionLastFrame(e.pointerId),l=this.context.input.getPointerPosition(e.pointerId);o=a&&!tt.approximately(a,l);break}this.propagate(n,a=>{var l;const c=a;c.interactable!==!1&&(!c.activeAndEnabled||!c.enabled||(c.onPointerEnter&&r&&this.handlePointerEnter(c,e),e.isDown&&c.onPointerDown&&(c.onPointerDown(e),s?.handlers.add(c),this.handlePointerCapture(e,c)),c.onPointerMove&&(o&&c.onPointerMove(e),this.handlePointerCapture(e,c)),e.isUp&&(c.onPointerUp&&(this.invokeOnPointerUp(e,c),s?.handlers.delete(c)),c.onPointerExit&&((l=e.event)==null?void 0:l.pointerType)===_S.Touch&&(this.handlePointerExit(c,e),this.hoveredByID.delete(e.pointerId))),e.isClick&&c.onPointerClick&&c.onPointerClick(e)))}),e.isUp&&(s?.handlers.forEach(a=>{this.invokeOnPointerUp(e,a)}),this.pressedByID.delete(e.pointerId))}propagatePointerExit(n,e,i){this.propagate(n,s=>{if(!s.gameObject||s.destroyed)return;const r=s;if(r.onPointerExit||r.onPointerEnter){if(i&&this.isChild(i,s.gameObject))return;this.handlePointerExit(r,e)}})}invokeOnPointerUp(n,e){var i;(i=e.onPointerUp)==null||i.call(e,n),this.releasePointerCapture(n,e)}handlePointerEnter(n,e){n.onPointerEnter&&this.updatePointerState(n,e.pointerId,this.pointerEnterSymbol,!0)&&n.onPointerEnter(e),this.updatePointerState(n,e.pointerId,this.pointerExitSymbol,!1)}handlePointerExit(n,e){n.onPointerExit&&this.updatePointerState(n,e.pointerId,this.pointerExitSymbol,!0)&&n.onPointerExit(e),this.updatePointerState(n,e.pointerId,this.pointerEnterSymbol,!1)}updatePointerState(n,e,i,s){let r=n[i];if(s)return r&&r.includes(e)?!1:(r=r||[],r.push(e),n[i]=r,!0);{if(!r||!r.includes(e))return!1;const o=r.indexOf(e);return o!==-1&&r.splice(o,1),!0}}handlePointerCapture(n,e){if(n.z__pointer_ctured){n.z__pointer_ctured=!1;const i=n.pointerId;if(e.onPointerMove){const s=this._capturedPointer[i]||[];s.push(e),this._capturedPointer[i]=s}else Ye()&&!e.z__warned_no_pointermove&&(e.z__warned_no_pointermove=!0,console.warn("PointerCapture was requested but the component doesn't implement onPointerMove. It will not receive any pointer events"))}else n.z__pointer_cture_rleased&&(n.z__pointer_cture_rleased=!1,this.releasePointerCapture(n,e))}releasePointerCapture(n,e){const i=n.pointerId;if(this._capturedPointer[i]){const s=this._capturedPointer[i].indexOf(e);s!==-1&&(this._capturedPointer[i].splice(s,1),Qh&&console.log("released pointer capture",i,e,this._capturedPointer))}}invokePointerCapture(n){var e;if(n.event.type===yn.PointerMove){const i=n.pointerId,s=this._capturedPointer[i];if(s){Qh&&console.log("Captured",i,s);for(let r=0;r<s.length;r++){const o=s[r];if(o.destroyed){s.splice(r,1),r--;continue}(e=o.onPointerMove)==null||e.call(o,n)}}}}isChild(n,e){return!n||!e?!1:n===e?!0:n.parent?this.isChild(n.parent,e):!1}handleMeshUiObjectWithoutShadowDom(n,e){return!n||!n.isUI?!0:this.handleMeshUIIntersection(n,e)}handleMeshUIIntersection(n,e){const i=Rd.updateState(n,e);return i&&this.currentActiveMeshUIComponents.push(i),i!==null}resetMeshUIStates(){if(this.context.input.getPointerPressedCount()>0&&Rd.resetLastSelected(),!(!this.currentActiveMeshUIComponents||this.currentActiveMeshUIComponents.length<=0)){for(let n=0;n<this.currentActiveMeshUIComponents.length;n++){const e=this.currentActiveMeshUIComponents[n];Rd.resetState(e)}this.currentActiveMeshUIComponents.length=0}}testIsVisible(n){return n?ie.isActiveSelf(n)?this.testIsVisible(n.parent):!1:!0}};let Ya=Zh;p(Ya,"_eventSystemMap",new Map),p(Ya,"didSearchEventSystem",!1);class Rd{static markDirty(){this.needsUpdate=!0}static update(e,i,s=!1){if(s){e.update();return}const r=i.time.frameCount;for(const o of this.lastUpdateFrame)if(o.context===i){if(r===o.frame)return;o.frame=r;let a=this.needsUpdate||r<1;o.nextUpdate<=r&&(a=!0),a&&(Qh&&console.log("Update threemeshui"),this.needsUpdate=!1,o.nextUpdate=r+60,e.update());return}this.lastUpdateFrame=[{context:i,frame:r,nextUpdate:r+60}],e.update(),this.needsUpdate=!1}static updateState(e,i){let s=null;if(e&&(s=this.findBlockInParent(e),s&&s!==this.lastSelected)){if(s.interactable===!1)return null;this.needsUpdate=!0}return s}static resetLastSelected(){const e=this.lastSelected;e&&(this.lastSelected=null,this.resetState(e))}static resetState(e){e&&(this.needsUpdate=!0)}static findBlockInParent(e){return e?e.isBlock?e:this.findBlockInParent(e.parent):null}}p(Rd,"lastSelected",null),p(Rd,"lastUpdateFrame",[]),p(Rd,"needsUpdate",!1);var K0e=Object.defineProperty,J0e=Object.getOwnPropertyDescriptor,An=(n,e,i,s)=>{for(var r=s>1?void 0:s?J0e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&K0e(e,i,r),r};const lD=te("debugorbit"),cD=te("freecam"),rM=te("debugcamerafit"),oM=te("smoothcam"),q0e={LEFT:"",UP:"",RIGHT:"",BOTTOM:""};let hD;class SA extends CustomEvent{constructor(e,i){super("target-reached",{detail:{controls:e,type:i}})}}class Ei extends Pe{constructor(){super(...arguments),p(this,"autoTarget",!0),p(this,"autoFit",!1),p(this,"enableRotate",!0),p(this,"autoRotate",!1),p(this,"autoRotateSpeed",1),p(this,"minAzimuthAngle",1/0),p(this,"maxAzimuthAngle",1/0),p(this,"minPolarAngle",0),p(this,"maxPolarAngle",Math.PI),p(this,"enableKeys",!0),p(this,"enableDamping",!0),p(this,"dampingFactor",.1),p(this,"enableZoom",!0),p(this,"minZoom",0),p(this,"maxZoom",1/0),p(this,"zoomSpeed",1),p(this,"zoomToCursor",!1),p(this,"enablePan",!0),p(this,"lookAtConstraint",null),p(this,"lookAtConstraint01",1),p(this,"allowInterrupt",!0),p(this,"middleClickToFocus",!0),p(this,"doubleClickToFocus",!0),p(this,"clickBackgroundToFitScene",2),p(this,"debugLog",!1),p(this,"targetLerpDuration",1),p(this,"_controls",null),p(this,"_cameraObject",null),p(this,"_lookTargetLerpActive",!1),p(this,"_lookTargetStartPosition",new E),p(this,"_lookTargetEndPosition",new E),p(this,"_lookTargetLerp01",0),p(this,"_lookTargetLerpDuration",0),p(this,"_cameraLerpActive",!1),p(this,"_cameraStartPosition",new E),p(this,"_cameraEndPosition",new E),p(this,"_cameraLerp01",0),p(this,"_cameraLerpDuration",0),p(this,"_fovLerpActive",!1),p(this,"_fovLerpStartValue",0),p(this,"_fovLerpEndValue",0),p(this,"_fovLerp01",0),p(this,"_fovLerpDuration",0),p(this,"_inputs",0),p(this,"_enableTime",0),p(this,"_startedListeningToKeyEvents",!1),p(this,"_eventSystem"),p(this,"_afterHandleInputFn"),p(this,"_camera",null),p(this,"_syncedTransform"),p(this,"_didSetTarget",0),p(this,"targetElement",null),p(this,"_activePointerEvents"),p(this,"_lastTimeClickOnBackground",-1),p(this,"_clickOnBackgroundCount",0),p(this,"_onPointerDown",e=>{this._activePointerEvents.push(e)}),p(this,"_onPointerUp",e=>{for(let i=this._activePointerEvents.length-1;i>=0;i--){const s=this._activePointerEvents[i];if(s.pointerId===e.pointerId&&s.button===e.button){this._activePointerEvents.splice(i,1);break}}if(this.clickBackgroundToFitScene>0&&e.isClick&&e.button===0){if(e.hasRay||e.intersections.push(...this.context.physics.raycast()),e.intersections.length<=0){const i=this.context.time.time-this._lastTimeClickOnBackground;this._lastTimeClickOnBackground=this.context.time.time,this.clickBackgroundToFitScene<=1||i<this.clickBackgroundToFitScene*.15?(this._clickOnBackgroundCount+=1,this._clickOnBackgroundCount>=this.clickBackgroundToFitScene-1&&this.fitCamera(this.context.scene.children,{immediate:!1})):this._clickOnBackgroundCount=0}lD&&console.log(this.clickBackgroundToFitScene,e.intersections.length,this._clickOnBackgroundCount)}}),p(this,"_onPointerUpLate",e=>{this.doubleClickToFocus&&e.isDoubleClick&&!e.used&&this.setTargetFromRaycast()}),p(this,"onControlsChangeStarted",()=>{this._syncedTransform&&this._syncedTransform.requestOwnership()}),p(this,"_shouldDisable",!1),p(this,"__onPreRender",()=>{const e=this.context.pre_render_callbacks.indexOf(this.__onPreRender);e>=0&&this.context.pre_render_callbacks.splice(e,1),this.autoFit&&(this.autoFit=!1,this.fitCamera({centerCamera:"y",immediate:!0,objects:this.scene.children}))}),p(this,"_haveAttachedKeyboardEvents",!1)}get isCameraController(){return!0}get controls(){return this._controls}get controllerObject(){return this._cameraObject}onStartInteraction(e){var i;(i=this.controls)==null||i.addEventListener("start",e)}get targetLerpSpeed(){return 5}set targetLerpSpeed(e){this.targetLerpDuration=1/e}awake(){this._didSetTarget=0,this._startedListeningToKeyEvents=!1}start(){this._eventSystem=Ya.get(this.context)??void 0,this._eventSystem&&(this._afterHandleInputFn=this.afterHandleInput.bind(this),this._eventSystem.addEventListener(aD.AfterHandleInput,this._afterHandleInputFn))}onDestroy(){var e,i;(e=this._controls)==null||e.dispose(),(i=this._eventSystem)==null||i.removeEventListener(aD.AfterHandleInput,this._afterHandleInputFn)}onEnable(){this._didSetTarget=0,this._enableTime=this.context.time.time;const e=ie.getComponent(this.gameObject,Fi);this._camera=e;let i=e?.threeCamera;if(!i&&this.gameObject instanceof Lt&&(i=this.gameObject),i&&JI(i,this,!0),!this._controls&&i instanceof Lt){this._cameraObject=i;const s=this.targetElement??this.context.renderer.domElement,r=i?.quaternion.clone();this._controls=new tQ(i,s),i?.quaternion.copy(r),hD===void 0&&(hD={...this._controls.keys})}this._controls&&(cD&&(this.enablePan=!0,this.enableZoom=!0,this.middleClickToFocus=!0,xt.isMobileDevice()&&(this.doubleClickToFocus=!0)),this._controls.addEventListener("start",this.onControlsChangeStarted),this._startedListeningToKeyEvents||(this._startedListeningToKeyEvents=!0,this._controls.listenToKeyEvents(window.document.body))),this._syncedTransform=ie.getComponent(this.gameObject,Sc)??void 0,this.context.pre_render_callbacks.push(this.__onPreRender),this._activePointerEvents=[],this.context.input.addEventListener("pointerdown",this._onPointerDown,{queue:ea.Early}),this.context.input.addEventListener("pointerup",this._onPointerUp,{queue:ea.Early}),this.context.input.addEventListener("pointerup",this._onPointerUpLate,{queue:ea.Late})}onDisable(){var e;(e=this._camera)!=null&&e.threeCamera&&JI(this._camera.threeCamera,this,!1),this._controls&&(this._controls.enabled=!1,this._controls.autoRotate=!1,this._controls.removeEventListener("start",this.onControlsChangeStarted)),this._activePointerEvents.length=0,this.context.input.removeEventListener("pointerdown",this._onPointerDown),this.context.input.removeEventListener("pointerup",this._onPointerUp),this.context.input.removeEventListener("pointerup",this._onPointerUpLate)}afterHandleInput(e){e.detail.args.pointerId===0&&(e.detail.args.isDown?this._controls&&this._eventSystem&&(this._shouldDisable=this._eventSystem.hasActiveUI):(!e.detail.args.isPressed||e.detail.args.isUp)&&(this._shouldDisable=!1))}onBeforeRender(){var e,i,s,r;if(!!this._controls){if(this._cameraObject!==this.context.mainCamera){this._controls.enabled=!1;return}if(this._controls.enabled=!0,(this.context.input.getPointerDown(1)||this.context.input.getPointerDown(2)||this.context.input.mouseWheelChanged||this.context.input.getPointerPressed(0)&&(e=this.context.input.getPointerPositionDelta(0))!=null&&e.length()||0>.1)&&(this._inputs+=1),this._inputs>0&&this.allowInterrupt&&(this.enableRotate&&(this.autoRotate=!1),this._cameraLerpActive=!1,this._lookTargetLerpActive=!1),this._inputs=0,this.autoTarget&&this._didSetTarget++===0){const o=ie.getComponent(this.gameObject,Fi);if(o&&!this.setLookTargetFromConstraint()){this.debugLog&&console.log("NO TARGET");const a=zt(o.threeCamera),l=Math.max(.01,a.length()),c=new E(0,0,-l).applyMatrix4(o.threeCamera.matrixWorld);this.setLookTargetPosition(c,!0)}if(!this.setLookTargetFromConstraint()){const a=new yc;a.screenPoint=new Y(0,0),a.lineThreshold=.1;const l=this.context.physics.raycast(a);l.length>0&&this.setLookTargetPosition(l[0].point,!0),rM&&console.log("OrbitControls hits",...l)}}if(this.middleClickToFocus&&this.context.input.getPointerClicked(1)&&this.setTargetFromRaycast(),this._lookTargetLerpActive||this._cameraLerpActive||this._fovLerpActive){if(this._cameraLerpActive&&this._cameraObject)if(this._cameraLerp01+=this.context.time.deltaTime/this._cameraLerpDuration,this._cameraLerp01>=1)this._cameraObject.position.copy(this._cameraEndPosition),this._cameraLerpActive=!1,this.dispatchEvent(new SA(this,"camera"));else{const o=tt.easeInOutCubic(this._cameraLerp01);this._cameraObject.position.lerpVectors(this._cameraStartPosition,this._cameraEndPosition,o)}if(this._lookTargetLerpActive)if(this._lookTargetLerp01+=this.context.time.deltaTime/this._lookTargetLerpDuration,this._lookTargetLerp01>=1)this._controls.target.copy(this._lookTargetEndPosition),this._lookTargetLerpActive=!1,this.dispatchEvent(new SA(this,"lookat"));else{const o=tt.easeInOutCubic(this._lookTargetLerp01);this._controls.target.lerpVectors(this._lookTargetStartPosition,this._lookTargetEndPosition,o)}if(this._fovLerpActive&&this._cameraObject){const o=this._cameraObject;if(this._fovLerp01+=this.context.time.deltaTime/this._fovLerpDuration,this._fovLerp01>=1)o.fov=this._fovLerpEndValue,this._fovLerpActive=!1;else{const a=tt.easeInOutCubic(this._fovLerp01);o.fov=tt.lerp(this._fovLerpStartValue,this._fovLerpEndValue,a)}o.updateProjectionMatrix()}}if(this._controls){if(this.debugLog&&(this._controls.domElement=this.context.renderer.domElement),this._controls.enabled=!this._shouldDisable&&this._camera===this.context.mainCameraComponent&&!this.context.isInXR&&!this._activePointerEvents.some(o=>o.used),this._controls.keys=this.enableKeys?hD:q0e,this._controls.autoRotate=this.autoRotate,this._controls.autoRotateSpeed=this.autoRotateSpeed,this._controls.enableZoom=this.enableZoom,this._controls.zoomSpeed=this.zoomSpeed,this._controls.zoomToCursor=this.zoomToCursor,this._controls.enableDamping=this.enableDamping,this._controls.dampingFactor=this.dampingFactor,this._controls.enablePan=this.enablePan,this._controls.enableRotate=this.enableRotate,this._controls.minAzimuthAngle=this.minAzimuthAngle,this._controls.maxAzimuthAngle=this.maxAzimuthAngle,this._controls.minPolarAngle=this.minPolarAngle,this._controls.maxPolarAngle=this.maxPolarAngle,cD||(((s=(i=this._camera)==null?void 0:i.threeCamera)==null?void 0:s.type)==="PerspectiveCamera"?(this._controls.minDistance=this.minZoom,this._controls.maxDistance=this.maxZoom,this._controls.minZoom=0,this._controls.maxZoom=1/0):(this._controls.minDistance=0,this._controls.maxDistance=1/0,this._controls.minZoom=this.minZoom,this._controls.maxZoom=this.maxZoom)),typeof oM=="number"||oM===!0){this._controls.enableDamping=!0;const o=typeof oM=="number"?oM:.99;this._controls.dampingFactor=Math.max(.001,1-Math.min(1,o))}this.allowInterrupt||(this._lookTargetLerpActive&&(this._controls.enablePan=!1),this._cameraLerpActive&&(this._controls.enableRotate=!1,this._controls.autoRotate=!1),(this._lookTargetLerpActive||this._cameraLerpActive)&&(this._controls.enableZoom=!1)),this.context.isInXR||(!cD&&(r=this.lookAtConstraint)!=null&&r.locked&&this.setLookTargetFromConstraint(0,this.lookAtConstraint01),this._controls.update(this.context.time.deltaTime),lD&&ft.DrawWireSphere(this._controls.target,.1,65280))}}}setCameraAndLookTarget(e){if(!e||!(e instanceof ye))return;const i=zt(e),s=sL(e);this.setTargetFromRaycast(new qr(i,s)),this.setCameraTargetPosition(i)}setCameraTargetPosition(e,i=!1){var s;e&&(e instanceof ye&&(e=zt(e)),this._cameraEndPosition||(this._cameraEndPosition=new E),this._cameraEndPosition.copy(e),i===!0?(this._cameraLerpActive=!1,this._cameraObject&&this._cameraObject.position.copy(this._cameraEndPosition)):this._cameraObject&&(this._cameraLerpActive=!0,this._cameraLerp01=0,this._cameraStartPosition.copy((s=this._cameraObject)==null?void 0:s.position),typeof i=="number"?this._cameraLerpDuration=i:this._cameraLerpDuration=this.targetLerpDuration))}get cameraLerpActive(){return this._cameraLerpActive}stopCameraLerp(){this._cameraLerpActive=!1}setFieldOfView(e,i=!1){var s;if(!this._controls||typeof e!="number")return;const r=(s=this._camera)==null?void 0:s.threeCamera;r&&(i===!0?r.fov=e:(this._fovLerpActive=!0,this._fovLerp01=0,this._fovLerpStartValue=r.fov,this._fovLerpEndValue=e,typeof i=="number"?this._fovLerpDuration=i:this._fovLerpDuration=this.targetLerpDuration))}setLookTargetPosition(e=null,i=!1){this._controls&&e&&(e instanceof ye&&(e=zt(e)),this._lookTargetEndPosition.copy(e),this._didSetTarget++,lD&&(console.warn("OrbitControls: setLookTargetPosition",e,i),ft.DrawWireSphere(this._lookTargetEndPosition,.2,16711680,2)),i===!0?this._controls.target.copy(this._lookTargetEndPosition):(this._lookTargetLerpActive=!0,this._lookTargetLerp01=0,this._lookTargetStartPosition.copy(this._controls.target),typeof i=="number"?this._lookTargetLerpDuration=i:this._lookTargetLerpDuration=this.targetLerpDuration))}get lookTargetLerpActive(){return this._lookTargetLerpActive}stopLookTargetLerp(){this._lookTargetLerpActive=!1}setLookTargetFromConstraint(e=0,i=1){var s;if(!this._controls)return!1;const r=(s=this.lookAtConstraint)==null?void 0:s.sources;if(r&&r.length>0){const o=r[e];if(o)return o.getWorldPosition(this._lookTargetEndPosition),this.lerpLookTarget(this._lookTargetEndPosition,i),!0}return!1}lerpTarget(e,i){return this.lerpLookTarget(e,i)}lerpLookTarget(e,i){this._controls&&(i>=1?this._controls.target.copy(e):this._controls.target.lerp(e,i))}setTargetFromRaycast(e){if(!this.controls)return;const i=e?this.context.physics.raycastFromRay(e):this.context.physics.raycast();for(const s of i)if(s.distance>0&&ie.isActiveInHierarchy(s.object)){const r=oD(s.object);if(r){const o=r.canvas;if(o!=null&&o.screenspace)break}this.setLookTargetPosition(s.point);break}}fitCamera(e,i){var s,r;if(this.context.isInXR)return;let o;if(Array.isArray(e)?o=e:e&&"type"in e?o=e.children:e&&"objects"in e&&(o=e?.objects,i=e),o&&!Array.isArray(o)&&(o=o.children),(!Array.isArray(o)||o&&o.length<=0)&&(o=this.context.scene.children),!Array.isArray(o)||o.length<=0){console.warn("No objects to fit camera to...");return}const a=this._cameraObject,l=this._controls;if(!a||!l){console.warn("No camera or controls found to fit camera to objects...");return}i||(i={});const{immediate:c=!1,centerCamera:h="y",cameraNearFar:u="auto",fitOffset:d=1.1,fov:m=a?.fov}=i,f=new E,g=new E,y=Ba(o,void 0,(r=(s=this._camera)==null?void 0:s.threeCamera)==null?void 0:r.layers),v=y.clone();a.updateMatrixWorld(),a.updateProjectionMatrix(),y.getCenter(g);const b=new E;if(y.getSize(b),y.applyMatrix4(a.matrixWorldInverse),y.getSize(f),y.setFromCenterAndSize(g,f),Number.isNaN(f.x)||Number.isNaN(f.y)||Number.isNaN(f.z)){console.warn("Camera fit size resultet in NaN",a,y,[...o]);return}if(f.length()<=1e-10){rM&&console.warn("Camera fit size is zero",y,[...o]);return}const A=i.fov||a.fov,x=2*Math.atan(Math.tan(A*Math.PI/360/2)*a.aspect)/Math.PI*360,w=f.y/(2*Math.atan(Math.PI*A/360)),_=f.x/(2*Math.atan(Math.PI*x/360)),S=d*Math.max(w,_)+f.z/2;rM&&console.log("Fit camera to objects",{fitHeightDistance:w,fitWidthDistance:_,distance:S,verticalFov:A,horizontalFov:x}),this.maxZoom=S*10,this.minZoom=S*.01;const M=.05,R=g.clone();if(R.y-=f.y*M,this.setLookTargetPosition(R,c),this.setFieldOfView(i.fov,c),this.autoTarget=!1,u==null||u=="auto"){const z=ie.findObjectOfType(wc),D=z?z.radius:0,W=Math.max(b.x,b.y,b.z,D);a.near=S/100,a.far=W+S*10,z&&(this.maxZoom=Math.max(Math.min(this.maxZoom,D*.5),S))}const P=l.getDistance();P<this.minZoom&&(this.minZoom=P*.9),P>this.maxZoom&&(this.maxZoom=P*1.1),a.updateMatrixWorld(),a.updateProjectionMatrix();const C=zt(a),L=g.clone();L.sub(C),h==="y"&&(L.y=0),L.normalize(),L.multiplyScalar(S),h==="y"&&(L.y+=-M*4*S);let B=g.clone().sub(L);if(a.parent&&(B=a.parent.worldToLocal(B)),this.setCameraTargetPosition(B,c),rM){const z=new rI(y);this.context.scene.add(z),aL(z,Vv(a)),setTimeout(()=>{this.context.scene.remove(z)},1e4),ft.DrawWireBox3(v,65280,10),this._haveAttachedKeyboardEvents||(this._haveAttachedKeyboardEvents=!0,document.body.addEventListener("keydown",D=>{if(D.code==="KeyF"){let W;this._cameraObject instanceof Lt&&(W=Math.random()*Math.random()*170+10),this.fitCamera({objects:o,fitOffset:d,immediate:!1,fov:W})}D.code==="KeyV"&&this._cameraObject instanceof Lt&&(this._cameraObject.fov=60)}))}l.update()}}An([T()],Ei.prototype,"autoTarget",2),An([T()],Ei.prototype,"autoFit",2),An([T()],Ei.prototype,"enableRotate",2),An([T()],Ei.prototype,"autoRotate",2),An([T()],Ei.prototype,"autoRotateSpeed",2),An([T()],Ei.prototype,"minAzimuthAngle",2),An([T()],Ei.prototype,"maxAzimuthAngle",2),An([T()],Ei.prototype,"minPolarAngle",2),An([T()],Ei.prototype,"maxPolarAngle",2),An([T()],Ei.prototype,"enableKeys",2),An([T()],Ei.prototype,"enableDamping",2),An([T()],Ei.prototype,"dampingFactor",2),An([T()],Ei.prototype,"enableZoom",2),An([T()],Ei.prototype,"minZoom",2),An([T()],Ei.prototype,"maxZoom",2),An([T()],Ei.prototype,"zoomSpeed",2),An([T()],Ei.prototype,"enablePan",2),An([T(Dm)],Ei.prototype,"lookAtConstraint",2),An([T()],Ei.prototype,"lookAtConstraint01",2),An([T()],Ei.prototype,"allowInterrupt",2),An([T()],Ei.prototype,"middleClickToFocus",2),An([T()],Ei.prototype,"doubleClickToFocus",2),An([T()],Ei.prototype,"clickBackgroundToFitScene",2),An([T()],Ei.prototype,"targetLerpDuration",2);var $0e=Object.defineProperty,eye=Object.getOwnPropertyDescriptor,go=(n,e,i,s)=>{for(var r=s>1?void 0:s?eye(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&$0e(e,i,r),r},Id=(n=>(n[n.None=0]="None",n[n.Skybox=1]="Skybox",n[n.SolidColor=2]="SolidColor",n[n.Uninitialized=4]="Uninitialized",n))(Id||{});const Ld=te("debugcam"),hQ=te("debugscreenpointtoray");var aM;const CA=(aM=class extends Pe{constructor(){super(...arguments),p(this,"_nearClipPlane",.1),p(this,"_farClipPlane",1e3),p(this,"orthographic",!1),p(this,"orthographicSize",5),p(this,"ARBackgroundAlpha",0),p(this,"_cullingMask",4294967295),p(this,"_backgroundBlurriness"),p(this,"_backgroundIntensity"),p(this,"_backgroundRotation"),p(this,"_environmentIntensity"),p(this,"_targetTexture",null),p(this,"_backgroundColor"),p(this,"_fov"),p(this,"_cam",null),p(this,"_clearFlags",2),p(this,"_skybox"),p(this,"_frustum"),p(this,"_projScreenMatrix",new he)}get isCamera(){return!0}get aspect(){return this._cam instanceof Lt?this._cam.aspect:this.context.domWidth/this.context.domHeight}set aspect(n){this._cam instanceof Lt&&this._cam.aspect!==n&&(this._cam.aspect=n,this._cam.updateProjectionMatrix())}get fieldOfView(){return this._cam instanceof Lt?this._cam.fov:this._fov}set fieldOfView(n){const e=this.fieldOfView!=n;if(this._fov=n,e&&this._cam&&this._cam instanceof Lt){if(this._fov===void 0){console.warn("Can not set undefined fov on PerspectiveCamera");return}this._cam.fov=this._fov,this._cam.updateProjectionMatrix()}}get nearClipPlane(){return this._nearClipPlane}set nearClipPlane(n){const e=this._nearClipPlane!=n;this._nearClipPlane=n,this._cam&&(e||this._cam.near!=n)&&(this._cam.near=n,this._cam.updateProjectionMatrix())}applyClippingPlane(){this._cam&&(this._cam.near=this._nearClipPlane,this._cam.far=this._farClipPlane,this._cam.updateProjectionMatrix())}get farClipPlane(){return this._farClipPlane}set farClipPlane(n){const e=this._farClipPlane!=n;this._farClipPlane=n,this._cam&&(e||this._cam.far!=n)&&(this._cam.far=n,this._cam.updateProjectionMatrix())}get clearFlags(){return this._clearFlags}set clearFlags(n){n!==this._clearFlags&&(this._clearFlags=n,this.applyClearFlagsIfIsActiveCamera())}set cullingMask(n){this._cullingMask=n,this._cam&&(this._cam.layers.mask=n)}get cullingMask(){return this._cam?this._cam.layers.mask:this._cullingMask}set cullingLayer(n){this.cullingMask=(1<<n|0)>>>0}set backgroundBlurriness(n){n!==this._backgroundBlurriness&&(n===void 0?this._backgroundBlurriness=void 0:this._backgroundBlurriness=Math.min(Math.max(n,0),1),this.applyClearFlagsIfIsActiveCamera())}get backgroundBlurriness(){return this._backgroundBlurriness}set backgroundIntensity(n){n!==this._backgroundIntensity&&(n===void 0?this._backgroundIntensity=void 0:this._backgroundIntensity=Math.min(Math.max(n,0),10),this.applyClearFlagsIfIsActiveCamera())}get backgroundIntensity(){return this._backgroundIntensity}set backgroundRotation(n){n!==this._backgroundRotation&&(n===void 0?this._backgroundRotation=void 0:this._backgroundRotation=n,this.applyClearFlagsIfIsActiveCamera())}get backgroundRotation(){return this._backgroundRotation}set environmentIntensity(n){this._environmentIntensity=n}get environmentIntensity(){return this._environmentIntensity}get backgroundColor(){return this._backgroundColor??null}set backgroundColor(n){if(n){if(this._backgroundColor)this._backgroundColor.copy(n);else{if(!n.clone)return;this._backgroundColor=n.clone()}n.alpha===void 0&&(this._backgroundColor.alpha=1),this.applyClearFlagsIfIsActiveCamera()}}set targetTexture(n){this._targetTexture=n}get targetTexture(){return this._targetTexture}get cam(){return this.threeCamera}get threeCamera(){return this.activeAndEnabled&&this.buildCamera(),this._cam}screenPointToRay(n,e,i){const s=this.threeCamera,r=CA._origin;r.set(n,e,-1),this.context.input.convertScreenspaceToRaycastSpace(r),hQ&&console.log("screenPointToRay",n.toFixed(2),e.toFixed(2),"now:",r.x.toFixed(2),r.y.toFixed(2),"isInXR:"+this.context.isInXR),r.z=-1,r.unproject(s);const o=CA._direction.set(r.x,r.y,r.z),a=zt(s);return o.sub(a),o.normalize(),i?(i.set(a,o),i):new qr(a.clone(),o.clone())}getFrustum(){return this._frustum||(this._frustum=new Bp,this.updateFrustum()),this._frustum}updateFrustum(){this._frustum||(this._frustum=new Bp),this._frustum.setFromProjectionMatrix(this.getProjectionScreenMatrix(this._projScreenMatrix,!0),this.context.renderer.coordinateSystem)}getProjectionScreenMatrix(n,e){return e&&this._projScreenMatrix.multiplyMatrices(this.threeCamera.projectionMatrix,this.threeCamera.matrixWorldInverse),n===this._projScreenMatrix?n:n.copy(this._projScreenMatrix)}awake(){hQ&&window.addEventListener("pointerdown",n=>{const e=n.clientX,i=n.clientY;console.log("touch",e.toFixed(2),i.toFixed(2));const s=this.screenPointToRay(e,i),r="#"+Math.floor(Math.random()*16777215).toString(16);ft.DrawRay(s.origin,s.direction,r,10)})}onEnable(){Ld&&console.log(`Camera enabled: "${this.name}". ClearFlags=${Id[this._clearFlags]}`,this),this.buildCamera(),(this.tag=="MainCamera"||!this.context.mainCameraComponent)&&(this.context.setCurrentCamera(this),iye(this)),this.applyClearFlagsIfIsActiveCamera({applySkybox:!0})}onDisable(){this.context.removeCamera(this)}onBeforeRender(){if(this._cam&&(this._frustum&&this.updateFrustum(),this._clearFlags===2&&this.applyClearFlagsIfIsActiveCamera(),this._targetTexture)){this.context.isManagedExternally&&(this._warnedAboutExternalRenderer||(this._warnedAboutExternalRenderer=!0,console.warn("Rendering with external renderer is not supported yet. This may not work or throw errors. Please remove the the target texture from your camera: "+this.name,this.targetTexture))),this.context.composer;const n=this.context.renderer;if(n){const e=this.context.mainCameraComponent;this.applyClearFlags(),this._targetTexture.render(this.context.scene,this._cam,n),e?.applyClearFlags()}}}buildCamera(){if(this._cam)return;const n=this.gameObject.isCamera;let e=null;if(n?(e=this.gameObject,e?.layers.enableAll(),e instanceof Lt&&(this._fov=e.fov)):e=this.gameObject.children[0],e&&e.isCamera)e instanceof Lt&&(this._fov&&(e.fov=this._fov),e.near=this._nearClipPlane,e.far=this._farClipPlane,e.updateProjectionMatrix());else if(!this.orthographic)e=new Lt(this.fieldOfView,window.innerWidth/window.innerHeight,this._nearClipPlane,this._farClipPlane),this.fieldOfView&&(e.fov=this.fieldOfView),this.gameObject.add(e);else{const i=this.orthographicSize*100;e=new ic(window.innerWidth/-i,window.innerWidth/i,window.innerHeight/i,window.innerHeight/-i,this._nearClipPlane,this._farClipPlane),this.gameObject.add(e)}this._cam=e,this._cam.layers.mask=this._cullingMask,this.tag=="MainCamera"&&this.context.setCurrentCamera(this)}applyClearFlagsIfIsActiveCamera(n){this.context.mainCameraComponent===this&&this.applyClearFlags(n)}applyClearFlags(n){var e;if(!this._cam){Ld&&console.log("Camera does not exist (apply clear flags)");return}if(this.fieldOfView=this._fov,Ld){const i=`Camera "${this.name}" clear flags: ${Id[this._clearFlags]}`;console.debug(i)}switch(this._clearFlags){case 0:return;case 1:if(CA.backgroundShouldBeTransparent(this.context)&&(!this.ARBackgroundAlpha||this.ARBackgroundAlpha<.001)){this.context.scene.background=null,this.context.renderer.setClearColor(0,0);return}(!this.scene.background||!this._skybox||n?.applySkybox===!0)&&this.applySceneSkybox(),this._backgroundBlurriness!==void 0?this.context.scene.backgroundBlurriness=this._backgroundBlurriness:Ld&&console.warn(`Camera "${this.name}" has no background blurriness`),this._backgroundIntensity!==void 0&&(this.context.scene.backgroundIntensity=this._backgroundIntensity),this._backgroundRotation!==void 0?this.context.scene.backgroundRotation=this._backgroundRotation:Ld&&console.warn(`Camera "${this.name}" has no background intensity`);break;case 2:if(this._backgroundColor){let i=this._backgroundColor.alpha;CA.backgroundShouldBeTransparent(this.context)&&(i=this.ARBackgroundAlpha??0),this.context.scene.background=null,(e=this.context.xr)!=null&&e.isVR?this.context.renderer.setClearColor(C5(this._backgroundColor).convertLinearToSRGB()):this.context.renderer.setClearColor(this._backgroundColor,i)}else Ld&&console.warn(`Camera "${this.name}" has no background color`,this);break;case 4:this.context.scene.background=null,this.context.renderer.setClearColor(0,0);break}}applySceneSkybox(){this._skybox||(this._skybox=new tye(this)),this._skybox.apply()}static backgroundShouldBeTransparent(n){var e,i,s,r;const o=(e=n.renderer.xr)==null?void 0:e.getSession();if(!o)return!1;if(typeof o._transparent=="boolean")return o._transparent;const a=o.environmentBlendMode;Ld&&gn("Environment blend mode: "+a+" on "+navigator.userAgent);let l=a==="additive"||a==="alpha-blend";return n.isInAR&&a==="opaque"&&((i=navigator.userAgent)!=null&&i.includes("OculusBrowser")||(s=navigator.userAgent)!=null&&s.includes("Mozilla")&&(r=navigator.userAgent)!=null&&r.includes("Mobile WebXRViewer/v2"))&&(l=!0),o._transparent=l,l}},p(aM,"_origin",new E),p(aM,"_direction",new E),aM);let Fi=CA;go([T()],Fi.prototype,"aspect",1),go([T()],Fi.prototype,"fieldOfView",1),go([T()],Fi.prototype,"nearClipPlane",1),go([T()],Fi.prototype,"farClipPlane",1),go([T()],Fi.prototype,"clearFlags",1),go([T()],Fi.prototype,"orthographic",2),go([T()],Fi.prototype,"orthographicSize",2),go([T()],Fi.prototype,"ARBackgroundAlpha",2),go([T()],Fi.prototype,"cullingMask",1),go([T()],Fi.prototype,"backgroundBlurriness",1),go([T()],Fi.prototype,"backgroundIntensity",1),go([T(si)],Fi.prototype,"backgroundRotation",1),go([T()],Fi.prototype,"environmentIntensity",1),go([T(Ii)],Fi.prototype,"backgroundColor",1),go([T(C0)],Fi.prototype,"targetTexture",1);class tye{constructor(e){p(this,"_camera"),p(this,"_skybox"),this._camera=e}get context(){var e;return(e=this._camera)==null?void 0:e.context}apply(){this._skybox=this.context.lightmaps.tryGetSkybox(this._camera.sourceId),this._skybox?this.context.scene.background!==this._skybox&&(Ld&&console.log(`Camera "${this._camera.name}" set skybox`,this._camera,this._skybox),this._skybox.mapping=Kr,this.context.scene.background=this._skybox):this._did_log_failed_to_find_skybox||(this._did_log_failed_to_find_skybox=!0,console.warn(`Camera "${this._camera.name}" has no skybox texture. ${this._camera.sourceId}`))}}function iye(n){te("freecam")&&n.context.mainCameraComponent===n&&ie.getOrAddComponent(n.gameObject,Ei)}class Pd extends Pe{constructor(){super(...arguments),p(this,"_listener",null),p(this,"onInteraction",()=>{this.destroyed||this.listener==null||this.addListenerIfItExists()})}get listener(){return this._listener==null&&(this._listener=new GN),this._listener}onEnable(){Uh.registerWaitForInteraction(this.onInteraction),this.addListenerIfItExists()}onDisable(){Uh.unregisterWaitForInteraction(this.onInteraction),this.removeListenerIfItExists()}addListenerIfItExists(){const e=this._listener;if(!e||e!=null&&e.parent)return;const i=this.context.mainCameraComponent||ie.getComponentInParent(this.gameObject,Fi);i!=null&&i.threeCamera?i.threeCamera.add(e):this.gameObject.add(e),e.filter?(e.gain.connect(e.filter),e.filter.connect(e.context.destination)):e.gain.connect(e.context.destination)}removeListenerIfItExists(){const e=this._listener;e&&(e.removeFromParent(),e.filter&&e.filter.disconnect(),e.gain&&e.gain.disconnect())}}var nye=Object.defineProperty,sye=Object.getOwnPropertyDescriptor,Fl=(n,e,i,s)=>{for(var r=s>1?void 0:s?sye(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&nye(e,i,r),r};const Nr=te("debugaudio"),Bd=class extends Pe{constructor(){super(...arguments),p(this,"clip",""),p(this,"playOnAwake",!1),p(this,"preload",!1),p(this,"playInBackground",!0),p(this,"_spatialBlend",0),p(this,"_minDistance",1),p(this,"_maxDistance",100),p(this,"_volume",1),p(this,"rollOffMode",0),p(this,"_loop",!1),p(this,"sound",null),p(this,"helper",null),p(this,"wasPlaying",!1),p(this,"audioLoader",null),p(this,"shouldPlay",!1),p(this,"_lastClipStartedLoading",null),p(this,"_audioElement",null),p(this,"onVisibilityChanged",()=>{switch(document.visibilityState){case"hidden":(this.playInBackground===!1||xt.isMobileDevice())&&(this.wasPlaying=this.isPlaying,this.isPlaying&&this.pause());break;case"visible":Nr&&console.log("visible",this.enabled,this.playOnAwake,!this.isPlaying,Bd.userInteractionRegistered,this.wasPlaying),this.enabled&&this.playOnAwake&&!this.isPlaying&&Bd.userInteractionRegistered&&this.wasPlaying&&this.play();break}}),p(this,"onApplicationMuteChanged",()=>{var n,e;this.context.application.muted?(n=this.sound)==null||n.setVolume(0):(e=this.sound)==null||e.setVolume(this.volume)}),p(this,"createAudio",n=>{Nr&&console.log("AudioBuffer finished loading",n);const e=this.Sound;if(!e){Nr&&console.warn("Failed getting sound?",this.name);return}e.isPlaying&&e.stop(),n&&e.setBuffer(n),e.loop=this._loop,this.context.application.muted?e.setVolume(0):e.setVolume(this.volume),e.autoplay=this.shouldPlay&&Bd.userInteractionRegistered,this.applySpatialDistanceSettings(),e.isPlaying&&e.stop(),Bd.registerWaitForAllowAudio(this.__onAllowAudioCallback)}),p(this,"__onAllowAudioCallback",()=>{this.shouldPlay&&this.play()}),p(this,"_lastContextTime",0),p(this,"_hasEnded",!0),p(this,"_needUpdateSpatialDistanceSettings",!1)}static get userInteractionRegistered(){return Uh.userInteractionRegistered}static registerWaitForAllowAudio(n){Uh.registerWaitForInteraction(n)}get isPlaying(){var n;return((n=this.sound)==null?void 0:n.isPlaying)??!1}get duration(){var n,e;return(e=(n=this.sound)==null?void 0:n.buffer)==null?void 0:e.duration}get time01(){var n;const e=this.duration;return e&&this.sound?((n=this.sound)==null?void 0:n.context.currentTime)/e:0}set time01(n){const e=this.duration;e&&this.sound&&(this.time=n*e)}get time(){var n,e;return(n=this.sound)!=null&&n.source?((e=this.sound.source)==null?void 0:e.context.currentTime)-this._lastContextTime+this.sound.offset:0}set time(n){if(this.sound){if(n===this.sound.offset)return;const e=this.isPlaying;this.stop(),this.sound.offset=n,e&&this.play()}}get loop(){return this.sound&&(this._loop=this.sound.getLoop()),this._loop}set loop(n){this._loop=n,this.sound&&this.sound.setLoop(n)}get spatialBlend(){return this._spatialBlend}set spatialBlend(n){n!==this._spatialBlend&&(this._spatialBlend=n,this._needUpdateSpatialDistanceSettings=!0)}get minDistance(){return this._minDistance}set minDistance(n){this._minDistance!==n&&(this._minDistance=n,this._needUpdateSpatialDistanceSettings=!0)}get maxDistance(){return this._maxDistance}set maxDistance(n){this._maxDistance!==n&&(this._maxDistance=n,this._needUpdateSpatialDistanceSettings=!0)}get volume(){return this._volume}set volume(n){this._volume=n,this.sound&&!this.context.application.muted&&(Nr&&console.log(this.name,"audio set volume",n),this.sound.setVolume(n))}set pitch(n){this.sound&&this.sound.setPlaybackRate(n)}get pitch(){return this.sound?this.sound.getPlaybackRate():1}get Sound(){var n;if(!this.sound&&Bd.userInteractionRegistered){let e=ie.getComponent(this.context.mainCamera,Pd)??ie.findObjectOfType(Pd,this.context);!e&&this.context.mainCamera&&(e=ie.addComponent(this.context.mainCamera,Pd)),e!=null&&e.listener?(this.sound=new FN(e.listener),(n=this.gameObject)==null||n.add(this.sound)):Nr&&console.warn("No audio listener found in scene - can not play audio")}return this.sound}get ShouldPlay(){return this.shouldPlay}get audioContext(){var n;return(n=this.sound)==null?void 0:n.context}awake(){Nr&&console.log(this),this.audioLoader=new Kw,this.playOnAwake&&(this.shouldPlay=!0),this.preload&&typeof this.clip=="string"&&this.audioLoader.load(this.clip,this.createAudio,()=>{},console.error)}onEnable(){this.sound&&this.gameObject.add(this.sound),Bd.userInteractionRegistered?this.playOnAwake&&this.context.application.isVisible&&this.play():Bd.registerWaitForAllowAudio(()=>{this.enabled&&!this.destroyed&&this.shouldPlay&&this.onNewClip(this.clip)}),globalThis.addEventListener("visibilitychange",this.onVisibilityChanged),this.context.application.addEventListener(yC.MuteChanged,this.onApplicationMuteChanged)}onDisable(){globalThis.removeEventListener("visibilitychange",this.onVisibilityChanged),this.context.application.removeEventListener(yC.MuteChanged,this.onApplicationMuteChanged),this.pause()}applySpatialDistanceSettings(){const n=this.sound;if(!n)return;this._needUpdateSpatialDistanceSettings=!1;const e=tt.lerp(10*this._maxDistance/Math.max(1e-4,this.spatialBlend),this._minDistance,this.spatialBlend);switch(Nr&&console.log(this.name,this._minDistance,this._maxDistance,this.spatialBlend,"Ref distance="+e),n.setRefDistance(e),n.setMaxDistance(Math.max(.01,this._maxDistance)),this.rollOffMode){case 0:n.setDistanceModel("exponential");break;case 1:n.setDistanceModel("linear");break;case 2:console.warn("Custom rolloff for AudioSource is not supported: "+this.name);break}this.spatialBlend>0?Nr&&!this.helper&&(this.helper=new f0e(n,n.getRefDistance()),n.add(this.helper)):this.helper&&this.helper.parent&&this.helper.removeFromParent()}async onNewClip(n){if(n&&(this.clip=n),typeof n=="string")if(Nr&&console.log(n),n.endsWith(".mp3")||n.endsWith(".wav")){if(this.audioLoader||(this.audioLoader=new Kw),this.shouldPlay=!0,this._lastClipStartedLoading===n){Nr&&console.log("Is currently loading:",this._lastClipStartedLoading,this);return}this._lastClipStartedLoading=n,Nr&&console.log("load audio",n);const e=await this.audioLoader.loadAsync(n).catch(console.error);this._lastClipStartedLoading=null,e&&this.createAudio(e)}else console.warn("Unsupported audio clip type",n);else this.shouldPlay=!0,this.createAudio()}play(n=void 0){var e,i,s;!n&&this.clip&&(n=this.clip),n!==void 0&&typeof n!="string"&&!(n instanceof MediaStream)&&(Ye()&&console.warn("Called play on AudioSource with unknown argument type:",n+`
Using the assigned clip instead:`,this.clip),n=this.clip);let r=!this.sound||n&&n!==this.clip;if(typeof n=="string"&&!this.audioLoader&&(r=!0),(n instanceof MediaStream||typeof n=="string")&&(this.clip=n),r){this.shouldPlay=!0,this.onNewClip(n);return}if(this.shouldPlay=!0,this._hasEnded=!1,Nr&&console.log("play",(e=this.sound)==null?void 0:e.getVolume(),this.sound),this.sound&&!this.sound.isPlaying){const o=this.context.application.muted;o&&this.sound.setVolume(0),(i=this.gameObject)==null||i.add(this.sound),this.clip instanceof MediaStream?(this.sound.setMediaStreamSource(this.clip),this._audioElement||(this._audioElement=document.createElement("audio"),this._audioElement.style.display="none"),this._audioElement.parentNode||(s=this.context.domElement.shadowRoot)==null||s.append(this._audioElement),this._audioElement.srcObject=this.clip,this._audioElement.autoplay=!1):(this._audioElement&&this._audioElement.remove(),this.sound.play(o?.1:0))}}pause(){var n,e;Nr&&console.log("Pause",this),this._hasEnded=!0,this.shouldPlay=!1,this.sound&&this.sound.isPlaying&&this.sound.source&&(this._lastContextTime=(n=this.sound)==null?void 0:n.context.currentTime,this.sound.pause()),(e=this._audioElement)==null||e.remove()}stop(){var n,e;Nr&&console.log("Pause",this),this._hasEnded=!0,this.shouldPlay=!1,this.sound&&this.sound.source&&(this._lastContextTime=(n=this.sound)==null?void 0:n.context.currentTime,Nr&&console.log(this._lastContextTime),this.sound.stop()),(e=this._audioElement)==null||e.remove()}update(){this.helper&&(this.isPlaying&&this.helper.update(),this.helper.visible=this.isPlaying),this._needUpdateSpatialDistanceSettings&&this.applySpatialDistanceSettings(),this.sound&&!this.sound.isPlaying&&this.shouldPlay&&!this._hasEnded&&(this._hasEnded=!0,Nr&&console.log("Audio clip ended",this.clip),this.dispatchEvent(new CustomEvent("ended",{detail:this})))}};let Sn=Bd;Fl([T(URL)],Sn.prototype,"clip",2),Fl([T()],Sn.prototype,"playOnAwake",2),Fl([T()],Sn.prototype,"preload",2),Fl([T()],Sn.prototype,"playInBackground",2),Fl([T()],Sn.prototype,"loop",1),Fl([T()],Sn.prototype,"spatialBlend",1),Fl([T()],Sn.prototype,"minDistance",1),Fl([T()],Sn.prototype,"maxDistance",1),Fl([T()],Sn.prototype,"volume",1),Fl([T()],Sn.prototype,"pitch",1),Fl([T()],Sn.prototype,"rollOffMode",2);var rye=Object.defineProperty,oye=Object.getOwnPropertyDescriptor,lM=(n,e,i,s)=>{for(var r=s>1?void 0:s?oye(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&rye(e,i,r),r};const aye=te("debugsignals");class MA{constructor(){p(this,"guid")}}lM([T()],MA.prototype,"guid",2);class R0{constructor(){p(this,"signal"),p(this,"reaction")}}lM([T(MA)],R0.prototype,"signal",2),lM([T(en)],R0.prototype,"reaction",2);var uD;const Yh=(uD=class extends Pe{constructor(){super(...arguments),p(this,"events")}static invoke(n){if(Yh.receivers[n]){const e=Yh.receivers[n];if(!e)return;for(const i of e)i.invoke(n)}}awake(){aye&&console.log("SignalReceiver awake",this)}onEnable(){if(this.events)for(const n of this.events)Yh.receivers[n.signal.guid]||(Yh.receivers[n.signal.guid]=[]),Yh.receivers[n.signal.guid].push(this)}onDisable(){if(this.events){for(const n of this.events)if(Yh.receivers[n.signal.guid]){const e=Yh.receivers[n.signal.guid].indexOf(this);e>=0&&Yh.receivers[n.signal.guid].splice(e,1)}}}invoke(n){if(!this.events||!Array.isArray(this.events))return;const e=typeof n=="object"?n.guid:n;for(const i of this.events)if(i.signal.guid===e)try{if(i.reaction){if(!i.reaction.invoke){console.warn("Missing invoke - possibly a serialization error",i,this);continue}}else{console.warn("Missing reaction for signal",i,this);continue}i.reaction.invoke()}catch(s){console.error(s)}}},p(uD,"receivers",{}),uD);let I0=Yh;lM([T(R0)],I0.prototype,"events",2);var oa=(n=>(n.Activation="ActivationTrack",n.Animation="AnimationTrack",n.Audio="AudioTrack",n.Control="ControlTrack",n.Marker="MarkerTrack",n.Signal="SignalTrack",n))(oa||{}),Mc=(n=>(n[n.None=0]="None",n[n.Hold=1]="Hold",n[n.Loop=2]="Loop",n[n.PingPong=3]="PingPong",n[n.Continue=4]="Continue",n))(Mc||{}),dD=(n=>(n.Signal="SignalEmitter",n))(dD||{}),lye=Object.defineProperty,cye=Object.getOwnPropertyDescriptor,uQ=(n,e,i,s)=>{for(var r=s>1?void 0:s?cye(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&lye(e,i,r),r};const Kh=te("debugtimeline");var pD;const mD=(pD=class extends Pe{constructor(){super(...arguments),p(this,"playableAsset"),p(this,"playOnAwake"),p(this,"extrapolationMode",1),p(this,"waitForAudio",!0),p(this,"_visibilityChangeEvt"),p(this,"_clonedPlayableAsset",!1),p(this,"_speed",1),p(this,"_guidsMap"),p(this,"_isPlaying",!1),p(this,"_internalUpdateRoutine"),p(this,"_isPaused",!1),p(this,"_isStopping",!1),p(this,"_time",0),p(this,"_duration",0),p(this,"_weight",1),p(this,"_animationTracks",[]),p(this,"_audioTracks",[]),p(this,"_signalTracks",[]),p(this,"_controlTracks",[]),p(this,"_customTracks",[]),p(this,"_allTracks",[this._animationTracks,this._audioTracks,this._signalTracks,this._controlTracks,this._customTracks]),p(this,"animationCallbackReceivers",[])}static registerCreateTrack(n,e){this.createTrackFunctions[n]=e}get isPlaying(){return this._isPlaying}get isPaused(){return this._isPaused}get time(){return this._time}set time(n){typeof n=="number"&&!Number.isNaN(n)?this._time=n:(Kh||no())&&console.error("INVALID TIMELINE.TIME VALUE",n,this.name)}get duration(){return this._duration}set duration(n){this._duration=n}get weight(){return this._weight}set weight(n){this._weight=n}get speed(){return this._speed}set speed(n){this._speed=n}awake(){var n,e,i,s,r;Kh&&console.log(this,(n=this.playableAsset)==null?void 0:n.tracks),this.rebuildGraph(),!this.isValid()&&(Kh||Ye())&&(Kh?console.warn("PlayableDirector is not valid","Asset?",this.playableAsset,"Tracks:",(e=this.playableAsset)==null?void 0:e.tracks,"IsArray?",Array.isArray((i=this.playableAsset)==null?void 0:i.tracks),this):(r=(s=this.playableAsset)==null?void 0:s.tracks)!=null&&r.length?console.warn("PlayableDirector is not valid"):console.warn("PlayableDirector has no tracks"))}onEnable(){var n,e,i;for(const s of this._audioTracks)(n=s.onEnable)==null||n.call(s);for(const s of this._customTracks)(e=s.onEnable)==null||e.call(s);for(const s of this._animationTracks)(i=s.onEnable)==null||i.call(s);this.playOnAwake&&this.play(),this._visibilityChangeEvt||(this._visibilityChangeEvt=()=>{switch(document.visibilityState){case"hidden":this.setAudioTracksAllowPlaying(!1);break;case"visible":this.setAudioTracksAllowPlaying(!0);break}}),window.addEventListener("visibilitychange",this._visibilityChangeEvt)}onDisable(){var n,e,i;this.stop();for(const s of this._audioTracks)(n=s.onDisable)==null||n.call(s);for(const s of this._customTracks)(e=s.onDisable)==null||e.call(s);for(const s of this._animationTracks)(i=s.onDisable)==null||i.call(s);this._visibilityChangeEvt&&window.removeEventListener("visibilitychange",this._visibilityChangeEvt)}onDestroy(){var n;for(const e of this._allTracks)for(const i of e)(n=i.onDestroy)==null||n.call(i)}rebuildGraph(){this.isValid()&&(this.resolveBindings(),this.updateTimelineDuration(),this.setupAndCreateTrackHandlers())}async play(){if(!this.isValid())return;const n=this._isPaused==!0;if(this._isPaused=!1,!this._isPlaying){if(this._isPlaying=!0,n&&this.invokePauseChangedMethodsOnTracks(),this.waitForAudio){const e=[];for(const i of this._audioTracks){const s=i.loadAudio(this._time,1,0);s&&e.push(s)}if(e.length>0&&(await Promise.all(e),!this._isPlaying))return;for(;this._audioTracks.length>0&&this._isPlaying&&!Sn.userInteractionRegistered&&this.waitForAudio;)await oc(200)}this.invokeStateChangedMethodsOnTracks(),this._internalUpdateRoutine=this.startCoroutine(this.internalUpdate(),Yi.LateUpdate)}}pause(){this.isValid()&&(this._isPlaying=!1,!this._isPaused&&(this._isPaused=!0,this.internalEvaluate(),this.invokePauseChangedMethodsOnTracks(),this.invokeStateChangedMethodsOnTracks()))}stop(){this._isStopping=!0;for(const i of this._audioTracks)i.stop();const n=this._isPaused==!0,e=this._isPlaying;this._isPlaying&&(this._time=0,this._isPlaying=!1,this._isPaused=!1,this.internalEvaluate(),n&&this.invokePauseChangedMethodsOnTracks()),this._isPlaying=!1,this._isPaused=!1,n&&!e&&this.invokePauseChangedMethodsOnTracks(),e&&this.invokeStateChangedMethodsOnTracks(),this._internalUpdateRoutine&&this.stopCoroutine(this._internalUpdateRoutine),this._internalUpdateRoutine=null,this._isStopping=!1}evaluate(){this.internalEvaluate(!0)}isValid(){return this.playableAsset&&this.playableAsset.tracks&&Array.isArray(this.playableAsset.tracks)}*forEachTrack(){for(const n of this._allTracks)for(const e of n)yield e}get animationTracks(){return this._animationTracks}get audioTracks(){return this._audioTracks}resolveGuids(n){this._guidsMap=n}invokePauseChangedMethodsOnTracks(){var n;for(const e of this.forEachTrack())(n=e.onPauseChanged)==null||n.call(e)}invokeStateChangedMethodsOnTracks(){var n;for(const e of this.forEachTrack())(n=e.onStateChanged)==null||n.call(e,this._isPlaying)}*internalUpdate(){for(;this._isPlaying&&this.activeAndEnabled;)!this._isPaused&&this._isPlaying&&(this._time+=this.context.time.deltaTime*this.speed,this.internalEvaluate()),yield}internalEvaluate(n=!1){if(!this.isValid())return;let e=this._time;switch(this.extrapolationMode){case 0:this._speed>0?e=Math.min(e,this._duration):this._speed<0&&(e=Math.max(e,0)),this._time=e;break;case 1:e%=this._duration,this._time=e;break;case 2:if(e>this._duration){this.stop();return}break}const i=this._time;for(const s of this.playableAsset.tracks)if(!s.muted)switch(s.type){case oa.Activation:if(!n&&!this._isPlaying)continue;for(let r=0;r<s.outputs.length;r++){const o=s.outputs[r];if(typeof o=="object"){let a=!1;if(s.clips)for(const c of s.clips)c.start<=i&&i<=c.end&&(a=!0);const l=o;l.visible!==void 0&&l.visible!==a&&(l.visible=a,Kh&&console.warn(this.name,"set ActivationTrack-"+r,l.name,a,i))}}break}if(!this._isStopping)for(const s of this._animationTracks)s.evaluate(i);for(const s of this._audioTracks)s.evaluate(i);for(const s of this._signalTracks)s.evaluate(i);for(const s of this._controlTracks)s.evaluate(i);for(const s of this._customTracks)s.evaluate(i)}resolveBindings(){if(this._clonedPlayableAsset||(this._clonedPlayableAsset=!0,this.playableAsset=Dv(this.playableAsset)),!this.playableAsset||!this.playableAsset.tracks)return;const n=this.findRoot(this.gameObject);for(const e of this.playableAsset.tracks){for(let i=e.outputs.length-1;i>=0;i--){let s=e.outputs[i];if(typeof s=="string"){this._guidsMap&&this._guidsMap[s]&&(s=this._guidsMap[s]);const r=ie.findByGuid(s,n);r===null||typeof r!="object"?(e.outputs.splice(i,1),console.warn("Failed to resolve binding",s,e.name,e.type)):(Kh&&console.log("Resolved binding",s,"to",r),e.outputs[i]=r)}else if(s===null){if(e.outputs.splice(i,1),mD.createTrackFunctions[e.type])continue;e.type!==oa.Audio&&e.type!==oa.Control&&e.type!==oa.Marker&&e.type!==oa.Signal&&console.warn("Missing binding",s,e.name,e.type,this.name,this.playableAsset.name)}}if(e.type===oa.Control&&e.clips)for(let i=0;i<e.clips.length;i++){const s=e.clips[i];let r=s.asset.sourceObject;if(typeof r=="string"){this._guidsMap&&this._guidsMap[r]&&(r=this._guidsMap[r]);const o=ie.findByGuid(r,n);o===null||typeof o!="object"?console.warn("Failed to resolve sourceObject binding",r,e.name,s):(Kh&&console.log("Resolved binding",r,"to",o),s.asset.sourceObject=o)}}}}findRoot(n){return n.parent?this.findRoot(n.parent):n}updateTimelineDuration(){if(this._duration=0,!(!this.playableAsset||!this.playableAsset.tracks)){for(const n of this.playableAsset.tracks)if(n.muted!==!0){if(n.clips)for(const e of n.clips)e.end>this._duration&&(this._duration=e.end);if(n.markers)for(const e of n.markers)e.time>this._duration&&(this._duration=e.time+.001)}}}setupAndCreateTrackHandlers(){var n,e,i;if(this._animationTracks.length=0,this._audioTracks.length=0,this._signalTracks.length=0,!this.playableAsset)return;let s=ie.findObjectOfType(Pd,this.context);for(const r of this.playableAsset.tracks){const o=r.type,a=mD.createTrackFunctions[o];if(a!=null){const l=a(this,r);if(typeof l.evaluate=="function"){l.director=this,l.track=r,this._customTracks.push(l);continue}}if(r.type===oa.Animation){if(!r.clips||r.clips.length<=0){Kh&&console.warn("Animation track has no clips",r);continue}for(let l=r.outputs.length-1;l>=0;l--){let c=r.outputs[l];if(c instanceof ye){const u=ie.getOrAddComponent(c,rr);u&&(c=u)}const h=(n=c?.gameObject)==null?void 0:n.animations;if(h){const u=new cM;u.trackOffset=r.trackOffset,u.director=this,u.track=r;for(let d=0;d<r.clips.length;d++){const m=r.clips[d],f=m.asset;if(!f){console.error(`Timeline ${this.name}: clip #${d} on track "${r.name}" has no animation data`);continue}const g=f.clip;let y=g;if((typeof y=="string"||typeof y=="number")&&(y=h.find(b=>b.name===g)),Kh&&console.log(f,g,"\u2192",y),!y){console.warn("Could not find animationClip for model",m,r.name,this.name,(e=this.playableAsset)==null?void 0:e.name,h,c);continue}c instanceof rr&&c.runtimeAnimatorController&&(c.__internalDidAwakeAndStart||c.initializeRuntimeAnimatorController(),c.runtimeAnimatorController.mixer||c.runtimeAnimatorController.bind(c),u.mixer=c.runtimeAnimatorController.mixer),u.mixer||(u.mixer=new Jw(c.gameObject),this.context.animations.registerAnimationMixer(u.mixer)),u.clips.push(y),u.mixer.uncacheAction(y),u.createHooks(m.asset,y);const v=u.mixer.clipAction(y);u.actions.push(v),u.models.push(m)}this._animationTracks.push(u)}}}else if(r.type===oa.Audio){if(!r.clips||r.clips.length<=0)continue;const l=new RA;l.director=this,l.track=r,l.audioSource=r.outputs.find(c=>c instanceof Sn),this._audioTracks.push(l),s||(s=(i=this.context.mainCameraComponent)==null?void 0:i.gameObject.addComponent(Pd)),l.listener=s.listener;for(let c=0;c<r.clips.length;c++){const h=r.clips[c];l.addModel(h)}}else if(r.type===oa.Marker){const l=new IA;if(l.director=this,l.track=r,r.markers)for(const c of r.markers)switch(c.type){case dD.Signal:l.models.push(c),l.didTrigger.push(!1);break}if(l!==null&&l.models.length>0){const c=ie.getComponent(this.gameObject,I0);c&&(l.receivers.push(c),this._signalTracks.push(l))}}else if(r.type===oa.Signal){const l=new IA;if(l.director=this,l.track=r,r.markers)for(const c of r.markers)l.models.push(c),l.didTrigger.push(!1);for(const c of r.outputs)l.receivers.push(c);this._signalTracks.push(l)}else if(r.type===oa.Control){const l=new hM;if(l.director=this,l.track=r,r.clips)for(const c of r.clips)l.models.push(c);l.resolveSourceObjects(this.context),this._controlTracks.push(l)}}}setAudioTracksAllowPlaying(n){for(const e of this._audioTracks)e.onAllowAudioChanged(n)}registerAnimationCallback(n){this.animationCallbackReceivers.push(n)}unregisterAnimationCallback(n){const e=this.animationCallbackReceivers.indexOf(n);e!==-1&&this.animationCallbackReceivers.splice(e,1)}},p(pD,"createTrackFunctions",{}),pD);let kd=mD;uQ([T()],kd.prototype,"playOnAwake",2),uQ([T()],kd.prototype,"extrapolationMode",2);const Ec=te("debugtimeline");class EA{constructor(){p(this,"director"),p(this,"track")}get muted(){return this.track.muted}set muted(e){var i;e!==this.track.muted&&(this.track.muted=e,(i=this.onMuteChanged)==null||i.call(this))}*forEachClip(e=!1){var i;if((i=this.track)!=null&&i.clips)if(e)for(let s=this.track.clips.length-1;s>=0;s--)yield this.track.clips[s];else for(const s of this.track.clips)yield s}getClipTime(e,i){return i.clipIn+(e-i.start)*i.timeScale}getClipTimeNormalized(e,i){return(e-i.start)/i.duration}evaluateWeight(e,i,s,r=!0){if(i<0||i>=s.length)return 0;const o=s[i];if(r||e>=o.start&&e<=o.end){let a=1;const l=!1;if(o.easeInDuration>0){const c=Math.min((e-o.start)/o.easeInDuration,1);a*=c}if(o.easeOutDuration>0&&!l){const c=Math.min((o.end-e)/o.easeOutDuration,1);a*=c}return a}return 0}}class hye{constructor(e){p(this,"clip"),p(this,"rootPositionOffset"),p(this,"rootQuaternionOffset"),p(this,"rootStartPosition"),p(this,"rootEndPosition"),p(this,"rootStartQuaternion"),p(this,"rootEndQuaternion");const i=e.getClip();this.clip=i;const s=e.getRoot(),r=s.name+".position",o=s.name+".quaternion";Ec&&console.log(i.name,i.tracks,r);for(const a of i.tracks)if(!(a.times.length<=0)){if(a.name.endsWith(r))this.rootStartPosition=new E().fromArray(a.values,0),this.rootEndPosition=new E().fromArray(a.values,a.values.length-3),this.rootPositionOffset=this.rootEndPosition.clone().sub(this.rootStartPosition),Ec&&console.log(this.rootPositionOffset);else if(a.name.endsWith(o)&&(this.rootStartQuaternion=new Se().fromArray(a.values,0),this.rootEndQuaternion=new Se().fromArray(a.values,a.values.length-4),this.rootQuaternionOffset=this.rootEndQuaternion.clone().multiply(this.rootStartQuaternion),Ec)){const l=new si().setFromQuaternion(this.rootQuaternionOffset);console.log("ROT",l)}}}get hasOffsets(){return this.rootPositionOffset!==void 0||this.rootQuaternionOffset!==void 0}}class cM extends EA{constructor(){super(...arguments),p(this,"models",[]),p(this,"trackOffset"),p(this,"target"),p(this,"mixer"),p(this,"clips",[]),p(this,"actions",[]),p(this,"weight",1),p(this,"_actionOffsets",[]),p(this,"_didBind",!1),p(this,"_animator",null),p(this,"_useclipOffsets",!0),p(this,"_totalOffsetPosition",new E),p(this,"_totalOffsetRotation",new Se),p(this,"_totalOffsetPosition2",new E),p(this,"_totalOffsetRotation2",new Se),p(this,"_summedPos",new E),p(this,"_tempPos",new E),p(this,"_summedRot",new Se),p(this,"_tempRot",new Se),p(this,"_clipRotQuat",new Se)}onDisable(){var e;(e=this.mixer)==null||e.stopAllAction()}onDestroy(){this.director.context.animations.unregisterAnimationMixer(this.mixer)}onStateChanged(){this._animator&&Qj(this._animator.gameObject,this,this.director.isPlaying)}createHooks(e,i){var s,r;if(((s=i.tracks)==null?void 0:s.length)<=0){console.warn("No tracks in AnimationClip",i);return}const o=i.tracks[0].name.split("."),a=o[o.length-2],l=a+".position",c=a+".quaternion";let h=!1,u=!1;for(const d of i.tracks)d.name.endsWith(l)?(h=!0,this.createPositionInterpolant(i,e,d)):d.name.endsWith(c)&&(u=!0,this.createRotationInterpolant(i,e,d));if(!h||!u){const d=(r=this.mixer)==null?void 0:r.getRoot(),m=i.tracks[0],f=m.name.lastIndexOf("."),g=m.name.substring(0,f),y=g.substring(g.lastIndexOf(".")+1),v=d.getObjectByName(y);if(v)if(h){if(!u){const b=i.tracks[0].name.substring(0,f)+".quaternion";Ec&&console.warn("Create quaternion track",y,v);const A=v.quaternion,x=new gl(b,[0,i.duration],[A.x,A.y,A.z,A.w,A.x,A.y,A.z,A.w]);i.tracks.push(x),this.createRotationInterpolant(i,e,x)}}else{const b=g+".position";Ec&&console.warn("Create position track",y,v);const A=v.position,x=new nc(b,[0,i.duration],[A.x,A.y,A.z,A.x,A.y,A.z]);i.tracks.push(x),this.createPositionInterpolant(i,e,x)}}}bind(){if(!this._didBind){this._didBind=!0,Ec&&console.log(this.models),this.mixer?this.target=this.mixer.getRoot():console.warn("No mixer was assigned to animation track");for(const e of this.actions){const i=new hye(e);this._actionOffsets.push(i)}this.target&&(this._animator=ie.getComponent(this.target,rr)??null,this._animator&&Qj(this._animator.gameObject,this,!0));for(const e of this.models){const i=e.asset,s=i.position,r=i.rotation;s&&s.x!==void 0&&(s.isVector3||(i.position=new E(s.x,s.y,s.z)),r.isQuaternion||(i.rotation=new Se(r.x,r.y,r.z,r.w)))}this.ensureTrackOffsets()}}ensureTrackOffsets(){if(this.trackOffset){const e=this.trackOffset.position;e&&(e.isVector3||(this.trackOffset.position=new E(e.x,e.y,e.z)));const i=this.trackOffset.rotation;i&&(i.isQuaternion||(this.trackOffset.rotation=new Se(i.x,i.y,i.z,i.w)))}}evaluate(e){var i,s,r,o,a,l,c;if(this.track.muted||!this.mixer)return;this.bind(),this._totalOffsetPosition.set(0,0,0),this._totalOffsetRotation.set(0,0,0,1),this._totalOffsetPosition2.set(0,0,0),this._totalOffsetRotation2.set(0,0,0,1);let h=0,u=0,d=!1,m=!1,f=0;for(let g=0;g<this.clips.length;g++){const y=this.models[g],v=this.actions[g],b=y.asset;v.weight=0;const A=e>=y.start&&e<=y.end,x=y.preExtrapolationMode,w=y.postExtrapolationMode,_=g<this.clips.length-1?this.models[g+1]:null;let S=A,M=!1;if(!S&&!d&&y.end<e&&w!==Mc.None?(!_||_.start>e)&&(S=!0,d=!0):g==0&&!S&&!m&&y.start>e&&x!==Mc.None&&(!_||_.start<e)&&(S=!0,M=!0,m=!0),S){let R=this.weight;R*=this.evaluateWeight(e,g,this.models,S),R*=this.director.weight;let P=A;if(M)switch(x){case Mc.Hold:break;case Mc.Loop:e+=y.start,P=!0;break;default:e+=y.start,P=!0;break}let C=this.getClipTime(e,y),L=0;const B=b.duration;if(M&&x===Mc.Hold&&(C=0),P){if(b.loop)for(L+=Math.floor(C/(B+1e-6));C>B;)C-=B}else if(!A&&d)switch(w){case Mc.Hold:C=this.getClipTime(y.end,y);break;case Mc.Loop:C%=B;break;case Mc.PingPong:const D=Math.floor(C/B)%2!==0;C%=B,D&&(C=B-C);break}y.reversed===!0?v.time=v.getClip().duration-C:v.time=C,v.timeScale=0;const z=Math.max(0,R);if(v.weight=z,f+=z,v.clampWhenFinished=!1,v.isRunning()||v.play(),this._useclipOffsets){const D=h==0?this._totalOffsetPosition:this._totalOffsetPosition2,W=h==0?this._totalOffsetRotation:this._totalOffsetRotation2;h<1&&(u=1-R),h+=1;const O=this._summedPos.set(0,0,0),F=this._tempPos.set(0,0,0),X=this._summedRot.identity(),J=this._tempRot.identity(),q=b.rotation;q&&(this._clipRotQuat.identity(),this._clipRotQuat.slerp(q,R));const oe=this._actionOffsets[g];if(oe.hasOffsets)for(let _e=0;_e<L;_e++)oe.rootPositionOffset?F.copy(oe.rootPositionOffset):F.set(0,0,0),F.applyQuaternion(X),this._clipRotQuat&&F.applyQuaternion(this._clipRotQuat),oe.rootQuaternionOffset&&(J.copy(oe.rootQuaternionOffset),X.multiply(J)),O.add(F);this._clipRotQuat&&W.multiply(this._clipRotQuat),W.multiply(X),b.position&&O.add(b.position),D.add(O)}}}if(this._useclipOffsets&&(this._totalOffsetPosition.lerp(this._totalOffsetPosition2,u),this._totalOffsetRotation.slerp(this._totalOffsetRotation2,u)),this.__mixerError===void 0&&(Ec||Ye())&&(s=(i=this._animator)==null?void 0:i.runtimeAnimatorController)!=null&&s.mixer&&this.mixer!==((o=(r=this._animator)==null?void 0:r.runtimeAnimatorController)==null?void 0:o.mixer)&&(this.__mixerError=!0,console.error("AnimationTrack mixer is not shared with the animator controller - this might result in the timeline to not animate properly. Please report a bug to the Needle Engine team!",this)),(a=this._animator)!=null&&a.runtimeAnimatorController){const g=Math.max(0,1-f);(c=(l=this._animator)==null?void 0:l.runtimeAnimatorController)==null||c.update(g)}else this.mixer.update(e)}createRotationInterpolant(e,i,s){var r;const o=s.createInterpolant.bind(s),a=new Se;this.ensureTrackOffsets();const l=(r=this.trackOffset)==null?void 0:r.rotation;s.createInterpolant=()=>{const c=o(),h=c.evaluate.bind(c);return c.evaluate=u=>{var d;const m=h(u);if(a.set(m[0],m[1],m[2],m[3]),a.premultiply(this._totalOffsetRotation),l&&a.premultiply(l),this.director.animationCallbackReceivers)for(const f of this.director.animationCallbackReceivers)(d=f?.onTimelineRotation)==null||d.call(f,this.director,this.target,u,a);return m[0]=a.x,m[1]=a.y,m[2]=a.z,m[3]=a.w,m},c}}createPositionInterpolant(e,i,s){var r,o;const a=s.createInterpolant.bind(s),l=new E;this.ensureTrackOffsets();const c=(r=this.trackOffset)==null?void 0:r.rotation,h=(o=this.trackOffset)==null?void 0:o.position;let u;s.createInterpolant=()=>{const d=a(),m=d.evaluate.bind(d);return d.evaluate=f=>{var g,y,v;const b=m(f);if(l.set(b[0],b[1],b[2]),i.removeStartOffset&&(u===void 0?(u=null,u=(y=(g=this._actionOffsets.find(A=>A.clip===e))==null?void 0:g.rootStartPosition)==null?void 0:y.clone()):u!=null&&u.isVector3&&l.sub(u)),l.applyQuaternion(this._totalOffsetRotation),l.add(this._totalOffsetPosition),c&&l.applyQuaternion(c),h&&(l.x-=h.x,l.y+=h.y,l.z+=h.z),this.director.animationCallbackReceivers)for(const A of this.director.animationCallbackReceivers)(v=A?.onTimelinePosition)==null||v.call(A,this.director,this.target,f,l);return b[0]=l.x,b[1]=l.y,b[2]=l.z,b},d}}}const uye=te("mutetimeline"),TA=class extends EA{constructor(){super(...arguments),p(this,"models",[]),p(this,"listener"),p(this,"audio",[]),p(this,"audioContextTimeOffset",[]),p(this,"lastTime",0),p(this,"audioSource"),p(this,"_audioLoader",null),p(this,"_playableDirectorResumed",!1)}getAudioFilePath(n){const e=this.director.sourceId;return Vu(e,n)}onAllowAudioChanged(n){for(let e=0;e<this.models.length;e++){const i=this.models[e];this.audio[e].setVolume(n?i.asset.volume:0)}}addModel(n){const e=new q2(this.listener);this.audio.push(e);const i=n;i._didTriggerPlay=!1,this.models.push(i)}onDisable(){for(const n of this.audio)n.isPlaying&&n.stop();for(const n of this.models)n._didTriggerPlay=!1}onDestroy(){for(const n of this.audio)n.source&&n?.disconnect();this.audio.length=0}onMuteChanged(){if(this.muted)for(let n=0;n<this.audio.length;n++){const e=this.audio[n];e!=null&&e.isPlaying&&e.stop()}}stop(){for(let n=0;n<this.audio.length;n++){const e=this.audio[n];e!=null&&e.isPlaying&&e.stop()}for(const n of this.models)n._didTriggerPlay=!1}onPauseChanged(){for(let n=0;n<this.audio.length;n++){const e=this.audio[n];e!=null&&e.isPlaying&&e.stop()}this._playableDirectorResumed=this.director.isPlaying}evaluate(n){if(uye||this.track.muted||this.director.speed<0)return;const e=this.director.context.application.muted,i=this._playableDirectorResumed;this._playableDirectorResumed=!1;const s=e?.1:0;for(let r=0;r<this.models.length;r++){const o=this.models[r],a=this.audio[r],l=o.asset;if((!a||!a.buffer)&&this.isInTimeRange(o,n-1,n+1)&&this.handleAudioLoading(o,a),Sn.userInteractionRegistered!==!1&&!(a===null||!a.buffer))if(a.playbackRate=this.director.context.time.timeScale*this.director.speed,a.loop=l.loop,n>=o.start&&n<=o.end&&n<this.director.duration){if(!a.isPlaying||!this.director.isPlaying)(i||!o._didTriggerPlay&&this.lastTime<n)&&(o.duration*o.timeScale>.3?a.offset=o.clipIn+(n-o.start)*o.timeScale:a.offset=0,Ec&&console.log("Timeline Audio ("+this.track.name+") play with offset "+a.offset+" - "+o.asset.clip),a.play(s),o._didTriggerPlay=!0);else{const h=o.clipIn+(n-o.start)*o.timeScale,u=a.context.currentTime-a._startedAt+a.offset;Math.abs(h-u)>.3&&(a.offset=h,a.stop(),a.play(s))}let c=l.volume;if(this.track.volume!==void 0&&(c*=this.track.volume),e&&(c=0),o.easeInDuration>0){const h=Math.min((n-o.start)/o.easeInDuration,1);c*=h}if(o.easeOutDuration>0){const h=Math.min((o.end-n)/o.easeOutDuration,1);c*=h}a.setVolume(c*this.director.weight)}else o._didTriggerPlay=!1,this.director.isPlaying&&a.isPlaying&&a.stop()}this.lastTime=n}loadAudio(n,e=0,i=0){let s=null;const r=n-i,o=n+e;for(const a of this.models)if(this.isInTimeRange(a,r,o)){const l=this.audio[this.models.indexOf(a)],c=this.handleAudioLoading(a,l);c!==null&&(s===null&&(s=[]),s.push(c))}return s!==null?Promise.all(s):null}isInTimeRange(n,e,i){return e<=n.start&&i>=n.end||e>=n.start&&e<=n.end||i>=n.start&&i<=n.end}static dispose(){TA._audioBuffers.clear()}handleAudioLoading(n,e){this._audioLoader||(this._audioLoader=new Kw);const i=this.getAudioFilePath(n.asset.clip);if(TA._audioBuffers.get(i)){const r=TA._audioBuffers.get(i);return r.then(o=>{o&&e.setBuffer(o)}),r}Ec&&console.warn("LOAD audio track",i,this.director.sourceId);const s=new Promise((r,o)=>{this._audioLoader.load(i,a=>{e.setBuffer(a),r(a)},void 0,a=>{console.error("Error loading audio",a),r(null)})});return TA._audioBuffers.set(i,s),s}};let RA=TA;p(RA,"_audioBuffers",new Map);class IA extends EA{constructor(){super(...arguments),p(this,"models",[]),p(this,"didTrigger",[]),p(this,"receivers",[])}evaluate(e){var i;if(this.track.muted)return;const s=this.director.context.time.deltaTime*1.5;for(let r=0;r<this.models.length;r++){const o=this.models[r],a=this.didTrigger[r],l=o.time-e;let c=!1;if(o.retroActive)c=l<=1e-6;else{const h=Math.abs(l);(h===0||h>=1e-5&&h<s)&&(c=!0)}if(c){if(!a)if(Ec&&console.log("Trigger signal",e,o.time,o),this.didTrigger[r]=!0,((i=this.receivers)==null?void 0:i.length)<=0)I0.invoke(o.asset);else for(const h of this.receivers)h&&h.invoke(o.asset)}else o.emitOnce||(this.didTrigger[r]=!1)}}}class hM extends EA{constructor(){super(...arguments),p(this,"models",[]),p(this,"timelines",[]),p(this,"_previousActiveModel",null)}resolveSourceObjects(e){for(let i=this.models.length-1;i>=0;i--){const s=this.models[i].asset;if(!s.sourceObject||typeof s.sourceObject!="object"){console.log("no source object, removing model",i,s),this.models.splice(i,1);continue}else{const r=ie.getComponent(s.sourceObject,kd);this.timelines.push(r),r&&s.updateDirector&&(r.playOnAwake=!1)}}}evaluate(e){var i;this._previousActiveModel=null;for(let s=0;s<this.models.length;s++){const r=this.models[s],o=r.asset;if(e>=r.start&&e<=r.end){this._previousActiveModel=r;const a=this.getClipTime(e,r);if(o.controlActivation){const l=o.sourceObject;l.visible=!0}if(o.updateDirector){const l=this.timelines[s];l&&(l.isPlaying&&l.pause(),l.time=a,l.evaluate())}}else{const a=(i=this._previousActiveModel)==null?void 0:i.asset;if(o.controlActivation){const l=o.sourceObject;a?.sourceObject!==l&&(l.visible=!1)}}}}}const dye=te("debugpost");let fD=null;function pye(n){fD=n}function dQ(n){let e=n.gameObject;for(;e;){for(const i of dC(e))if(i.isPostProcessingManager===!0)return i;e=e.parent}return null}function mye(n){let e=dQ(n);if(!e)if(fD){dye&&console.warn("Adding postprocessing manager to the scene.");const i=n.scene;e=ta(i,fD)}else Ye()&&console.warn("No post processing manager found");return e}var fye=Object.defineProperty,gye=Object.getOwnPropertyDescriptor,pQ=(n,e,i,s)=>{for(var r=s>1?void 0:s?gye(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&fye(e,i,r),r};const yye=te("debugpost");class Je{constructor(e){p(this,"isVolumeParameter",!0),p(this,"_isInitialized",!1),p(this,"_active",!0),p(this,"_value"),p(this,"_valueRaw"),p(this,"_defaultValue"),p(this,"valueProcessor"),p(this,"onValueChanged"),e!==void 0&&this.initialize(e)}get isInitialized(){return this._isInitialized}initialize(e){e!==void 0&&(this._value=e,this._defaultValue=e,this._valueRaw=e,this._isInitialized=!0)}get overrideState(){return this._active}set overrideState(e){if(this._active===e)return;this._active=e;const i=e?this._valueRaw:this._defaultValue;this.processValue(i,!0)}get value(){return this._valueRaw}set value(e){this.isInitialized||this.initialize(e),this.processValue(e,!1)}set defaultValue(e){this._defaultValue=e}__init(){this.processValue(this._valueRaw,!0)}processValue(e,i){if(e==null||!i&&this.testIfValueChanged(e)===!1)return;const s=this._value;yye&&typeof s=="number"&&typeof e=="number"&&(s?.toFixed(4),e?.toFixed(4)),!this._active&&this._defaultValue!==void 0?(this._value=this._defaultValue,e=this._defaultValue,this._valueRaw=e):(this._valueRaw=e,this._active&&this.valueProcessor&&(e=this.valueProcessor(e)),this._value=e),this.onValueChanged&&this.onValueChanged(e,s,this)}testIfValueChanged(e){return this._valueRaw!==e}}pQ([T()],Je.prototype,"overrideState",1),pQ([T()],Je.prototype,"value",1);class vye extends Wa{constructor(){super([Je])}onSerialize(e,i){}onDeserialize(e,i){const s=i.target,r=i.path;let o;if(s&&r&&(o=s[r]),(typeof o!="object"||typeof o=="object"&&o.isVolumeParameter!==!0)&&(o=new Je),typeof e=="object"&&"value"in e){const a=e.value;o.initialize(a),o.overrideState=e.overrideState}else o.value=e;return o}}new vye;var bye=Object.defineProperty,Aye=Object.getOwnPropertyDescriptor,xye=(n,e,i,s)=>{for(var r=s>1?void 0:s?Aye(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&bye(e,i,r),r};const wye=te("debugpost");class Vs extends Pe{constructor(e=void 0){if(super(),p(this,"active",!0),p(this,"_manager",null),p(this,"_result"),p(this,"_postprocessingContext",null),e)for(const i of Object.keys(e)){const s=e[i],r=this[i];r instanceof Je?r.initialize(s):r!==void 0&&(this[i]=s)}}get isPostProcessingEffect(){return!0}onEnable(){super.onEnable(),this.onEffectEnabled(),this.__internalDidAwakeAndStart&&(this.active=!0)}onDisable(){var e;super.onDisable(),(e=this._manager)==null||e.removeEffect(this),this.active=!1}onEffectEnabled(e){var i;e&&e.isPostProcessingManager===!0?this._manager=e:this._manager||(this._manager=mye(this)),(i=this._manager)==null||i.addEffect(this)}init(){}get postprocessingContext(){return this._postprocessingContext}apply(e){var i;return this._postprocessingContext=e,this._result||(this.initParameters(),this._result=(i=this.onCreateEffect)==null?void 0:i.call(this)),this._result&&this.initParameters(),this._result}unapply(){}dispose(){wye&&console.warn("DISPOSE",this),this._result&&(Array.isArray(this._result)?this._result.forEach(e=>e.dispose()):this._result.dispose()),this._result=void 0}initParameters(){const e=Object.keys(this);for(const i of e){const s=this[i];s instanceof Je&&s.__init()}}onEditorModification(e){const i=e.propertyName;if(this[i]instanceof Je){const s=e.value;return this[i].value=s,!0}}}xye([T()],Vs.prototype,"active",2);var _ye=Object.defineProperty,Sye=Object.getOwnPropertyDescriptor,Cye=(n,e,i,s)=>{for(var r=s>1?void 0:s?Sye(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&_ye(e,i,r),r};const Mye=te("debugpost"),gD={};function Ka(n,e){gD[n]=e}function Eye(n){return n.__type in gD?gD[n.__type]:(Mye&&n.__type&&console.warn("Unknown postprocessing type",n.__type,n),Vs)}class LA{constructor(){p(this,"components",[])}init(){var e;(e=this.components)==null||e.forEach(i=>i.init())}addEffect(e){this.components.push(e)}removeEffect(e){const i=this.components.indexOf(e);i>=0&&this.components.splice(i,1)}}Cye([S0([n=>Eye(n),Vs])],LA.prototype,"components",2);var Tye=Object.defineProperty,Rye=Object.getOwnPropertyDescriptor,Iye=(n,e,i,s)=>{for(var r=s>1?void 0:s?Rye(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&Tye(e,i,r),r};class PA extends Vs{constructor(){super(...arguments),p(this,"preset",new Je(rm.HIGH))}get typeName(){return"Antialiasing"}onCreateEffect(){const e=new oV({preset:rm.HIGH,edgeDetectionMode:wL.DEPTH});return this.preset.onValueChanged=i=>{e.applyPreset(i)},e}}Iye([T(Je)],PA.prototype,"preset",2),Ka("Antialiasing",PA);const Lye=te("debugusdz");class mp{constructor(){p(this,"files",new Array)}static getName(e){var i;const s=e.split(".").pop();let r=(i=e.split(".").slice(0,-1).join(".").split("/").pop())==null?void 0:i.replace(".","_");return r||(r="Audio_"+Math.random().toString(36).substring(2,15)),zl(r)+"."+s}get extensionName(){return"Audio"}onExportObject(e,i,s){const r=ie.getComponents(e,Sn);if(r.length)for(const o of r){if(!o.clip||typeof o.clip!="string"||!o.playOnAwake)continue;const a=o.clip.split("/").pop()||"Audio",l=mp.getName(o.clip),c=zl(l);if(!this.files.some(h=>h.path===o.clip)){this.files.push({path:o.clip,name:l});const h=l.toLowerCase();s.quickLookCompatible&&!h.endsWith(".mp3")&&!h.endsWith(".wav")&&!h.endsWith(".m4a")&&console.error("Audio file "+o.clip+" from "+o.name+" is not an MP3 or WAV file. QuickLook may not support playing it.")}s.quickLookCompatible||i.addEventListener("serialize",(h,u)=>{h.appendLine(),h.beginBlock(`def SpatialAudio "${c}"`,"(",!1),h.appendLine(`displayName = "${a}"`),h.closeBlock(")"),h.beginBlock(),h.appendLine(`uniform asset filePath = @audio/${l}@`),h.appendLine(`uniform token auralMode = "${o.spatialBlend>0?"spatial":"nonSpatial"}"`),h.appendLine(`uniform token playbackMode = "${o.loop?"loopFromStage":"onceFromStart"}"`),h.appendLine(`uniform float gain = ${o.volume}`),h.closeBlock()})}}async onAfterSerialize(e){for(const i of this.files){const s="audio/"+i.name;if(e.files[s]){Lye&&console.warn("Audio file with name "+s+" already exists in the context. Skipping.");continue}const r=await(await(await fetch(i.path)).blob()).arrayBuffer(),o=new Uint8Array(r);e.files[s]=o}}}const Gm=te("debugautosync"),yD=Symbol("syncerId");class Pye{constructor(){p(this,"_syncers",{})}getOrCreateSyncer(e){if(!e.guid)return null;if(this._syncers[e.guid])return this._syncers[e.guid];const i=new Bye(e);return i[yD]=e.guid,this._syncers[i[yD]]=i,i}removeSyncer(e){delete this._syncers[e[yD]]}}const vD=new Pye;class Bye{constructor(e){p(this,"comp"),p(this,"hasChanges",!1),p(this,"changedProperties",{}),p(this,"data",{}),p(this,"_isReceiving",!1),p(this,"_isInit",!1),p(this,"onHandleSending",()=>{if(!this.hasChanges)return;this.hasChanges=!1;const i=this.comp.context.connection;if(!i||!i.isConnected||!i.isInRoom){for(const s in this.changedProperties)delete this.changedProperties[s];return}for(const s in this.data)delete this.data[s];this.data.guid=this.comp.guid;for(const s in this.changedProperties){const r=this.changedProperties[s];delete this.changedProperties[s],this.data[s]=r}i.send(this.networkingKey,this.data,Pl.Queued)}),p(this,"onHandleReceiving",i=>{if(Gm&&console.log("RECEIVE",this.comp.name,this.comp.guid,i),!this._isInit||!this.comp)return;const s=i.guid;if(!(s&&s!==this.comp.guid)){Gm&&console.log("RECEIVED",this.comp.name,this.comp.guid,i);try{this._isReceiving=!0;for(const r in i){if(r==="guid")continue;const o=i[r];this.comp[r]=o,Gm&&console.log("SET",r,o)}}catch(r){console.error(r)}finally{this._isReceiving=!1}}}),this.comp=e}get networkingKey(){return this.comp.guid}init(e){if(this._isInit)return;this._isInit=!0,this.comp=e,this.comp.context.post_render_callbacks.push(this.onHandleSending),this.comp.context.connection.beginListen(this.networkingKey,this.onHandleReceiving);const i=this.comp.context.connection.tryGetState(this.comp.guid);i&&this.onHandleReceiving(i)}destroy(){this._isInit&&(this.comp.context.post_render_callbacks.splice(this.comp.context.post_render_callbacks.indexOf(this.onHandleSending),1),this.comp.context.connection.stopListen(this.networkingKey,this.onHandleReceiving),this.comp=null,this._isInit=!1)}notifyChanged(e,i){this._isReceiving||(Gm&&console.log("Property changed: "+e,i),this.hasChanges=!0,this.changedProperties[e]=i)}}function kye(n,e){let i=e!==n;return!i&&n&&e&&(Array.isArray(n)&&Array.isArray(e)||typeof n=="object"&&typeof e=="object")&&(i=!0),i}const BA=Symbol("AutoSyncHandler");function Dye(n){if(n[BA])return n[BA];const e=vD.getOrCreateSyncer(n);return e?.init(n),n[BA]=e,e}function Oye(n){const e=n[BA];e&&(vD.removeSyncer(e),e.destroy(),delete n[BA])}const bD=function(n){return function(e,i){var s;let r="";typeof i=="string"?r=i:r=i.name;let o=null,a;typeof n=="string"?a=e[n]:typeof n=="function"&&(a=n);const l=e,c=l.__internalAwake;if(typeof c!="function"){(Gm||Ye())&&console.error('@syncField can currently only used on Needle Engine Components, custom object of type "'+((s=e?.constructor)==null?void 0:s.name)+'" is not supported',e);return}Gm&&console.log(r);const h=Symbol(r);l.__internalAwake=function(){if(this[h]!==void 0)return;this[h]=this[r],o=vD.getOrCreateSyncer(this);const d=Object.getOwnPropertyDescriptor(this,r);if(d?.set===void 0){let m=!1;Object.defineProperty(this,r,{set:function(f){var g;const y=this[h];if(this[h]=f,m){Ye()&&console.warn("Recursive call detected",r);return}m=!0;try{const v=kye(f,y);Gm&&console.log("SyncField assignment",r,"changed?",v,f),v&&a?.call(this,f,y)!==!1&&((g=Dye(this))==null||g.notifyChanged(r,f))}finally{m=!1}},get:function(){return this[h]},configurable:!0,enumerable:!0})}o?.init(this),c.call(this)};const u=l.__internalDestroy;l.__internalDestroy=function(){Oye(this),u.call(this)}}};var Gye=Object.defineProperty,zye=Object.getOwnPropertyDescriptor,uM=(n,e,i,s)=>{for(var r=s>1?void 0:s?zye(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&Gye(e,i,r),r};const aa=te("debugplayersync"),mQ=class extends Pe{constructor(){super(...arguments),p(this,"autoSync",!0),p(this,"asset"),p(this,"onPlayerSpawned"),p(this,"_localInstance"),p(this,"onJoinedRoom",()=>{aa&&console.log("PlayerSync.joinedRoom. autoSync is set to "+this.autoSync),this.autoSync&&this.getInstance()}),p(this,"destroyInstance",()=>{var n;(n=this._localInstance)==null||n.then(e=>{aa&&console.log("PlayerSync.destroyInstance",e),Wb(e,this.context.connection,!0,{saveInRoom:!1})}),this._localInstance=void 0})}static async setupFrom(n,e){const i=ei.getOrCreateFromUrl(n);if(!i.asset){const o=await i.loadAssetAsync();ie.getOrAddComponent(o,la)}const s=new mQ;s._internalInit(e),s.asset=i;const r=new ye;return r.guid=n,ie.addComponent(r,s),s}awake(){this.watchTabVisible(),this.onPlayerSpawned||(this.onPlayerSpawned=new en)}onEnable(){this.context.connection.beginListen(Xt.RoomStateSent,this.onJoinedRoom),this.context.connection.beginListen(Xt.JoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(Xt.LeftRoom,this.destroyInstance),this.context.connection.isInRoom&&this.onJoinedRoom()}onDisable(){this.context.connection.stopListen(Xt.RoomStateSent,this.onJoinedRoom),this.context.connection.stopListen(Xt.JoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(Xt.LeftRoom,this.destroyInstance)}async getInstance(){var n,e,i,s,r,o;if(this._localInstance)return this._localInstance;if(aa&&console.log("PlayerSync.createInstance",(n=this.asset)==null?void 0:n.url),!((e=this.asset)!=null&&e.asset)&&!((i=this.asset)!=null&&i.url))return console.error('PlayerSync: can not create an instance because "asset" is not set and or has no URL!'),null;this.gameObject.guid||console.warn("PlayerSync: gameObject has no guid! This might cause issues with syncing the player state."),this._localInstance=(s=this.asset)==null?void 0:s.instantiateSynced({parent:this.gameObject,deleteOnDisconnect:!0},!0);const a=await this._localInstance;if(a){const l=ie.getComponentsInChildren(a,la);if(l!=null&&l.length){for(const c of l)c.owner=this.context.connection.connectionId;(r=this.onPlayerSpawned)==null||r.invoke(a)}else this._localInstance=void 0,console.error("<strong>Failed finding PlayerState on "+((o=this.asset)==null?void 0:o.url)+"</strong>: please make sure the asset has a PlayerState component!"),ie.destroySynced(a)}else this._localInstance=void 0,console.warn("PlayerSync: failed instantiating asset!");return this._localInstance}watchTabVisible(){window.addEventListener("visibilitychange",n=>{if(document.visibilityState==="visible")for(let e=la.all.length-1;e>=0;e--){const i=la.all[e];(!i.owner||!this.context.connection.userIsInRoom(i.owner))&&i.doDestroy()}})}};let L0=mQ;uM([T()],L0.prototype,"autoSync",2),uM([T(ei)],L0.prototype,"asset",2),uM([T(en)],L0.prototype,"onPlayerSpawned",2);var fQ=(n=>(n.OwnerChanged="ownerChanged",n))(fQ||{}),kA;const ar=(kA=class extends Pe{constructor(){super(...arguments),p(this,"onOwnerChangeEvent",new en),p(this,"onFirstOwnerChangeEvent",new en),p(this,"hasOwner",!1),p(this,"owner"),p(this,"dontDestroy",!1),p(this,"onUserLeftRoom",n=>{if(n.userId===this.owner){aa&&console.log("PLAYERSYNC LEFT",this.owner),this.doDestroy();return}})}static get all(){return ar._all}static get local(){return ar._local}static getFor(n){if(n instanceof ye)return ie.getComponentInParent(n,ar);if(n instanceof Pe)return ie.getComponentInParent(n.gameObject,ar)}static isLocalPlayer(n){const e=ar.getFor(n);return e?.isLocalPlayer??!1}static addEventListener(n,e){return this._callbacks[n]||(this._callbacks[n]=[]),this._callbacks[n].push(e),e}static removeEventListener(n,e){if(!this._callbacks[n])return;const i=this._callbacks[n].indexOf(e);i>=0&&this._callbacks[n].splice(i,1)}static dispatchEvent(n,e){if(this._callbacks[n])for(const i of this._callbacks[n])i(e)}get isLocalPlayer(){return this.owner===this.context.connection.connectionId}onOwnerChange(n,e){var i,s;aa&&console.log("PlayerSync.onOwnerChange",this,"newOwner",n,"oldOwner",e);const r=ar._local.indexOf(this);r>=0&&ar._local.splice(r,1);const o={playerState:this,oldValue:e,newValue:n};if(this.hasOwner||(this.hasOwner=!0,(i=this.onFirstOwnerChangeEvent)==null||i.invoke(o)),(s=this.onOwnerChangeEvent)==null||s.invoke(o),this.owner===this.context.connection.connectionId){ar._local.push(this);const l=new CustomEvent("local-owner-changed",{detail:o});this.dispatchEvent(l)}const a=new CustomEvent("owner-changed",{detail:o});this.dispatchEvent(a),ar.dispatchEvent("ownerChanged",a)}awake(){ar.all.push(this),aa&&console.log("Registered new PlayerState",this.guid,ar.all.length-1,ar.all),this.context.connection.beginListen(Xt.UserLeftRoom,this.onUserLeftRoom)}async start(){aa&&console.log("PLAYERSTATE.START, owner: "+this.owner,this.context.connection.usersInRoom([])),this.owner?(this.context.connection.isInRoom||await oc(300),this.context.connection.userIsInRoom(this.owner)==!1&&(aa&&console.log(`PlayerSync.start \u2192 doDestroy "${this.name}" because user "${this.owner}" is not in room anymore...`,"Currently in room:",...this.context.connection.usersInRoom()),this.doDestroy())):this.owner||(aa&&console.warn("PlayerState.start \u2192 owner is undefined!",this.name),setTimeout(()=>{!this.destroyed&&!this.owner?this.dontDestroy?aa&&console.warn("PlayerState.start \u2192 owner is still undefined but dontDestroy is set to true",this.name):(aa&&console.warn(`PlayerState.start \u2192 owner is still undefined: destroying "${this.name}" instance now`),this.doDestroy()):aa&&console.log("PlayerState.start \u2192 owner is assigned",this.owner)},2e3))}doDestroy(){aa&&console.log("PlayerSync.doDestroy \u2192 syncDestroy",this.name),Wb(this.gameObject,this.context.connection,!0,{saveInRoom:!1})}onDestroy(){if(this.context.connection.stopListen(Xt.UserLeftRoom,this.onUserLeftRoom),ar.all.splice(ar.all.indexOf(this),1),this.isLocalPlayer){const n=ar._local.indexOf(this);n>=0&&ar._local.splice(n,1)}}},p(kA,"_all",[]),p(kA,"_local",[]),p(kA,"_callbacks",{}),kA);let la=ar;uM([bD(la.prototype.onOwnerChange)],la.prototype,"owner",2);const Fye=te("debugavatar"),Tc=class extends Pe{constructor(){super(...arguments),p(this,"connectionId"),p(this,"avatar")}static getAvatar(n){return n>=0&&n<Tc.instances.length?Tc.instances[n]:null}static onAvatarMarkerCreated(n){return Tc._onNewAvatarMarkerAdded.push(n),n}static onAvatarMarkerDestroyed(n){return Tc._onAvatarMarkerDestroyed.push(n),n}awake(){Tc.instances.push(this),Fye&&console.log(this);for(const n of Tc._onNewAvatarMarkerAdded)n({avatarMarker:this,gameObject:this.gameObject})}onDestroy(){Tc.instances.splice(Tc.instances.indexOf(this),1);for(const n of Tc._onAvatarMarkerDestroyed)n({avatarMarker:this,gameObject:this.gameObject})}isLocalAvatar(){return this.connectionId===this.context.connection.connectionId}};let lr=Tc;p(lr,"instances",[]),p(lr,"_onNewAvatarMarkerAdded",[]),p(lr,"_onAvatarMarkerDestroyed",[]);var Nye=Object.defineProperty,Uye=Object.getOwnPropertyDescriptor,Vye=(n,e,i,s)=>{for(var r=s>1?void 0:s?Uye(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&Nye(e,i,r),r};const P0=te("debugxrflags"),gQ=te("disablexrflags");gQ&&console.warn("XRFlags are disabled");var Rc=(n=>(n[n.Never=0]="Never",n[n.Browser=1]="Browser",n[n.AR=2]="AR",n[n.VR=4]="VR",n[n.FirstPerson=8]="FirstPerson",n[n.ThirdPerson=16]="ThirdPerson",n[n.All=4294967295]="All",n))(Rc||{});const yQ=class{constructor(){p(this,"Mask",17)}Has(n){return(this.Mask&n)!==0}Set(n){P0&&console.warn("Set XR flag state to",n),this.Mask=n,ca.Apply()}Enable(n){this.Mask|=n,ca.Apply()}Disable(n){this.Mask&=~n,ca.Apply()}Toggle(n){this.Mask^=n,ca.Apply()}EnableAll(){this.Mask=-1,ca.Apply()}DisableAll(){this.Mask=0,ca.Apply()}};let yo=yQ;p(yo,"Global",new yQ);var DA;const Jh=(DA=class extends Pe{constructor(){super(...arguments),p(this,"visibleIn")}static Apply(){for(const n of this.registry)n.UpdateVisible(yo.Global)}awake(){Jh.registry.push(this)}onEnable(){Jh.firstApply?this.UpdateVisible(yo.Global):(Jh.firstApply=!0,Jh.Apply())}onDestroy(){const n=Jh.registry.indexOf(this);n>=0&&Jh.registry.splice(n,1)}get isOn(){return this.gameObject.visible}UpdateVisible(n=null){if(gQ)return;let e;const i=n;if(i&&typeof i=="number"&&(console.assert(typeof i=="number","XRFlag.UpdateVisible: state must be a number",i),P0&&console.log(i),Jh.buffer.Mask=i,n=Jh.buffer),n instanceof yo?(P0&&console.warn(this.name,"use passed in mask",n.Mask,this.visibleIn),e=n.Has(this.visibleIn)):(P0&&console.log(this.name,"use global mask"),yo.Global.Has(this.visibleIn)),e!==void 0)if(e)P0&&console.log(this.name,"is visible",this.gameObject.uuid),ie.setActive(this.gameObject,!0);else{if(P0&&console.log(this.name,"is not visible",this.gameObject.uuid),!this.gameObject.visible)return;this.gameObject.visible=!1}}},p(DA,"registry",[]),p(DA,"firstApply"),p(DA,"buffer",new yo),DA);let ca=Jh;Vye([T()],ca.prototype,"visibleIn",2);var Xye=Object.defineProperty,Wye=Object.getOwnPropertyDescriptor,AD=(n,e,i,s)=>{for(var r=s>1?void 0:s?Wye(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&Xye(e,i,r),r};const OA=te("debugwebxr"),vQ=new Se().setFromAxisAngle(new E(0,1,0),Math.PI);class Dd extends Pe{constructor(){super(...arguments),p(this,"head"),p(this,"leftHand"),p(this,"rightHand"),p(this,"_leftHandMeshes"),p(this,"_rightHandMeshes"),p(this,"_syncTransforms")}async onEnterXR(e){if(!this.activeAndEnabled)return;OA&&console.warn("AVATAR ENTER XR",this.guid,this.sourceId,this,this.activeAndEnabled),this._syncTransforms&&(this._syncTransforms.length=0),await this.prepareAvatar();const i=la.getFor(this);if(i!=null&&i.owner){const s=this.gameObject.addComponent(lr);s.avatar=this.gameObject,s.connectionId=i.owner}else this.context.connection.isConnected?console.error("No player state found for avatar",this):i&&!this.context.connection.isConnected&&(i.dontDestroy=!0)}onLeaveXR(e){const i=this.gameObject.getComponent(lr);i&&i.destroy()}onUpdateXR(e){var i,s;if(!this.activeAndEnabled)return;const r=la.isLocalPlayer(this);if(!r)return;const o=e.xr;if(o.rig&&o.rig.gameObject!==this.gameObject.parent&&(this.gameObject.position.set(0,0,0),this.gameObject.rotation.set(0,0,0),this.gameObject.scale.set(1,1,1),o.rig.gameObject.add(this.gameObject)),this._syncTransforms&&r)for(const u of this._syncTransforms)u.fastMode=!0,u.isOwned()||u.requestOwnership();if(this.head&&this.context.mainCamera){const u=this.head.asset;if(u.position.copy(this.context.mainCamera.position),u.position.x*=-1,u.position.z*=-1,u.quaternion.copy(this.context.mainCamera.quaternion),u.quaternion.x*=-1,this.context.time.frameCount%10===0){const d=ie.getComponentsInChildren(this.head.asset,ca);for(const m of d)m.enabled=!1,m.gameObject.visible=!1}}const a=e.xr.leftController,l=(i=this.leftHand)==null?void 0:i.asset;a&&l?(l.position.copy(a.gripPosition),l.quaternion.copy(a.gripQuaternion),l.quaternion.multiply(vQ),l.visible=a.isTracking,this.updateHandVisibility(a,l,this._leftHandMeshes)):l&&l.visible&&(l.visible=!1);const c=e.xr.rightController,h=(s=this.rightHand)==null?void 0:s.asset;c&&h?(h.position.copy(c.gripPosition),h.quaternion.copy(c.gripQuaternion),h.quaternion.multiply(vQ),h.visible=c.isTracking,this.updateHandVisibility(c,h,this._rightHandMeshes)):h&&h.visible&&(h.visible=!1)}onBeforeRender(){this.context.xr&&this.context.time.frame%10===0&&this.updateRemoteAvatarVisibility()}updateHandVisibility(e,i,s){if(s){const r=e.model&&e.model.visible&&e.model!==i;s.forEach(o=>{md(o,!r)})}}updateRemoteAvatarVisibility(){var e,i,s;if(this.context.connection.isConnected){const r=la.getFor(this);if(r&&r.isLocalPlayer==!1){const o=Et.getXRSync(this.context);if(o&&o.hasState(r.owner)){this.tryFindAvatarObjectsIfMissing();const a=(e=this.leftHand)==null?void 0:e.asset;a&&(a.visible=o?.isTracking(r.owner,"left")??!1);const l=(i=this.rightHand)==null?void 0:i.asset;l&&(l.visible=o?.isTracking(r.owner,"right")??!1)}if((s=this.head)!=null&&s.asset){const a=ie.getComponentsInChildren(this.head.asset,ca);for(const l of a)l.enabled=!1,l.gameObject.visible=!0}}}}tryFindAvatarObjectsIfMissing(){if(!this.head||!this.leftHand||!this.rightHand){const e={head:this.head,leftHand:this.leftHand,rightHand:this.rightHand};a9.tryFindAvatarObjects(this.gameObject,this.sourceId||"",e),e.head&&(this.head=e.head),e.leftHand&&(this.leftHand=e.leftHand),e.rightHand&&(this.rightHand=e.rightHand)}}async prepareAvatar(){if(this.tryFindAvatarObjectsIfMissing(),this.head)this.head instanceof ye&&(this.head=new ei("",this.sourceId,this.head));else{const e=new ye;e.name="Head";const i=dd.createPrimitive(bm.Cube);e.add(i),this.gameObject.add(e),this.head=new ei("",this.sourceId,e),OA&&console.log("Create head",e)}if(this.rightHand)this.rightHand instanceof ye&&(this.rightHand=new ei("",this.sourceId,this.rightHand));else{const e=new ye;e.name="Right Hand",this.gameObject.add(e),this.rightHand=new ei("",this.sourceId,e),OA&&console.log("Create right hand",e)}if(this.leftHand)this.leftHand instanceof ye&&(this.leftHand=new ei("",this.sourceId,this.leftHand));else{const e=new ye;e.name="Left Hand",this.gameObject.add(e),this.leftHand=new ei("",this.sourceId,e),OA&&console.log("Create left hand",e)}await this.loadAvatarObjects(this.head,this.leftHand,this.rightHand),this._leftHandMeshes=[],this.leftHand.asset.traverse(e=>{e!=null&&e.isMesh&&this._leftHandMeshes.push(e)}),this._rightHandMeshes=[],this.rightHand.asset.traverse(e=>{e!=null&&e.isMesh&&this._rightHandMeshes.push(e)}),la.isLocalPlayer(this.gameObject)&&(this._syncTransforms=ie.getComponentsInChildren(this.gameObject,Sc))}async loadAvatarObjects(e,i,s){const r=e.loadAssetAsync(),o=i.loadAssetAsync(),a=s.loadAssetAsync(),l=new Array;r&&l.push(r),o&&l.push(o),a&&l.push(a);const c=await h_(l);OA&&console.log("Avatar loaded results:",c)}}AD([T(ei)],Dd.prototype,"head",2),AD([T(ei)],Dd.prototype,"leftHand",2),AD([T(ei)],Dd.prototype,"rightHand",2);class Ic{static Add(e,i,s=null){if(i){for(const r of this.Pois)if(r.obj===i)return;this.Pois.push({obj:i,avatar:s}),this.LastChangeTime=e.time.time}}static Remove(e,i){var s;if(i){for(const r of this.Pois)if(r.obj===i){this.Pois.splice(this.Pois.indexOf(r),1),this.LastChangeTime=e?.time.time??((s=Pt.Current)==null?void 0:s.time.time);return}}}}p(Ic,"Pois",[]),p(Ic,"LastChangeTime",0);class Hye{constructor(){p(this,"guid"),p(this,"position",new E)}}class GA extends Pe{constructor(){super(...arguments),p(this,"target",null),p(this,"avatar",null),p(this,"_model",null),p(this,"_targetModel",new Hye),p(this,"_currentTargetObject",null),p(this,"_lastUpdateTime",0),p(this,"_lookDuration",0),p(this,"_lastPoiChangedTime",0)}set controlledTarget(e){this.target=e;const i=Z.get("MoveRandom");if(i&&this.target){const s=ie.getComponent(this.target,i);s&&s.destroy()}}awake(){if(this.avatar=ie.getComponentInParent(this.gameObject,lr),this.avatar){const e=ie.getComponentInParent(this.gameObject,lr);this._model=new cB(this.context.connection,this.guid),e!=null&&e.isLocalAvatar&&this._model.requestOwnership()}this.context.connection.beginListen("avatar-look-target-changed",e=>{var i;this.target&&e&&e.guid===((i=this.avatar)==null?void 0:i.guid)&&bs(this.target,e.position)})}update(){var e;if((!this.context.connection.isConnected||(e=this._model)!=null&&e.hasOwnership)&&(Ic.LastChangeTime!==this._lastPoiChangedTime&&(this._lastPoiChangedTime=Ic.LastChangeTime,this._lookDuration=0),this.selectTarget(),this._currentTargetObject&&this.context.time.frameCount%10===0&&this.target)){const i=zt(this._currentTargetObject);bs(this.target,i),this.context.connection.isConnected&&this.avatar&&(this.context.connection.send("avatar-look-target-changed",this._targetModel),this._targetModel.guid=this.avatar.guid,this._targetModel.position.copy(i))}}selectTarget(){if(this.context.time.time-this._lastUpdateTime>this._lookDuration){this._lastUpdateTime=this.context.time.time,this._lookDuration=Math.random()*.5+.2;const e=Ic.Pois;if(e.length>0){const i=e[Math.floor(Math.random()*e.length)];if(i&&i.obj){if(i.avatar&&i.avatar===this.avatar)return;this._currentTargetObject=i.obj}}}}}function bQ(n){return n&&n.isComponent}const jye=Symbol("object"),xD=new Qo(()=>new E,20);class AQ{constructor(e,i,s,r,o,a){p(this,"_point"),p(this,"_normal"),p(this,"_tangentVelocity"),p(this,"distance"),p(this,"impulse"),p(this,"friction"),this._point=e,this.distance=i,this._normal=s,this.impulse=r,this.friction=o,this._tangentVelocity=a}get point(){return xD.get().set(this._point.x,this._point.y,this._point.z)}get normal(){return xD.get().set(this._normal.x,this._normal.y,this._normal.z)}get tangentVelocity(){return xD.get().set(this._tangentVelocity.x,this._tangentVelocity.y,this._tangentVelocity.z)}}class xQ{constructor(e,i,s){p(this,"contacts"),p(this,"me"),p(this,"_collider"),p(this,"_gameObject"),this.me=e,this._collider=i,this._gameObject=i.gameObject,this.contacts=s}get collider(){return this._collider}get gameObject(){return this._gameObject}get rigidBody(){var e;return(e=this.collider)==null?void 0:e.attachedRigidbody}}class wQ{constructor(e,i){p(this,"object"),p(this,"collider"),this.object=e,this.collider=i}}const Qn=te("debugnetworkingstreams");var Lc=(n=>(n.Connected="peer-user-connected",n.StreamReceived="receive-stream",n.StreamEnded="call-ended",n.Disconnected="peer-user-disconnected",n.UserJoined="user-joined",n))(Lc||{});class wD{constructor(e,i){p(this,"type","call-ended"),p(this,"userId"),p(this,"direction"),this.userId=e,this.direction=i}}class _Q{constructor(e,i,s){p(this,"type","receive-stream"),p(this,"userId"),p(this,"stream"),p(this,"target"),this.userId=e,this.stream=i,this.target=s}}class Qye{constructor(e,i){p(this,"guid"),p(this,"peerId"),p(this,"dontSave",!0),this.guid=e.id,this.peerId=i}}var SQ=(n=>(n.Incoming="incoming",n.Outgoing="outgoing",n))(SQ||{});class Zye extends Rs{constructor(e,i,s,r=null){super(),p(this,"peerId"),p(this,"userId"),p(this,"direction"),p(this,"call"),p(this,"_stream",null),p(this,"_isDisposed",!1),this.peerId=i.peer,this.userId=e,this.call=i,this.direction=s,this._stream=r,i.on("stream",o=>{if(Qn&&console.log("Receive stream",`
Audio:`,o.getAudioTracks(),`
Video:`,o.getVideoTracks()),this._stream=o,s==="incoming"){const a=new _Q(e,o,this);this.dispatchEvent(a)}}),i.on("close",()=>{this.dispatchEvent(new wD(e,s))})}get stream(){return this._stream}close(){this._isDisposed||(this._isDisposed=!0,this.call.close(),Pc(this._stream))}get isOpen(){var e;return((e=this.call.peerConnection)==null?void 0:e.connectionState)==="connected"}get isOpening(){var e;return((e=this.call.peerConnection)==null?void 0:e.connectionState)==="connecting"}get isClosed(){return!this.isOpen||this._isDisposed}}function CQ(n){return n=n.replace("a=fmtp:111 minptime=10;useinbandfec=1","a=fmtp:111 ptime=5;useinbandfec=1;stereo=1;maxplaybackrate=48000;maxaveragebitrat=128000;sprop-stereo=1"),n}const zA=class extends Rs{constructor(n,e){super(),p(this,"updateCalls",()=>{var i;for(let s=this._incomingCalls.length-1;s>=0;s--){const r=this._incomingCalls[s];r.isClosed&&!r.isOpening&&this._incomingCalls.splice(s,1)}for(let s=this._outgoingCalls.length-1;s>=0;s--){const r=this._outgoingCalls[s];let o=!1;r.isClosed&&!r.isOpening&&((i=r.stream)!=null&&i.active?Qn&&console.warn("!!! Stream is still active, don't remove call",r.userId,"Your id: "+this.context.connection.connectionId):(Qn&&console.warn("!!! Remove closed call",r.userId),o=!0)),this.context.connection.userIsInRoom(r.userId)===!1&&(Qn&&console.warn("!!! User is not in room anymore, remove call",r.userId),o=!0),o&&(r.close(),this._outgoingCalls.splice(s,1))}}),p(this,"id"),p(this,"context"),p(this,"_incomingCalls",[]),p(this,"_outgoingCalls",[]),p(this,"_peer"),p(this,"_enabled",!1),p(this,"_enabledPeer",!1),p(this,"onConnectRoomFn",this.onConnectRoom.bind(this)),p(this,"onPeerConnect",i=>{if(Qn&&console.log("PEER opened as",i),i===null){console.error("Peer connection failed",i);return}this.context.connection.send("peer-user-connected",new Qye(this,i))}),p(this,"onPeerClose",()=>{Qn&&console.log("PEER closed"),this.updateCalls()}),p(this,"onPeerDisconnected",()=>{Qn&&console.log("PEER disconnected"),this.updateCalls()}),p(this,"onPeerError",i=>{Qn&&console.error("PEER error",i)}),p(this,"onPeerReceivingCall",i=>{i.answer(void 0,{sdpTransform:s=>CQ(s)}),this.registerCall(i,"incoming",null)}),this.context=n,this.id=e,this.setupPeer(),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia}static getOrCreate(n,e){if(zA.instances.has(e))return zA.instances.get(e);const i=new zA(n,e);return zA.instances.set(e,i),i}getMyPeerId(){if(this.context.connection.connectionId)return this.getPeerIdFromUserId(this.context.connection.connectionId)}getPeerIdFromUserId(n){return this.id+"-"+n}getUserIdFromPeerId(n){return n.substring(this.id.length+1)}makeCall(n,e){var i;if(!(e!=null&&e.id)){Qn?console.warn("Can not make a call: mediastream has no id or is undefined"):console.debug("Can not make a call: mediastream has no id or is undefined");return}const s={metadata:{userId:this.context.connection.connectionId,streamId:e.id},sdpTransform:o=>CQ(o)},r=(i=this._peer)==null?void 0:i.call(n,e,s);if(r){const o=this.registerCall(r,"outgoing",e);return Qn&&console.warn(`\u{1F4DE} CALL ${n}`,`
Outgoing:`,this._outgoingCalls,`
Incoming:`,this._incomingCalls),o}else Qn&&console.error("Failed to make call",n,e,this._peer)}closeAll(){for(const n of this._incomingCalls)n.close();for(const n of this._outgoingCalls)n.close();this.updateCalls()}get peer(){return this._peer}get incomingCalls(){return this._incomingCalls}enable(){this._enabled||(this._enabled=!0,this.context.connection.beginListen(Xt.JoinedRoom,this.onConnectRoomFn),this.subscribePeerEvents())}disable(){this._enabled&&(this._enabled=!1,this.context.connection.stopListen(Xt.JoinedRoom,this.onConnectRoomFn),this.unsubscribePeerEvents())}onConnectRoom(){this.setupPeer()}setupPeer(){if(this.context.connection.connectionId&&!this._enabledPeer){if(this._enabledPeer=!0,!this._peer){const n=this.getMyPeerId();n?this._peer=GH(n):console.error("Failed to setup peerjs because we dont have a connection id",this.context.connection.connectionId)}this._enabled&&this.subscribePeerEvents()}}subscribePeerEvents(){this._peer&&(this._peer.on("open",this.onPeerConnect),this._peer.on("close",this.onPeerClose),this._peer.on("call",this.onPeerReceivingCall),this._peer.on("disconnected",this.onPeerDisconnected),this._peer.on("error",this.onPeerError))}unsubscribePeerEvents(){this._peer&&(this._peer.off("open",this.onPeerConnect),this._peer.off("close",this.onPeerClose),this._peer.off("call",this.onPeerReceivingCall),this._peer.off("disconnected",this.onPeerDisconnected),this._peer.off("error",this.onPeerError))}registerCall(n,e,i){const s=n.metadata;(!s||!s.userId)&&console.error("Missing call metadata",n);const r=s.userId;e==="incoming"&&Qn?console.warn("\u2190 Receive call from",n.metadata,n.connectionId):Qn&&console.warn("\u2192 Make call to",n.metadata);const o=e==="incoming"?this._incomingCalls:this._outgoingCalls,a=new Zye(r,n,e,i);return o.push(a),n.on("error",l=>{console.error("Call error",l)}),n.on("close",()=>{Qn&&console.log("Call ended",n.metadata);const l=o.indexOf(a);l!==-1&&o.splice(l,1),a.close(),this.dispatchEvent(new wD(r,e))}),a.addEventListener("call-ended",l=>{this.dispatchEvent(l)}),e==="incoming"&&(a.addEventListener("receive-stream",l=>{this.dispatchEvent(l)}),n.on("stream",()=>{Qn&&console.log("Received stream for call",n.metadata);let l=0;const c=setInterval(()=>{const h=l===0;!a.isOpen&&h&&(Qn&&console.warn("Close call because stream is not active",n.metadata),l+=1,clearInterval(c),a.close())},2e3)})),a}};let FA=zA;p(FA,"instances",new Map);class f1 extends Rs{constructor(e,i){if(super(),p(this,"context"),p(this,"peer"),p(this,"_sendingStreams",new Map),p(this,"debug",!1),p(this,"_enabled",!1),p(this,"_tickIntervalId"),p(this,"tick",()=>{this.updateSendingCalls()}),p(this,"onJoinedRoom",s=>{this._sendingStreams.size>0&&(this.debug&&console.warn(`${s!=null&&s.userId?`User ${s.userId}`:"You"} joined room`,s,this._sendingStreams.size),this.updateSendingCalls())}),p(this,"onLeftRoom",s=>{this.debug&&console.warn(`${s?.userId||"You"} left room`,s),this.stopCallsToUsersThatAreNotInTheRoomAnymore(),this.peer.closeAll()}),p(this,"onCallStreamReceived",s=>{this.debug&&console.log("Call with "+s.userId+" started"),this.dispatchEvent({type:"receive-stream",target:this,stream:s.stream,userId:s.userId}),this.debug&&this.debugLogCurrentState()}),p(this,"onCallEnded",s=>{this.debug&&console.log("Call with "+s.userId+" ended"),this.dispatchEvent(s),this.debug&&this.debugLogCurrentState()}),p(this,"onUserConnected",s=>{if(this.peer.id===s.guid){this.debug&&console.log("PEER USER CONNECTED",s.guid,s,this._sendingStreams.size);const r=this._sendingStreams.keys().next().value;this.peer.makeCall(s.peerId,r)}else Qn&&console.log("Unknown user connected",s.guid,s.peerId)}),p(this,"onUserLeft",s=>{this.debug&&console.log("User left room: "+s.userId),this.stopCallsToUsersThatAreNotInTheRoomAnymore()}),bQ(e)){const s=e;e=s.context,i=FA.getOrCreate(s.context,s.guid)}else typeof i=="string"&&(i=FA.getOrCreate(e,i));if(e){if(!(e instanceof Pt))throw new Error("Failed to create NetworkedStreams because context is not an instance of Context")}else throw new Error("Failed to create NetworkedStreams because context is undefined");if(!i)throw new Error("Failed to create NetworkedStreams because peer is undefined");this.context=e,this.peer=i,Qn&&(this.debug=!0)}static create(e,i){const s=FA.getOrCreate(e.context,i||e.context.connection.connectionId||e.guid);return new f1(e.context,s)}startSendingStream(e){this._sendingStreams.has(e)?console.warn("Received start sending stream with stream that is already being sent"):(this._sendingStreams.set(e,[]),this.updateSendingCalls())}stopSendingStream(e){if(e){const i=this._sendingStreams.get(e);if(i){for(const s of i)s.close();i.length=0}this._sendingStreams.delete(e),i&&this.debug&&this.debugLogCurrentState()}this.updateSendingCalls()}get enabled(){return this._enabled}enable(){this._enabled||(this._enabled=!0,this.peer.enable(),this.peer.addEventListener("receive-stream",this.onCallStreamReceived),this.peer.addEventListener("call-ended",this.onCallEnded),this.context.connection.beginListen("peer-user-connected",this.onUserConnected),this.context.connection.beginListen(Xt.JoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(Xt.UserJoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(Xt.UserLeftRoom,this.onUserLeft),this.context.connection.beginListen(Xt.LeftRoom,this.onLeftRoom),this._tickIntervalId=setInterval(this.tick,5e3))}disable(){this._enabled&&(this._enabled=!1,this.peer.disable(),this.peer.removeEventListener("receive-stream",this.onCallStreamReceived),this.peer.removeEventListener("call-ended",this.onCallEnded),this.context.connection.stopListen("peer-user-connected",this.onUserConnected),this.context.connection.stopListen(Xt.JoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(Xt.UserJoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(Xt.UserLeftRoom,this.onUserLeft),this.context.connection.stopListen(Xt.LeftRoom,this.onLeftRoom),this._tickIntervalId!=null&&(clearInterval(this._tickIntervalId),this._tickIntervalId=void 0))}updateSendingCalls(){const e=this.context.connection.connectionId;for(const i of this._sendingStreams.keys()){const s=this._sendingStreams.get(i)||[];for(const r of this.context.connection.usersInRoom()){if(r===e)continue;const o=this.peer.getPeerIdFromUserId(r);if(s.find(a=>{var l;return a.peerId===o&&a.direction==="outgoing"&&!a.isClosed&&((l=a.stream)==null?void 0:l.active)}))Qn&&console.debug("Already have a call with user "+r+" / peer "+o);else{const a=this.peer.makeCall(o,i);a&&s.push(a)}}this._sendingStreams.set(i,s)}this.stopCallsToUsersThatAreNotInTheRoomAnymore()}stopCallsToUsersThatAreNotInTheRoomAnymore(){for(const e of this._sendingStreams.keys()){const i=this._sendingStreams.get(e);if(i)for(let s=i.length-1;s>=0;s--){const r=i[s];this.context.connection.userIsInRoom(r.userId)?Qn&&(this.context.connection.connectionId===r.userId?console.warn(`You are still in the room [${s}] ${r.userId}`):console.log(`User is still in room [${s}] ${r.userId}`)):(Qn&&console.log(`Remove call ${[s]} to user that is not in room anymore ${r.userId}`),r.close(),i.splice(s,1))}}this.peer.updateCalls(),this.debug&&this.debugLogCurrentState()}debugLogCurrentState(){console.warn(`You (${this.context.connection.connectionId}) are currently sending ${this._sendingStreams.size} and receiving ${this.peer.incomingCalls.length} calls (${this.peer.incomingCalls.map(e=>e.userId).join(", ")})`,this.peer.incomingCalls)}}function Pc(n){if(n&&n instanceof MediaStream)for(const e of n.getTracks())e.stop()}var Yye=Object.defineProperty,Kye=Object.getOwnPropertyDescriptor,_D=(n,e,i,s)=>{for(var r=s>1?void 0:s?Kye(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&Yye(e,i,r),r};const Jye="noVoip",qye=te("debugvoip");class Od extends Pe{constructor(){super(...arguments),p(this,"autoConnect",!0),p(this,"runInBackground",!0),p(this,"createMenuButton",!0),p(this,"debug",!1),p(this,"_net"),p(this,"_menubutton"),p(this,"_allowSending",!0),p(this,"_outputStream",null),p(this,"onJoinedRoom",async()=>{this.debug&&console.log("VOIP: Joined room"),await oc(300),this.autoConnect&&!this.isSending&&this._allowSending&&this.connect()}),p(this,"onLeftRoom",()=>{this.debug&&console.log("VOIP: Left room"),this.disconnect();for(const e of this._incomingStreams.values())Pc(e.srcObject);this._incomingStreams.clear()}),p(this,"_incomingStreams",new Map),p(this,"onReceiveStream",e=>{const i=e.target.userId,s=e.stream;let r=this._incomingStreams.get(i);r||(r=new Audio,this._incomingStreams.set(i,r)),r.srcObject=s,r.setAttribute("autoplay","true"),Uh.registerWaitForInteraction(()=>{r?.play().catch(o=>{console.error("VOIP: Failed to play audio",o)})})}),p(this,"onStreamEnded",e=>{const i=this._incomingStreams.get(e.userId);Pc(i?.srcObject),this._incomingStreams.delete(e.userId)}),p(this,"onEnabledChanged",()=>{for(const e of this._incomingStreams){const i=e[1];i.muted=!this.enabled}}),p(this,"onVisibilityChanged",()=>{if(this.runInBackground)return;const e=document.visibilityState!=="visible";this.setMuted(e);for(const i of this._incomingStreams){const s=i[1];s.muted=e}})}awake(){qye&&(this.debug=!0),this.debug&&(console.log("VOIP debugging: press 'v' to toggle mute or 'c' to toggle connect/disconnect"),window.addEventListener("keydown",async e=>{switch(e.key.toLowerCase()){case"v":console.log("MUTE?",!this.isMuted),this.setMuted(!this.isMuted);break;case"c":this.isSending?this.disconnect():this.connect();break}}),window.addEventListener("blur",()=>{console.log("VOIP: MUTE ON BLUR"),this.setMuted(!0)}),window.addEventListener("focus",()=>{console.log("VOIP: UNMUTE ON FOCUS"),this.setMuted(!1)}))}onEnable(){this._net||(this._net=f1.create(this)),this.debug&&(this._net.debug=!0),this._net.addEventListener(Lc.StreamReceived,this.onReceiveStream),this._net.addEventListener(Lc.StreamEnded,this.onStreamEnded),this._net.enable(),this.autoConnect&&this.context.connection.isConnected&&this.connect(),this.context.connection.beginListen(Xt.JoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(Xt.LeftRoom,this.onLeftRoom),this.onEnabledChanged(),this.updateButton(),window.addEventListener("visibilitychange",this.onVisibilityChanged)}onDisable(){var e;this._net&&(this._net.stopSendingStream(this._outputStream),this._net.removeEventListener(Lc.StreamReceived,this.onReceiveStream),this._net.removeEventListener(Lc.StreamEnded,this.onStreamEnded),(e=this._net)==null||e.disable()),this.context.connection.stopListen(Xt.JoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(Xt.LeftRoom,this.onLeftRoom),this.onEnabledChanged(),this.updateButton(),window.removeEventListener("visibilitychange",this.onVisibilityChanged)}onDestroy(){var e;(e=this._menubutton)==null||e.remove(),this._menubutton=void 0}get isSending(){return this._outputStream!=null&&this._outputStream.active}async connect(e){var i,s;if(!this._net)return console.error("Cannot connect to voice chat - NetworkedStreams not initialized. Make sure the component is enabled before calling this method."),!1;if(this.context.connection.isConnected){if(!await xt.microphonePermissionsGranted())return console.error("Cannot connect to voice chat - microphone permissions not granted"),this.updateButton(),!1}else return console.error("Cannot connect to voice chat - not connected to server"),this.updateButton(),!1;return this._allowSending=!0,(i=this._net)==null||i.stopSendingStream(this._outputStream),Pc(this._outputStream),this._outputStream=await this.getAudioStream(e),this._outputStream?(this.debug&&console.log("VOIP: Got audio stream"),(s=this._net)==null||s.startSendingStream(this._outputStream),this.updateButton(),!0):(this.updateButton(),await xt.microphonePermissionsGranted()?console.error("VOIP: Could not get audio stream - please make sure to connect an audio device and grant microphone permissions"):R_("Microphone permissions not granted: Please grant microphone permissions to use voice chat"),(this.debug||Ye())&&console.log("VOIP: Failed to get audio stream"),!1)}disconnect(e){var i;e!=null&&e.remember&&(this._allowSending=!1),(i=this._net)==null||i.stopSendingStream(this._outputStream),Pc(this._outputStream),this._outputStream=null,this.updateButton()}setMuted(e){var i;const s=(i=this._outputStream)==null?void 0:i.getAudioTracks();if(s)for(const r of s)r.enabled=!e}get isMuted(){var e;if(this._outputStream===null)return!1;const i=(e=this._outputStream)==null?void 0:e.getAudioTracks();if(i){for(const s of i)if(!s.enabled)return!0}return!1}async updateButton(){var e;if(this.createMenuButton){if(this._menubutton||(this._menubutton=document.createElement("button"),this._menubutton.addEventListener("click",()=>{this.isSending?this.disconnect({remember:!0}):this.connect(),xt.microphonePermissionsGranted().then(i=>{i||zi("<strong>Microphone permissions not granted</strong>. Please allow your browser to use the microphone to be able to talk. Click on the button on the left side of your browser's address bar to allow microphone permissions.")})})),this._menubutton){this.context.menu.appendChild(this._menubutton),this.activeAndEnabled?this._menubutton.style.display="":this._menubutton.style.display="none",this._menubutton.title=this.isSending?"Click to disable your microphone":"Click to enable your microphone";let i=(this.isSending,""),s=this.isSending?"mic":"mic_off";await xt.microphonePermissionsGranted()||(i="No Permission",s="mic_off",this._menubutton.title="Microphone permissions not granted. Please allow your browser to use the microphone to be able to talk. This can usually be done in the addressbar of the webpage."),this._menubutton.innerText=i,this._menubutton.prepend(sr(s)),this.context.connection.isConnected==!1?this._menubutton.setAttribute("disabled",""):this._menubutton.removeAttribute("disabled")}}else this.activeAndEnabled||(e=this._menubutton)==null||e.remove()}getFrequency(e){return this.unsupported_getfrequency||(this.unsupported_getfrequency=!0,Ye()&&zi("VOIP: getFrequency is currently not supported"),console.warn("VOIP: getFrequency is currently not supported")),null}async getAudioStream(e){if(!navigator.mediaDevices.getUserMedia)return console.error("No getDisplayMedia support"),null;const i=async r=>await navigator.mediaDevices.getUserMedia({audio:r??!0,video:!1}).catch(o=>(console.warn("VOIP failed getting audio stream",o),null)),s=await i(e);if(!s)return null;if(xt.isiOS()&&e?.deviceId===void 0){const r=(await navigator.mediaDevices.enumerateDevices()).find(o=>(o.kind==="audioinput"||o.kind==="audiooutput")&&!o.label.includes("iPhone"));if(r){const o=Object.assign({},e);return o.deviceId=r.deviceId,await i(o)}}return s}}_D([T()],Od.prototype,"autoConnect",2),_D([T()],Od.prototype,"runInBackground",2),_D([T()],Od.prototype,"createMenuButton",2);var $ye=Object.defineProperty,eve=Object.getOwnPropertyDescriptor,MQ=(n,e,i,s)=>{for(var r=s>1?void 0:s?eve(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&$ye(e,i,r),r};const tve=te("debugmouth");class NA extends Pe{constructor(){super(...arguments),p(this,"idle",[]),p(this,"talking",[]),p(this,"marker",null),p(this,"voip",null),p(this,"lastMouthChangeTime",0),p(this,"mouthChangeLength",0)}awake(){setTimeout(()=>{this.voip=ie.findObjectOfType(Od,this.context),this.marker||(this.marker=ie.getComponentInParent(this.gameObject,lr))},3e3)}update(){var e;if(!this.voip||this.context.time.frameCount%10!==0)return;let i=((e=this.marker)==null?void 0:e.connectionId)??null;if(!i){tve&&(i=null);return}const s=this.voip.getFrequency(i)??0;this.updateLips(s)}updateLips(e){if(this.context.time.time-this.lastMouthChangeTime>this.mouthChangeLength){if(this.mouthChangeLength=.05+Math.random()*.1,this.talking&&this.talking.length>0&&e>30){this.lastMouthChangeTime=this.context.time.time;const i=Math.floor(Math.random()*this.talking.length);this.setMouthShapeActive(this.talking,i)}else if(this.idle.length>0&&this.context.time.time-this.lastMouthChangeTime>.5){this.lastMouthChangeTime=this.context.time.time;const i=Math.floor(Math.random()*this.idle.length);this.setMouthShapeActive(this.idle,i)}}}setMouthShapeActive(e,i){if(e){e!=this.idle?this.idle.map(s=>s.visible=!1):this.talking.map(s=>s.visible=!1);for(let s=0;s<e.length;s++){const r=e[s];r&&(r.visible=s===i)}}}}MQ([T(ye)],NA.prototype,"idle",2),MQ([T(ye)],NA.prototype,"talking",2);class SD extends Pe{constructor(){super(...arguments),p(this,"voip",null),p(this,"marker",null),p(this,"_startPosition",null)}awake(){this.voip=ie.findObjectOfType(Od,this.context),this.marker=ie.getComponentInParent(this.gameObject,lr)}update(){if(!this.voip||!this.marker||this.context.time.frameCount%10!==0)return;const e=this.marker.connectionId,i=this.voip.getFrequency(e);if(i==null)return;this._startPosition||(this._startPosition=this.gameObject.position.clone());const s=i/100;this.gameObject.position.y=this._startPosition.y+s*.07}}var ive=Object.defineProperty,nve=Object.getOwnPropertyDescriptor,dM=(n,e,i,s)=>{for(var r=s>1?void 0:s?nve(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&ive(e,i,r),r};class zm extends Pe{constructor(){super(...arguments),p(this,"eyes",[]),p(this,"lastBlinkTime",0),p(this,"blinkLength",0),p(this,"eyesOpen",!0),p(this,"state",null)}awake(){this.state=ie.getComponentInParent(this.gameObject,ca)}update(){if(!(!this.gameObject||!this.gameObject.visible||!this.eyes||!Array.isArray(this.eyes)||this.eyes.length===0)&&this.context.time.time-this.lastBlinkTime>this.blinkLength){if(this.lastBlinkTime=this.context.time.time,this.state&&!this.state.isOn||!this.activeAndEnabled)return;if(this.eyesOpen=!this.eyesOpen,this.blinkLength=Math.random(),this.eyesOpen?(this.blinkLength*=3,this.blinkLength+=.5,Math.random()<.1&&(this.blinkLength=.1+Math.random()*.2)):(this.blinkLength*=Math.random()*.2,this.blinkLength+=.1),Math.random()<.1&&(this.blinkLength*=3),this.blinkLength=Math.max(.2,this.blinkLength),this.blinkLength=Math.min(3,this.blinkLength),this.eyes)for(const e of this.eyes)e&&(e.visible=this.eyesOpen)}}}dM([T(ye)],zm.prototype,"eyes",2),dM([T()],zm.prototype,"lastBlinkTime",2),dM([T()],zm.prototype,"blinkLength",2),dM([T()],zm.prototype,"eyesOpen",2);var sve=Object.defineProperty,rve=Object.getOwnPropertyDescriptor,CD=(n,e,i,s)=>{for(var r=s>1?void 0:s?rve(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&sve(e,i,r),r},MD;const EQ=(MD=class extends Pe{constructor(){super(...arguments),p(this,"head",null),p(this,"eyes",null),p(this,"target",null),p(this,"brain",null),p(this,"vec",new E),p(this,"currentTargetPoint",new E)}awake(){this.brain||(this.brain=ie.getComponentInParent(this.gameObject,GA)),this.brain||(this.brain=ie.addComponent(this.gameObject,GA)),this.brain&&this.target&&(this.brain.controlledTarget=this.target)}update(){const n=this.target;if(n&&this.head){const e=this.eyes;if(e){const i=zt(n);this.currentTargetPoint.lerp(i,this.context.time.deltaTime/.1);const s=zt(this.head),r=this.vec.copy(this.currentTargetPoint).sub(s).normalize();if(r.length()<.1)return;const o=EQ.forward;if(o.set(0,0,1),o.applyQuaternion(ki(this.head)),o.dot(r)>.45)for(let a=0;a<e.length;a++)e[a].lookAt(this.currentTargetPoint)}}}},p(MD,"forward",new E(0,0,1)),MD);let B0=EQ;CD([T(ye)],B0.prototype,"head",2),CD([T(ye)],B0.prototype,"eyes",2),CD([T(ye)],B0.prototype,"target",2);const UA=te("debugavatar");class pM{constructor(e,i,s,r){p(this,"root"),p(this,"head"),p(this,"leftHand"),p(this,"rigthHand");var o;this.root=e,this.head=i,this.leftHand=s,this.rigthHand=r,(o=this.root)==null||o.traverse(a=>a.layers.set(2))}get isValid(){return this.head!==null&&this.head!==void 0}}class ED{constructor(){p(this,"avatarRegistryUrl",null)}async getOrCreateNewAvatarInstance(e,i){if(!i)return console.error("Can not create avatar: failed to provide id or root object"),null;let s=null;if(typeof i=="string"){if(s=await this.loadAvatar(e,i),!s){const o=new Jl;s=ie.instantiate(mg(i,e.scene),o)}}else s=i;if(!s)return null;const r=this.findAvatar(s);return r.isValid?(UA&&console.log("[Custom Avatar] valid config",i,UA?r:""),r):(console.warn("[Custom Avatar] config isn't valid",i,UA?r:""),null)}async loadAvatar(e,i){if(console.assert(i!=null&&typeof i=="string","Avatar id must not be null"),i.length<=0||!i)return null;if(UA&&console.log("[Custom Avatar] "+i+", loading..."),i.endsWith(".glb")||(i+=".glb"),this.avatarRegistryUrl===null){const r=await fetch("./"+i);let o=null;if(r.ok){const l=await r.blob();l&&(o=await l.arrayBuffer())}if(!o&&(o=await rk(i,i,0,"no url here go away",!0),!o))return null;const a=await yl().parseSync(e,o,null,0);return a?.scene??null}const s=new Fh;return GC(s,e),new Promise((r,o)=>{const a=this.avatarRegistryUrl+"/"+i;s.load(a,async l=>{await yl().createBuiltinComponents(e,a,l,null,void 0),r(l.scene)},l=>{UA&&console.log("[Custom Avatar] "+l.loaded/l.total*100+"% loaded of "+l.total/1024+"kB")},l=>{console.error("[Custom Avatar] Error when loading: "+l),r(null)})})}cacheModel(e,i){}findAvatar(e){const i=e;let s=i;s.children.length==1&&(s=e.children[0]);let r=this.findAvatarPart(s,["head"]);const o=this.findAvatarPart(s,["left","hand"]),a=this.findAvatarPart(s,["right","hand"]);if(!r){r=i;const l=new E;new Wt().setFromObject(r).getSize(l);const c=Math.max(l.x,l.y,l.z);console.warn("[Custom Avatar] Normalizing head scale, it's too big: "+c+" meters! Should be < 0.3m"),c>.3&&r.scale.multiplyScalar(1/c*.3)}return new pM(i,r,o,a)}findAvatarPart(e,i){const s=e.name.toLowerCase();let r=!0;for(const o of i){if(!r)break;s.indexOf(o)===-1&&(r=!1)}if(r)return e;if(e.children)for(const o of e.children){const a=this.findAvatarPart(o,i);if(a)return a}return null}handleCustomAvatarErrors(e){if(!e.ok)throw Error(e.statusText);return e}}var ove=Object.defineProperty,ave=Object.getOwnPropertyDescriptor,TD=(n,e,i,s)=>{for(var r=s>1?void 0:s?ave(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&ove(e,i,r),r};class k0 extends Pe{constructor(){super(...arguments),p(this,"length",1),p(this,"depthTest",!0),p(this,"isGizmo",!1),p(this,"_axes",null)}onEnable(){if(this.isGizmo&&!Hb)return;this._axes||(this._axes=new io(this.length)),this._axes.layers.disableAll(),this._axes.layers.set(this.layer),this.gameObject.add(this._axes);const e=this._axes.material;e&&e.depthTest!==void 0&&(e.depthTest=this.depthTest)}onDisable(){this._axes&&this.gameObject.remove(this._axes)}}TD([T()],k0.prototype,"length",2),TD([T()],k0.prototype,"depthTest",2),TD([T()],k0.prototype,"isGizmo",2);class RD extends Pe{constructor(){super(...arguments),p(this,"from"),p(this,"to"),p(this,"hint"),p(this,"desiredDistance",1)}onEnable(){}update(){if(!this.from||!this.to||!this.hint)return;const e=zt(this.to).clone(),i=zt(this.from).clone(),s=e.distanceTo(i),r=e.clone();r.sub(i);const o=i.clone();o.add(e),o.multiplyScalar(.5);const a=zt(this.hint).clone();a.sub(o);const l=new E;l.crossVectors(a,r),l.crossVectors(r,l),l.normalize();const c=s*.5,h=Math.max(this.desiredDistance,c),u=Math.sqrt(h*h-c*c),d=l.clone();d.multiplyScalar(u),d.add(o),bs(this.gameObject,d);const m=o.clone();m.sub(l),this.gameObject.lookAt(m)}}const mM=te("debugusdzbehaviours");class fM{constructor(){p(this,"behaviours",[]),p(this,"behaviourComponents",[]),p(this,"behaviourComponentsCopy",[]),p(this,"audioClips",[]),p(this,"audioClipsCopy",[]),p(this,"targetUuids",new Set)}get extensionName(){return"Behaviour"}addBehavior(e){this.behaviours.push(e)}addAudioClip(e){if(!e||typeof e!="string")return"";const i="audio/"+mp.getName(e);return this.audioClips.push({clipUrl:e,filesKey:i}),i}getAllTargetUuids(){return this.targetUuids}onBeforeBuildDocument(e){if(!e.root)return Promise.resolve();const i=[];return e.root.traverse(s=>{ie.foreachComponent(s,r=>{var o;const a=r;if(typeof a.createBehaviours=="function"||typeof a.beforeCreateDocument=="function"||typeof a.afterCreateDocument=="function"||typeof a.afterSerialize=="function"){this.behaviourComponents.push(a);const l=(o=a.beforeCreateDocument)==null?void 0:o.call(a,this,e);l instanceof Promise&&i.push(l)}},!1)}),mM&&console.log("onBeforeBuildDocument: all components",this.behaviourComponents),Promise.all(i)}onExportObject(e,i,s){var r;for(const o of this.behaviourComponents)mM&&console.log("onExportObject: createBehaviours",o),(r=o.createBehaviours)==null||r.call(o,this,i,s)}onAfterBuildDocument(e){for(const a of this.behaviourComponents)typeof a.afterCreateDocument=="function"&&a.afterCreateDocument(this,e);this.behaviourComponentsCopy=this.behaviourComponents.slice(),this.behaviourComponents.length=0,this.audioClipsCopy=this.audioClips.slice(),this.audioClips.length=0;const i=new Set,s=new Set,r=new Set;function o(a){if(a instanceof Hh)for(const l of a.actions)o(l);else if(a instanceof na){const l=a.affectedObjects;l&&(typeof l=="object"?s.add(l):typeof l=="string"&&s.add({uuid:l}));const c=a.xFormTarget;c&&(typeof c=="object"?s.add(c):typeof c=="string"&&s.add({uuid:c}))}}for(const a of this.behaviours)a.trigger instanceof wd&&typeof a.trigger.targetId=="object"&&i.add(a.trigger.targetId),o(a.action);for(const a of new Set([...i,...s]))if(Array.isArray(a))for(const l of a)r.add(l.uuid);else r.add(a.uuid);mM&&console.log("All Behavior trigger sources and action targets",i,s,r),this.targetUuids=new Set(r)}onAfterHierarchy(e,i){var s;if((s=this.behaviours)!=null&&s.length){i.beginBlock('def Scope "Behaviors"');for(const r of this.behaviours)r.writeTo(this,e.document,i);i.closeBlock()}}async onAfterSerialize(e){mM&&console.log("onAfterSerialize behaviours",this.behaviourComponentsCopy);for(const i of this.behaviourComponentsCopy)typeof i.afterSerialize=="function"&&(i.afterSerialize.constructor.name==="AsyncFunction"?await i.afterSerialize(this,e):i.afterSerialize(this,e));for(const{clipUrl:i,filesKey:s}of this.audioClipsCopy){if(e.files[s])return;const r=await(await(await fetch(i)).blob()).arrayBuffer(),o=new Uint8Array(r);e.files[s]=o}this.behaviourComponentsCopy.length=0,this.audioClipsCopy.length=0}}var lve=Object.defineProperty,cve=Object.getOwnPropertyDescriptor,ID=(n,e,i,s)=>{for(var r=s>1?void 0:s?cve(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&lve(e,i,r),r},LD;const TQ=(LD=class extends Vs{constructor(){super(...arguments),p(this,"threshold",new Je(.9)),p(this,"intensity",new Je(1)),p(this,"scatter",new Je(.3)),p(this,"selectiveBloom")}get typeName(){return"Bloom"}init(){this.threshold.valueProcessor=n=>n,this.intensity.valueProcessor=n=>n,this.scatter.valueProcessor=n=>n}onCreateEffect(){let n;if(this.selectiveBloom==null&&(this.selectiveBloom=TQ.useSelectiveBloom),this.selectiveBloom){const e=n=new nV(this.context.scene,this.context.mainCamera,{blendFunction:Ht.ADD,mipmapBlur:!0,luminanceThreshold:this.threshold.value,luminanceSmoothing:this.scatter.value,radius:.85,intensity:this.intensity.value});e.inverted=!0}else n=new xL({blendFunction:Ht.ADD,mipmapBlur:!0,luminanceThreshold:this.threshold.value,luminanceSmoothing:this.scatter.value,radius:.85,intensity:this.intensity.value});return this.intensity.onValueChanged=e=>{n.intensity=e},this.threshold.onValueChanged=e=>{n.luminanceMaterial.threshold=Math.pow(e,2.2)},this.scatter.onValueChanged=e=>{n.luminancePass.enabled=!0,n.luminanceMaterial.smoothing=e,n.mipmapBlurPass&&(n.mipmapBlurPass.radius=oi.lerp(.1,.9,e))},n}},p(LD,"useSelectiveBloom",!1),LD);let Fm=TQ;ID([T(Je)],Fm.prototype,"threshold",2),ID([T(Je)],Fm.prototype,"intensity",2),ID([T(Je)],Fm.prototype,"scatter",2),Ka("Bloom",Fm);var hve=Object.defineProperty,uve=Object.getOwnPropertyDescriptor,ko=(n,e,i,s)=>{for(var r=s>1?void 0:s?uve(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&hve(e,i,r),r};class ha extends Pe{constructor(){super(...arguments),p(this,"attachedRigidbody",null),p(this,"isTrigger",!1),p(this,"sharedMaterial"),p(this,"membership",[0]),p(this,"filter"),p(this,"updateProperties",()=>{var e;(e=this.context.physics.engine)==null||e.updateProperties(this)})}get isCollider(){return!0}awake(){super.awake(),this.attachedRigidbody||(this.attachedRigidbody=this.gameObject.getComponentInParent(Li))}start(){this.attachedRigidbody||(this.attachedRigidbody=this.gameObject.getComponentInParent(Li))}onEnable(){this.attachedRigidbody||(this.attachedRigidbody=this.gameObject.getComponentInParent(Li))}onDisable(){var e;(e=this.context.physics.engine)==null||e.removeBody(this)}get body(){var e;return(e=this.context.physics.engine)==null?void 0:e.getBody(this)}updatePhysicsMaterial(){var e;(e=this.context.physics.engine)==null||e.updatePhysicsMaterial(this)}}ko([T(Li)],ha.prototype,"attachedRigidbody",2),ko([T()],ha.prototype,"isTrigger",2),ko([T()],ha.prototype,"sharedMaterial",2),ko([T()],ha.prototype,"membership",2),ko([T()],ha.prototype,"filter",2);class D0 extends ha{constructor(){super(...arguments),p(this,"radius",.5),p(this,"center",new E(0,0,0))}onEnable(){var e;super.onEnable(),(e=this.context.physics.engine)==null||e.addSphereCollider(this),c_(this.gameObject.scale,this.updateProperties)}onDisable(){super.onDisable(),dI(this.gameObject.scale,this.updateProperties)}onValidate(){this.updateProperties()}}ko([or(),T()],D0.prototype,"radius",2),ko([T(E)],D0.prototype,"center",2);const RQ=class extends ha{constructor(){super(...arguments),p(this,"size",new E(1,1,1)),p(this,"center",new E(0,0,0))}static add(n,e){const i=new RQ;n.geometry.boundingBox||n.geometry.computeBoundingBox();const s=n.geometry.boundingBox;return i.size=s.getSize(new E)||new E(1,1,1),i.center=s.getCenter(new E)||new E(0,0,0),ta(n,i),e?.rigidbody===!0&&ta(n,Li,{isKinematic:!1}),i}onEnable(){var n;super.onEnable(),(n=this.context.physics.engine)==null||n.addBoxCollider(this,this.size),c_(this.gameObject.scale,this.updateProperties)}onDisable(){super.onDisable(),dI(this.gameObject.scale,this.updateProperties)}onValidate(){this.updateProperties()}};let O0=RQ;ko([or(),T(E)],O0.prototype,"size",2),ko([T(E)],O0.prototype,"center",2);class Nm extends ha{constructor(){super(...arguments),p(this,"sharedMesh"),p(this,"convex",!1)}onEnable(){var e,i,s;if(super.onEnable(),!this.context.physics.engine)return;(e=this.sharedMesh)!=null&&e.isMesh||this.gameObject instanceof pe&&(this.sharedMesh=this.gameObject);const r=0;if((i=this.sharedMesh)!=null&&i.isMesh)this.context.physics.engine.addMeshCollider(this,this.sharedMesh,this.convex,Qi(this.gameObject)),mi.assignMeshLOD(this.sharedMesh,r).then(o=>{o&&this.activeAndEnabled&&this.context.physics.engine&&this.sharedMesh&&(this.context.physics.engine.removeBody(this),this.sharedMesh.geometry=o,this.context.physics.engine.addMeshCollider(this,this.sharedMesh,this.convex,Qi(this.gameObject)))});else{const o=this.sharedMesh;if(o!=null&&o.isGroup){console.warn(`MeshCollider mesh is a group "${((s=this.sharedMesh)==null?void 0:s.name)||this.gameObject.name}", adding all children as colliders. This is currently not fully supported (colliders can not be removed from world again)`,this);const a=new Array;for(const l in o.children){const c=o.children[l];c.isMesh&&(this.context.physics.engine.addMeshCollider(this,c,this.convex,Qi(this.gameObject)),a.push(mi.assignMeshLOD(c,r)))}Promise.all(a).then(l=>{var c,h;if(l.some(d=>d)==!1)return;(c=this.context.physics.engine)==null||c.removeBody(this);const u=new pe;for(const d of l)d&&this.activeAndEnabled&&(u.geometry=d,(h=this.context.physics.engine)==null||h.addMeshCollider(this,u,this.convex,Qi(this.gameObject)))})}}}}ko([T(pe)],Nm.prototype,"sharedMesh",2),ko([T()],Nm.prototype,"convex",2);class qh extends ha{constructor(){super(...arguments),p(this,"center",new E(0,0,0)),p(this,"radius",.5),p(this,"height",2)}onEnable(){var e;super.onEnable(),(e=this.context.physics.engine)==null||e.addCapsuleCollider(this,this.height,this.radius)}}ko([T(E)],qh.prototype,"center",2),ko([T()],qh.prototype,"radius",2),ko([T()],qh.prototype,"height",2);var dve=Object.defineProperty,pve=Object.getOwnPropertyDescriptor,PD=(n,e,i,s)=>{for(var r=s>1?void 0:s?pve(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&dve(e,i,r),r};class Um extends Pe{constructor(){super(...arguments),p(this,"objectBounds",!1),p(this,"color"),p(this,"isGizmo",!0),p(this,"_gizmoObject",null),p(this,"_boxHelper",null)}onEnable(){this.isGizmo&&!Hb||(this._gizmoObject||(this.objectBounds?this._gizmoObject=new sI(this.gameObject,this.color??16776960):(this.objectBounds=!1,this._gizmoObject=_B(this.color??16776960))),this.objectBounds?(this.scene.add(this._gizmoObject),this._boxHelper=this._gizmoObject,this.startCoroutine(this.syncObjectBounds(),Yi.OnBeforeRender)):this.gameObject.add(this._gizmoObject))}onDisable(){this._gizmoObject&&this.gameObject.remove(this._gizmoObject)}*syncObjectBounds(){for(var e;this._boxHelper;)(e=this._boxHelper)==null||e.update(),yield}}PD([T()],Um.prototype,"objectBounds",2),PD([T(Ae)],Um.prototype,"color",2),PD([T()],Um.prototype,"isGizmo",2);const mve=te("gizmos"),fve=te("debugboxhelper"),Bc=class extends Pe{constructor(){super(...arguments),p(this,"box",null),p(this,"_lastMatrixUpdateFrame",-1),p(this,"_helper",null),p(this,"_color",null)}isInBox(n){var e;if(!n)return;if(this.box||(this.box=new Wt),Ba([n],void 0,void 0,Bc.testBox),Bc.testBox.isEmpty()){const s=zt(n,Bc._position);Bc.testBox.setFromCenterAndSize(s,Bc._emptyObjectSize)}this.updateBox();const i=(e=this.box)==null?void 0:e.intersectsBox(Bc.testBox);return i&&fve&&ft.DrawWireBox3(Bc.testBox,16711680,5),i}intersects(n){return n?this.updateBox(!1).intersectsBox(n):!1}updateBox(n=!1){if(this.box||(this.box=new Wt),n||this.context.time.frameCount!=this._lastMatrixUpdateFrame){const e=this._lastMatrixUpdateFrame<0;this._lastMatrixUpdateFrame=this.context.time.frameCount;const i=e,s=zt(this.gameObject,Bc._position,i),r=Qi(this.gameObject,Bc._size);this.box.setFromCenterAndSize(s,r)}return this.box}awake(){this._helper=null,this._color=null,this.box=null}showHelper(n=null,e=!1){var i;if(!(!mve&&!e)){if(this._helper){n&&((i=this._color)==null||i.set(n)),this.gameObject.add(this._helper);return}this._helper=_B(n),this.gameObject.add(this._helper)}}};let Ja=Bc;p(Ja,"testBox",new Wt),p(Ja,"_position",new E),p(Ja,"_size",new E(.01,.01,.01)),p(Ja,"_emptyObjectSize",new E(.01,.01,.01));class gve extends v5{constructor(e,i={}){super(e),e._simpleState__activeStates=[],e._simpleState__normalStyles={},e._simpleState__states=i,e._simpleState__statesProperties={};for(const s in i)for(const r in i[s])e._simpleState__statesProperties[r]||(e._simpleState__statesProperties[r]=[]),e._simpleState__statesProperties[r].push(s);for(const s of e._components)e._simpleState__statesProperties[s.id]&&(e._simpleState__normalStyles[s.id]=s.inline?s.inline:s._value);e.__overridedSet=e.set,e.set=this.storeSet.bind(e),e.renderStates=this.renderStates.bind(e),e.setupState=this.setupState.bind(e),e.setState=this.setState.bind(e),e.activatePseudoState=this.activatePseudoState.bind(e),e.deactivatePseudoState=this.deactivatePseudoState.bind(e),e.togglePseudoState=this.togglePseudoState.bind(e)}act(){}attach(){}detach(){}setupState(e,i){this._simpleState__states[e]=i;const s=[];for(const r in i)this._simpleState__statesProperties[r]||(this._simpleState__statesProperties[r]=[],s.push(r)),this._simpleState__statesProperties[r].push(e);for(const r of this._components)s.indexOf(r.id)>-1&&(this._simpleState__normalStyles[r.id]=r.inline?r.inline:r._value)}renderStates(){let e={...this._simpleState__normalStyles};for(const i in this._simpleState__states)this._simpleState__activeStates.indexOf(i)>-1&&(e={...e,...this._simpleState__states[i]});this.set(e,!1)}storeSet(e,i=!0){if(i)for(const s in e)this._simpleState__statesProperties[s]&&(this._simpleState__normalStyles[s]=e[s]);this.__overridedSet(e)}activatePseudoState(e){this._simpleState__activeStates.indexOf(e)===-1&&(this._simpleState__activeStates.push(e),this.renderStates())}deactivatePseudoState(e){const i=this._simpleState__activeStates.indexOf(e);i>-1&&(this._simpleState__activeStates.splice(i,1),this.renderStates())}togglePseudoState(e){const i=this._simpleState__activeStates.indexOf(e);i>-1?this._simpleState__activeStates.splice(i,1):this._simpleState__activeStates.push(e),this.renderStates()}setState(e){Array.isArray(e)?this._simpleState__activeStates=e:this._simpleState__activeStates=[e],this.renderStates()}}var yve=Object.defineProperty,vve=Object.getOwnPropertyDescriptor,IQ=(n,e,i,s)=>{for(var r=s>1?void 0:s?vve(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&yve(e,i,r),r};class G0 extends Pe{constructor(){super(...arguments),p(this,"effectColor"),p(this,"effectDistance")}}IQ([T(Ii)],G0.prototype,"effectColor",2),IQ([T(Y)],G0.prototype,"effectDistance",2);var bve=Object.defineProperty,Ave=Object.getOwnPropertyDescriptor,VA=(n,e,i,s)=>{for(var r=s>1?void 0:s?Ave(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&bve(e,i,r),r};const BD=te("debugui"),kD=te("debuguilayout");class DD{constructor(){p(this,"width"),p(this,"height")}}class OD{constructor(){p(this,"x"),p(this,"y"),p(this,"width"),p(this,"height")}}const Nl=new E,XA=new he,gM=new Se,LQ=class extends cl{constructor(){super(...arguments),p(this,"_anchoredPosition"),p(this,"sizeDelta",new Y(100,100)),p(this,"pivot",new Y(.5,.5)),p(this,"anchorMin",new Y(0,0)),p(this,"anchorMax",new Y(1,1)),p(this,"minWidth"),p(this,"minHeight"),p(this,"lastMatrix"),p(this,"rectBlock"),p(this,"_transformNeedsUpdate",!1),p(this,"_initialPosition"),p(this,"_parentRectTransform"),p(this,"_lastUpdateFrame",-1),p(this,"_lastAnchoring"),p(this,"_createdBlocks",[]),p(this,"_createdTextBlocks",[])}get parent(){return this._parentRectTransform}get translation(){return this.gameObject.position}get rotation(){return this.gameObject.quaternion}get scale(){return this.gameObject.scale}get anchoredPosition(){return this._anchoredPosition||(this._anchoredPosition=new Y),this._anchoredPosition}set anchoredPosition(n){this._anchoredPosition=n}get width(){let n=this.sizeDelta.x;if(this.anchorMin.x!==this.anchorMax.x&&this._parentRectTransform){const e=this._parentRectTransform.width,i=this.anchorMax.x-this.anchorMin.x;n=e*i,n+=this.sizeDelta.x}return this.minWidth!==void 0&&n<this.minWidth?this.minWidth:n}get height(){let n=this.sizeDelta.y;if(this.anchorMin.y!==this.anchorMax.y&&this._parentRectTransform){const e=this._parentRectTransform.height,i=this.anchorMax.y-this.anchorMin.y;n=e*i,n+=this.sizeDelta.y}return this.minHeight!==void 0&&n<this.minHeight?this.minHeight:n}awake(){super.awake(),this._anchoredPosition||(this._anchoredPosition=new Y),this.lastMatrix=new he,this.rectBlock=new ye,this.rectBlock.name=this.name,this._initialPosition=this.gameObject.position.clone(),this._initialPosition.z=0,T0(this,"_anchoredPosition",()=>{this.markDirty()}),T0(this,"sizeDelta",()=>{this.markDirty()}),T0(this,"pivot",()=>{this.markDirty()}),T0(this,"anchorMin",()=>{this.markDirty()}),T0(this,"anchorMax",()=>{this.markDirty()})}onEnable(){var n;super.onEnable(),this.rectBlock||(this.rectBlock=new ye),this.lastMatrix||(this.lastMatrix=new he),this._lastAnchoring||(this._lastAnchoring=new Y),this._initialPosition||(this._initialPosition=new E),this._anchoredPosition||(this._anchoredPosition=new Y),this.addShadowComponent(this.rectBlock),this._transformNeedsUpdate=!0,(n=this.canvas)==null||n.registerTransform(this)}onDisable(){var n;super.onDisable(),this.removeShadowComponent(),(n=this.canvas)==null||n.unregisterTransform(this)}onParentRectTransformChanged(n){this._transformNeedsUpdate||this.onApplyTransform(kD?`${n.name} changed`:void 0)}get isDirty(){return this._transformNeedsUpdate||(this._transformNeedsUpdate=!this.lastMatrix.equals(this.gameObject.matrix)),this._transformNeedsUpdate}markDirty(){this._transformNeedsUpdate||(kD&&console.warn("RectTransform markDirty()",this.name),this._transformNeedsUpdate=!0,this._lastUpdateFrame=-1)}updateTransform(){(this._transformNeedsUpdate||!this.lastMatrix.equals(this.gameObject.matrix))&&this.canUpdate()&&this.onApplyTransform(this._transformNeedsUpdate?"Marked dirty":"Matrix changed")}canUpdate(){return this._transformNeedsUpdate&&this.activeAndEnabled&&this._lastUpdateFrame!==this.context.time.frame}onApplyTransform(n){var e;if(this.context.time.frameCount===this._lastUpdateFrame)return;this._lastUpdateFrame=this.context.time.frameCount;const i=this.shadowComponent;if(!i)return;this.gameObject.parent?this._parentRectTransform=ie.getComponentInParent(this.gameObject.parent,LQ):this._parentRectTransform=void 0,this._transformNeedsUpdate=!1,kD&&console.warn("RectTransform \u2192 ApplyTransform",this.name+" because "+n),this.isRoot()?this.Root.screenspace||(i.rotation.y=Math.PI):(i.matrix.identity(),i.matrixAutoUpdate=!1,Nl.set(0,0,0),this.applyPivot(Nl),i.matrix.setPosition(Nl.x,Nl.y,0),(this.gameObject.quaternion.x||this.gameObject.quaternion.y||this.gameObject.quaternion.z)&&(gM.copy(this.gameObject.quaternion),gM.x*=-1,gM.z*=-1,XA.makeRotationFromQuaternion(gM),i.matrix.premultiply(XA)),Nl.set(0,0,0),this.applyAnchoring(Nl),(e=this.canvas)!=null&&e.screenspace?Nl.z+=.1:Nl.z+=.01,XA.identity(),XA.setPosition(Nl.x,Nl.y,Nl.z),i.matrix.premultiply(XA),i.matrix.scale(this.gameObject.scale)),this.lastMatrix.copy(this.gameObject.matrix);const s=!0;for(const r of dC(this.gameObject,cl,s,1)){if(r===this||!r.activeAndEnabled)continue;const o=r;o.onParentRectTransformChanged&&o.onParentRectTransformChanged(this)}}applyAnchoring(n){this._lastAnchoring||(this._lastAnchoring=new Y);const e=this._lastAnchoring.sub(this._anchoredPosition);this.gameObject.position.x+=e.x,this.gameObject.position.y+=e.y,this._lastAnchoring.copy(this._anchoredPosition),n.x+=this._initialPosition.x-this.gameObject.position.x,n.y+=this._initialPosition.y-this.gameObject.position.y,n.z+=this._initialPosition.z-this.gameObject.position.z;const i=this._parentRectTransform;if(i){let s=0;const r=1-this.anchorMax.y-this.anchorMin.y;s-=i.height*.5*r,n.y+=s;let o=0;const a=1-this.anchorMax.x-this.anchorMin.x;o-=i.width*.5*a,n.x+=o}}applyPivot(n){if(this.pivot&&!this.isRoot()){const e=this.pivot.x-.5;n.x-=e*this.sizeDelta.x*this.gameObject.scale.x;const i=this.pivot.y-.5;n.y-=i*this.sizeDelta.y*this.gameObject.scale.y}}getBasicOptions(){const n={width:this.sizeDelta.x,height:this.sizeDelta.y,offset:0,backgroundOpacity:0,borderWidth:0,borderRadius:0,borderOpacity:0,letterSpacing:-.03};return this.ensureValidSize(n),n}ensureValidSize(n,e=1e-4){return n.width<=0&&(n.width=e),n.height<=0&&(n.height=1e-4),n}createNewBlock(n){n={...this.getBasicOptions(),...n},BD&&console.log(this.name,n);const e=new QI(n);return this._createdBlocks.push(e),e}createNewText(n){BD&&console.log(n),n={...this.getBasicOptions(),...n},BD&&console.log(this.name,n);const e=new YI(n);return this._createdTextBlocks.push(e),e}};let Ur=LQ;VA([T(Y)],Ur.prototype,"anchoredPosition",1),VA([T(Y)],Ur.prototype,"sizeDelta",2),VA([T(Y)],Ur.prototype,"pivot",2),VA([T(Y)],Ur.prototype,"anchorMin",2),VA([T(Y)],Ur.prototype,"anchorMax",2);var xve=Object.defineProperty,wve=Object.getOwnPropertyDescriptor,PQ=(n,e,i,s)=>{for(var r=s>1?void 0:s?wve(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&xve(e,i,r),r};const yM={backgroundColor:new Ae(1,1,1),backgroundOpacity:1,borderColor:new Ae(1,1,1),borderOpacity:1};var GD;const WA=(GD=class extends cl{constructor(){super(...arguments),p(this,"_alphaFactor",1),p(this,"sRGBColor",new Ae(1,0,1)),p(this,"raycastTarget",!0),p(this,"uiObject",null),p(this,"_color",null),p(this,"_rect",null),p(this,"_stateManager",null),p(this,"_currentlyCreatingPanel",!1)}get isGraphic(){return!0}get color(){return this._color||(this._color=new Ii(1,1,1,1)),this._color}set color(n){(!this._color||this._color.r!==n.r||this._color.g!==n.g||this._color.b!==n.b||this._color.alpha!==n.alpha)&&(this._color||(this._color=new Ii(1,1,1,1)),this._color.copy(n),this.onColorChanged())}setAlphaFactor(n){this._alphaFactor=n,this.onColorChanged()}get alphaFactor(){return this._alphaFactor}onColorChanged(){this.uiObject&&(this.sRGBColor.copy(this._color),this.sRGBColor.convertLinearToSRGB(),yM.backgroundColor=this.sRGBColor,yM.backgroundOpacity=this._color.alpha*this._alphaFactor,this.applyEffects(yM,this._alphaFactor),this.uiObject.set(yM),this.markDirty())}get m_Color(){return this._color}get rectTransform(){if(this._rect||(this._rect=ie.getComponent(this.gameObject,Ur)),!this._rect)throw new Error("Not Supported: Make sure to add a RectTransform component before adding a UI Graphic component.");return this._rect}onParentRectTransformChanged(){var n;(n=this.uiObject)==null||n.set({width:this.rectTransform.width,height:this.rectTransform.height}),this.markDirty()}__internalNewInstanceCreated(n){return super.__internalNewInstanceCreated(n),this._rect=null,this.uiObject=null,this._color&&(this._color=this._color.clone()),this}setState(n){this.makePanel(),this.uiObject&&(this.uiObject.setState(n),this==null||this.markDirty())}setupState(n){this.makePanel(),this.uiObject&&(this._stateManager||(this._stateManager=new gve(this.uiObject)),this.uiObject.setupState(n.state,n.attributes))}setOptions(n){this.makePanel(),this.uiObject&&this.uiObject.set(n)}awake(){super.awake(),this.makePanel(),T0(this,"_color",()=>Y0e(this,this.onColorChanged))}onEnable(){var n;super.onEnable(),this.uiObject&&((n=this.rectTransform.shadowComponent)==null||n.add(this.uiObject),this.addShadowComponent(this.uiObject,this.rectTransform))}onDisable(){super.onDisable(),this.uiObject&&this.removeShadowComponent()}makePanel(){if(this.uiObject||this._currentlyCreatingPanel)return;this._currentlyCreatingPanel=!0;const n=.015,e={backgroundColor:this.color,backgroundOpacity:this.color.alpha,offset:n};this.onBeforeCreate(e),this.applyEffects(e),this.onCreate(e),this.controlsChildLayout=!1,this._currentlyCreatingPanel=!1,this.onAfterCreated(),this.onColorChanged()}onBeforeCreate(n){}onCreate(n){this.uiObject=this.rectTransform.createNewBlock(n),this.uiObject.name=this.name}onAfterCreated(){}applyEffects(n,e=1){var i;const s=(i=this.gameObject)==null?void 0:i.getComponent(G0);s&&(s.effectDistance&&(n.borderWidth=Math.max(Math.abs(s.effectDistance.x),Math.abs(s.effectDistance.y))),s.effectColor&&(n.borderColor=s.effectColor,n.borderOpacity=s.effectColor.alpha*e))}async setTexture(n){if(this.setOptions({backgroundOpacity:0}),n){if(WA.textureCache.has(n))n=WA.textureCache.get(n);else if(!n.isRenderTargetTexture){const e=n.clone();e.colorSpace=Bi,WA.textureCache.set(n,e),n=e}this.setOptions({backgroundImage:n,borderRadius:0,backgroundOpacity:this.color.alpha,backgroundSize:"stretch"}),mi.assignTextureLOD(n,0).then(e=>{e instanceof Vt&&(n&&WA.textureCache.set(n,e),this.setOptions({backgroundImage:e}),this.markDirty())})}else this.setOptions({backgroundImage:void 0,borderRadius:0,backgroundOpacity:this.color.alpha});this.markDirty()}onAfterAddedToScene(){super.onAfterAddedToScene(),this.shadowComponent&&(this.shadowComponent.offset=this.shadowComponent.position.z)}},p(GD,"textureCache",new Map),GD);let Vm=WA;PQ([T(Ii)],Vm.prototype,"color",1),PQ([T()],Vm.prototype,"raycastTarget",2);class HA extends Vm{constructor(){super(...arguments),p(this,"_flippedObject",!1)}onAfterCreated(){this.uiObject&&!this._flippedObject&&(this._flippedObject=!0,this.uiObject.scale.y*=-1)}}var _ve=Object.defineProperty,Sve=Object.getOwnPropertyDescriptor,vM=(n,e,i,s)=>{for(var r=s>1?void 0:s?Sve(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&_ve(e,i,r),r};let zD=class{constructor(){p(this,"texture",null),p(this,"rect")}};vM([T(Vt)],zD.prototype,"texture",2);let z0=class extends HA{constructor(){super(...arguments),p(this,"_sprite"),p(this,"pixelsPerUnitMultiplier",1)}set image(n){this.sprite||(this.sprite=new zD),this.sprite.texture=n,this.onAfterCreated()}get image(){return this.sprite?this.sprite.texture:null}get sprite(){return this._sprite}set sprite(n){this._sprite!==n&&(this._sprite=n,this.onAfterCreated())}isBuiltinSprite(){var n,e,i,s,r,o,a;const l=this.sprite;switch((n=l?.texture)==null?void 0:n.name){case"InputFieldBackground":case"UISprite":case"Background":case"Knob":return!0}return!((i=(e=l?.texture)==null?void 0:e.name)!=null&&i.length)&&((r=(s=l?.texture)==null?void 0:s.image)==null?void 0:r.width)===32&&((a=(o=l?.texture)==null?void 0:o.image)==null?void 0:a.height)===32}onBeforeCreate(n){var e,i;super.onBeforeCreate(n),this.isBuiltinSprite()&&(n.borderRadius=5/this.pixelsPerUnitMultiplier,((i=(e=this.sprite)==null?void 0:e.texture)==null?void 0:i.name)==="Knob"&&(n.borderRadius=999))}onAfterCreated(){var n;this.__didAwake&&(super.onAfterCreated(),!this.isBuiltinSprite()&&this.setTexture((n=this.sprite)==null?void 0:n.texture))}};vM([T(zD)],z0.prototype,"sprite",1),vM([T()],z0.prototype,"pixelsPerUnitMultiplier",2);class bM extends HA{constructor(){super(...arguments),p(this,"_mainTexture")}get mainTexture(){return this._mainTexture}set mainTexture(e){this._mainTexture!==e&&(this._mainTexture=e,this.onAfterCreated())}onAfterCreated(){this.__didAwake&&(super.onAfterCreated(),this.setTexture(this.mainTexture))}}vM([T(Vt)],bM.prototype,"mainTexture",1);var Cve=Object.defineProperty,Mve=Object.getOwnPropertyDescriptor,ua=(n,e,i,s)=>{for(var r=s>1?void 0:s?Mve(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&Cve(e,i,r),r};const Xm=te("debugbutton");class Gd{constructor(){p(this,"colorMultiplier"),p(this,"disabledColor"),p(this,"fadeDuration"),p(this,"highlightedColor"),p(this,"normalColor"),p(this,"pressedColor"),p(this,"selectedColor")}}ua([T()],Gd.prototype,"colorMultiplier",2),ua([T(Ii)],Gd.prototype,"disabledColor",2),ua([T()],Gd.prototype,"fadeDuration",2),ua([T(Ii)],Gd.prototype,"highlightedColor",2),ua([T(Ii)],Gd.prototype,"normalColor",2),ua([T(Ii)],Gd.prototype,"pressedColor",2),ua([T(Ii)],Gd.prototype,"selectedColor",2);class Eve{constructor(){p(this,"disabledTrigger"),p(this,"highlightedTrigger"),p(this,"normalTrigger"),p(this,"pressedTrigger"),p(this,"selectedTrigger")}}class $h extends Pe{constructor(){super(...arguments),p(this,"onClick",new en),p(this,"_isHovered",0),p(this,"colors"),p(this,"transition"),p(this,"animationTriggers"),p(this,"animator"),p(this,"_interactable",!0),p(this,"_requestedAnimatorTrigger"),p(this,"_isInit",!1),p(this,"_image")}click(){var e;(e=this.onClick)==null||e.invoke()}onPointerEnter(e){var i,s;const r=e.event.pointerType==="mouse"&&e.button===0;r&&(this._isHovered+=1),Xm&&console.warn("Button Enter",r,this._isHovered,(i=this.animationTriggers)==null?void 0:i.highlightedTrigger,this.animator),this.interactable&&(this.transition==3&&this.animationTriggers&&this.animator?this.animator.setTrigger(this.animationTriggers.highlightedTrigger):this.transition===1&&this.colors&&((s=this._image)==null||s.setState("hovered")),r&&this.context.input.setCursorPointer())}onPointerExit(){var e,i;this._isHovered-=1,this._isHovered<0&&(this._isHovered=0),Xm&&console.log("Button Exit",this._isHovered,(e=this.animationTriggers)==null?void 0:e.highlightedTrigger,this.animator),this.interactable&&(this._isHovered>0||(this._isHovered=0,this.transition==3&&this.animationTriggers&&this.animator?this.animator.setTrigger(this.animationTriggers.normalTrigger):this.transition===1&&this.colors&&((i=this._image)==null||i.setState("normal")),this.context.input.setCursorNormal()))}onPointerDown(e){var i,s;Xm&&console.log("Button Down",(i=this.animationTriggers)==null?void 0:i.highlightedTrigger,this.animator),this.interactable&&(this.transition==3&&this.animationTriggers&&this.animator?this.animator.setTrigger(this.animationTriggers.pressedTrigger):this.transition===1&&this.colors&&((s=this._image)==null||s.setState("pressed")))}onPointerUp(e){var i,s;Xm&&console.warn("Button Up",(i=this.animationTriggers)==null?void 0:i.highlightedTrigger,this.animator,this._isHovered),this.interactable&&(this.transition==3&&this.animationTriggers&&this.animator?this.animator.setTrigger(this._isHovered?this.animationTriggers.highlightedTrigger:this.animationTriggers.normalTrigger):this.transition===1&&this.colors&&((s=this._image)==null||s.setState(this._isHovered?"hovered":"normal")))}onPointerClick(e){if(this.interactable&&!(e.button!==0&&e.event.pointerType===_S.Mouse)&&(Xm&&(console.warn("Button Click",this.onClick),gn("CLICKED button "+this.name+" at "+this.context.time.frameCount)),this.onClick&&this.onClick.listenerCount>0&&(this.onClick.invoke(),e.use(),Xm))){const i=this.gameObject.worldPosition;i.add(this.gameObject.worldUp.multiplyScalar(1+Math.random()*.5)),ft.DrawLabel(i,"CLICK:"+Date.now(),.1,1+Math.random()*.5)}}set interactable(e){this._interactable=e,this._image&&(this._image.setInteractable(e),e?this._image.setState("normal"):this._image.setState("disabled"))}get interactable(){return this._interactable}set_interactable(e){this.interactable=e}awake(){super.awake(),Xm&&console.log(this),this._isInit=!1,this.init()}start(){var e;(e=this._image)==null||e.setInteractable(this.interactable),this.gameObject.getComponentInParent(_A)||this.gameObject.addComponent(iM)}onEnable(){super.onEnable()}onDestroy(){this._isHovered&&this.context.input.setCursorNormal()}*setAnimatorTriggerAtEndOfFrame(e){var i;this._requestedAnimatorTrigger=e,yield,yield,this._requestedAnimatorTrigger==e&&((i=this.animator)==null||i.setTrigger(e))}init(){this._isInit||(this._isInit=!0,this._image=ie.getComponent(this.gameObject,z0),this._image&&(this.stateSetup(this._image),this.interactable?this._image.setState("normal"):this._image.setState("disabled")))}stateSetup(e){var i,s,r,o,a;e.setInteractable(this.interactable);const l=this.getFinalColor(e.color,(i=this.colors)==null?void 0:i.normalColor),c={state:"normal",attributes:{backgroundColor:l,backgroundOpacity:l.alpha}};e.setupState(c);const h=this.getFinalColor(e.color,(s=this.colors)==null?void 0:s.highlightedColor),u={state:"hovered",attributes:{backgroundColor:h,backgroundOpacity:h.alpha}};e.setupState(u);const d=this.getFinalColor(e.color,(r=this.colors)==null?void 0:r.pressedColor),m={state:"pressed",attributes:{backgroundColor:d,backgroundOpacity:d.alpha}};e.setupState(m);const f=this.getFinalColor(e.color,(o=this.colors)==null?void 0:o.selectedColor),g={state:"selected",attributes:{backgroundColor:f,backgroundOpacity:f.alpha}};e.setupState(g);const y=this.getFinalColor(e.color,(a=this.colors)==null?void 0:a.disabledColor),v={state:"disabled",attributes:{backgroundColor:y,backgroundOpacity:y.alpha}};e.setupState(v)}getFinalColor(e,i){return i?e.clone().multiply(i).convertLinearToSRGB():e.clone().convertLinearToSRGB()}}ua([T(en)],$h.prototype,"onClick",2),ua([T(Gd)],$h.prototype,"colors",2),ua([T()],$h.prototype,"transition",2),ua([T(Eve)],$h.prototype,"animationTriggers",2),ua([T(rr)],$h.prototype,"animator",2),ua([T()],$h.prototype,"interactable",1);var Tve=Object.defineProperty,Rve=Object.getOwnPropertyDescriptor,os=(n,e,i,s)=>{for(var r=s>1?void 0:s?Rve(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&Tve(e,i,r),r};const BQ=te("debuguilayout");class zd{constructor(){p(this,"left",0),p(this,"right",0),p(this,"top",0),p(this,"bottom",0)}get vertical(){return this.top+this.bottom}get horizontal(){return this.left+this.right}}os([T()],zd.prototype,"left",2),os([T()],zd.prototype,"right",2),os([T()],zd.prototype,"top",2),os([T()],zd.prototype,"bottom",2);class da extends Pe{constructor(){super(...arguments),p(this,"_rectTransform",null),p(this,"_needsUpdate",!1),p(this,"childAlignment",0),p(this,"reverseArrangement",!1),p(this,"spacing",0),p(this,"padding"),p(this,"minWidth",0),p(this,"minHeight",0),p(this,"flexibleHeight",0),p(this,"flexibleWidth",0),p(this,"preferredHeight",0),p(this,"preferredWidth",0)}get rectTransform(){return this._rectTransform}onParentRectTransformChanged(e){this._needsUpdate=!0}get isDirty(){return this._needsUpdate}get isLayoutGroup(){return!0}updateLayout(){this._rectTransform&&(BQ&&console.warn("Layout Update",this.context.time.frame,this.name),this._needsUpdate=!1,this.onCalculateLayout(this._rectTransform))}start(){this._needsUpdate=!0}onEnable(){BQ&&console.log(this.name,this),this._rectTransform=this.gameObject.getComponent(Ur);const e=this.gameObject.getComponentInParent(cr);e&&e.registerLayoutGroup(this),this._needsUpdate=!0}onDisable(){const e=this.gameObject.getComponentInParent(cr);e&&e.unregisterLayoutGroup(this)}set m_Spacing(e){e!==this.spacing&&(this._needsUpdate=!0,this.spacing=e)}get m_Spacing(){return this.spacing}}os([T()],da.prototype,"childAlignment",2),os([T()],da.prototype,"reverseArrangement",2),os([T()],da.prototype,"spacing",2),os([T(zd)],da.prototype,"padding",2),os([T()],da.prototype,"minWidth",2),os([T()],da.prototype,"minHeight",2),os([T()],da.prototype,"flexibleHeight",2),os([T()],da.prototype,"flexibleWidth",2),os([T()],da.prototype,"preferredHeight",2),os([T()],da.prototype,"preferredWidth",2);class Fd extends da{constructor(){super(...arguments),p(this,"childControlHeight",!0),p(this,"childControlWidth",!0),p(this,"childForceExpandHeight",!1),p(this,"childForceExpandWidth",!1),p(this,"childScaleHeight",!1),p(this,"childScaleWidth",!1)}onCalculateLayout(e){var i;const s=this.primaryAxis,r=e.width;let o=r;const a=e.height;let l=a;o-=this.padding.horizontal,l-=this.padding.vertical,s==="x"?this.padding.horizontal:this.padding.vertical;const c=s==="x",h=c?"y":"x",u=c?this.childControlWidth:this.childControlHeight,d=c?this.childControlHeight:this.childControlWidth,m=c?this.childForceExpandWidth:this.childForceExpandHeight,f=c?this.childForceExpandHeight:this.childForceExpandWidth,g=c?l:o,y=c?r:a,v=.5*(c?this.childAlignment%3:Math.floor(this.childAlignment/3));let b=0;c?b+=this.padding.left:b+=this.padding.top;let A=0,x=0;for(let R=0;R<this.gameObject.children.length;R++){const P=this.gameObject.children[R],C=ie.getComponent(P,Ur);C!=null&&C.activeAndEnabled&&(x+=1,c?A+=C.width:A+=C.height)}let w=0;const _=this.spacing*(x-1);if(m||u){let R=0;c?R=o-=_:R=l-=_,x>0&&(w=R/x)}let S=0;S+=this.padding.left,S-=this.padding.right,v!==0&&(b=y-A,b*=v,b-=_*v,c?(b-=this.padding.right*v,b+=this.padding.left*(1-v),b<this.padding.left&&(b=this.padding.left)):(b-=this.padding.bottom*v,b+=this.padding.top*(1-v),b<this.padding.top&&(b=this.padding.top)));let M=1;for(let R=0;R<this.gameObject.children.length;R++){const P=this.gameObject.children[R],C=ie.getComponent(P,Ur);if(C!=null&&C.activeAndEnabled){(i=C.pivot)==null||i.set(.5,.5),C.anchorMin.set(0,1),C.anchorMax.set(0,1);const L=r*.5+S*.5;C.anchoredPosition.x!==L&&(C.anchoredPosition.x=L);const B=a*-.5;C.anchoredPosition.y!==B&&(C.anchoredPosition.y=B),f&&d&&C.sizeDelta[h]!==g&&(C.sizeDelta[h]=g),m&&u&&C.sizeDelta[s]!==w&&(C.sizeDelta[s]=w);const z=c?C.width:C.height,D=z*.5;if(b+=D,m){const O=w*M-w*.5;O>b&&(b=O-w*.5+z+this.padding.left,b-=D)}let W=b;s==="y"&&(W=-W),C.anchoredPosition[s]!==W&&(C.anchoredPosition[s]=W),b+=D,b+=this.spacing,M+=1}}}}os([T()],Fd.prototype,"childControlHeight",2),os([T()],Fd.prototype,"childControlWidth",2),os([T()],Fd.prototype,"childForceExpandHeight",2),os([T()],Fd.prototype,"childForceExpandWidth",2),os([T()],Fd.prototype,"childScaleHeight",2),os([T()],Fd.prototype,"childScaleWidth",2);class FD extends Fd{get primaryAxis(){return"y"}}class ND extends Fd{get primaryAxis(){return"x"}}class UD extends da{onCalculateLayout(){}}var Ive=Object.defineProperty,Lve=Object.getOwnPropertyDescriptor,kc=(n,e,i,s)=>{for(var r=s>1?void 0:s?Lve(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&Ive(e,i,r),r},kQ=(n=>(n[n.ScreenSpaceOverlay=0]="ScreenSpaceOverlay",n[n.ScreenSpaceCamera=1]="ScreenSpaceCamera",n[n.WorldSpace=2]="WorldSpace",n[n.Undefined=-1]="Undefined",n))(kQ||{});const VD=te("debuguilayout"),DQ=class extends wA{constructor(){super(...arguments),p(this,"_renderOnTop"),p(this,"_depthWrite",!1),p(this,"_doubleSided",!0),p(this,"_castShadows",!1),p(this,"_receiveShadows",!1),p(this,"_renderMode",-1),p(this,"_rootCanvas"),p(this,"_scaleFactor",1),p(this,"worldCamera"),p(this,"planeDistance",-1),p(this,"_boundRenderSettingsChanged",this.onRenderSettingsChanged.bind(this)),p(this,"previousParent",null),p(this,"_lastMatrixWorld",null),p(this,"_rectTransforms",[]),p(this,"_layoutGroups",new Map),p(this,"_receivers",[]),p(this,"onBeforeRenderRoutine",()=>{var n,e,i,s;if(this.previousParent=this.gameObject.parent,((n=this.context.xr)!=null&&n.isVR||(e=this.context.xr)!=null&&e.isPassThrough)&&this.screenspace){this.gameObject.visible=!1,this.gameObject.removeFromParent();return}this.renderOnTop||this.screenspace?this.gameObject.removeFromParent():(this.onUpdateRenderMode(),this.handleLayoutUpdates(),(i=this.shadowComponent)==null||i.updateMatrixWorld(!0),(s=this.shadowComponent)==null||s.updateWorldMatrix(!0,!0),this.invokeBeforeRenderEvents(),Ya.ensureUpdateMeshUI(A5,this.context))}),p(this,"onAfterRenderRoutine",()=>{var n,e,i,s,r;if(((n=this.context.xr)!=null&&n.isVR||(e=this.context.xr)!=null&&e.isPassThrough)&&this.screenspace){(i=this.previousParent)==null||i.add(this.gameObject);return}if((this.screenspace||this.renderOnTop)&&this.previousParent&&this.context.mainCamera){if(this.screenspace){const l=this.context.mainCamera;l?.add(this.gameObject)}else this.previousParent.add(this.gameObject);const o=this.context.renderer.autoClear,a=this.context.renderer.autoClearColor;this.context.renderer.autoClear=!1,this.context.renderer.autoClearColor=!1,this.context.renderer.clearDepth(),this.onUpdateRenderMode(!0),this.handleLayoutUpdates(),(s=this.shadowComponent)==null||s.updateMatrixWorld(!0),this.invokeBeforeRenderEvents(),Ya.ensureUpdateMeshUI(A5,this.context,!0),this.context.renderer.render(this.gameObject,this.context.mainCamera),this.context.renderer.autoClear=o,this.context.renderer.autoClearColor=a,this.previousParent.add(this.gameObject)}(r=this._lastMatrixWorld)==null||r.copy(this.gameObject.matrixWorld)}),p(this,"_updateRenderSettingsRoutine"),p(this,"_activeRenderMode",-1),p(this,"_lastWidth",-1),p(this,"_lastHeight",-1)}get isCanvas(){return!0}get screenspace(){return this.renderMode!==2}set renderOnTop(n){n!==this._renderOnTop&&(this._renderOnTop=n,this.onRenderSettingsChanged())}get renderOnTop(){return this._renderOnTop!==void 0?this._renderOnTop:!!(this.screenspace&&this._renderMode===0)}set depthWrite(n){this._depthWrite!==n&&(this._depthWrite=n,this.onRenderSettingsChanged())}get depthWrite(){return this._depthWrite}set doubleSided(n){this._doubleSided!==n&&(this._doubleSided=n,this.onRenderSettingsChanged())}get doubleSided(){return this._doubleSided}set castShadows(n){this._castShadows!==n&&(this._castShadows=n,this.onRenderSettingsChanged())}get castShadows(){return this._castShadows}set receiveShadows(n){this._receiveShadows!==n&&(this._receiveShadows=n,this.onRenderSettingsChanged())}get receiveShadows(){return this._receiveShadows}get renderMode(){return this._renderMode}set renderMode(n){this._renderMode!==n&&(this._renderMode=n,this.onRenderSettingsChanged())}set rootCanvas(n){this._rootCanvas instanceof DQ||(this._rootCanvas=n)}get rootCanvas(){return this._rootCanvas}get scaleFactor(){return this._scaleFactor}set scaleFactor(n){this._scaleFactor=n}awake(){var n;this.shadowComponent=this.gameObject,this.previousParent=this.gameObject.parent,VD&&console.log("Canvas.Awake()",((n=this.previousParent)==null?void 0:n.name)+"/"+this.gameObject.name),super.awake()}start(){this.onUpdateRenderMode()}onEnable(){super.onEnable(),this._updateRenderSettingsRoutine=void 0,this._lastMatrixWorld=new he,this.onUpdateRenderMode(),document.addEventListener("resize",this._boundRenderSettingsChanged),this.context.pre_render_callbacks.push(this.onBeforeRenderRoutine),this.context.post_render_callbacks.push(this.onAfterRenderRoutine)}onDisable(){super.onDisable(),document.removeEventListener("resize",this._boundRenderSettingsChanged);const n=this.context.pre_render_callbacks.indexOf(this.onBeforeRenderRoutine);n!==-1&&this.context.pre_render_callbacks.splice(n,1);const e=this.context.post_render_callbacks.indexOf(this.onAfterRenderRoutine);e!==-1&&this.context.post_render_callbacks.splice(e,1)}registerTransform(n){this._rectTransforms.push(n)}unregisterTransform(n){const e=this._rectTransforms.indexOf(n);e!==-1&&this._rectTransforms.splice(e,1)}registerLayoutGroup(n){const e=n.gameObject;this._layoutGroups.set(e,n)}unregisterLayoutGroup(n){const e=n.gameObject;this._layoutGroups.delete(e)}registerEventReceiver(n){this._receivers.push(n)}unregisterEventReceiver(n){const e=this._receivers.indexOf(n);e!==-1&&this._receivers.splice(e,1)}async onEnterXR(n){this.screenspace?(n.xr.isVR||n.xr.isPassThrough)&&(this.gameObject.visible=!1):(this.gameObject.visible=!1,await a_(1).then(()=>{this.gameObject.visible=!0}))}onLeaveXR(n){this.screenspace&&(n.xr.isVR||n.xr.isPassThrough)&&(this.gameObject.visible=!0)}invokeBeforeRenderEvents(){var n;for(const e of this._receivers)(n=e.onBeforeCanvasRender)==null||n.call(e,this)}handleLayoutUpdates(){this._lastMatrixWorld===null&&(this._lastMatrixWorld=new he);const n=!this._lastMatrixWorld.equals(this.gameObject.matrixWorld);VD&&n&&console.log("Canvas Layout changed",this.context.time.frameCount,this.name);const e=!1;for(const i of this._rectTransforms){n&&i.markDirty();let s=this._layoutGroups.get(i.gameObject);i.isDirty&&!s&&(s=i.gameObject.getComponentInParent(da)),(i.isDirty||s!=null&&s.isDirty)&&(VD&&!e&&console.log("CANVAS UPDATE ### "+i.name+" ##################################### "+this.context.time.frame),s?.updateLayout(),i.updateTransform())}}applyRenderSettings(){this.onRenderSettingsChanged()}onRenderSettingsChanged(){this._updateRenderSettingsRoutine||(this._updateRenderSettingsRoutine=this.startCoroutine(this._updateRenderSettingsDelayed(),Yi.OnBeforeRender))}*_updateRenderSettingsDelayed(){if(yield,this._updateRenderSettingsRoutine=void 0,this.shadowComponent){this.onUpdateRenderMode(),sM(this.shadowComponent,this);for(const n of ie.getComponentsInChildren(this.gameObject,cl))sM(n.shadowComponent,this)}}onUpdateRenderMode(n=!1){if(!n&&this._renderMode===this._activeRenderMode&&this._lastWidth===this.context.domWidth&&this._lastHeight===this.context.domHeight)return;this._activeRenderMode=this._renderMode;let e=this.context.mainCameraComponent,i=10;switch(e&&e.nearClipPlane>0&&e.farClipPlane>0&&(i=tt.lerp(e.nearClipPlane,e.farClipPlane,.01)),this._renderMode===1&&(this.worldCamera&&(e=this.worldCamera),this.planeDistance>0&&(i=this.planeDistance)),this._renderMode){case 0:case 1:if(this._lastWidth=this.context.domWidth,this._lastHeight=this.context.domHeight,!e)return;const s=i+.01;this.gameObject.position.x=0,this.gameObject.position.y=0,this.gameObject.position.z=-s,this.gameObject.quaternion.identity();const r=this.gameObject.getComponent(Ur);let o=!1;r.sizeDelta.x!==this.context.domWidth&&(o=!0),r.sizeDelta.y!==this.context.domHeight&&(o=!0);const a=e.fieldOfView*Math.PI/180,l=2*Math.tan(a/2)*Math.abs(s);this.gameObject.scale.x=l/this.context.domHeight,this.gameObject.scale.y=l/this.context.domHeight,this.gameObject.scale.z=.01,o&&(r.sizeDelta.x=this.context.domWidth,r.sizeDelta.y=this.context.domHeight,r?.markDirty());break;case 2:this._lastWidth=-1,this._lastHeight=-1;break}}};let cr=DQ;kc([T()],cr.prototype,"renderOnTop",1),kc([T()],cr.prototype,"depthWrite",1),kc([T()],cr.prototype,"doubleSided",1),kc([T()],cr.prototype,"castShadows",1),kc([T()],cr.prototype,"receiveShadows",1),kc([T()],cr.prototype,"renderMode",1),kc([T(cr)],cr.prototype,"rootCanvas",1),kc([T()],cr.prototype,"scaleFactor",1),kc([T(Fi)],cr.prototype,"worldCamera",2),kc([T()],cr.prototype,"planeDistance",2);var Pve=Object.defineProperty,Bve=Object.getOwnPropertyDescriptor,XD=(n,e,i,s)=>{for(var r=s>1?void 0:s?Bve(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&Pve(e,i,r),r};class Nd extends Pe{constructor(){super(...arguments),p(this,"_alpha",1),p(this,"interactable",!0),p(this,"blocksRaycasts",!0),p(this,"_isDirty",!1),p(this,"_buffer",[])}get alpha(){return this._alpha}set alpha(e){e!==this._alpha&&(this._alpha=e,this.markDirty())}get isCanvasGroup(){return!0}markDirty(){this._isDirty||(this._isDirty=!0,this.startCoroutine(this.applyChangesDelayed(),Yi.OnBeforeRender))}*applyChangesDelayed(){this._isDirty=!1,this.applyChangesNow()}applyChangesNow(){this._buffer.length=0;for(const e of ie.getComponentsInChildren(this.gameObject,cl,this._buffer)){const i=e;i.setAlphaFactor&&i.setAlphaFactor(this._alpha)}}}XD([T()],Nd.prototype,"alpha",1),XD([T()],Nd.prototype,"interactable",2),XD([T()],Nd.prototype,"blocksRaycasts",2);var kve=Object.defineProperty,Dve=Object.getOwnPropertyDescriptor,Cn=(n,e,i,s)=>{for(var r=s>1?void 0:s?Dve(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&kve(e,i,r),r};const OQ=te("debugusdzbehaviours");function jA(n){n&&(n.getComponentInParent(_A)||(Ye()&&console.warn("Create Raycaster on "+n.name+" because no raycaster was found in the hierarchy"),n.addComponent(ra)))}class Wm extends Pe{constructor(){super(...arguments),p(this,"object"),p(this,"target"),p(this,"duration",1),p(this,"relativeMotion",!1),p(this,"coroutine",null),p(this,"targetPos",new E),p(this,"targetRot",new Se),p(this,"targetScale",new E)}start(){jA(this.gameObject)}onPointerClick(e){e.use(),this.coroutine&&this.stopCoroutine(this.coroutine),this.relativeMotion?this.coroutine=this.startCoroutine(this.moveRelative()):this.coroutine=this.startCoroutine(this.moveToTarget())}*moveToTarget(){if(!this.target||!this.object)return;const e=zt(this.object).clone(),i=zt(this.target).clone(),s=ki(this.object).clone(),r=ki(this.target).clone(),o=Qi(this.object).clone(),a=Qi(this.target).clone(),l=e.distanceTo(i),c=s.angleTo(r),h=o.distanceTo(a);if(l<.01&&c<.01&&h<.01){bs(this.object,i),La(this.object,r),vg(this.object,a),this.coroutine=null;return}let u=0,d=0;for(;u<1;)u+=this.context.time.deltaTime/this.duration,u>1&&(u=1),d=u<.5?4*u*u*u:1-Math.pow(-2*u+2,3)/2,this.targetPos.lerpVectors(e,i,d),this.targetRot.slerpQuaternions(s,r,d),this.targetScale.lerpVectors(o,a,d),bs(this.object,this.targetPos),La(this.object,this.targetRot),vg(this.object,this.targetScale),yield;this.coroutine=null}*moveRelative(){if(!this.target||!this.object)return;const e=this.object.position.clone(),i=this.object.quaternion.clone(),s=this.object.scale.clone(),r=this.target.position.clone(),o=this.target.quaternion.clone(),a=this.target.scale.clone();r.applyQuaternion(this.object.quaternion),this.targetPos.copy(this.object.position).add(r),this.targetRot.copy(this.object.quaternion).multiply(o),this.targetScale.copy(this.object.scale).multiply(a);let l=0,c=0;for(;l<1;)l+=this.context.time.deltaTime/this.duration,l>1&&(l=1),c=l<.5?4*l*l*l:1-Math.pow(-2*l+2,3)/2,this.object.position.lerpVectors(e,this.targetPos,c),this.object.quaternion.slerpQuaternions(i,this.targetRot,c),this.object.scale.lerpVectors(s,this.targetScale,c),yield;this.coroutine=null}beforeCreateDocument(e){var i;if(this.target&&this.object&&this.gameObject){const s=new Gs("Move to "+((i=this.target)==null?void 0:i.name),zs.tapTrigger(this.gameObject),bi.transformAction(this.object,this.target,this.duration,this.relativeMotion?"relative":"absolute"));e.addBehavior(s)}}}Cn([T(ye)],Wm.prototype,"object",2),Cn([T(ye)],Wm.prototype,"target",2),Cn([T()],Wm.prototype,"duration",2),Cn([T()],Wm.prototype,"relativeMotion",2);var AM;const Dc=(AM=class extends Pe{constructor(){super(...arguments),p(this,"materialToSwitch"),p(this,"variantMaterial"),p(this,"fadeDuration",0),p(this,"_objectsWithThisMaterial",null),p(this,"selfModel"),p(this,"targetModels")}start(){var n;this._objectsWithThisMaterial=this.objectsWithThisMaterial,jA(this.gameObject),Ye()&&this._objectsWithThisMaterial.length<=0&&console.warn('ChangeMaterialOnClick: No objects found with material "'+((n=this.materialToSwitch)==null?void 0:n.name)+'"')}onPointerEnter(n){this.context.input.setCursorPointer()}onPointerExit(n){this.context.input.setCursorNormal()}onPointerClick(n){if(n.use(),!!this.variantMaterial)for(let e=0;e<this.objectsWithThisMaterial.length;e++){const i=this.objectsWithThisMaterial[e];i.material=this.variantMaterial}}get objectsWithThisMaterial(){return this._objectsWithThisMaterial!=null?this._objectsWithThisMaterial:(this._objectsWithThisMaterial=[],this.variantMaterial&&this.materialToSwitch&&this.context.scene.traverse(n=>{if(n instanceof pe)if(Array.isArray(n.material)){for(const e of n.material)if(e===this.materialToSwitch){this.objectsWithThisMaterial.push(n);break}}else n.material===this.materialToSwitch?this.objectsWithThisMaterial.push(n):k9(n.material,this.materialToSwitch)&&this.objectsWithThisMaterial.push(n)}),this._objectsWithThisMaterial)}async beforeCreateDocument(n,e){this.targetModels=[],Dc._materialTriggersPerId={},Dc.variantSwitchIndex=0,this.materialToSwitch&&await mi.assignTextureLOD(this.materialToSwitch,0),this.variantMaterial&&await mi.assignTextureLOD(this.variantMaterial,0)}createBehaviours(n,e,i){this.objectsWithThisMaterial.find(s=>s.uuid===e.uuid)&&this.targetModels.push(e),this.gameObject.uuid===e.uuid&&(this.selfModel=e,this.materialToSwitch&&(Dc._materialTriggersPerId[this.materialToSwitch.uuid]||(Dc._materialTriggersPerId[this.materialToSwitch.uuid]=[]),Dc._materialTriggersPerId[this.materialToSwitch.uuid].push(this)))}afterCreateDocument(n,e){if(!this.materialToSwitch)return;const i=Dc._materialTriggersPerId[this.materialToSwitch.uuid];if(i){const s={};for(const r of i){const o=r.createVariants();o&&o.length>0&&(s[r.selfModel.uuid]=o)}for(const r of i){const o=[];for(const a in s)a!==r.selfModel.uuid&&o.push(...s[a]);r.createAndAttachBehaviors(n,s[r.selfModel.uuid],o)}}delete Dc._materialTriggersPerId[this.materialToSwitch.uuid]}createAndAttachBehaviors(n,e,i){const s=[],r=[],o=Math.max(0,this.fadeDuration);r.push(bi.fadeAction([...this.targetModels,...i],o,!1)),s.push(bi.fadeAction(e,o,!1)),r.push(bi.fadeAction(e,o,!0)),n.addBehavior(new Gs("Select_"+this.selfModel.name,zs.tapTrigger(this.selfModel),bi.parallel(...r))),n.addBehavior(new Gs("StartHidden_"+this.selfModel.name,zs.sceneStartTrigger(),bi.parallel(...s)))}static getMaterialName(n){return zl(n.name||"Material")+"_"+n.id}createVariants(){if(!this.variantMaterial)return null;const n=[];for(const e of this.targetModels){const i=e.clone();i.name+="_Variant_"+Dc.variantSwitchIndex+++"_"+Dc.getMaterialName(this.variantMaterial),i.displayName=i.displayName+": Variant with material "+this.variantMaterial.name,i.material=this.variantMaterial,i.geometry=e.geometry,i.transform=e.transform,(!e.parent||!e.parent.isEmpty())&&po.createEmptyParent(e),e.parent&&e.parent.add(i),n.push(i)}return n}},p(AM,"_materialTriggersPerId",{}),p(AM,"variantSwitchIndex",0),AM);let F0=Dc;Cn([T(Ft)],F0.prototype,"materialToSwitch",2),Cn([T(Ft)],F0.prototype,"variantMaterial",2),Cn([T()],F0.prototype,"fadeDuration",2);var N0;const Mn=(N0=class extends Pe{constructor(){super(...arguments),p(this,"target"),p(this,"toggleOnClick",!1),p(this,"targetState",!0),p(this,"hideSelf",!0),p(this,"selfModel"),p(this,"selfModelClone"),p(this,"targetModel"),p(this,"toggleModel"),p(this,"stateBeforeCreatingDocument",!1),p(this,"targetStateBeforeCreatingDocument",!1)}start(){jA(this.gameObject)}onPointerClick(n){n.use(),!this.toggleOnClick&&this.hideSelf&&(this.gameObject.visible=!1),this.target&&(this.target.visible=this.toggleOnClick?!this.target.visible:this.targetState)}createBehaviours(n,e,i){e.uuid===this.gameObject.uuid&&(this.selfModel=e,this.selfModelClone=e.clone())}beforeCreateDocument(){this.target&&(this.gameObject[Mn.wasVisible]===void 0&&(this.gameObject[Mn.wasVisible]=this.gameObject.activeSelf),this.target[Mn.wasVisible]===void 0&&(this.target[Mn.wasVisible]=this.target.activeSelf),this.stateBeforeCreatingDocument=this.gameObject[Mn.wasVisible],this.targetStateBeforeCreatingDocument=this.target[Mn.wasVisible],this.gameObject.visible=!0,this.target.visible=!0)}afterCreateDocument(n,e){if(!this.target)return;this.targetModel=e.document.findById(this.target.uuid);const i=this.selfModel;if(this.selfModel&&this.targetModel){let s=this.selfModel,r=this.targetState;if(this.toggleOnClick)if(r=!this.targetStateBeforeCreatingDocument,!this.selfModelClone.geometry)(!this.selfModel.parent||this.selfModel.parent.isEmpty())&&Cj.createEmptyParent(this.selfModel),this.toggleModel=this.selfModel.deepClone(),this.toggleModel.name+="_toggle",this.selfModel.parent.add(this.toggleModel);else{if(!this.gameObject[Mn.toggleClone]){const l=this.selfModelClone.clone();l.setMatrix(new he),l.name+="_toggle"+Mn.clonedToggleIndex++,i.add(l),this.gameObject[Mn.toggleClone]=l,console.warn("USDZExport: Toggle "+this.gameObject.name+" doesn't have geometry. It will be deep cloned and nested behaviours will likely not work.")}const a=this.gameObject[Mn.toggleClone];if(!this.gameObject[Mn.reverseToggleClone]){const l=this.selfModelClone.clone();l.setMatrix(new he),l.name+="_toggleReverse"+Mn.clonedToggleIndex++,i.add(l),this.gameObject[Mn.reverseToggleClone]=l}this.toggleModel=this.gameObject[Mn.reverseToggleClone],(!this.toggleModel.geometry||!a.geometry)&&console.error("triggers without childs and without geometry won't work!",this,i.geometry),s=a,i.geometry=null,i.material=null}if(this.toggleModel){if(this.toggleOnClick){const a=[];a.push(bi.fadeAction(s,0,!1)),a.push(bi.fadeAction(this.toggleModel,0,!0)),a.push(bi.fadeAction(this.targetModel,0,r)),n.addBehavior(new Gs("Toggle_"+s.name+"_toggleTo"+(r?"On":"Off"),zs.tapTrigger(s),bi.parallel(...a)));const l=[];l.push(bi.fadeAction(this.toggleModel,0,!1)),l.push(bi.fadeAction(s,0,!0)),l.push(bi.fadeAction(this.targetModel,0,!r)),n.addBehavior(new Gs("Toggle_"+s.name+"_toggleTo"+(r?"Off":"On"),zs.tapTrigger(this.toggleModel),bi.parallel(...l)))}}else{const a=[];this.hideSelf&&a.push(bi.fadeAction(s,0,!1)),a.push(bi.fadeAction(this.targetModel,0,r)),n.addBehavior(new Gs("Toggle_"+s.name+"_toggleTo"+(r?"On":"Off"),zs.tapTrigger(s),bi.parallel(...a)))}const o=new Array;this.targetStateBeforeCreatingDocument||o.push(this.targetModel),this.stateBeforeCreatingDocument||o.push(i),this.toggleModel&&o.push(this.toggleModel),n.addBehavior(new Gs("HideOnStart_"+this.gameObject.name,zs.sceneStartTrigger(),bi.fadeAction(o,0,!1)))}}afterSerialize(n,e){this.gameObject[Mn.wasVisible]!==void 0&&(this.gameObject.visible=this.gameObject[Mn.wasVisible],delete this.gameObject[Mn.wasVisible]),this.target&&this.target[Mn.wasVisible]!==void 0&&(this.target.visible=this.target[Mn.wasVisible],delete this.target[Mn.wasVisible]),delete this.gameObject[Mn.toggleClone],delete this.gameObject[Mn.reverseToggleClone]}},p(N0,"clonedToggleIndex",0),p(N0,"wasVisible",Symbol("usdz_SetActiveOnClick_wasVisible")),p(N0,"toggleClone",Symbol("clone for toggling")),p(N0,"reverseToggleClone",Symbol("clone for reverse toggling")),N0);let Hm=Mn;Cn([T(ye)],Hm.prototype,"target",2),Cn([T()],Hm.prototype,"toggleOnClick",2),Cn([T()],Hm.prototype,"targetState",2),Cn([T()],Hm.prototype,"hideSelf",2);class WD extends Pe{constructor(){super(...arguments),p(this,"wasVisible",!1)}start(){ie.setActive(this.gameObject,!1)}createBehaviours(e,i,s){i.uuid===this.gameObject.uuid&&(this.wasVisible||e.addBehavior(new Gs("HideOnStart_"+this.gameObject.name,zs.sceneStartTrigger(),bi.fadeAction(i,0,!1))))}beforeCreateDocument(){this.wasVisible=ie.isActiveSelf(this.gameObject)}}class U0 extends Pe{constructor(){super(...arguments),p(this,"target"),p(this,"duration",.5),p(this,"motionType","bounce")}beforeCreateDocument(){}createBehaviours(e,i,s){if(this.target&&i.uuid===this.gameObject.uuid){const r=new Gs("emphasize "+this.name,zs.tapTrigger(this.gameObject),bi.emphasize(this.target,this.duration,this.motionType,void 0,"basic"));e.addBehavior(r)}}afterCreateDocument(e,i){}}Cn([T()],U0.prototype,"target",2),Cn([T()],U0.prototype,"duration",2),Cn([T()],U0.prototype,"motionType",2);class Ud extends Pe{constructor(){super(...arguments),p(this,"target"),p(this,"clip",""),p(this,"toggleOnClick",!1),p(this,"trigger","tap")}start(){jA(this.gameObject)}ensureAudioSource(){if(!this.target){const e=this.gameObject.addComponent(Sn);e&&(this.target=e,e.spatialBlend=1,e.volume=1,e.loop=!1,e.preload=!0)}}onPointerClick(e){var i;e.use(),!(!((i=this.target)!=null&&i.clip)&&!this.clip)&&(this.ensureAudioSource(),this.target&&(this.target.isPlaying&&this.toggleOnClick?this.target.stop():(!this.toggleOnClick&&this.target.isPlaying&&this.target.stop(),this.clip?this.target.play(this.clip):this.target.play())))}createBehaviours(e,i,s){if(!(!this.target&&!this.clip)&&i.uuid===this.gameObject.uuid){const r=this.clip?this.clip:this.target?this.target.clip:void 0;if(!r||typeof r!="string")return;const o=this.target?this.target.gameObject:this.gameObject;mp.getName(r);const a=this.target?this.target.volume:1,l=this.target&&this.target.spatialBlend==0?"nonSpatial":"spatial";let c=!1;this.gameObject.traverse(m=>{m instanceof pe&&m.visible&&(c=!0)}),c=!0;const h=e.addAudioClip(r);let u=bi.playAudioAction(o,h,"play",a,l);this.target&&this.target.loop&&(u=bi.sequence(u).makeLooping());const d=this.name?"_"+this.name:"";if(c&&this.trigger==="tap"){this.toggleOnClick&&(u.multiplePerformOperation="stop");const m=new Gs("playAudio"+d,zs.tapTrigger(i),u);e.addBehavior(m)}if(this.target&&this.target.playOnAwake&&this.target.enabled)if(c&&this.trigger==="tap")console.warn("USDZExport: Audio sources that are played on tap can't also auto-play at scene start due to a QuickLook bug.");else{const m=new Gs("playAudioOnStart"+d,zs.sceneStartTrigger(),u);e.addBehavior(m)}}}}Cn([T(Sn)],Ud.prototype,"target",2),Cn([T(URL)],Ud.prototype,"clip",2),Cn([T()],Ud.prototype,"toggleOnClick",2);var xM;const Oc=(xM=class extends Pe{constructor(){super(...arguments),p(this,"animator"),p(this,"stateName"),p(this,"trigger","tap"),p(this,"animation"),p(this,"selfModel"),p(this,"stateAnimationModel"),p(this,"animationSequence",new Array),p(this,"animationLoopAfterSequence",new Array),p(this,"randomOffsetNormalized",0)}get target(){var n,e;return((n=this.animator)==null?void 0:n.gameObject)||((e=this.animation)==null?void 0:e.gameObject)}start(){jA(this.gameObject)}onPointerClick(n){var e;n.use(),this.target&&this.stateName&&((e=this.animator)==null||e.play(this.stateName,0,0,.1))}createBehaviours(n,e,i){e.uuid===this.gameObject.uuid&&(this.selfModel=e)}afterSerialize(){if(Oc.rootsWithExclusivePlayback.size>1){const n='Multiple root objects targeted by more than one animation. To work around QuickLook bug FB13410767, animations will be set as "exclusive" and activating them will stop other animations being marked as exclusive.';Ye()&&zi(n),console.warn(n,...Oc.rootsWithExclusivePlayback)}Oc.animationActions=[],Oc.rootsWithExclusivePlayback=new Set}afterCreateDocument(n,e){if(this.animationSequence===void 0&&this.animationLoopAfterSequence===void 0||!this.stateAnimationModel||!this.target)return;const i=e.document,s=e.extensions.find(a=>a instanceof yA);if(!s)return;const r=s.getClipCount(this.target)>1;r&&(Ye()&&console.warn("Setting exclusive playback for "+this.target.name+"@"+this.stateName+" because it has "+s.getClipCount(this.target)+" animations. This works around QuickLook bug FB13410767."),Oc.rootsWithExclusivePlayback.add(this.target));const o=this.name?this.name:"";i.traverse(a=>{var l,c;if(a.uuid===((l=this.target)==null?void 0:l.uuid)){const h=Oc.getActionForSequences(a,this.animationSequence,this.animationLoopAfterSequence,this.randomOffsetNormalized),u=new Gs(this.trigger+"_"+o+"_toPlayAnimation_"+this.stateName+"_on_"+((c=this.target)==null?void 0:c.name),this.trigger=="tap"?zs.tapTrigger(this.selfModel):zs.sceneStartTrigger(),h);r&&u.makeExclusive(!0),n.addBehavior(u)}})}static getActionForSequences(n,e,i,s){const r=(a,l)=>{let c=Oc.animationActions.find(h=>h.affectedObjects==a&&h.start==l.start&&h.duration==l.duration&&h.animationSpeed==l.speed);return c||(c=bi.startAnimationAction(a,l.start,l.duration,l.speed),Oc.animationActions.push(c)),c},o=bi.sequence();if(e&&e.length>0)for(const a of e)o.addAction(r(n,a));if(i&&i.length>0){const a=o.actions.length==0?o:bi.sequence();for(const l of i)a.addAction(r(n,l));a.makeLooping(),o!==a&&o.addAction(a)}return s&&s>0&&o.actions.unshift(bi.waitAction(s)),o}static getAndRegisterAnimationSequences(n,e,i){var s,r,o,a,l,c,h;if(!e)return;const u=e.getComponent(rr),d=e.getComponent(Fr);if(!u&&!d)return;if(u&&!i)throw new Error("PlayAnimationOnClick: No stateName specified for animator "+u.name+" on "+e.name);let m=[],f=[];if(d){const w=n.registerAnimation(e,d.clip);w&&(d.loop?f.push(w):m.push(w));let _=0;if(d.minMaxOffsetNormalized){const S=d.minMaxOffsetNormalized.x,M=d.minMaxOffsetNormalized.y;_=(((s=d.clip)==null?void 0:s.duration)||1)*(S+Math.random()*(M-S))}return{animationSequence:m,animationLoopAfterSequence:f,randomTimeOffset:_}}const g=u?.runtimeAnimatorController;let y=g?.findState(i),v=[],b=[];if(g&&y){const w=new Array;w.push(y);let _=!1;for(;w.length<100;){if(!y||y===null||!y.transitions||y.transitions.length===0){(r=y.motion)!=null&&r.isLooping&&(_=!0);break}const S=y.transitions.find(R=>R.conditions.length===0),M=S?g.getState(S.destinationState,0):null;if(M&&w.includes(M)){y=M,_=!0;break}else if(S){if(y=M,!y)break;w.push(y)}else{_=((o=y.motion)==null?void 0:o.isLooping)??!1;break}}if(_&&y){const S=w.indexOf(y);v=w.slice(0,S),b=w.slice(S),OQ&&console.log("found loop from "+i,"states until loop",v,"states looping",b)}else v=w,b=[],OQ&&console.log("found no loop from "+i,"states",v)}if(v.length===1&&(!((a=v[0].motion)!=null&&a.clip)||((c=(l=v[0].motion)==null?void 0:l.clip.tracks)==null?void 0:c.length)===0)){m=new Array;const w=n.registerAnimation(e,null);w&&m.push(w);return}if(v=v.filter(w=>{var _,S,M;return((_=w.motion)==null?void 0:_.clip)&&((M=(S=w.motion)==null?void 0:S.clip.tracks)==null?void 0:M.length)>0}),b=b.filter(w=>{var _,S,M;return((_=w.motion)==null?void 0:_.clip)&&((M=(S=w.motion)==null?void 0:S.clip.tracks)==null?void 0:M.length)>0}),v.length===0&&b.length===0){console.warn("No clips found for state "+i+" on "+u?.name+", can't export animation data");return}const A=(w,_)=>{if(!e)return;const S=n.registerAnimation(e,w.motion.clip??null);S?(S.speed=w.speed,_.push(S)):console.warn("Couldn't register animation for state "+w.name+" on "+u?.name)};if(v.length>0){m=new Array;for(const w of v)A(w,m)}if(b.length>0){f=new Array;for(const w of b)A(w,f)}let x=0;if(u&&g&&u.minMaxOffsetNormalized){const w=u.minMaxOffsetNormalized.x,_=u.minMaxOffsetNormalized.y,S=v.length?v[0]:b.length?b[0]:null;x=(((h=S?.motion.clip)==null?void 0:h.duration)||1)*(w+Math.random()*(_-w))}return{animationSequence:m,animationLoopAfterSequence:f,randomTimeOffset:x}}createAnimation(n,e,i){if(!this.target||!this.animator&&!this.animation)return;const s=Oc.getAndRegisterAnimationSequences(n,this.target,this.stateName);s&&(this.animationSequence=s.animationSequence,this.animationLoopAfterSequence=s.animationLoopAfterSequence,this.randomOffsetNormalized=s.randomTimeOffset,this.stateAnimationModel=e)}},p(xM,"animationActions",[]),p(xM,"rootsWithExclusivePlayback",new Set),xM);let jm=Oc;Cn([T(rr)],jm.prototype,"animator",2),Cn([T()],jm.prototype,"stateName",2);class V0 extends Pe{constructor(){super(...arguments),p(this,"target")}getType(){}getDuration(){}}Cn([T(ye)],V0.prototype,"target",2);class QA extends Pe{constructor(){super(...arguments),p(this,"target")}}Cn([T(V0)],QA.prototype,"target",2);class ZA extends V0{constructor(){super(...arguments),p(this,"type",1),p(this,"duration",1)}getType(){switch(this.type){case 1:return"hide";case 0:return"show"}}getDuration(){return this.duration}}Cn([T()],ZA.prototype,"type",2),Cn([T()],ZA.prototype,"duration",2);class HD extends QA{}var Ove=Object.defineProperty,Gve=Object.getOwnPropertyDescriptor,eu=(n,e,i,s)=>{for(var r=s>1?void 0:s?Gve(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&Ove(e,i,r),r};const GQ=te("debugcharactercontroller");class Qm extends Pe{constructor(){super(...arguments),p(this,"center",new E(0,0,0)),p(this,"radius",.5),p(this,"height",2),p(this,"_rigidbody",null),p(this,"_activeGroundCollisions"),p(this,"_contactVelocity",new E)}get rigidbody(){return this._rigidbody?this._rigidbody:(this._rigidbody=this.gameObject.getComponent(Li),this._rigidbody||(this._rigidbody=this.gameObject.addComponent(Li)),this.rigidbody)}awake(){this._activeGroundCollisions=new Set}onEnable(){const e=this.rigidbody;let i=this.gameObject.getComponent(qh);i||(i=this.gameObject.addComponent(qh)),i.center.copy(this.center),i.radius=this.radius,i.height=this.height;const s=new E(0,0,1),r=new E(1,0,0),o=new E(0,1,0),a=this.gameObject.getWorldDirection(new E);a.y=0;const l=r.dot(a)<0?-1:1,c=s.angleTo(a)*l;this.gameObject.setRotationFromAxisAngle(o,c),e.lockRotationX=!0,e.lockRotationY=!0,e.lockRotationZ=!0}move(e){this.gameObject.position.add(e)}onCollisionEnter(e){(e.contacts.length==0||e.contacts.some(i=>i.normal.y>.2))&&(this._activeGroundCollisions.add(e),GQ&&console.log(`Collision(${this._activeGroundCollisions.size}): ${e.contacts.map(i=>i.normal.y.toFixed(2)).join(", ")} - ${this.isGrounded}`))}onCollisionExit(e){this._activeGroundCollisions.delete(e),GQ&&console.log(`Collision(${this._activeGroundCollisions.size}) - ${this.isGrounded}`)}get isGrounded(){return this._activeGroundCollisions.size>0}get contactVelocity(){var e;this._contactVelocity.set(0,0,0);for(const i of this._activeGroundCollisions){const s=(e=this.context.physics.engine)==null?void 0:e.getLinearVelocity(i.collider);s&&(this._contactVelocity.x+=s.x,this._contactVelocity.y+=s.y,this._contactVelocity.z+=s.z)}return this._contactVelocity}}eu([T(E)],Qm.prototype,"center",2),eu([T()],Qm.prototype,"radius",2),eu([T()],Qm.prototype,"height",2);class tu extends Pe{constructor(){super(...arguments),p(this,"controller"),p(this,"movementSpeed",2),p(this,"rotationSpeed",2),p(this,"jumpForce",1),p(this,"doubleJumpForce",2),p(this,"animator"),p(this,"lookForward",!0),p(this,"lookInput",new Y(0,0)),p(this,"moveInput",new Y(0,0)),p(this,"jumpInput",!1),p(this,"_currentSpeed",new E(0,0,0)),p(this,"_currentAngularSpeed",new E(0,0,0)),p(this,"_temp",new E(0,0,0)),p(this,"_jumpCount",0),p(this,"_currentRotation"),p(this,"_raycastOptions",new yc)}awake(){this._currentRotation=new Se}update(){const e=this.context.input;e.isKeyPressed("KeyW")?this.moveInput.y+=1:e.isKeyPressed("KeyS")&&(this.moveInput.y-=1),e.isKeyPressed("KeyD")?this.lookInput.x+=1:e.isKeyPressed("KeyA")&&(this.lookInput.x-=1),this.jumpInput||(this.jumpInput=e.isKeyDown("Space"))}move(e){this.moveInput.add(e)}look(e){this.lookInput.add(e)}jump(){this.jumpInput=!0}onBeforeRender(){this.handleInput(this.moveInput,this.lookInput,this.jumpInput),this.lookInput.set(0,0),this.moveInput.set(0,0),this.jumpInput=!1}handleInput(e,i,s){var r,o,a,l,c,h,u,d,m,f,g;if((r=this.controller)!=null&&r.isGrounded&&(this._jumpCount=0,this.doubleJumpForce>0&&((o=this.animator)==null||o.setBool("doubleJump",!1))),this._currentSpeed.z+=e.y*this.movementSpeed*this.context.time.deltaTime,(a=this.animator)==null||a.setBool("running",e.length()>.01),(c=this.animator)==null||c.setBool("jumping",((l=this.controller)==null?void 0:l.isGrounded)===!0&&s),this._temp.copy(this._currentSpeed),this._temp.applyQuaternion(this.gameObject.quaternion),this.controller?this.controller.move(this._temp):this.gameObject.position.add(this._temp),this._currentAngularSpeed.y+=tt.toRadians(-i.x*this.rotationSpeed)*this.context.time.deltaTime,this.lookForward&&Math.abs(this._currentAngularSpeed.y)<.01){const y=this.context.mainCameraComponent.forward;y.y=0,y.normalize(),this._currentRotation.setFromUnitVectors(new E(0,0,1),y),this.gameObject.quaternion.slerp(this._currentRotation,this.context.time.deltaTime*10)}if(this.gameObject.rotateY(this._currentAngularSpeed.y),this._currentSpeed.multiplyScalar(1-this.context.time.deltaTime*10),this._currentAngularSpeed.y*=1-this.context.time.deltaTime*10,this.controller&&s&&this.jumpForce>0){let y=(h=this.controller)==null?void 0:h.isGrounded;if(this.doubleJumpForce>0&&!((u=this.controller)!=null&&u.isGrounded)&&this._jumpCount===1&&(y=!0,(d=this.animator)==null||d.setBool("doubleJump",!0)),y){this._jumpCount+=1;const v=this.controller.rigidbody,b=this._jumpCount===2?this.doubleJumpForce:this.jumpForce;v.applyImpulse(new E(0,1,0).multiplyScalar(b))}}if(this.controller){const y=(m=this.controller)==null?void 0:m.rigidbody.getVelocity().y;if(y<-1){this._raycastOptions.ray||(this._raycastOptions.ray=new qr),this._raycastOptions.ray.origin.copy(zt(this.gameObject)),this._raycastOptions.ray.direction.set(0,-1,0);const v=this.layer;this.gameObject.layers.disableAll(),this.gameObject.layers.set(2);const b=this.context.physics.raycast(this._raycastOptions);this.gameObject.layers.set(v),(b.length&&b[0].distance>2||y<-10)&&((f=this.animator)==null||f.setBool("falling",!0))}else(g=this.animator)==null||g.setBool("falling",!1)}}}eu([T(Qm)],tu.prototype,"controller",2),eu([T()],tu.prototype,"movementSpeed",2),eu([T()],tu.prototype,"rotationSpeed",2),eu([T()],tu.prototype,"jumpForce",2),eu([T()],tu.prototype,"doubleJumpForce",2),eu([T(rr)],tu.prototype,"animator",2);var zve=Object.defineProperty,Fve=Object.getOwnPropertyDescriptor,Nve=(n,e,i,s)=>{for(var r=s>1?void 0:s?Fve(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&zve(e,i,r),r};class YA extends Vs{constructor(){super(...arguments),p(this,"intensity",new Je(0))}get typeName(){return"ChromaticAberration"}onCreateEffect(){const e=new J5;return e.offset=new Y(0,0),e.radialModulation=!0,e.modulationOffset=.15,this.intensity.valueProcessor=i=>i*.02,this.intensity.onValueChanged=i=>{e.offset.x=-i,e.offset.y=i},e}}Nve([T(Je)],YA.prototype,"intensity",2),Ka("ChromaticAberration",YA);var Uve=Object.defineProperty,Vve=Object.getOwnPropertyDescriptor,zQ=(n,e,i,s)=>{for(var r=s>1?void 0:s?Vve(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&Uve(e,i,r),r};const FQ=te("debugpost");var wM=(n=>(n[n.None=0]="None",n[n.Neutral=1]="Neutral",n[n.ACES=2]="ACES",n[n.AgX=3]="AgX",n[n.KhronosNeutral=4]="KhronosNeutral",n))(wM||{});function jD(n){switch(n){case 0:return Tf;case 1:return Yy;case 2:return Ky;case 3:return Rf;case 4:return xp;default:return xp}}function Xve(n){switch(n){case Tf:return 0;case Ky:return 2;case Rf:return 3;case xp:return 1;case Yy:return 1;default:return 0}}function NQ(n){switch(n){case Tf:return As.LINEAR;case Ky:return As.ACES_FILMIC;case Rf:return As.AGX;case xp:return As.NEUTRAL;case Yy:return As.REINHARD;default:return As.LINEAR}}const UQ=class extends Vs{constructor(){super(...arguments),p(this,"mode",new Je(void 0)),p(this,"exposure",new Je(1))}get typeName(){return"ToneMapping"}setMode(n){const e=wM[n];return e===void 0?(console.error("Invalid ToneMapping mode",n),this):(this.mode.value=e,this)}get isToneMapping(){return!0}onEffectEnabled(){const n=dQ(this);n&&super.onEffectEnabled(n)}onCreateEffect(){if(this.postprocessingContext)for(const i of this.postprocessingContext.components){if(i===this)break;if(i!=this&&i instanceof UQ){console.warn("Multiple tonemapping effects found in the same postprocessing stack: Please check your scene setup.",{activeEffect:i,ignoredEffect:this});return}}if(this.mode.isInitialized==!1){const i=Xve(this.context.renderer.toneMapping);this.mode.initialize(i)}const n=jD(this.mode.value),e=new k_({mode:NQ(n)});return this.mode.onValueChanged=i=>{const s=jD(i);e.mode=NQ(s),FQ&&console.log("ToneMapping mode changed to",wM[i],s,e.mode)},FQ&&console.log("Use ToneMapping",wM[this.mode.value],n,e.mode,"renderer.tonemapping: "+this.context.renderer.toneMapping),this.exposure.onValueChanged=i=>{this.context.renderer.toneMappingExposure=i},e}onBeforeRender(){this.mode.overrideState&&(this.context.renderer.toneMapping=jD(this.mode.value)),this.exposure.overrideState&&(this.context.renderer.toneMappingExposure=this.exposure.value)}};let Vd=UQ;zQ([T(Je)],Vd.prototype,"mode",2),zQ([T(Je)],Vd.prototype,"exposure",2),Ka("Tonemapping",Vd);var Wve=Object.defineProperty,Hve=Object.getOwnPropertyDescriptor,_M=(n,e,i,s)=>{for(var r=s>1?void 0:s?Hve(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&Wve(e,i,r),r};class Xd extends Vs{constructor(){super(...arguments),p(this,"postExposure",new Je(0)),p(this,"contrast",new Je(0)),p(this,"hueShift",new Je(0)),p(this,"saturation",new Je(0))}get typeName(){return"ColorAdjustments"}init(){this.postExposure.valueProcessor=e=>(e=Math.pow(2,e),e),this.contrast.valueProcessor=e=>{let i=1;return e>0?i=200:e<0&&(i=100),e/i},this.contrast.defaultValue=0,this.hueShift.valueProcessor=e=>Math.PI*e/180,this.hueShift.defaultValue=0,this.saturation.valueProcessor=e=>e<0?e/100:e/(100*Math.PI),this.saturation.defaultValue=0}onCreateEffect(){var e,i;const s=[];this.context.renderer.toneMapping!==Yr&&this.postExposure.overrideState&&(this.context.renderer.toneMapping=Yr);let r=(e=this.postprocessingContext)==null?void 0:e.components.find(l=>l instanceof Vd);r||(r=new Vd,(i=this.postprocessingContext)==null||i.components.push(r)),this.postExposure.onValueChanged=l=>{this.postExposure.overrideState&&(r.exposure.value=l)};const o=new K5;this.contrast.onValueChanged=l=>o.contrast=l;const a=new tV;return s.push(o),s.push(a),this.hueShift.onValueChanged=l=>a.hue=l,this.saturation.onValueChanged=l=>a.saturation=l,s}}_M([T(Je)],Xd.prototype,"postExposure",2),_M([T(Je)],Xd.prototype,"contrast",2),_M([T(Je)],Xd.prototype,"hueShift",2),_M([T(Je)],Xd.prototype,"saturation",2),Ka("ColorAdjustments",Xd);const VQ=Math.sqrt(5),jve=(VQ-1)/4,hr=(5-VQ)/20,SM=n=>Math.floor(n)|0,CM=new Float64Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);function Qve(n=Math.random){const e=Zve(n),i=new Float64Array(e).map(a=>CM[a%32*4]),s=new Float64Array(e).map(a=>CM[a%32*4+1]),r=new Float64Array(e).map(a=>CM[a%32*4+2]),o=new Float64Array(e).map(a=>CM[a%32*4+3]);return function(a,l,c,h){let u,d,m,f,g;const y=(a+l+c+h)*jve,v=SM(a+y),b=SM(l+y),A=SM(c+y),x=SM(h+y),w=(v+b+A+x)*hr,_=v-w,S=b-w,M=A-w,R=x-w,P=a-_,C=l-S,L=c-M,B=h-R;let z=0,D=0,W=0,O=0;P>C?z++:D++,P>L?z++:W++,P>B?z++:O++,C>L?D++:W++,C>B?D++:O++,L>B?W++:O++;const F=z>=3?1:0,X=D>=3?1:0,J=W>=3?1:0,q=O>=3?1:0,oe=z>=2?1:0,_e=D>=2?1:0,ke=W>=2?1:0,re=O>=2?1:0,we=z>=1?1:0,Me=D>=1?1:0,it=W>=1?1:0,je=O>=1?1:0,Ge=P-F+hr,rt=C-X+hr,ge=L-J+hr,Q=B-q+hr,Ne=P-oe+2*hr,Re=C-_e+2*hr,Te=L-ke+2*hr,We=B-re+2*hr,be=P-we+3*hr,nt=C-Me+3*hr,ct=L-it+3*hr,It=B-je+3*hr,H=P-1+4*hr,G=C-1+4*hr,ue=L-1+4*hr,Ee=B-1+4*hr,De=v&255,Le=b&255,At=A&255,ht=x&255;let Ue=.6-P*P-C*C-L*L-B*B;if(Ue<0)u=0;else{const Oe=De+e[Le+e[At+e[ht]]];Ue*=Ue,u=Ue*Ue*(i[Oe]*P+s[Oe]*C+r[Oe]*L+o[Oe]*B)}let Xe=.6-Ge*Ge-rt*rt-ge*ge-Q*Q;if(Xe<0)d=0;else{const Oe=De+F+e[Le+X+e[At+J+e[ht+q]]];Xe*=Xe,d=Xe*Xe*(i[Oe]*Ge+s[Oe]*rt+r[Oe]*ge+o[Oe]*Q)}let Ct=.6-Ne*Ne-Re*Re-Te*Te-We*We;if(Ct<0)m=0;else{const Oe=De+oe+e[Le+_e+e[At+ke+e[ht+re]]];Ct*=Ct,m=Ct*Ct*(i[Oe]*Ne+s[Oe]*Re+r[Oe]*Te+o[Oe]*We)}let ze=.6-be*be-nt*nt-ct*ct-It*It;if(ze<0)f=0;else{const Oe=De+we+e[Le+Me+e[At+it+e[ht+je]]];ze*=ze,f=ze*ze*(i[Oe]*be+s[Oe]*nt+r[Oe]*ct+o[Oe]*It)}let qt=.6-H*H-G*G-ue*ue-Ee*Ee;if(qt<0)g=0;else{const Oe=De+1+e[Le+1+e[At+1+e[ht+1]]];qt*=qt,g=qt*qt*(i[Oe]*H+s[Oe]*G+r[Oe]*ue+o[Oe]*Ee)}return 27*(u+d+m+f+g)}}function Zve(n){const e=new Uint8Array(512);for(let i=0;i<512/2;i++)e[i]=i;for(let i=0;i<512/2-1;i++){const s=i+~~(n()*(256-i)),r=e[i];e[i]=e[s],e[s]=r}for(let i=256;i<512;i++)e[i]=e[i-256];return e}const QD=te("debugstencil");function Yve(n,e){return(n&1<<e.layer)!=0}const Kve=Symbol("stencils"),X0=class{constructor(n,e){p(this,"parser"),p(this,"source"),this.parser=n,this.source=e}get name(){return"NEEDLE_render_objects"}static applyStencil(n){if(!n)return;const e=n.sourceId;if(QD&&console.log(e,X0.stencils),!e)return;const i=X0.stencils[e];if(i)for(let s=i.length-1;s>=0;s--){const r=i[s];if(Yve(r.layer,n)){QD&&console.log(r),setTimeout(()=>{no()&&cC(n.gameObject)&&(zi("Stencil not supported on instanced objects"),console.warn("Stencil not supported on instanced objects",n))},500);for(let o=0;o<n.sharedMaterials.length;o++){let a=n.sharedMaterials[o];a&&(a=a.clone(),a[Kve]=!0,a.stencilWrite=!0,a.stencilWriteMask=255,a.stencilFuncMask=255,a.stencilRef=r.value,a.stencilFunc=r.compareFunc,a.stencilZPass=r.passOp,a.stencilFail=r.failOp,a.stencilZFail=r.zFailOp,n.sharedMaterials[o]=a)}n.gameObject.renderOrder=r.event*1e3+r.index*50;break}}}afterRoot(n){const e=this.parser.json.extensions;if(e){const i=e[qve];if(i){QD&&console.log(i);const s=i.stencil;if(s&&Array.isArray(s))for(const r of s){const o={...r};o.compareFunc=Jve(o.compareFunc),o.passOp=YD(o.passOp),o.failOp=YD(o.failOp),o.zFailOp=YD(o.zFailOp),X0.stencils[this.source]||(X0.stencils[this.source]=[]),X0.stencils[this.source].push(o)}}}return null}};let ZD=X0;p(ZD,"stencils",{});function YD(n){switch(n){case 0:return Tu;case 1:return uz;case 2:return dz;case 3:return pz;case 4:return mz;case 6:return fz;case 7:return gz;case 5:return yz}return 0}function Jve(n){switch(n){case 1:return IR;case 2:return vz;case 3:return bz;case 4:return Az;case 5:return xz;case 6:return wz;case 7:return _z;case 8:return X1}return IR}const qve="NEEDLE_render_objects";var $ve=Object.defineProperty,ebe=Object.getOwnPropertyDescriptor,XQ=(n,e,i,s)=>{for(var r=s>1?void 0:s?ebe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&$ve(e,i,r),r};const MM=te("debugreflectionprobe"),WQ=te("noreflectionprobe"),tbe=Symbol("reflectionProbeKey"),ibe=Symbol("original material");var EM;const iu=(EM=class extends Pe{constructor(){var n;super(),p(this,"_texture"),p(this,"center"),p(this,"size"),p(this,"_boxHelper"),iu._probes.has(this.context)||iu._probes.set(this.context,[]),(n=iu._probes.get(this.context))==null||n.push(this)}static get(n,e,i,s){if(!n||n.isObject3D!==!0||WQ)return null;const r=iu._probes.get(e);if(r){for(const o of r)if(o.__didAwake||o.__internalAwake(),o.enabled&&s&&o.gameObject===s)return o}return MM&&console.debug("Did not find reflection probe",n.name,i,n),null}set texture(n){if(n&&!(n instanceof Vt)){console.error("ReflectionProbe.texture must be a Texture",n);return}this._texture=n,n&&(n.mapping=Kr,n.colorSpace=vt,n.needsUpdate=!0)}get texture(){return this._texture}isInBox(n){var e;return(e=this._boxHelper)==null?void 0:e.isInBox(n)}awake(){this._boxHelper=this.gameObject.addComponent(Ja),this._boxHelper.updateBox(!0),MM&&this._boxHelper.showHelper(5592320,!0),this.texture&&(this.texture.mapping=Kr,this.texture.colorSpace=vt,this.texture.needsUpdate=!0)}onDestroy(){const n=iu._probes.get(this.context);if(n){const e=n.indexOf(this);e>=0&&n.splice(e,1)}}onSet(n){var e;if(WQ||!this.enabled||((e=n.sharedMaterials)==null?void 0:e.length)<=0||!this.texture)return;let i=iu._rendererMaterialsCache.get(n);i||(i=[],iu._rendererMaterialsCache.set(n,i));for(let s=0;s<n.sharedMaterials.length;s++){const r=n.sharedMaterials[s];if(!r||r.envMap===void 0||r instanceof Qt)continue;let o=i[s];const a=r===o?.copy,l=!o||o.material.uuid!==r.uuid||o.copy.version!==r.version;if(!a&&l){if(MM){let u="";o?o.material!==r?u="reference changed; cached instance?: "+a:o.copy.version!==r.version&&(u="version changed"):u="not cached",console.warn("Cloning material",r.name,r.version,"Reason:",u,`
`,r.uuid,`
`,o?.copy.uuid,`
`,n.name)}const h=r.clone();h.version=r.version,o?(o.copy=h,o.material=r):(o={material:r,copy:h},i.push(o)),h[tbe]=this,h[ibe]=r,MM&&console.log("Set reflection",n.name,n.guid)}o&&o.copy&&(o.copy.onBeforeCompile=r.onBeforeCompile);const c=o?.copy;c.envMap=this.texture,n.sharedMaterials[s]=c}}onUnset(n){const e=iu._rendererMaterialsCache.get(n);if(e)for(let i=0;i<e.length;i++){const s=e[i];n.sharedMaterials[i]=s.material}}},p(EM,"_probes",new Map),p(EM,"_rendererMaterialsCache",new Map),EM);let W0=iu;XQ([T(E)],W0.prototype,"center",2),XQ([T(E)],W0.prototype,"size",2);const KD=te("debugexr");class nbe{constructor(e){p(this,"parser"),this.parser=e,KD&&console.log(e)}get name(){return"EXT_texture_exr"}loadTexture(e){const i=this.name,s=this.parser,r=s.json.textures[e];if(KD&&console.log("EXT_texture_exr.loadTexture",e,r),!r.extensions||!r.extensions[i])return null;const o=r.extensions[i],a=new oA(s.options.manager);return KD&&console.log("EXT_texture_exr.loadTexture",o),s.loadTextureImage(e,o.source,a)}}typeof window<"u"&&window.addEventListener("unhandledrejection",n=>{});const nu=Os,TM="$___Export_Components",sbe="NEEDLE_components";var HQ;class rbe{constructor(){p(this,HQ)}}HQ=im;class obe{constructor(e,i,s){p(this,"node"),p(this,"nodeIndex"),p(this,"nodeDef"),this.node=e,this.nodeIndex=i,this.nodeDef=s}}class abe{constructor(){p(this,"parser"),p(this,"nodeToObjectMap",{}),p(this,"exportContext"),p(this,"objectToNodeMap",{}),p(this,"context"),p(this,"writer")}get name(){return sbe}registerExport(e){e.register(i=>{if("serializeUserData"in i){const s=i.serializeUserData.bind(i);this.writer=i,i.serializeUserData=(r,o)=>{try{this.serializeUserData(r,o),s(r,o)}finally{this.afterSerializeUserData(r,o)}}}return this})}beforeParse(){this.exportContext={},this.objectToNodeMap={}}serializeUserData(e,i){var s;const r=(s=e.userData)==null?void 0:s.components;!r||r.length<=0||(delete e.userData.components,e[TM]=r)}afterSerializeUserData(e,i){if(e.type==="Scene"&&nu&&console.log("DONE",JSON.stringify(i)),e[TM]===void 0)return;const s=e[TM];delete e[TM],s!==null&&(e.userData.components=s)}writeNode(e,i){const s=this.writer.json.nodes.length;nu&&console.log(e.name,s,e.uuid);const r=new obe(e,s,i);this.exportContext[s]=r,this.objectToNodeMap[e.uuid]=s}afterParse(e){var i;nu&&console.log("AFTER",e);for(const s in this.exportContext){const r=this.exportContext[s],o=r.node,a=r.nodeDef,l=r.nodeIndex,c=(i=o.userData)==null?void 0:i.components;if(!c||c.length<=0)continue;const h=new rbe;a.extensions=a.extensions||{},a.extensions[this.name]=h,this.context.object=o,this.context.nodeId=l,this.context.objectToNode=this.objectToNodeMap;const u=[];for(const d of c){this.context.target=d;const m=yl().writeBuiltinComponentData(d,this.context);m!==null&&u.push(m)}u.length>0&&(h[im]=u,nu&&console.log("DID WRITE",o,"nodeIndex",l,u))}}beforeRoot(){return nu&&console.log("BEGIN LOAD"),this.nodeToObjectMap={},null}async afterRoot(e){const i=e.parser,s=i?.extensions;if(!s)return;const r=s[this.name];nu&&console.log("After root",e,this.parser,s);const o=[];if(r===!0){const a=i.json.nodes;if(a){for(let l=0;l<a.length;l++){const c=await i.getDependency("node",l);this.nodeToObjectMap[l]=c}for(let l=0;l<a.length;l++){const c=a[l],h=l,u=c.extensions;if(!u)continue;const d=u[this.name];if(!d)continue;nu&&console.log("NODE",c);const m=this.nodeToObjectMap[h];if(!m){console.error("Could not find object for node index: "+h,c,i);continue}oC(m),o.push(this.createComponents(m,d))}}}await Promise.all(o);for(const a of i.associations.keys()){const l=i.associations.get(a);if(l?.materials!=null){const c="/materials/"+l.materials;Ome(a,c)}}}async createComponents(e,i){if(!i)return;const s=i[im];if(s){const r=new Array;nu&&console.log(e.name,s);for(const o in s){const a=s[o];nu&&console.log("Serialized data",JSON.parse(JSON.stringify(a))),a&&this.parser&&r.push(XB(this.parser,a).catch(l=>console.error(`Error while resolving references (see console for details)
`,l,e,a))),e.userData=e.userData||{},e.userData[im]=e.userData[im]||[],e.userData[im].push(a)}await Promise.all(r).catch(o=>{console.error("Error while loading components",o)})}}}const jQ="NEEDLE_gameobject_data";class lbe{constructor(e){p(this,"parser"),this.parser=e}get name(){return jQ}afterRoot(e){var i;const s=[];for(let r=0;r<((i=this.parser.json.nodes)==null?void 0:i.length);r++){const o=this.parser.json.nodes[r];if(o&&o.extensions){const a=o.extensions[jQ];if(a){const l=this.findAndApplyExtensionData(r,a);s.push(l)}}}return Promise.all(s).then(()=>null)}async findAndApplyExtensionData(e,i){const s=await this.parser.getDependency("node",e);s&&this.applyExtensionData(s,i)}applyExtensionData(e,i){i.layers===void 0&&(i.layers=0),e.userData.layer=i.layers,e.layers.disableAll(),e.layers.set(i.layers),e.userData.tag=i.tag??"none",e.userData.hideFlags=i.hideFlags??0,e.userData.static=i.static??!1,e.visible=i.activeSelf??!0,e.guid=i.guid}}const QQ="NEEDLE_lighting_settings",H0=te("debugenvlight");class cbe{constructor(e,i,s){p(this,"parser"),p(this,"sourceId"),p(this,"context"),this.parser=e,this.sourceId=i,this.context=s}get name(){return QQ}afterRoot(e){const i=this.parser.json.extensions;if(i){const s=i[QQ];if(s){H0&&console.log('Loaded "'+this.name+'", src: "'+this.sourceId+'"',s);let r;if(e.scene.children.length===1){const o=e.scene.children[0];r=ie.addComponent(o,RM,{},{callAwake:!1})}else{const o=new ye;o.name="LightSettings "+this.sourceId,e.scene.add(o),r=ie.addComponent(o,RM,{},{callAwake:!1})}r.sourceId=this.sourceId,r.ambientIntensity=s.ambientIntensity,r.ambientLight=new Ae().fromArray(s.ambientLight),Array.isArray(s.ambientTrilight)&&(r.ambientTrilight=s.ambientTrilight.map(o=>new Ae().fromArray(o))),r.ambientMode=s.ambientMode,r.environmentReflectionSource=s.environmentReflectionSource}}return null}}yi.registerCallback(wi.ContextCreated,n=>{const e=n.context,i=ie.findObjectOfType(RM,e);i!=null&&i.sourceId&&(i.enabled=!0)});class RM extends Pe{constructor(){super(...arguments),p(this,"ambientMode",f0.Skybox),p(this,"ambientLight"),p(this,"ambientTrilight"),p(this,"ambientIntensity",1),p(this,"environmentReflectionSource",EC.Skybox),p(this,"_hasReflection",!1),p(this,"_ambientLightObj"),p(this,"_hemisphereLightObj")}awake(){var e;if(this.sourceId){const s=this.environmentReflectionSource===EC.Skybox?bd.Skybox:bd.Reflection,r=this.context.lightmaps.tryGet(this.sourceId,s,0);this._hasReflection=r!=null,r&&this.context.sceneLighting.internalRegisterReflection(this.sourceId,r)}this.enabled=!1,this.context.sceneLighting.internalRegisterSceneLightSettings(this),H0&&window.addEventListener("keydown",s=>{if(!this.destroyed)switch(s.key){case"l":this.enabled=!this.enabled;break}});const i=(e=this.gameObject.userData)==null?void 0:e.components;if(i){const s=i.indexOf(this);i.splice(s,1),i.push(this)}}onDestroy(){this.context.sceneLighting.internalUnregisterSceneLightSettings(this)}calculateIntensityFactor(e){const i=Math.max(e.r,e.g,e.b);return 2.2*tt.lerp(0,1.33,i)}onEnable(){if(H0&&console.warn("\u{1F4A1}\u{1F7E1} >>> Enable lighting",this.sourceId,this.enabled,this),this.ambientMode==f0.Flat){if(this.ambientLight&&!this._ambientLightObj){const e=this.calculateIntensityFactor(this.ambientLight);this._ambientLightObj=new jw(this.ambientLight,this.ambientIntensity*e),H0&&console.log("Created ambient light",this.sourceId,this._ambientLightObj,this.ambientIntensity,e)}this._ambientLightObj&&this.gameObject.add(this._ambientLightObj)}else if(this.ambientMode===f0.Trilight){if(this.ambientTrilight){const e=this.ambientTrilight[0],i=this.ambientTrilight[this.ambientTrilight.length-1],s=this.calculateIntensityFactor(i);this._hemisphereLightObj=new Q2(i,e,this.ambientIntensity*s),this.gameObject.add(this._hemisphereLightObj),H0&&console.log("Created hemisphere ambient light",this.sourceId,this._hemisphereLightObj,this.ambientIntensity,s)}}else this._ambientLightObj&&this._ambientLightObj.removeFromParent(),this._hemisphereLightObj&&this._hemisphereLightObj.removeFromParent();this.sourceId&&this.context.sceneLighting.internalEnableReflection(this.sourceId)}onDisable(){H0&&console.warn("\u{1F4A1}\u26AB <<< Disable lighting:",this.sourceId,this),this._ambientLightObj&&this._ambientLightObj.removeFromParent(),this._hemisphereLightObj&&this._hemisphereLightObj.removeFromParent(),this.sourceId&&this.context.sceneLighting.internalDisableReflection(this.sourceId)}}var ZQ=(n=>(n[n.INT=5124]="INT",n[n.FLOAT=5126]="FLOAT",n[n.FLOAT_VEC2=35664]="FLOAT_VEC2",n[n.FLOAT_VEC3=35665]="FLOAT_VEC3",n[n.FLOAT_VEC4=35666]="FLOAT_VEC4",n[n.INT_VEC2=35667]="INT_VEC2",n[n.INT_VEC3=35668]="INT_VEC3",n[n.INT_VEC4=35669]="INT_VEC4",n[n.BOOL=35670]="BOOL",n[n.BOOL_VEC2=35671]="BOOL_VEC2",n[n.BOOL_VEC3=35672]="BOOL_VEC3",n[n.BOOL_VEC4=35673]="BOOL_VEC4",n[n.FLOAT_MAT2=35674]="FLOAT_MAT2",n[n.FLOAT_MAT3=35675]="FLOAT_MAT3",n[n.FLOAT_MAT4=35676]="FLOAT_MAT4",n[n.SAMPLER_2D=35678]="SAMPLER_2D",n[n.SAMPLER_3D=35680]="SAMPLER_3D",n[n.SAMPLER_CUBE=35681]="SAMPLER_CUBE",n[n.UNKNOWN=0]="UNKNOWN",n))(ZQ||{});const Gc=te("debugcustomshader"),j0="NEEDLE_techniques_webgl";class hbe{constructor(){p(this,"objectToWorldMatrix",new he),p(this,"worldToObjectMatrix",new he),p(this,"objectToWorld",new Array),p(this,"worldToObject",new Array)}updateFrom(e){this.objectToWorldMatrix.copy(e.matrixWorld),MC(this.objectToWorldMatrix,this.objectToWorld),this.worldToObjectMatrix.copy(e.matrixWorld).invert(),MC(this.worldToObjectMatrix,this.worldToObject)}}const En=class extends Vw{constructor(n,...e){super(...e),p(this,"identifier"),p(this,"onBeforeRenderSceneCallback",this.onBeforeRenderScene.bind(this)),p(this,"_sphericalHarmonicsName","unity_SpecCube0"),p(this,"_objToWorldName","hlslcc_mtx4x4unity_ObjectToWorld"),p(this,"_worldToObjectName","hlslcc_mtx4x4unity_WorldToObject"),p(this,"_viewProjectionName","hlslcc_mtx4x4unity_MatrixVP"),p(this,"_viewMatrixName","hlslcc_mtx4x4unity_MatrixV"),p(this,"_rendererData",new hbe),this.identifier=n,Gc&&console.log(this),this.type="NEEDLE_CUSTOM_SHADER",this.uniforms[this._objToWorldName]||(this.uniforms[this._objToWorldName]={value:[]}),this.uniforms[this._worldToObjectName]||(this.uniforms[this._worldToObjectName]={value:[]}),this.uniforms[this._viewProjectionName]||(this.uniforms[this._viewProjectionName]={value:[]}),this.uniforms[this._sphericalHarmonicsName],(this.depthTextureUniform||this.opaqueTextureUniform)&&Pt.Current.pre_render_callbacks.push(this.onBeforeRenderSceneCallback)}clone(){const n=super.clone();return YQ(n),n}dispose(){super.dispose();const n=Pt.Current.pre_render_callbacks.indexOf(this.onBeforeRenderSceneCallback);n>=0&&Pt.Current.pre_render_callbacks.splice(n,1)}get depthTextureUniform(){if(this.uniforms)return this.uniforms._CameraDepthTexture}get opaqueTextureUniform(){if(this.uniforms)return this.uniforms._CameraOpaqueTexture}onBeforeRenderScene(){this.opaqueTextureUniform&&Pt.Current.setRequireColor(!0),this.depthTextureUniform&&Pt.Current.setRequireDepth(!0)}onBeforeRender(n,e,i,s,r,o){s.attributes.tangent||s.computeTangents(),this.onUpdateUniforms(i,r)}onUpdateUniforms(n,e){const i=Pt.Current;if(n&&(En.viewProjection&&this.uniforms[this._viewProjectionName]&&(En.viewProjection.copy(n.projectionMatrix).multiply(n.matrixWorldInverse),MC(En.viewProjection,En._viewProjectionValues)),En.viewMatrix&&this.uniforms[this._viewMatrixName]&&(En.viewMatrix.copy(n.matrixWorldInverse),MC(En.viewMatrix,En._viewMatrixValues)),this.uniforms[En._worldSpaceCameraPosName]&&En._worldSpaceCameraPos.setFromMatrixPosition(n.matrixWorld)),this.uniforms._TimeParameters&&(this.uniforms._TimeParameters.value=i.sceneLighting.timeVec4),this.uniforms._Time){const a=this.uniforms._Time.value;a.x=i.sceneLighting.timeVec4.x/20,a.y=i.sceneLighting.timeVec4.x,a.z=i.sceneLighting.timeVec4.x*2,a.w=i.sceneLighting.timeVec4.x*3}if(this.uniforms._SinTime){const a=this.uniforms._SinTime.value;a.x=Math.sin(i.sceneLighting.timeVec4.x/8),a.y=Math.sin(i.sceneLighting.timeVec4.x/4),a.z=Math.sin(i.sceneLighting.timeVec4.x/2),a.w=Math.sin(i.sceneLighting.timeVec4.x)}if(this.uniforms._CosTime){const a=this.uniforms._CosTime.value;a.x=Math.cos(i.sceneLighting.timeVec4.x/8),a.y=Math.cos(i.sceneLighting.timeVec4.x/4),a.z=Math.cos(i.sceneLighting.timeVec4.x/2),a.w=Math.cos(i.sceneLighting.timeVec4.x)}if(this.uniforms.unity_DeltaTime){const a=this.uniforms.unity_DeltaTime.value;a.x=i.time.deltaTime,a.y=1/i.time.deltaTime,a.z=i.time.smoothedDeltaTime,a.w=1/i.time.smoothedDeltaTime}const s=i.mainLight;if(s){const a=zt(s.gameObject,En._mainLightPosition);this.uniforms._MainLightPosition={value:a.normalize()},En._mainLightColor.set(s.color.r,s.color.g,s.color.b,0),this.uniforms._MainLightColor={value:En._mainLightColor};const l=s.intensity;En._lightData.z=l,this.uniforms.unity_LightData={value:En._lightData}}if(n&&(En.viewProjection&&this.uniforms[this._viewProjectionName]&&(this.uniforms[this._viewProjectionName].value=En._viewProjectionValues),En.viewMatrix&&this.uniforms[this._viewMatrixName]&&(this.uniforms[this._viewMatrixName].value=En._viewMatrixValues),this.uniforms[En._worldSpaceCameraPosName]&&(this.uniforms[En._worldSpaceCameraPosName]={value:En._worldSpaceCameraPos}),i.mainCameraComponent)){if(this.uniforms._ProjectionParams){const a=this.uniforms._ProjectionParams.value;a.x=1,a.y=i.mainCameraComponent.nearClipPlane,a.z=i.mainCameraComponent.farClipPlane,a.w=1/a.z,this.uniforms._ProjectionParams.value=a}if(this.uniforms._ZBufferParams){const a=this.uniforms._ZBufferParams.value,l=i.mainCameraComponent;a.x=1-l.farClipPlane/l.nearClipPlane,a.y=l.farClipPlane/l.nearClipPlane,a.z=a.x/l.farClipPlane,a.w=a.y/l.farClipPlane,this.uniforms._ZBufferParams.value=a}if(this.uniforms._ScreenParams){const a=this.uniforms._ScreenParams.value;a.x=i.domWidth,a.y=i.domHeight,a.z=1+1/a.x,a.w=1+1/a.y,this.uniforms._ScreenParams.value=a}if(this.uniforms._ScaledScreenParams){const a=this.uniforms._ScaledScreenParams.value;a.x=i.domWidth,a.y=i.domHeight,a.z=1+1/a.x,a.w=1+1/a.y,this.uniforms._ScaledScreenParams.value=a}}const r=this.depthTextureUniform;r&&(r.value=i.depthTexture);const o=this.opaqueTextureUniform;if(o&&(o.value=i.opaqueColorTexture),e){const a=this._rendererData;a.updateFrom(e),this.uniforms[this._worldToObjectName].value=a.worldToObject,this.uniforms[this._objToWorldName].value=a.objectToWorld}this.uniformsNeedUpdate=!0}};let Ul=En;p(Ul,"viewProjection",new he),p(Ul,"_viewProjectionValues",[]),p(Ul,"viewMatrix",new he),p(Ul,"_viewMatrixValues",[]),p(Ul,"_worldSpaceCameraPosName","_WorldSpaceCameraPos"),p(Ul,"_worldSpaceCameraPos",new E),p(Ul,"_mainLightColor",new Ze),p(Ul,"_mainLightPosition",new E),p(Ul,"_lightData",new Ze);class ube{constructor(e,i){p(this,"parser"),p(this,"identifier"),this.parser=e,this.identifier=i}get name(){return j0}loadMaterial(e){const i=this.parser.json.materials[e];if(!i)return Gc&&console.log(e,this.parser.json.materials),null;if(!i.extensions||!i.extensions[j0])return Gc&&console.log(`Material ${e} does not use NEEDLE_techniques_webgl`),null;Gc&&console.log(`Material ${e} uses NEEDLE_techniques_webgl`,i);const s=i.extensions[j0].technique;if(s<0)return console.debug(`Material ${e} does not have a valid technique index`),null;const r=this.parser.json.extensions[j0];if(!r)return Gc?console.error("Missing shader data",this.parser.json.extensions):console.debug("Missing custom shader data in parser.json.extensions"),null;Gc&&console.log(r);const o=r.techniques[s];return o?new Promise(async(a,l)=>{var c,h,u;const d=await Xfe(r,o.program),m=d?.fragmentShader,f=d?.vertexShader;if(!m||!f)return l();Gc&&console.log("loadMaterial",i,d);const g={},y=o.uniforms;(f.includes("_Time")||m.includes("_Time"))&&(g._Time={value:new Ze(0,0,0,0)}),(f.includes("_SinTime")||m.includes("_SinTime"))&&(g._SinTime={value:new Ze(0,0,0,0)}),(f.includes("_CosTime")||m.includes("_CosTime"))&&(g._CosTime={value:new Ze(0,0,0,0)}),(f.includes("unity_DeltaTime")||m.includes("unity_DeltaTime"))&&(g.unity_DeltaTime={value:new Ze(0,0,0,0)});for(const A in y){const x=A;switch(x){case"_TimeParameters":const w=new Ze;g[x]={value:w};break;case"hlslcc_mtx4x4unity_MatrixV":case"hlslcc_mtx4x4unity_MatrixVP":g[x]={value:[]};break;case"_MainLightPosition":case"_MainLightColor":case"_WorldSpaceCameraPos":g[x]={value:[0,0,0,1]};break;case"unity_OrthoParams":break;case"unity_SpecCube0":g[x]={value:null};break;default:case"_ScreenParams":case"_ZBufferParams":case"_ProjectionParams":g[x]={value:[0,0,0,0]};break;case"_CameraOpaqueTexture":case"_CameraDepthTexture":g[x]={value:null};break}}let v=!1;if(i.extensions&&i.extensions[j0]){const A=i.extensions[j0];if(A.technique===s){Gc&&console.log(i.name,"Material Properties",A);for(const x in A.values){const w=A.values[x];if(typeof w=="string"){if(w.startsWith("/textures/")){const _=w.substring(10),S=Number.parseInt(_);if(S>=0){const M=await this.parser.getDependency("texture",S);M instanceof Vt&&(M.colorSpace=Bi,M.needsUpdate=!0),g[x]={value:M};continue}}switch(x){case"alphaMode":w==="BLEND"&&(v=!0);continue}}if(Array.isArray(w)&&w.length===4){g[x]={value:new Ze(w[0],w[1],w[2],w[3])};continue}g[x]={value:w}}}}const b=new Ul(this.identifier,{name:i.name??"",uniforms:g,vertexShader:f,fragmentShader:m,lights:!1});switch(b.glslVersion=W1,b.vertexShader=b.vertexShader.replace("#version 300 es",""),b.fragmentShader=b.fragmentShader.replace("#version 300 es",""),(c=g._Cull)==null?void 0:c.value){case 0:b.side=xi;break;case 1:b.side=un;break;case 2:b.side=Un;break;default:b.side=Un;break}switch((h=g._ZTest)==null?void 0:h.value){case 3:b.depthTest=!0,b.depthFunc=Ef;break;case 6:b.depthTest=!0,b.depthFunc=Qy;break;case 2:b.depthTest=!0,b.depthFunc=jy;break;case 4:b.depthTest=!0,b.depthFunc=Ap;break;case 5:b.depthTest=!0,b.depthFunc=E1;break;case 7:b.depthTest=!0,b.depthFunc=M1;break;case 8:b.depthTest=!1,b.depthFunc=C1;break}b.transparent=v,v&&(b.depthWrite=!1),Ufe(g),b.onUpdateUniforms();for(const A in y){const x=A,w=y[A].type;if(((u=g[x])==null?void 0:u.value)===void 0)switch(w){case ZQ.SAMPLER_2D:g[x]={value:Ffe},console.warn("Missing/unassigned texture, fallback to white: "+x);break;default:x==="unity_OrthoParams"||console.warn("TODO: EXPECTED UNIFORM / fallback NOT SET: "+x,y[A]);break}}Gc&&console.log(b.uuid,g),YQ(b),a(b)}):null}}function YQ(n){if(n.uniforms){Gc&&console.log("Uniforms:",n.uniforms);for(const i in n.uniforms)switch(e(i,i),i){case"_Color":e("color",i);break}}function e(i,s){Object.getOwnPropertyDescriptor(n,i)||Object.defineProperty(n,i,{get:()=>n.uniforms[s].value,set:r=>{n.uniforms[s].value=r,n.needsUpdate=!0}})}}const dbe=te("debugextensions");let IM;const pbe=Promise.resolve().then(()=>PMe).then(async n=>(IM=n.GLTFAnimationPointerExtension,IM)).catch(n=>{console.warn("Failed to import GLTFLoaderAnimationPointer. Please use @needle-tools/three for full KHR_animation support",n)}),Zm=new Array;function mbe(n){Zm.includes(n)||Zm.push(n)}function fbe(n){const e=Zm.indexOf(n);e>=0&&Zm.splice(e,1)}function JD(n){const e=new abe;return n.register(i=>(e.parser=i,e)),e}class gbe{resolvePath(e){return e.includes("/extensions/builtin_components/")?e.replace("/extensions/builtin_components/","/userData/components/"):e.includes("extensions/builtin_components/")?e.replace("extensions/builtin_components/","/userData/components/"):e}}async function qD(n,e,i){const s=i.indexOf("?");s>=0&&(i=i.substring(0,s)),n.register(r=>new lbe(r)),n.register(r=>new zme(r)),n.register(r=>new Dfe(r,e.lightmaps,i)),n.register(r=>new cbe(r,i,e)),n.register(r=>new ube(r,i)),n.register(r=>new ZD(r,i)),n.register(r=>new mi(r,i)),n.register(r=>new nbe(r)),f9()&&n.register(r=>new EB(r)),await pbe.catch(r=>{}),n.register(r=>{if(IM){const o=new IM(r);return o.setAnimationPointerResolver.bind(o)(new gbe),o}else return(dbe||Ye())&&console.error("Missing KHR_animation_pointer extension..."),{name:"KHR_animation_pointer_NOT_AVAILABLE"}});for(const r of Zm)r.onImport&&r.onImport(n,i,e)}function $D(n,e){for(const i of Zm)i.onExport&&i.onExport(n,e)}function eO(n,e,i){for(const s of Zm)s.onLoaded&&s.onLoaded(n,e,i)}const Vl=te("debuginstancing"),KQ=class{constructor(){p(this,"objs",[])}setup(n,e,i,s,r,o=0){n.applySettings(e);const a=this.tryCreateOrAddInstance(e,i,r);if(a){s===null&&(s=[]),s.push(a),mi.assignTextureLOD(a.renderer.material,0);for(const l of n.sharedMeshes){const c=l.geometry;mi.assignMeshLOD(l,0).then(h=>{h&&n.activeAndEnabled&&c!=h&&a.setGeometry(h)})}}else if(o<=0&&e.type!=="Mesh"){const l=o+1;for(const c of e.children)s=this.setup(n,c,i,s,r,l)}return o===0&&r.useMatrixWorldAutoUpdate&&s&&s.length>=0&&this.autoUpdateInstanceMatrix(e),s}tryCreateOrAddInstance(n,e,i){if(n.type==="Mesh"){const s=i.foundMeshes;if(i.foundMeshes+=1,!i.rend.enableInstancing)return null;if(i.rend.enableInstancing!==!0){if(s>=i.rend.enableInstancing.length)return Vl&&console.error("Something is wrong with instance setup",n,i.rend.enableInstancing,s),null;if(!i.rend.enableInstancing[s])return null}const r=n,o=r.material;for(const h of this.objs)if(!!h.canAdd(r.geometry,o))return h.addInstance(r);const a=16;let l=n.name;l!=null&&l.length||(l=cU());const c=new JQ(l,r.geometry,o,a,e);return this.objs.push(c),c.addInstance(r)}return null}autoUpdateInstanceMatrix(n){const e=n.matrixWorld.multiplyMatrices.bind(n.matrixWorld),i=n.matrixWorld.clone(),s=(r,o)=>{const a=e(r,o);return(n[Ub]||i.equals(a)===!1)&&(i.copy(a),n[Ub]=!0),a};n.matrixWorld.multiplyMatrices=s}};let Q0=KQ;p(Q0,"instance",new KQ);const LM=class{constructor(n,e){p(this,"object"),p(this,"renderer"),p(this,"__instanceIndex",-1),p(this,"__reservedVertexRange",0),p(this,"__reservedIndexRange",0),p(this,"meshInformation"),this.__instanceIndex=-1,this.object=n,this.renderer=e,n[x9]=e,this.meshInformation=Z0(n.geometry),LM.all.push(this)}get name(){return this.object.name}get isActive(){return this.__instanceIndex>=0}get vertexCount(){return this.object.geometry.attributes.position.count}get maxVertexCount(){return this.meshInformation.vertexCount}get reservedVertexCount(){return this.__reservedVertexRange}get indexCount(){return this.object.geometry.index?this.object.geometry.index.count:0}get maxIndexCount(){return this.meshInformation.indexCount}get reservedIndexCount(){return this.__reservedIndexRange}updateInstanceMatrix(n=!1,e=!0){this.__instanceIndex<0||(e&&this.object.updateWorldMatrix(!0,n),this.renderer.updateInstance(this.object.matrixWorld,this.__instanceIndex))}setMatrix(n){this.__instanceIndex<0||this.renderer.updateInstance(n,this.__instanceIndex)}setGeometry(n){return this.__instanceIndex<0?!1:this.vertexCount>this.__reservedVertexRange?(console.error(`Cannot update geometry, reserved vertex range is too small: ${this.__reservedVertexRange} < ${this.vertexCount} vertices for ${this.name}`),!1):this.indexCount>this.__reservedIndexRange?(console.error(`Cannot update geometry, reserved index range is too small: ${this.__reservedIndexRange} < ${this.indexCount} indices for ${this.name}`),!1):this.renderer.updateGeometry(n,this.__instanceIndex)}add(){this.__instanceIndex>=0||(this.renderer.add(this),ie.markAsInstancedRendered(this.object,!0))}remove(n){if(!(this.__instanceIndex<0)&&(this.renderer.remove(this,n),ie.markAsInstancedRendered(this.object,!1),n)){const e=LM.all.indexOf(this);e>=0&&LM.all.splice(e,1)}}};let KA=LM;p(KA,"all",[]);class JQ{constructor(e,i,s,r,o){p(this,"allowResize",!0),p(this,"name",""),p(this,"geometry"),p(this,"material"),p(this,"_context"),p(this,"_batchedMesh"),p(this,"_handles",[]),p(this,"_maxInstanceCount"),p(this,"_currentInstanceCount",0),p(this,"_currentVertexCount",0),p(this,"_currentIndexCount",0),p(this,"_maxVertexCount"),p(this,"_maxIndexCount"),p(this,"_needUpdateBounds",!1),p(this,"_debugMaterial",null),p(this,"onBeforeRender",()=>{this._batchedMesh.layers.enableAll(),this._needUpdateBounds&&this._batchedMesh[Vb]===!0&&(Vl&&console.log("Update instancing bounds",this.name,this._batchedMesh.matrixWorldNeedsUpdate),this.updateBounds())}),p(this,"onAfterRender",()=>{this._batchedMesh.layers.disableAll()}),p(this,"_availableBuckets",new Array),p(this,"_usedBuckets",new Array),this.name=e,this.geometry=i,this.material=s,this._context=o,this._maxInstanceCount=Math.max(2,r),Vl&&(this._debugMaterial=qQ());const a=this.tryEstimateVertexCountSize(this._maxInstanceCount,[i],r);this._maxVertexCount=a.vertexCount,this._maxIndexCount=a.indexCount,this._batchedMesh=new Tw(this._maxInstanceCount,this._maxVertexCount,this._maxIndexCount,this._debugMaterial??this.material),this._batchedMesh[Vb]=!0,this._batchedMesh.visible=!0,this._context.scene.add(this._batchedMesh),s instanceof Vw&&(s.defines.USE_INSTANCING=!0,s.needsUpdate=!0),o.pre_render_callbacks.push(this.onBeforeRender),o.post_render_callbacks.push(this.onAfterRender),Vl&&console.log(`Instanced renderer created with ${this._maxInstanceCount} instances, ${this._maxVertexCount} max vertices and ${this._maxIndexCount} max indices for "${e}"`)}get batchedMesh(){return this._batchedMesh}get visible(){return this._batchedMesh.visible}set visible(e){this._batchedMesh.visible=e}get castShadow(){return this._batchedMesh.castShadow}set castShadow(e){this._batchedMesh.castShadow=e}set receiveShadow(e){this._batchedMesh.receiveShadow=e}get count(){return this._currentInstanceCount}updateBounds(e=!0,i=!0){this._needUpdateBounds=!1,e&&this._batchedMesh.computeBoundingBox(),i&&this._batchedMesh.computeBoundingSphere()}canAdd(e,i){return this._maxVertexCount>1e7||i!==this.material||!this.validateGeometry(e)?!1:!!(!this.mustGrow(e)||this.allowResize)}dispose(){Vl&&console.warn("Dispose instanced renderer",this.name),this._context.scene.remove(this._batchedMesh),this._batchedMesh.dispose(),this._batchedMesh=null,this._handles=[]}addInstance(e){const i=new KA(e,this);e.castShadow===!0&&this._batchedMesh.castShadow===!1&&(this._batchedMesh.castShadow=!0),e.receiveShadow===!0&&this._batchedMesh.receiveShadow===!1&&(this._batchedMesh.receiveShadow=!0);try{this.add(i)}catch(s){return console.error(`Failed adding mesh to instancing
`,s),Ye()&&R_("Failed instancing mesh. See the browser console for details."),null}return i}add(e){const i=e.object.geometry;if(this.mustGrow(i))if(this.allowResize)this.grow(i);else return console.error("Cannot add instance, max count reached",this.name,this.count,this._maxInstanceCount),!1;return e.object.updateWorldMatrix(!0,!0),this.addGeometry(e),this._handles[e.__instanceIndex]=e,this._currentInstanceCount+=1,this.markNeedsUpdate(),this._currentInstanceCount>0&&(this._batchedMesh.visible=!0),!0}remove(e,i){e&&(e.__instanceIndex<0||this._handles[e.__instanceIndex]!=e||this._currentInstanceCount<=0||(this.removeGeometry(e,i),this._handles[e.__instanceIndex]=null,e.__instanceIndex=-1,this._currentInstanceCount>0&&(this._currentInstanceCount-=1),this._currentInstanceCount<=0&&(this._batchedMesh.visible=!1),this.markNeedsUpdate()))}updateInstance(e,i){this._batchedMesh.setMatrixAt(i,e),this.markNeedsUpdate()}updateGeometry(e,i){return this.validateGeometry(e)?(this.mustGrow()&&this.grow(e),Vl&&console.debug("UPDATE MESH",i,e.name,Z0(e),e.attributes.position.count,e.index?e.index.count:0),this._batchedMesh.setGeometryAt(i,e),this.markNeedsUpdate(),!0):!1}validateGeometry(e){const i=this.geometry;for(const s in i.attributes)if(s!=="batchId"&&!e.hasAttribute(s))return Ye()&&console.warn(`BatchedMesh: Added geometry missing "${s}". All geometries must have consistent attributes.`),!1;return!0}markNeedsUpdate(){Vl&&console.warn("Marking instanced mesh dirty",this.name),this._needUpdateBounds=!0}mustGrow(e){if(this.count>=this._maxInstanceCount)return!0;if(!e)return!1;const i=Z0(e),s=i.vertexCount,r=i.indexCount;return this._currentVertexCount+s>this._maxVertexCount||this._currentIndexCount+r>this._maxIndexCount}grow(e){const i=this._maxInstanceCount*2,s=this.tryEstimateVertexCountSize(i,[e]),r=Math.max(this._maxVertexCount,s.vertexCount),o=Math.max(this._maxIndexCount,s.indexCount,this._maxVertexCount*2);if(Vl){const l=Z0(e);console.warn(`Growing batched mesh for "${this.name}/${e.name}" ${l.vertexCount} vertices, ${l.indexCount} indices
Max count ${this._maxInstanceCount} \u2192 ${i}
Max vertex count ${this._maxVertexCount} -> ${r}
Max index count ${this._maxIndexCount} -> ${o}`),this._debugMaterial=qQ()}this._maxVertexCount=r,this._maxIndexCount=o;const a=new Tw(i,this._maxVertexCount,this._maxIndexCount,this._debugMaterial??this.material);a.layers=this._batchedMesh.layers,a.castShadow=this._batchedMesh.castShadow,a.receiveShadow=this._batchedMesh.receiveShadow,a.visible=this._batchedMesh.visible,a[Vb]=this._batchedMesh[Vb],a.matrixAutoUpdate=this._batchedMesh.matrixAutoUpdate,a.matrixWorldNeedsUpdate=this._batchedMesh.matrixWorldNeedsUpdate,a.matrixAutoUpdate=this._batchedMesh.matrixAutoUpdate,a.matrixWorld.copy(this._batchedMesh.matrixWorld),a.matrix.copy(this._batchedMesh.matrix),this._batchedMesh.dispose(),this._batchedMesh.removeFromParent(),this._batchedMesh=a,this._maxInstanceCount=i,this._usedBuckets.length=0,this._availableBuckets.length=0;for(const l of this._handles)l&&l.__instanceIndex>=0&&this.addGeometry(l);this._context.scene.add(a)}tryEstimateVertexCountSize(e,i,s=1){const r=new Map;for(const h of this._handles)if(h&&h.__instanceIndex>=0)if(r.has(h.object.geometry)){const u=r.get(h.object.geometry);u.count+=1}else{const u={count:1,...Z0(h.object.geometry)};r.set(h.object.geometry,u)}let o=0,a=0;for(const[h,u]of r)o+=u.vertexCount*u.count,a+=u.indexCount*u.count;let l=Math.ceil(o/Math.max(1,this._currentInstanceCount))*e,c=Math.ceil(a/Math.max(1,this._currentInstanceCount))*e*2;if(i)for(const h of i){const u=Z0(h);l+=u.vertexCount*s,c+=u.indexCount*s}return{vertexCount:l,indexCount:c}}addGeometry(e){let i=null,s=-1;for(let a=this._availableBuckets.length-1;a>=0;a--){const l=this._availableBuckets[a];l.vertexCount>=e.maxVertexCount&&l.indexCount>=e.maxIndexCount&&(i==null||l.vertexCount<i.vertexCount)&&(i=l,s=a)}if(i!=null){const a=i;Vl&&console.debug(`RE-USE SPACE #${a.index}, ${e.maxVertexCount} vertices, ${e.maxIndexCount} indices, ${e.name}`),this._batchedMesh.setGeometryAt(a.index,e.object.geometry),this._batchedMesh.setMatrixAt(a.index,e.object.matrixWorld),this._batchedMesh.setVisibleAt(a.index,!0),e.__instanceIndex=a.index,this._usedBuckets[a.index]=a,this._availableBuckets.splice(s,1);return}const r=e.object.geometry;Vl&&console.debug("ADD GEOMETRY",r.name,`
vertex:`,`${this._currentVertexCount} + ${e.maxVertexCount} < ${this._maxVertexCount}?`,`
index:`,e.maxIndexCount,this._currentIndexCount,this._maxIndexCount);const o=this._batchedMesh.addGeometry(r,e.maxVertexCount,e.maxIndexCount);e.__instanceIndex=o,e.__reservedVertexRange=e.maxVertexCount,e.__reservedIndexRange=e.maxIndexCount,this._currentVertexCount+=e.maxVertexCount,this._currentIndexCount+=e.maxIndexCount,this._usedBuckets[o]={index:o,vertexCount:e.maxVertexCount,indexCount:e.maxIndexCount},this._batchedMesh.setMatrixAt(o,e.object.matrixWorld),Vl&&console.debug(`ADD MESH & RESERVE SPACE #${o}, ${e.maxVertexCount} vertices, ${e.maxIndexCount} indices, ${e.name} ${e.object.uuid}`)}removeGeometry(e,i){e.__instanceIndex<0||(this._usedBuckets.splice(e.__instanceIndex,1),this._batchedMesh.setVisibleAt(e.__instanceIndex,!1),this._availableBuckets.push({index:e.__instanceIndex,vertexCount:e.reservedVertexCount,indexCount:e.reservedIndexCount}))}}p(JQ,"nullMatrix",new he);function Z0(n){let e=n.attributes.position.count,i=n.index?n.index.count:0;const s=mi.getMeshLODInformation(n);if(s){const r=s.lods[0];let o=r.vertexCount,a=r.indexCount;const l=Math.min(128,Math.ceil(o*.15));o+=l,a+=20,e=Math.max(e,o),i=Math.max(i,a)}return e=Math.ceil(e),i=Math.ceil(i),{vertexCount:e,indexCount:i}}function qQ(){const n=new vs({color:new Ae(Math.random(),Math.random(),Math.random())});return n.emissive=n.color,n.emissiveIntensity=.3,te("wireframe")&&(n.wireframe=!0),n}const Y0=te("debuglightmaps");class JA{constructor(e,i){p(this,"lightmapIndex",-1),p(this,"lightmapScaleOffset",new Ze(1,1,0,0)),p(this,"context"),p(this,"gameObject"),p(this,"lightmapTexture",null),p(this,"lightmapScaleOffsetUniform",{value:new Ze(1,1,0,0)}),p(this,"lightmapUniform",{value:null}),p(this,"onBeforeCompile",(s,r)=>{Y0&&console.log(`Lightmaps, before compile
`,s),this.lightmapScaleOffsetUniform.value=this.lightmapScaleOffset,this.lightmapUniform.value=this.lightmapTexture,s.uniforms.lightmapScaleOffset=this.lightmapScaleOffsetUniform}),this.gameObject=e,this.context=i}get lightmap(){return this.lightmapTexture}set lightmap(e){e!==this.lightmapTexture&&(this.lightmapTexture=e,this.applyLightmap(),this.lightmapTexture&&mi.assignTextureLOD(this.lightmapTexture,0).then(i=>{i!=null&&i.isTexture&&(this.lightmapTexture=i)}))}init(e,i,s){console.assert(this.gameObject!==void 0&&this.gameObject!==null,"Missing gameobject",this),this.lightmapIndex=e,!(this.lightmapIndex<0)&&(this.lightmapScaleOffset=i,this.lightmapTexture=s,mi.assignTextureLOD(s,0).then(r=>{r!=null&&r.isTexture&&(this.lightmapTexture=r)}),Y0=="show"?(console.log("Lightmap:",this.gameObject.name,e,`
ScaleOffset:`,i,`
Texture:`,s),this.setLightmapDebugMaterial()):Y0&&console.log("Use debuglightmaps=show to render lightmaps only in the scene."),this.applyLightmap())}updateLightmapUniforms(e){const i=e.uniforms;i&&i.lightmap&&(this.lightmapScaleOffsetUniform.value=this.lightmapScaleOffset,i.lightmapScaleOffset=this.lightmapScaleOffsetUniform)}applyLightmap(){if(this.gameObject.type==="Object3D"){Y0&&console.warn("Can not add lightmap. Is this object missing a renderer?",this.gameObject.name);return}if(this.gameObject.type==="Group"){this.gameObject["Needle:Multimaterial-LightmapWarning"]===void 0&&(this.gameObject["Needle:Multimaterial-LightmapWarning"]=!0,console.warn("Lightmap on multimaterial object is not supported yet... please open a feature request on https://github.com/needle-tools/needle-engine-support if your project requires it"));return}console.assert(this.gameObject.type==="Mesh","Lightmap only works on meshes",this);const e=this.gameObject;if(e.geometry.getAttribute("uv1")||e.geometry.setAttribute("uv1",e.geometry.getAttribute("uv")),Array.isArray(this.gameObject.material)){const i=this.gameObject.material;for(let s=0;s<i.length;s++)i[s]=this.ensureLightmapMaterial(i[s])}else this.gameObject.material=this.ensureLightmapMaterial(this.gameObject.material);if(this.lightmapIndex>=0&&this.lightmapTexture){this.lightmapTexture.channel=1;const i=this.gameObject.material;if(Array.isArray(i))for(const s of i)this.assignLightmapTexture(s);else i&&this.assignLightmapTexture(i)}}ensureLightmapMaterial(e){return e.userData||(e.userData={}),e["NEEDLE:lightmap-material-version"]!=e.version&&e["NEEDLE:lightmap-material-version"]==null&&(Y0&&console.warn("Cloning material for lightmap "+e.name),e=e.clone(),e.onBeforeCompile=this.onBeforeCompile),e}assignLightmapTexture(e){!e||e instanceof Ro&&e.transmission>0||!(e.lightMap!==this.lightmapTexture||e["NEEDLE:lightmap-material-version"]!==e.version)||(Y0&&console.log("Assigning lightmap",e.name,e.version),e.lightMap=this.lightmapTexture,e["NEEDLE:lightmap-material-version"]=e.version)}setLightmapDebugMaterial(){this.gameObject.material=new kt({vertexShader:`
                varying vec2 vUv1;
                void main()
                {
                    vUv1 = uv1;
                    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
                }
                `,fragmentShader:`
                uniform sampler2D lightMap;
                uniform float lightMapIntensity;
                uniform vec4 lightmapScaleOffset;
                varying vec2 vUv1;

                // took from threejs 05fc79cd52b79e8c3e8dec1e7dca72c5c39983a4
                vec4 conv_sRGBToLinear( in vec4 value ) {
                    return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
                }

                void main() {
                    vec2 lUv = vUv1.xy * lightmapScaleOffset.xy + vec2(lightmapScaleOffset.z, (1. - (lightmapScaleOffset.y + lightmapScaleOffset.w)));
                    
                    vec4 lightMapTexel = texture2D( lightMap, lUv);
                    gl_FragColor = lightMapTexel;
                    gl_FragColor.a = 1.;
                }
                `,defines:{USE_LIGHTMAP:""}})}}var ybe=Object.defineProperty,vbe=Object.getOwnPropertyDescriptor,su=(n,e,i,s)=>{for(var r=s>1?void 0:s?vbe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&ybe(e,i,r),r};const qA=te("debugrenderer"),$Q=te("debugskinnedmesh"),eZ=te("noinstancing"),bbe=te("wireframe");class tO{constructor(){p(this,"path",null),p(this,"asset",null),p(this,"default")}}class Abe{constructor(e,i){p(this,"_renderer"),p(this,"_targets",[]),p(this,"_indexMapMaxIndex"),p(this,"_indexMap"),p(this,"_changed",!1),this._renderer=e;const s=this.setMaterial.bind(this),r=this.getMaterial.bind(this),o=e.gameObject;if(this._targets=[],o)switch(o.type){case"Group":this._targets=[...o.children];break;case"SkinnedMesh":case"Mesh":this._targets.push(o);break}let a=!1,l,c=0;for(let h=0;h<this._targets.length;h++){const u=this._targets[h];if(!u)continue;const d=u.material;if(d){d.shadowSide=d.side;for(let m=0;m<i.length;m++){const f=i[m];if(!f){a=!0;continue}if(d.name===f.name){l===void 0&&(l=new Map),l.set(m,h),c=Math.max(c,m);break}}}}if(a){this._indexMapMaxIndex=c,this._indexMap=l;const h=`Renderer ${e.name} was initialized with missing materials - this may lead to unexpected behaviour when trying to access sharedMaterials by index.`;console.warn(h),no()&&zi("Found renderer with missing materials: please check the console for details.")}return new Proxy(this,{get(h,u){if(typeof u=="string"){const d=parseInt(u);if(!isNaN(d))return r(d)}return h[u]},set(h,u,d){return typeof u=="string"&&s(d,Number.parseInt(u)),Reflect.set(h,u,d)?(d instanceof Ft&&(h.changed=!0),!0):!1}})}get changed(){return this._changed}set changed(e){e===!0&&qA&&console.warn("SharedMaterials have changed: "+this._renderer.name,this),this._changed=e}is(e){return this._renderer===e}get length(){return this._indexMapMaxIndex!==void 0?this._indexMapMaxIndex+1:this._targets.length}*[Symbol.iterator](){for(let e=0;e<this.length;e++)yield this.getMaterial(e)}resolveIndex(e){const i=this._indexMap;return i&&i.has(e)?i.get(e):e}setMaterial(e,i){if(i=this.resolveIndex(i),i<0||i>=this._targets.length)return;const s=this._targets[i];!s||s.material===void 0||(s.material=e,this.changed=!0)}getMaterial(e){if(e=this.resolveIndex(e),e<0)return null;const i=this._targets;if(e>=i.length)return null;const s=i[e];return s?s.material:null}}const PM=class extends Pe{constructor(){super(...arguments),p(this,"receiveShadows",!1),p(this,"shadowCastingMode",0),p(this,"lightmapIndex",-1),p(this,"lightmapScaleOffset",new Ze(1,1,0,0)),p(this,"enableInstancing"),p(this,"renderOrder"),p(this,"allowOcclusionWhenDynamic",!0),p(this,"probeAnchor"),p(this,"reflectionProbeUsage",0),p(this,"_lightmaps"),p(this,"_sharedMeshes",[]),p(this,"_sharedMaterials"),p(this,"_originalMaterials"),p(this,"_probeAnchorLastFrame"),p(this,"_lightmapTextureOverride"),p(this,"allowProgressiveLoading",!0),p(this,"_firstFrame",-1),p(this,"_isInstancingEnabled",!1),p(this,"_handles"),p(this,"_handlesTempArray",[]),p(this,"onBeforeRenderThree",(n,e,i,s,r,o)=>{var a;if(r.envMapIntensity!==void 0){const l=this.hasLightmap?Math.PI:1,c=((a=this.context.mainCameraComponent)==null?void 0:a.environmentIntensity)??1;r.envMapIntensity=Math.max(0,c*this.context.sceneLighting.environmentIntensity/l)}if(this._lightmaps)for(const l of this._lightmaps)l.updateLightmapUniforms(r),l.applyLightmap()}),p(this,"_reflectionProbe",null)}static setInstanced(n,e){const i=Kb(n,PM);return i.setInstancingEnabled(e),i}static isInstanced(n){const e=Mm(n,PM);return e?e.isInstancingActive:hl.isUsingInstancing(n)}static setVisible(n,e){md(n,e)}get sharedMesh(){if(this.gameObject.type==="Mesh")return this.gameObject;if(this.gameObject.type==="SkinnesMesh")return this.gameObject;if(this.gameObject.type==="Group")return this.gameObject.children[0]}get sharedMeshes(){if(this.destroyed||!this.gameObject)return this._sharedMeshes;if(this._sharedMeshes.length=0,this.gameObject.type==="Group")for(const n of this.gameObject.children)(n.type==="Mesh"||n.type==="SkinnedMesh")&&this._sharedMeshes.push(n);else(this.gameObject.type==="Mesh"||this.gameObject.type==="SkinnedMesh")&&this._sharedMeshes.push(this.gameObject);return this._sharedMeshes}get sharedMaterial(){return this.sharedMaterials[0]}set sharedMaterial(n){this.sharedMaterials[0]!==n&&(this.sharedMaterials[0]=n,this.applyLightmapping())}get material(){return this.sharedMaterials[0]}set material(n){this.sharedMaterial=n}set sharedMaterials(n){if(!this._originalMaterials)this._originalMaterials=n;else if(n){let e=!1;for(let i=0;i<this._sharedMaterials.length;i++){const s=i<n.length?n[i]:null;s&&s instanceof Ft?this.sharedMaterials[i]=s:e||(e=!0,console.warn("Can not assign null as material: "+this.name,s))}}}get sharedMaterials(){return(!this._sharedMaterials||!this._sharedMaterials.is(this))&&(this._originalMaterials||(this._originalMaterials=[]),this._sharedMaterials=new Abe(this,this._originalMaterials)),this._sharedMaterials}static get shouldSuppressInstancing(){return eZ}get lightmap(){var n;return(n=this._lightmaps)!=null&&n.length?this._lightmaps[0].lightmap:null}set lightmap(n){var e;if(this._lightmapTextureOverride=n,n===void 0&&(n=this.context.lightmaps.tryGetLightmap(this.sourceId,this.lightmapIndex)),(e=this._lightmaps)!=null&&e.length)for(const i of this._lightmaps)i.lightmap=n}get hasLightmap(){return this.lightmap!=null}registering(){this.enabled||this.setVisibility(!1)}awake(){if(this._firstFrame=this.context.time.frame,qA&&console.log("Renderer ",this.name,this),this.clearInstancingState(),this.probeAnchor&&qA&&this.probeAnchor.add(new io(.2)),this._reflectionProbe=null,this.isMultiMaterialObject(this.gameObject)){for(const n of this.gameObject.children)this.context.addBeforeRenderListener(n,this.onBeforeRenderThree),n.layers.mask=this.gameObject.layers.mask;if(this.renderOrder!==void 0){let n=0;for(let e=0;e<this.gameObject.children.length;e++){const i=this.gameObject.children[e];if(!(!this.isMeshOrSkinnedMesh(i)||ie.getComponent(i,PM))){if(this.renderOrder.length<=n){console.warn("Incorrect renderOrder element count",this,this.renderOrder.length+" but expected "+this.gameObject.children.length,"Index: "+n,"ChildElement:",i);continue}i.renderOrder=this.renderOrder[n],n+=1}}}}else this.isMeshOrSkinnedMesh(this.gameObject)?(this.context.addBeforeRenderListener(this.gameObject,this.onBeforeRenderThree),this.renderOrder!==void 0&&this.renderOrder.length>0&&(this.gameObject.renderOrder=this.renderOrder[0])):this.context.addBeforeRenderListener(this.gameObject,this.onBeforeRenderThree);if(this.applyLightmapping(),bbe)for(let n=0;n<this.sharedMaterials.length;n++){const e=this.sharedMaterials[n];e&&(e.wireframe=!0)}}applyLightmapping(){var n;if(this.lightmapIndex>=0){const e=this.gameObject.type,i=this._lightmapTextureOverride!==void 0?this._lightmapTextureOverride:this.context.lightmaps.tryGetLightmap(this.sourceId,this.lightmapIndex);if(i){if(this._lightmaps||(this._lightmaps=[]),e==="Mesh"){const s=this.gameObject.material;if(s!=null&&s.isMeshBasicMaterial)s&&console.warn("Lightmapping is not supported on MeshBasicMaterial",s.name);else{if(this._lightmaps.length<=0){const r=new JA(this.gameObject,this.context);this._lightmaps.push(r)}this._lightmaps[0].init(this.lightmapIndex,this.lightmapScaleOffset,i)}}else if(this.isMultiMaterialObject(this.gameObject)&&this.sharedMaterials.length>0)for(let s=0;s<this.gameObject.children.length;s++){const r=this.gameObject.children[s];if(!((n=r.material)!=null&&n.isMeshBasicMaterial)){let o;s>=this._lightmaps.length?(o=new JA(r,this.context),this._lightmaps.push(o)):o=this._lightmaps[s],o.init(this.lightmapIndex,this.lightmapScaleOffset,i)}}}else qA&&console.warn("Lightmap not found",this.sourceId,this.lightmapIndex)}}get isInstancingActive(){return this._handles!=null&&this._handles.length>0&&this._isInstancingEnabled}get instances(){if(!this._handles||this._handles.length<=0)return null;if(this._handlesTempArray.length=0,this._handles)for(const n of this._handles)this._handlesTempArray.push(n);return this._handlesTempArray}setInstancingEnabled(n){if(this._isInstancingEnabled===n)return n&&(this._handles===void 0||this._handles!=null&&this._handles.length>0);if(this._isInstancingEnabled=n,n){if(this.enableInstancing===void 0&&(this.enableInstancing=!0),this._handles===void 0){if(this._handles=Q0.instance.setup(this,this.gameObject,this.context,null,{rend:this,foundMeshes:0,useMatrixWorldAutoUpdate:this.useInstanceMatrixWorldAutoUpdate()}),this._handles)return ie.markAsInstancedRendered(this.gameObject,!0),!0}else if(this._handles!==null){for(const e of this._handles)e.updateInstanceMatrix(!0),e.add();return ie.markAsInstancedRendered(this.gameObject,!0),!0}}else{if(this._handles)for(const e of this._handles)e.remove(this.destroyed);return!0}return!1}clearInstancingState(){this._isInstancingEnabled=!1,this._handles=void 0}useInstanceMatrixWorldAutoUpdate(){return!0}start(){if(this.enableInstancing&&!eZ&&(this.setInstancingEnabled(!0),hl.markDirty(this.gameObject)),this.gameObject.frustumCulled=this.allowOcclusionWhenDynamic,this.isMultiMaterialObject(this.gameObject))for(let n=0;n<this.gameObject.children.length;n++){const e=this.gameObject.children[n];e.frustumCulled=this.allowOcclusionWhenDynamic}}onEnable(){this.sharedMeshes,this.setVisibility(!0),this._isInstancingEnabled||this.enableInstancing==!0||Array.isArray(this.enableInstancing)&&this.enableInstancing.some(n=>n)?this.__internalDidAwakeAndStart&&this.setInstancingEnabled(!0):this.enabled&&this.applyStencil(),this.updateReflectionProbe()}onDisable(){this.setVisibility(!1),this._handles&&this._handles.length>0&&this.setInstancingEnabled(!1)}onDestroy(){if(this._handles=null,this.isMultiMaterialObject(this.gameObject))for(const n of this.gameObject.children)this.context.removeBeforeRenderListener(n,this.onBeforeRenderThree);else this.context.removeBeforeRenderListener(this.gameObject,this.onBeforeRenderThree)}onBeforeRender(){var n,e,i;if(this.gameObject){if(this._probeAnchorLastFrame!==this.probeAnchor&&((n=this._reflectionProbe)==null||n.onUnset(this),this.updateReflectionProbe()),qA==this.name&&this.gameObject instanceof pe){this.gameObject.geometry.computeBoundingSphere();const s=mt(this.gameObject.geometry.boundingSphere.center).applyMatrix4(this.gameObject.matrixWorld);ft.DrawWireSphere(s,this.gameObject.geometry.boundingSphere.radius,56831)}if(this.isMultiMaterialObject(this.gameObject)&&((e=this.gameObject.children)==null?void 0:e.length)>0)for(const s of this.gameObject.children)this.applySettings(s);else this.applySettings(this.gameObject);if(this.sharedMaterials.changed&&(this.sharedMaterials.changed=!1,this.applyLightmapping()),(i=this._handles)!=null&&i.length&&this.gameObject[Ub]===!0){this.gameObject[Ub]=!1;for(let s=this._handles.length-1;s>=0;s--)this._handles[s].updateInstanceMatrix();this.gameObject.matrixWorldNeedsUpdate=!1}if(this._handles&&this._handles.length<=0&&ie.markAsInstancedRendered(this.gameObject,!1),this._isInstancingEnabled&&this._handles)for(let s=0;s<this._handles.length;s++){const r=this._handles[s];md(r.object,!1)}this.reflectionProbeUsage!==0&&this._reflectionProbe&&this._reflectionProbe.onSet(this)}}onAfterRender(){if(this._isInstancingEnabled&&this._handles)for(let n=0;n<this._handles.length;n++){const e=this._handles[n];md(e.object,!0)}this.reflectionProbeUsage!==0&&this._reflectionProbe&&this._reflectionProbe.onUnset(this),this.static&&this.gameObject.matrixAutoUpdate&&(this.gameObject.matrixAutoUpdate=!1)}applyStencil(){ZD.applyStencil(this)}applySettings(n){n.receiveShadow=this.receiveShadows,this.shadowCastingMode==1?n.castShadow=!0:n.castShadow=!1}updateReflectionProbe(){this._reflectionProbe=null,this.reflectionProbeUsage!==0&&(this.startCoroutine(this._updateReflectionProbe(),Yi.LateUpdate),this._probeAnchorLastFrame=this.probeAnchor)}*_updateReflectionProbe(){const n=this.probeAnchor||this.gameObject,e=!!this.probeAnchor;this._reflectionProbe=W0.get(n,this.context,e,this.probeAnchor)}setVisibility(n){if(!this.isMultiMaterialObject(this.gameObject))md(this.gameObject,n);else for(const e of this.gameObject.children)this.isMeshOrSkinnedMesh(e)&&md(e,n)}isMultiMaterialObject(n){return n.type==="Group"}isMeshOrSkinnedMesh(n){return n.type==="Mesh"||n.type==="SkinnedMesh"}};let kn=PM;su([T()],kn.prototype,"receiveShadows",2),su([T()],kn.prototype,"shadowCastingMode",2),su([T()],kn.prototype,"lightmapIndex",2),su([T(Ze)],kn.prototype,"lightmapScaleOffset",2),su([T()],kn.prototype,"enableInstancing",2),su([T()],kn.prototype,"renderOrder",2),su([T()],kn.prototype,"allowOcclusionWhenDynamic",2),su([T(ye)],kn.prototype,"probeAnchor",2),su([T()],kn.prototype,"reflectionProbeUsage",2);class $A extends kn{}class iO extends $A{constructor(){super(...arguments),p(this,"_needUpdateBoundingSphere",!1)}awake(){var e;super.awake(),$Q&&console.log('SkinnedMeshRenderer for "'+this.name+'"',this),this.allowOcclusionWhenDynamic=!1;for(const i of this.sharedMeshes)(e=i.parent)==null||e.updateWorldMatrix(!1,!0),this.markBoundsDirty()}onAfterRender(){if(super.onAfterRender(),this._needUpdateBoundingSphere){for(const e of this.sharedMeshes)if(e instanceof Eo){this._needUpdateBoundingSphere=!1;const i=e.geometry,s=xb(e);s&&(e.geometry=s),e.computeBoundingSphere(),e.geometry=i}}if($Q){for(const e of this.sharedMeshes)if(e instanceof Eo&&e.boundingSphere){const i=mt(e.boundingSphere.center).applyMatrix4(e.matrixWorld);ft.DrawWireSphere(i,e.boundingSphere.radius,"red")}}}markBoundsDirty(){this._needUpdateBoundingSphere=!0}}var xbe=Object.defineProperty,wbe=Object.getOwnPropertyDescriptor,se=(n,e,i,s)=>{for(var r=s>1?void 0:s?wbe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&xbe(e,i,r),r};const BM=te("debugparticles");var ru=(n=>(n[n.Billboard=0]="Billboard",n[n.Stretch=1]="Stretch",n[n.HorizontalBillboard=2]="HorizontalBillboard",n[n.VerticalBillboard=3]="VerticalBillboard",n[n.Mesh=4]="Mesh",n))(ru||{});let Wd=class{constructor(){p(this,"alphaKeys",[]),p(this,"colorKeys",[])}get duration(){return 1}evaluate(n,e){let i,s=0,r=null,o=0;for(let a=0;a<this.alphaKeys.length;a++){const l=this.alphaKeys[a];(l.time<n||!i)&&(i=l,s=a)}for(let a=0;a<this.colorKeys.length;a++){const l=this.colorKeys[a];(l.time<n||!r)&&(r=l,o=a)}if(r)if(o+1<this.colorKeys.length){const a=this.colorKeys[o+1],l=tt.remap(n,r.time,a.time,0,1);e.r=tt.lerp(r.color.r,a.color.r,l),e.g=tt.lerp(r.color.g,a.color.g,l),e.b=tt.lerp(r.color.b,a.color.b,l)}else e.r=r.color.r,e.g=r.color.g,e.b=r.color.b;if(i)if(s+1<this.alphaKeys.length){const a=this.alphaKeys[s+1],l=tt.remap(n,i.time,a.time,0,1);e.alpha=tt.lerp(i.alpha,a.alpha,l)}else e.alpha=i.alpha;return e}};se([T()],Wd.prototype,"alphaKeys",2),se([T()],Wd.prototype,"colorKeys",2);var ex=(n=>(n[n.Local=0]="Local",n[n.World=1]="World",n[n.Custom=2]="Custom",n))(ex||{}),kM=(n=>(n[n.Sphere=0]="Sphere",n[n.SphereShell=1]="SphereShell",n[n.Hemisphere=2]="Hemisphere",n[n.HemisphereShell=3]="HemisphereShell",n[n.Cone=4]="Cone",n[n.Box=5]="Box",n[n.Mesh=6]="Mesh",n[n.ConeShell=7]="ConeShell",n[n.ConeVolume=8]="ConeVolume",n[n.ConeVolumeShell=9]="ConeVolumeShell",n[n.Circle=10]="Circle",n[n.CircleEdge=11]="CircleEdge",n[n.SingleSidedEdge=12]="SingleSidedEdge",n[n.MeshRenderer=13]="MeshRenderer",n[n.SkinnedMeshRenderer=14]="SkinnedMeshRenderer",n[n.BoxShell=15]="BoxShell",n[n.BoxEdge=16]="BoxEdge",n[n.Donut=17]="Donut",n[n.Rectangle=18]="Rectangle",n[n.Sprite=19]="Sprite",n[n.SpriteRenderer=20]="SpriteRenderer",n))(kM||{});const tx=class{constructor(){p(this,"mode","Constant"),p(this,"constant"),p(this,"constantMin"),p(this,"constantMax"),p(this,"curve"),p(this,"curveMin"),p(this,"curveMax"),p(this,"curveMultiplier")}static constant(n){const e=new tx;return e.setConstant(n),e}static betweenTwoConstants(n,e){const i=new tx;return i.setMinMaxConstant(n,e),i}static curve(n,e=1){const i=new tx;return i.setCurve(n,e),i}setConstant(n){this.mode=0,this.constant=n}setMinMaxConstant(n,e){this.mode=3,this.constantMin=n,this.constantMax=e}setCurve(n,e=1){this.mode=1,this.curve=n,this.curveMultiplier=e}clone(){var n,e,i;const s=new tx;return s.mode=this.mode,s.constant=this.constant,s.constantMin=this.constantMin,s.constantMax=this.constantMax,s.curve=(n=this.curve)==null?void 0:n.clone(),s.curveMin=(e=this.curveMin)==null?void 0:e.clone(),s.curveMax=(i=this.curveMax)==null?void 0:i.clone(),s.curveMultiplier=this.curveMultiplier,s}evaluate(n,e){const i=e===void 0?Math.random():e;switch(this.mode){case 0:case"Constant":return this.constant;case 1:case"Curve":return n=tt.clamp01(n),this.curve.evaluate(n)*this.curveMultiplier;case 2:case"TwoCurves":const s=n*this.curveMin.duration,r=n*this.curveMax.duration;return tt.lerp(this.curveMin.evaluate(s),this.curveMax.evaluate(r),i%1)*this.curveMultiplier;case 3:case"TwoConstants":return tt.lerp(this.constantMin,this.constantMax,i%1);default:this.curveMax.evaluate(n)*this.curveMultiplier;break}return 0}getMax(){switch(this.mode){case 0:case"Constant":return this.constant;case 1:case"Curve":return this.getMaxFromCurve(this.curve)*this.curveMultiplier;case 2:case"TwoCurves":return Math.max(this.getMaxFromCurve(this.curveMin),this.getMaxFromCurve(this.curveMax))*this.curveMultiplier;case 3:case"TwoConstants":return Math.max(this.constantMin,this.constantMax);default:return 0}}getMaxFromCurve(n){if(!n)return 0;let e=Number.MIN_VALUE;for(let i=0;i<n.keys.length;i++){const s=n.keys[i];s.value>e&&(e=s.value)}return e}};let gt=tx;se([T()],gt.prototype,"mode",2),se([T()],gt.prototype,"constant",2),se([T()],gt.prototype,"constantMin",2),se([T()],gt.prototype,"constantMax",2),se([T(km)],gt.prototype,"curve",2),se([T(km)],gt.prototype,"curveMin",2),se([T(km)],gt.prototype,"curveMax",2),se([T()],gt.prototype,"curveMultiplier",2);var DM;const pa=(DM=class{constructor(){p(this,"mode",0),p(this,"color"),p(this,"colorMin"),p(this,"colorMax"),p(this,"gradient"),p(this,"gradientMin"),p(this,"gradientMax")}static constant(n){const e=new pa;return e.constant(n),e}static betweenTwoColors(n,e){const i=new pa;return i.betweenTwoColors(n,e),i}constant(n){return this.mode=0,this.color=n,this}betweenTwoColors(n,e){return this.mode=2,this.colorMin=n,this.colorMax=e,this}evaluate(n,e){const i=e===void 0?Math.random():e;switch(this.mode){case 0:case"Color":return this.color;case 1:case"Gradient":return this.gradient.evaluate(n,pa._temp),pa._temp;case 2:case"TwoColors":return pa._temp.lerpColors(this.colorMin,this.colorMax,i);case 3:case"TwoGradients":return this.gradientMin.evaluate(n,pa._temp),this.gradientMax.evaluate(n,pa._temp2),pa._temp.lerp(pa._temp2,i)}return pa._temp.set(16711935),pa._temp.alpha=1,pa._temp}},p(DM,"_temp",new Ii(0,0,0,1)),p(DM,"_temp2",new Ii(0,0,0,1)),DM);let vo=pa;se([T()],vo.prototype,"mode",2),se([T(Ii)],vo.prototype,"color",2),se([T(Ii)],vo.prototype,"colorMin",2),se([T(Ii)],vo.prototype,"colorMax",2),se([T(Wd)],vo.prototype,"gradient",2),se([T(Wd)],vo.prototype,"gradientMin",2),se([T(Wd)],vo.prototype,"gradientMax",2);var nO=(n=>(n[n.Hierarchy=0]="Hierarchy",n[n.Local=1]="Local",n[n.Shape=2]="Shape",n))(nO||{});class ur{constructor(){p(this,"cullingMode"),p(this,"duration"),p(this,"emitterVelocityMode"),p(this,"flipRotation"),p(this,"gravityModifier"),p(this,"gravityModifierMultiplier"),p(this,"loop"),p(this,"maxParticles"),p(this,"playOnAwake"),p(this,"prewarm"),p(this,"ringBufferLoopRange"),p(this,"ringBufferMode"),p(this,"scalingMode"),p(this,"simulationSpace"),p(this,"simulationSpeed"),p(this,"startColor"),p(this,"startDelay"),p(this,"startDelayMultiplier"),p(this,"startLifetime"),p(this,"startLifetimeMultiplier"),p(this,"startRotation"),p(this,"startRotationMultiplier"),p(this,"startRotation3D"),p(this,"startRotationX"),p(this,"startRotationXMultiplier"),p(this,"startRotationY"),p(this,"startRotationYMultiplier"),p(this,"startRotationZ"),p(this,"startRotationZMultiplier"),p(this,"startSize"),p(this,"startSize3D"),p(this,"startSizeMultiplier"),p(this,"startSizeX"),p(this,"startSizeXMultiplier"),p(this,"startSizeY"),p(this,"startSizeYMultiplier"),p(this,"startSizeZ"),p(this,"startSizeZMultiplier"),p(this,"startSpeed"),p(this,"startSpeedMultiplier"),p(this,"stopAction"),p(this,"useUnscaledTime")}}se([T(gt)],ur.prototype,"gravityModifier",2),se([T(vo)],ur.prototype,"startColor",2),se([T(gt)],ur.prototype,"startDelay",2),se([T(gt)],ur.prototype,"startLifetime",2),se([T(gt)],ur.prototype,"startRotation",2),se([T(gt)],ur.prototype,"startRotationX",2),se([T(gt)],ur.prototype,"startRotationY",2),se([T(gt)],ur.prototype,"startRotationZ",2),se([T(gt)],ur.prototype,"startSize",2),se([T(gt)],ur.prototype,"startSizeX",2),se([T(gt)],ur.prototype,"startSizeY",2),se([T(gt)],ur.prototype,"startSizeZ",2),se([T(gt)],ur.prototype,"startSpeed",2);class ix{constructor(){p(this,"cycleCount"),p(this,"maxCount"),p(this,"minCount"),p(this,"probability"),p(this,"repeatInterval"),p(this,"time"),p(this,"count"),p(this,"_performed",0)}reset(){this._performed=0}run(e){if(e<=this.time)return 0;let i=0;if(this.cycleCount===0||this._performed<this.cycleCount){const s=this.time+this.repeatInterval*this._performed;if(e>=s&&(this._performed+=1,Math.random()<this.probability))switch(this.count.mode){case 0:i=this.count.constant;break;case 3:i=tt.lerp(this.count.constantMin,this.count.constantMax,Math.random());break;case 1:i=this.count.curve.evaluate(Math.random());break;case 2:const r=Math.random();i=tt.lerp(this.count.curveMin.evaluate(r),this.count.curveMax.evaluate(r),Math.random());break}}return i}}class zc{constructor(){p(this,"enabled"),p(this,"bursts"),p(this,"rateOverTime"),p(this,"rateOverTimeMultiplier"),p(this,"rateOverDistance"),p(this,"rateOverDistanceMultiplier"),p(this,"system")}get burstCount(){var e;return((e=this.bursts)==null?void 0:e.length)??0}reset(){var e;(e=this.bursts)==null||e.forEach(i=>i.reset())}getBurst(){let e=0;if(this.burstCount>0)for(let i=0;i<this.burstCount;i++){const s=this.bursts[i];this.system.main.loop&&s.time>=this.system.time&&s.reset(),e+=Math.round(s.run(this.system.time))}return e}}se([T()],zc.prototype,"enabled",2),se([T()],zc.prototype,"bursts",2),se([T(gt)],zc.prototype,"rateOverTime",2),se([T()],zc.prototype,"rateOverTimeMultiplier",2),se([T(gt)],zc.prototype,"rateOverDistance",2),se([T()],zc.prototype,"rateOverDistanceMultiplier",2);class nx{constructor(){p(this,"enabled"),p(this,"color")}}se([T(vo)],nx.prototype,"color",2);class Hd{constructor(){p(this,"enabled"),p(this,"separateAxes"),p(this,"size"),p(this,"sizeMultiplier"),p(this,"x"),p(this,"xMultiplier"),p(this,"y"),p(this,"yMultiplier"),p(this,"z"),p(this,"zMultiplier"),p(this,"_time",0),p(this,"_temp",new E)}evaluate(e,i,s){if(i||(i=this._temp),!this.enabled)return i.x=i.y=i.z=1,i;if(this.separateAxes)i.x=this.x.evaluate(e,s)*this.xMultiplier,i.y=this.y.evaluate(e,s)*this.yMultiplier,i.z=this.z.evaluate(e,s)*this.zMultiplier;else{const r=this.size.evaluate(e,s)*this.sizeMultiplier;i.x=r}return i}}se([T(gt)],Hd.prototype,"size",2),se([T(gt)],Hd.prototype,"x",2),se([T(gt)],Hd.prototype,"y",2),se([T(gt)],Hd.prototype,"z",2);var OM;const sx=(OM=class{constructor(){p(this,"shapeType",5),p(this,"enabled",!0),p(this,"alignToDirection",!1),p(this,"angle",0),p(this,"arc",360),p(this,"arcSpread"),p(this,"arcSpeedMultiplier"),p(this,"arcMode"),p(this,"boxThickness"),p(this,"position"),p(this,"rotation"),p(this,"_rotation",new si),p(this,"scale"),p(this,"radius"),p(this,"radiusThickness"),p(this,"sphericalDirectionAmount"),p(this,"randomDirectionAmount"),p(this,"randomPositionAmount"),p(this,"meshShapeType"),p(this,"meshRenderer"),p(this,"_meshObj"),p(this,"_meshGeometry"),p(this,"system"),p(this,"_space"),p(this,"_worldSpaceMatrix",new he),p(this,"_worldSpaceMatrixInverse",new he),p(this,"_vector",new E(0,0,0)),p(this,"_temp",new E(0,0,0)),p(this,"_triangle",new Ks),p(this,"_dir",new E),p(this,"_loopTime",0),p(this,"_loopDirection",1),BM&&console.log(this)}get type(){return kM[this.shapeType]}initialize(n){this.onInitialize(n),n.position.copy(this._vector)}toJSON(){return this}clone(){return new sx}setMesh(n){this.meshRenderer=n,n?(this._meshObj=n.sharedMeshes[Math.floor(Math.random()*n.sharedMeshes.length)],this._meshGeometry=this._meshObj.geometry):(this._meshObj=void 0,this._meshGeometry=void 0)}update(n,e,i,s){this.system=n,this._space=i,i===1&&(this._worldSpaceMatrix.copy(s.matrixWorld),this._worldSpaceMatrix.elements[0]=1,this._worldSpaceMatrix.elements[5]=1,this._worldSpaceMatrix.elements[10]=1,this._worldSpaceMatrixInverse.copy(this._worldSpaceMatrix).invert())}applyRotation(n){const e=this.rotation.x!==0||this.rotation.y!==0||this.rotation.z!==0;return e&&(this._rotation.x=tt.toRadians(this.rotation.x),this._rotation.y=tt.toRadians(this.rotation.y),this._rotation.z=tt.toRadians(this.rotation.z),this._rotation.order="ZYX",n.applyEuler(this._rotation)),e}onInitialize(n){this._vector.set(0,0,0),n.mesh=void 0,n.mesh_geometry=void 0;const e=this._temp.copy(this.position),i=this._space===1;i&&e.applyQuaternion(this.system.worldQuaternion);let s=this.radius;if(i&&(s*=this.system.worldScale.x),this.enabled){switch(this.shapeType){case 5:BM&&ft.DrawWireBox(this.position,this.scale,14540253,1),this._vector.x=Math.random()*this.scale.x-this.scale.x/2,this._vector.y=Math.random()*this.scale.y-this.scale.y/2,this._vector.z=Math.random()*this.scale.z-this.scale.z/2,this._vector.add(e);break;case 4:this.randomConePoint(this.position,this.angle,s,this.radiusThickness,this.arc,this.arcMode,this._vector);break;case 0:this.randomSpherePoint(this.position,s,this.radiusThickness,this.arc,this._vector);break;case 10:this.randomCirclePoint(this.position,s,this.radiusThickness,this.arc,this._vector);break;case 13:const r=this.meshRenderer;r?.destroyed==!1&&this.setMesh(r);const o=n.mesh=this._meshObj,a=n.mesh_geometry=this._meshGeometry;if(o&&a)switch(this.meshShapeType){case 0:{const l=a.getAttribute("position"),c=Math.floor(Math.random()*l.count);this._vector.fromBufferAttribute(l,c),this._vector.applyMatrix4(o.matrixWorld),n.mesh_normal=c}break;case 1:break;case 2:{const l=a.index;if(l){let c=Math.random(),h=Math.random();c+h>1&&(c=1-c,h=1-h);const u=Math.floor(Math.random()*(l.count/3));let d=u*3,m=u*3+1,f=u*3+2;d=l.getX(d),m=l.getX(m),f=l.getX(f);const g=a.getAttribute("position");this._triangle.a.fromBufferAttribute(g,d),this._triangle.b.fromBufferAttribute(g,m),this._triangle.c.fromBufferAttribute(g,f),this._vector.set(0,0,0).addScaledVector(this._triangle.a,c).addScaledVector(this._triangle.b,h).addScaledVector(this._triangle.c,1-(c+h)),this._vector.applyMatrix4(o.matrixWorld),n.mesh_normal=u}}break}break;default:this._vector.set(0,0,0),Ye()&&!globalThis.__particlesystem_shapetype_unsupported&&(console.warn("ParticleSystem ShapeType is not supported:",kM[this.shapeType]),globalThis.__particlesystem_shapetype_unsupported=!0);break}this.randomizePosition(this._vector,this.randomPositionAmount)}this.applyRotation(this._vector),i&&(this._vector.applyQuaternion(this.system.worldQuaternion),this._vector.add(this.system.worldPos)),BM&&ft.DrawSphere(this._vector,.03,16711680,.5,!0)}getDirection(n,e){var i;if(!this.enabled)return this._dir.set(0,0,1),this._dir;switch(this.shapeType){case 5:this._dir.set(0,0,1);break;case 4:this._dir.set(0,0,1);break;case 10:case 0:const s=e.x,r=e.y,o=e.z;this._dir.set(s,r,o),(i=this.system)!=null&&i.worldspace?this._dir.sub(this.system.worldPos):this._dir.sub(this.position);break;case 13:const a=n.mesh,l=n.mesh_geometry;if(a&&l)switch(this.meshShapeType){case 0:{const c=l.getAttribute("normal"),h=n.mesh_normal;this._dir.fromBufferAttribute(c,h)}break;case 1:break;case 2:{const c=l.index;if(c){const h=n.mesh_normal,u=c.getX(h*3),d=c.getX(h*3+1),m=c.getX(h*3+2),f=l.getAttribute("position"),g=mt(),y=mt(),v=mt();g.fromBufferAttribute(f,u),y.fromBufferAttribute(f,d),v.fromBufferAttribute(f,m),g.sub(y),v.sub(y),g.cross(v),this._dir.copy(g).multiplyScalar(-1);const b=ki(a);this._dir.applyQuaternion(b)}}break}break;default:this._dir.set(0,0,1);break}return this._space===1&&this._dir.applyQuaternion(this.system.worldQuaternion),this.applyRotation(this._dir),this._dir.normalize(),this.spherizeDirection(this._dir,this.sphericalDirectionAmount),this.randomizeDirection(this._dir,this.randomDirectionAmount),BM&&(ft.DrawSphere(e,.01,8925952,.5,!0),ft.DrawDirection(e,this._dir,8925952,.5,!0)),this._dir}randomizePosition(n,e){if(e<=0)return;const i=sx._tempVec;i.set(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1),i.x*=e*this.scale.x,i.y*=e*this.scale.y,i.z*=e*this.scale.z,n.add(i)}randomizeDirection(n,e){if(e===0)return;const i=sx._randomQuat,s=sx._tempVec;s.set(Math.random()-.5,Math.random()-.5,Math.random()-.5).normalize(),i.setFromAxisAngle(s,e*Math.random()*Math.PI),n.applyQuaternion(i)}spherizeDirection(n,e){if(e===0)return;const i=Math.random()*Math.PI*2,s=Math.acos(1-Math.random()*2),r=Math.sin(s)*Math.cos(i),o=Math.sin(s)*Math.sin(i),a=Math.cos(s),l=new E(r,o,a);n.lerp(l,e)}randomSpherePoint(n,e,i,s,r){const o=Math.random(),a=Math.random(),l=2*Math.PI*o*(s/360),c=Math.acos(2*a-1),h=tt.lerp(1,1-Math.pow(1-Math.random(),Math.PI),i)*e,u=n.x+this.scale.x*(-h*Math.sin(c)*Math.cos(l)),d=n.y+this.scale.y*(h*Math.sin(c)*Math.sin(l)),m=n.z+this.scale.z*(h*Math.cos(c));r.x=u,r.y=d,r.z=m}randomCirclePoint(n,e,i,s,r){const o=Math.random(),a=2*Math.PI*o*(s/360),l=tt.lerp(1,1-Math.pow(1-Math.random(),Math.PI),i)*e,c=n.x+this.scale.x*l*Math.cos(a),h=n.y+this.scale.y*l*Math.sin(a),u=n.z;r.x=c,r.y=h,r.z=u}randomConePoint(n,e,i,s,r,o,a){let l=0,c=0;switch(o){case 0:l=Math.random(),c=Math.random();break;case 2:this._loopTime>1&&(this._loopDirection=-1),this._loopTime<0&&(this._loopDirection=1);case 1:l=.5,c=Math.random(),this._loopTime+=this.system.deltaTime*this._loopDirection;break}let h=2*Math.PI*l*(r/360);switch(o){case 2:case 1:h+=Math.PI+.5,h+=this._loopTime*Math.PI*2,h%=tt.toRadians(r);break}const u=Math.acos(2*c-1),d=tt.lerp(1,1-Math.pow(1-Math.random(),Math.PI),s)*i,m=n.x+-d*Math.sin(u)*Math.cos(h),f=n.y+d*Math.sin(u)*Math.sin(h),g=n.z;a.x=m*this.scale.x,a.y=f*this.scale.y,a.z=g*this.scale.z}},p(OM,"_randomQuat",new Se),p(OM,"_tempVec",new E),OM);let Tn=sx;se([T()],Tn.prototype,"shapeType",2),se([T()],Tn.prototype,"enabled",2),se([T()],Tn.prototype,"alignToDirection",2),se([T()],Tn.prototype,"angle",2),se([T()],Tn.prototype,"arc",2),se([T()],Tn.prototype,"arcSpread",2),se([T()],Tn.prototype,"arcSpeedMultiplier",2),se([T()],Tn.prototype,"arcMode",2),se([T(E)],Tn.prototype,"boxThickness",2),se([T(E)],Tn.prototype,"position",2),se([T(E)],Tn.prototype,"rotation",2),se([T(E)],Tn.prototype,"scale",2),se([T()],Tn.prototype,"radius",2),se([T()],Tn.prototype,"radiusThickness",2),se([T()],Tn.prototype,"sphericalDirectionAmount",2),se([T()],Tn.prototype,"randomDirectionAmount",2),se([T()],Tn.prototype,"randomPositionAmount",2),se([T()],Tn.prototype,"meshShapeType",2),se([T($A)],Tn.prototype,"meshRenderer",2);class Pi{constructor(){p(this,"damping"),p(this,"enabled"),p(this,"frequency"),p(this,"octaveCount"),p(this,"octaveMultiplier"),p(this,"octaveScale"),p(this,"positionAmount"),p(this,"quality"),p(this,"remap"),p(this,"remapEnabled"),p(this,"remapMultiplier"),p(this,"remapX"),p(this,"remapXMultiplier"),p(this,"remapY"),p(this,"remapYMultiplier"),p(this,"remapZ"),p(this,"remapZMultiplier"),p(this,"scrollSpeedMultiplier"),p(this,"separateAxes"),p(this,"strengthMultiplier"),p(this,"strengthX"),p(this,"strengthXMultiplier"),p(this,"strengthY"),p(this,"strengthYMultiplier"),p(this,"strengthZ"),p(this,"strengthZMultiplier"),p(this,"_noise"),p(this,"_time",0),p(this,"_temp",new E)}update(e){this._time+=e.time.deltaTime*this.scrollSpeedMultiplier}apply(e,i,s,r,o,a){if(!this.enabled)return;this._noise||(this._noise=Qve(()=>0));const l=this._temp.set(i.x,i.y,i.z).multiplyScalar(this.frequency),c=this._noise(l.x,l.y,l.z,this._time),h=this._noise(l.x,l.y,l.z,this._time+1e3*this.frequency),u=this._noise(l.x,l.y,l.z,this._time+2e3*this.frequency);this._temp.set(c,h,u).normalize();const d=o/a;let m=this.positionAmount.evaluate(d);this.separateAxes?(this._temp.x*=m*this.strengthXMultiplier,this._temp.y*=m*this.strengthYMultiplier,this._temp.z*=m*this.strengthZMultiplier):(this.strengthX&&(m*=this.strengthX.evaluate(d)*1.5),this._temp.multiplyScalar(m)),s.x+=this._temp.x,s.y+=this._temp.y,s.z+=this._temp.z}}se([T()],Pi.prototype,"damping",2),se([T()],Pi.prototype,"enabled",2),se([T()],Pi.prototype,"frequency",2),se([T()],Pi.prototype,"octaveCount",2),se([T()],Pi.prototype,"octaveMultiplier",2),se([T()],Pi.prototype,"octaveScale",2),se([T(gt)],Pi.prototype,"positionAmount",2),se([T()],Pi.prototype,"quality",2),se([T(gt)],Pi.prototype,"remap",2),se([T()],Pi.prototype,"remapEnabled",2),se([T()],Pi.prototype,"remapMultiplier",2),se([T(gt)],Pi.prototype,"remapX",2),se([T()],Pi.prototype,"remapXMultiplier",2),se([T(gt)],Pi.prototype,"remapY",2),se([T()],Pi.prototype,"remapYMultiplier",2),se([T(gt)],Pi.prototype,"remapZ",2),se([T()],Pi.prototype,"remapZMultiplier",2),se([T()],Pi.prototype,"scrollSpeedMultiplier",2),se([T()],Pi.prototype,"separateAxes",2),se([T()],Pi.prototype,"strengthMultiplier",2),se([T(gt)],Pi.prototype,"strengthX",2),se([T()],Pi.prototype,"strengthXMultiplier",2),se([T(gt)],Pi.prototype,"strengthY",2),se([T()],Pi.prototype,"strengthYMultiplier",2),se([T(gt)],Pi.prototype,"strengthZ",2),se([T()],Pi.prototype,"strengthZMultiplier",2);class xn{constructor(){p(this,"enabled"),p(this,"attachRibbonToTransform",!1),p(this,"colorOverLifetime"),p(this,"colorOverTrail"),p(this,"dieWithParticles",!0),p(this,"inheritParticleColor",!0),p(this,"lifetime"),p(this,"lifetimeMultiplier"),p(this,"minVertexDistance",.2),p(this,"mode",0),p(this,"ratio",1),p(this,"ribbonCount",1),p(this,"shadowBias",0),p(this,"sizeAffectsLifetime",!1),p(this,"sizeAffectsWidth",!1),p(this,"splitSubEmitterRibbons",!1),p(this,"textureMode",0),p(this,"widthOverTrail"),p(this,"widthOverTrailMultiplier"),p(this,"worldSpace",!1)}getWidth(e,i,s,r){const o=this.widthOverTrail.evaluate(s,r);return e*=o,e}getColor(e,i,s){const r=this.colorOverTrail.evaluate(s),o=this.colorOverLifetime.evaluate(i);e.x*=r.r*o.r,e.y*=r.g*o.g,e.z*=r.b*o.b,"alpha"in r&&"alpha"in o&&(e.w*=r.alpha*o.alpha)}}se([T()],xn.prototype,"enabled",2),se([T()],xn.prototype,"attachRibbonToTransform",2),se([T(vo)],xn.prototype,"colorOverLifetime",2),se([T(vo)],xn.prototype,"colorOverTrail",2),se([T()],xn.prototype,"dieWithParticles",2),se([T()],xn.prototype,"inheritParticleColor",2),se([T(gt)],xn.prototype,"lifetime",2),se([T()],xn.prototype,"lifetimeMultiplier",2),se([T()],xn.prototype,"minVertexDistance",2),se([T()],xn.prototype,"mode",2),se([T()],xn.prototype,"ratio",2),se([T()],xn.prototype,"ribbonCount",2),se([T()],xn.prototype,"shadowBias",2),se([T()],xn.prototype,"sizeAffectsLifetime",2),se([T()],xn.prototype,"sizeAffectsWidth",2),se([T()],xn.prototype,"splitSubEmitterRibbons",2),se([T()],xn.prototype,"textureMode",2),se([T(gt)],xn.prototype,"widthOverTrail",2),se([T()],xn.prototype,"widthOverTrailMultiplier",2),se([T()],xn.prototype,"worldSpace",2);class Rn{constructor(){p(this,"enabled"),p(this,"space",0),p(this,"orbitalX"),p(this,"orbitalY"),p(this,"orbitalZ"),p(this,"orbitalXMultiplier"),p(this,"orbitalYMultiplier"),p(this,"orbitalZMultiplier"),p(this,"orbitalOffsetX"),p(this,"orbitalOffsetY"),p(this,"orbitalOffsetZ"),p(this,"speedModifier"),p(this,"speedModifierMultiplier"),p(this,"x"),p(this,"xMultiplier"),p(this,"y"),p(this,"yMultiplier"),p(this,"z"),p(this,"zMultiplier"),p(this,"_system"),p(this,"_temp",new E),p(this,"_temp2",new E),p(this,"_temp3",new E),p(this,"_hasOrbital",!1),p(this,"_index",0),p(this,"_orbitalMatrix",new he)}update(e){this._system=e}init(e){this._index==0&&(e.debug=!0),this._index+=1,e.orbitx=this.orbitalX.evaluate(Math.random()),e.orbity=this.orbitalY.evaluate(Math.random()),e.orbitz=this.orbitalZ.evaluate(Math.random()),this._hasOrbital=e.orbitx!=0||e.orbity!=0||e.orbitz!=0}apply(e,i,s,r,o,a,l){var c;if(!this.enabled)return;const h=a/l,u=this.speedModifier.evaluate(h)*this.speedModifierMultiplier,d=this.x.evaluate(h),m=this.y.evaluate(h),f=this.z.evaluate(h);if(this._temp.set(-d,m,f),this._system&&this._system.main.simulationSpace===1&&this._temp.applyQuaternion(this._system.worldQuaternion),this._hasOrbital&&((c=this._system)==null?void 0:c.worldPos)){const g=this._temp2.set(s.x,s.y,s.z),y=this.orbitalXMultiplier,v=this.orbitalYMultiplier,b=this.orbitalZMultiplier,A=u*Math.PI*2*10,x=Math.cos(A*y),w=Math.sin(A*y),_=Math.cos(A*v),S=Math.sin(A*v),M=Math.cos(A*b),R=Math.sin(A*b),P=g.x*(_*M)+g.y*(_*R)+g.z*-S,C=g.x*(w*S*M-x*R)+g.y*(w*S*R+x*M)+g.z*(w*_),L=g.x*(x*S*M+w*R)+g.y*(x*S*R-w*M)+g.z*(x*_),B=this._temp3.set(g.x-P,g.y-C,g.z-L);B.normalize(),B.multiplyScalar(.2/o*Math.max(this.orbitalXMultiplier,this.orbitalYMultiplier,this.orbitalZMultiplier)),r.x+=B.x,r.y+=B.y,r.z+=B.z}r.x+=this._temp.x,r.y+=this._temp.y,r.z+=this._temp.z,r.x*=u,r.y*=u,r.z*=u}}se([T()],Rn.prototype,"enabled",2),se([T()],Rn.prototype,"space",2),se([T(gt)],Rn.prototype,"orbitalX",2),se([T(gt)],Rn.prototype,"orbitalY",2),se([T(gt)],Rn.prototype,"orbitalZ",2),se([T()],Rn.prototype,"orbitalXMultiplier",2),se([T()],Rn.prototype,"orbitalYMultiplier",2),se([T()],Rn.prototype,"orbitalZMultiplier",2),se([T()],Rn.prototype,"orbitalOffsetX",2),se([T()],Rn.prototype,"orbitalOffsetY",2),se([T()],Rn.prototype,"orbitalOffsetZ",2),se([T(gt)],Rn.prototype,"speedModifier",2),se([T()],Rn.prototype,"speedModifierMultiplier",2),se([T(gt)],Rn.prototype,"x",2),se([T()],Rn.prototype,"xMultiplier",2),se([T(gt)],Rn.prototype,"y",2),se([T()],Rn.prototype,"yMultiplier",2),se([T(gt)],Rn.prototype,"z",2),se([T()],Rn.prototype,"zMultiplier",2);class dr{constructor(){p(this,"animation"),p(this,"enabled"),p(this,"cycleCount"),p(this,"frameOverTime"),p(this,"frameOverTimeMultiplier"),p(this,"numTilesX"),p(this,"numTilesY"),p(this,"startFrame"),p(this,"startFrameMultiplier"),p(this,"rowMode"),p(this,"rowIndex"),p(this,"spriteCount"),p(this,"timeMode")}sampleOnceAtStart(){if(this.timeMode===0)switch(this.frameOverTime.mode){case 0:case 3:case 2:case 1:return!0}return!1}getStartIndex(){return this.sampleOnceAtStart()?Math.random()*(this.numTilesX*this.numTilesY):0}evaluate(e){if(!this.sampleOnceAtStart())return this.getIndex(e)}getIndex(e){const i=this.numTilesX*this.numTilesY;e=e*this.cycleCount;let s=this.frameOverTime.evaluate(e%1);return s*=this.frameOverTimeMultiplier,s*=i,s=s%i,s=Math.floor(s),s}}se([T()],dr.prototype,"animation",2),se([T()],dr.prototype,"enabled",2),se([T()],dr.prototype,"cycleCount",2),se([T(gt)],dr.prototype,"frameOverTime",2),se([T()],dr.prototype,"frameOverTimeMultiplier",2),se([T()],dr.prototype,"numTilesX",2),se([T()],dr.prototype,"numTilesY",2),se([T(gt)],dr.prototype,"startFrame",2),se([T()],dr.prototype,"startFrameMultiplier",2),se([T()],dr.prototype,"rowMode",2),se([T()],dr.prototype,"rowIndex",2),se([T()],dr.prototype,"spriteCount",2),se([T()],dr.prototype,"timeMode",2);class qa{constructor(){p(this,"enabled"),p(this,"separateAxes"),p(this,"x"),p(this,"xMultiplier"),p(this,"y"),p(this,"yMultiplier"),p(this,"z"),p(this,"zMultiplier")}evaluate(e,i){return this.enabled?this.separateAxes?0:this.z.evaluate(e,i)*-1:0}}se([T()],qa.prototype,"enabled",2),se([T()],qa.prototype,"separateAxes",2),se([T(gt)],qa.prototype,"x",2),se([T()],qa.prototype,"xMultiplier",2),se([T(gt)],qa.prototype,"y",2),se([T()],qa.prototype,"yMultiplier",2),se([T(gt)],qa.prototype,"z",2),se([T()],qa.prototype,"zMultiplier",2);class ma{constructor(){p(this,"enabled"),p(this,"range"),p(this,"separateAxes"),p(this,"x"),p(this,"xMultiplier"),p(this,"y"),p(this,"yMultiplier"),p(this,"z"),p(this,"zMultiplier")}evaluate(e,i){if(!this.enabled)return 0;if(!this.separateAxes){const s=tt.lerp(this.range.x,this.range.y,i);return this.z.evaluate(s)*-1}return 0}}se([T()],ma.prototype,"enabled",2),se([T()],ma.prototype,"range",2),se([T()],ma.prototype,"separateAxes",2),se([T(gt)],ma.prototype,"x",2),se([T()],ma.prototype,"xMultiplier",2),se([T(gt)],ma.prototype,"y",2),se([T()],ma.prototype,"yMultiplier",2),se([T(gt)],ma.prototype,"z",2),se([T()],ma.prototype,"zMultiplier",2);class as{constructor(){p(this,"enabled"),p(this,"dampen"),p(this,"drag"),p(this,"dragMultiplier"),p(this,"limit"),p(this,"limitMultiplier"),p(this,"separateAxes"),p(this,"limitX"),p(this,"limitXMultiplier"),p(this,"limitY"),p(this,"limitYMultiplier"),p(this,"limitZ"),p(this,"limitZMultiplier"),p(this,"multiplyDragByParticleSize",!1),p(this,"multiplyDragByParticleVelocity",!1),p(this,"space"),p(this,"_temp",new E),p(this,"_temp2",new E)}apply(e,i,s,r,o,a,l){if(this.enabled){const c=this.limit.evaluate(o)*this.limitMultiplier;if(i.length()>c){this._temp.copy(i).normalize().multiplyScalar(c);const h=this.dampen*.5;i.x=tt.lerp(i.x,this._temp.x,h),i.y=tt.lerp(i.y,this._temp.y,h),i.z=tt.lerp(i.z,this._temp.z,h),s.x=tt.lerp(s.x,this._temp.x,h),s.y=tt.lerp(s.y,this._temp.y,h),s.z=tt.lerp(s.z,this._temp.z,h)}}}}se([T()],as.prototype,"enabled",2),se([T()],as.prototype,"dampen",2),se([T(gt)],as.prototype,"drag",2),se([T()],as.prototype,"dragMultiplier",2),se([T(gt)],as.prototype,"limit",2),se([T()],as.prototype,"limitMultiplier",2),se([T()],as.prototype,"separateAxes",2),se([T(gt)],as.prototype,"limitX",2),se([T()],as.prototype,"limitXMultiplier",2),se([T(gt)],as.prototype,"limitY",2),se([T()],as.prototype,"limitYMultiplier",2),se([T(gt)],as.prototype,"limitZ",2),se([T()],as.prototype,"limitZMultiplier",2),se([T()],as.prototype,"multiplyDragByParticleSize",2),se([T()],as.prototype,"multiplyDragByParticleVelocity",2),se([T()],as.prototype,"space",2);const tZ=class{constructor(){p(this,"enabled"),p(this,"curve"),p(this,"curveMultiplier"),p(this,"mode"),p(this,"system"),p(this,"_temp",new E),p(this,"_firstUpdate",!0),p(this,"_frames",0)}clone(){var n;const e=new tZ;return e.enabled=this.enabled,e.curve=(n=this.curve)==null?void 0:n.clone(),e.curveMultiplier=this.curveMultiplier,e.mode=this.mode,e}get _lastWorldPosition(){return this.system._iv_lastWorldPosition||(this.system._iv_lastWorldPosition=new E),this.system._iv_lastWorldPosition}get _velocity(){return this.system._iv_velocity||(this.system._iv_velocity=new E),this.system._iv_velocity}awake(n){this.system=n,this.reset()}reset(){this._firstUpdate=!0}update(n){this.enabled&&this.system.worldspace!==!1&&(this._firstUpdate?(this._firstUpdate=!1,this._velocity.set(0,0,0),this._lastWorldPosition.copy(this.system.worldPos)):this._lastWorldPosition&&(this._velocity.copy(this.system.worldPos).sub(this._lastWorldPosition).multiplyScalar(1/this.system.deltaTime),this._lastWorldPosition.copy(this.system.worldPos)))}applyInitial(n){if(this.enabled&&this.system.worldspace!==!1&&this.mode===0){const e=this.curve.evaluate(Math.random(),Math.random());this._temp.copy(this._velocity).multiplyScalar(e),n.add(this._temp)}}applyCurrent(n,e,i){if(this.enabled&&this.system&&this.system.worldspace!==!1&&this.mode===1){const s=this.curve.evaluate(e,i);this._temp.copy(this._velocity).multiplyScalar(s),n.add(this._temp)}}};let jd=tZ;se([T()],jd.prototype,"enabled",2),se([T(gt)],jd.prototype,"curve",2),se([T()],jd.prototype,"curveMultiplier",2),se([T()],jd.prototype,"mode",2);class bo{constructor(){p(this,"enabled"),p(this,"range"),p(this,"separateAxes"),p(this,"size"),p(this,"sizeMultiplier"),p(this,"x"),p(this,"xMultiplier"),p(this,"y"),p(this,"yMultiplier"),p(this,"z"),p(this,"zMultiplier")}evaluate(e,i,s,r){const o=e.length(),a=tt.remap(o,this.range.x,this.range.y,0,1),l=this.size.evaluate(a,s);return r*l}}se([T()],bo.prototype,"enabled",2),se([T(Y)],bo.prototype,"range",2),se([T()],bo.prototype,"separateAxes",2),se([T(gt)],bo.prototype,"size",2),se([T()],bo.prototype,"sizeMultiplier",2),se([T(gt)],bo.prototype,"x",2),se([T()],bo.prototype,"xMultiplier",2),se([T(gt)],bo.prototype,"y",2),se([T()],bo.prototype,"yMultiplier",2),se([T(gt)],bo.prototype,"z",2),se([T()],bo.prototype,"zMultiplier",2);class Ym{constructor(){p(this,"enabled"),p(this,"range"),p(this,"color")}evaluate(e,i,s){const r=e.length(),o=tt.remap(r,this.range.x,this.range.y,0,1),a=this.color.evaluate(o,i);s.x*=a.r,s.y*=a.g,s.z*=a.b,"alpha"in a&&(s.w*=a.alpha)}}se([T()],Ym.prototype,"enabled",2),se([T(Y)],Ym.prototype,"range",2),se([T(vo)],Ym.prototype,"color",2);const _be={name:"HorizontalBlurShader",uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float h;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

			gl_FragColor = sum;

		}`},Sbe={name:"VerticalBlurShader",uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float v;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

			gl_FragColor = sum;

		}`};var Cbe=Object.defineProperty,Mbe=Object.getOwnPropertyDescriptor,K0=(n,e,i,s)=>{for(var r=s>1?void 0:s?Mbe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&Cbe(e,i,r),r};const rx=te("debugcontactshadows");tD(n=>{const e=n.domElement.getAttribute("contactshadows");e!=null&&e!="0"&&e!="false"&&Xl.auto(n)});var sO;const iZ=(sO=class extends Pe{constructor(){super(...arguments),p(this,"autoFit",!1),p(this,"darkness",.5),p(this,"opacity",.5),p(this,"blur",4),p(this,"occludeBelowGround",!1),p(this,"backfaceShadows",!0),p(this,"minSize"),p(this,"shadowsRoot",new ye),p(this,"shadowCamera"),p(this,"shadowGroup",new Vn),p(this,"renderTarget"),p(this,"renderTargetBlur"),p(this,"plane"),p(this,"occluderMesh"),p(this,"blurPlane"),p(this,"depthMaterial"),p(this,"horizontalBlurMaterial"),p(this,"verticalBlurMaterial"),p(this,"textureSize",512)}static auto(n){if(n||(n=Pt.Current),!n)throw new Error("No context provided and no current context set.");let e=this._instances.get(n);if(!e||e.destroyed){const i=new ye;e=ta(i,iZ,{autoFit:!1,occludeBelowGround:!1}),this._instances.set(n,e)}return n.scene.add(e.gameObject),e.fitShadows(),e}fitShadows(){rx&&console.warn("Fitting shadows to scene"),$I(this.shadowsRoot,!1);const n=Ba(this.context.scene.children,[this.shadowsRoot]),e=Math.max(1,this.blur/32),i=n.max.x-n.min.x,s=n.max.z-n.min.z;n.expandByVector(new E(e*i,0,e*s)),rx&&ft.DrawWireBox3(n,16776960,60),this.gameObject.parent&&n.applyMatrix4(this.gameObject.parent.matrixWorld.clone().invert());const r=n.min,o=Math.max(1e-5,(n.max.y-r.y)*.002);n.max.y+=o,this.shadowsRoot.position.set((r.x+n.max.x)/2,r.y-o,(r.z+n.max.z)/2),this.shadowsRoot.scale.set(n.max.x-r.x,n.max.y-r.y,n.max.z-r.z),this.applyMinSize(),this.shadowsRoot.matrixWorldNeedsUpdate=!0,rx&&console.log("Fitted shadows to scene",this.shadowsRoot.scale.clone())}awake(){$I(this.shadowsRoot,!1)}start(){rx&&console.log("Create ContactShadows on "+this.gameObject.name,this),this.gameObject.add(this.shadowsRoot),this.shadowsRoot.add(this.shadowGroup),this.renderTarget=new Zt(this.textureSize,this.textureSize),this.renderTarget.texture.generateMipmaps=!1,this.renderTargetBlur=new Zt(this.textureSize,this.textureSize),this.renderTargetBlur.texture.generateMipmaps=!1;const n=new ds(1,1).rotateX(Math.PI/2);this.gameObject instanceof pe&&(console.warn("ContactShadows can not be added to a Mesh. Please add it to a Group or an empty Object"),md(this.gameObject,!1));const e=new Qt({map:this.renderTarget.texture,opacity:this.opacity,color:0,transparent:!0,depthWrite:!1,side:Un});this.plane=new pe(n,e),this.plane.scale.y=-1,this.plane.layers.set(2),this.shadowsRoot.add(this.plane),this.plane&&(this.plane.renderOrder=1),this.occluderMesh=new pe(this.plane.geometry,new Qt({depthWrite:!0,stencilWrite:!0,colorWrite:!1,side:un})).translateY(-1e-4),this.occluderMesh.renderOrder=-100,this.occluderMesh.layers.set(2),this.shadowsRoot.add(this.occluderMesh),this.blurPlane=new pe(n),this.blurPlane.visible=!1,this.shadowGroup.add(this.blurPlane);const i=0,s=1;this.shadowCamera=new ic(-1/2,1/2,1/2,-1/2,i,s),this.shadowCamera.layers.enableAll(),this.shadowCamera.rotation.x=Math.PI/2,this.shadowGroup.add(this.shadowCamera),this.depthMaterial=new gv,this.depthMaterial.userData.darkness={value:this.darkness},this.depthMaterial.blending=QT,this.depthMaterial.blendEquation=w1,this.depthMaterial.onBeforeCompile=r=>{this.depthMaterial&&(r.uniforms.darkness=this.depthMaterial.userData.darkness,r.fragmentShader=`
                uniform float darkness;
                ${r.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 1.0 ), ( 1.0 - fragCoordZ ) * darkness * opacity * (gl_FrontFacing ? 1.0 : 0.66) );")}
            `)},this.depthMaterial.depthTest=!1,this.depthMaterial.depthWrite=!1,this.horizontalBlurMaterial=new kt(_be),this.horizontalBlurMaterial.depthTest=!1,this.verticalBlurMaterial=new kt(Sbe),this.verticalBlurMaterial.depthTest=!1,this.shadowGroup.visible=!1,this.autoFit?this.fitShadows():this.applyMinSize()}onDestroy(){var n,e,i,s,r,o,a,l;(n=this.renderTarget)==null||n.dispose(),(e=this.renderTargetBlur)==null||e.dispose(),(i=this.depthMaterial)==null||i.dispose(),(s=this.horizontalBlurMaterial)==null||s.dispose(),(r=this.verticalBlurMaterial)==null||r.dispose(),(o=this.blurPlane)==null||o.geometry.dispose(),(a=this.plane)==null||a.geometry.dispose(),(l=this.occluderMesh)==null||l.geometry.dispose()}onBeforeRender(n){if(!this.renderTarget||!this.renderTargetBlur||!this.depthMaterial||!this.shadowCamera||!this.blurPlane||!this.shadowGroup||!this.plane||!this.horizontalBlurMaterial||!this.verticalBlurMaterial){rx&&console.error("ContactShadows: not initialized yet");return}const e=this.context.scene,i=this.context.renderer,s=i.getRenderTarget();this.shadowGroup.visible=!0,this.occluderMesh&&(this.occluderMesh.visible=!1);const r=this.plane.visible;this.plane.visible=!1,this.gameObject instanceof pe&&md(this.gameObject,!1);const o=e.background;e.background=null,e.overrideMaterial=this.depthMaterial,this.backfaceShadows?this.depthMaterial.side=xi:this.depthMaterial.side=Un;const a=i.getClearAlpha();i.setClearAlpha(0);const l=i.xr.enabled;i.xr.enabled=!1;const c=this.context.scene.matrixWorldAutoUpdate;this.context.scene.matrixWorldAutoUpdate=!1;const h=i.renderLists.get(e,0),u=h.transparent;nZ.length=0,h.transparent=nZ,rO.length=0;for(const m of h.opaque){if(!m.object.visible)continue;const f=m.material;let g=m.material.colorWrite==!1||f.wireframe===!0||B5(m.object)===!1;!g&&m.material.linewidth!=null&&(g=!0),g&&(rO.push(m.object),m.object["needle:visible"]=m.object.visible,m.object.visible=!1)}i.setRenderTarget(this.renderTarget),i.clear(),i.render(e,this.shadowCamera),h.transparent=u;for(const m of rO)m["needle:visible"]!=null&&(m.visible=m["needle:visible"]);e.overrideMaterial=null;const d=Math.max(this.blur,.05);this.blurShadow(d*2),this.blurShadow(d*.5),this.shadowGroup.visible=!1,this.occluderMesh&&(this.occluderMesh.visible=this.occludeBelowGround),this.plane.visible=r,i.setRenderTarget(s),i.setClearAlpha(a),e.background=o,i.xr.enabled=l,this.context.scene.matrixWorldAutoUpdate=c}blurShadow(n){if(!this.blurPlane||!this.shadowCamera||!this.renderTarget||!this.renderTargetBlur||!this.horizontalBlurMaterial||!this.verticalBlurMaterial)return;this.blurPlane.visible=!0;const e=this.shadowsRoot.worldScale,i=(e.x+e.z)/2,s=e.z/i,r=e.x/i;this.blurPlane.material=this.horizontalBlurMaterial,this.blurPlane.material.uniforms.tDiffuse.value=this.renderTarget.texture,this.horizontalBlurMaterial.uniforms.h.value=n*1/this.textureSize*s;const o=this.context.renderer,a=o.getRenderTarget();o.setRenderTarget(this.renderTargetBlur),o.render(this.blurPlane,this.shadowCamera),this.blurPlane.material=this.verticalBlurMaterial,this.blurPlane.material.uniforms.tDiffuse.value=this.renderTargetBlur.texture,this.verticalBlurMaterial.uniforms.v.value=n*1/this.textureSize*r,o.setRenderTarget(this.renderTarget),o.render(this.blurPlane,this.shadowCamera),this.blurPlane.visible=!1,o.setRenderTarget(a)}applyMinSize(){this.minSize&&this.shadowsRoot.scale.set(Math.max(this.minSize.x||0,this.shadowsRoot.scale.x),Math.max(this.minSize.y||0,this.shadowsRoot.scale.y),Math.max(this.minSize.z||0,this.shadowsRoot.scale.z))}},p(sO,"_instances",new Map),sO);let Xl=iZ;K0([T()],Xl.prototype,"autoFit",2),K0([T()],Xl.prototype,"darkness",2),K0([T()],Xl.prototype,"opacity",2),K0([T()],Xl.prototype,"blur",2),K0([T()],Xl.prototype,"occludeBelowGround",2),K0([T()],Xl.prototype,"backfaceShadows",2);const nZ=[],rO=new Array,sZ=class{constructor(){p(this,"_quicklookButton"),p(this,"_arButton"),p(this,"_vrButton"),p(this,"_sendToQuestButton")}static create(){return new sZ}static getOrCreate(){return this._instance||(this._instance=this.create()),this._instance}get isSecureConnection(){return window.location.protocol==="https:"}get quicklookButton(){return this._quicklookButton}get arButton(){return this._arButton}get vrButton(){return this._vrButton}get sendToQuestButton(){return this._sendToQuestButton}get qrButton(){return Xh.getOrCreate().createQRCode()}createQuicklookButton(){if(this._quicklookButton)return this._quicklookButton;const n=document.createElement("button");this._quicklookButton=n,n.dataset.needle="quicklook-button",xt.supportsQuickLookAR()?n.innerText="View in AR":n.innerText="Download for AR",n.prepend(sr("view_in_ar"));let e=!1,i=null;return n.addEventListener("click",()=>{i=rC(Gn),i||(e=!0,i=new Gn),e&&(i.objectToExport=Pt.Current.scene),i?(n.classList.add("this-mode-is-requested"),i.exportAndOpen().then(()=>{n.classList.remove("this-mode-is-requested")}).catch(s=>{n.classList.remove("this-mode-is-requested"),console.error(s)})):console.warn("No USDZExporter component found in the scene")}),this.hideElementDuringXRSession(n),n}createARButton(n){var e;if(this._arButton)return this._arButton;const i="immersive-ar",s=document.createElement("button");return this._arButton=s,s.classList.add("webxr-button"),s.dataset.needle="webxr-ar-button",s.innerText="Enter AR",s.prepend(sr("view_in_ar")),s.title="Click to start an AR session",s.addEventListener("click",()=>Et.start(i,n)),this.updateSessionSupported(s,i),this.listenToXRSessionState(s,i),this.hideElementDuringXRSession(s),this.isSecureConnection||(s.disabled=!0,s.title="WebXR requires a secure connection (HTTPS)"),xt.isMozillaXR()||(e=navigator.xr)==null||e.addEventListener("devicechange",()=>this.updateSessionSupported(s,i)),s}createVRButton(n){var e;if(this._vrButton)return this._vrButton;const i="immersive-vr",s=document.createElement("button");return this._vrButton=s,s.classList.add("webxr-button"),s.dataset.needle="webxr-vr-button",s.innerText="Enter VR",s.prepend(sr("panorama_photosphere")),s.title="Click to start a VR session",s.addEventListener("click",()=>Et.start(i,n)),this.updateSessionSupported(s,i),this.listenToXRSessionState(s,i),this.hideElementDuringXRSession(s),this.isSecureConnection||(s.disabled=!0,s.title="WebXR requires a secure connection (HTTPS)"),xt.isMozillaXR()||(e=navigator.xr)==null||e.addEventListener("devicechange",()=>this.updateSessionSupported(s,i)),s}createSendToQuestButton(){var n;if(this._sendToQuestButton)return this._sendToQuestButton;const e="https://oculus.com/open_url/?url=",i=document.createElement("button");return this._sendToQuestButton=i,i.dataset.needle="webxr-sendtoquest-button",i.innerText="Open on Quest",i.prepend(sr("share_windows")),i.title="Click to send this page to the Oculus Browser on your Quest",i.addEventListener("click",()=>{const s=encodeURIComponent(window.location.href),r=e+s;window.open(r)==null&&gn("This page doesn't allow popups. Please paste "+r+" into your browser.")}),this.listenToXRSessionState(i),this.hideElementDuringXRSession(i),xt.isMozillaXR()||(n=navigator.xr)==null||n.addEventListener("devicechange",()=>{var s;(s=navigator.xr)!=null&&s.isSessionSupported("immersive-vr")?i.style.display="none":i.style.display=""}),i}createQRCode(){return Xh.getOrCreate().createQRCode()}updateSessionSupported(n,e){if(!("xr"in navigator)){n.style.display="none";return}Et.isSessionSupported(e).then(i=>{n.style.display=i?"":"none",Ye()&&!i&&console.log('[WebXR] "'+e+'" is not supported on this device \u2013 make sure your server runs using HTTPS and you have a device connected that supports '+e)})}hideElementDuringXRSession(n){wS(e=>{n["previous-display"]=n.style.display,n.style.display="none"}),GP(e=>{n["previous-display"]!=null&&(n.style.display=n["previous-display"])})}listenToXRSessionState(n,e){e&&(Et.onSessionRequestStart(i=>{i.mode===e?n.classList.add("this-mode-is-requested"):(n["was-disabled"]=n.disabled,n.disabled=!0,n.classList.add("other-mode-is-requested"))}),Et.onSessionRequestEnd(i=>{n.classList.remove("this-mode-is-requested"),n.classList.remove("other-mode-is-requested"),n.disabled=n["was-disabled"]}))}};let Km=sZ;p(Km,"_instance");var Ebe=Object.defineProperty,Tbe=Object.getOwnPropertyDescriptor,Xs=(n,e,i,s)=>{for(var r=s>1?void 0:s?Tbe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&Ebe(e,i,r),r};const GM=te("debugspriterenderer"),Rbe=te("wireframe"),oO=class{static getOrCreateGeometry(n){if(n.__cached_geometry)return n.__cached_geometry;if(n.guid&&oO.cache[n.guid])return GM&&console.log("Take cached geometry for sprite",n.guid),oO.cache[n.guid];const e=new dt;n.__cached_geometry=e;const i=new Float32Array(n.triangles.length*3),s=new Float32Array(n.triangles.length*2);for(let r=0;r<n.triangles.length;r+=1){const o=n.triangles[r];i[r*3]=-n.vertices[o].x,i[r*3+1]=n.vertices[o].y,i[r*3+2]=0;const a=n.uv[o];s[r*2]=a.x,s[r*2+1]=1-a.y}return e.setAttribute("position",new qe(i,3)),e.setAttribute("uv",new qe(s,2)),n.guid&&(this.cache[n.guid]=e),GM&&console.log("Built sprite geometry",n,e),e}};let ox=oO;p(ox,"cache",{});class Ibe{constructor(){p(this,"x"),p(this,"y")}}function rZ(n){n&&(n.colorSpace!=vt&&(n.colorSpace=vt,n.needsUpdate=!0),n.minFilter==Dt&&n.magFilter==Dt&&(n.anisotropy=1,n.needsUpdate=!0))}class Fc{constructor(e){p(this,"guid"),p(this,"texture"),p(this,"triangles"),p(this,"uv"),p(this,"vertices"),p(this,"__cached_geometry"),p(this,"_mesh"),p(this,"_material"),e&&(this.texture=e,this.triangles=[0,1,2,0,2,3],this.uv=[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:1}],this.vertices=[{x:-.5,y:-.5},{x:.5,y:-.5},{x:.5,y:.5},{x:-.5,y:.5}])}get mesh(){return this._mesh||(this._mesh=new pe(ox.getOrCreateGeometry(this),this.material)),this._mesh}get material(){return this._material||(this.texture&&rZ(this.texture),this._material=new Qt({map:this.texture,color:16777215,side:xi,transparent:!0})),this._material}getGeometry(){return ox.getOrCreateGeometry(this)}}Xs([T()],Fc.prototype,"guid",2),Xs([T(Vt)],Fc.prototype,"texture",2),Xs([S0()],Fc.prototype,"triangles",2),Xs([S0()],Fc.prototype,"uv",2),Xs([S0()],Fc.prototype,"vertices",2);const aO=Symbol("spriteOwner");class Qd{constructor(){p(this,"sprites")}}Xs([T(Fc)],Qd.prototype,"sprites",2);const oZ=class{constructor(){p(this,"spriteSheet"),p(this,"index",0)}static create(){const n=new oZ;return n.spriteSheet=new Qd,n}set sprite(n){n&&(this.spriteSheet?((this.index===null||this.index===void 0)&&(this.index=0),this.spriteSheet.sprites[this.index]=n):(this.spriteSheet=new Qd,this.spriteSheet.sprites=[n],this.index=0))}get sprite(){if(this.spriteSheet)return this.spriteSheet.sprites[this.index]}update(n){if(!this.spriteSheet)return;const e=this.index;if(e<0||e>=this.spriteSheet.sprites.length)return;const i=this.spriteSheet.sprites[e],s=i?.texture;if(s&&(rZ(s),!i.__hasLoadedProgressive)){i.__hasLoadedProgressive=!0;const r=s;mi.assignTextureLOD(s,0).then(o=>{o instanceof Vt&&(i.texture=o,n?.map===r&&(n.map=o,n.needsUpdate=!0))})}}};let ou=oZ;Xs([T(Qd)],ou.prototype,"spriteSheet",2),Xs([T()],ou.prototype,"index",2);class Do extends Pe{constructor(){super(...arguments),p(this,"drawMode",0),p(this,"size",{x:1,y:1}),p(this,"color"),p(this,"sharedMaterial"),p(this,"transparent",!0),p(this,"cutoutThreshold",0),p(this,"castShadows",!1),p(this,"renderOrder",0),p(this,"toneMapped",!0),p(this,"_spriteSheet"),p(this,"_currentSprite")}set texture(e){var i;if(!this._spriteSheet)return;const s=(i=this._spriteSheet.spriteSheet)==null?void 0:i.sprites[this.spriteIndex];s&&(s.texture=e,this.updateSprite())}addSprite(e,i=!1){var s,r;if(this._spriteSheet||(this._spriteSheet=ou.create()),!this._spriteSheet.spriteSheet)return-1;(s=this._spriteSheet.spriteSheet)==null||s.sprites.push(e);const o=((r=this._spriteSheet.spriteSheet)==null?void 0:r.sprites.length)-1;return i&&(this.spriteIndex=o),o}get sprite(){return this._spriteSheet}set sprite(e){if(e!==this._spriteSheet)if(typeof e=="number"){const i=Math.floor(e);this.spriteIndex=i;return}else e instanceof Fc?(this._spriteSheet||(this._spriteSheet=ou.create()),this._spriteSheet.sprite!=e&&(this._spriteSheet.sprite=e,this.updateSprite())):e!=this._spriteSheet&&(this._spriteSheet=e,this.updateSprite())}set spriteIndex(e){this._spriteSheet&&e!==this.spriteIndex&&(this._spriteSheet.index=e,this.updateSprite())}get spriteIndex(){var e;return((e=this._spriteSheet)==null?void 0:e.index)??0}get spriteFrames(){var e,i;return((i=(e=this._spriteSheet)==null?void 0:e.spriteSheet)==null?void 0:i.sprites.length)??0}awake(){this._currentSprite=void 0,this._spriteSheet||(this._spriteSheet=new ou,this._spriteSheet.spriteSheet=new Qd),GM&&console.log("Awake",this.name,this,this.sprite)}start(){this._currentSprite?this.gameObject&&this.gameObject.add(this._currentSprite):this.updateSprite()}updateSprite(e=!1){var i;if(!this.__didAwake&&!e)return!1;const s=this._spriteSheet;if(!((i=s?.spriteSheet)!=null&&i.sprites))return console.warn("SpriteRenderer has no data or spritesheet assigned..."),!1;const r=s.spriteSheet.sprites[this.spriteIndex];if(!r)return GM&&console.warn("Sprite not found",this.spriteIndex,s.spriteSheet.sprites),!1;if(this._currentSprite)this._currentSprite.geometry=ox.getOrCreateGeometry(r),this._currentSprite.material.map=r.texture;else{const o=new Qt({color:16777215,side:xi});if(Rbe&&(o.wireframe=!0),this.color&&(o.color||(o.color=new Ae),o.color.copy(this.color),o.opacity=this.color.alpha),o.transparent=!0,o.toneMapped=this.toneMapped,r.texture&&!o.wireframe){let a=r.texture;a[aO]!==void 0&&a[aO]!==this&&this.spriteFrames>1&&(a=r.texture=a.clone()),a[aO]=this,o.map=a}this.sharedMaterial=o,this._currentSprite=new pe(ox.getOrCreateGeometry(r),o),this._currentSprite.renderOrder=Math.round(this.renderOrder),mi.assignTextureLOD(o,0)}return this._currentSprite.parent!==this.gameObject&&(this.drawMode===2&&this._currentSprite.scale.set(this.size.x,this.size.y,1),this.gameObject&&this.gameObject.add(this._currentSprite)),this._currentSprite&&this._currentSprite.layers.set(this.layer),this.sharedMaterial&&(this.sharedMaterial.alphaTest=this.cutoutThreshold,this.sharedMaterial.transparent=this.transparent),this._currentSprite.castShadow=this.castShadows,s?.update(this.sharedMaterial),!0}}Xs([T()],Do.prototype,"drawMode",2),Xs([T(Ibe)],Do.prototype,"size",2),Xs([T(Ii)],Do.prototype,"color",2),Xs([T(Ft)],Do.prototype,"sharedMaterial",2),Xs([T()],Do.prototype,"transparent",2),Xs([T()],Do.prototype,"cutoutThreshold",2),Xs([T()],Do.prototype,"castShadows",2),Xs([T()],Do.prototype,"renderOrder",2),Xs([T()],Do.prototype,"toneMapped",2),Xs([T(ou)],Do.prototype,"sprite",1);const aZ=te("debugwebxr"),Lbe=new he().makeRotationY(Math.PI);class au extends Pe{constructor(){super(...arguments),p(this,"_arScale",1),p(this,"invertForward",!1),p(this,"customReticle"),p(this,"arTouchTransform",!0),p(this,"autoPlace",!1),p(this,"autoCenter",!1),p(this,"useXRAnchor",!1),p(this,"_isPlacing",!0),p(this,"_startOffset",new he),p(this,"_createdPlacementObject",null),p(this,"_reparentedComponents",[]),p(this,"_placementScene",new Ls),p(this,"_reticle",[]),p(this,"_hits",[]),p(this,"_placementStartTime",-1),p(this,"_rigPlacementMatrix"),p(this,"_anchor",null),p(this,"userInput"),p(this,"onPlaceScene",e=>{var i;if(this._isPlacing==!1||e!=null&&e.used)return;let s=this._reticle[0];if(!s){console.warn("No reticle to place...");return}if(!s.visible&&!this.autoPlace){console.warn("Reticle is not visible (can not place)");return}if((i=Et.active)!=null&&i.isTrackingImages){console.warn("Scene Placement is disabled while images are being tracked");return}let r=this._hits[0];if(e&&e.origin instanceof zP){const o=this._reticle[e.origin.index];o&&(s=o,r=this._hits[e.origin.index])}if(e&&(e.stopImmediatePropagation(),e.stopPropagation(),e.use()),this._isPlacing=!1,this.context.input.removeEventListener("pointerup",this.onPlaceScene),this.onRevertSceneChanges(),s.position.copy(s.lastPos),s.quaternion.copy(s.lastQuat),this.onApplyPose(s),this.useXRAnchor&&this.onCreateAnchor(Et.active,r),this.context.xr)for(const o of this.context.xr.controllers)o.cancelHitTestSource()}),p(this,"upVec",new E(0,1,0)),p(this,"lookPoint",new E),p(this,"worldUpVec",new E(0,1,0))}static onPlaced(e){const i="placed";return this._eventListeners[i]||(this._eventListeners[i]=[]),this._eventListeners[i].push(e),()=>{const s=this._eventListeners[i].indexOf(e);s>=0&&this._eventListeners[i].splice(s,1)}}get arScale(){return this._arScale}set arScale(e){e!==this._arScale&&(this._arScale=e,this.onScaleChanged())}onEnable(){var e;(e=this.customReticle)==null||e.preload()}supportsXR(e){return e==="immersive-ar"}onEnterXR(e){aZ&&console.log("ENTER WEBXR: SessionRoot start..."),this._anchor=null,this.gameObject.updateMatrixWorld(),this._startOffset.copy(this.gameObject.matrixWorld);const i=new ye;this._createdPlacementObject=i,i.name="AR Session Root",this._placementScene.name="AR Placement Scene",this._placementScene.children.length=0;for(let s=this.context.scene.children.length-1;s>=0;s--){const r=this.context.scene.children[s];this._placementScene.add(r)}if(this.context.scene.add(i),this.autoCenter){const s=Ba(this._placementScene.children),r=s.getCenter(new E),o=s.getSize(new E),a=new he;a.makeTranslation(r.x,r.y-o.y*.5,r.z),this._startOffset.multiply(a)}this._reparentedComponents.length=0,this._reparentedComponents.push({comp:this,originalObject:this.gameObject}),ie.addComponent(i,this);for(const s of this._reticle)ia(s);this._reticle.length=0,this._isPlacing=!0,this.context.input.addEventListener("pointerup",this.onPlaceScene,{queue:ea.Early})}onLeaveXR(){this.context.input.removeEventListener("pointerup",this.onPlaceScene,{queue:ea.Early}),this.onRevertSceneChanges(),this._anchor=null,this._rigPlacementMatrix=void 0}onUpdateXR(e){var i,s,r,o;if(e.xr.isTrackingImages){for(const a of this._reticle)a.visible=!1;return}if(this._isPlacing){const a=(i=e.xr.rig)==null?void 0:i.gameObject;a&&a.parent!==this.context.scene&&this.context.scene.add(a);let l=!1;if(e.xr.isPassThrough&&e.xr.controllers.length>0&&!this.autoPlace)for(const c of e.xr.controllers){const h=c.getHitTest();h&&(l=!0,this.updateReticleAndHits(e.xr,c.index,h,e.xr.rigScale))}if(!l){const c=e.xr.getHitTest();c&&this.updateReticleAndHits(e.xr,0,c,e.xr.rigScale)}}else{if(this._anchor&&e.xr.referenceSpace){const a=e.xr.frame.getPose(this._anchor.anchorSpace,e.xr.referenceSpace);if(a&&this.context.time.frame%20===0){const l=e.xr.convertSpace(a.transform),c=this._reticle[0];c&&(c.position.copy(l.position),c.quaternion.copy(l.quaternion),this.onApplyPose(c))}}if(this.arTouchTransform?(this.userInput||(this.userInput=new zM(this.context)),(s=this.userInput)==null||s.enable()):(r=this.userInput)==null||r.disable(),this.arTouchTransform&&(o=this.userInput)!=null&&o.hasChanged){if(e.xr.rig){const a=e.xr.rig.gameObject;this.userInput.applyMatrixTo(a.matrix,!0),a.matrix.decompose(a.position,a.quaternion,a.scale),this.userInput.factor=a.scale.x}this.userInput.reset()}}}updateReticleAndHits(e,i,s,r){this._hits[i]=s.hit;let o=this._reticle[i];if(!o){if(this.customReticle)if(this.customReticle.asset)o=h0(this.customReticle.asset);else{this.customReticle.loadAssetAsync();return}else o=new pe(new d1(.07,.09,32).rotateX(-Math.PI/2),new Qt({side:xi,depthTest:!1,depthWrite:!1,transparent:!0,opacity:1,color:15658734})),o.name="AR Placement Reticle";if(aZ){const a=new io(1);a.position.y+=.01,o.add(a)}this._reticle[i]=o,o.matrixAutoUpdate=!1,o.visible=!1}if(o.lastPos=o.lastPos||s.position.clone(),o.lastQuat=o.lastQuat||s.quaternion.clone(),o.position.copy(o.lastPos.lerp(s.position,this.context.time.deltaTime/.1)),o.lastPos.copy(o.position),o.quaternion.copy(o.lastQuat.slerp(s.quaternion,this.context.time.deltaTime/.05)),o.lastQuat.copy(o.quaternion),o.scale.set(r,r,r),this.customReticle&&this.applyViewBasedTransform(o),o.updateMatrix(),o.visible=!0,o.parent!==this.context.scene&&this.context.scene.add(o),this._placementStartTime<0&&(this._placementStartTime=this.context.time.realtimeSinceStartup),this.autoPlace)if(this.upVec.set(0,1,0).applyQuaternion(o.quaternion),this.upVec.dot(mt(0,1,0))>.9){let a=o["autoplace:timer"]||0;a>=1?(o.visible=!1,this.onPlaceScene(null)):(a+=this.context.time.deltaTime,o["autoplace:timer"]=a)}else o["autoplace:timer"]=0}onScaleChanged(){}onRevertSceneChanges(){var e;for(const i of this._reticle)i&&(i.visible=!1,i?.removeFromParent());this._reticle.length=0;for(let i=this._placementScene.children.length-1;i>=0;i--){const s=this._placementScene.children[i];this.context.scene.add(s)}(e=this._createdPlacementObject)==null||e.removeFromParent();for(const i of this._reparentedComponents)ie.addComponent(i.originalObject,i.comp)}async onCreateAnchor(e,i){if(i.createAnchor===void 0){console.warn("Hit does not support creating an anchor",i),Ye()&&zi("Hit does not support creating an anchor");return}else{const s=await i.createAnchor(e.viewerPose.transform);e.running&&s&&(this._anchor=s)}}applyViewBasedTransform(e){const i=this.context.mainCamera,s=e,r=i.worldPosition,o=s.worldPosition;this.upVec.set(0,1,0).applyQuaternion(e.quaternion);const a=i.worldPosition;a&&e.position.clone().sub(a).angleTo(this.upVec)<Math.PI/2&&this.upVec.negate();const l=this.upVec.angleTo(this.worldUpVec)*180/Math.PI,c=30;l>c&&l<180-c||l<-c&&l>-180+c?(this.lookPoint.copy(e.position).add(this.upVec),this.lookPoint.y=e.position.y,e.lookAt(this.lookPoint)):(r.y=o.y,e.lookAt(r))}onApplyPose(e){var i,s,r,o;const a=(s=(i=Et.active)==null?void 0:i.rig)==null?void 0:s.gameObject;if(!a){console.warn("No rig object to place");return}(r=Et.active)!=null&&r.rigScale;const l=a.parent||this.context.scene;this._rigPlacementMatrix?(o=this._rigPlacementMatrix)==null||o.decompose(a.position,a.quaternion,a.scale):this._rigPlacementMatrix=a.matrix.clone(),this.applyViewBasedTransform(e),e.updateMatrix(),this.context.scene.add(e),e.attach(a),e.removeFromParent(),a.scale.set(this.arScale,this.arScale,this.arScale),a.position.multiplyScalar(this.arScale),a.updateMatrix(),this.invertForward&&a.matrix.premultiply(Lbe),a.matrix.premultiply(this._startOffset),a.matrix.decompose(a.position,a.quaternion,a.scale),l.add(a)}}p(au,"_eventListeners",{});const lO=class{constructor(n){p(this,"oneFingerDrag",!0),p(this,"twoFingerRotate",!0),p(this,"twoFingerScale",!0),p(this,"factor",1),p(this,"context"),p(this,"offset"),p(this,"plane"),p(this,"_scale",1),p(this,"_hasChanged",!1),p(this,"_enabled",!1),p(this,"currentlyUsedPointerIds",new Set),p(this,"currentlyUnusedPointerIds",new Set),p(this,"onPointerDownEarly",e=>{this.isActive&&e.stopPropagation()}),p(this,"onPointerDownLate",e=>{e.used?this.currentlyUsedPointerIds.add(e.pointerId):this.currentlyUsedPointerIds.size<=0&&this.currentlyUnusedPointerIds.add(e.pointerId)}),p(this,"onPointerUpEarly",e=>{this.currentlyUsedPointerIds.delete(e.pointerId),this.currentlyUnusedPointerIds.delete(e.pointerId)}),p(this,"prev",new Map),p(this,"_didMultitouch",!1),p(this,"touchStart",e=>{if(!e.defaultPrevented)for(let i=0;i<e.changedTouches.length;i++){const s=e.changedTouches[i],r=xt.isAndroidDevice()&&s.clientY<window.innerHeight*.1;this.prev.has(s.identifier)||this.prev.set(s.identifier,{ignore:r,x:0,z:0,screenx:0,screeny:0});const o=this.prev.get(s.identifier);if(o){const a=this.getPositionOnPlane(s.clientX,s.clientY);o.x=a.x,o.z=a.z,o.screenx=s.clientX,o.screeny=s.clientY}}}),p(this,"touchEnd",e=>{e.touches.length<=0&&(this._didMultitouch=!1);for(let i=0;i<e.changedTouches.length;i++){const s=e.changedTouches[i];this.prev.delete(s.identifier)}}),p(this,"touchMove",e=>{if(!e.defaultPrevented&&this.isActive){if(e.touches.length===1){if(this._didMultitouch)return;const i=e.touches[0],s=this.prev.get(i.identifier);if(!s||s.ignore)return;const r=this.getPositionOnPlane(i.clientX,i.clientY),o=r.x-s.x,a=r.z-s.z;if(o===0&&a===0)return;this.oneFingerDrag&&this.addMovement(o,a),s.x=r.x,s.z=r.z,s.screenx=i.clientX,s.screeny=i.clientY;return}else if(e.touches.length===2){this._didMultitouch=!0;const i=e.touches[0],s=e.touches[1],r=this.prev.get(i.identifier),o=this.prev.get(s.identifier);if(!r||!o)return;if(this.twoFingerRotate){const a=Math.atan2(i.clientY-s.clientY,i.clientX-s.clientX),l=Math.atan2(r.screeny-o.screeny,r.screenx-o.screenx),c=a-l;Math.abs(c)>.001&&this.addRotation(c)}if(this.twoFingerScale){const a=i.clientX-s.clientX,l=i.clientY-s.clientY,c=Math.sqrt(a*a+l*l),h=r.screenx-o.screenx,u=r.screeny-o.screeny,d=Math.sqrt(h*h+u*u),m=c-d;Math.abs(m)>2&&this.addScale(m)}r.screenx=i.clientX,r.screeny=i.clientY,o.screenx=s.clientX,o.screeny=s.clientY}}}),p(this,"_raycaster",new Nu),p(this,"_intersection",new E),p(this,"_screenPos",new E),p(this,"_tempMatrix",new he),this.context=n,this.offset=new he,this.plane=new fs,this.plane.setFromNormalAndCoplanarPoint(lO.up,lO.zero)}reset(){this._scale=1,this.offset.identity()}get hasChanged(){return this._hasChanged}applyMatrixTo(n,e){this._hasChanged=!1,e?(this.offset.invert(),n.premultiply(this.offset)):n.multiply(this.offset)}get isActive(){return this.currentlyUsedPointerIds.size<=0&&this.currentlyUnusedPointerIds.size>0}enable(){this._enabled||(this._enabled=!0,this.context.input.addEventListener("pointerdown",this.onPointerDownEarly,{queue:ea.Early}),this.context.input.addEventListener("pointerdown",this.onPointerDownLate,{queue:ea.Late}),this.context.input.addEventListener("pointerup",this.onPointerUpEarly,{queue:ea.Early}),window.addEventListener("touchstart",this.touchStart,{passive:!1}),window.addEventListener("touchmove",this.touchMove,{passive:!1}),window.addEventListener("touchend",this.touchEnd,{passive:!1}))}disable(){this._enabled&&(this._enabled=!1,this.context.input.removeEventListener("pointerdown",this.onPointerDownEarly,{queue:ea.Early}),this.context.input.removeEventListener("pointerdown",this.onPointerDownLate,{queue:ea.Late}),this.context.input.removeEventListener("pointerup",this.onPointerUpEarly,{queue:ea.Early}),window.removeEventListener("touchstart",this.touchStart),window.removeEventListener("touchmove",this.touchMove),window.removeEventListener("touchend",this.touchEnd))}getPositionOnPlane(n,e){const i=this.context.mainCamera;return this._screenPos.x=n/window.innerWidth*2-1,this._screenPos.y=-(e/window.innerHeight)*2+1,this._screenPos.z=1,this._screenPos.unproject(i),this._raycaster.set(i.position,this._screenPos.sub(i.position)),this._raycaster.ray.intersectPlane(this.plane,this._intersection),this._intersection}addMovement(n,e){n/=this._scale,e/=this._scale,n*=this.factor,e*=this.factor,this.offset.elements[12]+=n,this.offset.elements[14]+=e,(n!==0||e!==0)&&(this._hasChanged=!0)}addScale(n){n/=window.innerWidth,n*=-1,this._scale*=1+n,this._tempMatrix.makeScale(1-n,1-n,1-n),this.offset.premultiply(this._tempMatrix),n!==0&&(this._hasChanged=!0)}addRotation(n){n*=-1,this._tempMatrix.makeRotationY(n),this.offset.premultiply(this._tempMatrix),n!==0&&(this._hasChanged=!0)}};let zM=lO;p(zM,"up",new E(0,1,0)),p(zM,"zero",new E(0,0,0)),p(zM,"one",new E(1,1,1));var Pbe=Object.defineProperty,Bbe=Object.getOwnPropertyDescriptor,J0=(n,e,i,s)=>{for(var r=s>1?void 0:s?Bbe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&Pbe(e,i,r),r};class Nc extends Pe{constructor(){super(...arguments),p(this,"position","bottom"),p(this,"showNeedleLogo",!0),p(this,"showSpatialMenu"),p(this,"createFullscreenButton"),p(this,"createMuteButton"),p(this,"createQRCodeButton")}onEnable(){this.applyOptions()}applyOptions(){this.context.menu.setPosition(this.position),this.context.menu.showNeedleLogo(this.showNeedleLogo),this.createFullscreenButton===!0&&this.context.menu.showFullscreenOption(!0),this.createMuteButton===!0&&this.context.menu.showAudioPlaybackOption(!0),this.showSpatialMenu===!0&&this.context.menu.showSpatialMenu(this.showSpatialMenu),this.createQRCodeButton===!0&&(xt.isMobileDevice()||this.context.menu.showQRCodeButton(!0))}}J0([T()],Nc.prototype,"position",2),J0([T()],Nc.prototype,"showNeedleLogo",2),J0([T()],Nc.prototype,"showSpatialMenu",2),J0([T()],Nc.prototype,"createFullscreenButton",2),J0([T()],Nc.prototype,"createMuteButton",2),J0([T()],Nc.prototype,"createQRCodeButton",2);const Dn={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function lZ(n){const e=await fetch(n);if(e.ok)return e.json();throw new Error(e.statusText)}async function kbe(n){if(!n)throw new Error("No basePath supplied");return await lZ(`${n}/profilesList.json`)}async function Dbe(n,e,i=null,s=!0){if(!n)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No basePath supplied");const r=await kbe(e);let o;if(n.profiles.some(c=>{const h=r[c];return h&&(o={profileId:c,profilePath:`${e}/${h.path}`,deprecated:!!h.deprecated}),!!o}),!o){if(!i)throw new Error("No matching profile name found");const c=r[i];if(!c)throw new Error(`No matching profile name found and default profile "${i}" missing.`);o={profileId:i,profilePath:`${e}/${c.path}`,deprecated:!!c.deprecated}}const a=await lZ(o.profilePath);let l;if(s){let c;if(n.handedness==="any"?c=a.layouts[Object.keys(a.layouts)[0]]:c=a.layouts[n.handedness],!c)throw new Error(`No matching handedness, ${n.handedness}, in profile ${o.profileId}`);c.assetPath&&(l=o.profilePath.replace("profile.json",c.assetPath))}return{profile:a,assetPath:l}}const Obe={xAxis:0,yAxis:0,button:0,state:Dn.ComponentState.DEFAULT};function Gbe(n=0,e=0){let i=n,s=e;if(Math.sqrt(n*n+e*e)>1){const r=Math.atan2(e,n);i=Math.cos(r),s=Math.sin(r)}return{normalizedXAxis:i*.5+.5,normalizedYAxis:s*.5+.5}}class zbe{constructor(e){this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===Dn.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(Obe)}updateFromComponent({xAxis:e,yAxis:i,button:s,state:r}){const{normalizedXAxis:o,normalizedYAxis:a}=Gbe(e,i);switch(this.componentProperty){case Dn.ComponentProperty.X_AXIS:this.value=this.states.includes(r)?o:.5;break;case Dn.ComponentProperty.Y_AXIS:this.value=this.states.includes(r)?a:.5;break;case Dn.ComponentProperty.BUTTON:this.value=this.states.includes(r)?s:0;break;case Dn.ComponentProperty.STATE:this.valueNodeProperty===Dn.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(r):this.value=this.states.includes(r)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class Fbe{constructor(e,i){if(!e||!i||!i.visualResponses||!i.gamepadIndices||Object.keys(i.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=e,this.type=i.type,this.rootNodeName=i.rootNodeName,this.touchPointNodeName=i.touchPointNodeName,this.visualResponses={},Object.keys(i.visualResponses).forEach(s=>{const r=new zbe(i.visualResponses[s]);this.visualResponses[s]=r}),this.gamepadIndices=Object.assign({},i.gamepadIndices),this.values={state:Dn.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=Dn.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&e.buttons.length>this.gamepadIndices.button){const i=e.buttons[this.gamepadIndices.button];this.values.button=i.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,i.pressed||this.values.button===1?this.values.state=Dn.ComponentState.PRESSED:(i.touched||this.values.button>Dn.ButtonTouchThreshold)&&(this.values.state=Dn.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===Dn.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>Dn.AxisTouchThreshold&&(this.values.state=Dn.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===Dn.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>Dn.AxisTouchThreshold&&(this.values.state=Dn.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(i=>{i.updateFromComponent(this.values)})}}class Nbe{constructor(e,i,s){if(!e)throw new Error("No xrInputSource supplied");if(!i)throw new Error("No profile supplied");this.xrInputSource=e,this.assetUrl=s,this.id=i.profileId,this.layoutDescription=i.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(r=>{const o=this.layoutDescription.components[r];this.components[r]=new Fbe(r,o)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const e=[];return Object.values(this.components).forEach(i=>{e.push(i.data)}),e}updateFromGamepad(){Object.values(this.components).forEach(e=>{e.updateFromGamepad(this.xrInputSource.gamepad)})}}const Ube="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",Vbe="generic-trigger";let Xbe=class extends ye{constructor(){super(),this.motionController=null,this.envMap=null}setEnvironmentMap(n){return this.envMap==n?this:(this.envMap=n,this.traverse(e=>{e.isMesh&&(e.material.envMap=this.envMap,e.material.needsUpdate=!0)}),this)}updateMatrixWorld(n){super.updateMatrixWorld(n),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(e=>{Object.values(e.visualResponses).forEach(i=>{const{valueNode:s,minNode:r,maxNode:o,value:a,valueNodeProperty:l}=i;s&&(l===Dn.VisualResponseProperty.VISIBILITY?s.visible=a:l===Dn.VisualResponseProperty.TRANSFORM&&(s.quaternion.slerpQuaternions(r.quaternion,o.quaternion,a),s.position.lerpVectors(r.position,o.position,a)))})}))}};function Wbe(n,e){Object.values(n.components).forEach(i=>{const{type:s,touchPointNodeName:r,visualResponses:o}=i;if(s===Dn.ComponentType.TOUCHPAD)if(i.touchPointNode=e.getObjectByName(r),i.touchPointNode){const a=new al(.001),l=new Qt({color:255}),c=new pe(a,l);i.touchPointNode.add(c)}else console.warn(`Could not find touch dot, ${i.touchPointNodeName}, in touchpad component ${i.id}`);Object.values(o).forEach(a=>{const{valueNodeName:l,minNodeName:c,maxNodeName:h,valueNodeProperty:u}=a;if(u===Dn.VisualResponseProperty.TRANSFORM){if(a.minNode=e.getObjectByName(c),a.maxNode=e.getObjectByName(h),!a.minNode){console.warn(`Could not find ${c} in the model`);return}if(!a.maxNode){console.warn(`Could not find ${h} in the model`);return}}a.valueNode=e.getObjectByName(l),a.valueNode||console.warn(`Could not find ${l} in the model`)})})}function cZ(n,e){Wbe(n.motionController,e),n.envMap&&e.traverse(i=>{i.isMesh&&(i.material.envMap=n.envMap,i.material.needsUpdate=!0)}),n.layers.mask!=0&&e.traverse(i=>{i.layers.mask=n.layers.mask}),n.add(e)}class Hbe{constructor(e=null,i=null){this.gltfLoader=e,this.path=Ube,this._assetCache={},this.onLoad=i,this.gltfLoader||(this.gltfLoader=new Fh)}setPath(e){return this.path=e,this}createControllerModel(e){const i=new Xbe;let s=null;return e.addEventListener("connected",r=>{const o=r.data;o.targetRayMode!=="tracked-pointer"||!o.gamepad||Dbe(o,this.path,Vbe).then(({profile:a,assetPath:l})=>{i.motionController=new Nbe(o,a,l);const c=this._assetCache[i.motionController.assetUrl];if(c)s=c.scene.clone(),cZ(i,s),this.onLoad&&this.onLoad(s);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(i.motionController.assetUrl,h=>{this._assetCache[i.motionController.assetUrl]=h,s=h.scene.clone(),cZ(i,s),this.onLoad&&this.onLoad(s)},null,()=>{throw new Error(`Asset ${i.motionController.assetUrl} missing or malformed.`)})}}).catch(a=>{console.warn(a)})}),e.addEventListener("disconnected",()=>{i.motionController=null,i.remove(s),s=null}),i}}const jbe="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/";class Qbe{constructor(e,i,s,r,o=null,a=null){this.controller=i,this.handModel=e,this.bones=[],o===null&&(o=new Fh,o.setPath(s||jbe)),o.load(`${r}.glb`,l=>{const c=l.scene.children[0];this.handModel.add(c),c.layers.mask=this.handModel.layers.mask;const h=c.getObjectByProperty("type","SkinnedMesh");h.frustumCulled=!1,h.castShadow=!0,h.receiveShadow=!0,["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"].forEach(u=>{const d=c.getObjectByName(u);d!==void 0?d.jointName=u:console.warn(`Couldn't find ${u} in ${r} hand mesh`),this.bones.push(d)}),a&&a(c)})}updateMesh(){const e=this.controller.joints;for(let i=0;i<this.bones.length;i++){const s=this.bones[i];if(s){const r=e[s.jointName];if(r.visible){const o=r.position;s.position.copy(o),s.quaternion.copy(r.quaternion)}}}}}var Zbe=Object.defineProperty,Ybe=Object.getOwnPropertyDescriptor,FM=(n,e,i,s)=>{for(var r=s>1?void 0:s?Ybe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&Zbe(e,i,r),r};const Uc=te("debugwebxr"),Zd=new Array;class Vc extends Pe{constructor(){super(...arguments),p(this,"createControllerModel",!0),p(this,"createHandModel",!0),p(this,"customLeftHand"),p(this,"customRightHand"),p(this,"_models",new Array)}supportsXR(e){return e==="immersive-vr"||e==="immersive-ar"}async onXRControllerAdded(e){var i,s,r;if(!(e.xr.isVR||e.xr.isPassThrough))return;const{controller:o}=e;if(Uc&&console.warn("Add Controller Model for",o.side,o.index),this.createControllerModel||this.createHandModel){if(o.hand){if(this.createHandModel){const a=await this.loadHandModel(o);if(!a||!o.connected||!o.isHand){(i=a?.handObject)==null||i.removeFromParent(),(r=(s=a?.handmesh)==null?void 0:s.controller)==null||r.removeFromParent();return}this._models.push({controller:o,model:a.handObject,handmesh:a.handmesh}),this._models.sort((l,c)=>l.controller.index-c.controller.index),this.scene.add(a.handObject),o.model=a.handObject}}else if(this.createControllerModel){const a=await o.getModelUrl();if(a){const l=await this.loadModel(o,a);if(!l||!o.connected||o.isHand)return;this._models.push({controller:o,model:l}),this._models.sort((c,h)=>c.controller.index-h.controller.index),this.scene.add(l),l.traverse(c=>{c.layers.set(2),c.matrixWorldAutoUpdate=!1,c.matrixAutoUpdate=!1,c.updateMatrix()}),o.model=l}else o.targetRayMode!=="transient-pointer"&&console.warn("XRControllerModel: no model found for "+o.side)}}}onXRControllerRemoved(e){var i;const s=this._models.findIndex(o=>o.controller===e.controller),r=this._models[s];r&&(this._models.splice(s,1),r.handmesh&&((i=r.handmesh.handModel)==null||i.removeFromParent(),r.handmesh=void 0),r.model&&(r.model.removeFromParent(),r.model=void 0))}onBeforeRender(){if(Et.active&&(Uc&&(Zd[0]=Date.now()),this.updateRendering(Et.active),Uc)){const e=Date.now()-Zd[0];Zd.push(e),Zd.length>=30&&(Zd[0]=0,Zd.reduce((i,s)=>i+s,0)/Zd.length,Zd.length=0)}}onLeaveXR(e){var i;for(const s of this._models)s&&((i=s.model)==null||i.removeFromParent(),s.controller.model===s.model&&(s.controller.model=null));this._models.length=0}updateRendering(e){var i,s,r,o,a;for(let l=0;l<this._models.length;l++){const c=this._models[l];if(!c)continue;const h=c.controller;if(!h.connected){Uc&&console.warn("XRControllerModel.onUpdateXR: controller is not connected anymore",h.side,h.hand);continue}if(c.model&&!c.handmesh)c.model.matrixAutoUpdate=!1,c.model.matrixWorldAutoUpdate=!1,c.model.matrix.copy(h.gripMatrix),c.model.visible=h.isTracking,(i=e.rig)==null||i.gameObject.add(c.model);else if(h.inputSource.hand&&c.handmesh){const u=e.referenceSpace,d=this.context.renderer.xr.getHand(h.index);if(u&&e.frame.getJointPose){for(const m of h.inputSource.hand.values()){const f=d.joints[m.jointName];if(f){const g=h.getHandJointPose(m);if(g){const y=g.transform.position,v=g.transform.orientation;f.position.copy(y),f.quaternion.copy(v),f.matrixAutoUpdate=!1,f.matrixWorldAutoUpdate=!1}f.visible=g!=null}}c.model&&(c.model.visible=h.isTracking,c.model.visible&&c.model.parent!==((s=e.rig)==null?void 0:s.gameObject)&&((r=e.rig)==null||r.gameObject.add(c.model))),(o=c.model)!=null&&o.visible&&((a=c.handmesh)==null||a.updateMesh(),c.model.matrixWorldAutoUpdate=!1,c.model.matrixAutoUpdate=!1,c.model.matrix.identity(),c.model.applyMatrix4($g))}}}}async loadModel(e,i){var s;if(!e.connected)return console.warn("XRControllerModel.onXRControllerAdded: controller is not connected anymore",e.side),null;const r=await ei.getOrCreate("",i).instantiate();return ek(r),(s=Et.active)!=null&&s.isPassThrough&&r.traverseVisible(o=>{this.makeOccluder(o)}),r}async loadHandModel(e){const i=this.context,s=i.renderer.xr.getHand(e.index);s||(Uc?ft.DrawLabel(e.rayWorldPosition,"No hand found for index "+e.index,.05,5):console.warn("No hand found for index "+e.index));const r=new Fh;GC(r,i),await qD(r,i,this.sourceId??""),r.setPath("https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/");const o=e.side==="left"?"left.":"right.",a=e.side==="left"?this.customLeftHand:this.customRightHand;if(a)if(!a.url.includes(o))console.warn("XRControllerModel: custom hand model must be named "+o),zi("Custom Hand: unexpected name, please see the console for details");else{const h=a.url.substring(0,a.url.indexOf(o));r.setPath(h),Uc&&console.log("XRControllerModel: loading custom hand model from "+h)}const l=new ye;ek(l);const c=new Qbe(l,s,r.path,e.inputSource.handedness,r,h=>{h.traverse(u=>{var d;u.layers.set(2),(d=Et.active)!=null&&d.isPassThrough&&!a&&this.makeOccluder(u),u instanceof pe&&mi.assignMeshLOD(u,0)}),e.connected||(Uc&&ft.DrawLabel(e.rayWorldPosition,"Hand is loaded but not connected anymore",.05,5),h.removeFromParent())});if(Uc&&l.add(new io(.5)),e.inputSource.hand){Uc&&console.log(e.inputSource.hand);for(const h of e.inputSource.hand.values())if(s.joints[h.jointName]===void 0){const u=new Vn;u.matrixAutoUpdate=!1,u.visible=!0,s.joints[h.jointName]=u,s.add(u)}}else Uc&&ft.DrawLabel(e.rayWorldPosition,"No inputSource.hand found for index "+e.index,.05,5);return{handObject:l,handmesh:c}}makeOccluder(e){if(e instanceof pe){let i=e.material;i instanceof Ft&&(i=e.material=i.clone(),i.depthWrite=!0,i.depthTest=!0,i.colorWrite=!1,e.receiveShadow=!1,e.renderOrder=-100)}}}p(Vc,"factory",new Hbe),FM([T()],Vc.prototype,"createControllerModel",2),FM([T()],Vc.prototype,"createHandModel",2),FM([T(ei)],Vc.prototype,"customLeftHand",2),FM([T(ei)],Vc.prototype,"customRightHand",2);const hZ=new Wt,NM=new E;class uZ extends Qw{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const e=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],i=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],s=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(s),this.setAttribute("position",new st(e,3)),this.setAttribute("uv",new st(i,2))}applyMatrix4(e){const i=this.attributes.instanceStart,s=this.attributes.instanceEnd;return i!==void 0&&(i.applyMatrix4(e),s.applyMatrix4(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let i;e instanceof Float32Array?i=e:Array.isArray(e)&&(i=new Float32Array(e));const s=new qw(i,6,1);return this.setAttribute("instanceStart",new Ho(s,3,0)),this.setAttribute("instanceEnd",new Ho(s,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let i;e instanceof Float32Array?i=e:Array.isArray(e)&&(i=new Float32Array(e));const s=new qw(i,6,1);return this.setAttribute("instanceColorStart",new Ho(s,3,0)),this.setAttribute("instanceColorEnd",new Ho(s,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new U2(e.geometry)),this}fromLineSegments(e){const i=e.geometry;return this.setPositions(i.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Wt);const e=this.attributes.instanceStart,i=this.attributes.instanceEnd;e!==void 0&&i!==void 0&&(this.boundingBox.setFromBufferAttribute(e),hZ.setFromBufferAttribute(i),this.boundingBox.union(hZ))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new tn),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,i=this.attributes.instanceEnd;if(e!==void 0&&i!==void 0){const s=this.boundingSphere.center;this.boundingBox.getCenter(s);let r=0;for(let o=0,a=e.count;o<a;o++)NM.fromBufferAttribute(e,o),r=Math.max(r,s.distanceToSquared(NM)),NM.fromBufferAttribute(i,o),r=Math.max(r,s.distanceToSquared(NM));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}Ve.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new Y(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},Js.line={uniforms:Kf.merge([Ve.common,Ve.fog,Ve.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );
				vec3 worldUp = normalize( cross( worldDir, tmpFwd ) );
				vec3 worldFwd = cross( worldDir, worldUp );
				worldPos = position.y < 0.5 ? start: end;

				// height offset
				float hw = linewidth * 0.5;
				worldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// cap extension
					worldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;

					// add width to the box
					worldPos.xyz += worldFwd * hw;

					// endcaps
					if ( position.y > 1.0 || position.y < 0.0 ) {

						worldPos.xyz -= worldFwd * 2.0 * hw;

					}

				#endif

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class cO extends kt{constructor(e){super({type:"LineMaterial",uniforms:Kf.clone(Js.line.uniforms),vertexShader:Js.line.vertexShader,fragmentShader:Js.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(e)}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(e){e===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(e){this.uniforms.linewidth&&(this.uniforms.linewidth.value=e)}get dashed(){return"USE_DASH"in this.defines}set dashed(e){e===!0!==this.dashed&&(this.needsUpdate=!0),e===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(e){this.uniforms.dashScale.value=e}get dashSize(){return this.uniforms.dashSize.value}set dashSize(e){this.uniforms.dashSize.value=e}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(e){this.uniforms.dashOffset.value=e}get gapSize(){return this.uniforms.gapSize.value}set gapSize(e){this.uniforms.gapSize.value=e}get opacity(){return this.uniforms.opacity.value}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get resolution(){return this.uniforms.resolution.value}set resolution(e){this.uniforms.resolution.value.copy(e)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(e){this.defines&&(e===!0!==this.alphaToCoverage&&(this.needsUpdate=!0),e===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1))}}const dZ=new E,pZ=new E,pr=new Ze,mr=new Ze,Xc=new Ze,hO=new E,uO=new he,fr=new jo,mZ=new E,UM=new Wt,VM=new tn,Wc=new Ze;let Hc,Jm;function fZ(n,e,i){return Wc.set(0,0,-e,1).applyMatrix4(n.projectionMatrix),Wc.multiplyScalar(1/Wc.w),Wc.x=Jm/i.width,Wc.y=Jm/i.height,Wc.applyMatrix4(n.projectionMatrixInverse),Wc.multiplyScalar(1/Wc.w),Math.abs(Math.max(Wc.x,Wc.y))}function Kbe(n,e){const i=n.matrixWorld,s=n.geometry,r=s.attributes.instanceStart,o=s.attributes.instanceEnd,a=Math.min(s.instanceCount,r.count);for(let l=0,c=a;l<c;l++){fr.start.fromBufferAttribute(r,l),fr.end.fromBufferAttribute(o,l),fr.applyMatrix4(i);const h=new E,u=new E;Hc.distanceSqToSegment(fr.start,fr.end,u,h),u.distanceTo(h)<Jm*.5&&e.push({point:u,pointOnLine:h,distance:Hc.origin.distanceTo(u),object:n,face:null,faceIndex:l,uv:null,uv1:null})}}function Jbe(n,e,i){const s=e.projectionMatrix,r=n.material.resolution,o=n.matrixWorld,a=n.geometry,l=a.attributes.instanceStart,c=a.attributes.instanceEnd,h=Math.min(a.instanceCount,l.count),u=-e.near;Hc.at(1,Xc),Xc.w=1,Xc.applyMatrix4(e.matrixWorldInverse),Xc.applyMatrix4(s),Xc.multiplyScalar(1/Xc.w),Xc.x*=r.x/2,Xc.y*=r.y/2,Xc.z=0,hO.copy(Xc),uO.multiplyMatrices(e.matrixWorldInverse,o);for(let d=0,m=h;d<m;d++){if(pr.fromBufferAttribute(l,d),mr.fromBufferAttribute(c,d),pr.w=1,mr.w=1,pr.applyMatrix4(uO),mr.applyMatrix4(uO),pr.z>u&&mr.z>u)continue;if(pr.z>u){const b=pr.z-mr.z,A=(pr.z-u)/b;pr.lerp(mr,A)}else if(mr.z>u){const b=mr.z-pr.z,A=(mr.z-u)/b;mr.lerp(pr,A)}pr.applyMatrix4(s),mr.applyMatrix4(s),pr.multiplyScalar(1/pr.w),mr.multiplyScalar(1/mr.w),pr.x*=r.x/2,pr.y*=r.y/2,mr.x*=r.x/2,mr.y*=r.y/2,fr.start.copy(pr),fr.start.z=0,fr.end.copy(mr),fr.end.z=0;const f=fr.closestPointToPointParameter(hO,!0);fr.at(f,mZ);const g=oi.lerp(pr.z,mr.z,f),y=g>=-1&&g<=1,v=hO.distanceTo(mZ)<Jm*.5;if(y&&v){fr.start.fromBufferAttribute(l,d),fr.end.fromBufferAttribute(c,d),fr.start.applyMatrix4(o),fr.end.applyMatrix4(o);const b=new E,A=new E;Hc.distanceSqToSegment(fr.start,fr.end,A,b),i.push({point:A,pointOnLine:b,distance:Hc.origin.distanceTo(A),object:n,face:null,faceIndex:d,uv:null,uv1:null})}}}class qbe extends pe{constructor(e=new uZ,i=new cO({color:Math.random()*16777215})){super(e,i),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,i=e.attributes.instanceStart,s=e.attributes.instanceEnd,r=new Float32Array(2*i.count);for(let a=0,l=0,c=i.count;a<c;a++,l+=2)dZ.fromBufferAttribute(i,a),pZ.fromBufferAttribute(s,a),r[l]=l===0?0:r[l-1],r[l+1]=r[l]+dZ.distanceTo(pZ);const o=new qw(r,2,1);return e.setAttribute("instanceDistanceStart",new Ho(o,1,0)),e.setAttribute("instanceDistanceEnd",new Ho(o,1,1)),this}raycast(e,i){const s=this.material.worldUnits,r=e.camera;r===null&&!s&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const o=e.params.Line2!==void 0&&e.params.Line2.threshold||0;Hc=e.ray;const a=this.matrixWorld,l=this.geometry,c=this.material;Jm=c.linewidth+o,l.boundingSphere===null&&l.computeBoundingSphere(),VM.copy(l.boundingSphere).applyMatrix4(a);let h;if(s)h=Jm*.5;else{const d=Math.max(r.near,VM.distanceToPoint(Hc.origin));h=fZ(r,d,c.resolution)}if(VM.radius+=h,Hc.intersectsSphere(VM)===!1)return;l.boundingBox===null&&l.computeBoundingBox(),UM.copy(l.boundingBox).applyMatrix4(a);let u;if(s)u=Jm*.5;else{const d=Math.max(r.near,UM.distanceToPoint(Hc.origin));u=fZ(r,d,c.resolution)}UM.expandByScalar(u),Hc.intersectsBox(UM)!==!1&&(s?Kbe(this,i):Jbe(this,r,i))}}class gZ extends uZ{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const i=e.length-3,s=new Float32Array(2*i);for(let r=0;r<i;r+=3)s[2*r]=e[r],s[2*r+1]=e[r+1],s[2*r+2]=e[r+2],s[2*r+3]=e[r+3],s[2*r+4]=e[r+4],s[2*r+5]=e[r+5];return super.setPositions(s),this}setColors(e){const i=e.length-3,s=new Float32Array(2*i);for(let r=0;r<i;r+=3)s[2*r]=e[r],s[2*r+1]=e[r+1],s[2*r+2]=e[r+2],s[2*r+3]=e[r+3],s[2*r+4]=e[r+4],s[2*r+5]=e[r+5];return super.setColors(s),this}fromLine(e){const i=e.geometry;return this.setPositions(i.attributes.position.array),this}}class $be extends qbe{constructor(e=new gZ,i=new cO({color:Math.random()*16777215})){super(e,i),this.isLine2=!0,this.type="Line2"}}class XM extends Pe{}var eAe=Object.defineProperty,tAe=Object.getOwnPropertyDescriptor,Yd=(n,e,i,s)=>{for(var r=s>1?void 0:s?tAe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&eAe(e,i,r),r};const dO=te("debugwebxr");class fa extends Pe{constructor(){super(...arguments),p(this,"movementSpeed",1.5),p(this,"rotationStep",30),p(this,"useTeleport",!0),p(this,"usePinchToTeleport",!0),p(this,"useTeleportTarget",!1),p(this,"useTeleportFade",!1),p(this,"showRays",!0),p(this,"showHits",!0),p(this,"isXRMovementHandler",!0),p(this,"xrSessionMode","immersive-vr"),p(this,"_didApplyRotation",!1),p(this,"_didTeleport",!1),p(this,"_teleportBuffer",new Array),p(this,"_plane",null),p(this,"_lines",[]),p(this,"_hitDiscs",[]),p(this,"_hitDistances",[]),p(this,"_lastHitDistances",[]),p(this,"hitPointRaycastFilter",e=>e.type==="SkinnedMesh"?"continue in children":!0)}onUpdateXR(e){const i=e.xr.rig;if(!(i!=null&&i.gameObject)||e.xr.isPassThrough)return;const s=e.xr.leftController,r=e.xr.rightController;s&&this.onHandleMovement(s,i.gameObject),r&&(this.onHandleRotation(r,i.gameObject),this.useTeleport&&this.onHandleTeleport(r,i.gameObject))}onLeaveXR(e){for(const i of this._lines)i.removeFromParent();for(const i of this._hitDiscs)i?.removeFromParent()}onBeforeRender(){var e;(e=this.context.xr)!=null&&e.running&&(this.showRays&&this.renderRays(this.context.xr),this.showHits&&this.renderHits(this.context.xr))}onHandleMovement(e,i){const s=e.getStick("xr-standard-thumbstick");if(s.x!=0||s.y!=0){const r=mt(s.x,0,s.y);r.multiplyScalar(this.context.time.deltaTimeUnscaled*this.movementSpeed);const o=Qi(i);r.multiplyScalar(o.x),r.applyQuaternion(e.xr.poseOrientation),r.y=0,r.applyQuaternion(i.worldQuaternion),i.position.add(r),i.updateWorldMatrix(!1,!1);for(const a of i.children)a.updateWorldMatrix(!1,!1)}}onHandleRotation(e,i){if(e._isMxInk)return;const s=e.getStick("xr-standard-thumbstick").x;if(this._didApplyRotation)Math.abs(s)<.3&&(this._didApplyRotation=!1);else if(Math.abs(s)>.5){this._didApplyRotation=!0;const r=s>0?1:-1,o=zt(this.context.mainCamera).clone();i.rotateY(r*tt.toRadians(this.rotationStep));const a=zt(this.context.mainCamera).clone().sub(o);a.y=0,i.position.sub(a)}}onHandleTeleport(e,i){var s,r,o,a,l;let c=0;if(e.hand&&this.usePinchToTeleport&&e.isTeleportGesture){const h=e.getPointerId("primary");if(h!=null&&this.context.input.getIsPointerIdInUse(h))return;const u=e.getGesture("pinch");u&&(c=u.value)}else c=(s=e.getStick("xr-standard-thumbstick"))==null?void 0:s.y;if(this._didTeleport)c>=0&&c<.4?this._didTeleport=!1:c<0&&c>-.4&&(this._didTeleport=!1);else if(c>.8){this._didTeleport=!0;const h=this.context.physics.raycastFromRay(e.ray)[0];if(h&&h.object instanceof yg){const d=(r=h.normal)==null?void 0:r.dot(mt(0,1,0));if(d!==void 0&&d<.4)return}let u=h?.point;if(!u&&!this.useTeleportTarget){this._plane||(this._plane=new fs(new E(0,1,0),0));const d=i.worldPosition;this._plane.setFromNormalAndCoplanarPoint(new E(0,1,0),d);const m=e.ray;u=d.clone(),this._plane.intersectLine(new jo(m.origin,mt(m.direction).multiplyScalar(1e4).add(m.origin)),u),u.distanceTo(d)>i.scale.x*10&&(u=null)}if(u){if(this.useTeleportTarget&&!ie.getComponentInParent(h.object,XM))return;const d=u.clone();if(dO&&ft.DrawSphere(u,.025,16711680,5),(o=this.context.mainCamera)==null?void 0:o.position){const m=(a=this.context.xr)==null?void 0:a.getUserOffsetInRig();m&&(m.y=0,d.sub(m),dO&&ft.DrawWireSphere(m.add(d),.025,65280,5))}this._teleportBuffer.push(i.matrix.clone()),this._teleportBuffer.length>10&&this._teleportBuffer.shift(),this.useTeleportFade?(l=e.xr.fadeTransition())==null||l.then(()=>{i.worldPosition=d}):i.worldPosition=d}}else if(c<-.8&&(this._didTeleport=!0,this._teleportBuffer.length>0)){const h=this._teleportBuffer.pop();h&&h.decompose(i.position,i.quaternion,i.scale)}}renderRays(e){var i;for(let s=0;s<this._lines.length;s++){const r=this._lines[s];r&&(r.visible=!1)}for(let s=0;s<e.controllers.length;s++){const r=e.controllers[s];let o=this._lines[s];if(!r.connected||!r.isTracking||!r.ray||r.targetRayMode==="transient-pointer"||!r.hasSelectEvent){o&&(o.visible=!1);continue}o||(o=this.createRayLineObject(),o.scale.z=.5,this._lines[s]=o),r.updateRayWorldPosition(),r.updateRayWorldQuaternion();const a=r.rayWorldPosition,l=r.rayWorldQuaternion;o.position.copy(a),o.quaternion.copy(l);const c=e.rigScale,h=this.usePinchToTeleport&&r.isTeleportGesture,u=this._lastHitDistances[s],d=this._hitDistances[s]!=null,m=u??c;o.scale.set(c,c,m),o.visible=!0,o.layers.disableAll(),o.layers.enable(2);let f=o.material.opacity;h?f=1:this.showHits&&m<e.rigScale*.5?f=0:(i=r.getButton("primary"))!=null&&i.pressed?f=.5:f=d?.2:.1,o.material.opacity=tt.lerp(o.material.opacity,f,this.context.time.deltaTimeUnscaled/.1),o.parent!==this.context.scene&&this.context.scene.add(o)}}renderHits(e){var i;for(const s of this._hitDiscs){if(!s)continue;const r=s.controller;if(!r||!r.connected||!r.isTracking){s.visible=!1;continue}}for(let s=0;s<e.controllers.length;s++){const r=e.controllers[s];if(!r.connected||!r.isTracking||!r.ray||!r.hasSelectEvent)continue;let o=this._hitDiscs[s],a=!0;const l=r.getPointerId("primary");l!=null&&this.context.input.getIsPointerIdInUse(l)&&(o&&(o.visible=!1),this._hitDistances[s]=null,this._lastHitDistances[s]=0,a=!1);const c=this.context.time.smoothedFps>=59?1:10;if((this.context.time.frame+r.index)%c!==0&&(a=!1),!a){const d=this._hitDiscs[s];d&&d.visible&&d.hit&&this.updateHitPointerPosition(r,d,d.hit.distance);continue}const h=this.context.physics.raycastFromRay(r.ray,{testObject:this.hitPointRaycastFilter,precise:!1});let u=h.find(d=>this.usePinchToTeleport&&r.isTeleportGesture?!0:this.isObjectWithInteractiveComponent(d.object));if(u||(u=h[0]),o&&(o.controller=r,o.hit=u),this._hitDistances[s]=u?.distance||null,u){this._lastHitDistances[s]=u.distance;const d=e.rigScale??1;dO&&(ft.DrawWireSphere(u.point,.025*d,16711680),ft.DrawLabel(mt(0,.2,0).add(u.point),u.object.name,.02,0)),o||(o=this.createHitPointObject(),this._hitDiscs[s]=o),o.hit=u,o.visible=u.distance>d*.05;let m=.01*(d+u.distance);const f=(i=r.getButton("primary"))==null?void 0:i.pressed;f&&(m*=1.1),o.scale.set(m,m,m),o.layers.set(2);let g=o.material.opacity;if(f?g=1:g=u.distance<.15*d?.2:.6,o.material.opacity=tt.lerp(o.material.opacity,g,this.context.time.deltaTimeUnscaled/.1),o.visible){if(u.normal){this.updateHitPointerPosition(r,o,u.distance);const y=u.normal.applyQuaternion(ki(u.object));o.quaternion.setFromUnitVectors(iAe,y)}else this.updateHitPointerPosition(r,o,u.distance);o.parent!==this.context.scene&&this.context.scene.add(o)}}else this._hitDiscs[s]&&(this._hitDiscs[s].visible=!1)}}isObjectWithInteractiveComponent(e,i=0){return qC(e)||e.isUI===!0?!0:e.isScene?!1:e.parent?this.isObjectWithInteractiveComponent(e.parent,i+1):!1}updateHitPointerPosition(e,i,s){const r=mt(e.rayWorldPosition);r.add(mt(0,0,s-.01).applyQuaternion(e.rayWorldQuaternion)),i.position.lerp(r,this.context.time.deltaTimeUnscaled/.05)}createHitPointObject(){const e=new pe(new al(.3,6,6),new Qt({color:15658734,opacity:.7,transparent:!0,depthTest:!1,depthWrite:!1,side:xi}));return e.layers.disableAll(),e.layers.enable(2),e}createRayLineObject(){const e=new $be;e.layers.disableAll(),e.layers.enable(2);const i=new gZ;e.geometry=i;const s=new Float32Array(9);s.set([0,0,.02,0,0,.4,0,0,1]),i.setPositions(s);const r=new Float32Array(9);r.set([1,1,1,.1,.1,.1,0,0,0]),i.setColors(r);const o=new cO({color:16777215,vertexColors:!0,worldUnits:!0,linewidth:.004,transparent:!0,depthWrite:!1,blending:bp,dashed:!1});return e.material=o,e}}Yd([T()],fa.prototype,"movementSpeed",2),Yd([T()],fa.prototype,"rotationStep",2),Yd([T()],fa.prototype,"useTeleport",2),Yd([T()],fa.prototype,"usePinchToTeleport",2),Yd([T()],fa.prototype,"useTeleportTarget",2),Yd([T()],fa.prototype,"useTeleportFade",2),Yd([T()],fa.prototype,"showRays",2),Yd([T()],fa.prototype,"showHits",2);const iAe=new E(0,1,0);var nAe=Object.defineProperty,sAe=Object.getOwnPropertyDescriptor,Ws=(n,e,i,s)=>{for(var r=s>1?void 0:s?sAe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&nAe(e,i,r),r};const WM=te("debugwebxr"),rAe=te("debugusdz");var pO;const q0=(pO=class extends Pe{constructor(){super(...arguments),p(this,"createVRButton",!0),p(this,"createARButton",!0),p(this,"createSendToQuestButton",!0),p(this,"createQRCode",!0),p(this,"useDefaultControls",!0),p(this,"showControllerModels",!0),p(this,"showHandModels",!0),p(this,"usePlacementReticle",!0),p(this,"customARPlacementReticle"),p(this,"usePlacementAdjustment",!0),p(this,"arScale",1),p(this,"useXRAnchor",!1),p(this,"autoPlace",!0),p(this,"autoCenter",!0),p(this,"useQuicklookExport",!1),p(this,"useDepthSensing",!1),p(this,"useSpatialGrab",!0),p(this,"defaultAvatar"),p(this,"_playerSync"),p(this,"_createdComponentsInSession",[]),p(this,"_usdzExporter"),p(this,"_exitXRMenuButton"),p(this,"_previousXRState",0),p(this,"_spatialGrabRaycaster"),p(this,"onAvatarSpawned",n=>{WM&&console.log("WebXR.onAvatarSpawned",n),ie.getComponentInChildren(n,Dd)??(t=ie.addComponent(n,Dd))}),p(this,"_buttonFactory"),p(this,"_buttons",[])}awake(){Et.getXRSync(this.context)}onEnable(){var n,e;window.location.protocol!=="https:"&&zi('<a href="https://developer.mozilla.org/en-US/docs/Web/API/WebXR_Device_API" target="_blank">WebXR</a> only works on secure connections (https).'),this.useQuicklookExport&&(ie.findObjectOfType(Gn)||(WM&&console.log("WebXR: Adding USDZExporter"),this._usdzExporter=ie.addComponent(this.gameObject,Gn),this._usdzExporter.objectToExport=this.context.scene,this._usdzExporter.autoExportAnimations=!0,this._usdzExporter.autoExportAudioSources=!0)),this.handleCreatingHTML(),this.handleOfferSession(),this.defaultAvatar===!0&&(WM&&console.warn("WebXR: No default avatar set, using static default avatar"),this.defaultAvatar=new ei("https://cdn.needle.tools/static/avatars/DefaultAvatar.glb")),this.defaultAvatar&&(this._playerSync=this.gameObject.getOrAddComponent(L0),this._playerSync.autoSync=!1),this._playerSync&&typeof this.defaultAvatar!="boolean"&&(this._playerSync.asset=this.defaultAvatar,(n=this._playerSync.onPlayerSpawned)==null||n.removeEventListener(this.onAvatarSpawned),(e=this._playerSync.onPlayerSpawned)==null||e.addEventListener(this.onAvatarSpawned))}onDisable(){var n;(n=this._usdzExporter)==null||n.destroy(),this.removeButtons()}async handleOfferSession(){return this.createVRButton&&await Et.isVRSupported()&&this.createVRButton?Et.offerSession("immersive-vr","default",this.context):this.createARButton&&await Et.isARSupported()&&this.createARButton?Et.offerSession("immersive-ar","default",this.context):!1}get session(){return Et.active??null}get sessionMode(){return Et.activeMode??null}async enterVR(n){return Et.start("immersive-vr",n,this.context)}async enterAR(n){return Et.start("immersive-ar",n,this.context)}exitXR(){Et.stop()}get isActiveWebXR(){return!q0.activeWebXRComponent||q0.activeWebXRComponent===this}onBeforeXR(n,e){var i;if(!this.isActiveWebXR){console.warn(`WebXR: another WebXR component is already active (${(i=q0.activeWebXRComponent)==null?void 0:i.name}). This is ignored: ${this.name}`);return}q0.activeWebXRComponent=this,n=="immersive-ar"&&this.useDepthSensing&&(e.optionalFeatures=e.optionalFeatures||[],e.optionalFeatures.push("depth-sensing"))}async onEnterXR(n){if(!this.isActiveWebXR)return;WM&&console.log("WebXR onEnterXR"),this._previousXRState=yo.Global.Mask;const e=n.xr.isVR;if(yo.Global.Set(e?Rc.VR:Rc.AR),this.usePlacementReticle&&n.xr.isAR){let i=ie.findObjectOfType(au);if(!i){const s=new ye;for(const r of this.context.scene.children)s.add(r);this.context.scene.add(s),i=ie.addComponent(s,au),this._createdComponentsInSession.push(i)}i.customReticle=this.customARPlacementReticle,i.arScale=this.arScale,i.arTouchTransform=this.usePlacementAdjustment,i.autoPlace=this.autoPlace,i.autoCenter=this.autoCenter,i.useXRAnchor=this.useXRAnchor}this.useDefaultControls&&this.setDefaultMovementEnabled(!0),(this.showControllerModels||this.showHandModels)&&this.setDefaultControllerRenderingEnabled(!0),this.useSpatialGrab&&(this._spatialGrabRaycaster=ie.findObjectOfType(E0)??void 0,this._spatialGrabRaycaster||(this._spatialGrabRaycaster=this.gameObject.addComponent(E0))),this.createLocalAvatar(n.xr),n.xr.isScreenBasedAR||(this._exitXRMenuButton=this.context.menu.appendChild({label:"Quit XR",onClick:()=>this.exitXR(),icon:"exit_to_app",priority:2e4}))}onUpdateXR(n){this.isActiveWebXR&&this._spatialGrabRaycaster&&(this._spatialGrabRaycaster.enabled=this.useSpatialGrab)}onLeaveXR(n){var e,i;if((e=this._exitXRMenuButton)==null||e.remove(),!!this.isActiveWebXR){yo.Global.Set(this._previousXRState),(i=this._playerSync)==null||i.destroyInstance();for(const s of this._createdComponentsInSession)s.destroy();this._createdComponentsInSession.length=0,this.handleOfferSession(),a_(1).then(()=>q0.activeWebXRComponent=null)}}setDefaultMovementEnabled(n){let e=this.gameObject.getComponent(fa);return!e&&n&&(e=this.gameObject.addComponent(fa),this._createdComponentsInSession.push(e)),e&&(e.enabled=n),e}setDefaultControllerRenderingEnabled(n){let e=this.gameObject.getComponent(Vc);return!e&&n&&(e=this.gameObject.addComponent(Vc),this._createdComponentsInSession.push(e),e.createControllerModel=this.showControllerModels,e.createHandModel==this.showHandModels),e&&(e.enabled=n),e}async createLocalAvatar(n){this._playerSync&&n.running&&typeof this.defaultAvatar!="boolean"&&(this._playerSync.asset=this.defaultAvatar,await this._playerSync.getInstance())}getButtonsContainer(){return this.getButtonsFactory()}getButtonsFactory(){return this._buttonFactory||(this._buttonFactory=Km.getOrCreate()),this._buttonFactory}handleCreatingHTML(){if(this.createARButton||this.createVRButton||this.useQuicklookExport){if((xt.isiOS()&&xt.isSafari()||rAe)&&this.useQuicklookExport){const n=ie.findObjectOfType(Gn);if(!n||n&&n.allowCreateQuicklookButton){const e=this.getButtonsFactory().createQuicklookButton();this.addButton(e,50)}}if(this.createARButton){const n=this.getButtonsFactory().createARButton();this.addButton(n,50)}if(this.createVRButton){const n=this.getButtonsFactory().createVRButton();this.addButton(n,50)}}if(this.createSendToQuestButton&&!xt.isQuest()&&Et.isVRSupported().then(n=>{if(!n){const e=this.getButtonsFactory().createSendToQuestButton();this.addButton(e,50)}}),this.createQRCode){const n=rC(Nc);if(n&&n.createQRCodeButton===!1)Ye()&&console.warn("WebXR: QRCode button is disabled in the Needle Menu component");else{const e=Xh.getOrCreate().createQRCode();this.addButton(e,50)}}}addButton(n,e){this._buttons.push(n),n.setAttribute("priority",e.toString()),this.context.menu.appendChild(n)}removeButtons(){for(const n of this._buttons)n.remove();this._buttons.length=0}},p(pO,"activeWebXRComponent",null),pO);let On=q0;Ws([T()],On.prototype,"createVRButton",2),Ws([T()],On.prototype,"createARButton",2),Ws([T()],On.prototype,"createSendToQuestButton",2),Ws([T()],On.prototype,"createQRCode",2),Ws([T()],On.prototype,"useDefaultControls",2),Ws([T()],On.prototype,"showControllerModels",2),Ws([T()],On.prototype,"showHandModels",2),Ws([T()],On.prototype,"usePlacementReticle",2),Ws([T(ei)],On.prototype,"customARPlacementReticle",2),Ws([T()],On.prototype,"usePlacementAdjustment",2),Ws([T()],On.prototype,"arScale",2),Ws([T()],On.prototype,"useXRAnchor",2),Ws([T()],On.prototype,"autoPlace",2),Ws([T()],On.prototype,"autoCenter",2),Ws([T()],On.prototype,"useQuicklookExport",2),Ws([T()],On.prototype,"useDepthSensing",2),Ws([T()],On.prototype,"useSpatialGrab",2),Ws([T(ei)],On.prototype,"defaultAvatar",2);class HM{get extensionName(){return"Physics"}onExportObject(e,i,s){const r=ie.getComponents(e,Li).filter(c=>c.enabled),o=ie.getComponents(e,ha).filter(c=>c.enabled&&!c.isTrigger);let a=r.length>0?r[0]:null;const l=o.length>0?o[0]:null;l&&!a&&(a=new Li,a.isKinematic=!0),a&&i.addEventListener("serialize",(c,h)=>{var u,d,m;if(a){if(c.appendLine(),c.beginBlock('def RealityKitComponent "RigidBody"',"{",!0),a.useGravity||c.appendLine("bool gravityEnabled = 0"),c.appendLine('uniform token info:id = "RealityKit.RigidBody"'),a.isKinematic&&c.appendLine('token motionType = "Kinematic"'),c.beginBlock('def RealityKitStruct "massFrame"',"{",!0),c.appendLine(`float m_mass = ${a.mass}`),c.beginBlock('def RealityKitStruct "m_pose"',"{",!0),c.appendLine(`float3 position = (${a.centerOfMass.x}, ${a.centerOfMass.y}, ${a.centerOfMass.z})`),c.closeBlock("}"),c.closeBlock("}"),o.length>0){const f=o[0];c.beginBlock('def RealityKitStruct "material"',"{",!0);const g=f.sharedMaterial;g&&g.dynamicFriction!==void 0&&c.appendLine(`double dynamicFriction = ${(u=f.sharedMaterial)==null?void 0:u.dynamicFriction}`),g&&g.bounciness!==void 0&&c.appendLine(`double restitution = ${(d=f.sharedMaterial)==null?void 0:d.bounciness}`),g&&g.staticFriction!==void 0&&c.appendLine(`double staticFriction = ${(m=f.sharedMaterial)==null?void 0:m.staticFriction}`),c.closeBlock("}")}c.closeBlock("}")}}),l&&(i.addEventListener("serialize",(c,h)=>{var u;c.beginBlock('def RealityKitComponent "Collider"',"{",!0),c.appendLine("uint group = 1"),c.appendLine('uniform token info:id = "RealityKit.Collider"'),c.appendLine("uint mask = 4294967295");const d=l.isTrigger?"Trigger":"Default";if(c.appendLine(`token type = "${d}"`),c.beginBlock('def RealityKitStruct "Shape"',"{",!0),l instanceof D0){const m=l;c.appendLine('token shapeType = "Sphere"'),c.appendLine(`float radius = ${m.radius}`)}else if(l instanceof O0){const m=l;c.appendLine('token shapeType = "Box"'),c.appendLine(`float3 extent = (${m.size.x}, ${m.size.y}, ${m.size.z})`)}else if(l instanceof qh){const m=l;c.appendLine('token shapeType = "Capsule"'),c.appendLine(`float radius = ${m.radius}`),c.appendLine(`float height = ${m.height}`)}else if(l instanceof Nm&&(u=l.sharedMesh)!=null&&u.geometry){const m=l.sharedMesh.geometry;m.boundingBox||m.computeBoundingBox();const f=l.sharedMesh.geometry.boundingBox;f&&(c.appendLine('token shapeType = "Box"'),c.appendLine(`float3 extent = (${f.max.x-f.min.x}, ${f.max.y-f.min.y}, ${f.max.z-f.min.z})`),console.log("[USDZ] Only Box, Sphere, and Capsule colliders are supported in visionOS/iOS. MeshCollider will be exported as Box",l))}else console.warn("[USDZ] Only Box, Sphere, and Capsule colliders are supported in visionOS/iOS. Ignoring collider:",l);c.beginBlock('def RealityKitStruct "pose"',"{",!0),c.closeBlock("}"),c.closeBlock("}"),c.closeBlock("}")}),o.length>1&&console.log("WARNING: Multiple colliders detected. visionOS / iOS can only support objects with a single collider, only exporting the first collider: ",l))}}var oAe=Object.defineProperty,aAe=Object.getOwnPropertyDescriptor,lu=(n,e,i,s)=>{for(var r=s>1?void 0:s?aAe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&oAe(e,i,r),r};const qm=te("debugtext");var Ss=(n=>(n[n.UpperLeft=0]="UpperLeft",n[n.UpperCenter=1]="UpperCenter",n[n.UpperRight=2]="UpperRight",n[n.MiddleLeft=3]="MiddleLeft",n[n.MiddleCenter=4]="MiddleCenter",n[n.MiddleRight=5]="MiddleRight",n[n.LowerLeft=6]="LowerLeft",n[n.LowerCenter=7]="LowerCenter",n[n.LowerRight=8]="LowerRight",n))(Ss||{}),yZ=(n=>(n[n.Normal=0]="Normal",n[n.Bold=1]="Bold",n[n.Italic=2]="Italic",n[n.BoldAndItalic=3]="BoldAndItalic",n))(yZ||{});class Vr extends Vm{constructor(){super(...arguments),p(this,"alignment",0),p(this,"verticalOverflow",0),p(this,"horizontalOverflow",0),p(this,"lineSpacing",1),p(this,"supportRichText",!1),p(this,"font"),p(this,"fontStyle",0),p(this,"sRGBTextColor",new Ae(1,0,1)),p(this,"_text",""),p(this,"_fontSize",12),p(this,"_textMeshUi",null),p(this,"_didHandleTextRenderOnTop",!1)}setAlphaFactor(e){var i;super.setAlphaFactor(e),(i=this.uiObject)==null||i.set({fontOpacity:this.color.alpha*this.alphaFactor}),this.markDirty()}get text(){return this._text}set text(e){e!==this._text&&(this._text=e,this.feedText(this.text,this.supportRichText),this.markDirty())}set_text(e){this.text=e}get fontSize(){return this._fontSize}set fontSize(e){var i;this._fontSize=e,(i=this.uiObject)==null||i.set({fontSize:e})}onColorChanged(){var e;this.sRGBTextColor.copy(this.color),this.sRGBTextColor.convertLinearToSRGB(),(e=this.uiObject)==null||e.set({color:this.sRGBTextColor,fontOpacity:this.color.alpha})}onParentRectTransformChanged(){super.onParentRectTransformChanged(),this.uiObject&&this.updateOverflow()}onBeforeCanvasRender(e){this.updateOverflow()}updateOverflow(){var e;const i=(e=this.uiObject)==null?void 0:e._overflow;i&&(i._needsUpdate=!0)}onCreate(e){qm&&console.log(this),this.horizontalOverflow==1&&(e.whiteSpace="pre"),this.verticalOverflow==0&&(this.context.renderer.localClippingEnabled=!0,e.overflow="hidden"),this.horizontalOverflow==1&&this.verticalOverflow==0,e.lineHeight=this.lineSpacing,delete e.backgroundOpacity,delete e.backgroundColor,qm&&(e.backgroundColor=16750848,e.backgroundOpacity=.5);const i=this.rectTransform;e={...e,...this.getTextOpts()},this.getAlignment(e),qm&&(e.backgroundColor=Math.random()*16777215,e.backgroundOpacity=.1),this.uiObject=i.createNewText(e),this.feedText(this.text,this.supportRichText)}onAfterAddedToScene(){super.onAfterAddedToScene(),this.handleTextRenderOnTop()}getTextOpts(){const e=this.fontSize,i={color:this.color,fontOpacity:this.color.alpha,fontSize:e,fontKerning:"normal"};return this.setFont(i,this.fontStyle),i}onEnable(){var e;super.onEnable(),this._didHandleTextRenderOnTop=!1,this.uiObject&&this.uiObject.addAfterUpdate(()=>{this.setShadowComponentOwner(this.uiObject),this.markDirty()}),setTimeout(()=>this.markDirty(),10),(e=this.canvas)==null||e.registerEventReceiver(this)}onDisable(){var e;super.onDisable(),(e=this.canvas)==null||e.unregisterEventReceiver(this)}getAlignment(e){switch(e.flexDirection="column",this.alignment){case 0:case 3:case 6:e.textAlign="left";break;case 1:case 4:case 7:e.textAlign="center";break;case 2:case 5:case 8:e.textAlign="right";break}switch(this.alignment){default:case 0:case 1:case 2:e.alignItems="start";break;case 3:case 4:case 5:e.alignItems="center";break;case 6:case 7:case 8:e.alignItems="end";break}return e}feedText(e,i){var s,r,o;if(qm&&console.log("feedText",this.uiObject,e,i),!!this.uiObject)if(this._textMeshUi||(this._textMeshUi=[]),this.uiObject.children.length=0,!i||e.length===0)this.uiObject.textContent=e;else{let a=this.getNextTag(e);if(a){if(a.startIndex>0){for(let h=this.uiObject.children.length-1;h>=0;h--){const u=this.uiObject.children[h];u.isUI&&(this.uiObject.remove(u),u.clear())}const c=new __({textContent:e.substring(0,a.startIndex),color:"inherit"});this.uiObject.add(c)}}else{this.uiObject.textContent="",this.setOptions({textContent:e});return}const l=[];for(;a;){const c=this.getNextTag(e,a.endIndex),h={fontFamily:(s=this.uiObject)==null?void 0:s.get("fontFamily"),color:"inherit",textContent:""};if(c){h.textContent=this.getText(e,a,c),this.handleTag(a,h,l);const u=new __(h);(r=this.uiObject)==null||r.add(u)}else{h.textContent=e.substring(a.endIndex),this.handleTag(a,h,l);const u=new __(h);(o=this.uiObject)==null||o.add(u)}a=c}}}handleTextRenderOnTop(){this._didHandleTextRenderOnTop||(this._didHandleTextRenderOnTop=!0,this.startCoroutine(this.renderOnTopCoroutine()))}*renderOnTopCoroutine(){if(!this.canvas)return;const e=[],i=this.canvas,s={renderOnTop:i.renderOnTop,depthWrite:i.depthWrite,doubleSided:i.doubleSided};for(;;){let r=!1;if(this._textMeshUi)for(let o=0;o<this._textMeshUi.length;o++){if(e[o]===!0)continue;r=!0;const a=this._textMeshUi[o];a.textContent&&(sM(a,s),e[o]=!0)}if(!r)break;yield}}handleTag(e,i,s){if(!e.isEndTag){if(e.type.includes("color")){const r=new mO(e,{color:i.color});if(s.push(r),e.type.length>6){const o=parseInt("0x"+e.type.substring(7));i.color=o}else i.color=new Ae(1,1,1)}else if(e.type=="b"){this.setFont(i,1);const r=new mO(e,{fontWeight:700});s.push(r)}else if(e.type=="i"){this.setFont(i,2);const r=new mO(e,{fontStyle:"italic"});s.push(r)}}}getText(e,i,s){return e.substring(i.endIndex,s.startIndex)}getNextTag(e,i=0){const s=e.indexOf("<",i),r=e.indexOf(">",s);if(s>=0&&r>=0){const o=e.substring(s+1,r);return{type:o,startIndex:s,endIndex:r+1,isEndTag:o.startsWith("/")}}return null}setFont(e,i){if(!this.font)return;const s=this.font,r=this.getFamilyNameWithCorrectSuffix(s,i);qm&&console.log("Selected font family:"+r);let o=ZI.getFontFamily(r);switch(o||(o=ZI.addFontFamily(r)),e.fontFamily=o,i){default:case 0:e.fontWeight=400,e.fontStyle="normal";break;case 1:e.fontWeight=700,e.fontStyle="normal";break;case 2:e.fontWeight=400,e.fontStyle="italic";break;case 3:e.fontStyle="italic",e.fontWeight=400}let a=o.getVariant(e.fontWeight,e.fontStyle);if(!a){let l=r;l!=null&&l.endsWith("-msdf.json")||(l+="-msdf.json");let c=r;c!=null&&c.endsWith(".png")||(c+=".png"),a=o.addVariant(e.fontWeight,e.fontStyle,l,c),a?.addEventListener("ready",()=>{this.markDirty()})}}getFamilyNameWithCorrectSuffix(e,i){var s;const r=e.lastIndexOf("-");if(r<0)return e;const o=(s=e.substring(r+1))==null?void 0:s.toLowerCase();if(lAe.includes(o))return qm&&console.warn("Unsupported font style: "+o),e;const a=e.lastIndexOf("/");let l=e;a>=0&&(l=l.substring(a+1));const c=l[0]===l[0].toUpperCase(),h=e.substring(0,r);switch(qm&&console.log("Select font: ",e,yZ[i],l,c,h),i){case 0:return c?h+"-Regular":h+"-regular";case 1:return c?h+"-Bold":h+"-bold";case 2:return c?h+"-Italic":h+"-italic";case 3:return c?h+"-BoldItalic":h+"-bolditalic";default:return e}}}lu([T()],Vr.prototype,"alignment",2),lu([T()],Vr.prototype,"verticalOverflow",2),lu([T()],Vr.prototype,"horizontalOverflow",2),lu([T()],Vr.prototype,"lineSpacing",2),lu([T()],Vr.prototype,"supportRichText",2),lu([T(URL)],Vr.prototype,"font",2),lu([T()],Vr.prototype,"fontStyle",2),lu([T()],Vr.prototype,"text",1),lu([T()],Vr.prototype,"fontSize",1);class mO{constructor(e,i){p(this,"tag"),p(this,"previousValues"),this.tag=e,this.previousValues=i}}const lAe=["medium","mediumitalic","black","blackitalic","thin","thinitalic","extrabold","light","lightitalic","semibold"];class Kd{constructor(e){p(this,"id"),p(this,"content",""),p(this,"font",[]),p(this,"pointSize",144),p(this,"width"),p(this,"height"),p(this,"depth"),p(this,"wrapMode"),p(this,"horizontalAlignment"),p(this,"verticalAlignment"),p(this,"material"),this.id=e}static getId(){return this.global_id++}setDepth(e){return this.depth=e,this}setPointSize(e){return this.pointSize=e,this}setHorizontalAlignment(e){return this.horizontalAlignment=e,this}setVerticalAlignment(e){return this.verticalAlignment=e,this}writeTo(e,i){var s;i.beginBlock(`def Preliminary_Text "${this.id}"`,"(",!1),i.appendLine('prepend apiSchemas = ["MaterialBindingAPI"]'),i.closeBlock(")"),i.beginBlock(),this.content&&i.appendLine(`string content = "${this.content}"`),(!this.font||this.font.length<=0)&&(this.font||(this.font=[]),(s=this.font)==null||s.push("sans-serif"));const r=this.font.map(o=>`"${o}"`).join(", ");i.appendLine(`string[] font = [ ${r} ]`),i.appendLine(`double pointSize = ${this.pointSize}`),typeof this.width=="number"&&i.appendLine(`double width = ${this.width}`),typeof this.height=="number"&&i.appendLine(`double height = ${this.height}`),typeof this.depth=="number"&&i.appendLine(`double depth = ${this.depth}`),this.wrapMode&&i.appendLine(`token wrapMode = "${this.wrapMode}"`),this.horizontalAlignment&&i.appendLine(`token horizontalAlignment = "${this.horizontalAlignment}"`),this.verticalAlignment&&i.appendLine(`token verticalAlignment = "${this.verticalAlignment}"`),this.material!==void 0&&i.appendLine(`rel material:binding = </StageRoot/Materials/${Vk(this.material)}>`),i.closeBlock()}}p(Kd,"global_id",0);class jM{static singleLine(e,i,s){const r=new Kd("text_"+Kd.getId());return r.content=e,i&&(r.pointSize=i),s&&(r.depth=s),r}static multiLine(e,i,s,r,o,a){const l=new Kd("text_"+Kd.getId());return l.content=e,l.width=i,l.height=s,l.horizontalAlignment=r,l.verticalAlignment=o,a!==void 0&&(l.wrapMode=a),l}}const cAe=new he().makeRotationY(Math.PI),hAe=new he().makeScale(-1,1,-1);class ax{get extensionName(){return"text"}exportText(e,i,s){const r=ie.getComponent(e,Vr);if(!r)return;const o=ie.getComponent(e,Ur);let a=100,l=100;o&&(a=o.width,l=o.height);const c=cAe.clone();o&&c.premultiply(hAe),i.setMatrix(c);const h=r.color.clone();i.material=new vs({color:h,emissive:h}),i.addEventListener("serialize",(u,d)=>{let m=r.text;m=m.replace(/\r/g,""),m=m.replace(/\n/g,"\\n");const f=jM.multiLine(m,a,l,"center","bottom","flowing");this.setTextAlignment(f,r.alignment),this.setOverflow(f,r),i.material&&(f.material=i.material),f.pointSize=this.convertToTextSize(r.fontSize),f.depth=.001,f.writeTo(void 0,u)})}convertToTextSize(e){return 1/.0502*144*e}setOverflow(e,i){i.horizontalOverflow?e.wrapMode="singleLine":e.wrapMode="flowing"}setTextAlignment(e,i){switch(i){case Ss.LowerLeft:case Ss.MiddleLeft:case Ss.UpperLeft:e.horizontalAlignment="left";break;case Ss.LowerCenter:case Ss.MiddleCenter:case Ss.UpperCenter:e.horizontalAlignment="center";break;case Ss.LowerRight:case Ss.MiddleRight:case Ss.UpperRight:e.horizontalAlignment="right";break}switch(i){case Ss.LowerLeft:case Ss.LowerCenter:case Ss.LowerRight:e.verticalAlignment="bottom";break;case Ss.MiddleLeft:case Ss.MiddleCenter:case Ss.MiddleRight:e.verticalAlignment="middle";break;case Ss.UpperLeft:case Ss.UpperCenter:case Ss.UpperRight:e.verticalAlignment="top";break}}}class QM{get extensionName(){return"tmui"}onExportObject(e,i,s){const r=ie.getComponent(e,cr);if(r&&r.enabled&&r.renderMode===kQ.WorldSpace){const o=new ax,a=ie.getComponent(e,Ur),l=ie.getComponent(e,Nd),c=new Array;if(a){if(!ie.isActiveSelf(e)){const d=ie.isActiveSelf(e);ie.setActive(e,!0),a.onEnable(),a.updateTransform(),c.push(()=>{a.onDisable(),ie.setActive(e,d)})}e.traverse(d=>{if(!ie.isActiveInHierarchy(d)){const m=ie.isActiveSelf(d);ie.setActive(d,!0);const f=ie.getComponent(d,cl);f&&(f.onEnable(),c.push(()=>{f.onDisable()}));const g=ie.getComponent(d,Ur);g&&(g.onEnable(),g.updateTransform(),g.onApplyTransform(),c.push(()=>{g.onDisable()}));const y=ie.getComponent(d,Vr);y&&(y.onEnable(),c.push(()=>{y.onDisable()})),c.push(()=>{ie.setActive(d,m)})}}),a.width,a.height;const h=po.createEmpty(),u=a.shadowComponent;if(i.add(h),u){const d=u.matrix;h.setMatrix(d);const m=new Map,f=new Map;m.set(u,h),f.set(u,l?l.alpha:1),u.traverse(g=>{if(g===u)return;const y=po.createEmpty();y.setMatrix(g.matrix);const v=g.parent,b=!!v&&typeof v.textContent=="string"&&v.textContent.length>0;let A=f.get(v)||1;const x=ie.getComponent(g,Nd);if(x&&(A*=x.alpha),g instanceof pe&&b){const _=g[Za];_?o.exportText(_.gameObject,y,s):console.error("Error when exporting UI: shadow component owner not found. This is likely a bug.",g)}if(g instanceof pe&&!b){const _=g.geometry.clone();_.scale(1,1,-1),this.flipWindingOrder(_),y.geometry=_;const S=new Ae,M=g.material.opacity;S.copy(g.material.color),y.material=new Qt({color:S,opacity:M*A,map:g.material.map,transparent:!0})}m.set(g,y),f.set(g,A);const w=m.get(v);if(!w){console.error("Error when exporting UI: shadow component parent not found!",g,g.parent);return}w.add(y)})}}for(const h of c)h()}}flipWindingOrder(e){const i=e.index.array;for(let s=0,r=i.length/3;s<r;s++){const o=i[s*3];i[s*3]=i[s*3+2],i[s*3+2]=o}e.index.needsUpdate=!0}}const lx=te("debugusdz");function uAe(n,e){var i;const s=[],r=ie.getComponentsInChildren(n,rr),o=ie.getComponentsInChildren(n,Fr),a=new Array,l=new Array;if(e.injectImplicitBehaviours)for(const c of r){if(!c||!c.runtimeAnimatorController||!c.enabled)continue;const h=c.runtimeAnimatorController.activeState;if(!h||!h.motion||!h.motion.clip||((i=h.motion.clip.tracks)==null?void 0:i.length)<1||a.includes(c))continue;const u=new jm;u.animator=c,u.stateName=h.name,u.trigger="start",u.name="PlayAnimationOnClick_implicitAtStart_"+u.stateName;const d=new ye;ie.addComponent(d,u),l.push(d),a.push(c),n.add(d)}else for(const c of r){if(!c||!c.runtimeAnimatorController||!c.enabled)continue;lx&&console.log(c);const h=[];for(const u of c.runtimeAnimatorController.enumerateActions()){lx&&console.log(u);const d=u.getClip();h.includes(d)||h.push(d)}s.push({root:c.gameObject,clips:h})}if(e.injectImplicitBehaviours)for(const c of o){if(!c||!c.clip||!c.enabled||!c.playAutomatically||a.includes(c))continue;const h=new jm;h.animation=c,h.stateName=c.clip.name,h.trigger="start",h.name="PlayAnimationOnClick_implicitAtStart_"+h.stateName;const u=new ye;ie.addComponent(u,h),l.push(u),a.push(c),n.add(u)}else for(const c of o){lx&&console.log(c);const h=[];for(const u of c.animations)h.includes(u)||h.push(u);s.push({root:c.gameObject,clips:h})}lx&&s?.length>0&&console.log("USDZ Animation Clips without behaviours",s);for(const c of s)for(const h of c.clips)e.registerAnimation(c.root,h);return l}function dAe(n,e){const i=ie.getComponentsInChildren(n,Sn),s=ie.getComponentsInChildren(n,Ud),r=new Array,o=new Array;lx&&console.log({audioSources:i,playAudioOnClicks:s});for(const a of s){if(!a.target)continue;const l=i.indexOf(a.target);l>-1&&i.splice(l,1)}for(const a of i){if(!a||!a.clip||a.volume<=0||r.includes(a))continue;const l=new Ud;l.target=a,l.name="PlayAudioOnClick_implicitAtStart_",l.trigger="start";const c=new ye;ie.addComponent(c,l),console.log("implicit PlayAudioOnStart",c,l),o.push(c),r.push(a),n.add(c)}return o}function pAe(n){return new Gs("DisableAtStart",zs.sceneStartTrigger(),bi.fadeAction(n,0,!1))}function vZ(n,e){const i=n.domElement.shadowRoot.querySelector("link[rel='ar']");if(i)return i;const s=document.createElement("div");s.classList.add("menu"),s.classList.add("quicklook-menu"),s.style.display="none",s.style.visibility="hidden";const r=document.createElement("button");r.id="open-in-ar",e?(r.innerText="View in AR",r.title="View this scene in AR. The scene will be exported to USDZ and opened with Apple's QuickLook."):(r.innerText="Download for AR",r.title="Download this scene for AR. Open the downloaded USDZ file to view it in AR using Apple's QuickLook."),s.appendChild(r);const o=document.createElement("a");o.id="needle-usdz-link",o.style.display="none",o.rel="ar",o.href="",o.target="_blank",s.appendChild(o);const a=document.createElement("img");return a.id="button",o.appendChild(a),n.domElement.shadowRoot.appendChild(s),o}var mAe=Object.defineProperty,fAe=Object.getOwnPropertyDescriptor,Xr=(n,e,i,s)=>{for(var r=s>1?void 0:s?fAe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&mAe(e,i,r),r};const ga=te("debugusdz"),gAe=te("debugusdzpruning");class Jd{constructor(){p(this,"callToAction"),p(this,"checkoutTitle"),p(this,"checkoutSubtitle"),p(this,"callToActionURL")}}Xr([T()],Jd.prototype,"callToAction",2),Xr([T()],Jd.prototype,"checkoutTitle",2),Xr([T()],Jd.prototype,"checkoutSubtitle",2),Xr([T()],Jd.prototype,"callToActionURL",2);var ZM;const fO=(ZM=class extends Pe{constructor(){super(...arguments),p(this,"objectToExport"),p(this,"autoExportAnimations",!0),p(this,"autoExportAudioSources",!0),p(this,"exportFileName"),p(this,"customUsdzFile"),p(this,"customBranding"),p(this,"anchoringType","plane"),p(this,"maxTextureSize",2048),p(this,"planeAnchoringAlignment","horizontal"),p(this,"interactive",!0),p(this,"allowCreateQuicklookButton",!0),p(this,"quickLookCompatible",!0),p(this,"extensions",[]),p(this,"link"),p(this,"button"),p(this,"onClickedOpenInARElement",n=>{n.preventDefault(),this.exportAndOpen()}),p(this,"_currentExportTasks",new Map),p(this,"_previousTimeScale",1),p(this,"lastCallback"),p(this,"_rootSessionRootWasAppliedTo",null),p(this,"_rootPositionBeforeExport",new E),p(this,"_rootRotationBeforeExport",new Se),p(this,"_rootScaleBeforeExport",new E)}start(){var n,e,i;ga&&(console.log("USDZExporter",this),console.log("Debug USDZ Mode. Press 'T' to export"),window.addEventListener("keydown",s=>{switch(s.key){case"t":this.exportAndOpen();break}})),this.objectToExport||(this.objectToExport=this.gameObject),!((e=(n=this.objectToExport)==null?void 0:n.children)!=null&&e.length)&&!((i=this.objectToExport)!=null&&i.isMesh)&&(this.objectToExport=this.context.scene),this.interactive&&(this.extensions.push(new fM),this.extensions.push(new mp),this.extensions.push(new HM),this.extensions.push(new ax),this.extensions.push(new QM))}onEnable(){var n;const e=xt.supportsQuickLookAR(),i=xt.isiOS()||xt.isiPad();!this.button&&(ga||e||i)&&(this.allowCreateQuicklookButton&&(this.button=this.createQuicklookButton()),this.lastCallback=this.quicklookCallback.bind(this),this.link=vZ(this.context,e),this.link.addEventListener("message",this.lastCallback)),ga&&gn("USDZ Exporter enabled: "+this.name),(n=document.getElementById("open-in-ar"))==null||n.addEventListener("click",this.onClickedOpenInARElement),Ob.registerExporter(this)}onDisable(){var n,e,i;(n=this.button)==null||n.remove(),(e=this.link)==null||e.removeEventListener("message",this.lastCallback),ga&&gn("USDZ Exporter disabled: "+this.name),(i=document.getElementById("open-in-ar"))==null||i.removeEventListener("click",this.onClickedOpenInARElement),Ob.unregisterExporter(this)}async exportAsync(){return this.exportAndOpen()}async exportAndOpen(){var n;let e=this.exportFileName??((n=this.objectToExport)==null?void 0:n.name)??this.name;if(e+="-"+wj(),xd()||(e!==""&&(e+="-"),e+="MadeWithNeedle"),this.link||(this.link=vZ(this.context,xt.supportsQuickLookAR())),this.customUsdzFile)return ga&&console.log("Exporting custom usdz",this.customUsdzFile),this.openInQuickLook(this.customUsdzFile,e),null;if(!this.objectToExport)return console.warn("No object to export",this),null;const i=await this.export(this.objectToExport);return i?(ga&&console.log("USDZ generation done. Downloading as "+e),this.openInQuickLook(i,e),i):(console.error("USDZ generation failed. Please report a bug",this),null)}async export(n){if(!n)return console.warn("No object to export"),null;const e=this._currentExportTasks.get(n);if(e)return e;const i=this.internalExport(n);return i instanceof Promise?(this._currentExportTasks.set(n,i),i.then(s=>(this._currentExportTasks.delete(n),s)).catch(s=>(this._currentExportTasks.delete(n),console.error("Error during USDZ export \u2013 please report a bug!",s),null))):i}async internalExport(n){ai.start("export-usdz",{onProgress:b=>{this.dispatchEvent(new CustomEvent("export-progress",{detail:{progress:b}}))}}),ai.report("export-usdz",{message:"Starting export",totalSteps:40,currentStep:0}),ai.report("export-usdz",{message:"Load progressive textures",autoStep:5}),ai.start("export-usdz-textures","export-usdz");const e=ie.getComponentsInChildren(n,Do);for(const b of e)b&&b.enabled&&b.updateSprite(!0);const i=ie.getComponentsInChildren(n,kn),s=new Array;let r=0;for(const b of i){for(const A of b.sharedMeshes)if(A){const x=mi.assignMeshLOD(A,0);x instanceof Promise&&s.push(new Promise((w,_)=>{x.then(()=>{r++,ai.report("export-usdz-textures",{message:"Loaded progressive mesh",currentStep:r,totalSteps:s.length}),w()}).catch(S=>_(S))}))}for(const A of b.sharedMaterials)if(A){const x=mi.assignTextureLOD(A,0);x instanceof Promise&&s.push(new Promise((w,_)=>{x.then(()=>{r++,ai.report("export-usdz-textures",{message:"Loaded progressive texture",currentStep:r,totalSteps:s.length}),w()}).catch(S=>_(S))}))}}ga&&gn("Progressive Loading: "+s.length),await Promise.all(s),ga&&gn("Progressive Loading: done"),ai.end("export-usdz-textures");const o=yo.Global.Mask;yo.Global.Set(Rc.AR);const a=new Ej,l=new yA(this.quickLookCompatible),c=[l,...this.extensions],h={self:this,exporter:a,extensions:c,object:n};ai.report("export-usdz","Invoking before-export"),this.dispatchEvent(new CustomEvent("before-export",{detail:h})),this.applyWebARSessionRoot(),this._previousTimeScale=this.context.time.timeScale,this.context.time.timeScale=0,ai.report("export-usdz","auto export animations and audio sources");const u=new Array;this.autoExportAnimations&&u.push(...uAe(n,l)),this.extensions.find(b=>b.extensionName==="Audio")&&this.autoExportAudioSources&&u.push(...dAe(n)),a.debug=ga,a.pruneUnusedNodes=!gAe;const d=Q0.instance.objs.map(b=>b.batchedMesh);a.keepObject=b=>{let A=!0;const x=ie.getComponent(b,kn);return x&&!x.enabled&&(A=!1),A&&d.includes(b)&&(A=!1),A&&ie.getComponentInParent(b,Xl)&&(A=!1),A&&ie.getComponentInParent(b,wc)&&(A=!1),ga&&!A&&console.log("USDZExporter: Discarding object",b),A};const m=new Array;this.objectToExport&&this.quickLookCompatible&&this.interactive&&this.objectToExport.traverse(b=>{b.visible||m.push(b)});const f=this.extensions.find(b=>b.extensionName==="Behaviour");this.interactive&&f&&m.length>0&&f.addBehavior(pAe(m));let g=!0;this.quickLookCompatible&&!this.interactive&&(g=!1),this.anchoringType!=="plane"&&this.anchoringType!=="none"&&this.anchoringType!=="image"&&this.anchoringType!=="face"&&(this.anchoringType="plane"),this.planeAnchoringAlignment!=="horizontal"&&this.planeAnchoringAlignment!=="vertical"&&this.planeAnchoringAlignment!=="any"&&(this.planeAnchoringAlignment="horizontal"),ai.report("export-usdz","Invoking exporter.parse");const y=await a.parse(this.objectToExport,{ar:{anchoring:{type:this.anchoringType},planeAnchoring:{alignment:this.planeAnchoringAlignment}},extensions:c,quickLookCompatible:this.quickLookCompatible,maxTextureSize:this.maxTextureSize,exportInvisible:g}),v=new Blob([y],{type:"model/vnd.usdz+zip"});this.revertWebARSessionRoot(),this.context.time.timeScale=this._previousTimeScale,ai.report("export-usdz","Invoking after-export"),this.dispatchEvent(new CustomEvent("after-export",{detail:h}));for(const b of u)ie.destroy(b);return yo.Global.Set(o),ai.end("export-usdz"),v}openInQuickLook(n,e){const i=n instanceof Blob?URL.createObjectURL(n):n,s=this.buildQuicklookOverlay();ga&&console.log("QuickLook Overlay",s);const r=s.callToAction?encodeURIComponent(s.callToAction):"",o=s.checkoutTitle?encodeURIComponent(s.checkoutTitle):"",a=s.checkoutSubtitle?encodeURIComponent(s.checkoutSubtitle):"";this.link.href=i+`#callToAction=${r}&checkoutTitle=${o}&checkoutSubtitle=${a}&callToActionURL=${s.callToActionURL}`,this.lastCallback||(this.lastCallback=this.quicklookCallback.bind(this),this.link.addEventListener("message",this.lastCallback)),this.link.download=e+".usdz",this.link.click()}download(n,e){fO.save(n,e)}static save(n,e){const i=document.createElement("a");i.style.display="none",document.body.appendChild(i),typeof n=="string"?i.href=n:i.href=URL.createObjectURL(n),i.download=e,i.click(),i.remove()}quicklookCallback(n){if(n?.data=="_apple_ar_quicklook_button_tapped"){ga&&zi("Quicklook closed via call to action button");var e=new CustomEvent("quicklook-button-tapped",{detail:this});if(this.dispatchEvent(e),!e.defaultPrevented){const i=new URLSearchParams(this.link.href);if(i){const s=i.get("callToActionURL");ga&&gn("Quicklook url: "+s),s&&(xd()?globalThis.open(s,"_blank"):console.warn("Quicklook closed: custom redirects require a Needle Engine Pro license: https://needle.tools/pricing",s))}}}}buildQuicklookOverlay(){var n,e,i,s,r,o;const a={};return this.customBranding&&Object.assign(a,this.customBranding),xd()||(console.log("Custom Quicklook banner text requires pro license: https://needle.tools/pricing"),a.callToAction="Close",a.checkoutTitle="\u{1F335} Made with Needle",a.checkoutSubtitle="_"),(((n=a.callToAction)==null?void 0:n.length)||((e=a.checkoutTitle)==null?void 0:e.length)||((i=a.checkoutSubtitle)==null?void 0:i.length))&&((s=a.callToAction)!=null&&s.length||(a.callToAction="\0"),(r=a.checkoutTitle)!=null&&r.length||(a.checkoutTitle="\0"),(o=a.checkoutSubtitle)!=null&&o.length||(a.checkoutSubtitle="\0")),this.dispatchEvent(new CustomEvent("quicklook-overlay",{detail:a})),a}getARScaleAndTarget(){if(!this.objectToExport)return{scale:1,_invertForward:!1,target:this.gameObject,sessionRoot:null};const n=ie.findObjectOfType(On);let e=ie.getComponentInParent(this.objectToExport,au);e||(e=ie.getComponentInChildren(this.objectToExport,au));let i=1,s=!1;const r=this.objectToExport;return n?i=n.arScale:e&&(i=e.arScale,s=e.invertForward),{scale:1/i,_invertForward:s,target:r,sessionRoot:e?.gameObject??null}}applyWebARSessionRoot(){if(!this.objectToExport)return;const{scale:n,_invertForward:e,target:i,sessionRoot:s}=this.getARScaleAndTarget(),r=s?.matrixWorld.clone().invert();this._rootSessionRootWasAppliedTo=i,this._rootPositionBeforeExport.copy(i.position),this._rootRotationBeforeExport.copy(i.quaternion),this._rootScaleBeforeExport.copy(i.scale),i.scale.multiplyScalar(n),e&&i.quaternion.multiply(fO.invertForwardQuaternion),i.updateMatrix(),i.updateMatrixWorld(!0),s&&r&&i.matrix.premultiply(r)}revertWebARSessionRoot(){if(!this.objectToExport||!this._rootSessionRootWasAppliedTo)return;const n=this._rootSessionRootWasAppliedTo;n.position.copy(this._rootPositionBeforeExport),n.quaternion.copy(this._rootRotationBeforeExport),n.scale.copy(this._rootScaleBeforeExport),n.updateMatrix(),n.updateMatrixWorld(!0),this._rootSessionRootWasAppliedTo=null}createQuicklookButton(){const n=Km.getOrCreate().createQuicklookButton();return n.parentNode||this.context.menu.appendChild(n),n}},p(ZM,"invertForwardMatrix",new he().makeRotationY(Math.PI)),p(ZM,"invertForwardQuaternion",new Se().setFromEuler(new si(0,Math.PI,0))),ZM);let Gn=fO;Xr([T(ye)],Gn.prototype,"objectToExport",2),Xr([T()],Gn.prototype,"autoExportAnimations",2),Xr([T()],Gn.prototype,"autoExportAudioSources",2),Xr([T()],Gn.prototype,"exportFileName",2),Xr([T(URL)],Gn.prototype,"customUsdzFile",2),Xr([T(Jd)],Gn.prototype,"customBranding",2),Xr([T()],Gn.prototype,"anchoringType",2),Xr([T()],Gn.prototype,"maxTextureSize",2),Xr([T()],Gn.prototype,"planeAnchoringAlignment",2),Xr([T()],Gn.prototype,"interactive",2),Xr([T()],Gn.prototype,"allowCreateQuicklookButton",2),Xr([T()],Gn.prototype,"quickLookCompatible",2);class cx extends Pe{constructor(){super(...arguments),p(this,"isUsed",!0),p(this,"usedBy",null)}}class gO extends Pe{}const bZ=te("debugdeletable"),YM=class extends Ja{onEnable(){YM._instances.push(this)}onDisable(){const n=YM._instances.indexOf(this);n>=0&&YM._instances.splice(n,1)}};let hx=YM;p(hx,"_instances",[]);class yO extends Pe{update(){for(const e of hx._instances){const i=this.gameObject;if(e.isInBox(i)===!0){const s=ie.getComponentInParent(this.gameObject,cx);if(s)bZ&&console.warn("DeleteBox: Not deleting object with usage marker",this.guid,s);else{if(bZ)try{if(e.box){const r=e.box,o=Ja.testBox;ft.DrawWireBox3(r,16711680,5),ft.DrawWireBox3(o,255,5),console.log("DeleteBox: Destroying",this.gameObject,{deleteBoxArea:r,deletedObjectArea:o})}else console.log("DeleteBox: Destroying",this.gameObject)}catch{}Wb(this.gameObject,this.context.connection)}}}}}var yAe=Object.defineProperty,vAe=Object.getOwnPropertyDescriptor,$m=(n,e,i,s)=>{for(var r=s>1?void 0:s?vAe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&yAe(e,i,r),r};const bAe=te("debugpost");class Wl extends Vs{constructor(){super(...arguments),p(this,"mode"),p(this,"focusDistance",new Je(1)),p(this,"focalLength",new Je(.2)),p(this,"aperture",new Je(20)),p(this,"gaussianMaxRadius",new Je),p(this,"resolutionScale",new Je(1*1/window.devicePixelRatio)),p(this,"bokehScale",new Je)}get typeName(){return"DepthOfField"}init(){this.focalLength.valueProcessor=i=>{const s=i/300,r=2;return tt.lerp(r,.01,s)};const e=20;this.aperture.valueProcessor=i=>{const s=1-i/32;return tt.lerp(1,e,s)}}onCreateEffect(){if(this.mode===0){bAe&&console.warn("DepthOfField: Mode is set to Off");return}const e=new eV(this.context.mainCamera,{worldFocusRange:.2,focalLength:1,bokehScale:20,resolutionScale:this.resolutionScale.value});return this.focusDistance.onValueChanged=i=>{e.cocMaterial.worldFocusDistance=i},this.focalLength.onValueChanged=i=>e.cocMaterial.worldFocusRange=i,this.aperture.onValueChanged=i=>e.bokehScale=i,this.resolutionScale&&(this.resolutionScale.onValueChanged=i=>e.resolution.scale=i),[e]}unapply(){}}$m([T()],Wl.prototype,"mode",2),$m([T(Je)],Wl.prototype,"focusDistance",2),$m([T(Je)],Wl.prototype,"focalLength",2),$m([T(Je)],Wl.prototype,"aperture",2),$m([T(Je)],Wl.prototype,"gaussianMaxRadius",2),$m([T(Je)],Wl.prototype,"resolutionScale",2),$m([T(Je)],Wl.prototype,"bokehScale",2),Ka("DepthOfField",Wl);var AAe=Object.defineProperty,xAe=Object.getOwnPropertyDescriptor,wAe=(n,e,i,s)=>{for(var r=s>1?void 0:s?xAe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&AAe(e,i,r),r};class KM extends Pe{constructor(){super(...arguments),p(this,"visibleOn")}onEnable(){this.apply()}apply(){this.test()||ie.setActive(this.gameObject,!1)}test(){return this.visibleOn<0?!0:xt.isMobileDevice()?(this.visibleOn&2)!==0:(this.visibleOn&1)!==0}}wAe([T()],KM.prototype,"visibleOn",2);class vO{get extensionName(){return"DocumentExtension"}onAfterBuildDocument(e){}}var _Ae=Object.defineProperty,SAe=Object.getOwnPropertyDescriptor,ef=(n,e,i,s)=>{for(var r=s>1?void 0:s?SAe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&_Ae(e,i,r),r};const jc=te("debugdrag"),bO=[];var AO=(n=>(n[n.XZPlane=0]="XZPlane",n[n.Attached=1]="Attached",n[n.HitNormal=2]="HitNormal",n[n.DynamicViewAngle=3]="DynamicViewAngle",n[n.SnapToSurfaces=4]="SnapToSurfaces",n[n.None=5]="None",n))(AO||{}),ux;const $a=(ux=class extends Pe{constructor(){super(...arguments),p(this,"dragMode",3),p(this,"snapGridResolution",0),p(this,"keepRotation",!0),p(this,"xrDragMode",1),p(this,"xrKeepRotation",!1),p(this,"xrDistanceDragFactor",1),p(this,"showGizmo",!1),p(this,"_rigidbody",null),p(this,"_targetObject",null),p(this,"_dragHelper",null),p(this,"_draggingRigidbodies",[]),p(this,"_potentialDragStartEvt",null),p(this,"_dragHandlers",new Map),p(this,"_totalMovement",new E),p(this,"_marker",null),p(this,"_isDragging",!1),p(this,"_didDrag",!1)}static get HasAnySelected(){return this._active>0}static get CurrentlySelected(){bO.length=0;for(const n of this._instances)n._isDragging&&bO.push(n);return bO}get draggedObject(){return this._targetObject}setTargetObject(n){var e,i;this._targetObject=n;for(const r of this._dragHandlers.values())r.setTargetObject(n);const s="_rigidbody-was-kinematic";((e=this._rigidbody)==null?void 0:e[s])===!1&&(this._rigidbody.isKinematic=!1,this._rigidbody[s]=void 0),this._rigidbody=null,n&&(this._rigidbody=ie.getComponentInChildren(n,Li),((i=this._rigidbody)==null?void 0:i.isKinematic)===!1&&(this._rigidbody.isKinematic=!0,this._rigidbody[s]=!1))}awake(){this._potentialDragStartEvt=null,this._dragHandlers=new Map,this._totalMovement=new E,this._marker=null,this._isDragging=!1,this._didDrag=!1,this._dragHelper=null,this._draggingRigidbodies=[]}start(){this.gameObject.getComponentInParent(ra)||this.gameObject.addComponent(ra)}onEnable(){$a._instances.push(this)}onDisable(){$a._instances=$a._instances.filter(n=>n!==this)}allowEdit(n=null){return this.context.connection.allowEditing}onPointerEnter(n){if(!this.allowEdit(this.gameObject)||n.mode!=="screen"||(n.event.mode==="tracked-pointer"||n.event.mode==="transient-pointer"?this.xrDragMode:this.dragMode)===5)return;const e=ie.getComponentInParent(n.object,$a);!e||e!==this||($a.lastHovered=n.object,this.context.domElement.style.cursor="pointer")}onPointerExit(n){this.allowEdit(this.gameObject)&&n.mode==="screen"&&$a.lastHovered===n.object&&(this.context.domElement.style.cursor="auto")}onPointerDown(n){if(!(!this.allowEdit(this.gameObject)||n.used||(n.mode==="tracked-pointer"||n.mode==="transient-pointer"?this.xrDragMode:this.dragMode)===5)&&($a.lastHovered=n.object,n.button===0)){this._dragHandlers.size===0&&(this._didDrag=!1,this._totalMovement.set(0,0,0),this._potentialDragStartEvt=n),this._targetObject||this.setTargetObject(this.gameObject),$a._active+=1;const e=new MAe(this,this._targetObject);if(this._dragHandlers.set(n.event.space,e),e.onDragStart(n),this._dragHandlers.size===2){const i=this._dragHandlers.values(),s=i.next().value,r=i.next().value,o=new CAe(this,this._targetObject,s,r);this._dragHandlers.set(this.gameObject,o),o.onDragStart(n)}n.use()}}onPointerMove(n){(this._isDragging||this._potentialDragStartEvt!==null)&&n.use()}onPointerUp(n){if(jc&&ft.DrawLabel(n.point??this.gameObject.worldPosition,"POINTERUP:"+n.pointerId+", "+n.button,.03,3),!this.allowEdit(this.gameObject)||n.button!==0)return;this._potentialDragStartEvt=null;const e=this._dragHandlers.get(n.event.space),i=this._dragHandlers.get(this.gameObject);i&&(i.handlerA===e||i.handlerB===e)&&(this._dragHandlers.delete(this.gameObject),i.onDragEnd(n)),e&&($a._active>0&&($a._active-=1),this.setTargetObject(null),e.onDragEnd&&e.onDragEnd(n),this._dragHandlers.delete(n.event.space),this._dragHandlers.size===0&&this.onLastDragEnd(n),n.use())}update(){for(const n of this._dragHandlers.values())n.collectMovementInfo&&n.collectMovementInfo(),n.getTotalMovement&&this._totalMovement.add(n.getTotalMovement());if(this._potentialDragStartEvt){if(!this._didDrag)if(this._totalMovement.length()>3e-4)this._didDrag=!0;else return;const n=this._potentialDragStartEvt;this._potentialDragStartEvt=null,this.onFirstDragStart(n)}for(const n of this._dragHandlers.values())n.onDragUpdate&&n.onDragUpdate(this._dragHandlers.size);this._dragHelper&&this._dragHelper.hasSelected&&this.onAnyDragUpdate()}onFirstDragStart(n){if(!n||!n.object)return;const e=ie.getComponentInParent(n.object,$a);if(!e||e!==this&&e._isDragging)return;const i=this._targetObject||this.gameObject;if(!i)return;this._isDragging=!0;const s=ie.getComponentInChildren(i,Sc);jc&&console.log("DRAG START",s,i),s&&(s.fastMode=!0,s?.requestOwnership()),this._marker=ie.addComponent(i,cx),this._draggingRigidbodies.length=0;const r=ie.getComponentsInChildren(i,Li);r&&this._draggingRigidbodies.push(...r)}onAnyDragUpdate(){if(!this._dragHelper)return;this._dragHelper.showGizmo=this.showGizmo,this._dragHelper.onUpdate(this.context);for(const e of this._draggingRigidbodies)e.wakeUp(),e.resetVelocities(),e.resetForcesAndTorques();const n=this._targetObject||this.gameObject;hl.markDirty(n)}onLastDragEnd(n){if(!this||!this._isDragging)return;this._isDragging=!1;for(const i of this._draggingRigidbodies)i.setVelocity(i.smoothedVelocity);if(this._draggingRigidbodies.length=0,this._targetObject=null,n!=null&&n.object){const i=ie.getComponentInChildren(n.object,Sc);i&&(i.fastMode=!1)}if(this._marker&&this._marker.destroy(),!this._dragHelper)return;const e=this._dragHelper.selected;jc&&console.log("DRAG END",e,e?.visible),this._dragHelper.setSelected(null,this.context)}},p(ux,"_active",0),p(ux,"_instances",[]),p(ux,"lastHovered"),ux);let Oo=$a;ef([T()],Oo.prototype,"dragMode",2),ef([T()],Oo.prototype,"snapGridResolution",2),ef([T()],Oo.prototype,"keepRotation",2),ef([T()],Oo.prototype,"xrDragMode",2),ef([T()],Oo.prototype,"xrKeepRotation",2),ef([T()],Oo.prototype,"xrDistanceDragFactor",2),ef([T()],Oo.prototype,"showGizmo",2);class CAe{constructor(e,i,s,r){p(this,"handlerA"),p(this,"handlerB"),p(this,"context"),p(this,"settings"),p(this,"gameObject"),p(this,"_handlerAAttachmentPoint",new E),p(this,"_handlerBAttachmentPoint",new E),p(this,"_followObject"),p(this,"_manipulatorObject"),p(this,"_deviceMode"),p(this,"_followObjectStartWorldQuaternion",new Se),p(this,"_manipulatorPosOffset",new E),p(this,"_manipulatorRotOffset",new Se),p(this,"_manipulatorScaleOffset",new E),p(this,"_tempVec1",new E),p(this,"_tempVec2",new E),p(this,"_tempVec3",new E),p(this,"tempLookMatrix",new he),p(this,"_initialScale",new E),p(this,"_initialDistance",0);var o,a;this.context=e.context,this.settings=e,this.gameObject=i,this.handlerA=s,this.handlerB=r,this._followObject=new ye,this._manipulatorObject=new ye,this.context.scene.add(this._manipulatorObject);const l=(a=(o=Et.active)==null?void 0:o.rig)==null?void 0:a.gameObject;if(!this.handlerA||!this.handlerB||!this.handlerA.hitPointInLocalSpace||!this.handlerB.hitPointInLocalSpace){console.error("Invalid: MultiTouchDragHandler needs two valid DragPointerHandlers with hitPointInLocalSpace set.");return}if(this._tempVec1.copy(this.handlerA.hitPointInLocalSpace),this._tempVec2.copy(this.handlerB.hitPointInLocalSpace),this.gameObject.localToWorld(this._tempVec1),this.gameObject.localToWorld(this._tempVec2),l&&(l.worldToLocal(this._tempVec1),l.worldToLocal(this._tempVec2)),this._initialDistance=this._tempVec1.distanceTo(this._tempVec2),this._initialDistance<.02?(jc&&console.log("Finding alternative drag attachment points since initial distance is too low: "+this._initialDistance.toFixed(2)),this.handlerA.followObject.parent.getWorldPosition(this._tempVec1),this.handlerB.followObject.parent.getWorldPosition(this._tempVec2),this._handlerAAttachmentPoint.copy(this._tempVec1),this._handlerBAttachmentPoint.copy(this._tempVec2),this.gameObject.worldToLocal(this._handlerAAttachmentPoint),this.gameObject.worldToLocal(this._handlerBAttachmentPoint),this._initialDistance=this._tempVec1.distanceTo(this._tempVec2),this._initialDistance<.001&&(console.warn("Not supported right now \u2013 controller drag points for multitouch are too close!"),this._initialDistance=1)):(this._handlerAAttachmentPoint.copy(this.handlerA.hitPointInLocalSpace),this._handlerBAttachmentPoint.copy(this.handlerB.hitPointInLocalSpace)),this._tempVec3.lerpVectors(this._tempVec1,this._tempVec2,.5),this._initialScale.copy(i.scale),jc){this._followObject.add(new io(2)),this._manipulatorObject.add(new io(5));const c=h=>`${h.x.toFixed(2)}, ${h.y.toFixed(2)}, ${h.z.toFixed(2)}`;ft.DrawLine(this._tempVec1,this._tempVec2,65535,0,!1),ft.DrawLabel(this._tempVec3,"A:B "+this._initialDistance.toFixed(2)+`
`+c(this._tempVec1)+`
`+c(this._tempVec2),.03,5)}}onDragStart(e){this.gameObject.add(this._followObject),this._followObject.matrixAutoUpdate=!1,this._followObject.matrix.identity(),this._deviceMode=e.mode,this._followObjectStartWorldQuaternion.copy(this._followObject.worldQuaternion),this.alignManipulator(),this._manipulatorObject.attach(this._followObject),this._manipulatorPosOffset.copy(this._followObject.position),this._manipulatorRotOffset.copy(this._followObject.quaternion),this._manipulatorScaleOffset.copy(this._followObject.scale)}onDragEnd(e){if(!this.handlerA||!this.handlerB){console.error("onDragEnd called on MultiTouchDragHandler without valid handlers. This is likely a bug.");return}this.handlerA.recenter(),this.handlerB.recenter(),this._manipulatorObject.removeFromParent(),this._followObject.removeFromParent(),this._manipulatorObject.destroy(),this._followObject.destroy()}alignManipulator(){if(!this.handlerA||!this.handlerB){console.error("alignManipulator called on MultiTouchDragHandler without valid handlers. This is likely a bug.",this);return}if(!this.handlerA.followObject||!this.handlerB.followObject){console.error("alignManipulator called on MultiTouchDragHandler without valid follow objects. This is likely a bug.",this.handlerA,this.handlerB);return}this._tempVec1.copy(this._handlerAAttachmentPoint),this._tempVec2.copy(this._handlerBAttachmentPoint),this.handlerA.followObject.localToWorld(this._tempVec1),this.handlerB.followObject.localToWorld(this._tempVec2),this._tempVec3.lerpVectors(this._tempVec1,this._tempVec2,.5),this._manipulatorObject.position.copy(this._tempVec3);const e=this.context.mainCamera;this.tempLookMatrix.lookAt(this._tempVec3,this._tempVec2,e.worldUp),this._manipulatorObject.quaternion.setFromRotationMatrix(this.tempLookMatrix);const i=this._tempVec1.distanceTo(this._tempVec2);this._manipulatorObject.scale.copy(this._initialScale).multiplyScalar(i/this._initialDistance),this._manipulatorObject.updateMatrix(),this._manipulatorObject.updateMatrixWorld(!0),jc&&(ft.DrawLabel(this._tempVec3.clone().add(new E(0,.2,0)),"A:B "+i.toFixed(2),.03),ft.DrawLine(this._tempVec1,this._tempVec2,65280,0,!1))}onDragUpdate(){this.alignManipulator();const e=30,i=1;this._followObject.position.copy(this._manipulatorPosOffset),this._followObject.quaternion.copy(this._manipulatorRotOffset),this._followObject.scale.copy(this._manipulatorScaleOffset);const s=this.gameObject,r=this._followObject;r.updateMatrix(),r.updateMatrixWorld(!0);const o=this._deviceMode==="tracked-pointer"||this._deviceMode==="transient-pointer"?this.settings.xrKeepRotation:this.settings.keepRotation;if(this.settings.snapGridResolution>0){const u=this._followObject.worldPosition,d=this.settings.snapGridResolution;u.x=Math.round(u.x/d)*d,u.y=Math.round(u.y/d)*d,u.z=Math.round(u.z/d)*d,this._followObject.worldPosition=u,this._followObject.updateMatrix()}o&&(this._followObject.worldQuaternion=this._followObjectStartWorldQuaternion,this._followObject.updateMatrix());const a=tt.clamp01(this.context.time.deltaTime*e*i),l=s.worldPosition;l.lerp(r.worldPosition,a),s.worldPosition=l;const c=s.worldQuaternion;c.slerp(r.worldQuaternion,a),s.worldQuaternion=c;const h=s.worldScale;h.lerp(r.worldScale,a),s.worldScale=h}setTargetObject(e){this.gameObject=e}}class MAe{constructor(e,i){p(this,"context"),p(this,"gameObject"),p(this,"settings"),p(this,"_lastRig"),p(this,"_followObject"),p(this,"_totalMovement",new E),p(this,"_totalMovementAlongRayDirection",0),p(this,"_grabStartDistance",0),p(this,"_deviceMode"),p(this,"_followObjectStartPosition",new E),p(this,"_followObjectStartQuaternion",new Se),p(this,"_followObjectStartWorldQuaternion",new Se),p(this,"_lastDragPosRigSpace"),p(this,"_tempVec",new E),p(this,"_tempMat",new he),p(this,"_hitPointInLocalSpace",new E),p(this,"_hitNormalInLocalSpace",new E),p(this,"_bottomCenter",new E),p(this,"_backCenter",new E),p(this,"_backBottomCenter",new E),p(this,"_bounds",new Wt),p(this,"_dragPlane",new fs(new E(0,1,0))),p(this,"_draggedOverObject",null),p(this,"_draggedOverObjectLastSetUp",null),p(this,"_draggedOverObjectLastNormal",new E),p(this,"_draggedOverObjectDuration",0),p(this,"_hasLastSurfaceHitPoint",!1),p(this,"_lastSurfaceHitPoint",new E),this.settings=e,this.context=e.context,this.gameObject=i,this._followObject=new ye}getTotalMovement(){return this._totalMovement}get followObject(){return this._followObject}get hitPointInLocalSpace(){return this._hitPointInLocalSpace}setTargetObject(e){this.gameObject=e}recenter(){var e,i;if(!this._followObject.parent){console.warn("Error: space follow object doesn't have parent but recenter() is called. This is likely a bug");return}if(!this.gameObject){console.warn("Error: space follow object doesn't have a gameObject");return}const s=this._followObject.parent;this.gameObject.add(this._followObject),this._followObject.matrixAutoUpdate=!1,this._followObject.position.set(0,0,0),this._followObject.quaternion.set(0,0,0,1),this._followObject.scale.set(1,1,1),this._followObject.updateMatrix(),this._followObject.updateMatrixWorld(!0),s.attach(this._followObject),this._followObjectStartPosition.copy(this._followObject.position),this._followObjectStartQuaternion.copy(this._followObject.quaternion),this._followObjectStartWorldQuaternion.copy(this._followObject.worldQuaternion),this._followObject.updateMatrix(),this._followObject.updateMatrixWorld(!0);const r=this._hitPointInLocalSpace.clone();this.gameObject.localToWorld(r),this._grabStartDistance=r.distanceTo(s.worldPosition);const o=(i=(e=Et.active)==null?void 0:e.rig)==null?void 0:i.gameObject,a=o?.worldScale.x||1;this._grabStartDistance/=a,this._totalMovementAlongRayDirection=0,this._lastDragPosRigSpace=void 0,jc&&(ft.DrawLine(r,s.worldPosition,65280,.5,!1),ft.DrawLabel(s.worldPosition.add(new E(0,.1,0)),this._grabStartDistance.toFixed(2),.03,.5))}onDragStart(e){if(!this.gameObject){console.warn("Error: space follow object doesn't have a gameObject");return}if(e.event.space.add(this._followObject),this._lastDragPosRigSpace=void 0,e.point&&e.normal)this._hitPointInLocalSpace.copy(e.point),this.gameObject.worldToLocal(this._hitPointInLocalSpace),this._hitNormalInLocalSpace.copy(e.normal);else if(e){const f=e.event.space,g=f.worldPosition;this.gameObject.worldToLocal(g),this._hitPointInLocalSpace.copy(g);const y=f.worldUp;this._tempMat.copy(this.gameObject.matrixWorld).invert(),y.transformDirection(this._tempMat),this._hitNormalInLocalSpace.copy(y)}this.recenter(),this._totalMovement.set(0,0,0),this._deviceMode=e.mode;const i=this._followObject.parent.worldForward,s=this._deviceMode==="tracked-pointer"||this._deviceMode==="transient-pointer"?this.settings.xrDragMode:this.settings.dragMode,r=this._hitPointInLocalSpace.clone();switch(this.gameObject.localToWorld(r),s){case 0:const f=new E(0,1,0);this.gameObject.parent&&f.transformDirection(this.gameObject.parent.matrixWorld.clone().invert()),this._dragPlane.setFromNormalAndCoplanarPoint(f,r);break;case 2:const g=this._hitNormalInLocalSpace.clone();g.transformDirection(this.gameObject.matrixWorld),this._dragPlane.setFromNormalAndCoplanarPoint(g,r);break;case 1:this._dragPlane.setFromNormalAndCoplanarPoint(i,r);break;case 3:this.setPlaneViewAligned(r,!0);break;case 4:this.setPlaneViewAligned(r,!1);break}const o=this.gameObject.parent,a=this.gameObject.position.clone(),l=this.gameObject.quaternion.clone(),c=this.gameObject.scale.clone(),h=this.gameObject.matrixWorld.clone();o&&o.remove(this.gameObject),this.gameObject.position.set(0,0,0),this.gameObject.quaternion.set(0,0,0,1),this.gameObject.scale.set(1,1,1);const u=Ba([this.gameObject]);u.expandByPoint(this.gameObject.worldPosition);const d=new E;u.getCenter(d);const m=new E;u.getSize(m),this._bottomCenter.copy(d.clone().add(new E(0,-m.y/2,0))),this._backCenter.copy(d.clone().add(new E(0,0,m.z/2))),this._backBottomCenter.copy(d.clone().add(new E(0,-m.y/2,m.z/2))),this._bounds.copy(u),o&&o.add(this.gameObject),this.gameObject.position.copy(a),this.gameObject.quaternion.copy(l),this.gameObject.scale.copy(c),this.gameObject.matrixWorld.copy(h),this._draggedOverObject=null,this._draggedOverObjectLastSetUp=null,this._draggedOverObjectLastNormal.set(0,1,0),this._draggedOverObjectDuration=0}collectMovementInfo(){var e,i;if(!this._followObject.parent)return;const s=this._followObject.parent;this._followObject.updateMatrix();const r=s.worldPosition,o=(i=(e=Et.active)==null?void 0:e.rig)==null?void 0:i.gameObject;o&&o.worldToLocal(r),(this._lastDragPosRigSpace===void 0||o!=this._lastRig)&&(this._lastDragPosRigSpace=r.clone(),this._lastRig=o),this._tempVec.copy(r).sub(this._lastDragPosRigSpace);const a=s.worldForward;if(o&&(this._tempMat.copy(o.matrixWorld).invert(),a.transformDirection(this._tempMat)),this._totalMovementAlongRayDirection+=a.dot(this._tempVec),this._tempVec.x=Math.abs(this._tempVec.x),this._tempVec.y=Math.abs(this._tempVec.y),this._tempVec.z=Math.abs(this._tempVec.z),this._totalMovement.add(this._tempVec),this._lastDragPosRigSpace.copy(r),jc){let l=r;o&&(l=l.clone(),l.transformDirection(o.matrixWorld)),ft.DrawRay(l,a,255)}}onDragUpdate(e){if(e>1)return;const i=this.gameObject;if(!i||!this._followObject){console.warn("Warning: DragPointerHandler doesn't have a dragged object. This is likely a bug.");return}const s=this._followObject.parent;if(!s){console.warn("Warning: DragPointerHandler doesn't have a drag source. This is likely a bug.");return}this._followObject.updateMatrix();const r=s.worldPosition,o=s.worldForward,a=this._deviceMode==="tracked-pointer"||this._deviceMode==="transient-pointer",l=a?this.settings.xrKeepRotation:this.settings.keepRotation,c=a?this.settings.xrDragMode:this.settings.dragMode;if(c===5)return;const h=10;l&&(this._followObject.worldQuaternion=this._followObjectStartWorldQuaternion),this._followObject.updateMatrix(),this._followObject.updateMatrixWorld(!0);let u=1,d=2;if(a&&this._grabStartDistance>.5){const b=1+this._totalMovementAlongRayDirection*(2*this.settings.xrDistanceDragFactor);u=Math.max(0,b),u=u*u*u}else this._grabStartDistance<=.5&&(d=3);this._followObject.position.copy(this._followObjectStartPosition),l||this._followObject.quaternion.copy(this._followObjectStartQuaternion),this._followObject.position.multiplyScalar(u),this._followObject.updateMatrix();const m=this._hasLastSurfaceHitPoint;this._hasLastSurfaceHitPoint=!1;const f=new qr(r,o);if(c==4){const b=this.context.physics.raycastFromRay(f,{testObject:A=>A!==this.followObject&&A!==s&&A!==i});if(b.length>0){const A=b[0];if(this._draggedOverObject===A.object?this._draggedOverObjectDuration+=this.context.time.deltaTime:(this._draggedOverObject=A.object,this._draggedOverObjectDuration=0),A.face){this._hasLastSurfaceHitPoint=!0,this._lastSurfaceHitPoint.copy(A.point);const x=.15,w=this._draggedOverObjectDuration>=x,_=.001,S=this._totalMovement.length()>=_;if((w||S)&&(this._draggedOverObjectLastSetUp!==this._draggedOverObject||this._draggedOverObjectLastNormal.dot(A.face.normal)<.999999||this.context.time.frame%60===0)){this._draggedOverObjectLastSetUp=this._draggedOverObject,this._draggedOverObjectLastNormal.copy(A.face.normal);const M=mt(),R=mt();this._bounds.getCenter(M),this._bounds.getSize(R),M.sub(R.multiplyScalar(.5).multiply(A.face.normal)),this._hitPointInLocalSpace.copy(M),this._hitNormalInLocalSpace.copy(A.face.normal),this._bounds.getCenter(M),this._bounds.getSize(R),M.add(R.multiplyScalar(.5).multiply(A.face.normal));const P=mt(this._hitPointInLocalSpace).add(M);this._followObject.localToWorld(P);const C=A.point;this._dragPlane.setFromNormalAndCoplanarPoint(A.face.normal,C)}else if(!(w||S))return}}else m&&this.gameObject&&this.setPlaneViewAligned(this.gameObject.worldPosition,!1)}if(c!==1&&f.intersectPlane(this._dragPlane,this._tempVec)){this._followObject.worldPosition=this._tempVec,this._followObject.updateMatrix(),this._followObject.updateMatrixWorld(!0);const b=this._hitPointInLocalSpace.clone();this._followObject.localToWorld(b),jc&&ft.DrawLine(b,this._tempVec,65535,0,!1),this._followObject.worldPosition=this._tempVec.multiplyScalar(2).sub(b),this._followObject.updateMatrix(),this._followObject.updateMatrix()}if(this.settings.snapGridResolution>0){const b=this._followObject.worldPosition,A=this.settings.snapGridResolution;b.x=Math.round(b.x/A)*A,b.y=Math.round(b.y/A)*A,b.z=Math.round(b.z/A)*A,this._followObject.worldPosition=b,this._followObject.updateMatrix()}l&&(this._followObject.worldQuaternion=this._followObjectStartWorldQuaternion,this._followObject.updateMatrix());const g=tt.clamp01(this.context.time.deltaTime*h*d),y=i.worldPosition;y.lerp(this._followObject.worldPosition,g),i.worldPosition=y;const v=i.worldQuaternion;if(v.slerp(this._followObject.worldQuaternion,g),i.worldQuaternion=v,jc){const b=this._hitPointInLocalSpace.clone();i.localToWorld(b),ft.DrawSphere(b,.02,16711680);const A=this._hitNormalInLocalSpace.clone();A.applyQuaternion(v),ft.DrawRay(b,A,16711680),ft.DrawLabel(y.add(new E(0,.25,0)),`Distance: ${this._totalMovement.length().toFixed(2)}

                Along Ray: ${this._totalMovementAlongRayDirection.toFixed(2)}

                Session: ${!!Et.active}

                Device: ${this._deviceMode}

                `,.03);const x=this._bottomCenter.clone(),w=this._backCenter.clone(),_=this._backBottomCenter.clone();i.localToWorld(x),i.localToWorld(w),i.localToWorld(_),ft.DrawSphere(x,.01,65280,0,!1),ft.DrawSphere(w,.01,255,0,!1),ft.DrawSphere(_,.01,16711935,0,!1),ft.DrawLine(x,_,65535,0,!1),ft.DrawLine(_,w,65535,0,!1)}}onDragEnd(e){console.assert(this._followObject.parent===e.event.space,"Drag end: _followObject is not parented to the space object"),this._followObject.removeFromParent(),this._followObject.destroy(),this._lastDragPosRigSpace=void 0}setPlaneViewAligned(e,i){if(!this._followObject.parent)return!1;const s=this._followObject.parent.worldForward,r=mt(0,1,0),o=s,a=r.angleTo(o),l=.5;return i&&(a>Math.PI/2+l||a<Math.PI/2-l)?this._dragPlane.setFromNormalAndCoplanarPoint(r,e):this._dragPlane.setFromNormalAndCoplanarPoint(s,e),!0}}const AZ=class{constructor(n){p(this,"showGizmo",!0),p(this,"useViewAngle",!0),p(this,"_selected",null),p(this,"_context",null),p(this,"_camera"),p(this,"_cameraPlane",new fs),p(this,"_hasGroundPlane",!1),p(this,"_groundPlane",new fs),p(this,"_groundOffset",new E),p(this,"_groundOffsetFactor",0),p(this,"_groundDistance",0),p(this,"_groundPlanePoint",new E),p(this,"_raycaster",new Nu),p(this,"_cameraPlaneOffset",new E),p(this,"_intersection",new E),p(this,"_worldPosition",new E),p(this,"_inverseMatrix",new he),p(this,"_rbs",[]),p(this,"_groundLine"),p(this,"_groundMarker"),p(this,"_groundOffsetVector",new E(0,1,0)),p(this,"_requireUpdateGroundPlane",!0),p(this,"_didDragOnGroundPlaneLastFrame",!1),this._camera=n;const e=new mn(AZ.geometry),i=e.material;i.color=new Ae(.4,.4,.4),e.layers.set(2),e.name="line",e.scale.y=1,this._groundLine=e;const s=new al(.5,22,22),r=new Qt({color:i.color}),o=new pe(s,r);o.visible=!1,o.layers.set(2),this._groundMarker=o}get hasSelected(){return this._selected!==null&&this._selected!==void 0}get selected(){return this._selected}setSelected(n,e){if(this._selected&&e)for(const i of this._rbs)i.wakeUp(),i.setVelocity(0,0,0);if(this._selected&&Ic.Remove(e,this._selected),this._selected=n,this._context=e,this._rbs.length=0,n?(e.scene.add(this._groundLine),e.scene.add(this._groundMarker)):(this._groundLine.removeFromParent(),this._groundMarker.removeFromParent()),this._selected){if(!e){console.error("DragHelper: no context");return}Ic.Add(e,this._selected,null),this._groundOffsetFactor=0,this._hasGroundPlane=!0,this._groundOffset.set(0,0,0),this._requireUpdateGroundPlane=!0,this.onUpdateScreenSpacePlane()}}onUpdate(n){this._selected}onUpdateWorldPosition(n,e,i){if(this._selected){if(i){const s=zt(this._selected);s.y=n.y,n=s}if(bs(this._selected,n),bs(this._groundLine,n),this._hasGroundPlane?this._groundLine.scale.y=this._groundDistance:this._groundLine.scale.y=1e3,this._groundLine.visible=this.showGizmo,this._groundMarker.visible=e!==null&&this.showGizmo,e){const s=zt(this._camera).distanceTo(e)*.01;this._groundMarker.scale.set(s,s,s),bs(this._groundMarker,e)}}}onUpdateScreenSpacePlane(){if(!this._selected||!this._context)return;const n=this._context.input.getPointerPositionRC(0);n&&(this._raycaster.setFromCamera(n,this._camera),this._cameraPlane.setFromNormalAndCoplanarPoint(this._camera.getWorldDirection(this._cameraPlane.normal),this._worldPosition.setFromMatrixPosition(this._selected.matrixWorld)),this._raycaster.ray.intersectPlane(this._cameraPlane,this._intersection)&&this._selected.parent&&(this._inverseMatrix.copy(this._selected.parent.matrixWorld).invert(),this._cameraPlaneOffset.copy(this._intersection).sub(this._worldPosition.setFromMatrixPosition(this._selected.matrixWorld))))}onUpdateGroundPlane(){if(!this._selected||!this._context)return;const n=zt(this._selected),e=new qr(mt(0,.1,0).add(n),mt(0,-1,0)),i=new yc;i.testObject=r=>r!==this._selected;const s=this._context.physics.raycastFromRay(e,i);for(let r=0;r<s.length;r++){const o=s[r];if(!o.face||this.contains(this._selected,o.object))continue;const a=mt(0,1,0);this._groundPlane.setFromNormalAndCoplanarPoint(a,o.point);break}this._hasGroundPlane=!0,this._groundPlane.setFromNormalAndCoplanarPoint(e.direction.multiplyScalar(-1),e.origin),this._raycaster.ray.intersectPlane(this._groundPlane,this._intersection),this._groundDistance=this._intersection.distanceTo(n),this._groundOffset.copy(this._intersection).sub(n)}contains(n,e){if(n===e)return!0;if(n.children){for(const i of n.children)if(this.contains(i,e))return!0}return!1}};let EAe=AZ;p(EAe,"geometry",new dt().setFromPoints([new E(0,0,0),new E(0,-1,0)]));var xZ=(n=>(n.File_Spawned="file-spawned",n))(xZ||{});class wZ{constructor(e,i,s,r,o,a,l,c){p(this,"guid"),p(this,"file_name"),p(this,"file_hash"),p(this,"file_size"),p(this,"position"),p(this,"seed"),p(this,"sender"),p(this,"serverUrl"),p(this,"parentGuid"),p(this,"boundsSize"),this.seed=i,this.guid=s,this.file_name=r,this.file_hash=o,this.file_size=a,this.position=l,this.sender=e,this.serverUrl=c}}async function _Z(n,e,i){const s=n.name;return s.endsWith(".gltf")||s.endsWith(".glb")||n.type==="model/gltf+json"||n.type==="model/gltf-binary"?new Promise((r,o)=>{const a=new FileReader;a.readAsArrayBuffer(n),a.onloadend=async l=>{const c=a.result,h=KS(),u=new Es(h),d=await yl().parseSync(e,c,n.name,u);if(d&&d.scene){const m=d.scene;if(!m.guid){const f=new Es(h);m.guid=f.generateUUID()}i&&TAe(e.connection,n,h,m,i),r(d)}}}):(console.warn("Unsupported file type: "+s,n),null)}async function SZ(n,e){return new Promise(async(i,s)=>{const r=KS(),o=new Es(r),a=n.toString(),l=await yl().loadSync(e,a,a,o);l&&l.scene?(l.scene,i(l)):console.warn("Unsupported file type: "+n.toString())})}yi.registerCallback(wi.ContextCreated,n=>{CZ(n.context)});function CZ(n){n.connection.beginListen("file-spawned",async e=>{if(e.sender!==n.connection.connectionId){console.log("received file event",e),RAe(e,n);let i=null;try{i=await rk(e.file_name,e.file_hash,e.file_size,e.serverUrl)}finally{IAe(e)}if(i){const s=new Es(e.seed),r=await yl().parseSync(n,i,e.file_name,s);if(r&&r.scene){const o=r.scene;if(e.parentGuid){const a=tA(e.parentGuid,n.scene);a&&"add"in a&&a.add(o)}o.parent||n.scene.add(o),e.position!==null&&o.position.copy(e.position)}}else console.error("download didnt return file")}})}async function TAe(n,e,i,s,r){if(!n.connectionId){console.error("Can not upload file - no connection id");return}if(!s.guid){console.error("Can not upload file - no guid",s,s.guid);return}const o=await y4(e,r);if(!o)return;if(!o.filename){console.error("Can not send upload event - no filename",e.name);return}if(!o.hash){console.error("Can not send upload event - no hash",e.name);return}const a=new wZ(n.connectionId,i,s.guid,o.filename,o.hash,e.size,s.position,o.url??r);s.parent&&(a.parentGuid=s.parent.guid),n.send("file-spawned",a)}const xO={};function RAe(n,e){const i=new $i,s=new pe(i,new Qt({color:65280})),r=new sI(s,5592405);if(xO[n.guid]=r,e.scene.add(r),n.parentGuid){const o=tA(n.parentGuid,e.scene);o&&o.add(r)}n.position&&r.position.copy(n.position)}function IAe(n,e){const i=n.guid,s=xO[i];s&&(delete xO[i],s.removeFromParent())}var LAe=Object.defineProperty,PAe=Object.getOwnPropertyDescriptor,dx=(n,e,i,s)=>{for(var r=s>1?void 0:s?PAe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&LAe(e,i,r),r};const qd=te("debugdroplistener");class $d extends Pe{constructor(){super(...arguments),p(this,"dropArea"),p(this,"fitIntoVolume",!1),p(this,"fitVolumeSize",new E(1,1,1)),p(this,"placeAtHitPosition",!0),p(this,"onDropped",new en),p(this,"onNetworkEvent",e=>{var i;if((i=e.guid)!=null&&i.startsWith(this.guid)){const s=e.url;if(s)if(Array.isArray(s))for(const r of s)this.addFromUrl(r,{screenposition:new Y},!0).then(o=>{o?.position.set(e.point.x,e.point.y,e.point.z)});else this.addFromUrl(s,{screenposition:new Y},!0).then(r=>{r?.position.set(e.point.x,e.point.y,e.point.z)})}}),p(this,"handlePaste",async e=>{if(this.context.connection.allowEditing!==!1&&(e.ctrlKey||e.metaKey)&&e.key==="v"){const i=await navigator.clipboard.readText().catch(console.warn);if(i&&(i.startsWith("http")||i.startsWith("https")||i.startsWith("blob"))){const s={screenposition:new Y(this.context.input.mousePosition.x,this.context.input.mousePosition.y)};this.testIfIsInDropArea(s)&&this.addFromUrl(i,s,!1)}}}),p(this,"onDrag",e=>{this.context.connection.allowEditing!==!1&&e.preventDefault()}),p(this,"onDrop",async e=>{if(this.context.connection.allowEditing===!1||(qd&&console.log(e),!(e!=null&&e.dataTransfer))||e["droplistener:handled"])return;e.preventDefault();const i={screenposition:new Y(e.offsetX,e.offsetY)};if(this.dropArea&&this.testIfIsInDropArea(i)===!1)return;e["droplistener:handled"]=!0;const s=e.dataTransfer.items;if(s)for(const r in s){const o=s[r];if(o.kind==="file"){const a=o.getAsFile();if(!a)continue;await this.addFiles([a],i)}else o.kind==="string"&&o.type=="text/plain"&&o.getAsString(a=>{this.addFromUrl(a,i,!1)})}}),p(this,"_addedObjects",new Array)}onEnable(){this.context.renderer.domElement.addEventListener("dragover",this.onDrag),this.context.renderer.domElement.addEventListener("drop",this.onDrop),window.addEventListener("keyup",this.handlePaste),this.context.connection.beginListen("droplistener",this.onNetworkEvent)}onDisable(){this.context.renderer.domElement.removeEventListener("dragover",this.onDrag),this.context.renderer.domElement.removeEventListener("drop",this.onDrop),window.removeEventListener("keyup",this.handlePaste),this.context.connection.stopListen("droplistener",this.onNetworkEvent)}async addFromUrl(e,i,s){qd&&console.log("dropped url",e);try{if(e.startsWith("https://github.com/")){const a=e.split("/"),l=a[3],c=a[4],h=a[6],u=a.slice(7).join("/");e=`https://raw.githubusercontent.com/${l}/${c}/${h}/${u}`}else e.startsWith("https://polyhaven.com/a")&&(e=BAe(e));if(!e)return null;const r=e.toLowerCase();if(r.endsWith(".hdr")||r.endsWith(".hdri")||r.endsWith(".exr")||r.endsWith(".png")||r.endsWith(".jpg")||r.endsWith(".jpeg"))return null;const o=await SZ(new URL(e),this.context);if(o)return i.url=e,this.addObject(o,i,s)}catch{console.warn("String is not a valid URL",e)}return null}async addFiles(e,i){if(qd&&console.log("Add files",e),!!Array.isArray(e)&&e.length)for(const s of e){if(!s)continue;qd&&console.log("Register file "+s.name,s);const r=await _Z(s,this.context);this.dispatchEvent(new CustomEvent("file-dropped",{detail:s})),r&&this.addObject(r,i,!1)}}addObject(e,i,s){var r,o;if(qd&&console.log(`Dropped ${this.gameObject.name}`,e),!(e!=null&&e.scene))return console.warn("No object specified to add to scene",e),null;for(const c of this._addedObjects)c.parent===this.gameObject&&ia(c,!0,!0);this._addedObjects.length=0;const a=e.scene;this.gameObject.attach(a),a.position.set(0,0,0),a.quaternion.identity(),this._addedObjects.push(a),qd&&a.add(new io(1));const l=new Wt().setFromCenterAndSize(new E(0,this.fitVolumeSize.y*.5,0).add(this.gameObject.worldPosition),this.fitVolumeSize);if(qd&&ft.DrawWireBox3(l,255,5),this.fitIntoVolume&&k5(a,l,{position:!this.placeAtHitPosition}),this.placeAtHitPosition&&i&&i.screenposition){a.visible=!1;const c=this.context.physics.raycast({screenPoint:this.context.input.convertScreenspaceToRaycastSpace(i.screenposition.clone())});if(a.visible=!0,c&&c.length>0)for(const h of c){const u=h.point.clone();qd&&console.log("Place object at hit",h),D5(a,u);break}}if(d0.assignAnimationsFromFile(e,{createAnimationComponent:c=>ta(c,Fr)}),this.dispatchEvent(new CustomEvent("object-added",{detail:e})),(r=this.onDropped)==null||r.invoke({sender:this,gltf:e}),!s&&(o=i.url)!=null&&o.startsWith("http")&&this.context.connection.isConnected&&a){const c={guid:this.guid,url:i.url,point:a.position.clone()};this.context.connection.send("droplistener",c)}return a}testIfIsInDropArea(e){if(this.dropArea){const i=this.context.input.convertScreenspaceToRaycastSpace(e.screenposition.clone());if(!this.context.physics.raycast({targets:[this.dropArea],screenPoint:i,recursive:!0,testObject:s=>!this._addedObjects.includes(s)}).length)return Ye()&&console.log(`Dropped outside of drop area for DropListener "${this.name}".`),!1}return!0}}dx([T(ye)],$d.prototype,"dropArea",2),dx([T()],$d.prototype,"fitIntoVolume",2),dx([T(E)],$d.prototype,"fitVolumeSize",2),dx([T()],$d.prototype,"placeAtHitPosition",2),dx([T(en)],$d.prototype,"onDropped",2);function BAe(n){if(!n.startsWith("https://polyhaven.com/"))return n;const e="https://dl.polyhaven.org/file/ph-assets/Models/gltf/4k/",i=new URL(n).pathname.split("/").pop(),s=`${e}${i}/${i}_4k.gltf`;return console.log("Resolved polyhaven asset url",n,"\u2192",s),s}var kAe=Object.defineProperty,DAe=Object.getOwnPropertyDescriptor,JM=(n,e,i,s)=>{for(var r=s>1?void 0:s?DAe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&kAe(e,i,r),r};const MZ=class extends Pe{constructor(){super(...arguments),p(this,"parent",null),p(this,"object",null),p(this,"limitCount",10),p(this,"limitInterval",60),p(this,"_currentCount",0),p(this,"_startPosition",null),p(this,"_startQuaternion",null),p(this,"_forwardPointerEvents",new Map)}start(){var n,e;if(this._currentCount=0,this._startPosition=null,this._startQuaternion=null,this.object||(this.object=this.gameObject),this.object){if(this.object===this.gameObject){const s=new Es(this.guid);this.object=ie.instantiate(this.object,{idProvider:s,keepWorldPosition:!1});const r=ie.getComponent(this.object,MZ);r?.destroy();let o=this.object.getComponentInChildren(Oo);o||(o=this.object.addComponent(Oo,{dragMode:AO.SnapToSurfaces}),o.guid=s.generateUUID());let a=ie.getComponent(o.gameObject,Sc);a||(a=o.gameObject.addComponent(Sc),a.guid=s.generateUUID())}this.object.visible=!1;const i=this.gameObject.getComponent(Oo);i&&(i.enabled=!1),this._startPosition=((n=this.object.position)==null?void 0:n.clone())??new E(0,0,0),this._startQuaternion=((e=this.object.quaternion)==null?void 0:e.clone())??new Se(0,0,0,1)}this.gameObject.getComponentInParent(ra)||this.gameObject.addComponent(ra),this.cloneLimitIntervalFn()}onPointerEnter(n){n.used||this.object&&this.context.connection.allowEditing&&n.button===0&&this.context.input.setCursorPointer()}onPointerExit(n){n.used||this.object&&this.context.connection.allowEditing&&n.button===0&&this.context.input.setCursorNormal()}onPointerDown(n){if(n.used||!this.object||!this.context.connection.allowEditing||n.button!==0)return;const e=this.handleDuplication();if(e){const i=ie.getComponent(e,Oo);i?(i.onPointerDown(n),this._forwardPointerEvents.set(n.event.space,i)):console.warn("Duplicated object does not have DragControls",e)}else console.warn("Could not duplicate object. Has the target object been destroyed?",this)}onPointerUp(n){if(n.used)return;const e=this._forwardPointerEvents.get(n.event.space);e&&(e.onPointerUp(n),this._forwardPointerEvents.delete(n.event.space))}cloneLimitIntervalFn(){this.destroyed||(this._currentCount>0&&(this._currentCount-=1),setTimeout(()=>{this.cloneLimitIntervalFn()},this.limitInterval/this.limitCount*1e3))}handleDuplication(){var n;if(!this.object||this._currentCount>=this.limitCount||this.object===this.gameObject)return null;if(ie.isDestroyed(this.object))return this.object=null,null;this.object.visible=!0,this._startPosition&&this.object.position.copy(this._startPosition),this._startQuaternion&&this.object.quaternion.copy(this._startQuaternion);const e=new Jl;this.parent||(this.parent=this.gameObject.parent),this.parent&&(e.parent=this.parent.guid??((n=this.parent.userData)==null?void 0:n.guid),e.keepWorldPosition=!0),e.position=this.worldPosition,e.rotation=this.worldQuaternion,e.context=this.context,this._currentCount+=1;const i=ie.instantiateSynced(this.object,e);return console.assert(i!==this.object,"Duplicated object is original"),this.object.visible=!1,this._startPosition&&this.object.position.clone().copy(this._startPosition),this._startQuaternion&&this.object.quaternion.clone().copy(this._startQuaternion),i}};let tf=MZ;JM([T(ye)],tf.prototype,"parent",2),JM([T(ye)],tf.prototype,"object",2),JM([T()],tf.prototype,"limitCount",2),JM([T()],tf.prototype,"limitInterval",2);class px extends Vs{constructor(e){super(),p(this,"effect"),this.effect=e}get typeName(){return this.effect.constructor.name}onCreateEffect(){return this.effect}}var $0=(n=>(n[n.PointerEnter=0]="PointerEnter",n[n.PointerExit=1]="PointerExit",n[n.PointerDown=2]="PointerDown",n[n.PointerUp=3]="PointerUp",n[n.PointerClick=4]="PointerClick",n[n.Drag=5]="Drag",n[n.Drop=6]="Drop",n[n.Scroll=7]="Scroll",n[n.UpdateSelected=8]="UpdateSelected",n[n.Select=9]="Select",n[n.Deselect=10]="Deselect",n[n.Move=11]="Move",n[n.InitializePotentialDrag=12]="InitializePotentialDrag",n[n.BeginDrag=13]="BeginDrag",n[n.EndDrag=14]="EndDrag",n[n.Submit=15]="Submit",n[n.Cancel=16]="Cancel",n))($0||{}),OAe=Object.defineProperty,GAe=Object.getOwnPropertyDescriptor,wO=(n,e,i,s)=>{for(var r=s>1?void 0:s?GAe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&OAe(e,i,r),r};class _O{constructor(){p(this,"eventID"),p(this,"callback")}}wO([T()],_O.prototype,"eventID",2),wO([T(en)],_O.prototype,"callback",2);class qM extends Pe{constructor(){super(...arguments),p(this,"triggers",[])}invoke(e){var i;if(this.triggers)for(const s of this.triggers)s.eventID===e&&((i=s.callback)==null||i.invoke())}onPointerClick(e){this.invoke($0.PointerClick)}onPointerEnter(e){this.invoke($0.PointerEnter)}onPointerExit(e){this.invoke($0.PointerExit)}onPointerDown(e){this.invoke($0.PointerDown)}onPointerUp(e){this.invoke($0.PointerUp)}}wO([T(_O)],qM.prototype,"triggers",2);var zAe=Object.defineProperty,FAe=Object.getOwnPropertyDescriptor,SO=(n,e,i,s)=>{for(var r=s>1?void 0:s?FAe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&zAe(e,i,r),r};class CO extends Pe{constructor(){super(...arguments),p(this,"connectedBody"),p(this,"_rigidBody",null)}get rigidBody(){return this._rigidBody}onEnable(){this._rigidBody||(this._rigidBody=this.gameObject.getComponent(Li)),this.rigidBody&&this.connectedBody&&this.startCoroutine(this.create())}*create(){yield,this.rigidBody&&this.connectedBody&&this.activeAndEnabled&&this.createJoint(this.rigidBody,this.connectedBody)}}SO([T(Li)],CO.prototype,"connectedBody",2);class MO extends CO{createJoint(e,i){var s;(s=this.context.physics.engine)==null||s.addFixedJoint(e,i)}}class mx extends CO{constructor(){super(...arguments),p(this,"anchor"),p(this,"axis")}createJoint(e,i){var s;this.axis&&this.anchor&&((s=this.context.physics.engine)==null||s.addHingeJoint(e,i,this.anchor,this.axis))}}SO([T(E)],mx.prototype,"anchor",2),SO([T(E)],mx.prototype,"axis",2);const NAe={type:"change"};let UAe=class extends Rs{constructor(n,e){super(),this.object=n,this.domElement=e,this.enabled=!0,this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1;const i=this,s=1e-6,r=new Se,o=new E;this.tmpQuaternion=new Se,this.status=0,this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this.moveVector=new E(0,0,0),this.rotationVector=new E(0,0,0),this.keydown=function(f){if(!(f.altKey||this.enabled===!1)){switch(f.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this.moveState.forward=1;break;case"KeyS":this.moveState.back=1;break;case"KeyA":this.moveState.left=1;break;case"KeyD":this.moveState.right=1;break;case"KeyR":this.moveState.up=1;break;case"KeyF":this.moveState.down=1;break;case"ArrowUp":this.moveState.pitchUp=1;break;case"ArrowDown":this.moveState.pitchDown=1;break;case"ArrowLeft":this.moveState.yawLeft=1;break;case"ArrowRight":this.moveState.yawRight=1;break;case"KeyQ":this.moveState.rollLeft=1;break;case"KeyE":this.moveState.rollRight=1;break}this.updateMovementVector(),this.updateRotationVector()}},this.keyup=function(f){if(this.enabled!==!1){switch(f.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this.moveState.forward=0;break;case"KeyS":this.moveState.back=0;break;case"KeyA":this.moveState.left=0;break;case"KeyD":this.moveState.right=0;break;case"KeyR":this.moveState.up=0;break;case"KeyF":this.moveState.down=0;break;case"ArrowUp":this.moveState.pitchUp=0;break;case"ArrowDown":this.moveState.pitchDown=0;break;case"ArrowLeft":this.moveState.yawLeft=0;break;case"ArrowRight":this.moveState.yawRight=0;break;case"KeyQ":this.moveState.rollLeft=0;break;case"KeyE":this.moveState.rollRight=0;break}this.updateMovementVector(),this.updateRotationVector()}},this.pointerdown=function(f){if(this.enabled!==!1)if(this.dragToLook)this.status++;else{switch(f.button){case 0:this.moveState.forward=1;break;case 2:this.moveState.back=1;break}this.updateMovementVector()}},this.pointermove=function(f){if(this.enabled!==!1&&(!this.dragToLook||this.status>0)){const g=this.getContainerDimensions(),y=g.size[0]/2,v=g.size[1]/2;this.moveState.yawLeft=-(f.pageX-g.offset[0]-y)/y,this.moveState.pitchDown=(f.pageY-g.offset[1]-v)/v,this.updateRotationVector()}},this.pointerup=function(f){if(this.enabled!==!1){if(this.dragToLook)this.status--,this.moveState.yawLeft=this.moveState.pitchDown=0;else{switch(f.button){case 0:this.moveState.forward=0;break;case 2:this.moveState.back=0;break}this.updateMovementVector()}this.updateRotationVector()}},this.pointercancel=function(){this.enabled!==!1&&(this.dragToLook?(this.status=0,this.moveState.yawLeft=this.moveState.pitchDown=0):(this.moveState.forward=0,this.moveState.back=0,this.updateMovementVector()),this.updateRotationVector())},this.contextMenu=function(f){this.enabled!==!1&&f.preventDefault()},this.update=function(f){if(this.enabled===!1)return;const g=f*i.movementSpeed,y=f*i.rollSpeed;i.object.translateX(i.moveVector.x*g),i.object.translateY(i.moveVector.y*g),i.object.translateZ(i.moveVector.z*g),i.tmpQuaternion.set(i.rotationVector.x*y,i.rotationVector.y*y,i.rotationVector.z*y,1).normalize(),i.object.quaternion.multiply(i.tmpQuaternion),(o.distanceToSquared(i.object.position)>s||8*(1-r.dot(i.object.quaternion))>s)&&(i.dispatchEvent(NAe),r.copy(i.object.quaternion),o.copy(i.object.position))},this.updateMovementVector=function(){const f=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-f+this.moveState.back},this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft},this.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}},this.dispose=function(){this.domElement.removeEventListener("contextmenu",a),this.domElement.removeEventListener("pointerdown",c),this.domElement.removeEventListener("pointermove",l),this.domElement.removeEventListener("pointerup",h),this.domElement.removeEventListener("pointercancel",u),window.removeEventListener("keydown",d),window.removeEventListener("keyup",m)};const a=this.contextMenu.bind(this),l=this.pointermove.bind(this),c=this.pointerdown.bind(this),h=this.pointerup.bind(this),u=this.pointercancel.bind(this),d=this.keydown.bind(this),m=this.keyup.bind(this);this.domElement.addEventListener("contextmenu",a),this.domElement.addEventListener("pointerdown",c),this.domElement.addEventListener("pointermove",l),this.domElement.addEventListener("pointerup",h),this.domElement.addEventListener("pointercancel",u),window.addEventListener("keydown",d),window.addEventListener("keyup",m),this.updateMovementVector(),this.updateRotationVector()}};class EO extends Pe{constructor(){super(...arguments),p(this,"_controls",null)}onEnable(){var e;const i=(e=ie.getComponent(this.gameObject,Fi))==null?void 0:e.threeCamera;if(!i){console.warn("FlyControls: Requires a Camera component on the same object as this component.");return}this._controls=new UAe(i,this.context.renderer.domElement),this._controls.rollSpeed=.5,this._controls.movementSpeed=3,this._controls.dragToLook=!0}onDisable(){var e;(e=this._controls)==null||e.dispose(),this._controls=null}update(){this._controls&&this._controls.update(this.context.time.deltaTime)}}var VAe=Object.defineProperty,XAe=Object.getOwnPropertyDescriptor,TO=(n,e,i,s)=>{for(var r=s>1?void 0:s?XAe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&VAe(e,i,r),r};class ey extends Pe{constructor(){super(...arguments),p(this,"_fog")}get fog(){return this._fog||(this._fog=new vw(0,0,50)),this._fog}get mode(){return 1}set near(e){this.fog.near=e}get near(){return this.fog.near}set far(e){this.fog.far=e}get far(){return this.fog.far}set color(e){this.fog.color.copy(e)}get color(){return this.fog.color}onEnable(){this.scene.fog=this.fog}onDisable(){this.scene.fog===this._fog&&(this.scene.fog=null)}}TO([T()],ey.prototype,"near",1),TO([T()],ey.prototype,"far",1),TO([T(Ae)],ey.prototype,"color",1);let fx,RO,ty,$M;function IO(n,e=1/0,i=null){RO||(RO=new ds(2,2,1,1)),ty||(ty=new kt({uniforms:{blitTexture:new Ce(n)},vertexShader:`
			varying vec2 vUv;
			void main(){
				vUv = uv;
				gl_Position = vec4(position.xy * 1.0,0.,.999999);
			}`,fragmentShader:`
			uniform sampler2D blitTexture; 
			varying vec2 vUv;

			void main(){ 
				gl_FragColor = vec4(vUv.xy, 0, 1);
				
				#ifdef IS_SRGB
				gl_FragColor = LinearTosRGB( texture2D( blitTexture, vUv) );
				#else
				gl_FragColor = texture2D( blitTexture, vUv);
				#endif
			}`})),ty.uniforms.blitTexture.value=n,ty.defines.IS_SRGB=n.colorSpace==vt,ty.needsUpdate=!0,$M||($M=new pe(RO,ty),$M.frustrumCulled=!1);const s=new Lt,r=new Ls;r.add($M),i===null&&(i=fx=new gh({antialias:!1}));const o=Math.min(n.image.width,e),a=Math.min(n.image.height,e);i.setSize(o,a),i.clear(),i.render(r,s);const l=document.createElement("canvas"),c=l.getContext("2d");l.width=o,l.height=a,c.drawImage(i.domElement,0,0,o,a);const h=new E2(l);return h.minFilter=n.minFilter,h.magFilter=n.magFilter,h.wrapS=n.wrapS,h.wrapT=n.wrapT,h.name=n.name,fx&&(fx.forceContextLoss(),fx.dispose(),fx=null),h}const EZ={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class eE{constructor(){this.pluginCallbacks=[],this.register(function(e){return new $Ae(e)}),this.register(function(e){return new exe(e)}),this.register(function(e){return new nxe(e)}),this.register(function(e){return new sxe(e)}),this.register(function(e){return new rxe(e)}),this.register(function(e){return new oxe(e)}),this.register(function(e){return new txe(e)}),this.register(function(e){return new ixe(e)}),this.register(function(e){return new axe(e)}),this.register(function(e){return new lxe(e)}),this.register(function(e){return new cxe(e)}),this.register(function(e){return new hxe(e)}),this.register(function(e){return new uxe(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,i,s,r){const o=new qAe,a=[];for(let l=0,c=this.pluginCallbacks.length;l<c;l++)a.push(this.pluginCallbacks[l](o));o.setPlugins(a),o.write(e,i,r).catch(s)}parseAsync(e,i){const s=this;return new Promise(function(r,o){s.parse(e,r,o,i)})}}const gi={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},LO="KHR_mesh_quantization",ya={};ya[Dt]=gi.NEAREST,ya[Pf]=gi.NEAREST_MIPMAP_NEAREST,ya[ah]=gi.NEAREST_MIPMAP_LINEAR,ya[Ot]=gi.LINEAR,ya[wp]=gi.LINEAR_MIPMAP_NEAREST,ya[So]=gi.LINEAR_MIPMAP_LINEAR,ya[qn]=gi.CLAMP_TO_EDGE,ya[_o]=gi.REPEAT,ya[oh]=gi.MIRRORED_REPEAT;const TZ={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},WAe=new Ae,RZ=12,HAe=1179937895,jAe=2,IZ=8,QAe=1313821514,ZAe=5130562;function gx(n,e){return n.length===e.length&&n.every(function(i,s){return i===e[s]})}function YAe(n){return new TextEncoder().encode(n).buffer}function KAe(n){return gx(n.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function JAe(n,e,i){const s={min:new Array(n.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(n.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let r=e;r<e+i;r++)for(let o=0;o<n.itemSize;o++){let a;n.itemSize>4?a=n.array[r*n.itemSize+o]:(o===0?a=n.getX(r):o===1?a=n.getY(r):o===2?a=n.getZ(r):o===3&&(a=n.getW(r)),n.normalized===!0&&(a=oi.normalize(a,n.array))),s.min[o]=Math.min(s.min[o],a),s.max[o]=Math.max(s.max[o],a)}return s}function LZ(n){return Math.ceil(n/4)*4}function PO(n,e=0){const i=LZ(n.byteLength);if(i!==n.byteLength){const s=new Uint8Array(i);if(s.set(new Uint8Array(n)),e!==0)for(let r=n.byteLength;r<i;r++)s[r]=e;return s.buffer}return n}function PZ(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function BZ(n,e){if(n.toBlob!==void 0)return new Promise(s=>n.toBlob(s,e));let i;return e==="image/jpeg"?i=.92:e==="image/webp"&&(i=.8),n.convertToBlob({type:e,quality:i})}class qAe{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,i,s={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},s),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const r=this,o=r.buffers,a=r.json;s=r.options;const l=r.extensionsUsed,c=r.extensionsRequired,h=new Blob(o,{type:"application/octet-stream"}),u=Object.keys(l),d=Object.keys(c);if(u.length>0&&(a.extensionsUsed=u),d.length>0&&(a.extensionsRequired=d),a.buffers&&a.buffers.length>0&&(a.buffers[0].byteLength=h.size),s.binary===!0){const m=new FileReader;m.readAsArrayBuffer(h),m.onloadend=function(){const f=PO(m.result),g=new DataView(new ArrayBuffer(IZ));g.setUint32(0,f.byteLength,!0),g.setUint32(4,ZAe,!0);const y=PO(YAe(JSON.stringify(a)),32),v=new DataView(new ArrayBuffer(IZ));v.setUint32(0,y.byteLength,!0),v.setUint32(4,QAe,!0);const b=new ArrayBuffer(RZ),A=new DataView(b);A.setUint32(0,HAe,!0),A.setUint32(4,jAe,!0);const x=RZ+v.byteLength+y.byteLength+g.byteLength+f.byteLength;A.setUint32(8,x,!0);const w=new Blob([b,v,y,g,f],{type:"application/octet-stream"}),_=new FileReader;_.readAsArrayBuffer(w),_.onloadend=function(){i(_.result)}}}else if(a.buffers&&a.buffers.length>0){const m=new FileReader;m.readAsDataURL(h),m.onloadend=function(){const f=m.result;a.buffers[0].uri=f,i(a)}}else i(a)}serializeUserData(e,i){if(Object.keys(e.userData).length===0)return;const s=this.options,r=this.extensionsUsed;try{const o=JSON.parse(JSON.stringify(e.userData));if(s.includeCustomExtensions&&o.gltfExtensions){i.extensions===void 0&&(i.extensions={});for(const a in o.gltfExtensions)i.extensions[a]=o.gltfExtensions[a],r[a]=!0;delete o.gltfExtensions}Object.keys(o).length>0&&(i.extras=o)}catch(o){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+o.message)}}getUID(e,i=!1){if(this.uids.has(e)===!1){const s=new Map;s.set(!0,this.uid++),s.set(!1,this.uid++),this.uids.set(e,s)}return this.uids.get(e).get(i)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const i=new E;for(let s=0,r=e.count;s<r;s++)if(Math.abs(i.fromBufferAttribute(e,s).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const i=this.cache;if(i.attributesNormalized.has(e))return i.attributesNormalized.get(e);const s=e.clone(),r=new E;for(let o=0,a=s.count;o<a;o++)r.fromBufferAttribute(s,o),r.x===0&&r.y===0&&r.z===0?r.setX(1):r.normalize(),s.setXYZ(o,r.x,r.y,r.z);return i.attributesNormalized.set(e,s),s}applyTextureTransform(e,i){let s=!1;const r={};(i.offset.x!==0||i.offset.y!==0)&&(r.offset=i.offset.toArray(),s=!0),i.rotation!==0&&(r.rotation=i.rotation,s=!0),(i.repeat.x!==1||i.repeat.y!==1)&&(r.scale=i.repeat.toArray(),s=!0),s&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=r,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,i){if(e===i)return e;function s(m){return m.colorSpace===vt?function(f){return f<.04045?f*.0773993808:Math.pow(f*.9478672986+.0521327014,2.4)}:function(f){return f}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),e instanceof Gu&&(e=IO(e)),i instanceof Gu&&(i=IO(i));const r=e?e.image:null,o=i?i.image:null,a=Math.max(r?r.width:0,o?o.width:0),l=Math.max(r?r.height:0,o?o.height:0),c=PZ();c.width=a,c.height=l;const h=c.getContext("2d");h.fillStyle="#00ffff",h.fillRect(0,0,a,l);const u=h.getImageData(0,0,a,l);if(r){h.drawImage(r,0,0,a,l);const m=s(e),f=h.getImageData(0,0,a,l).data;for(let g=2;g<f.length;g+=4)u.data[g]=m(f[g]/256)*256}if(o){h.drawImage(o,0,0,a,l);const m=s(i),f=h.getImageData(0,0,a,l).data;for(let g=1;g<f.length;g+=4)u.data[g]=m(f[g]/256)*256}h.putImageData(u,0,0);const d=(e||i).clone();return d.source=new ch(c),d.colorSpace=Co,d.channel=(e||i).channel,e&&i&&e.channel!==i.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),d}processBuffer(e){const i=this.json,s=this.buffers;return i.buffers||(i.buffers=[{byteLength:0}]),s.push(e),0}processBufferView(e,i,s,r,o){const a=this.json;a.bufferViews||(a.bufferViews=[]);let l;switch(i){case gi.BYTE:case gi.UNSIGNED_BYTE:l=1;break;case gi.SHORT:case gi.UNSIGNED_SHORT:l=2;break;default:l=4}const c=LZ(r*e.itemSize*l),h=new DataView(new ArrayBuffer(c));let u=0;for(let m=s;m<s+r;m++)for(let f=0;f<e.itemSize;f++){let g;e.itemSize>4?g=e.array[m*e.itemSize+f]:(f===0?g=e.getX(m):f===1?g=e.getY(m):f===2?g=e.getZ(m):f===3&&(g=e.getW(m)),e.normalized===!0&&(g=oi.normalize(g,e.array))),i===gi.FLOAT?h.setFloat32(u,g,!0):i===gi.INT?h.setInt32(u,g,!0):i===gi.UNSIGNED_INT?h.setUint32(u,g,!0):i===gi.SHORT?h.setInt16(u,g,!0):i===gi.UNSIGNED_SHORT?h.setUint16(u,g,!0):i===gi.BYTE?h.setInt8(u,g):i===gi.UNSIGNED_BYTE&&h.setUint8(u,g),u+=l}const d={buffer:this.processBuffer(h.buffer),byteOffset:this.byteOffset,byteLength:c};return o!==void 0&&(d.target=o),o===gi.ARRAY_BUFFER&&(d.byteStride=e.itemSize*l),this.byteOffset+=c,a.bufferViews.push(d),{id:a.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const i=this,s=i.json;return s.bufferViews||(s.bufferViews=[]),new Promise(function(r){const o=new FileReader;o.readAsArrayBuffer(e),o.onloadend=function(){const a=PO(o.result),l={buffer:i.processBuffer(a),byteOffset:i.byteOffset,byteLength:a.byteLength};i.byteOffset+=a.byteLength,r(s.bufferViews.push(l)-1)}})}processAccessor(e,i,s,r){const o=this.json,a={1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"};let l;if(e.array.constructor===Float32Array)l=gi.FLOAT;else if(e.array.constructor===Int32Array)l=gi.INT;else if(e.array.constructor===Uint32Array)l=gi.UNSIGNED_INT;else if(e.array.constructor===Int16Array)l=gi.SHORT;else if(e.array.constructor===Uint16Array)l=gi.UNSIGNED_SHORT;else if(e.array.constructor===Int8Array)l=gi.BYTE;else if(e.array.constructor===Uint8Array)l=gi.UNSIGNED_BYTE;else throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+e.array.constructor.name);if(s===void 0&&(s=0),(r===void 0||r===1/0)&&(r=e.count),r===0)return null;const c=JAe(e,s,r);let h;i!==void 0&&(h=e===i.index?gi.ELEMENT_ARRAY_BUFFER:gi.ARRAY_BUFFER);const u=this.processBufferView(e,l,s,r,h),d={bufferView:u.id,byteOffset:u.byteOffset,componentType:l,count:r,max:c.max,min:c.min,type:a[e.itemSize]};return e.normalized===!0&&(d.normalized=!0),o.accessors||(o.accessors=[]),o.accessors.push(d)-1}processImage(e,i,s,r="image/png"){if(e!==null){const o=this,a=o.cache,l=o.json,c=o.options,h=o.pending;a.images.has(e)||a.images.set(e,{});const u=a.images.get(e),d=r+":flipY/"+s.toString();if(u[d]!==void 0)return u[d];l.images||(l.images=[]);const m={mimeType:r},f=PZ();f.width=Math.min(e.width,c.maxTextureSize),f.height=Math.min(e.height,c.maxTextureSize);const g=f.getContext("2d");if(s===!0&&(g.translate(0,f.height),g.scale(1,-1)),e.data!==void 0){i!==_i&&console.error("GLTFExporter: Only RGBAFormat is supported.",i),(e.width>c.maxTextureSize||e.height>c.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const v=new Uint8ClampedArray(e.height*e.width*4);for(let b=0;b<v.length;b+=4)v[b+0]=e.data[b+0],v[b+1]=e.data[b+1],v[b+2]=e.data[b+2],v[b+3]=e.data[b+3];g.putImageData(new ImageData(v,e.width,e.height),0,0)}else if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)g.drawImage(e,0,0,f.width,f.height);else throw new Error("THREE.GLTFExporter: Invalid image type. Use HTMLImageElement, HTMLCanvasElement, ImageBitmap or OffscreenCanvas.");c.binary===!0?h.push(BZ(f,r).then(v=>o.processBufferViewImage(v)).then(v=>{m.bufferView=v})):f.toDataURL!==void 0?m.uri=f.toDataURL(r):h.push(BZ(f,r).then(v=>new FileReader().readAsDataURL(v)).then(v=>{m.uri=v}));const y=l.images.push(m)-1;return u[d]=y,y}else throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){const i=this.json;i.samplers||(i.samplers=[]);const s={magFilter:ya[e.magFilter],minFilter:ya[e.minFilter],wrapS:ya[e.wrapS],wrapT:ya[e.wrapT]};return i.samplers.push(s)-1}processTexture(e){const i=this.options,s=this.cache,r=this.json;if(s.textures.has(e))return s.textures.get(e);const o={keep:!0,newTexture:null};if(this._invokeAll(function(h){h.beforeWriteTexture&&h.beforeWriteTexture(e,o)}),o.keep===!1)return null;o.newTexture!=null&&(e=o.newTexture),r.textures||(r.textures=[]),e instanceof Gu&&(e=IO(e,i.maxTextureSize));let a=e.userData.mimeType;a==="image/webp"&&(a="image/png");const l={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,a)};e.name&&(l.name=e.name),this._invokeAll(function(h){h.writeTexture&&h.writeTexture(e,l)});const c=r.textures.push(l)-1;return s.textures.set(e,c),c}processMaterial(e){var i,s,r,o,a;const l=this.cache,c=this.json;if(l.materials.has(e))return l.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;c.materials||(c.materials=[]);const h={pbrMetallicRoughness:{}};e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const u=e.color.toArray().concat([e.opacity]);gx(u,[1,1,1,1])||(h.pbrMetallicRoughness.baseColorFactor=u),e.isMeshStandardMaterial?(h.pbrMetallicRoughness.metallicFactor=e.metalness,h.pbrMetallicRoughness.roughnessFactor=e.roughness):(h.pbrMetallicRoughness.metallicFactor=.5,h.pbrMetallicRoughness.roughnessFactor=.5);const d=(i=e.metalnessMap)!=null&&i.image?e.metalnessMap:void 0,m=(s=e.roughnessMap)!=null&&s.image?e.roughnessMap:void 0;if(d||m){const g=this.buildMetalRoughTexture(d,m),y={index:this.processTexture(g),channel:g.channel};this.applyTextureTransform(y,g),h.pbrMetallicRoughness.metallicRoughnessTexture=y}if(e.map){const g={index:this.processTexture(e.map),texCoord:e.map.channel};this.applyTextureTransform(g,e.map),h.pbrMetallicRoughness.baseColorTexture=g}if(e.emissive){const g=e.emissive;if(Math.max(g.r,g.g,g.b)>0&&(h.emissiveFactor=e.emissive.toArray()),(r=e.emissiveMap)!=null&&r.image){const y={index:this.processTexture(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(y,e.emissiveMap),h.emissiveTexture=y}}if((o=e.normalMap)!=null&&o.image){const g={index:this.processTexture(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&e.normalScale.x!==1&&(g.scale=e.normalScale.x),this.applyTextureTransform(g,e.normalMap),h.normalTexture=g}if((a=e.aoMap)!=null&&a.image){const g={index:this.processTexture(e.aoMap),texCoord:e.aoMap.channel};e.aoMapIntensity!==1&&(g.strength=e.aoMapIntensity),this.applyTextureTransform(g,e.aoMap),h.occlusionTexture=g}e.transparent?h.alphaMode="BLEND":e.alphaTest>0&&(h.alphaMode="MASK",h.alphaCutoff=e.alphaTest),e.side===xi&&(h.doubleSided=!0),e.name!==""&&(h.name=e.name),this.serializeUserData(e,h),this._invokeAll(function(g){g.writeMaterial&&g.writeMaterial(e,h)});const f=c.materials.push(h)-1;return l.materials.set(e,f),f}processMesh(e){const i={keep:!0};if(this._invokeAll(function(_){_.beforeWriteMesh&&_.beforeWriteMesh(e,i)}),i.keep!=!0)return null;const s=this.cache,r=this.json,o=[e.geometry.uuid];if(Array.isArray(e.material))for(let _=0,S=e.material.length;_<S;_++)o.push(e.material[_].uuid);else o.push(e.material.uuid);const a=o.join(":");if(s.meshes.has(a))return s.meshes.get(a);const l=e.geometry;let c;e.isLineSegments?c=gi.LINES:e.isLineLoop?c=gi.LINE_LOOP:e.isLine?c=gi.LINE_STRIP:e.isPoints?c=gi.POINTS:c=e.material.wireframe?gi.LINES:gi.TRIANGLES;const h={},u={},d=[],m=[],f={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",uv2:"TEXCOORD_2",uv3:"TEXCOORD_3",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},g=l.getAttribute("normal");g!==void 0&&!this.isNormalizedNormalAttribute(g)&&(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),l.setAttribute("normal",this.createNormalizedNormalAttribute(g)));let y=null;for(let _ in l.attributes){if(_.slice(0,5)==="morph")continue;const S=l.attributes[_];if(_=f[_]||_.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(_)||(_="_"+_),s.attributes.has(this.getUID(S))){u[_]=s.attributes.get(this.getUID(S));continue}y=null;const M=S.array;_==="JOINTS_0"&&!(M instanceof Uint16Array)&&!(M instanceof Uint8Array)&&(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),y=new qe(new Uint16Array(M),S.itemSize,S.normalized));const R=this.processAccessor(y||S,l);R!==null&&(_.startsWith("_")||this.detectMeshQuantization(_,S),u[_]=R,s.attributes.set(this.getUID(S),R))}if(g!==void 0&&l.setAttribute("normal",g),Object.keys(u).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){const _=[],S=[],M={};if(e.morphTargetDictionary!==void 0)for(const R in e.morphTargetDictionary)M[e.morphTargetDictionary[R]]=R;for(let R=0;R<e.morphTargetInfluences.length;++R){const P={};let C=!1;for(const L in l.morphAttributes){if(L!=="position"&&L!=="normal"){C||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),C=!0);continue}const B=l.morphAttributes[L][R],z=L.toUpperCase(),D=l.attributes[L];if(s.attributes.has(this.getUID(B,!0))){P[z]=s.attributes.get(this.getUID(B,!0));continue}const W=B.clone();if(!l.morphTargetsRelative)for(let O=0,F=B.count;O<F;O++)for(let X=0;X<B.itemSize;X++)X===0&&W.setX(O,B.getX(O)-D.getX(O)),X===1&&W.setY(O,B.getY(O)-D.getY(O)),X===2&&W.setZ(O,B.getZ(O)-D.getZ(O)),X===3&&W.setW(O,B.getW(O)-D.getW(O));P[z]=this.processAccessor(W,l),s.attributes.set(this.getUID(D,!0),P[z])}m.push(P),_.push(e.morphTargetInfluences[R]),e.morphTargetDictionary!==void 0&&S.push(M[R])}h.weights=_,S.length>0&&(h.extras={},h.extras.targetNames=S)}const v=Array.isArray(e.material);if(v&&l.groups.length===0)return null;let b=!1;if(v&&l.index===null){const _=[];for(let S=0,M=l.attributes.position.count;S<M;S++)_[S]=S;l.setIndex(_),b=!0}const A=v?e.material:[e.material],x=v?l.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let _=0,S=x.length;_<S;_++){const M={mode:c,attributes:u};if(this.serializeUserData(l,M),m.length>0&&(M.targets=m),l.index!==null){let P=this.getUID(l.index);(x[_].start!==void 0||x[_].count!==void 0)&&(P+=":"+x[_].start+":"+x[_].count),s.attributes.has(P)?M.indices=s.attributes.get(P):(M.indices=this.processAccessor(l.index,l,x[_].start,x[_].count),s.attributes.set(P,M.indices)),M.indices===null&&delete M.indices}const R=this.processMaterial(A[x[_].materialIndex]);R!==null&&(M.material=R),d.push(M)}b===!0&&l.setIndex(null),h.primitives=d,r.meshes||(r.meshes=[]),this._invokeAll(function(_){_.writeMesh&&_.writeMesh(e,h)});const w=r.meshes.push(h)-1;return s.meshes.set(a,w),w}detectMeshQuantization(e,i){if(this.extensionsUsed[LO])return;let s;switch(i.array.constructor){case Int8Array:s="byte";break;case Uint8Array:s="unsigned byte";break;case Int16Array:s="short";break;case Uint16Array:s="unsigned short";break;default:return}i.normalized&&(s+=" normalized");const r=e.split("_",1)[0];EZ[r]&&EZ[r].includes(s)&&(this.extensionsUsed[LO]=!0,this.extensionsRequired[LO]=!0)}processCamera(e){const i=this.json;i.cameras||(i.cameras=[]);const s=e.isOrthographicCamera,r={type:s?"orthographic":"perspective"};return s?r.orthographic={xmag:e.right*2,ymag:e.top*2,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:r.perspective={aspectRatio:e.aspect,yfov:oi.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(r.name=e.type),i.cameras.push(r)-1}processAnimation(e,i){const s=this.json,r=this.nodeMap;s.animations||(s.animations=[]),e=eE.Utils.mergeMorphTargetTracks(e.clone(),i);const o=e.tracks,a=[],l=[];for(let c=0;c<o.length;++c){const h=o[c],u=Jt.parseTrackName(h.name);let d=Jt.findNode(i,u.nodeName);const m=TZ[u.propertyName];if(u.objectName==="bones"&&(d.isSkinnedMesh===!0?d=d.skeleton.getBoneByName(u.objectIndex):d=void 0),!d||!m)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',h.name),null;const f=1;let g=h.values.length/h.times.length;m===TZ.morphTargetInfluences&&(g/=d.morphTargetInfluences.length);let y;h.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(y="CUBICSPLINE",g/=3):h.getInterpolation()===Mu?y="STEP":y="LINEAR",l.push({input:this.processAccessor(new qe(h.times,f)),output:this.processAccessor(new qe(h.values,g)),interpolation:y}),a.push({sampler:l.length-1,target:{node:r.get(d),path:m}})}return s.animations.push({name:e.name||"clip_"+s.animations.length,samplers:l,channels:a}),s.animations.length-1}processSkin(e){const i=this.json,s=this.nodeMap,r=i.nodes[s.get(e)],o=e.skeleton;if(o===void 0)return null;const a=e.skeleton.bones[0];if(a===void 0)return null;const l=[],c=new Float32Array(o.bones.length*16),h=new he;for(let u=0;u<o.bones.length;++u)l.push(s.get(o.bones[u])),h.copy(o.boneInverses[u]),h.multiply(e.bindMatrix).toArray(c,u*16);return i.skins===void 0&&(i.skins=[]),i.skins.push({inverseBindMatrices:this.processAccessor(new qe(c,16)),joints:l,skeleton:s.get(a)}),r.skin=i.skins.length-1}processNode(e){const i={keep:!0};if(this._invokeAll(function(c){c.beforeWriteNode&&c.beforeWriteNode(e,i)}),i.keep!=!0)return null;const s=this.json,r=this.options,o=this.nodeMap;s.nodes||(s.nodes=[]);const a={};if(r.trs){const c=e.quaternion.toArray(),h=e.position.toArray(),u=e.scale.toArray();gx(c,[0,0,0,1])||(a.rotation=c),gx(h,[0,0,0])||(a.translation=h),gx(u,[1,1,1])||(a.scale=u)}else e.matrixAutoUpdate&&e.updateMatrix(),KAe(e.matrix)===!1&&(a.matrix=e.matrix.elements);if(e.name!==""&&(a.name=String(e.name)),this.serializeUserData(e,a),e.isMesh||e.isLine||e.isPoints){const c=this.processMesh(e);c!==null&&(a.mesh=c)}else e.isCamera&&(a.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const c=[];for(let h=0,u=e.children.length;h<u;h++){const d=e.children[h];if(d.visible||r.onlyVisible===!1){const m=this.processNode(d);m!==null&&c.push(m)}}c.length>0&&(a.children=c)}this._invokeAll(function(c){c.writeNode&&c.writeNode(e,a)});const l=s.nodes.push(a)-1;return o.set(e,l),l}processScene(e){const i=this.json,s=this.options;i.scenes||(i.scenes=[],i.scene=0);const r={};e.name!==""&&(r.name=e.name),i.scenes.push(r);const o=[];for(let a=0,l=e.children.length;a<l;a++){const c=e.children[a];if(c.visible||s.onlyVisible===!1){const h=this.processNode(c);h!==null&&o.push(h)}}o.length>0&&(r.nodes=o),this.serializeUserData(e,r)}processObjects(e){const i=new Ls;i.name="AuxScene";for(let s=0;s<e.length;s++)i.children.push(e[s]);this.processScene(i)}processInput(e){const i=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(r){r.beforeParse&&r.beforeParse(e)});const s=[];for(let r=0;r<e.length;r++)e[r]instanceof Ls?this.processScene(e[r]):s.push(e[r]);s.length>0&&this.processObjects(s);for(let r=0;r<this.skins.length;++r)this.processSkin(this.skins[r]);for(let r=0;r<i.animations.length;++r)this.processAnimation(i.animations[r],e[0]);this._invokeAll(function(r){r.afterParse&&r.afterParse(e)})}_invokeAll(e){for(let i=0,s=this.plugins.length;i<s;i++)e(this.plugins[i])}}class $Ae{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,i){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight){console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);return}const s=this.writer,r=s.json,o=s.extensionsUsed,a={};e.name&&(a.name=e.name),a.color=e.color.toArray(),a.intensity=e.intensity,e.isDirectionalLight?a.type="directional":e.isPointLight?(a.type="point",e.distance>0&&(a.range=e.distance)):e.isSpotLight&&(a.type="spot",e.distance>0&&(a.range=e.distance),a.spot={},a.spot.innerConeAngle=(1-e.penumbra)*e.angle,a.spot.outerConeAngle=e.angle),e.decay!==void 0&&e.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),e.target&&(e.target.parent!==e||e.target.position.x!==0||e.target.position.y!==0||e.target.position.z!==-1)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),o[this.name]||(r.extensions=r.extensions||{},r.extensions[this.name]={lights:[]},o[this.name]=!0);const l=r.extensions[this.name].lights;l.push(a),i.extensions=i.extensions||{},i.extensions[this.name]={light:l.length-1}}}class exe{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,i){if(!e.isMeshBasicMaterial)return;const s=this.writer.extensionsUsed;i.extensions=i.extensions||{},i.extensions[this.name]={},s[this.name]=!0,i.pbrMetallicRoughness.metallicFactor=0,i.pbrMetallicRoughness.roughnessFactor=.9}}class txe{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.clearcoat===0)return;const s=this.writer,r=s.extensionsUsed,o={};if(o.clearcoatFactor=e.clearcoat,e.clearcoatMap){const a={index:s.processTexture(e.clearcoatMap),texCoord:e.clearcoatMap.channel};s.applyTextureTransform(a,e.clearcoatMap),o.clearcoatTexture=a}if(o.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const a={index:s.processTexture(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};s.applyTextureTransform(a,e.clearcoatRoughnessMap),o.clearcoatRoughnessTexture=a}if(e.clearcoatNormalMap){const a={index:s.processTexture(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};s.applyTextureTransform(a,e.clearcoatNormalMap),o.clearcoatNormalTexture=a}i.extensions=i.extensions||{},i.extensions[this.name]=o,r[this.name]=!0}}class ixe{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.iridescence===0)return;const s=this.writer,r=s.extensionsUsed,o={};if(o.iridescenceFactor=e.iridescence,e.iridescenceMap){const a={index:s.processTexture(e.iridescenceMap),texCoord:e.iridescenceMap.channel};s.applyTextureTransform(a,e.iridescenceMap),o.iridescenceTexture=a}if(o.iridescenceIor=e.iridescenceIOR,o.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],o.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const a={index:s.processTexture(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};s.applyTextureTransform(a,e.iridescenceThicknessMap),o.iridescenceThicknessTexture=a}i.extensions=i.extensions||{},i.extensions[this.name]=o,r[this.name]=!0}}class nxe{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const s=this.writer,r=s.extensionsUsed,o={};if(o.transmissionFactor=e.transmission,e.transmissionMap){const a={index:s.processTexture(e.transmissionMap),texCoord:e.transmissionMap.channel};s.applyTextureTransform(a,e.transmissionMap),o.transmissionTexture=a}i.extensions=i.extensions||{},i.extensions[this.name]=o,r[this.name]=!0}}class sxe{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const s=this.writer,r=s.extensionsUsed,o={};if(o.thicknessFactor=e.thickness,e.thicknessMap){const a={index:s.processTexture(e.thicknessMap),texCoord:e.thicknessMap.channel};s.applyTextureTransform(a,e.thicknessMap),o.thicknessTexture=a}o.attenuationDistance=e.attenuationDistance,o.attenuationColor=e.attenuationColor.toArray(),i.extensions=i.extensions||{},i.extensions[this.name]=o,r[this.name]=!0}}class rxe{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.ior===1.5)return;const s=this.writer.extensionsUsed,r={};r.ior=e.ior,i.extensions=i.extensions||{},i.extensions[this.name]=r,s[this.name]=!0}}class oxe{constructor(e){this.writer=e,this.name="KHR_materials_specular"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.specularIntensity===1&&e.specularColor.equals(WAe)&&!e.specularIntensityMap&&!e.specularColorMap)return;const s=this.writer,r=s.extensionsUsed,o={};if(e.specularIntensityMap){const a={index:s.processTexture(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};s.applyTextureTransform(a,e.specularIntensityMap),o.specularTexture=a}if(e.specularColorMap){const a={index:s.processTexture(e.specularColorMap),texCoord:e.specularColorMap.channel};s.applyTextureTransform(a,e.specularColorMap),o.specularColorTexture=a}o.specularFactor=e.specularIntensity,o.specularColorFactor=e.specularColor.toArray(),i.extensions=i.extensions||{},i.extensions[this.name]=o,r[this.name]=!0}}class axe{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.sheen==0)return;const s=this.writer,r=s.extensionsUsed,o={};if(e.sheenRoughnessMap){const a={index:s.processTexture(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};s.applyTextureTransform(a,e.sheenRoughnessMap),o.sheenRoughnessTexture=a}if(e.sheenColorMap){const a={index:s.processTexture(e.sheenColorMap),texCoord:e.sheenColorMap.channel};s.applyTextureTransform(a,e.sheenColorMap),o.sheenColorTexture=a}o.sheenRoughnessFactor=e.sheenRoughness,o.sheenColorFactor=e.sheenColor.toArray(),i.extensions=i.extensions||{},i.extensions[this.name]=o,r[this.name]=!0}}class lxe{constructor(e){this.writer=e,this.name="KHR_materials_anisotropy"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.anisotropy==0)return;const s=this.writer,r=s.extensionsUsed,o={};if(e.anisotropyMap){const a={index:s.processTexture(e.anisotropyMap)};s.applyTextureTransform(a,e.anisotropyMap),o.anisotropyTexture=a}o.anisotropyStrength=e.anisotropy,o.anisotropyRotation=e.anisotropyRotation,i.extensions=i.extensions||{},i.extensions[this.name]=o,r[this.name]=!0}}class cxe{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}writeMaterial(e,i){if(!e.isMeshStandardMaterial||e.emissiveIntensity===1)return;const s=this.writer.extensionsUsed,r={};r.emissiveStrength=e.emissiveIntensity,i.extensions=i.extensions||{},i.extensions[this.name]=r,s[this.name]=!0}}class hxe{constructor(e){this.writer=e,this.name="EXT_materials_bump"}writeMaterial(e,i){if(!e.isMeshStandardMaterial||e.bumpScale===1&&!e.bumpMap)return;const s=this.writer,r=s.extensionsUsed,o={};if(e.bumpMap){const a={index:s.processTexture(e.bumpMap),texCoord:e.bumpMap.channel};s.applyTextureTransform(a,e.bumpMap),o.bumpTexture=a}o.bumpFactor=e.bumpScale,i.extensions=i.extensions||{},i.extensions[this.name]=o,r[this.name]=!0}}class uxe{constructor(e){this.writer=e,this.name="EXT_mesh_gpu_instancing"}writeNode(e,i){if(!e.isInstancedMesh)return;const s=this.writer,r=e,o=new Float32Array(r.count*3),a=new Float32Array(r.count*4),l=new Float32Array(r.count*3),c=new he,h=new E,u=new Se,d=new E;for(let f=0;f<r.count;f++)r.getMatrixAt(f,c),c.decompose(h,u,d),h.toArray(o,f*3),u.toArray(a,f*4),d.toArray(l,f*3);const m={TRANSLATION:s.processAccessor(new qe(o,3)),ROTATION:s.processAccessor(new qe(a,4)),SCALE:s.processAccessor(new qe(l,3))};r.instanceColor&&(m._COLOR_0=s.processAccessor(r.instanceColor)),i.extensions=i.extensions||{},i.extensions[this.name]={attributes:m},s.extensionsUsed[this.name]=!0,s.extensionsRequired[this.name]=!0}}eE.Utils={insertKeyframe:function(n,e){const i=n.getValueSize(),s=new n.TimeBufferType(n.times.length+1),r=new n.ValueBufferType(n.values.length+i),o=n.createInterpolant(new n.ValueBufferType(i));let a;if(n.times.length===0){s[0]=e;for(let l=0;l<i;l++)r[l]=0;a=0}else if(e<n.times[0]){if(Math.abs(n.times[0]-e)<.001)return 0;s[0]=e,s.set(n.times,1),r.set(o.evaluate(e),0),r.set(n.values,i),a=0}else if(e>n.times[n.times.length-1]){if(Math.abs(n.times[n.times.length-1]-e)<.001)return n.times.length-1;s[s.length-1]=e,s.set(n.times,0),r.set(n.values,0),r.set(o.evaluate(e),n.values.length),a=s.length-1}else for(let l=0;l<n.times.length;l++){if(Math.abs(n.times[l]-e)<.001)return l;if(n.times[l]<e&&n.times[l+1]>e){s.set(n.times.slice(0,l+1),0),s[l+1]=e,s.set(n.times.slice(l+1),l+2),r.set(n.values.slice(0,(l+1)*i),0),r.set(o.evaluate(e),(l+1)*i),r.set(n.values.slice((l+1)*i),(l+2)*i),a=l+1;break}}return n.times=s,n.values=r,a},mergeMorphTargetTracks:function(n,e){const i=[],s={},r=n.tracks;for(let o=0;o<r.length;++o){let a=r[o];const l=Jt.parseTrackName(a.name),c=Jt.findNode(e,l.nodeName);if(l.propertyName!=="morphTargetInfluences"||l.propertyIndex===void 0){i.push(a);continue}if(a.createInterpolant!==a.InterpolantFactoryMethodDiscrete&&a.createInterpolant!==a.InterpolantFactoryMethodLinear){if(a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),a=a.clone(),a.setInterpolation(ec)}const h=c.morphTargetInfluences.length,u=c.morphTargetDictionary[l.propertyIndex];if(u===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+l.propertyIndex);let d;if(s[c.uuid]===void 0){d=a.clone();const f=new d.ValueBufferType(h*d.times.length);for(let g=0;g<d.times.length;g++)f[g*h+u]=d.values[g];d.name=(l.nodeName||"")+".morphTargetInfluences",d.values=f,s[c.uuid]=d,i.push(d);continue}const m=a.createInterpolant(new a.ValueBufferType(1));d=s[c.uuid];for(let f=0;f<d.times.length;f++)d.values[f*h+u]=m.evaluate(d.times[f]);for(let f=0;f<a.times.length;f++){const g=this.insertKeyframe(d,a.times[f]);d.values[g*h+u]=a.values[f]}}return n.tracks=i,n}};class kZ{constructor(e){this.writer=e,this.name="EXT_mesh_gpu_instancing"}writeNode(e,i){if(e.constructor.name!=="InstancedMesh")return;const s=this.writer,r=s.extensionsUsed,o={};i.extensions=i.extensions||{},i.extensions[this.name]=o;let a=new he;const l=new Array,c=new Array,h=new Array;for(let f=0;f<e.count;f++){e.getMatrixAt(f,a);let g=new E,y=new Se,v=new E;a.decompose(g,y,v),l.push(g.x,g.y,g.z),c.push(y.x,y.y,y.z,y.w),h.push(v.x,v.y,v.z)}const u=new Float32Array(l),d=new Float32Array(c),m=new Float32Array(h);o.attributes={TRANSLATION:s.processAccessor(new qe(u,3)),ROTATION:s.processAccessor(new qe(d,4)),SCALE:s.processAccessor(new qe(m,3))},r[this.name]=!0}}var dxe=Object.defineProperty,pxe=Object.getOwnPropertyDescriptor,DZ=(n,e,i,s)=>{for(var r=s>1?void 0:s?pxe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&dxe(e,i,r),r};const tE=te("debuggltfexport");class BO extends Ja{constructor(){super(...arguments),p(this,"sceneRoot")}}const iy=class extends Pe{constructor(){super(...arguments),p(this,"binary",!0),p(this,"objects",[]),p(this,"ext")}async exportNow(n){tE&&console.log("Exporting objects as glTF",this.objects),n||(n="scene"),(!this.objects||this.objects.length<=0)&&(this.objects=[this.context.scene]);const e={binary:this.binary,pivot:iy.calculateCenter(this.objects)},i=await this.export(this.objects,e).catch(s=>(console.error(s),!1));return i===!1?!1:(this.binary?n.endsWith(".glb")||(n+=".glb"):n.endsWith(".gltf")||(n+=".gltf"),this.binary?iy.saveArrayBuffer(i,n):iy.saveJson(i,n),!0)}async export(n,e){if(!n||n.length<=0){console.warn("No objects set to export");return}const i=new eE;i.register(l=>new kZ(l)),$D(i,this.context),iy.filterTopmostParent(n);const s={trs:!1,onlyVisible:!0,truncateDrawRange:!1,binary:!0,maxTextureSize:1/0,embedImages:!0,includeCustomExtensions:!0,animations:e?.animations||iy.collectAnimations(n),...e},r=new ye;e!=null&&e.pivot&&r.position.sub(e.pivot),tE&&console.log("EXPORT",n),n.forEach(l=>{l&&(r.children.push(l),l.matrixAutoUpdate=!1,l.matrix.copy(l.matrixWorld),ie.getComponentsInChildren(l,kn).forEach(c=>{ie.isActiveInHierarchy(c.gameObject)&&c.setInstancingEnabled(!1)}))});const o=new jB(r);return this.ext&&(this.ext.context=o),new Promise((l,c)=>{tE&&console.log("Starting glTF export.");try{i?.parse(r,h=>{a(),l(h)},h=>{a(),c(h)},s)}catch(h){console.error(h),c(h)}finally{tE&&console.log("Finished glTF export.")}});function a(){n.forEach(l=>{l&&(l.matrixAutoUpdate=!0,ie.getComponentsInChildren(l,kn).forEach(c=>{ie.isActiveInHierarchy(c.gameObject)&&c.setInstancingEnabled(!1)}))})}}static saveArrayBuffer(n,e){this.save(new Blob([n],{type:"application/octet-stream"}),e)}static saveJson(n,e){this.save("data: text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(n)),e)}static save(n,e){const i=document.createElement("a");i.style.display="none",document.body.appendChild(i),typeof n=="string"?i.href=n:i.href=URL.createObjectURL(n),i.download=e,i.click(),i.remove()}static collectAnimations(n,e){e=e||[];for(const i of n)i&&i.traverseVisible(s=>{s.animations&&s.animations.length>0&&e.push(...s.animations)});return e}static calculateCenter(n,e){const i=e||new E;return i.set(0,0,0),n.forEach(s=>{i.add(zt(s))}),console.log(i),i.divideScalar(n.length),i}static filterTopmostParent(n){if(!(n.length<=0))for(let e=0;e<n.length;e++){let i=n[e];if(!i){n.splice(e,1),e--;continue}for(;i.parent;){if(n.includes(i.parent)){n.splice(e,1),e--;break}i=i.parent}}}};let yx=iy;DZ([T()],yx.prototype,"binary",2),DZ([T(ye)],yx.prototype,"objects",2);var mxe=Object.defineProperty,fxe=Object.getOwnPropertyDescriptor,kO=(n,e,i,s)=>{for(var r=s>1?void 0:s?fxe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&mxe(e,i,r),r};class ny extends Pe{constructor(){super(...arguments),p(this,"isGizmo",!1),p(this,"color0"),p(this,"color1"),p(this,"gridHelper"),p(this,"size"),p(this,"divisions"),p(this,"offset")}onEnable(){if(this.isGizmo&&!Hb)return;const e=this.size,i=this.divisions;this.gridHelper||(this.gridHelper=new t_(e,i,this.color0??new Ae(.4,.4,.4),this.color1??new Ae(.6,.6,.6)),this.offset!==void 0&&(this.gridHelper.position.y+=this.offset)),this.gridHelper&&this.gameObject.add(this.gridHelper)}onDisable(){this.gridHelper&&(this.gameObject.remove(this.gridHelper),this.gridHelper=null)}}kO([T()],ny.prototype,"isGizmo",2),kO([T(Ae)],ny.prototype,"color0",2),kO([T(Ae)],ny.prototype,"color1",2);var gxe=Object.defineProperty,yxe=Object.getOwnPropertyDescriptor,iE=(n,e,i,s)=>{for(var r=s>1?void 0:s?yxe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&gxe(e,i,r),r};const ep=te("debuginputfield");var sy;const wt=(sy=class extends Pe{constructor(){super(...arguments),p(this,"textComponent"),p(this,"placeholder"),p(this,"onValueChanged"),p(this,"onEndEdit"),p(this,"inputEventFn"),p(this,"_iosEventFn")}get text(){var n;return((n=this.textComponent)==null?void 0:n.text)??""}get isFocused(){return wt.active===this}start(){ep&&console.log(this.name,this)}onEnable(){var n;wt.htmlField||(wt.htmlField=document.createElement("input"),wt.htmlField.style.width="0px",wt.htmlField.style.height="0px",wt.htmlField.style.padding="0px",wt.htmlField.style.border="none",wt.htmlField.style.overflow="hidden",wt.htmlField.style.caretColor="transparent",wt.htmlField.style.outline="none",wt.htmlField.classList.add("ar"),wt.htmlField.onfocus=()=>wt.htmlFieldFocused=!0,wt.htmlField.onblur=()=>wt.htmlFieldFocused=!1,document.body.append(wt.htmlField)),this.inputEventFn||(this.inputEventFn=this.onInput.bind(this)),wt.htmlField.addEventListener("keyup",this.inputEventFn),this.placeholder&&(n=this.textComponent)!=null&&n.text.length&&ie.setActive(this.placeholder.gameObject,!1),xt.isiOS()&&(this._iosEventFn=this.processInputOniOS.bind(this),window.addEventListener("click",this._iosEventFn))}onDisable(){var n;(n=wt.htmlField)==null||n.removeEventListener("keyup",this.inputEventFn),this.onDeselected(),this._iosEventFn&&window.removeEventListener("click",this._iosEventFn)}clear(){wt.active===this&&wt.htmlField?(wt.htmlField.value="",this.setTextFromInputField()):(this.textComponent&&(this.textComponent.text=""),this.placeholder&&ie.setActive(this.placeholder.gameObject,!0))}select(){this.onSelected()}deselect(){this.onDeselected()}onPointerClick(n){ep&&console.log("CLICK",n,wt.active),wt.activeTime=this.context.time.time,wt.active!==this&&this.startCoroutine(this.activeLoop(),Yi.LateUpdate),this.selectInputField()}*activeLoop(){for(this.onSelected();wt.active===this&&!(this.context.input.getPointerClicked(0)&&this.context.time.time-wt.activeTime>.2);)this.setTextFromInputField(),yield;this.onDeselected()}onSelected(){var n,e,i,s;if(wt.active!==this&&(ep&&console.log("Select",this.name,this,wt.htmlField,this.context.isInXR,this.context.arOverlayElement,(n=this.textComponent)==null?void 0:n.text,(e=wt.htmlField)==null?void 0:e.value),(i=wt.active)==null||i.onDeselected(),wt.active=this,this.placeholder&&ie.setActive(this.placeholder.gameObject,!1),wt.htmlField)){if(wt.htmlField.value=((s=this.textComponent)==null?void 0:s.text)||"",ep&&console.log("set input field value",wt.htmlField.value),this.context.isInXR){const r=this.context.arOverlayElement;r&&r.append(wt.htmlField)}this.selectInputField()}}onDeselected(){var n;wt.active===this&&(wt.active=null,ep&&console.log("Deselect",this.name,this),wt.htmlField&&(wt.htmlField.blur(),document.body.append(wt.htmlField)),this.placeholder&&(!this.textComponent||this.textComponent.text.length<=0)&&ie.setActive(this.placeholder.gameObject,!0),wt.htmlField&&((n=this.onEndEdit)==null||n.invoke(wt.htmlField.value)))}update(){var n;wt.active===this&&((n=this.textComponent)==null||n.markDirty())}onInput(n){var e,i;if(wt.active===this){if(ep&&console.log(n.code,n,(e=wt.htmlField)==null?void 0:e.value,(i=this.textComponent)==null?void 0:i.text),n.code==="Escape"||n.code==="Enter"){this.onDeselected();return}wt.htmlField&&(this.textComponent&&(this.setTextFromInputField(),this.placeholder&&ie.setActive(this.placeholder.gameObject,this.textComponent.text.length<=0)),this.selectInputField())}}setTextFromInputField(){var n;if(this.textComponent&&wt.htmlField){if(this.textComponent.text!==wt.htmlField.value){ep&&console.log("VALUE CHANGED");const e=this.textComponent.text,i=wt.htmlField.value;(n=this.onValueChanged)==null||n.invoke(i,e)}this.textComponent.text=wt.htmlField.value}}selectInputField(){wt.htmlField&&(ep&&console.log("Focus Inputfield",wt.htmlFieldFocused),wt.htmlField.setSelectionRange(wt.htmlField.value.length,wt.htmlField.value.length),xt.isiOS()?wt.htmlField.focus({preventScroll:!0}):setTimeout(()=>{var n;return(n=wt.htmlField)==null?void 0:n.focus()},1))}processInputOniOS(){const n=this.context.physics.raycast();if(!n.length)return;const e=n[0].object,i=oD(e);(i?.gameObject===this.gameObject||i?.gameObject.parent===this.gameObject)&&this.selectInputField()}},p(sy,"active",null),p(sy,"activeTime",-1),p(sy,"htmlField",null),p(sy,"htmlFieldFocused",!1),sy);let nf=wt;iE([T(Vr)],nf.prototype,"textComponent",2),iE([T(Vr)],nf.prototype,"placeholder",2),iE([T(en)],nf.prototype,"onValueChanged",2),iE([T(en)],nf.prototype,"onEndEdit",2);var vxe=Object.defineProperty,bxe=Object.getOwnPropertyDescriptor,Qc=(n,e,i,s)=>{for(var r=s>1?void 0:s?bxe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&vxe(e,i,r),r};function DO(n){return n*Math.PI/180}const OZ=300,tp=te("debuglights");class Go extends Pe{constructor(){super(...arguments),p(this,"type",0),p(this,"range",1),p(this,"spotAngle",1),p(this,"innerSpotAngle",1),p(this,"_color",new Ae(16777215)),p(this,"_shadowNearPlane",.1),p(this,"_shadowBias",0),p(this,"_shadowNormalBias",0),p(this,"_overrideShadowBiasSettings",!1),p(this,"_shadows",1),p(this,"lightmapBakeType",4),p(this,"_intensity",-1),p(this,"_shadowDistance"),p(this,"shadowWidth"),p(this,"shadowHeight"),p(this,"_shadowResolution"),p(this,"light"),p(this,"_webXRStartedListener"),p(this,"_webXREndedListener"),p(this,"_webARRoot")}set color(e){this._color=e,this.light!==void 0&&(this.light.color=e)}get color(){return this.light?this.light.color:this._color}set shadowNearPlane(e){var i,s;if(e!==this._shadowNearPlane&&(this._shadowNearPlane=e,((s=(i=this.light)==null?void 0:i.shadow)==null?void 0:s.camera)!==void 0)){const r=this.light.shadow.camera;r.near=e}}get shadowNearPlane(){return this._shadowNearPlane}set shadowBias(e){var i,s;e!==this._shadowBias&&(this._shadowBias=e,((s=(i=this.light)==null?void 0:i.shadow)==null?void 0:s.bias)!==void 0&&(this.light.shadow.bias=e,this.light.shadow.needsUpdate=!0))}get shadowBias(){return this._shadowBias}set shadowNormalBias(e){var i,s;e!==this._shadowNormalBias&&(this._shadowNormalBias=e,((s=(i=this.light)==null?void 0:i.shadow)==null?void 0:s.normalBias)!==void 0&&(this.light.shadow.normalBias=e,this.light.shadow.needsUpdate=!0))}get shadowNormalBias(){return this._shadowNormalBias}set shadows(e){this._shadows=e,this.light&&(this.light.castShadow=e!==0,this.updateShadowSoftHard())}get shadows(){return this._shadows}set intensity(e){var i;if(this._intensity=e,this.light){let s=1;if(this.context.isInXR&&this._webARRoot){const r=(i=this._webARRoot)==null?void 0:i.arScale;typeof r=="number"&&r>0&&(s/=r)}this.light.intensity=e*s}tp&&console.log("Set light intensity to "+this._intensity,e,this)}get intensity(){return this._intensity}get shadowDistance(){const e=this.light;return e!=null&&e.shadow?e.shadow.camera.far:-1}set shadowDistance(e){this._shadowDistance=e;const i=this.light;if(i!=null&&i.shadow){const s=i.shadow.camera;s.far=e,s.updateProjectionMatrix()}}get shadowResolution(){const e=this.light;return e!=null&&e.shadow?e.shadow.mapSize.x:-1}set shadowResolution(e){if(e===this._shadowResolution)return;this._shadowResolution=e;const i=this.light;i!=null&&i.shadow&&(i.shadow.mapSize.set(e,e),i.shadow.needsUpdate=!0)}get isBaked(){return this.lightmapBakeType===2}get selfIsLight(){if(this.gameObject.isLight===!0)return!0;switch(this.gameObject.type){case"SpotLight":case"PointLight":case"DirectionalLight":return!0}return!1}getWorldPosition(e){return this.light?this.type===1?this.light.getWorldPosition(e).multiplyScalar(1):this.light.getWorldPosition(e):e}awake(){this.color=new Ae(this.color??16777215),tp&&console.log(this.name,this)}onEnable(){tp&&console.log("ENABLE LIGHT",this.name),this.createLight(),!this.isBaked&&(this.light&&(this.light.visible=!0,this.light.intensity=this._intensity,tp&&console.log("Set light intensity to "+this.light.intensity,this.name),this.selfIsLight||this.light.parent!==this.gameObject&&this.gameObject.add(this.light)),this.type===1&&this.startCoroutine(this.updateMainLightRoutine(),Yi.LateUpdate))}onDisable(){tp&&console.log("DISABLE LIGHT",this.name),this.light&&(this.selfIsLight?this.light.intensity=0:this.light.visible=!1)}onEnterXR(e){this._webARRoot=ie.getComponentInParent(this.gameObject,au)??void 0}onLeaveXR(e){}createLight(){const e=this.selfIsLight;if(e&&!this.light)switch(this.light=this.gameObject,this.light.name=this.name,this._intensity=this.light.intensity,this.type){case 1:this.setDirectionalLight(this.light);break}else if(!this.light)switch(this.type){case 1:const i=new Hp(this.color,this.intensity*Math.PI);if(i.position.set(0,0,-OZ*.5).applyQuaternion(this.gameObject.quaternion),this.gameObject.add(i.target),$p(i.target,0,0,0),this.light=i,this.gameObject.position.set(0,0,0),this.gameObject.rotation.set(0,0,0),tp){const a=new qN(this.light,.2,this.color);this.context.scene.add(a)}break;case 0:const s=new Pv(this.color,this.intensity*Math.PI,this.range,DO(this.spotAngle/2),1-DO(this.innerSpotAngle/2)/DO(this.spotAngle/2),2);s.position.set(0,0,0),s.rotation.set(0,0,0),this.light=s;const r=s.target;s.add(r),r.position.set(0,0,this.range),r.rotation.set(0,0,0);break;case 2:const o=new Wp(this.color,this.intensity*Math.PI,this.range);this.light=o;break}if(this.light){if(this._intensity>=0?this.light.intensity=this._intensity:this._intensity=this.light.intensity,this.shadows!==0?this.light.castShadow=!0:this.light.castShadow=!1,this.light.shadow){this._shadowResolution!==void 0&&this._shadowResolution>4?(this.light.shadow.mapSize.width=this._shadowResolution,this.light.shadow.mapSize.height=this._shadowResolution):(this.light.shadow.mapSize.width=2048,this.light.shadow.mapSize.height=2048),tp&&console.log("Override shadow bias?",this._overrideShadowBiasSettings,this.shadowBias,this.shadowNormalBias),this.light.shadow.bias=this.shadowBias,this.light.shadow.normalBias=this.shadowNormalBias,this.updateShadowSoftHard();const i=this.light.shadow.camera;if(i.near=this.shadowNearPlane,this._shadowDistance!==void 0&&typeof this._shadowDistance=="number"?i.far=this._shadowDistance:i.far=OZ*Math.abs(this.gameObject.scale.z),this.gameObject.scale.set(1,1,1),this.shadowWidth!==void 0)i.left=-this.shadowWidth/2,i.right=this.shadowWidth/2;else{const s=this.gameObject.scale.x;i.left*=s,i.right*=s}if(this.shadowHeight!==void 0)i.top=this.shadowHeight/2,i.bottom=-this.shadowHeight/2;else{const s=this.gameObject.scale.y;i.top*=s,i.bottom*=s}this.light.shadow.needsUpdate=!0,tp&&this.context.scene.add(new $N(i))}this.isBaked?this.light.removeFromParent():e||this.gameObject.add(this.light)}}*updateMainLightRoutine(){for(;;){this.type===1&&((!this.context.mainLight||this.intensity>this.context.mainLight.intensity)&&(this.context.mainLight=this),yield);break}}updateShadowSoftHard(){this.light&&this.light.shadow&&(this.shadows===2||(this.light.shadow.radius=1,this.light.shadow.blurSamples=1))}setDirectionalLight(e){e.add(e.target),e.target.position.set(0,0,-1)}}p(Go,"allowChangingRendererShadowMapType",!0),Qc([T()],Go.prototype,"type",2),Qc([T(Ae)],Go.prototype,"color",1),Qc([T()],Go.prototype,"shadowNearPlane",1),Qc([T()],Go.prototype,"shadowBias",1),Qc([T()],Go.prototype,"shadowNormalBias",1),Qc([T()],Go.prototype,"shadows",1),Qc([T()],Go.prototype,"lightmapBakeType",2),Qc([T()],Go.prototype,"intensity",1),Qc([T()],Go.prototype,"shadowDistance",1),Qc([T()],Go.prototype,"shadowResolution",1),new E(0,0,0);var Axe=Object.defineProperty,xxe=Object.getOwnPropertyDescriptor,vx=(n,e,i,s)=>{for(var r=s>1?void 0:s?xxe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&Axe(e,i,r),r};const OO=te("debuglods"),wxe=te("nolods");class sf{constructor(){p(this,"screenRelativeTransitionHeight"),p(this,"distance"),p(this,"renderers")}}vx([T()],sf.prototype,"screenRelativeTransitionHeight",2),vx([T()],sf.prototype,"distance",2),vx([T(kn)],sf.prototype,"renderers",2);class _xe{constructor(e){p(this,"model"),this.model=e}get renderers(){return this.model.renderers}}class bx extends Pe{constructor(){super(...arguments),p(this,"fadeMode",0),p(this,"localReferencePoint"),p(this,"lodCount",0),p(this,"size",0),p(this,"animateCrossFading",!1),p(this,"lodModels"),p(this,"_lods",[]),p(this,"_settings",[]),p(this,"_lodsHandler"),p(this,"_distanceFactor",1)}start(){if(OO&&console.log("LODGROUP",this.name,this.lodModels,this),!wxe&&!this._lodsHandler&&this.gameObject&&this.lodModels&&Array.isArray(this.lodModels)){const e=[];for(const s of this.lodModels){const r=new _xe(s);this._lods.push(r);for(const o of r.renderers)e.includes(o)||e.push(o)}this._lodsHandler=new Array;for(let s=0;s<e.length;s++){const r=new v2;this._lodsHandler.push(r),this.gameObject.add(r)}const i=new ye;i.name="Cull "+this.name;for(let s=0;s<e.length;s++){const r=e[s],o=this._lodsHandler[s],a=r.gameObject;OO&&console.log(s,a.name);for(const l of this._lods){const c=l.model.distance;let h=null;if(l.renderers.includes(r)?h=a:h=i,h.type==="Group"){console.warn(`LODGroup ${this.name}: Group or MultiMaterial object's are not supported as LOD object: ${h.name}`);continue}OO&&console.log("LEVEL",h.name,c),o.autoUpdate=!1,this.onAddLodLevel(o,h,l.model.distance)}}}}onAfterRender(){if(!this.gameObject||!this._lodsHandler)return;const e=this.context.mainCamera;if(e)for(const i of this._lodsHandler){i.update(e);const s=i.getCurrentLevel(),r=i.levels[s];i.layers.mask=r.object.layers.mask}}onAddLodLevel(e,i,s){if(i===this.gameObject){console.warn("LODGroup component must be on parent object and not mesh directly at the moment",i.name,i);return}e.addLevel(i,s*this._distanceFactor,.01);const r={lod:e,levelIndex:e.levels.length-1,distance:s};this._settings.push(r)}distanceFactor(e){if(e!==this._distanceFactor){this._distanceFactor=e;for(const i of this._settings){const s=i.lod.levels[i.levelIndex];s.distance=i.distance*e}}}}vx([T(E)],bx.prototype,"localReferencePoint",2),vx([T(sf)],bx.prototype,"lodModels",2);const Sxe=te("logstats");class GO extends Pe{onEnable(){console.log(this),Sxe&&this.startCoroutine(this.run(),Yi.OnAfterRender)}*run(){for(;this.enabled;){const e=this.context.renderer.info;console.log(e.memory,e.render,e.programs),yield}}}var Cxe=Object.defineProperty,Mxe=Object.getOwnPropertyDescriptor,nE=(n,e,i,s)=>{for(var r=s>1?void 0:s?Mxe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&Cxe(e,i,r),r},zO;const GZ=(zO=class extends Pe{constructor(){super(...arguments),p(this,"target"),p(this,"invertForward",!1),p(this,"keepUpDirection",!0),p(this,"copyTargetRotation",!1)}onBeforeRender(){let n=this.target;if(n||(n=this.context.mainCamera),!n)return;let e=this.copyTargetRotation;(this.context.isInVR||this.context.isInPassThrough)&&(e=!1),Uv(this.gameObject,n,this.keepUpDirection,e),this.invertForward&&this.gameObject.quaternion.multiply(GZ.flipYQuat)}createBehaviours(n,e,i){if(e.uuid===this.gameObject.uuid){let s=e;if(this.keepUpDirection){const o=po.createEmptyParent(e);s=o;const a=this.invertForward?-1:1;o.setMatrix(o.getMatrix().multiply(new he().makeRotationZ(Math.PI/2*a))),e.setMatrix(e.getMatrix().multiply(new he().makeRotationZ(-Math.PI/2*a)))}const r=new Gs("lookat "+this.name,zs.sceneStartTrigger(),bi.lookAtCameraAction(s,void 0,this.invertForward?_0.back:_0.forward,this.keepUpDirection?_0.up:_0.zero));n.addBehavior(r)}}},p(zO,"flipYQuat",new Se().setFromAxisAngle(new E(0,1,0),Math.PI)),zO);let rf=GZ;nE([T(ye)],rf.prototype,"target",2),nE([T()],rf.prototype,"invertForward",2),nE([T()],rf.prototype,"keepUpDirection",2),nE([T()],rf.prototype,"copyTargetRotation",2);var Exe=Object.defineProperty,Txe=Object.getOwnPropertyDescriptor,Rxe=(n,e,i,s)=>{for(var r=s>1?void 0:s?Txe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&Exe(e,i,r),r};const sE=te("debugnestedgltf");class rE extends Pe{constructor(){super(...arguments),p(this,"filePath"),p(this,"_isLoadingOrDoneLoading",!1)}listenToProgress(e){var i;(i=this.filePath)==null||i.beginListenDownload(e)}preload(){var e;(e=this.filePath)==null||e.preload()}async start(){var e,i,s,r,o;if(this._isLoadingOrDoneLoading)return;sE&&console.log(this,this.guid);const a=this.gameObject.parent;if(a){this._isLoadingOrDoneLoading=!0;const l=new Jl;l.idProvider=new Es(this.hash(this.guid)),l.parent=a,this.gameObject.updateMatrix();const c=this.gameObject.matrix;sE&&console.log("Load nested:",((e=this.filePath)==null?void 0:e.url)??this.filePath,this.gameObject.position);const h=await((s=(i=this.filePath)==null?void 0:i.instantiate)==null?void 0:s.call(this.filePath,l));sE&&console.log("Nested loaded:",((r=this.filePath)==null?void 0:r.url)??this.filePath,h),h&&(h.matrixAutoUpdate=!1,h.matrix.identity(),h.applyMatrix4(c),h.matrixAutoUpdate=!0,h.layers.disableAll(),h.layers.set(this.layer),this.dispatchEvent(new CustomEvent("loaded",{detail:{instance:h,assetReference:this.filePath}}))),sE&&console.log("Nested loading done:",((o=this.filePath)==null?void 0:o.url)??this.filePath,h)}}onDestroy(){var e;(e=this.filePath)==null||e.unload()}hash(e){let i=0;for(let s=0;s<e.length;s++)i=e.charCodeAt(s)+((i<<5)-i);return i}}Rxe([T(ei)],rE.prototype,"filePath",2);var Ixe=Object.defineProperty,Lxe=Object.getOwnPropertyDescriptor,FO=(n,e,i,s)=>{for(var r=s>1?void 0:s?Lxe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&Ixe(e,i,r),r};const Pxe=te("debugnet"),NO=class extends Pe{constructor(){super(...arguments),p(this,"url",null),p(this,"urlParameterName",null),p(this,"localhost",null)}awake(){Pxe&&console.log(this),this.context.connection.registerProvider(this)}getWebsocketUrl(){let n=this.url?NO.GetUrl(this.url,this.localhost):null;if(this.urlParameterName){const i=te(this.urlParameterName);i&&typeof i=="string"&&(n=i)}if(!n)return null;const e=new RegExp("(((https?)|(?<socket_prefix>wss?))://)?(www.)?(?<url>.+)","gm").exec(n);return e!=null&&e.groups?e?.groups.socket_prefix?n:"wss://"+e?.groups.url:null}static GetUrl(n,e){let i=n;const s=NO.IsLocalNetwork()&&e;if(s&&(i=e),n!=null&&n.startsWith("/")){const r=s?i:window.location.origin;r!=null&&r.endsWith("/")&&n.startsWith("/")&&(n=n.substring(1)),i=r+n}return i}static IsLocalNetwork(n=window.location.hostname){return no(n)}};let ry=NO;FO([T()],ry.prototype,"url",2),FO([T()],ry.prototype,"urlParameterName",2),FO([T()],ry.prototype,"localhost",2);var Bxe=Object.defineProperty,kxe=Object.getOwnPropertyDescriptor,oE=(n,e,i,s)=>{for(var r=s>1?void 0:s?kxe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&Bxe(e,i,r),r};class of extends Pe{constructor(){super(...arguments),p(this,"referenceSpace"),p(this,"from"),p(this,"affectPosition",!1),p(this,"affectRotation",!1),p(this,"alignLookDirection",!1),p(this,"levelLookDirection",!1),p(this,"levelPosition",!1),p(this,"positionOffset",new E(0,0,0)),p(this,"rotationOffset",new E(0,0,0)),p(this,"offset",new E(0,0,0))}update(){if(!this.from)return;var e=zt(this.from),i=ki(this.from);this.offset.copy(this.positionOffset);const s=this.offset.length();if(this.referenceSpace&&this.offset.transformDirection(this.referenceSpace.matrixWorld).multiplyScalar(s),e.add(this.offset),this.levelPosition&&this.referenceSpace){const l=new fs(this.gameObject.up,0),c=zt(this.referenceSpace);l.setFromNormalAndCoplanarPoint(this.gameObject.up,c);const h=new E(0,0,0);l.projectPoint(e,h),e.copy(h)}this.affectPosition&&bs(this.gameObject,e);const r=new si(this.rotationOffset.x,this.rotationOffset.y,this.rotationOffset.z),o=new Se().setFromEuler(r);this.affectRotation&&La(this.gameObject,i.multiply(o));const a=new E;this.from.getWorldDirection(a).multiplyScalar(50),this.levelLookDirection&&(a.y=0),this.alignLookDirection&&this.gameObject.lookAt(a)}}oE([T(ie)],of.prototype,"referenceSpace",2),oE([T(ie)],of.prototype,"from",2),oE([T(E)],of.prototype,"positionOffset",2),oE([T(E)],of.prototype,"rotationOffset",2);var Dxe=Object.defineProperty,Oxe=Object.getOwnPropertyDescriptor,UO=(n,e,i,s)=>{for(var r=s>1?void 0:s?Oxe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&Dxe(e,i,r),r};class oy extends Pe{constructor(){super(...arguments),p(this,"url"),p(this,"mode",0),p(this,"clickable",!0)}async open(){if(!this.url){console.warn("OpenURL: URL is not set, can't open.",this);return}this._validateUrl();let e=this.url;switch(!e.startsWith("mailto:")&&e.includes("@")&&(e="mailto:"+e),Ye()&&gn("Open URL: "+e),this.mode){case 0:xt.isSafari(),globalThis.open(e,"_blank");break;case 1:xt.isSafari()&&xt.isiOS()?globalThis.open(e,"_top"):globalThis.open(e,"_self");break;case 2:xt.isSafari()?globalThis.open(e,"_top"):globalThis.open(e,"_new");break}}start(){this.gameObject.getComponentInParent(ra)||this.gameObject.addComponent(ra)}onPointerEnter(e){!e.used&&this.clickable&&this.context.input.setCursorPointer()}onPointerExit(){this.clickable&&this.context.input.setCursorNormal()}onPointerClick(e){var i;this.clickable&&!e.used&&(i=this.url)!=null&&i.length&&this.open()}_validateUrl(){this.url&&this.url.startsWith("www.")&&(Ye()&&console.warn("URL is not valid, adding https:// to the start of the URL",this.url),this.url="https://"+this.url)}}UO([T()],oy.prototype,"url",2),UO([T()],oy.prototype,"mode",2),UO([T()],oy.prototype,"clickable",2);function Gxe(n,e){var i=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(i!=null){var s,r,o,a,l=[],c=!0,h=!1;try{if(o=(i=i.call(n)).next,e===0){if(Object(i)!==i)return;c=!1}else for(;!(c=(s=o.call(i)).done)&&(l.push(s.value),l.length!==e);c=!0);}catch(u){h=!0,r=u}finally{try{if(!c&&i.return!=null&&(a=i.return(),Object(a)!==a))return}finally{if(h)throw r}}return l}}function VO(){VO=function(){return e};var n,e={},i=Object.prototype,s=i.hasOwnProperty,r=Object.defineProperty||function(O,F,X){O[F]=X.value},o=typeof Symbol=="function"?Symbol:{},a=o.iterator||"@@iterator",l=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function h(O,F,X){return Object.defineProperty(O,F,{value:X,enumerable:!0,configurable:!0,writable:!0}),O[F]}try{h({},"")}catch{h=function(O,F,X){return O[F]=X}}function u(O,F,X,J){var q=F&&F.prototype instanceof b?F:b,oe=Object.create(q.prototype),_e=new D(J||[]);return r(oe,"_invoke",{value:C(O,X,_e)}),oe}function d(O,F,X){try{return{type:"normal",arg:O.call(F,X)}}catch(J){return{type:"throw",arg:J}}}e.wrap=u;var m="suspendedStart",f="suspendedYield",g="executing",y="completed",v={};function b(){}function A(){}function x(){}var w={};h(w,a,function(){return this});var _=Object.getPrototypeOf,S=_&&_(_(W([])));S&&S!==i&&s.call(S,a)&&(w=S);var M=x.prototype=b.prototype=Object.create(w);function R(O){["next","throw","return"].forEach(function(F){h(O,F,function(X){return this._invoke(F,X)})})}function P(O,F){function X(q,oe,_e,ke){var re=d(O[q],O,oe);if(re.type!=="throw"){var we=re.arg,Me=we.value;return Me&&typeof Me=="object"&&s.call(Me,"__await")?F.resolve(Me.__await).then(function(it){X("next",it,_e,ke)},function(it){X("throw",it,_e,ke)}):F.resolve(Me).then(function(it){we.value=it,_e(we)},function(it){return X("throw",it,_e,ke)})}ke(re.arg)}var J;r(this,"_invoke",{value:function(q,oe){function _e(){return new F(function(ke,re){X(q,oe,ke,re)})}return J=J?J.then(_e,_e):_e()}})}function C(O,F,X){var J=m;return function(q,oe){if(J===g)throw new Error("Generator is already running");if(J===y){if(q==="throw")throw oe;return{value:n,done:!0}}for(X.method=q,X.arg=oe;;){var _e=X.delegate;if(_e){var ke=L(_e,X);if(ke){if(ke===v)continue;return ke}}if(X.method==="next")X.sent=X._sent=X.arg;else if(X.method==="throw"){if(J===m)throw J=y,X.arg;X.dispatchException(X.arg)}else X.method==="return"&&X.abrupt("return",X.arg);J=g;var re=d(O,F,X);if(re.type==="normal"){if(J=X.done?y:f,re.arg===v)continue;return{value:re.arg,done:X.done}}re.type==="throw"&&(J=y,X.method="throw",X.arg=re.arg)}}}function L(O,F){var X=F.method,J=O.iterator[X];if(J===n)return F.delegate=null,X==="throw"&&O.iterator.return&&(F.method="return",F.arg=n,L(O,F),F.method==="throw")||X!=="return"&&(F.method="throw",F.arg=new TypeError("The iterator does not provide a '"+X+"' method")),v;var q=d(J,O.iterator,F.arg);if(q.type==="throw")return F.method="throw",F.arg=q.arg,F.delegate=null,v;var oe=q.arg;return oe?oe.done?(F[O.resultName]=oe.value,F.next=O.nextLoc,F.method!=="return"&&(F.method="next",F.arg=n),F.delegate=null,v):oe:(F.method="throw",F.arg=new TypeError("iterator result is not an object"),F.delegate=null,v)}function B(O){var F={tryLoc:O[0]};1 in O&&(F.catchLoc=O[1]),2 in O&&(F.finallyLoc=O[2],F.afterLoc=O[3]),this.tryEntries.push(F)}function z(O){var F=O.completion||{};F.type="normal",delete F.arg,O.completion=F}function D(O){this.tryEntries=[{tryLoc:"root"}],O.forEach(B,this),this.reset(!0)}function W(O){if(O||O===""){var F=O[a];if(F)return F.call(O);if(typeof O.next=="function")return O;if(!isNaN(O.length)){var X=-1,J=function q(){for(;++X<O.length;)if(s.call(O,X))return q.value=O[X],q.done=!1,q;return q.value=n,q.done=!0,q};return J.next=J}}throw new TypeError(typeof O+" is not iterable")}return A.prototype=x,r(M,"constructor",{value:x,configurable:!0}),r(x,"constructor",{value:A,configurable:!0}),A.displayName=h(x,c,"GeneratorFunction"),e.isGeneratorFunction=function(O){var F=typeof O=="function"&&O.constructor;return!!F&&(F===A||(F.displayName||F.name)==="GeneratorFunction")},e.mark=function(O){return Object.setPrototypeOf?Object.setPrototypeOf(O,x):(O.__proto__=x,h(O,c,"GeneratorFunction")),O.prototype=Object.create(M),O},e.awrap=function(O){return{__await:O}},R(P.prototype),h(P.prototype,l,function(){return this}),e.AsyncIterator=P,e.async=function(O,F,X,J,q){q===void 0&&(q=Promise);var oe=new P(u(O,F,X,J),q);return e.isGeneratorFunction(F)?oe:oe.next().then(function(_e){return _e.done?_e.value:oe.next()})},R(M),h(M,c,"Generator"),h(M,a,function(){return this}),h(M,"toString",function(){return"[object Generator]"}),e.keys=function(O){var F=Object(O),X=[];for(var J in F)X.push(J);return X.reverse(),function q(){for(;X.length;){var oe=X.pop();if(oe in F)return q.value=oe,q.done=!1,q}return q.done=!0,q}},e.values=W,D.prototype={constructor:D,reset:function(O){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(z),!O)for(var F in this)F.charAt(0)==="t"&&s.call(this,F)&&!isNaN(+F.slice(1))&&(this[F]=n)},stop:function(){this.done=!0;var O=this.tryEntries[0].completion;if(O.type==="throw")throw O.arg;return this.rval},dispatchException:function(O){if(this.done)throw O;var F=this;function X(re,we){return oe.type="throw",oe.arg=O,F.next=re,we&&(F.method="next",F.arg=n),!!we}for(var J=this.tryEntries.length-1;J>=0;--J){var q=this.tryEntries[J],oe=q.completion;if(q.tryLoc==="root")return X("end");if(q.tryLoc<=this.prev){var _e=s.call(q,"catchLoc"),ke=s.call(q,"finallyLoc");if(_e&&ke){if(this.prev<q.catchLoc)return X(q.catchLoc,!0);if(this.prev<q.finallyLoc)return X(q.finallyLoc)}else if(_e){if(this.prev<q.catchLoc)return X(q.catchLoc,!0)}else{if(!ke)throw new Error("try statement without catch or finally");if(this.prev<q.finallyLoc)return X(q.finallyLoc)}}}},abrupt:function(O,F){for(var X=this.tryEntries.length-1;X>=0;--X){var J=this.tryEntries[X];if(J.tryLoc<=this.prev&&s.call(J,"finallyLoc")&&this.prev<J.finallyLoc){var q=J;break}}q&&(O==="break"||O==="continue")&&q.tryLoc<=F&&F<=q.finallyLoc&&(q=null);var oe=q?q.completion:{};return oe.type=O,oe.arg=F,q?(this.method="next",this.next=q.finallyLoc,v):this.complete(oe)},complete:function(O,F){if(O.type==="throw")throw O.arg;return O.type==="break"||O.type==="continue"?this.next=O.arg:O.type==="return"?(this.rval=this.arg=O.arg,this.method="return",this.next="end"):O.type==="normal"&&F&&(this.next=F),v},finish:function(O){for(var F=this.tryEntries.length-1;F>=0;--F){var X=this.tryEntries[F];if(X.finallyLoc===O)return this.complete(X.completion,X.afterLoc),z(X),v}},catch:function(O){for(var F=this.tryEntries.length-1;F>=0;--F){var X=this.tryEntries[F];if(X.tryLoc===O){var J=X.completion;if(J.type==="throw"){var q=J.arg;z(X)}return q}}throw new Error("illegal catch attempt")},delegateYield:function(O,F,X){return this.delegate={iterator:W(O),resultName:F,nextLoc:X},this.method==="next"&&(this.arg=n),v}},e}function Tt(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function zZ(n,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(n,VZ(s.key),s)}}function Rt(n,e,i){return e&&zZ(n.prototype,e),i&&zZ(n,i),Object.defineProperty(n,"prototype",{writable:!1}),n}function $(n,e,i){return e=VZ(e),e in n?Object.defineProperty(n,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[e]=i,n}function ay(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&XO(n,e)}function aE(n){return aE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},aE(n)}function XO(n,e){return XO=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,s){return i.__proto__=s,i},XO(n,e)}function zxe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function hi(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function Fxe(n,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return hi(n)}function ly(n){var e=zxe();return function(){var i=aE(n),s;if(e){var r=aE(this).constructor;s=Reflect.construct(i,arguments,r)}else s=i.apply(this,arguments);return Fxe(this,s)}}function cy(n,e){return Nxe(n)||Gxe(n,e)||FZ(n,e)||Uxe()}function Nxe(n){if(Array.isArray(n))return n}function FZ(n,e){if(n){if(typeof n=="string")return NZ(n,e);var i=Object.prototype.toString.call(n).slice(8,-1);if(i==="Object"&&n.constructor&&(i=n.constructor.name),i==="Map"||i==="Set")return Array.from(n);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return NZ(n,e)}}function NZ(n,e){(e==null||e>n.length)&&(e=n.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=n[i];return s}function Uxe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function UZ(n,e){var i=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!i){if(Array.isArray(n)||(i=FZ(n))||e&&n&&typeof n.length=="number"){i&&(n=i);var s=0,r=function(){};return{s:r,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(c){throw c},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,l;return{s:function(){i=i.call(n)},n:function(){var c=i.next();return o=c.done,c},e:function(c){a=!0,l=c},f:function(){try{!o&&i.return!=null&&i.return()}finally{if(a)throw l}}}}function Vxe(n,e){if(typeof n!="object"||n===null)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var s=i.call(n,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function VZ(n){var e=Vxe(n,"string");return typeof e=="symbol"?e:String(e)}var Xxe=function(n){ay(i,n);var e=ly(i);function i(s){var r;return Tt(this,i),r=e.call(this),$(hi(r),"type","ParticleEmitter"),$(hi(r),"system",void 0),r.system=s,r}return Rt(i,[{key:"clone",value:function(){var s=this.system.clone();return s.emitter.copy(this,!0),s.emitter}},{key:"dispose",value:function(){}},{key:"extractFromCache",value:function(s){var r=[];for(var o in s){var a=s[o];delete a.metadata,r.push(a)}return r}},{key:"toJSON",value:function(s){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=s===void 0||typeof s=="string",a={};o&&(s={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},a.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var l={};if(l.uuid=this.uuid,l.type=this.type,this.name!==""&&(l.name=this.name),this.castShadow===!0&&(l.castShadow=!0),this.receiveShadow===!0&&(l.receiveShadow=!0),this.visible===!1&&(l.visible=!1),this.frustumCulled===!1&&(l.frustumCulled=!1),this.renderOrder!==0&&(l.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(l.userData=this.userData),l.layers=this.layers.mask,l.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(l.matrixAutoUpdate=!1),this.system!==null&&(l.ps=this.system.toJSON(s,r)),this.children.length>0){l.children=[];for(var c=0;c<this.children.length;c++)this.children[c].type!=="ParticleSystemPreview"&&l.children.push(this.children[c].toJSON(s).object)}if(o){var h=this.extractFromCache(s.geometries),u=this.extractFromCache(s.materials),d=this.extractFromCache(s.textures),m=this.extractFromCache(s.images);h.length>0&&(a.geometries=h),u.length>0&&(a.materials=u),d.length>0&&(a.textures=d),m.length>0&&(a.images=m)}return a.object=l,a}}]),i}(ye),WO=function(){function n(e){Tt(this,n),$(this,"data",void 0),$(this,"next",void 0),$(this,"prev",void 0),this.data=e,this.next=null,this.prev=null}return Rt(n,[{key:"hasPrev",value:function(){return this.prev!==null}},{key:"hasNext",value:function(){return this.next!==null}}]),n}(),Wxe=function(){function n(){Tt(this,n),$(this,"length",void 0),$(this,"head",void 0),$(this,"tail",void 0),this.length=0,this.head=this.tail=null}return Rt(n,[{key:"isEmpty",value:function(){return this.head===null}},{key:"clear",value:function(){this.length=0,this.head=this.tail=null}},{key:"front",value:function(){return this.head===null?null:this.head.data}},{key:"back",value:function(){return this.tail===null?null:this.tail.data}},{key:"dequeue",value:function(){if(this.head){var e=this.head.data;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}}},{key:"pop",value:function(){if(this.tail){var e=this.tail.data;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}}},{key:"queue",value:function(e){var i=new WO(e);this.tail||(this.tail=i),this.head&&(this.head.prev=i,i.next=this.head),this.head=i,this.length++}},{key:"push",value:function(e){var i=new WO(e);this.head||(this.head=i),this.tail&&(this.tail.next=i,i.prev=this.tail),this.tail=i,this.length++}},{key:"insertBefore",value:function(e,i){var s=new WO(i);s.next=e,s.prev=e.prev,s.prev!==null&&(s.prev.next=s),s.next.prev=s,e==this.head&&(this.head=s),this.length++}},{key:"remove",value:function(e){if(!(this.head===null||this.tail===null)){var i=this.head;for(e===this.head.data&&(this.head=this.head.next),e===this.tail.data&&(this.tail=this.tail.prev);i.next!==null&&i.data!==e;)i=i.next;i.data===e&&(i.prev!==null&&(i.prev.next=i.next),i.next!==null&&(i.next.prev=i.prev),this.length--)}}},{key:"values",value:VO().mark(function e(){var i;return VO().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:i=this.head;case 1:if(i===null){s.next=7;break}return s.next=4,i.data;case 4:i=i.next,s.next=1;break;case 7:case"end":return s.stop()}},e,this)})}]),n}(),Ax=function(){function n(){Tt(this,n),$(this,"parentMatrix",void 0),$(this,"startSpeed",0),$(this,"startColor",new Ze),$(this,"startSize",1),$(this,"position",new E),$(this,"velocity",new E),$(this,"age",0),$(this,"life",1),$(this,"size",1),$(this,"angularVelocity",void 0),$(this,"rotation",0),$(this,"color",new Ze),$(this,"uvTile",0)}return Rt(n,[{key:"died",get:function(){return this.age>=this.life}}]),n}(),Hxe=Rt(function n(e,i,s){Tt(this,n),this.position=e,this.size=i,this.color=s}),xx=function(){function n(){Tt(this,n),$(this,"parentMatrix",void 0),$(this,"startSpeed",0),$(this,"startColor",new Ze),$(this,"startSize",1),$(this,"position",new E),$(this,"localPosition",void 0),$(this,"velocity",new E),$(this,"age",0),$(this,"life",1),$(this,"size",1),$(this,"length",100),$(this,"color",new Ze),$(this,"previous",new Wxe),$(this,"uvTile",0)}return Rt(n,[{key:"update",value:function(){for(this.age<=this.life?this.previous.push(new Hxe(this.position.clone(),this.size,this.color.clone())):this.previous.length>0&&this.previous.dequeue();this.previous.length>this.length;)this.previous.dequeue()}},{key:"died",get:function(){return this.age>=this.life}},{key:"reset",value:function(){this.previous.clear()}}]),n}(),Wr=function(){function n(e){Tt(this,n),$(this,"type",void 0),this.value=e,this.type="value"}return Rt(n,[{key:"genValue",value:function(){return this.value}},{key:"toJSON",value:function(){return{type:"ConstantValue",value:this.value}}},{key:"clone",value:function(){return new n(this.value)}}],[{key:"fromJSON",value:function(e){return new n(e.value)}}]),n}(),lE=function(){function n(e,i){Tt(this,n),$(this,"type",void 0),this.a=e,this.b=i,this.type="value"}return Rt(n,[{key:"genValue",value:function(){return oi.lerp(this.a,this.b,Math.random())}},{key:"toJSON",value:function(){return{type:"IntervalValue",a:this.a,b:this.b}}},{key:"clone",value:function(){return new n(this.a,this.b)}}],[{key:"fromJSON",value:function(e){return new n(e.a,e.b)}}]),n}(),jxe=function(){function n(){Tt(this,n),$(this,"functions",void 0),this.functions=new Array}return Rt(n,[{key:"findFunction",value:function(e){for(var i=0,s=0,r=this.functions.length-1;s+1<r;)if(i=Math.floor((s+r)/2),e<this.getStartX(i))r=i-1;else if(e>this.getEndX(i))s=i+1;else return i;for(var o=s;o<=r;o++)if(e>=this.functions[o][1]&&e<=this.getEndX(o))return o;return-1}},{key:"getStartX",value:function(e){return this.functions[e][1]}},{key:"setStartX",value:function(e,i){e>0&&(this.functions[e][1]=i)}},{key:"getEndX",value:function(e){return e+1<this.functions.length?this.functions[e+1][1]:1}},{key:"setEndX",value:function(e,i){e+1<this.functions.length&&(this.functions[e+1][1]=i)}},{key:"insertFunction",value:function(e,i){var s=this.findFunction(e);this.functions.splice(s+1,0,[i,e])}},{key:"removeFunction",value:function(e){return this.functions.splice(e,1)[0][0]}},{key:"getFunction",value:function(e){return this.functions[e][0]}},{key:"setFunction",value:function(e,i){this.functions[e][0]=i}},{key:"numOfFunctions",get:function(){return this.functions.length}}]),n}(),HO=function(){function n(e,i,s,r){Tt(this,n),$(this,"p",void 0),this.p=[e,i,s,r]}return Rt(n,[{key:"genValue",value:function(e){var i=e*e,s=e*e*e,r=1-e,o=r*r,a=o*r;return this.p[0]*a+this.p[1]*o*e*3+this.p[2]*r*i*3+this.p[3]*s}},{key:"derivativeCoefficients",value:function(e){for(var i=[],s=e,r=s.length-1;r>0;r--){for(var o=[],a=0;a<r;a++){var l=r*(s[a+1]-s[a]);o.push(l)}i.push(o),s=o}return i}},{key:"getSlope",value:function(e){var i=this.derivativeCoefficients(this.p)[0],s=1-e,r=s*s,o=s*e*2,a=e*e;return r*i[0]+o*i[1]+a*i[2]}},{key:"controlCurve",value:function(e,i){this.p[1]=e/3+this.p[0],this.p[2]=this.p[3]-i/3}},{key:"hull",value:function(e){var i=this.p,s=[],r,o=0,a=0,l=0,c=[];for(c[o++]=i[0],c[o++]=i[1],c[o++]=i[2],c[o++]=i[3];i.length>1;){for(s=[],a=0,l=i.length-1;a<l;a++)r=e*i[a]+(1-e)*i[a+1],c[o++]=r,s.push(r);i=s}return c}},{key:"split",value:function(e){var i=this.hull(e),s={left:new n(i[0],i[4],i[7],i[9]),right:new n(i[9],i[8],i[6],i[3]),span:i};return s}},{key:"clone",value:function(){return new n(this.p[0],this.p[1],this.p[2],this.p[3])}},{key:"toJSON",value:function(){return{p0:this.p[0],p1:this.p[1],p2:this.p[2],p3:this.p[3]}}}],[{key:"fromJSON",value:function(e){return new n(e.p0,e.p1,e.p2,e.p3)}}]),n}(),Qxe=function(n){ay(i,n);var e=ly(i);function i(){var s,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[[new HO(0,.3333333333333333,.6666666666666666,1),0]];return Tt(this,i),s=e.call(this),$(hi(s),"type",void 0),s.type="function",s.functions=r,s}return Rt(i,[{key:"genValue",value:function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=this.findFunction(s);return r===-1?0:this.functions[r][0].genValue((s-this.getStartX(r))/(this.getEndX(r)-this.getStartX(r)))}},{key:"toSVG",value:function(s,r){if(r<1)return"";for(var o=["M",0,this.functions[0][0].p[0]].join(" "),a=1/r;a<=1;a+=1/r)o=[o,"L",a*s,this.genValue(a)].join(" ");return o}},{key:"toJSON",value:function(){return{type:"PiecewiseBezier",functions:this.functions.map(function(s){var r=cy(s,2),o=r[0],a=r[1];return{function:o.toJSON(),start:a}})}}},{key:"clone",value:function(){return new i(this.functions.map(function(s){var r=cy(s,2),o=r[0],a=r[1];return[o.clone(),a]}))}}],[{key:"fromJSON",value:function(s){return new i(s.functions.map(function(r){return[HO.fromJSON(r.function),r.start]}))}}]),i}(jxe);function Ki(n){switch(n.type){case"ConstantValue":return Wr.fromJSON(n);case"IntervalValue":return lE.fromJSON(n);case"PiecewiseBezier":return Qxe.fromJSON(n);default:return new Wr(0)}}var wx=function(n){return{r:n.x,g:n.y,b:n.z,a:n.w}},_x=function(n){return new Ze(n.r,n.g,n.b,n.a)},Zxe=function(n,e){switch(e){case"Vector3":return new E(n.x,n.y,n.z);case"Vector4":return new Ze(n.x,n.y,n.z,n.w);case"Color":return new E(n.r,n.g,n.b);case"Number":return n;default:return n}},Yxe=function(n,e){switch(e){case"Vector3":return{x:n.x,y:n.y,z:n.z};case"Vector4":return{x:n.x,y:n.y,z:n.z,w:n.w};case"Color":return{r:n.x,g:n.y,b:n.z};case"Number":return n;default:return n}},Kxe=function(){function n(e,i){Tt(this,n),$(this,"type",void 0),this.a=e,this.b=i,this.type="value"}return Rt(n,[{key:"genColor",value:function(e){var i=Math.random();return e.copy(this.a).lerp(this.b,i)}},{key:"toJSON",value:function(){return{type:"RandomColor",a:wx(this.a),b:wx(this.b)}}},{key:"clone",value:function(){return new n(this.a.clone(),this.b.clone())}}],[{key:"fromJSON",value:function(e){return new n(_x(e.a),_x(e.b))}}]),n}(),jO=function(){function n(e,i){Tt(this,n),$(this,"type",void 0),this.a=e,this.b=i,this.type="function"}return Rt(n,[{key:"genColor",value:function(e,i){return e.copy(this.a).lerp(this.b,i)}},{key:"toJSON",value:function(){return{type:"ColorRange",a:wx(this.a),b:wx(this.b)}}},{key:"clone",value:function(){return new n(this.a.clone(),this.b.clone())}}],[{key:"fromJSON",value:function(e){return new n(_x(e.a),_x(e.b))}}]),n}(),cE=function(){function n(e,i){Tt(this,n),$(this,"keys",void 0),$(this,"type",void 0),$(this,"subType",void 0),this.subType=i,this.type="function",this.keys=e}return Rt(n,[{key:"findKey",value:function(e){for(var i=0,s=0,r=this.keys.length-1;s+1<r;)if(i=Math.floor((s+r)/2),e<this.getStartX(i))r=i-1;else if(e>this.getEndX(i))s=i+1;else return i;for(var o=s;o<=r;o++)if(e>=this.getStartX(o)&&e<=this.getEndX(o))return o;return-1}},{key:"getStartX",value:function(e){return this.keys[e][1]}},{key:"getEndX",value:function(e){return e+1<this.keys.length?this.keys[e+1][1]:1}},{key:"genValue",value:function(e,i){var s=this.findKey(i);return this.subType==="Number"?s===-1?this.keys[0][0]:s+1>=this.keys.length?this.keys[this.keys.length-1][0]:(this.keys[s+1][0]-this.keys[s][0])*((i-this.getStartX(s))/(this.getEndX(s)-this.getStartX(s)))+this.keys[s][0]:s===-1?e.copy(this.keys[0][0]):s+1>=this.keys.length?e.copy(this.keys[this.keys.length-1][0]):e.copy(this.keys[s][0]).lerp(this.keys[s+1][0],(i-this.getStartX(s))/(this.getEndX(s)-this.getStartX(s)))}},{key:"toJSON",value:function(){var e=this;return this.keys[0][0].constructor.name,{type:"CLinearFunction",subType:this.subType,keys:this.keys.map(function(i){var s=cy(i,2),r=s[0],o=s[1];return{value:Yxe(r,e.subType),pos:o}})}}},{key:"clone",value:function(){return this.subType==="Number"?new n(this.keys.map(function(e){var i=cy(e,2),s=i[0],r=i[1];return[s,r]}),this.subType):new n(this.keys.map(function(e){var i=cy(e,2),s=i[0],r=i[1];return[s.clone(),r]}),this.subType)}}],[{key:"fromJSON",value:function(e){return new n(e.keys.map(function(i){return[Zxe(i.value,e.subType),i.pos]}),e.subType)}}]),n}(),hE=new E,QO=function(){function n(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[[new E(0,0,0),0],[new E(1,1,1),0]],i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[[1,0],[1,1]];Tt(this,n),$(this,"type",void 0),$(this,"color",void 0),$(this,"alpha",void 0),this.type="function",this.color=new cE(e,"Color"),this.alpha=new cE(i,"Number")}return Rt(n,[{key:"genColor",value:function(e,i){return this.color.genValue(hE,i),e.set(hE.x,hE.y,hE.z,this.alpha.genValue(1,i))}},{key:"toJSON",value:function(){return{type:"Gradient",color:this.color.toJSON(),alpha:this.alpha.toJSON()}}},{key:"clone",value:function(){var e=new n;return e.alpha=this.alpha.clone(),e.color=this.color.clone(),e}}],[{key:"fromJSON",value:function(e){if(e.functions){var i=e.functions.map(function(r){return[jO.fromJSON(r.function).a,r.start]});return e.functions.length>0&&i.push([jO.fromJSON(e.functions[e.functions.length-1].function).b,1]),new n(i.map(function(r){return[new E(r[0].x,r[0].y,r[0].z),r[1]]}),i.map(function(r){return[r[0].w,r[1]]}))}else{var s=new n;return s.alpha=cE.fromJSON(e.alpha),s.color=cE.fromJSON(e.color),s}}}]),n}(),ZO=new Ze,Jxe=function(){function n(e,i){Tt(this,n),$(this,"gradient1",void 0),$(this,"gradient2",void 0),$(this,"type",void 0),this.type="memorizedFunction",this.gradient1=e,this.gradient2=i}return Rt(n,[{key:"startGen",value:function(e){e.rand=Math.random()}},{key:"genColor",value:function(e,i,s){return this.gradient1.genColor(e,i),this.gradient2.genColor(ZO,i),s&&s.rand?e.lerp(ZO,s.rand):e.lerp(ZO,Math.random()),e}},{key:"toJSON",value:function(){return{type:"RandomColorBetweenGradient",gradient1:this.gradient1.toJSON(),gradient2:this.gradient2.toJSON()}}},{key:"clone",value:function(){return new n(this.gradient1.clone(),this.gradient2.clone())}}],[{key:"fromJSON",value:function(e){return new n(QO.fromJSON(e.gradient1),QO.fromJSON(e.gradient2))}}]),n}(),uE=function(){function n(e){Tt(this,n),$(this,"type",void 0),this.color=e,this.type="value"}return Rt(n,[{key:"genColor",value:function(e){return e.copy(this.color)}},{key:"toJSON",value:function(){return{type:"ConstantColor",color:wx(this.color)}}},{key:"clone",value:function(){return new n(this.color.clone())}}],[{key:"fromJSON",value:function(e){return new n(_x(e.color))}}]),n}();function YO(n){switch(n.type){case"ConstantColor":return uE.fromJSON(n);case"ColorRange":return jO.fromJSON(n);case"RandomColor":return Kxe.fromJSON(n);case"Gradient":return QO.fromJSON(n);case"RandomColorBetweenGradient":return Jxe.fromJSON(n);default:return new uE(new Ze(1,1,1,1))}}var XZ=function(){function n(){Tt(this,n),$(this,"type",void 0),this.type="rotation"}return Rt(n,[{key:"genValue",value:function(e,i){var s,r,o,a,l,c;do s=Math.random()*2-1,r=Math.random()*2-1,o=s*s+r*r;while(o>1);do a=Math.random()*2-1,l=Math.random()*2-1,c=a*a+l*l;while(c>1);var h=Math.sqrt((1-o)/c);return e.set(s,r,h*a,h*l),e}},{key:"toJSON",value:function(){return{type:"RandomQuat"}}},{key:"clone",value:function(){return new n}}],[{key:"fromJSON",value:function(e){return new n}}]),n}(),WZ=function(){function n(e,i){Tt(this,n),$(this,"type",void 0),this.axis=e,this.angle=i,this.type="rotation"}return Rt(n,[{key:"genValue",value:function(e,i){return e.setFromAxisAngle(this.axis,this.angle.genValue(i))}},{key:"toJSON",value:function(){return{type:"AxisAngle",axis:{x:this.axis.x,y:this.axis.y,z:this.axis.z},angle:this.angle.toJSON()}}},{key:"clone",value:function(){return new n(this.axis.clone(),this.angle.clone())}}],[{key:"fromJSON",value:function(e){return new n(e.axis,Ki(e.angle))}}]),n}(),qxe=function(){function n(e,i,s){Tt(this,n),$(this,"type",void 0),this.angleX=e,this.angleY=i,this.angleZ=s,this.type="rotation"}return Rt(n,[{key:"genValue",value:function(e,i){return e.setFromEuler(new si(this.angleX.genValue(i),this.angleY.genValue(i),this.angleZ.genValue(i)))}},{key:"toJSON",value:function(){return{type:"Euler",angleX:this.angleX.toJSON(),angleY:this.angleY.toJSON(),angleZ:this.angleZ.toJSON()}}},{key:"clone",value:function(){return new n(this.angleX,this.angleY,this.angleZ)}}],[{key:"fromJSON",value:function(e){return new n(Ki(e.angleX),Ki(e.angleY),Ki(e.angleZ))}}]),n}();function HZ(n){switch(n.type){case"AxisAngle":return WZ.fromJSON(n);case"Euler":return qxe.fromJSON(n);case"RandomQuat":return XZ.fromJSON(n);default:return new XZ}}function $xe(n){switch(n.type){case"ConstantValue":case"IntervalValue":case"PiecewiseBezier":return Ki(n);case"AxisAngle":case"RandomQuat":case"Euler":return HZ(n);default:return new Wr(0)}}var jZ=function(){function n(e){Tt(this,n),$(this,"type","ColorOverLife"),this.color=e}return Rt(n,[{key:"initialize",value:function(e){this.color.type==="memorizedFunction"&&(e.colorOverLifeMemory={},this.color.startGen(e.colorOverLifeMemory))}},{key:"update",value:function(e,i){this.color.type==="memorizedFunction"?this.color.genColor(e.color,e.age/e.life,e.colorOverLifeMemory):this.color.genColor(e.color,e.age/e.life),e.color.x*=e.startColor.x,e.color.y*=e.startColor.y,e.color.z*=e.startColor.z,e.color.w*=e.startColor.w}},{key:"frameUpdate",value:function(e){}},{key:"toJSON",value:function(){return{type:this.type,color:this.color.toJSON()}}},{key:"clone",value:function(){return new n(this.color.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(YO(e.color))}}]),n}(),QZ=function(){function n(e,i){Tt(this,n),$(this,"type","RotationOverLife"),$(this,"tempQuat",new Se),this.angularVelocity=e,this.dynamic=i}return Rt(n,[{key:"initialize",value:function(e){!this.dynamic&&e instanceof Ax&&(e.angularVelocity=this.angularVelocity.genValue())}},{key:"update",value:function(e,i){this.dynamic?e.rotation+=i*this.angularVelocity.genValue(e.age/e.life):e instanceof Ax&&(e.rotation+=i*e.angularVelocity)}},{key:"toJSON",value:function(){return{type:this.type,angularVelocity:this.angularVelocity.toJSON(),dynamic:this.dynamic}}},{key:"frameUpdate",value:function(e){}},{key:"clone",value:function(){return new n(this.angularVelocity.clone(),this.dynamic)}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(Ki(e.angularVelocity),e.dynamic)}}]),n}(),ZZ=function(){function n(e){Tt(this,n),$(this,"type","SizeOverLife"),this.size=e}return Rt(n,[{key:"initialize",value:function(e){}},{key:"update",value:function(e){e.size=e.startSize*this.size.genValue(e.age/e.life)}},{key:"toJSON",value:function(){return{type:this.type,size:this.size.toJSON()}}},{key:"frameUpdate",value:function(e){}},{key:"clone",value:function(){return new n(this.size.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(Ki(e.size))}}]),n}(),YZ=function(){function n(e){Tt(this,n),$(this,"type","SpeedOverLife"),this.speed=e}return Rt(n,[{key:"initialize",value:function(e){}},{key:"update",value:function(e){e.velocity.normalize().multiplyScalar(e.startSpeed*this.speed.genValue(e.age/e.life))}},{key:"toJSON",value:function(){return{type:this.type,speed:this.speed.toJSON()}}},{key:"frameUpdate",value:function(e){}},{key:"clone",value:function(){return new n(this.speed.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(Ki(e.speed))}}]),n}(),KZ=function(){function n(e,i){Tt(this,n),$(this,"type","RotationBySpeed"),$(this,"tempQuat",new Se),this.angularVelocity=e,this.speedRange=i}return Rt(n,[{key:"initialize",value:function(e){}},{key:"update",value:function(e,i){var s=(e.startSpeed-this.speedRange.a)/(this.speedRange.b-this.speedRange.a);e.rotation+=i*this.angularVelocity.genValue(s)}},{key:"toJSON",value:function(){return{type:this.type,angularVelocity:this.angularVelocity.toJSON(),speedRange:this.speedRange.toJSON()}}},{key:"frameUpdate",value:function(e){}},{key:"clone",value:function(){return new n(this.angularVelocity.clone(),this.speedRange.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(Ki(e.angularVelocity),lE.fromJSON(e.speedRange))}}]),n}(),JZ=function(){function n(e,i){Tt(this,n),$(this,"type","SizeBySpeed"),this.size=e,this.speedRange=i}return Rt(n,[{key:"initialize",value:function(e){}},{key:"update",value:function(e){var i=(e.startSpeed-this.speedRange.a)/(this.speedRange.b-this.speedRange.a);e.size=e.startSize*this.size.genValue(i)}},{key:"toJSON",value:function(){return{type:this.type,size:this.size.toJSON(),speedRange:this.speedRange.toJSON()}}},{key:"frameUpdate",value:function(e){}},{key:"clone",value:function(){return new n(this.size.clone(),this.speedRange.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(Ki(e.size),lE.fromJSON(e.speedRange))}}]),n}(),qZ=function(){function n(e,i){Tt(this,n),$(this,"type","ColorBySpeed"),this.color=e,this.speedRange=i}return Rt(n,[{key:"initialize",value:function(e){this.color.type==="memorizedFunction"&&(e.colorOverLifeMemory={},this.color.startGen(e.colorOverLifeMemory))}},{key:"update",value:function(e,i){var s=(e.startSpeed-this.speedRange.a)/(this.speedRange.b-this.speedRange.a);this.color.type==="memorizedFunction"?this.color.genColor(e.color,s,e.colorOverLifeMemory):this.color.genColor(e.color,s),e.color.x*=e.startColor.x,e.color.y*=e.startColor.y,e.color.z*=e.startColor.z,e.color.w*=e.startColor.w}},{key:"frameUpdate",value:function(e){}},{key:"toJSON",value:function(){return{type:this.type,color:this.color.toJSON(),speedRange:this.speedRange.toJSON()}}},{key:"clone",value:function(){return new n(this.color.clone(),this.speedRange.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(YO(e.color),lE.fromJSON(e.speedRange))}}]),n}(),$Z=function(){function n(e){Tt(this,n),$(this,"type","FrameOverLife"),this.frame=e}return Rt(n,[{key:"initialize",value:function(e){}},{key:"update",value:function(e,i){e.uvTile=Math.floor(this.frame.genValue(e.age/e.life))}},{key:"frameUpdate",value:function(e){}},{key:"toJSON",value:function(){return{type:this.type,frame:this.frame.toJSON()}}},{key:"clone",value:function(){return new n(this.frame.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(Ki(e.frame))}}]),n}();new E(0,0,1);var eY=function(){function n(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new E(0,1,0);Tt(this,n),$(this,"type","OrbitOverLife"),$(this,"rotation",void 0),$(this,"line",void 0),$(this,"temp",new E),this.orbitSpeed=e,this.axis=i,this.rotation=new Se,this.line=new jo}return Rt(n,[{key:"initialize",value:function(e){}},{key:"update",value:function(e,i){this.line.set(new E(0,0,0),this.axis),this.line.closestPointToPoint(e.position,!1,this.temp),this.rotation.setFromAxisAngle(this.axis,this.orbitSpeed.genValue(e.age/e.life)*i),e.position.sub(this.temp),e.position.applyQuaternion(this.rotation),e.position.add(this.temp)}},{key:"frameUpdate",value:function(e){}},{key:"toJSON",value:function(){return{type:this.type,orbitSpeed:this.orbitSpeed.toJSON(),axis:[this.axis.x,this.axis.y,this.axis.z]}}},{key:"clone",value:function(){return new n(this.orbitSpeed.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(Ki(e.orbitSpeed),e.axis?new E(e.axis[0],e.axis[1],e.axis[2]):void 0)}}]),n}(),tY=function(){function n(e,i){Tt(this,n),$(this,"type","ApplyForce"),$(this,"magnitudeValue",void 0),this.direction=e,this.magnitude=i,this.magnitudeValue=this.magnitude.genValue()}return Rt(n,[{key:"initialize",value:function(e){}},{key:"update",value:function(e,i){e.velocity.addScaledVector(this.direction,this.magnitudeValue*i)}},{key:"frameUpdate",value:function(e){this.magnitudeValue=this.magnitude.genValue()}},{key:"toJSON",value:function(){return{type:this.type,direction:[this.direction.x,this.direction.y,this.direction.z],magnitude:this.magnitude.toJSON()}}},{key:"clone",value:function(){return new n(this.direction.clone(),this.magnitude.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){var i;return new n(new E(e.direction[0],e.direction[1],e.direction[2]),Ki((i=e.magnitude)!==null&&i!==void 0?i:e.force))}}]),n}(),iY=function(){function n(e,i){Tt(this,n),$(this,"type","GravityForce"),$(this,"temp",new E),this.center=e,this.magnitude=i}return Rt(n,[{key:"initialize",value:function(e){}},{key:"update",value:function(e,i){this.temp.copy(this.center).sub(e.position).normalize(),e.velocity.addScaledVector(this.temp,this.magnitude/e.position.distanceToSquared(this.center)*i)}},{key:"frameUpdate",value:function(e){}},{key:"toJSON",value:function(){return{type:this.type,center:[this.center.x,this.center.y,this.center.z],magnitude:this.magnitude}}},{key:"clone",value:function(){return new n(this.center.clone(),this.magnitude)}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(new E(e.center[0],e.center[1],e.center[2]),e.magnitude)}}]),n}(),nY=function(){function n(e){Tt(this,n),$(this,"type","WidthOverLength"),this.width=e}return Rt(n,[{key:"initialize",value:function(e){}},{key:"update",value:function(e){if(e instanceof xx)for(var i=e.previous.values(),s=0;s<e.previous.length;s++){var r=i.next();r.value.size=this.width.genValue((e.previous.length-s)/e.length)}}},{key:"frameUpdate",value:function(e){}},{key:"toJSON",value:function(){return{type:this.type,width:this.width.toJSON()}}},{key:"clone",value:function(){return new n(this.width.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(Ki(e.width))}}]),n}();new E(0,0,1);var sY=function(){function n(e){Tt(this,n),$(this,"type","ChangeEmitDirection"),$(this,"_temp",new E),$(this,"_q",new Se),this.angle=e}return Rt(n,[{key:"initialize",value:function(e){var i=e.velocity.length();i!=0&&(e.velocity.normalize(),e.velocity.x===0&&e.velocity.y===0?this._temp.set(0,e.velocity.z,0):this._temp.set(-e.velocity.y,e.velocity.x,0),this._q.setFromAxisAngle(this._temp.normalize(),this.angle.genValue()),this._temp.copy(e.velocity),e.velocity.applyQuaternion(this._q),this._q.setFromAxisAngle(this._temp,Math.random()*Math.PI*2),e.velocity.applyQuaternion(this._q),e.velocity.setLength(i))}},{key:"update",value:function(e,i){}},{key:"frameUpdate",value:function(e){}},{key:"toJSON",value:function(){return{type:this.type,angle:this.angle.toJSON()}}},{key:"clone",value:function(){return new n(this.angle)}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(Ki(e.angle))}}]),n}(),e1e=new E(1,1,1),rY=new E(0,0,1),oY=function(){function n(e,i,s){Tt(this,n),$(this,"type","EmitSubParticleSystem"),$(this,"q_",new Se),$(this,"v_",new E),$(this,"v2_",new E),this.particleSystem=e,this.useVelocityAsBasis=i,this.subParticleSystem=s,this.subParticleSystem&&this.subParticleSystem.system&&(this.subParticleSystem.system.onlyUsedByOther=!0)}return Rt(n,[{key:"initialize",value:function(e){e.emissionState={burstIndex:0,burstWaveIndex:0,time:0,waitEmiting:0,matrix:new he}}},{key:"update",value:function(e,i){if(!(!this.subParticleSystem||!e.emissionState)){var s=e.emissionState.matrix,r;if(e.rotation===void 0||this.useVelocityAsBasis)if(e.velocity.x===0&&e.velocity.y===0&&(e.velocity.z===1||e.velocity.z===0))s.set(1,0,0,e.position.x,0,1,0,e.position.y,0,0,1,e.position.z,0,0,0,1);else{this.v_.copy(rY).cross(e.velocity),this.v2_.copy(e.velocity).cross(this.v_);var o=this.v_.length(),a=this.v2_.length();s.set(this.v_.x/o,this.v2_.x/a,e.velocity.x,e.position.x,this.v_.y/o,this.v2_.y/a,e.velocity.y,e.position.y,this.v_.z/o,this.v2_.z/a,e.velocity.z,e.position.z,0,0,0,1)}else e.rotation instanceof Se?r=e.rotation:(this.q_.setFromAxisAngle(rY,e.rotation),r=this.q_),s.compose(e.position,r,e1e);this.particleSystem.worldSpace||s.multiplyMatrices(this.particleSystem.emitter.matrixWorld,s),this.subParticleSystem.system.emit(i,e.emissionState,s)}}},{key:"frameUpdate",value:function(e){}},{key:"toJSON",value:function(){return{type:this.type,subParticleSystem:this.subParticleSystem?this.subParticleSystem.uuid:"",useVelocityAsBasis:this.useVelocityAsBasis}}},{key:"clone",value:function(){return new n(this.particleSystem,this.useVelocityAsBasis,this.subParticleSystem)}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e,i){return new n(i,e.useVelocityAsBasis,e.subParticleSystem)}}]),n}(),t1e=.5*(Math.sqrt(3)-1),Sx=(3-Math.sqrt(3))/6,i1e=1/3,Zc=1/6,n1e=(Math.sqrt(5)-1)/4,gr=(5-Math.sqrt(5))/20,Hs=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),ls=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]),aY=function(){function n(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Math.random;Tt(this,n),$(this,"p",void 0),$(this,"perm",void 0),$(this,"permMod12",void 0);var i=typeof e=="function"?e:r1e(e);this.p=s1e(i),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(var s=0;s<512;s++)this.perm[s]=this.p[s&255],this.permMod12[s]=this.perm[s]%12}return Rt(n,[{key:"noise2D",value:function(e,i){var s=this.permMod12,r=this.perm,o=0,a=0,l=0,c=(e+i)*t1e,h=Math.floor(e+c),u=Math.floor(i+c),d=(h+u)*Sx,m=h-d,f=u-d,g=e-m,y=i-f,v,b;g>y?(v=1,b=0):(v=0,b=1);var A=g-v+Sx,x=y-b+Sx,w=g-1+2*Sx,_=y-1+2*Sx,S=h&255,M=u&255,R=.5-g*g-y*y;if(R>=0){var P=s[S+r[M]]*3;R*=R,o=R*R*(Hs[P]*g+Hs[P+1]*y)}var C=.5-A*A-x*x;if(C>=0){var L=s[S+v+r[M+b]]*3;C*=C,a=C*C*(Hs[L]*A+Hs[L+1]*x)}var B=.5-w*w-_*_;if(B>=0){var z=s[S+1+r[M+1]]*3;B*=B,l=B*B*(Hs[z]*w+Hs[z+1]*_)}return 70*(o+a+l)}},{key:"noise3D",value:function(e,i,s){var r=this.permMod12,o=this.perm,a,l,c,h,u=(e+i+s)*i1e,d=Math.floor(e+u),m=Math.floor(i+u),f=Math.floor(s+u),g=(d+m+f)*Zc,y=d-g,v=m-g,b=f-g,A=e-y,x=i-v,w=s-b,_,S,M,R,P,C;A>=x?x>=w?(_=1,S=0,M=0,R=1,P=1,C=0):A>=w?(_=1,S=0,M=0,R=1,P=0,C=1):(_=0,S=0,M=1,R=1,P=0,C=1):x<w?(_=0,S=0,M=1,R=0,P=1,C=1):A<w?(_=0,S=1,M=0,R=0,P=1,C=1):(_=0,S=1,M=0,R=1,P=1,C=0);var L=A-_+Zc,B=x-S+Zc,z=w-M+Zc,D=A-R+2*Zc,W=x-P+2*Zc,O=w-C+2*Zc,F=A-1+3*Zc,X=x-1+3*Zc,J=w-1+3*Zc,q=d&255,oe=m&255,_e=f&255,ke=.6-A*A-x*x-w*w;if(ke<0)a=0;else{var re=r[q+o[oe+o[_e]]]*3;ke*=ke,a=ke*ke*(Hs[re]*A+Hs[re+1]*x+Hs[re+2]*w)}var we=.6-L*L-B*B-z*z;if(we<0)l=0;else{var Me=r[q+_+o[oe+S+o[_e+M]]]*3;we*=we,l=we*we*(Hs[Me]*L+Hs[Me+1]*B+Hs[Me+2]*z)}var it=.6-D*D-W*W-O*O;if(it<0)c=0;else{var je=r[q+R+o[oe+P+o[_e+C]]]*3;it*=it,c=it*it*(Hs[je]*D+Hs[je+1]*W+Hs[je+2]*O)}var Ge=.6-F*F-X*X-J*J;if(Ge<0)h=0;else{var rt=r[q+1+o[oe+1+o[_e+1]]]*3;Ge*=Ge,h=Ge*Ge*(Hs[rt]*F+Hs[rt+1]*X+Hs[rt+2]*J)}return 32*(a+l+c+h)}},{key:"noise4D",value:function(e,i,s,r){var o=this.perm,a,l,c,h,u,d=(e+i+s+r)*n1e,m=Math.floor(e+d),f=Math.floor(i+d),g=Math.floor(s+d),y=Math.floor(r+d),v=(m+f+g+y)*gr,b=m-v,A=f-v,x=g-v,w=y-v,_=e-b,S=i-A,M=s-x,R=r-w,P=0,C=0,L=0,B=0;_>S?P++:C++,_>M?P++:L++,_>R?P++:B++,S>M?C++:L++,S>R?C++:B++,M>R?L++:B++;var z=P>=3?1:0,D=C>=3?1:0,W=L>=3?1:0,O=B>=3?1:0,F=P>=2?1:0,X=C>=2?1:0,J=L>=2?1:0,q=B>=2?1:0,oe=P>=1?1:0,_e=C>=1?1:0,ke=L>=1?1:0,re=B>=1?1:0,we=_-z+gr,Me=S-D+gr,it=M-W+gr,je=R-O+gr,Ge=_-F+2*gr,rt=S-X+2*gr,ge=M-J+2*gr,Q=R-q+2*gr,Ne=_-oe+3*gr,Re=S-_e+3*gr,Te=M-ke+3*gr,We=R-re+3*gr,be=_-1+4*gr,nt=S-1+4*gr,ct=M-1+4*gr,It=R-1+4*gr,H=m&255,G=f&255,ue=g&255,Ee=y&255,De=.6-_*_-S*S-M*M-R*R;if(De<0)a=0;else{var Le=o[H+o[G+o[ue+o[Ee]]]]%32*4;De*=De,a=De*De*(ls[Le]*_+ls[Le+1]*S+ls[Le+2]*M+ls[Le+3]*R)}var At=.6-we*we-Me*Me-it*it-je*je;if(At<0)l=0;else{var ht=o[H+z+o[G+D+o[ue+W+o[Ee+O]]]]%32*4;At*=At,l=At*At*(ls[ht]*we+ls[ht+1]*Me+ls[ht+2]*it+ls[ht+3]*je)}var Ue=.6-Ge*Ge-rt*rt-ge*ge-Q*Q;if(Ue<0)c=0;else{var Xe=o[H+F+o[G+X+o[ue+J+o[Ee+q]]]]%32*4;Ue*=Ue,c=Ue*Ue*(ls[Xe]*Ge+ls[Xe+1]*rt+ls[Xe+2]*ge+ls[Xe+3]*Q)}var Ct=.6-Ne*Ne-Re*Re-Te*Te-We*We;if(Ct<0)h=0;else{var ze=o[H+oe+o[G+_e+o[ue+ke+o[Ee+re]]]]%32*4;Ct*=Ct,h=Ct*Ct*(ls[ze]*Ne+ls[ze+1]*Re+ls[ze+2]*Te+ls[ze+3]*We)}var qt=.6-be*be-nt*nt-ct*ct-It*It;if(qt<0)u=0;else{var Oe=o[H+1+o[G+1+o[ue+1+o[Ee+1]]]]%32*4;qt*=qt,u=qt*qt*(ls[Oe]*be+ls[Oe+1]*nt+ls[Oe+2]*ct+ls[Oe+3]*It)}return 27*(a+l+c+h+u)}}]),n}();function s1e(n){for(var e=new Uint8Array(256),i=0;i<256;i++)e[i]=i;for(var s=0;s<255;s++){var r=s+~~(n()*(256-s)),o=e[s];e[s]=e[r],e[r]=o}return e}function r1e(n){var e=0,i=0,s=0,r=1,o=o1e();return e=o(" "),i=o(" "),s=o(" "),e-=o(n),e<0&&(e+=1),i-=o(n),i<0&&(i+=1),s-=o(n),s<0&&(s+=1),function(){var a=2091639*e+r*23283064365386963e-26;return e=i,i=s,s=a-(r=a|0)}}function o1e(){var n=4022871197;return function(e){e=e.toString();for(var i=0;i<e.length;i++){n+=e.charCodeAt(i);var s=.02519603282416938*n;n=s>>>0,s-=n,s*=n,n=s>>>0,s-=n,n+=s*4294967296}return(n>>>0)*23283064365386963e-26}}var lY=function(){function n(e,i,s,r){Tt(this,n),$(this,"type","TurbulenceField"),$(this,"generator",new aY),$(this,"timeOffset",new E),$(this,"temp",new E),$(this,"temp2",new E),this.scale=e,this.octaves=i,this.velocityMultiplier=s,this.timeScale=r,this.timeOffset.x=Math.random()/this.scale.x*this.timeScale.x,this.timeOffset.y=Math.random()/this.scale.y*this.timeScale.y,this.timeOffset.z=Math.random()/this.scale.z*this.timeScale.z}return Rt(n,[{key:"initialize",value:function(e){}},{key:"update",value:function(e,i){var s=e.position.x/this.scale.x,r=e.position.y/this.scale.y,o=e.position.z/this.scale.z;this.temp.set(0,0,0);for(var a=1,l=0;l<this.octaves;l++)this.temp2.set(this.generator.noise4D(s*a,r*a,o*a,this.timeOffset.x*a)/a,this.generator.noise4D(s*a,r*a,o*a,this.timeOffset.y*a)/a,this.generator.noise4D(s*a,r*a,o*a,this.timeOffset.z*a)/a),this.temp.add(this.temp2),a*=2;this.temp.multiply(this.velocityMultiplier),e.velocity.addScaledVector(this.temp,i)}},{key:"toJSON",value:function(){return{type:this.type,scale:[this.scale.x,this.scale.y,this.scale.z],octaves:this.octaves,velocityMultiplier:[this.velocityMultiplier.x,this.velocityMultiplier.y,this.velocityMultiplier.z],timeScale:[this.timeScale.x,this.timeScale.y,this.timeScale.z]}}},{key:"frameUpdate",value:function(e){this.timeOffset.x+=e*this.timeScale.x,this.timeOffset.y+=e*this.timeScale.y,this.timeOffset.z+=e*this.timeScale.z}},{key:"clone",value:function(){return new n(this.scale.clone(),this.octaves,this.velocityMultiplier.clone(),this.timeScale.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(new E(e.scale[0],e.scale[1],e.scale[2]),e.octaves,new E(e.velocityMultiplier[0],e.velocityMultiplier[1],e.velocityMultiplier[2]),new E(e.timeScale[0],e.timeScale[1],e.timeScale[2]))}}]),n}(),cY=new Se,hY=function(){function n(e,i){Tt(this,n),$(this,"type","Rotation3DOverLife"),$(this,"tempQuat",new Se),this.angularVelocity=e,this.dynamic=i}return Rt(n,[{key:"initialize",value:function(e){!this.dynamic&&e instanceof Ax&&(e.angularVelocity=new Se,this.angularVelocity.genValue(e.angularVelocity))}},{key:"update",value:function(e,i){this.dynamic?(this.angularVelocity.genValue(this.tempQuat,e.age/e.life),this.tempQuat.slerpQuaternions(cY,this.tempQuat,i),e.rotation.multiply(this.tempQuat)):e instanceof Ax&&(this.tempQuat.slerpQuaternions(cY,e.angularVelocity,i),e.rotation.multiply(this.tempQuat))}},{key:"toJSON",value:function(){return{type:this.type,angularVelocity:this.angularVelocity.toJSON(),dynamic:this.dynamic}}},{key:"frameUpdate",value:function(e){}},{key:"clone",value:function(){return new n(this.angularVelocity.clone(),this.dynamic)}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(HZ(e.angularVelocity),e.dynamic)}}]),n}(),uY=function(){function n(e,i,s){Tt(this,n),$(this,"type","ForceOverLife"),$(this,"_temp",new E),this.x=e,this.y=i,this.z=s}return Rt(n,[{key:"initialize",value:function(e){}},{key:"update",value:function(e){this._temp.set(this.x.genValue(e.age/e.life),this.y.genValue(e.age/e.life),this.z.genValue(e.age/e.life)),e.velocity.add(this._temp)}},{key:"toJSON",value:function(){return{type:this.type,x:this.x.toJSON(),y:this.y.toJSON(),z:this.z.toJSON()}}},{key:"frameUpdate",value:function(e){}},{key:"clone",value:function(){return new n(this.x.clone(),this.y.clone(),this.z.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(Ki(e.x),Ki(e.y),Ki(e.z))}}]),n}(),dY=function(){function n(e,i){Tt(this,n),$(this,"type","Noise"),$(this,"generator",new aY),$(this,"duration",0),$(this,"temp",new E),this.frequency=e,this.power=i}return Rt(n,[{key:"initialize",value:function(e){e.startTime=this.duration}},{key:"update",value:function(e,i){this.temp.set(this.generator.noise2D(e.startTime*this.frequency.x,e.life/e.age*this.frequency.x),this.generator.noise2D(e.startTime*this.frequency.y+100.25,e.life/e.age*this.frequency.y+100.154),this.generator.noise2D(e.startTime*this.frequency.z+200.89,e.life/e.age*this.frequency.z+200.1)).multiply(this.power),e.position.addScaledVector(this.temp,i)}},{key:"toJSON",value:function(){return{type:this.type,frequency:[this.frequency.x,this.frequency.y,this.frequency.z],power:[this.power.x,this.power.y,this.power.z]}}},{key:"frameUpdate",value:function(e){this.duration+=e}},{key:"clone",value:function(){return new n(this.frequency.clone(),this.power.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(new E(e.frequency[0],e.frequency[1],e.frequency[2]),new E(e.power[0],e.power[1],e.power[2]))}}]),n}(),a1e={ApplyForce:{type:"ApplyForce",constructor:tY,params:[["direction","vec3"],["magnitude","value"]],loadJSON:tY.fromJSON},Noise:{type:"Noise",constructor:dY,params:[["frequency","vec3"],["power","vec3"]],loadJSON:dY.fromJSON},TurbulenceField:{type:"TurbulenceField",constructor:lY,params:[["scale","vec3"],["octaves","number"],["velocityMultiplier","vec3"],["timeScale","vec3"]],loadJSON:lY.fromJSON},GravityForce:{type:"GravityForce",constructor:iY,params:[["center","vec3"],["magnitude","number"]],loadJSON:iY.fromJSON},ColorOverLife:{type:"ColorOverLife",constructor:jZ,params:[["color","colorFunc"]],loadJSON:jZ.fromJSON},RotationOverLife:{type:"RotationOverLife",constructor:QZ,params:[["angularVelocity","valueFunc"],["dynamic","boolean"]],loadJSON:QZ.fromJSON},Rotation3DOverLife:{type:"Rotation3DOverLife",constructor:hY,params:[["angularVelocity","rotationFunc"],["dynamic","boolean"]],loadJSON:hY.fromJSON},SizeOverLife:{type:"SizeOverLife",constructor:ZZ,params:[["size","valueFunc"]],loadJSON:ZZ.fromJSON},ColorBySpeed:{type:"ColorBySpeed",constructor:qZ,params:[["color","colorFunc"],["speedRange","range"]],loadJSON:qZ.fromJSON},RotationBySpeed:{type:"RotationBySpeed",constructor:KZ,params:[["angularVelocity","valueFunc"],["speedRange","range"]],loadJSON:KZ.fromJSON},SizeBySpeed:{type:"SizeBySpeed",constructor:JZ,params:[["size","valueFunc"],["speedRange","range"]],loadJSON:JZ.fromJSON},SpeedOverLife:{type:"SpeedOverLife",constructor:YZ,params:[["speed","valueFunc"]],loadJSON:YZ.fromJSON},FrameOverLife:{type:"FrameOverLife",constructor:$Z,params:[["frame","valueFunc"]],loadJSON:$Z.fromJSON},ForceOverLife:{type:"ForceOverLife",constructor:uY,params:[["x","valueFunc"],["y","valueFunc"],["z","valueFunc"]],loadJSON:uY.fromJSON},OrbitOverLife:{type:"OrbitOverLife",constructor:eY,params:[["orbitSpeed","valueFunc"],["axis","vec3"]],loadJSON:eY.fromJSON},WidthOverLength:{type:"WidthOverLength",constructor:nY,params:[["width","valueFunc"]],loadJSON:nY.fromJSON},ChangeEmitDirection:{type:"ChangeEmitDirection",constructor:sY,params:[["angle","value"]],loadJSON:sY.fromJSON},EmitSubParticleSystem:{type:"EmitSubParticleSystem",constructor:oY,params:[["particleSystem","self"],["useVelocityAsBasis","boolean"],["subParticleSystem","particleSystem"]],loadJSON:oY.fromJSON}};function l1e(n,e){return a1e[n.type].loadJSON(n,e)}var pY=function(){function n(){var e,i,s,r,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Tt(this,n),$(this,"type","cone"),$(this,"radius",void 0),$(this,"arc",void 0),$(this,"thickness",void 0),$(this,"angle",void 0),this.radius=(e=o.radius)!==null&&e!==void 0?e:10,this.arc=(i=o.arc)!==null&&i!==void 0?i:2*Math.PI,this.thickness=(s=o.thickness)!==null&&s!==void 0?s:1,this.angle=(r=o.angle)!==null&&r!==void 0?r:Math.PI/6}return Rt(n,[{key:"initialize",value:function(e){var i=Math.random(),s=oi.lerp(1-this.thickness,1,Math.random()),r=i*this.arc,o=Math.sqrt(s),a=Math.sin(r),l=Math.cos(r);e.position.x=o*l,e.position.y=o*a,e.position.z=0;var c=this.angle*o;e.velocity.set(0,0,Math.cos(c)).addScaledVector(e.position,Math.sin(c)).multiplyScalar(e.startSpeed),e.position.multiplyScalar(this.radius)}},{key:"toJSON",value:function(){return{type:"cone",radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle}}},{key:"clone",value:function(){return new n({radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle})}}],[{key:"fromJSON",value:function(e){return new n(e)}}]),n}(),mY=function(){function n(){var e,i,s,r,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Tt(this,n),$(this,"type","donut"),$(this,"radius",void 0),$(this,"arc",void 0),$(this,"thickness",void 0),$(this,"angle",void 0),this.radius=(e=o.radius)!==null&&e!==void 0?e:10,this.arc=(i=o.arc)!==null&&i!==void 0?i:2*Math.PI,this.thickness=(s=o.thickness)!==null&&s!==void 0?s:1,this.angle=(r=o.angle)!==null&&r!==void 0?r:Math.PI/6}return Rt(n,[{key:"initialize",value:function(e){var i=Math.random(),s=oi.lerp(this.thickness,1,Math.random()),r=i*this.arc,o=Math.sqrt(s),a=Math.sin(r),l=Math.cos(r);e.position.x=o*l,e.position.y=o*a,e.position.z=0;var c=this.angle*o;e.velocity.set(0,0,Math.cos(c)).addScaledVector(e.position,Math.sin(c)).multiplyScalar(e.startSpeed),e.position.multiplyScalar(this.radius)}},{key:"toJSON",value:function(){return{type:"donut",radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle}}},{key:"clone",value:function(){return new n({radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle})}}],[{key:"fromJSON",value:function(e){return new n(e)}}]),n}(),fY=function(){function n(){Tt(this,n),$(this,"type","point")}return Rt(n,[{key:"initialize",value:function(e){var i=Math.random(),s=Math.random(),r=i*Math.PI*2,o=Math.acos(2*s-1),a=Math.cbrt(Math.random()),l=Math.sin(r),c=Math.cos(r),h=Math.sin(o),u=Math.cos(o);e.velocity.x=a*h*c,e.velocity.y=a*h*l,e.velocity.z=a*u,e.velocity.multiplyScalar(e.startSpeed),e.position.setScalar(0)}},{key:"toJSON",value:function(){return{type:"point"}}},{key:"clone",value:function(){return new n}}],[{key:"fromJSON",value:function(e){return new n}}]),n}(),KO=function(){function n(){var e,i,s,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Tt(this,n),$(this,"type","sphere"),$(this,"radius",void 0),$(this,"arc",void 0),$(this,"thickness",void 0),this.radius=(e=r.radius)!==null&&e!==void 0?e:10,this.arc=(i=r.arc)!==null&&i!==void 0?i:2*Math.PI,this.thickness=(s=r.thickness)!==null&&s!==void 0?s:1}return Rt(n,[{key:"initialize",value:function(e){var i=Math.random(),s=Math.random(),r=oi.lerp(1-this.thickness,1,Math.random()),o=i*this.arc,a=Math.acos(2*s-1),l=Math.cbrt(r),c=Math.sin(o),h=Math.cos(o),u=Math.sin(a),d=Math.cos(a);e.position.x=l*u*h,e.position.y=l*u*c,e.position.z=l*d,e.velocity.setScalar(0).addScaledVector(e.position,e.startSpeed),e.position.multiplyScalar(this.radius)}},{key:"toJSON",value:function(){return{type:"sphere",radius:this.radius,arc:this.arc,thickness:this.thickness}}},{key:"clone",value:function(){return new n({radius:this.radius,arc:this.arc,thickness:this.thickness})}}],[{key:"fromJSON",value:function(e){return new n(e)}}]),n}(),gY=function(){function n(e){Tt(this,n),$(this,"type","mesh_surface"),$(this,"_triangleIndexToArea",[]),$(this,"_geometry",void 0),$(this,"_tempA",new E),$(this,"_tempB",new E),$(this,"_tempC",new E),e&&(this.geometry=e)}return Rt(n,[{key:"geometry",get:function(){return this._geometry},set:function(e){if(this._geometry=e,e!==void 0&&typeof e!="string"){var i=new Ks;this._triangleIndexToArea.length=0;var s=0;if(e.getIndex()){var r=e.getIndex().array,o=r.length/3;this._triangleIndexToArea.push(0);for(var a=0;a<o;a++)i.setFromAttributeAndIndices(e.getAttribute("position"),r[a*3],r[a*3+1],r[a*3+2]),s+=i.getArea(),this._triangleIndexToArea.push(s);e.userData.triangleIndexToArea=this._triangleIndexToArea}}}},{key:"initialize",value:function(e){var i=this._geometry;if(!i||i.getIndex()===null){e.position.set(0,0,0),e.velocity.set(0,0,1).multiplyScalar(e.startSpeed);return}for(var s=this._triangleIndexToArea.length-1,r=0,o=s,a=Math.random()*this._triangleIndexToArea[s];r+1<o;){var l=Math.floor((r+o)/2);a<this._triangleIndexToArea[l]?o=l:r=l}var c=Math.random(),h=Math.random();c+h>1&&(c=1-c,h=1-h);var u=i.getIndex().array[r*3],d=i.getIndex().array[r*3+1],m=i.getIndex().array[r*3+2],f=i.getAttribute("position");this._tempA.fromBufferAttribute(f,u),this._tempB.fromBufferAttribute(f,d),this._tempC.fromBufferAttribute(f,m),this._tempB.sub(this._tempA),this._tempC.sub(this._tempA),this._tempA.addScaledVector(this._tempB,c).addScaledVector(this._tempC,h),e.position.copy(this._tempA),this._tempA.copy(this._tempB).cross(this._tempC).normalize(),e.velocity.copy(this._tempA).normalize().multiplyScalar(e.startSpeed)}},{key:"toJSON",value:function(){return{type:"mesh_surface",mesh:this._geometry?this._geometry.uuid:""}}},{key:"clone",value:function(){return new n(this._geometry)}}],[{key:"fromJSON",value:function(e,i){return new n(i.geometries[e.geometry])}}]),n}(),yY=function(){function n(){var e,i,s,r,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Tt(this,n),$(this,"type","grid"),$(this,"width",void 0),$(this,"height",void 0),$(this,"column",void 0),$(this,"row",void 0),this.width=(e=o.width)!==null&&e!==void 0?e:1,this.height=(i=o.height)!==null&&i!==void 0?i:1,this.column=(s=o.column)!==null&&s!==void 0?s:10,this.row=(r=o.row)!==null&&r!==void 0?r:10}return Rt(n,[{key:"initialize",value:function(e){var i=Math.floor(Math.random()*this.row),s=Math.floor(Math.random()*this.column);e.position.x=s*this.width/this.column-this.width/2,e.position.y=i*this.height/this.row-this.height/2,e.position.z=0,e.velocity.set(0,0,e.startSpeed)}},{key:"toJSON",value:function(){return{type:"grid",width:this.width,height:this.height,column:this.column,row:this.row}}},{key:"clone",value:function(){return new n({width:this.width,height:this.height,column:this.column,row:this.row})}}],[{key:"fromJSON",value:function(e){return new n(e)}}]),n}(),c1e={cone:{type:"cone",params:[["radius","number"],["arc","radian"],["thickness","number"],["angle","radian"]],constructor:pY,loadJSON:pY.fromJSON},donut:{type:"donut",params:[["radius","number"],["arc","radian"],["thickness","number"],["angle","radian"]],constructor:mY,loadJSON:mY.fromJSON},point:{type:"point",params:[],constructor:fY,loadJSON:fY.fromJSON},sphere:{type:"sphere",params:[["radius","number"],["arc","radian"],["thickness","number"],["angle","radian"]],constructor:KO,loadJSON:KO.fromJSON},grid:{type:"grid",params:[["width","number"],["height","number"],["rows","number"],["column","number"]],constructor:yY,loadJSON:yY.fromJSON},mesh_surface:{type:"mesh_surface",params:[["geometry","geometry"]],constructor:gY,loadJSON:gY.fromJSON}};function h1e(n,e){return c1e[n.type].loadJSON(n,e)}var at=function(n){return n[n.BillBoard=0]="BillBoard",n[n.StretchedBillBoard=1]="StretchedBillBoard",n[n.Mesh=2]="Mesh",n[n.Trail=3]="Trail",n[n.HorizontalBillBoard=4]="HorizontalBillBoard",n[n.VerticalBillBoard=5]="VerticalBillBoard",n}({}),vY=function(n){ay(i,n);var e=ly(i);function i(s){var r;Tt(this,i),r=e.call(this),$(hi(r),"type","VFXBatch"),$(hi(r),"systems",void 0),$(hi(r),"settings",void 0),$(hi(r),"maxParticles",void 0),r.maxParticles=1e3,r.systems=new Set;var o=new Mr;return o.mask=s.layers.mask,r.settings={instancingGeometry:s.instancingGeometry,renderMode:s.renderMode,renderOrder:s.renderOrder,material:s.material.clone(),uTileCount:s.uTileCount,vTileCount:s.vTileCount,layers:o},r.frustumCulled=!1,r.renderOrder=r.settings.renderOrder,r}return Rt(i,[{key:"addSystem",value:function(s){this.systems.add(s)}},{key:"removeSystem",value:function(s){this.systems.delete(s)}}]),i}(pe),u1e=new E(0,0,1),JO=new Se,d1e=new E,p1e=new E;new E;var bY=60,m1e=new ds(1,1,1,1),f1e=function(){function n(e){var i,s,r,o,a,l,c,h,u,d,m,f,g,y,v,b,A,x,w,_,S;Tt(this,n),$(this,"autoDestroy",void 0),$(this,"prewarm",void 0),$(this,"looping",void 0),$(this,"duration",void 0),$(this,"startLife",void 0),$(this,"startSpeed",void 0),$(this,"startRotation",void 0),$(this,"startSize",void 0),$(this,"startColor",void 0),$(this,"startTileIndex",void 0),$(this,"rendererEmitterSettings",void 0),$(this,"emissionOverTime",void 0),$(this,"emissionOverDistance",void 0),$(this,"emissionBursts",void 0),$(this,"onlyUsedByOther",void 0),$(this,"worldSpace",void 0),$(this,"speedFactor",void 0),$(this,"particleNum",void 0),$(this,"paused",void 0),$(this,"particles",void 0),$(this,"emitterShape",void 0),$(this,"emitter",void 0),$(this,"rendererSettings",void 0),$(this,"neededToUpdateRender",void 0),$(this,"behaviors",void 0),$(this,"prewarmed",void 0),$(this,"emissionState",void 0),$(this,"emitEnded",void 0),$(this,"markForDestroy",void 0),$(this,"previousWorldPos",void 0),$(this,"temp",new E),$(this,"travelDistance",0),$(this,"normalMatrix",new Gt),$(this,"_renderer",void 0),this.autoDestroy=e.autoDestroy===void 0?!1:e.autoDestroy,this.duration=(i=e.duration)!==null&&i!==void 0?i:1,this.looping=e.looping===void 0?!0:e.looping,this.prewarm=e.prewarm===void 0?!1:e.prewarm,this.startLife=(s=e.startLife)!==null&&s!==void 0?s:new Wr(5),this.startSpeed=(r=e.startSpeed)!==null&&r!==void 0?r:new Wr(0),this.startRotation=(o=e.startRotation)!==null&&o!==void 0?o:new Wr(0),this.startSize=(a=e.startSize)!==null&&a!==void 0?a:new Wr(1),this.startColor=(l=e.startColor)!==null&&l!==void 0?l:new uE(new Ze(1,1,1,1)),this.emissionOverTime=(c=e.emissionOverTime)!==null&&c!==void 0?c:new Wr(10),this.emissionOverDistance=(h=e.emissionOverDistance)!==null&&h!==void 0?h:new Wr(0),this.emissionBursts=(u=e.emissionBursts)!==null&&u!==void 0?u:[],this.onlyUsedByOther=(d=e.onlyUsedByOther)!==null&&d!==void 0?d:!1,this.emitterShape=(m=e.shape)!==null&&m!==void 0?m:new KO,this.behaviors=(f=e.behaviors)!==null&&f!==void 0?f:new Array,this.worldSpace=(g=e.worldSpace)!==null&&g!==void 0?g:!1,this.speedFactor=(y=e.speedFactor)!==null&&y!==void 0?y:0,this.rendererEmitterSettings=(v=e.rendererEmitterSettings)!==null&&v!==void 0?v:{},this.rendererSettings={instancingGeometry:(b=e.instancingGeometry)!==null&&b!==void 0?b:m1e,renderMode:(A=e.renderMode)!==null&&A!==void 0?A:at.BillBoard,renderOrder:(x=e.renderOrder)!==null&&x!==void 0?x:0,material:e.material,uTileCount:(w=e.uTileCount)!==null&&w!==void 0?w:1,vTileCount:(_=e.vTileCount)!==null&&_!==void 0?_:1,layers:(S=e.layers)!==null&&S!==void 0?S:new Mr},this.neededToUpdateRender=!0,this.particles=new Array,this.startTileIndex=e.startTileIndex||new Wr(0),this.emitter=new Xxe(this),this.paused=!1,this.particleNum=0,this.emissionState={burstIndex:0,burstWaveIndex:0,time:0,waitEmiting:0},this.emitEnded=!1,this.markForDestroy=!1,this.prewarmed=!1}return Rt(n,[{key:"time",get:function(){return this.emissionState.time},set:function(e){this.emissionState.time=e}},{key:"layers",get:function(){return this.rendererSettings.layers}},{key:"texture",get:function(){return this.rendererSettings.material.map},set:function(e){this.rendererSettings.material.map=e,this.neededToUpdateRender=!0}},{key:"material",get:function(){return this.rendererSettings.material},set:function(e){this.rendererSettings.material=e,this.neededToUpdateRender=!0}},{key:"uTileCount",get:function(){return this.rendererSettings.uTileCount},set:function(e){this.rendererSettings.uTileCount=e,this.neededToUpdateRender=!0}},{key:"vTileCount",get:function(){return this.rendererSettings.vTileCount},set:function(e){this.rendererSettings.vTileCount=e,this.neededToUpdateRender=!0}},{key:"instancingGeometry",get:function(){return this.rendererSettings.instancingGeometry},set:function(e){this.restart(),this.particles.length=0,this.rendererSettings.instancingGeometry=e,this.neededToUpdateRender=!0}},{key:"renderMode",get:function(){return this.rendererSettings.renderMode},set:function(e){if((this.rendererSettings.renderMode!=at.Trail&&e===at.Trail||this.rendererSettings.renderMode==at.Trail&&e!==at.Trail)&&(this.restart(),this.particles.length=0),this.rendererSettings.renderMode!==e)switch(e){case at.Trail:this.rendererEmitterSettings={startLength:new Wr(30),followLocalOrigin:!1};break;case at.Mesh:this.rendererEmitterSettings={geometry:new ds(1,1)},this.startRotation=new WZ(new E(0,1,0),new Wr(0));break;case at.BillBoard:case at.VerticalBillBoard:case at.HorizontalBillBoard:case at.StretchedBillBoard:this.rendererEmitterSettings={},this.rendererSettings.renderMode===at.Mesh&&(this.startRotation=new Wr(0));break}this.rendererSettings.renderMode=e,this.neededToUpdateRender=!0}},{key:"renderOrder",get:function(){return this.rendererSettings.renderOrder},set:function(e){this.rendererSettings.renderOrder=e,this.neededToUpdateRender=!0}},{key:"blending",get:function(){return this.rendererSettings.material.blending},set:function(e){this.rendererSettings.material.blending=e,this.neededToUpdateRender=!0}},{key:"pause",value:function(){this.paused=!0}},{key:"play",value:function(){this.paused=!1}},{key:"spawn",value:function(e,i,s){JO.setFromRotationMatrix(s);var r=d1e,o=JO,a=p1e;s.decompose(r,o,a);for(var l=0;l<e;l++){for(this.particleNum++;this.particles.length<this.particleNum;)this.rendererSettings.renderMode===at.Trail?this.particles.push(new xx):this.particles.push(new Ax);var c=this.particles[this.particleNum-1];if(this.startColor.genColor(c.startColor,this.emissionState.time,{}),c.color.copy(c.startColor),c.startSpeed=this.startSpeed.genValue(i.time/this.duration),c.life=this.startLife.genValue(i.time/this.duration),c.age=0,c.startSize=this.startSize.genValue(i.time/this.duration),c.uvTile=Math.floor(this.startTileIndex.genValue()),c.size=c.startSize,this.rendererSettings.renderMode===at.Mesh||this.rendererSettings.renderMode===at.BillBoard||this.rendererSettings.renderMode===at.VerticalBillBoard||this.rendererSettings.renderMode===at.HorizontalBillBoard||this.rendererSettings.renderMode===at.StretchedBillBoard){var h=c;this.rendererSettings.renderMode===at.Mesh?(h.rotation instanceof Se||(h.rotation=new Se),this.startRotation.type==="rotation"?this.startRotation.genValue(h.rotation,i.time/this.duration):h.rotation.setFromAxisAngle(u1e,this.startRotation.genValue(i.time/this.duration))):this.startRotation.type==="rotation"?h.rotation=0:h.rotation=this.startRotation.genValue(i.time/this.duration)}else if(this.rendererSettings.renderMode===at.Trail){var u=c;u.length=this.rendererEmitterSettings.startLength.genValue(i.time/this.duration),u.reset()}if(this.emitterShape.initialize(c),this.rendererSettings.renderMode===at.Trail&&this.rendererEmitterSettings.followLocalOrigin){var d=c;d.localPosition=new E().copy(d.position)}this.worldSpace?(c.position.applyMatrix4(s),c.startSize=c.startSize*(Math.abs(a.x)+Math.abs(a.y)+Math.abs(a.z))/3,c.size=c.startSize,c.velocity.multiply(a).applyMatrix3(this.normalMatrix),c.rotation&&c.rotation instanceof Se&&c.rotation.multiplyQuaternions(JO,c.rotation)):this.onlyUsedByOther&&(c.parentMatrix=s);for(var m=0;m<this.behaviors.length;m++)this.behaviors[m].initialize(c)}}},{key:"endEmit",value:function(){this.emitEnded=!0,this.autoDestroy&&(this.markForDestroy=!0)}},{key:"dispose",value:function(){this._renderer&&this._renderer.deleteSystem(this),this.emitter.dispose(),this.emitter.parent&&this.emitter.parent.remove(this.emitter)}},{key:"restart",value:function(){this.paused=!1,this.particleNum=0,this.emissionState.burstIndex=0,this.emissionState.burstWaveIndex=0,this.emissionState.time=0,this.emissionState.waitEmiting=0,this.behaviors.forEach(function(e){e.reset()}),this.emitEnded=!1,this.markForDestroy=!1,this.prewarmed=!1}},{key:"update",value:function(e){if(!this.paused){for(var i=this.emitter;i.parent;)i=i.parent;if(i.type!=="Scene"){this.dispose();return}if(this.emitEnded&&this.particleNum===0){this.markForDestroy&&this.emitter.parent&&this.dispose();return}if(this.looping&&this.prewarm&&!this.prewarmed){this.prewarmed=!0;for(var s=0;s<this.duration*bY;s++)this.update(1/bY)}e>.1&&(e=.1),this.neededToUpdateRender&&(this._renderer&&this._renderer.updateSystem(this),this.neededToUpdateRender=!1),this.onlyUsedByOther||this.emit(e,this.emissionState,this.emitter.matrixWorld);for(var r=0;r<this.behaviors.length;r++){for(var o=0;o<this.particleNum;o++)this.particles[o].died||this.behaviors[r].update(this.particles[o],e);this.behaviors[r].frameUpdate(e)}for(var a=0;a<this.particleNum;a++)this.rendererEmitterSettings.followLocalOrigin&&this.particles[a].localPosition?(this.particles[a].position.copy(this.particles[a].localPosition),this.particles[a].parentMatrix?this.particles[a].position.applyMatrix4(this.particles[a].parentMatrix):this.particles[a].position.applyMatrix4(this.emitter.matrixWorld)):this.particles[a].position.addScaledVector(this.particles[a].velocity,e),this.particles[a].age+=e;if(this.rendererSettings.renderMode===at.Trail)for(var l=0;l<this.particleNum;l++){var c=this.particles[l];c.update()}for(var h=0;h<this.particleNum;h++){var u=this.particles[h];u.died&&(!(u instanceof xx)||u.previous.length===0)&&(this.particles[h]=this.particles[this.particleNum-1],this.particles[this.particleNum-1]=u,this.particleNum--,h--)}}}},{key:"emit",value:function(e,i,s){i.time>this.duration&&(this.looping?(i.time-=this.duration,i.burstIndex=0,this.behaviors.forEach(function(c){c.reset()})):!this.emitEnded&&!this.onlyUsedByOther&&this.endEmit()),this.normalMatrix.getNormalMatrix(s);var r=Math.ceil(i.waitEmiting);for(this.spawn(r,i,s),i.waitEmiting-=r;i.burstIndex<this.emissionBursts.length&&this.emissionBursts[i.burstIndex].time<=i.time;){if(Math.random()<this.emissionBursts[i.burstIndex].probability){var o=this.emissionBursts[i.burstIndex].count;this.spawn(o,i,s)}i.burstIndex++}if(!this.emitEnded&&(i.waitEmiting+=e*this.emissionOverTime.genValue(i.time/this.duration),this.previousWorldPos!=null)){this.emitter.getWorldPosition(this.temp),this.travelDistance+=this.previousWorldPos.distanceTo(this.temp);var a=this.emissionOverDistance.genValue(i.time/this.duration);if(this.travelDistance*a>0){var l=Math.floor(this.travelDistance*a);this.travelDistance-=l/a,i.waitEmiting+=l}}this.previousWorldPos===void 0&&(this.previousWorldPos=new E),this.emitter.getWorldPosition(this.previousWorldPos),i.time+=e}},{key:"toJSON",value:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=e===void 0||typeof e=="string";if(s&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}}),e.materials[this.rendererSettings.material.uuid]=this.rendererSettings.material.toJSON(e),i.useUrlForImage&&this.texture.source!==void 0){var r=this.texture.source;e.images[r.uuid]={uuid:r.uuid,url:this.texture.image.url}}var o;this.renderMode===at.Trail?o={startLength:this.rendererEmitterSettings.startLength.toJSON(),followLocalOrigin:this.rendererEmitterSettings.followLocalOrigin}:this.renderMode===at.Mesh?o={}:o={};var a=this.rendererSettings.instancingGeometry;return e.geometries&&!e.geometries[a.uuid]&&(e.geometries[a.uuid]=a.toJSON()),{version:"2.0",autoDestroy:this.autoDestroy,looping:this.looping,prewarm:this.prewarm,duration:this.duration,shape:this.emitterShape.toJSON(),startLife:this.startLife.toJSON(),startSpeed:this.startSpeed.toJSON(),startRotation:this.startRotation.toJSON(),startSize:this.startSize.toJSON(),startColor:this.startColor.toJSON(),emissionOverTime:this.emissionOverTime.toJSON(),emissionOverDistance:this.emissionOverDistance.toJSON(),emissionBursts:this.emissionBursts,onlyUsedByOther:this.onlyUsedByOther,instancingGeometry:this.rendererSettings.instancingGeometry.uuid,renderOrder:this.renderOrder,renderMode:this.renderMode,rendererEmitterSettings:o,speedFactor:this.renderMode===at.StretchedBillBoard?this.speedFactor:0,material:this.rendererSettings.material.uuid,layers:this.layers.mask,startTileIndex:this.startTileIndex.toJSON(),uTileCount:this.uTileCount,vTileCount:this.vTileCount,behaviors:this.behaviors.map(function(l){return l.toJSON()}),worldSpace:this.worldSpace}}},{key:"addBehavior",value:function(e){this.behaviors.push(e)}},{key:"getRendererSettings",value:function(){return this.rendererSettings}},{key:"clone",value:function(){var e=[],i=UZ(this.emissionBursts),s;try{for(i.s();!(s=i.n()).done;){var r=s.value,o={};Object.assign(o,r),e.push(o)}}catch(m){i.e(m)}finally{i.f()}var a=[],l=UZ(this.behaviors),c;try{for(l.s();!(c=l.n()).done;){var h=c.value;a.push(h.clone())}}catch(m){l.e(m)}finally{l.f()}var u;this.renderMode===at.Trail?u={startLength:this.rendererEmitterSettings.startLength.clone(),followLocalOrigin:this.rendererEmitterSettings.followLocalOrigin}:u={};var d=new Mr;return d.mask=this.layers.mask,new n({autoDestroy:this.autoDestroy,looping:this.looping,duration:this.duration,shape:this.emitterShape.clone(),startLife:this.startLife.clone(),startSpeed:this.startSpeed.clone(),startRotation:this.startRotation.clone(),startSize:this.startSize.clone(),startColor:this.startColor.clone(),emissionOverTime:this.emissionOverTime.clone(),emissionOverDistance:this.emissionOverDistance.clone(),emissionBursts:e,onlyUsedByOther:this.onlyUsedByOther,instancingGeometry:this.rendererSettings.instancingGeometry,renderMode:this.renderMode,renderOrder:this.renderOrder,rendererEmitterSettings:u,speedFactor:this.speedFactor,material:this.rendererSettings.material,startTileIndex:this.startTileIndex,uTileCount:this.uTileCount,vTileCount:this.vTileCount,behaviors:a,worldSpace:this.worldSpace,layers:d})}}],[{key:"fromJSON",value:function(e,i,s){var r,o=h1e(e.shape,i),a;e.renderMode===at.Trail?a={startLength:e.rendererEmitterSettings.startLength!=null?Ki(e.rendererEmitterSettings.startLength):new Wr(30),followLocalOrigin:e.rendererEmitterSettings.followLocalOrigin}:e.renderMode===at.Mesh?a={}:a={};var l=new Mr;e.layers&&(l.mask=e.layers);var c=new n({autoDestroy:e.autoDestroy,looping:e.looping,prewarm:e.prewarm,duration:e.duration,shape:o,startLife:Ki(e.startLife),startSpeed:Ki(e.startSpeed),startRotation:$xe(e.startRotation),startSize:Ki(e.startSize),startColor:YO(e.startColor),emissionOverTime:Ki(e.emissionOverTime),emissionOverDistance:Ki(e.emissionOverDistance),emissionBursts:e.emissionBursts,onlyUsedByOther:e.onlyUsedByOther,instancingGeometry:i.geometries[e.instancingGeometry],renderMode:e.renderMode,rendererEmitterSettings:a,renderOrder:e.renderOrder,speedFactor:e.speedFactor,layers:l,material:e.material?i.materials[e.material]:e.texture?new Qt({map:i.textures[e.texture],transparent:(r=e.transparent)!==null&&r!==void 0?r:!0,blending:e.blending,side:xi}):new Qt({color:16777215,transparent:!0,blending:bp,side:xi}),startTileIndex:typeof e.startTileIndex=="number"?new Wr(e.startTileIndex):Ki(e.startTileIndex),uTileCount:e.uTileCount,vTileCount:e.vTileCount,behaviors:[],worldSpace:e.worldSpace});return c.behaviors=e.behaviors.map(function(h){var u=l1e(h,c);return u.type==="EmitSubParticleSystem"&&(s[h.subParticleSystem]=u),u}),c}}]),n}(),qO=`

#include <common>
#include <uv_pars_fragment>
#include <color_pars_fragment>
#include <map_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
#include <alphatest_pars_fragment>

void main() {

    #include <clipping_planes_fragment>
    
    vec3 outgoingLight = vec3( 0.0 );
    vec4 diffuseColor = vColor;
    
    #include <logdepthbuf_fragment>
    
    #ifdef USE_MAP
    diffuseColor *= texture2D( map, vMapUv);
    #endif
    
    #include <alphatest_fragment>

    outgoingLight = diffuseColor.rgb;
    
    gl_FragColor = vec4( outgoingLight, diffuseColor.a );
    
    #include <tonemapping_fragment>

}
`,g1e=`
#define STANDARD
#ifdef PHYSICAL
#define IOR
#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
uniform float ior;
#endif
#ifdef SPECULAR
uniform float specularIntensity;
uniform vec3 specularColor;
#ifdef USE_SPECULARINTENSITYMAP
uniform sampler2D specularIntensityMap;
#endif
#ifdef USE_SPECULARCOLORMAP
uniform sampler2D specularColorMap;
#endif
#endif
#ifdef USE_CLEARCOAT
uniform float clearcoat;
uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
uniform float iridescence;
uniform float iridescenceIOR;
uniform float iridescenceThicknessMinimum;
uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
uniform vec3 sheenColor;
uniform float sheenRoughness;
#ifdef USE_SHEENCOLORMAP
uniform sampler2D sheenColorMap;
#endif
#ifdef USE_SHEENROUGHNESSMAP
uniform sampler2D sheenRoughnessMap;
#endif
#endif

varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {
    #include <clipping_planes_fragment>
    vec4 diffuseColor = vec4( diffuse, opacity );
    ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
    vec3 totalEmissiveRadiance = emissive;
    #include <logdepthbuf_fragment>
    #include <map_fragment>
    #include <color_fragment>
    #include <alphamap_fragment>
    #include <alphatest_fragment>
    #include <roughnessmap_fragment>
    #include <metalnessmap_fragment>
    #include <normal_fragment_begin>
    #include <normal_fragment_maps>
    #include <clearcoat_normal_fragment_begin>
    #include <clearcoat_normal_fragment_maps>
    #include <emissivemap_fragment>
    // accumulation
    #include <lights_physical_fragment>
    #include <lights_fragment_begin>
    #include <lights_fragment_maps>
    #include <lights_fragment_end>
    // modulation
    #include <aomap_fragment>
    vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
    vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
    #include <transmission_fragment>
    vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
    #ifdef USE_SHEEN
    // Sheen energy compensation approximation calculation can be found at the end of
        // https://drive.google.com/file/d/1T0D1VSyR4AllqIJTQAraEIzjlb5h4FKH/view?usp=sharing
        float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
        outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
    #endif
    #ifdef USE_CLEARCOAT
        float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
        vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
        outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
    #endif
    #include <output_fragment>
    #include <tonemapping_fragment>
    #include <encodings_fragment>
    #include <fog_fragment>
    #include <premultiplied_alpha_fragment>
    #include <dithering_fragment>
}`,Cx=`

    #ifdef UV_TILE
        float col = mod(uvTile, tileCount.x);
        float row = (tileCount.y - floor(uvTile / tileCount.x) - 1.0);
        
        mat3 tileTransform = mat3(
          1.0 / tileCount.x, 0.0, 0.0,
          0.0, 1.0 / tileCount.y, 0.0, 
          col / tileCount.x, row / tileCount.y, 1.0);
    #else
        mat3 tileTransform = mat3(1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0);
    #endif

#if defined( USE_UV ) || defined( USE_ANISOTROPY )

vUv = (tileTransform *vec3( uv, 1 )).xy;

#endif
#ifdef USE_MAP

vMapUv = ( tileTransform * (mapTransform * vec3( MAP_UV, 1 ) )).xy;

#endif
#ifdef USE_ALPHAMAP

vAlphaMapUv = ( tileTransform * (alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_LIGHTMAP

vLightMapUv = ( tileTransform * (lightMapTransform * vec3( LIGHTMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_AOMAP

vAoMapUv = ( tileTransform * (aoMapTransform * vec3( AOMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_BUMPMAP

vBumpMapUv = ( tileTransform * (bumpMapTransform * vec3( BUMPMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_NORMALMAP

vNormalMapUv = ( tileTransform * (normalMapTransform * vec3( NORMALMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_DISPLACEMENTMAP

vDisplacementMapUv = ( tileTransform * (displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_EMISSIVEMAP

vEmissiveMapUv = ( tileTransform * (emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_METALNESSMAP

vMetalnessMapUv = ( tileTransform * (metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_ROUGHNESSMAP

vRoughnessMapUv = ( tileTransform * (roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_ANISOTROPYMAP

vAnisotropyMapUv = ( tileTransform * (anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_CLEARCOATMAP

vClearcoatMapUv = ( tileTransform * (clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_CLEARCOAT_NORMALMAP

vClearcoatNormalMapUv = ( tileTransform * (clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP

vClearcoatRoughnessMapUv = ( tileTransform * (clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_IRIDESCENCEMAP

vIridescenceMapUv = ( tileTransform * (iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP

vIridescenceThicknessMapUv = ( tileTransform * (iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SHEEN_COLORMAP

vSheenColorMapUv = ( tileTransform * (sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SHEEN_ROUGHNESSMAP

vSheenRoughnessMapUv = ( tileTransform * (sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SPECULARMAP

vSpecularMapUv = ( tileTransform * (specularMapTransform * vec3( SPECULARMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SPECULAR_COLORMAP

vSpecularColorMapUv = ( tileTransform * (specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SPECULAR_INTENSITYMAP

vSpecularIntensityMapUv = ( tileTransform * (specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_TRANSMISSIONMAP

vTransmissionMapUv = ( tileTransform * transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_THICKNESSMAP

vThicknessMapUv = ( tileTransform * thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) )).xy;

#endif
`,y1e=`
#include <common>
#include <color_pars_vertex>
#include <uv_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

attribute vec3 offset;
attribute float rotation;
attribute float size;
attribute float uvTile;

#ifdef UV_TILE
uniform vec2 tileCount;
#endif

void main() {

    `.concat(Cx,`
	
    vec2 alignedPosition = ( position.xy ) * size;
    
    vec2 rotatedPosition;
    rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
    rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
#ifdef HORIZONTAL
    vec4 mvPosition = modelMatrix * vec4( offset, 1.0 );
    mvPosition.x += rotatedPosition.x;
    mvPosition.z -= rotatedPosition.y;
    mvPosition = viewMatrix * mvPosition;
#elif defined(VERTICAL)
    vec4 mvPosition = modelMatrix * vec4( offset, 1.0 );
    mvPosition.y += rotatedPosition.y;
    mvPosition = viewMatrix * mvPosition;
    mvPosition.x += rotatedPosition.x;
#else
    vec4 mvPosition = modelViewMatrix * vec4( offset, 1.0 );
    mvPosition.xy += rotatedPosition;
#endif

	vColor = color;

	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

}
`),v1e=`
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

attribute vec3 offset;
attribute vec4 rotation;
attribute float size;
// attribute vec4 color;
attribute float uvTile;

#ifdef UV_TILE
uniform vec2 tileCount;
#endif

void main() {

    `.concat(Cx,`
    
    float x2 = rotation.x + rotation.x, y2 = rotation.y + rotation.y, z2 = rotation.z + rotation.z;
    float xx = rotation.x * x2, xy = rotation.x * y2, xz = rotation.x * z2;
    float yy = rotation.y * y2, yz = rotation.y * z2, zz = rotation.z * z2;
    float wx = rotation.w * x2, wy = rotation.w * y2, wz = rotation.w * z2;
    float sx = size, sy = size, sz = size;
    
    mat4 matrix = mat4(( 1.0 - ( yy + zz ) ) * sx, ( xy + wz ) * sx, ( xz - wy ) * sx, 0.0,  // 1. column
                      ( xy - wz ) * sy, ( 1.0 - ( xx + zz ) ) * sy, ( yz + wx ) * sy, 0.0,  // 2. column
                      ( xz + wy ) * sz, ( yz - wx ) * sz, ( 1.0 - ( xx + yy ) ) * sz, 0.0,  // 3. column
                      offset.x, offset.y, offset.z, 1.0);
    
    vec4 mvPosition = modelViewMatrix * (matrix * vec4( position, 1.0 ));

	vColor = color;

	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

}
`),b1e=`
#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>

attribute vec3 offset;
attribute vec4 rotation;
attribute float size;
attribute float uvTile;

#ifdef UV_TILE
uniform vec2 tileCount;
#endif

#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {
    `.concat(Cx,`

    float x2 = rotation.x + rotation.x, y2 = rotation.y + rotation.y, z2 = rotation.z + rotation.z;
    float xx = rotation.x * x2, xy = rotation.x * y2, xz = rotation.x * z2;
    float yy = rotation.y * y2, yz = rotation.y * z2, zz = rotation.z * z2;
    float wx = rotation.w * x2, wy = rotation.w * y2, wz = rotation.w * z2;
    float sx = size, sy = size, sz = size;

    mat4 particleMatrix = mat4(( 1.0 - ( yy + zz ) ) * sx, ( xy + wz ) * sx, ( xz - wy ) * sx, 0.0,  // 1. column
                      ( xy - wz ) * sy, ( 1.0 - ( xx + zz ) ) * sy, ( yz + wx ) * sy, 0.0,  // 2. column
                      ( xz + wy ) * sz, ( yz - wx ) * sz, ( 1.0 - ( xx + yy ) ) * sz, 0.0,  // 3. column
                      offset.x, offset.y, offset.z, 1.0);

	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>

	// replace defaultnormal_vertex
	vec3 transformedNormal = objectNormal;
    mat3 m = mat3( particleMatrix );
    transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
    transformedNormal = m * transformedNormal;
    transformedNormal = normalMatrix * transformedNormal;
    #ifdef FLIP_SIDED
        transformedNormal = - transformedNormal;
    #endif
    #ifdef USE_TANGENT
        vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
        #ifdef FLIP_SIDED
        transformedTangent = - transformedTangent;
        #endif
    #endif

	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>

	// replace include <project_vertex>
  vec4 mvPosition = vec4( transformed, 1.0 );
  mvPosition = modelViewMatrix * (particleMatrix * mvPosition);
	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	
	vViewPosition = - mvPosition.xyz;
	
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}
`),A1e=`
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

attribute vec3 offset;
attribute float rotation;
attribute float size;
attribute vec3 velocity;
attribute float uvTile;

#ifdef UV_TILE
uniform vec2 tileCount;
#endif

uniform float speedFactor;

void main() {

    `.concat(Cx,`
	
    vec4 mvPosition = modelViewMatrix * vec4( offset, 1.0 );
    vec3 viewVelocity = normalMatrix * velocity;

    vec3 scaledPos = vec3(position.xy * size, position.z);
    mvPosition.xyz += scaledPos + dot(scaledPos, viewVelocity) * viewVelocity / length(viewVelocity) * speedFactor;

	vColor = color;

	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

}
`);function $O(n){return n===0?"uv":"uv".concat(n)}new E(0,0,1);var x1e=function(n){ay(i,n);var e=ly(i);function i(s){var r;return Tt(this,i),r=e.call(this,s),$(hi(r),"offsetBuffer",void 0),$(hi(r),"rotationBuffer",void 0),$(hi(r),"sizeBuffer",void 0),$(hi(r),"colorBuffer",void 0),$(hi(r),"uvTileBuffer",void 0),$(hi(r),"velocityBuffer",void 0),$(hi(r),"vector_",new E),$(hi(r),"vector2_",new E),$(hi(r),"vector3_",new E),$(hi(r),"quaternion_",new Se),$(hi(r),"quaternion2_",new Se),$(hi(r),"quaternion3_",new Se),$(hi(r),"rotationMat_",new Gt),$(hi(r),"rotationMat2_",new Gt),r.maxParticles=1e3,r.setupBuffers(),r.rebuildMaterial(),r}return Rt(i,[{key:"buildExpandableBuffers",value:function(){this.offsetBuffer=new To(new Float32Array(this.maxParticles*3),3),this.offsetBuffer.setUsage(Sr),this.geometry.setAttribute("offset",this.offsetBuffer),this.colorBuffer=new To(new Float32Array(this.maxParticles*4),4),this.colorBuffer.setUsage(Sr),this.geometry.setAttribute("color",this.colorBuffer),this.settings.renderMode===at.Mesh?(this.rotationBuffer=new To(new Float32Array(this.maxParticles*4),4),this.rotationBuffer.setUsage(Sr),this.geometry.setAttribute("rotation",this.rotationBuffer)):(this.settings.renderMode===at.BillBoard||this.settings.renderMode===at.HorizontalBillBoard||this.settings.renderMode===at.VerticalBillBoard||this.settings.renderMode===at.StretchedBillBoard)&&(this.rotationBuffer=new To(new Float32Array(this.maxParticles),1),this.rotationBuffer.setUsage(Sr),this.geometry.setAttribute("rotation",this.rotationBuffer)),this.sizeBuffer=new To(new Float32Array(this.maxParticles),1),this.sizeBuffer.setUsage(Sr),this.geometry.setAttribute("size",this.sizeBuffer),this.uvTileBuffer=new To(new Float32Array(this.maxParticles),1),this.uvTileBuffer.setUsage(Sr),this.geometry.setAttribute("uvTile",this.uvTileBuffer),this.settings.renderMode===at.StretchedBillBoard&&(this.velocityBuffer=new To(new Float32Array(this.maxParticles*3),3),this.velocityBuffer.setUsage(Sr),this.geometry.setAttribute("velocity",this.velocityBuffer))}},{key:"setupBuffers",value:function(){this.geometry&&this.geometry.dispose(),this.geometry=new Qw,this.geometry.setIndex(this.settings.instancingGeometry.getIndex()),this.settings.instancingGeometry.hasAttribute("normal")&&this.geometry.setAttribute("normal",this.settings.instancingGeometry.getAttribute("normal")),this.geometry.setAttribute("position",this.settings.instancingGeometry.getAttribute("position")),this.geometry.setAttribute("uv",this.settings.instancingGeometry.getAttribute("uv")),this.buildExpandableBuffers()}},{key:"expandBuffers",value:function(s){for(;s>=this.maxParticles;)this.maxParticles*=2;this.setupBuffers()}},{key:"rebuildMaterial",value:function(){this.layers.mask=this.settings.layers.mask;var s,r={};if(this.settings.material.type==="MeshStandardMaterial"||this.settings.material.type==="MeshPhysicalMaterial"){var o=this.settings.material;s=Kf.merge([Ve.common,Ve.envmap,Ve.aomap,Ve.lightmap,Ve.emissivemap,Ve.bumpmap,Ve.normalmap,Ve.displacementmap,Ve.roughnessmap,Ve.metalnessmap,Ve.fog,Ve.lights,{emissive:{value:new Ae(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),s.diffuse.value=o.color,s.opacity.value=o.opacity,s.emissive.value=o.emissive,s.roughness.value=o.roughness,s.metalness.value=o.metalness,o.envMap&&(s.envMap.value=o.envMap,s.envMapIntensity.value=o.envMapIntensity),o.normalMap&&(s.normalMap.value=o.normalMap,s.normalScale.value=o.normalScale),o.roughnessMap&&(s.roughnessMap.value=o.roughnessMap),o.metalnessMap&&(s.metalnessMap.value=o.metalnessMap),o.map&&(s.map=new Ce(o.map))}else s={},s.map=new Ce(this.settings.material.map);this.settings.material.alphaTest&&(r.USE_ALPHATEST="",s.alphaTest=new Ce(this.settings.material.alphaTest)),r.USE_UV="";var a=this.settings.uTileCount,l=this.settings.vTileCount;(a>1||l>1)&&(r.UV_TILE="",s.tileCount=new Ce(new Y(a,l))),this.settings.material.normalMap&&(r.USE_NORMALMAP="",r.NORMALMAP_UV=$O(this.settings.material.normalMap.channel),s.normalMapTransform=new Ce(new Gt().copy(this.settings.material.normalMap.matrix))),this.settings.material.map&&(r.USE_MAP="",r.MAP_UV=$O(this.settings.material.map.channel),s.mapTransform=new Ce(new Gt().copy(this.settings.material.map.matrix))),r.USE_COLOR_ALPHA="";var c=!1;if(this.settings.renderMode===at.BillBoard||this.settings.renderMode===at.VerticalBillBoard||this.settings.renderMode===at.HorizontalBillBoard||this.settings.renderMode===at.Mesh){var h,u;this.settings.renderMode===at.Mesh?this.settings.material.type==="MeshStandardMaterial"||this.settings.material.type==="MeshPhysicalMaterial"?(r.USE_COLOR="",h=b1e,u=g1e,c=!0):(h=v1e,u=qO):(h=y1e,u=qO),this.settings.renderMode===at.VerticalBillBoard?r.VERTICAL="":this.settings.renderMode===at.HorizontalBillBoard&&(r.HORIZONTAL=""),this.material=new kt({uniforms:s,defines:r,vertexShader:h,fragmentShader:u,transparent:this.settings.material.transparent,depthWrite:!this.settings.material.transparent,blending:this.settings.material.blending,side:this.settings.material.side,alphaTest:this.settings.material.alphaTest,lights:c})}else if(this.settings.renderMode===at.StretchedBillBoard)s.speedFactor=new Ce(1),this.material=new kt({uniforms:s,defines:r,vertexShader:A1e,fragmentShader:qO,transparent:this.settings.material.transparent,depthWrite:!this.settings.material.transparent,blending:this.settings.material.blending,side:this.settings.material.side,alphaTest:this.settings.material.alphaTest});else throw new Error("render mode unavailable")}},{key:"update",value:function(){var s=this,r=0,o=0;this.systems.forEach(function(a){o+=a.particleNum}),o>this.maxParticles&&this.expandBuffers(o),this.systems.forEach(function(a){var l=a.particles,c=a.particleNum,h=s.quaternion2_,u=s.vector2_,d=s.vector3_;a.emitter.matrixWorld.decompose(u,h,d),s.rotationMat_.setFromMatrix4(a.emitter.matrixWorld);for(var m=0;m<c;m++,r++){var f=l[m];if(s.settings.renderMode===at.Mesh){var g=void 0;if(a.worldSpace)g=f.rotation;else{var y=void 0;f.parentMatrix?y=s.quaternion3_.setFromRotationMatrix(f.parentMatrix):y=h,g=s.quaternion_,g.copy(f.rotation).multiply(y)}s.rotationBuffer.setXYZW(r,g.x,g.y,g.z,g.w)}else(s.settings.renderMode===at.StretchedBillBoard||s.settings.renderMode===at.VerticalBillBoard||s.settings.renderMode===at.HorizontalBillBoard||s.settings.renderMode===at.BillBoard)&&s.rotationBuffer.setX(r,f.rotation);var v=void 0;if(a.worldSpace?v=f.position:(v=s.vector_,f.parentMatrix?v.copy(f.position).applyMatrix4(f.parentMatrix):v.copy(f.position).applyMatrix4(a.emitter.matrixWorld)),s.offsetBuffer.setXYZ(r,v.x,v.y,v.z),s.colorBuffer.setXYZW(r,f.color.x,f.color.y,f.color.z,f.color.w),a.worldSpace||f.parentMatrix?s.sizeBuffer.setX(r,f.size):s.sizeBuffer.setX(r,f.size*(Math.abs(d.x)+Math.abs(d.y)+Math.abs(d.z))/3),s.uvTileBuffer.setX(r,f.uvTile),s.settings.renderMode===at.StretchedBillBoard&&s.velocityBuffer){var b=a.speedFactor,A=void 0;a.worldSpace?A=f.velocity:(A=s.vector_,f.parentMatrix?(s.rotationMat2_.setFromMatrix4(f.parentMatrix),A.copy(f.velocity).applyMatrix3(s.rotationMat2_)):A.copy(f.velocity).applyMatrix3(s.rotationMat_)),s.velocityBuffer.setXYZ(r,A.x*b,A.y*b,A.z*b)}}}),this.geometry.instanceCount=r,r>0&&(this.offsetBuffer.updateRange.count=r*3,this.offsetBuffer.needsUpdate=!0,this.sizeBuffer.updateRange.count=r,this.sizeBuffer.needsUpdate=!0,this.colorBuffer.updateRange.count=r*4,this.colorBuffer.needsUpdate=!0,this.uvTileBuffer.updateRange.count=r,this.uvTileBuffer.needsUpdate=!0,this.settings.renderMode===at.StretchedBillBoard&&this.velocityBuffer&&(this.velocityBuffer.updateRange.count=r*3,this.velocityBuffer.needsUpdate=!0),this.settings.renderMode===at.Mesh?(this.rotationBuffer.updateRange.count=r*4,this.rotationBuffer.needsUpdate=!0):(this.settings.renderMode===at.StretchedBillBoard||this.settings.renderMode===at.HorizontalBillBoard||this.settings.renderMode===at.VerticalBillBoard||this.settings.renderMode===at.BillBoard)&&(this.rotationBuffer.updateRange.count=r,this.rotationBuffer.needsUpdate=!0))}},{key:"dispose",value:function(){this.geometry.dispose()}}]),i}(vY),w1e=`

#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

uniform sampler2D alphaMap;
uniform float useAlphaMap;
uniform float visibility;
uniform float alphaTest;
uniform vec2 repeat;

varying vec4 vColor;
    
void main() {
    #include <clipping_planes_fragment>
    #include <logdepthbuf_fragment>

    vec4 c = vColor;
    
    #ifdef USE_MAP
    c *= texture2D( map, vUv * repeat );
    #endif
    if( useAlphaMap == 1. ) c.a *= texture2D( alphaMap, vUv * repeat ).a;
    if( c.a < alphaTest ) discard;
    gl_FragColor = c;

    #include <fog_fragment>
    #include <tonemapping_fragment>
}`,_1e=`
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <clipping_planes_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <fog_pars_vertex>

attribute vec3 previous;
attribute vec3 next;
attribute float side;
attribute float width;

uniform vec2 resolution;
uniform float lineWidth;
uniform float sizeAttenuation;
    
vec2 fix(vec4 i, float aspect) {
    vec2 res = i.xy / i.w;
    res.x *= aspect;
    return res;
}
    
void main() {

    `.concat(Cx,`
    
    float aspect = resolution.x / resolution.y;

    vColor = color;

    mat4 m = projectionMatrix * modelViewMatrix;
    vec4 finalPosition = m * vec4( position, 1.0 );
    vec4 prevPos = m * vec4( previous, 1.0 );
    vec4 nextPos = m * vec4( next, 1.0 );

    vec2 currentP = fix( finalPosition, aspect );
    vec2 prevP = fix( prevPos, aspect );
    vec2 nextP = fix( nextPos, aspect );

    float w = lineWidth * width;

    vec2 dir;
    if( nextP == currentP ) dir = normalize( currentP - prevP );
    else if( prevP == currentP ) dir = normalize( nextP - currentP );
    else {
        vec2 dir1 = normalize( currentP - prevP );
        vec2 dir2 = normalize( nextP - currentP );
        dir = normalize( dir1 + dir2 );

        vec2 perp = vec2( -dir1.y, dir1.x );
        vec2 miter = vec2( -dir.y, dir.x );
        //w = clamp( w / dot( miter, perp ), 0., 4., * lineWidth * width );

    }

    //vec2 normal = ( cross( vec3( dir, 0. ) vec3( 0., 0., 1. ) ) ).xy;
    vec4 normal = vec4( -dir.y, dir.x, 0., 1. );
    normal.xy *= .5 * w;
    normal *= projectionMatrix;
    if( sizeAttenuation == 0. ) {
        normal.xy *= finalPosition.w;
        normal.xy /= ( vec4( resolution, 0., 1. ) * projectionMatrix ).xy;
    }

    finalPosition.xy += normal.xy * side;

    gl_Position = finalPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	
    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
    
	#include <fog_vertex>
}`);new E(0,0,1);var S1e=function(n){ay(i,n);var e=ly(i);function i(s){var r;return Tt(this,i),r=e.call(this,s),$(hi(r),"positionBuffer",void 0),$(hi(r),"previousBuffer",void 0),$(hi(r),"nextBuffer",void 0),$(hi(r),"uvBuffer",void 0),$(hi(r),"sideBuffer",void 0),$(hi(r),"widthBuffer",void 0),$(hi(r),"colorBuffer",void 0),$(hi(r),"indexBuffer",void 0),$(hi(r),"vector_",new E),$(hi(r),"vector2_",new E),$(hi(r),"vector3_",new E),$(hi(r),"quaternion_",new Se),r.maxParticles=1e4,r.setupBuffers(),r.rebuildMaterial(),r}return Rt(i,[{key:"setupBuffers",value:function(){this.geometry&&this.geometry.dispose(),this.geometry=new dt,this.indexBuffer=new qe(new Uint32Array(this.maxParticles*6),1),this.indexBuffer.setUsage(Sr),this.geometry.setIndex(this.indexBuffer),this.positionBuffer=new qe(new Float32Array(this.maxParticles*6),3),this.positionBuffer.setUsage(Sr),this.geometry.setAttribute("position",this.positionBuffer),this.previousBuffer=new qe(new Float32Array(this.maxParticles*6),3),this.previousBuffer.setUsage(Sr),this.geometry.setAttribute("previous",this.previousBuffer),this.nextBuffer=new qe(new Float32Array(this.maxParticles*6),3),this.nextBuffer.setUsage(Sr),this.geometry.setAttribute("next",this.nextBuffer),this.widthBuffer=new qe(new Float32Array(this.maxParticles*2),1),this.widthBuffer.setUsage(Sr),this.geometry.setAttribute("width",this.widthBuffer),this.sideBuffer=new qe(new Float32Array(this.maxParticles*2),1),this.sideBuffer.setUsage(Sr),this.geometry.setAttribute("side",this.sideBuffer),this.uvBuffer=new qe(new Float32Array(this.maxParticles*4),2),this.uvBuffer.setUsage(Sr),this.geometry.setAttribute("uv",this.uvBuffer),this.colorBuffer=new qe(new Float32Array(this.maxParticles*8),4),this.colorBuffer.setUsage(Sr),this.geometry.setAttribute("color",this.colorBuffer)}},{key:"expandBuffers",value:function(s){for(;s>=this.maxParticles;)this.maxParticles*=2;this.setupBuffers()}},{key:"rebuildMaterial",value:function(){this.layers.mask=this.settings.layers.mask;var s={lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},resolution:{value:new Y(1,1)},sizeAttenuation:{value:1},visibility:{value:1},alphaTest:{value:0},repeat:{value:new Y(1,1)}},r={};if(r.USE_UV="",r.USE_COLOR_ALPHA="",this.settings.material.map&&(r.USE_MAP="",r.MAP_UV=$O(this.settings.material.map.channel),s.map=new Ce(this.settings.material.map),s.mapTransform=new Ce(new Gt().copy(this.settings.material.map.matrix))),this.settings.renderMode===at.Trail)this.material=new kt({uniforms:s,defines:r,vertexShader:_1e,fragmentShader:w1e,transparent:this.settings.material.transparent,depthWrite:!this.settings.material.transparent,side:this.settings.material.side,blending:this.settings.material.blending||bp});else throw new Error("render mode unavailable")}},{key:"update",value:function(){var s=this,r=0,o=0,a=0;this.systems.forEach(function(l){for(var c=0;c<l.particleNum;c++)a+=l.particles[c].previous.length*2}),a>this.maxParticles&&this.expandBuffers(a),this.systems.forEach(function(l){var c=s.quaternion_,h=s.vector2_,u=s.vector3_;l.emitter.matrixWorld.decompose(h,c,u);for(var d=l.particles,m=l.particleNum,f=s.settings.uTileCount,g=s.settings.vTileCount,y=1/f,v=1/g,b=0;b<m;b++){var A=d[b],x=A.uvTile%g,w=Math.floor(A.uvTile/g),_=A.previous.values(),S=_.next(),M=S.value,R=M;S.done||(S=_.next());var P=void 0;S.value!==void 0?P=S.value:P=R;for(var C=0;C<A.previous.length;C++,r+=2){if(s.positionBuffer.setXYZ(r,R.position.x,R.position.y,R.position.z),s.positionBuffer.setXYZ(r+1,R.position.x,R.position.y,R.position.z),l.worldSpace?(s.positionBuffer.setXYZ(r,R.position.x,R.position.y,R.position.z),s.positionBuffer.setXYZ(r+1,R.position.x,R.position.y,R.position.z)):(A.parentMatrix?s.vector_.copy(R.position).applyMatrix4(A.parentMatrix):s.vector_.copy(R.position).applyMatrix4(l.emitter.matrixWorld),s.positionBuffer.setXYZ(r,s.vector_.x,s.vector_.y,s.vector_.z),s.positionBuffer.setXYZ(r+1,s.vector_.x,s.vector_.y,s.vector_.z)),l.worldSpace?(s.previousBuffer.setXYZ(r,M.position.x,M.position.y,M.position.z),s.previousBuffer.setXYZ(r+1,M.position.x,M.position.y,M.position.z)):(A.parentMatrix?s.vector_.copy(M.position).applyMatrix4(A.parentMatrix):s.vector_.copy(M.position).applyMatrix4(l.emitter.matrixWorld),s.previousBuffer.setXYZ(r,s.vector_.x,s.vector_.y,s.vector_.z),s.previousBuffer.setXYZ(r+1,s.vector_.x,s.vector_.y,s.vector_.z)),l.worldSpace?(s.nextBuffer.setXYZ(r,P.position.x,P.position.y,P.position.z),s.nextBuffer.setXYZ(r+1,P.position.x,P.position.y,P.position.z)):(A.parentMatrix?s.vector_.copy(P.position).applyMatrix4(A.parentMatrix):s.vector_.copy(P.position).applyMatrix4(l.emitter.matrixWorld),s.nextBuffer.setXYZ(r,s.vector_.x,s.vector_.y,s.vector_.z),s.nextBuffer.setXYZ(r+1,s.vector_.x,s.vector_.y,s.vector_.z)),s.sideBuffer.setX(r,-1),s.sideBuffer.setX(r+1,1),l.worldSpace)s.widthBuffer.setX(r,R.size),s.widthBuffer.setX(r+1,R.size);else if(A.parentMatrix)s.widthBuffer.setX(r,R.size),s.widthBuffer.setX(r+1,R.size);else{var L=(Math.abs(u.x)+Math.abs(u.y)+Math.abs(u.z))/3;s.widthBuffer.setX(r,R.size*L),s.widthBuffer.setX(r+1,R.size*L)}s.uvBuffer.setXY(r,(C/A.previous.length+x)*y,(g-w-1)*v),s.uvBuffer.setXY(r+1,(C/A.previous.length+x)*y,(g-w)*v),s.colorBuffer.setXYZW(r,R.color.x,R.color.y,R.color.z,R.color.w),s.colorBuffer.setXYZW(r+1,R.color.x,R.color.y,R.color.z,R.color.w),C+1<A.previous.length&&(s.indexBuffer.setX(o*3,r),s.indexBuffer.setX(o*3+1,r+1),s.indexBuffer.setX(o*3+2,r+2),o++,s.indexBuffer.setX(o*3,r+2),s.indexBuffer.setX(o*3+1,r+1),s.indexBuffer.setX(o*3+2,r+3),o++),M=R,R=P,S.done||(S=_.next(),S.value!==void 0&&(P=S.value))}}}),this.positionBuffer.updateRange.count=r*3,this.positionBuffer.needsUpdate=!0,this.previousBuffer.updateRange.count=r*3,this.previousBuffer.needsUpdate=!0,this.nextBuffer.updateRange.count=r*3,this.nextBuffer.needsUpdate=!0,this.sideBuffer.updateRange.count=r,this.sideBuffer.needsUpdate=!0,this.widthBuffer.updateRange.count=r,this.widthBuffer.needsUpdate=!0,this.uvBuffer.updateRange.count=r*2,this.uvBuffer.needsUpdate=!0,this.colorBuffer.updateRange.count=r*4,this.colorBuffer.needsUpdate=!0,this.indexBuffer.updateRange.count=o*3,this.indexBuffer.needsUpdate=!0,this.geometry.setDrawRange(0,o*3)}},{key:"dispose",value:function(){this.geometry.dispose()}}]),i}(vY),C1e=function(n){ay(i,n);var e=ly(i);function i(){var s;return Tt(this,i),s=e.call(this),$(hi(s),"batches",[]),$(hi(s),"systemToBatchIndex",new Map),$(hi(s),"type","BatchedRenderer"),s}return Rt(i,[{key:"addSystem",value:function(s){s._renderer=this;for(var r=s.getRendererSettings(),o=0;o<this.batches.length;o++)if(i.equals(this.batches[o].settings,r)){this.batches[o].addSystem(s),this.systemToBatchIndex.set(s,o);return}var a;switch(r.renderMode){case at.Trail:a=new S1e(r);break;case at.Mesh:case at.BillBoard:case at.VerticalBillBoard:case at.HorizontalBillBoard:case at.StretchedBillBoard:a=new x1e(r);break}a.addSystem(s),this.batches.push(a),this.systemToBatchIndex.set(s,this.batches.length-1),this.add(a)}},{key:"deleteSystem",value:function(s){var r=this.systemToBatchIndex.get(s);r!=null&&(this.batches[r].removeSystem(s),this.systemToBatchIndex.delete(s))}},{key:"updateSystem",value:function(s){this.deleteSystem(s),this.addSystem(s)}},{key:"update",value:function(s){this.systemToBatchIndex.forEach(function(o,a){a.update(s)});for(var r=0;r<this.batches.length;r++)this.batches[r].update()}}],[{key:"equals",value:function(s,r){return s.material.side===r.material.side&&s.material.blending===r.material.blending&&s.material.transparent===r.material.transparent&&s.material.type===r.material.type&&s.material.alphaTest===r.material.alphaTest&&s.material.map===r.material.map&&s.renderMode===r.renderMode&&s.uTileCount===r.uTileCount&&s.vTileCount===r.vTileCount&&s.instancingGeometry===r.instancingGeometry&&s.renderOrder===r.renderOrder&&s.layers.mask===r.layers.mask}}]),i}(ye),M1e=C1e,AY=function(){function n(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new E;Tt(this,n),$(this,"locations",[]),this.scaleX=e,this.scaleY=i,this.position=s}return Rt(n,[{key:"transform",value:function(e,i){e.x=this.locations[i%this.locations.length].x*this.scaleX+this.position.x,e.y=this.locations[i%this.locations.length].y*this.scaleY+this.position.y,e.z=this.position.z}},{key:"clone",value:function(){var e=new n(this.scaleX,this.scaleY,this.position.clone());return e.locations=this.locations.map(function(i){return i.clone()}),e}},{key:"toJSON",value:function(){return{scaleX:this.scaleX,scaleY:this.scaleY,position:this.position,locations:this.locations.map(function(e){return{x:e.x,y:e.y}})}}},{key:"fromImage",value:function(e,i){var s=document.createElement("canvas");s.width=e.width,s.height=e.height;var r=s.getContext("2d");if(r){r.drawImage(e,0,0);var o=r.getImageData(0,0,s.width,s.height,{colorSpace:"srgb"});s.remove(),this.locations.length=0;for(var a=0;a<o.height;a++)for(var l=0;l<o.width;l++)o.data[(a*o.width+l)*4+3]>i&&this.locations.push(new Y(l,o.height-a))}}}],[{key:"fromJSON",value:function(e){var i=new n(e.scaleX,e.scaleY,new E(e.position[0],e.position[1],e.position[2]));return i.locations=e.locations.map(function(s){return new Y(s.x,s.y)}),i}}]),n}();function E1e(n){switch(n.type){case"TextureSequencer":return AY.fromJSON(n);default:return new AY}}var T1e=function(){function n(e){Tt(this,n),$(this,"type","ApplySequences"),$(this,"sequencers",[]),$(this,"time",0),$(this,"index",0),$(this,"pCount",0),$(this,"delay",void 0),$(this,"tempV",new E),this.delay=e}return Rt(n,[{key:"initialize",value:function(e){e.id=this.pCount,e.dst=new E,e.begin=new E,e.inMotion=!1,this.pCount++}},{key:"reset",value:function(){this.time=0,this.index=0,this.pCount=0}},{key:"update",value:function(e,i){var s=this.sequencers[this.index],r=e.id*this.delay;this.time>=s[0].a+r&&this.time<=s[0].b+r?(e.inMotion||(e.inMotion=!0,e.begin.copy(e.position),s[1].transform(e.dst,e.id)),e.position.lerpVectors(e.begin,e.dst,n.BEZIER.genValue((this.time-s[0].a-r)/(s[0].b-s[0].a)))):this.time>s[0].b+r&&(e.inMotion=!1)}},{key:"frameUpdate",value:function(e){for(;this.index+1<this.sequencers.length&&this.time>=this.sequencers[this.index+1][0].a;)this.index++;this.time+=e}},{key:"appendSequencer",value:function(e,i){this.sequencers.push([e,i])}},{key:"toJSON",value:function(){return{type:this.type,delay:this.delay,sequencers:this.sequencers.map(function(e){var i=cy(e,2),s=i[0],r=i[1];return{range:s.toJSON(),sequencer:r.toJSON()}})}}},{key:"clone",value:function(){var e=new n(this.delay);return e.sequencers=this.sequencers.map(function(i){return[i[0].clone(),i[1].clone()]}),e}}],[{key:"fromJSON",value:function(e){var i=new n(e.delay);return e.sequencers.forEach(function(s){i.sequencers.push([Ki(s.range),E1e(s.sequencer)])}),i}}]),n}();$(T1e,"BEZIER",new HO(0,0,1,1));var de=function(n){return n[n.Number=0]="Number",n[n.Vec2=1]="Vec2",n[n.Vec3=2]="Vec3",n[n.Vec4=3]="Vec4",n[n.Boolean=4]="Boolean",n[n.AnyType=5]="AnyType",n}({}),xY=Rt(function n(e,i,s,r){Tt(this,n),$(this,"input",void 0),$(this,"inputIndex",void 0),$(this,"output",void 0),$(this,"outputIndex",void 0),this.input=e,this.inputIndex=i,this.input.outputs[i].push(this),this.output=s,this.outputIndex=r,this.output.inputs[r]=this}),R1e=function(){function n(){Tt(this,n),$(this,"visited",new Set),$(this,"graph_",void 0),$(this,"context_",void 0),n.Instance=this}return Rt(n,[{key:"traverse",value:function(e){if(this.context_===void 0)throw new Error("context is undefined");if(this.graph_===void 0)throw new Error("graph is undefined");this.visited.add(e.id);for(var i=[],s=0;s<e.inputs.length;s++)if(e.inputs[s]instanceof xY){var r=e.inputs[s].input;this.visited.has(r.id)||this.traverse(r),i.push(r.outputValues[e.inputs[s].inputIndex])}else i.push(e.inputs[s].getValue(this.context_));e.func(this.context_,i,e.outputValues),this.graph_.nodesInOrder.push(e)}},{key:"executeCompiledGraph",value:function(){if(this.context_===void 0)throw new Error("context is undefined");if(this.graph_===void 0)throw new Error("graph is undefined");for(var e=this.graph_.nodesInOrder,i=0;i<e.length;i++){for(var s=[],r=e[i],o=0;o<r.inputs.length;o++)if(r.inputs[o]instanceof xY)s.push(r.inputs[o].input.outputValues[r.inputs[o].inputIndex]);else if(r.inputs[o]!==void 0)s.push(r.inputs[o].getValue(this.context_));else throw new Error("miss input for node ".concat(r.id));r.func(this.context_,s,r.outputValues)}}},{key:"run",value:function(e,i){if(this.graph_=e,this.context_=i,e.compiled)this.executeCompiledGraph();else{e.nodesInOrder.length=0,this.visited.clear();for(var s=0;s<e.outputNodes.length;s++){var r=e.outputNodes[s];this.traverse(r)}e.compiled=!0}}}]),n}();$(R1e,"Instance",void 0);var vi=function(){function n(e){Tt(this,n),$(this,"name",void 0),$(this,"nodeTypeSignatures",[]),this.name=e}return Rt(n,[{key:"addSignature",value:function(e,i,s){this.nodeTypeSignatures.push({inputTypes:e,outputTypes:i,func:s})}}]),n}(),dE=new vi("add");dE.addSignature([de.Number,de.Number],[de.Number],function(n,e,i,s){s[0]=i[0]+i[1]}),dE.addSignature([de.Vec2,de.Vec2],[de.Vec2],function(n,e,i,s){s[0].addVectors(i[0],i[1])}),dE.addSignature([de.Vec3,de.Vec3],[de.Vec3],function(n,e,i,s){s[0].addVectors(i[0],i[1])}),dE.addSignature([de.Vec4,de.Vec4],[de.Vec4],function(n,e,i,s){s[0].addVectors(i[0],i[1])});var pE=new vi("sub");pE.addSignature([de.Number,de.Number],[de.Number],function(n,e,i,s){s[0]=i[0]-i[1]}),pE.addSignature([de.Vec2,de.Vec2],[de.Vec2],function(n,e,i,s){s[0].subVectors(i[0],i[1])}),pE.addSignature([de.Vec3,de.Vec3],[de.Vec3],function(n,e,i,s){s[0].subVectors(i[0],i[1])}),pE.addSignature([de.Vec4,de.Vec4],[de.Vec4],function(n,e,i,s){s[0].subVectors(i[0],i[1])});var mE=new vi("mul");mE.addSignature([de.Number,de.Number],[de.Number],function(n,e,i,s){s[0]=i[0]*i[1]}),mE.addSignature([de.Vec2,de.Number],[de.Vec2],function(n,e,i,s){s[0].copy(i[0]).multiplyScalar(i[1])}),mE.addSignature([de.Vec3,de.Number],[de.Vec3],function(n,e,i,s){s[0].copy(i[0]).multiplyScalar(i[1])}),mE.addSignature([de.Vec4,de.Number],[de.Vec4],function(n,e,i,s){s[0].copy(i[0]).multiplyScalar(i[1])});var fE=new vi("div");fE.addSignature([de.Number,de.Number],[de.Number],function(n,e,i,s){s[0]=i[0]/i[1]}),fE.addSignature([de.Vec2,de.Number],[de.Vec2],function(n,e,i,s){s[0].copy(i[0]).divideScalar(i[1])}),fE.addSignature([de.Vec3,de.Number],[de.Vec3],function(n,e,i,s){s[0].copy(i[0]).divideScalar(i[1])}),fE.addSignature([de.Vec4,de.Number],[de.Vec4],function(n,e,i,s){s[0].copy(i[0]).divideScalar(i[1])});var I1e=new vi("sin");I1e.addSignature([de.Number],[de.Number],function(n,e,i,s){s[0]=Math.sin(i[0])});var L1e=new vi("cos");L1e.addSignature([de.Number],[de.Number],function(n,e,i,s){s[0]=Math.cos(i[0])});var P1e=new vi("tan");P1e.addSignature([de.Number],[de.Number],function(n,e,i,s){s[0]=Math.tan(i[0])});var B1e=new vi("abs");B1e.addSignature([de.Number],[de.Number],function(n,e,i,s){s[0]=Math.abs(i[0])});var k1e=new vi("min");k1e.addSignature([de.Number,de.Number],[de.Number],function(n,e,i,s){s[0]=Math.min(i[0],i[1])});var D1e=new vi("max");D1e.addSignature([de.Number,de.Number],[de.Number],function(n,e,i,s){s[0]=Math.max(i[0],i[1])});var eG=new vi("dot");eG.addSignature([de.Vec2,de.Vec2],[de.Number],function(n,e,i,s){s[0]=i[0].dot(i[1])}),eG.addSignature([de.Vec3,de.Vec3],[de.Number],function(n,e,i,s){s[0]=i[0].dot(i[1])}),eG.addSignature([de.Vec4,de.Vec4],[de.Number],function(n,e,i,s){s[0]=i[0].dot(i[1])});var O1e=new vi("cross");O1e.addSignature([de.Vec3,de.Vec3],[de.Vec3],function(n,e,i,s){s[0].crossVectors(i[0],i[1])});var tG=new vi("length");tG.addSignature([de.Vec2],[de.Number],function(n,e,i,s){s[0]=i[0].length()}),tG.addSignature([de.Vec3],[de.Number],function(n,e,i,s){s[0]=i[0].length()}),tG.addSignature([de.Vec4],[de.Number],function(n,e,i,s){s[0]=i[0].length()});var iG=new vi("lengthSq");iG.addSignature([de.Vec2],[de.Number],function(n,e,i,s){s[0]=i[0].lengthSq()}),iG.addSignature([de.Vec3],[de.Number],function(n,e,i,s){s[0]=i[0].lengthSq()}),iG.addSignature([de.Vec4],[de.Number],function(n,e,i,s){s[0]=i[0].lengthSq()});var nG=new vi("normalize");nG.addSignature([de.Vec2],[de.Vec2],function(n,e,i,s){s[0].copy(i[0]).normalize()}),nG.addSignature([de.Vec3],[de.Vec3],function(n,e,i,s){s[0].copy(i[0]).normalize()}),nG.addSignature([de.Vec4],[de.Vec4],function(n,e,i,s){s[0].copy(i[0]).normalize()});var wY=new vi("distance");wY.addSignature([de.Vec2,de.Vec2],[de.Number],function(n,e,i,s){s[0]=i[0].distanceTo(i[1])}),wY.addSignature([de.Vec3,de.Vec3],[de.Number],function(n,e,i,s){s[0]=i[0].distanceTo(i[1])});var G1e=new vi("and");G1e.addSignature([de.Boolean,de.Boolean],[de.Boolean],function(n,e,i,s){s[0]=i[0]&&i[1]});var z1e=new vi("or");z1e.addSignature([de.Boolean,de.Boolean],[de.Boolean],function(n,e,i,s){s[0]=i[0]||i[1]});var F1e=new vi("not");F1e.addSignature([de.Boolean],[de.Boolean],function(n,e,i,s){s[0]=!i[0]});var gE=new vi("equal");gE.addSignature([de.Number,de.Number],[de.Boolean],function(n,e,i,s){s[0]=i[0]===i[1]}),gE.addSignature([de.Vec2,de.Vec2],[de.Boolean],function(n,e,i,s){s[0]=i[0].equals(i[1])}),gE.addSignature([de.Vec3,de.Vec3],[de.Boolean],function(n,e,i,s){s[0]=i[0].equals(i[1])}),gE.addSignature([de.Vec4,de.Vec4],[de.Boolean],function(n,e,i,s){s[0]=i[0].equals(i[1])});var N1e=new vi("lessThan");N1e.addSignature([de.Number,de.Number],[de.Boolean],function(n,e,i,s){s[0]=i[0]<i[1]});var U1e=new vi("greaterThan");U1e.addSignature([de.Number,de.Number],[de.Boolean],function(n,e,i,s){s[0]=i[0]>i[1]});var V1e=new vi("lessThanOrEqual");V1e.addSignature([de.Number,de.Number],[de.Boolean],function(n,e,i,s){s[0]=i[0]<=i[1]});var X1e=new vi("greaterThanOrEqual");X1e.addSignature([de.Number,de.Number],[de.Boolean],function(n,e,i,s){s[0]=i[0]>=i[1]});var W1e=new vi("if");W1e.addSignature([de.Boolean,de.AnyType,de.AnyType],[de.AnyType],function(n,e,i,s){s[0]=i[0]?i[1]:i[2]});var H1e=new vi("number");H1e.addSignature([],[de.Number],function(n,e,i,s){s[0]=e.value});var j1e=new vi("vec2");j1e.addSignature([],[de.Vec2],function(n,e,i,s){s[0]=e.value});var Q1e=new vi("vec3");Q1e.addSignature([],[de.Vec3],function(n,e,i,s){s[0]=e.value});var Z1e=new vi("vec4");Z1e.addSignature([],[de.Vec4],function(n,e,i,s){s[0]=e.value});var Y1e=new vi("bool");Y1e.addSignature([],[de.Boolean],function(n,e,i,s){s[0]=e.value});var K1e=new vi("particlePosition");K1e.addSignature([],[de.Vec3],function(n,e,i,s){s[0]=n.particle[e.property]});var J1e=new vi("particleVelocity");J1e.addSignature([],[de.Vec3],function(n,e,i,s){s[0]=n.particle[e.property]});var q1e=new vi("particleRotation");q1e.addSignature([],[de.Number],function(n,e,i,s){s[0]=n.particle[e.property]});var $1e=new vi("particleAge");$1e.addSignature([],[de.Number],function(n,e,i,s){s[0]=n.particle[e.property]});var Mx=new vi("output");Mx.addSignature([de.Number],[de.Number],function(n,e,i,s){s[0]=i[0]}),Mx.addSignature([de.Vec2],[de.Vec2],function(n,e,i,s){s[0]=i[0]}),Mx.addSignature([de.Vec3],[de.Vec3],function(n,e,i,s){s[0]=i[0]}),Mx.addSignature([de.Vec4],[de.Vec4],function(n,e,i,s){s[0]=i[0]}),Mx.addSignature([de.Boolean],[de.Boolean],function(n,e,i,s){s[0]=i[0]}),console.log("%c Particle system powered by three.quarks. https://quarks.art/","font-size: 16px; font-weight: bold;");var ewe=Object.defineProperty,twe=Object.getOwnPropertyDescriptor,In=(n,e,i,s)=>{for(var r=s>1?void 0:s?twe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&ewe(e,i,r),r};const Ex=te("debugparticles"),iwe=te("noprogressive"),nwe=te("debugprogressive");var sG=(n=>(n[n.Birth=0]="Birth",n[n.Collision=1]="Collision",n[n.Death=2]="Death",n[n.Trigger=3]="Trigger",n[n.Manual=4]="Manual",n))(sG||{});class el extends Pe{constructor(){super(...arguments),p(this,"renderMode"),p(this,"particleMaterial"),p(this,"trailMaterial"),p(this,"particleMesh"),p(this,"maxParticleSize"),p(this,"minParticleSize"),p(this,"velocityScale"),p(this,"cameraVelocityScale"),p(this,"lengthScale")}start(){if(this.maxParticleSize!==.5&&this.minParticleSize!==0&&Ye()){const e=`ParticleSystem "${this.name}" has non-default min/max particle size. This may not render correctly. Please set min size to 0 and the max size to 0.5 and use the "StartSize" setting instead`;console.warn(e)}}get transparent(){var e;return((e=this.particleMaterial)==null?void 0:e.transparent)??!1}getMaterial(e=!1){let i=e===!0&&this.trailMaterial?this.trailMaterial:this.particleMaterial;return i&&e&&i.side===Un&&(i=i.clone(),i.side=un,e?this.trailMaterial=i:this.particleMaterial=i),i&&!iwe&&i._didRequestTextureLOD===void 0&&(i._didRequestTextureLOD=0,nwe&&console.log("Load material LOD",i.name),mi.assignTextureLOD(i,0)),i}getMesh(e){let i=null;if(!i&&(this.particleMesh instanceof pe&&(i=this.particleMesh.geometry),i===null)){i=new ds(1,1);const s=i.attributes.uv;for(let r=0;r<s.count;r++)s.setX(r,1-s.getX(r))}return new pe(i,this.getMaterial())}}In([T()],el.prototype,"renderMode",2),In([T(Ft)],el.prototype,"particleMaterial",2),In([T(Ft)],el.prototype,"trailMaterial",2),In([T()],el.prototype,"maxParticleSize",2),In([T()],el.prototype,"minParticleSize",2),In([T()],el.prototype,"velocityScale",2),In([T()],el.prototype,"cameraVelocityScale",2),In([T()],el.prototype,"lengthScale",2);class yE{constructor(e,i=1){p(this,"_curve"),p(this,"_factor"),p(this,"type","function"),this._curve=e,this._factor=i}genValue(e){return this._curve.evaluate(e,Math.random())*this._factor}toJSON(){throw new Error("Method not implemented.")}clone(){throw new Error("Method not implemented.")}}class rG{constructor(e){p(this,"type","value"),p(this,"system"),this.system=e}toJSON(){throw new Error("Method not implemented.")}clone(){throw new Error("Method not implemented.")}}class swe extends rG{genValue(){return this.system.textureSheetAnimation.getStartIndex()}}class rwe extends rG{constructor(){super(...arguments),p(this,"_lastPosition",new E),p(this,"_lastDistance",0)}update(){const e=zt(this.system.gameObject);this._lastDistance=this._lastPosition.distanceTo(e),this._lastPosition.copy(e)}genValue(){if(!this.system.isPlaying||!this.system.emission.enabled||this.system.currentParticles>=this.system.maxParticles)return 0;let e=this.system.emission.rateOverTime.evaluate(this.system.time/this.system.duration,Math.random());if(this.system.deltaTime>0){const r=this.system.emission.rateOverDistance.evaluate(this.system.time/this.system.duration,Math.random());let o=this._lastDistance/this.system.deltaTime*r;Number.isFinite(o)||(o=0),e+=o}const i=this.system.emission.getBurst();i>0&&(e+=i/this.system.deltaTime);const s=this.system.maxParticles-this.system.currentParticles;return tt.clamp(e,0,s/this.system.deltaTime)}}class owe extends rG{genValue(){return this.system.isPlaying,0}}class ip{constructor(e){p(this,"system"),p(this,"type"),this.type=Object.getPrototypeOf(this).constructor.name||"ParticleSystemBaseBehaviour",e&&(this.system=e)}get context(){return this.system.context}initialize(e){}update(e,i){}frameUpdate(e){}toJSON(){throw new Error("Method not implemented.")}clone(){throw new Error("Method not implemented.")}reset(){}}class awe extends ip{constructor(){super(...arguments),p(this,"type","NeedleTextureSheet")}update(e,i){const s=this.system.textureSheetAnimation;if(s.enabled){const r=e.age/e.life,o=s.evaluate(r);o!==void 0&&(e.uvTile=o)}}}const _Y=Symbol("particleRotation");class lwe extends ip{constructor(){super(...arguments),p(this,"type","NeedleRotation")}initialize(e){e[_Y]=Math.random()}update(e,i){if(e.rotation===void 0)return;const s=e.age/e.life;if(typeof e.rotation=="number"&&(this.system.rotationOverLifetime.enabled?e.rotation+=this.system.rotationOverLifetime.evaluate(s,e[_Y])*i:this.system.renderer.renderMode===ru.Billboard&&(e.rotation=Math.PI),this.system.rotationBySpeed.enabled)){const r=e.velocity.length();e.rotation+=this.system.rotationBySpeed.evaluate(s,r)*i}}}const SY=Symbol("sizeLerpFactor"),cwe=new E;class hwe extends ip{constructor(){super(...arguments),p(this,"type","NeedleSize"),p(this,"_minSize",0),p(this,"_maxSize",1)}initialize(e){e[SY]=Math.random(),this._minSize=this.system.renderer.minParticleSize,this._maxSize=this.system.renderer.maxParticleSize}update(e,i){const s=e.age/e.life;let r=1;this.system.sizeOverLifetime.enabled&&(r*=this.system.sizeOverLifetime.evaluate(s,void 0,e[SY]).x);let o=1;if(this.system.renderer.renderMode!==ru.Mesh&&(o=this.system.worldScale.x/this.system.cameraScale),e.size=e.startSize*r*o,this.system.localspace){const a=RY(this.system,cwe);e.size*=a.x}}}const hy=Symbol("particleLife"),oG=Symbol("trailLifetime"),CY=Symbol("trailStartLength"),aG=Symbol("trailWidthRandom");class uwe extends ip{constructor(){super(...arguments),p(this,"type","NeedleTrail")}initialize(e){e instanceof xx&&(e[hy]=e.life,this.system.trails.enabled&&this.system.trails.dieWithParticles===!1&&(e[oG]=this.system.trails.lifetime.evaluate(Math.random(),Math.random()),e.life+=e[oG]),e[CY]=e.length,e[aG]=Math.random())}update(e){var i;if((i=this.system.trails)!=null&&i.enabled&&e instanceof xx){const s=e,r=e.age/e[hy],o=e.previous.values(),a=e.previous.length;for(let l=0;l<a;l++){const c=o.next().value,h=1-l/(a-1);let u=e.size;u<=0&&!this.system.trails.sizeAffectsWidth&&(u=20*this.system.trails.widthOverTrail.evaluate(.5,s[aG])),c.size=this.system.trails.getWidth(u,r,h,s[aG]),c.color.copy(e.color),this.system.trails.getColor(c.color,r,h)}if(e.age>e[hy]){e.velocity.set(0,0,0);const l=(e.age-e[hy])/e[oG];s.length=tt.lerp(e[CY],0,l)}}}}const vE=Symbol("startVelocity"),MY=Symbol("gravityModifier"),lG=Symbol("gravitySpeed"),bE=Symbol("velocity lerp factor"),cG=new E;class dwe extends ip{constructor(){super(...arguments),p(this,"type","NeedleVelocity"),p(this,"_gravityDirection",new E)}initialize(e){var i,s;const r=this.system.main.simulationSpeed;e.startSpeed=this.system.main.startSpeed.evaluate(Math.random(),Math.random()),e.velocity.copy(this.system.shape.getDirection(e,e.position)).multiplyScalar(e.startSpeed),(i=this.system.inheritVelocity)!=null&&i.enabled&&this.system.inheritVelocity.applyInitial(e.velocity),e[vE]?e[vE].copy(e.velocity):e[vE]=e.velocity.clone();const o=this.system.main.gravityModifier.evaluate(Math.random(),Math.random());e[MY]=o*r,e[lG]=o*r*.5,e[bE]=Math.random(),(s=this.system.velocityOverLifetime)==null||s.init(e),this._gravityDirection.set(0,-1,0),this.system.main.simulationSpace===ex.Local&&this._gravityDirection.applyQuaternion(this.system.worldQuaternionInverted).normalize()}update(e,i){var s;const r=e[vE],o=e[MY];if(o!==0){const m=o*e[lG];cG.copy(this._gravityDirection).multiplyScalar(m),e[lG]+=i*.05,r.add(cG)}e.velocity.copy(r);const a=e.age/e.life;(s=this.system.inheritVelocity)!=null&&s.enabled&&this.system.inheritVelocity.applyCurrent(e.velocity,a,e[bE]);const l=this.system.noise;l.enabled&&l.apply(0,e.position,e.velocity,i,e.age,e.life);const c=this.system.sizeBySpeed;c!=null&&c.enabled&&(e.size=c.evaluate(e.velocity,a,e[bE],e.size));const h=this.system.colorBySpeed;h!=null&&h.enabled&&h.evaluate(e.velocity,e[bE],e.color);const u=this.system.velocityOverLifetime;u.enabled&&u.apply(e,0,e.position,e.velocity,i,e.age,e.life);const d=this.system.limitVelocityOverLifetime;d.enabled&&d.apply(e.position,r,e.velocity,e.size,a,i,1),this.system.worldspace&&e.velocity.multiply(this.system.worldScale)}}const EY=Symbol("colorLerpFactor"),TY=new Ii(1,1,1,1),af=new Ii(1,1,1,1);class pwe extends ip{constructor(){super(...arguments),p(this,"type","NeedleColor")}initialize(e){}_init(e){const i=this.system.renderer.particleMaterial;af.copy(this.system.main.startColor.evaluate(Math.random())),i!=null&&i.color&&(TY.copy(i.color),af.multiply(TY)),af.convertLinearToSRGB(),e.startColor.set(af.r,af.g,af.b,af.alpha),e.color.copy(e.startColor),e[EY]=Math.random()}update(e,i){if(e.age===0&&this._init(e),this.system.colorOverLifetime.enabled){const s=e.age/e.life,r=this.system.colorOverLifetime.color.evaluate(s,e[EY]);e.color.set(r.r,r.g,r.b,"alpha"in r?r.alpha:1).multiply(e.startColor)}else e.color.copy(e.startColor)}}class mwe{constructor(e){p(this,"system"),p(this,"emission"),p(this,"autoDestroy"),p(this,"startLength"),p(this,"emissionBursts"),p(this,"onlyUsedByOther"),p(this,"behaviors",[]),p(this,"rendererEmitterSettings",{startLength:new Wr(220),followLocalOrigin:!1}),p(this,"flatWhiteTexture"),p(this,"clonedTexture",{original:void 0,clone:void 0}),this.system=e,this.emission=new rwe(this.system)}get anim(){return this.system.textureSheetAnimation}get prewarm(){return!1}get material(){return this.system.renderer.getMaterial(this.system.trails.enabled)}get layers(){return this.system.gameObject.layers}update(){this.emission.update()}get looping(){return this.system.main.loop}get duration(){return this.system.duration}get shape(){return this.system.shape}get startLife(){return new yE(this.system.main.startLifetime)}get startSpeed(){return new yE(this.system.main.startSpeed)}get startRotation(){return new yE(this.system.main.startRotation)}get startSize(){return new yE(this.system.main.startSize)}get startColor(){return new uE(new Ze(1,1,1,1))}get emissionOverTime(){return this.emission}get emissionOverDistance(){return new owe(this.system)}get instancingGeometry(){return this.system.renderer.getMesh(this.system.renderer.renderMode).geometry}get renderMode(){if(this.system.trails.enabled===!0)return at.Trail;switch(this.system.renderer.renderMode){case ru.Billboard:return at.BillBoard;case ru.Stretch:return at.StretchedBillBoard;case ru.HorizontalBillboard:return at.HorizontalBillBoard;case ru.VerticalBillboard:return at.VerticalBillBoard;case ru.Mesh:return at.Mesh}return at.BillBoard}get speedFactor(){var e;let i=this.system.main.simulationSpeed;return((e=this.system.renderer)==null?void 0:e.renderMode)===ru.Stretch&&(i*=this.system.renderer.velocityScale??1),i}get texture(){const e=this.material;if(e&&e.map){const i=e.map;if(this.clonedTexture.original!==i||!this.clonedTexture.clone){const s=i.clone();s.premultiplyAlpha=!1,s.colorSpace=Bi,this.clonedTexture.original=i,this.clonedTexture.clone=s}return this.clonedTexture.clone}return this.flatWhiteTexture||(this.flatWhiteTexture=bk(new Ii(1,1,1,1),1)),this.flatWhiteTexture}get startTileIndex(){return new swe(this.system)}get uTileCount(){var e;return this.anim.enabled?(e=this.anim)==null?void 0:e.numTilesX:void 0}get vTileCount(){var e;return this.anim.enabled?(e=this.anim)==null?void 0:e.numTilesY:void 0}get renderOrder(){return 1}get blending(){var e;return((e=this.system.renderer.particleMaterial)==null?void 0:e.blending)??xu}get transparent(){return this.system.renderer.transparent}get worldSpace(){return this.system.main.simulationSpace===ex.World}}class fwe{constructor(){p(this,"burstIndex",0),p(this,"burstWaveIndex",0),p(this,"time",0),p(this,"waitEmiting",0)}}const AE=class extends Pe{constructor(){super(...arguments),p(this,"_state"),p(this,"colorOverLifetime"),p(this,"main"),p(this,"emission"),p(this,"sizeOverLifetime"),p(this,"shape"),p(this,"noise"),p(this,"trails"),p(this,"velocityOverLifetime"),p(this,"limitVelocityOverLifetime"),p(this,"inheritVelocity"),p(this,"colorBySpeed"),p(this,"textureSheetAnimation"),p(this,"rotationOverLifetime"),p(this,"rotationBySpeed"),p(this,"sizeBySpeed"),p(this,"_cameraScale",1),p(this,"__worldQuaternion",new Se),p(this,"_worldQuaternionInverted",new Se),p(this,"_worldScale",new E),p(this,"_worldPositionFrame",-1),p(this,"_worldPos",new E),p(this,"_renderer"),p(this,"_batchSystem"),p(this,"_particleSystem"),p(this,"_interface"),p(this,"_container"),p(this,"_time",0),p(this,"_isPlaying",!0),p(this,"_isUsedAsSubsystem",!1),p(this,"_didPreWarm",!1),p(this,"_bursts"),p(this,"_subEmitterSystems"),p(this,"_lastBatchesCount",-1),p(this,"lastMaterialVersion",-1)}play(n=!1){var e;n&&ie.foreachComponent(this.gameObject,i=>{i instanceof AE&&i!==this&&i.play(!1)},!0),this._isPlaying=!0,this._particleSystem&&(this._particleSystem.emissionState.time=0,this._particleSystem.emitEnded=!1),(e=this.emission)==null||e.reset()}pause(n=!0){n&&ie.foreachComponent(this.gameObject,e=>{e instanceof AE&&e!==this&&e.pause(!1)},!0),this._isPlaying=!1}stop(n=!0,e=!1){n&&ie.foreachComponent(this.gameObject,i=>{i instanceof AE&&i!==this&&i.stop(!1,e)},!0),this._isPlaying=!1,this._time=0,e&&this.reset()}reset(){var n;this._time=0,this._particleSystem&&(this._particleSystem.particleNum=0,this._particleSystem.emissionState.time=0,this._particleSystem.emitEnded=!1,(n=this.emission)==null||n.reset())}emit(n){if(this._particleSystem){this.onUpdate(),n=Math.min(n,this.maxParticles-this.currentParticles),this._state||(this._state=new fwe),this._state.waitEmiting=n,this._state.time=0;const e=this._particleSystem.emitEnded;this._particleSystem.emitEnded=!1,this._particleSystem.emit(this.deltaTime,this._state,this._particleSystem.emitter.matrixWorld),this._particleSystem.emitEnded=e}}get playOnAwake(){return this.main.playOnAwake}set playOnAwake(n){this.main.playOnAwake=n}get renderer(){return this._renderer}get isPlaying(){return this._isPlaying}get currentParticles(){var n;return((n=this._particleSystem)==null?void 0:n.particleNum)??0}get maxParticles(){return this.main.maxParticles}get time(){return this._time}get duration(){return this.main.duration}get deltaTime(){return this.context.time.deltaTime*this.main.simulationSpeed}get scale(){return this.gameObject.scale.x}get cameraScale(){return this._cameraScale}get container(){return this._container}get worldspace(){return this.main.simulationSpace===ex.World}get localspace(){return this.main.simulationSpace===ex.Local}get worldQuaternion(){return this.__worldQuaternion}get worldQuaternionInverted(){return this._worldQuaternionInverted}get worldScale(){return this._worldScale}get worldPos(){return this._worldPositionFrame!==this.context.time.frame&&(this._worldPositionFrame=this.context.time.frame,zt(this.gameObject,this._worldPos)),this._worldPos}get matrixWorld(){return this._container.matrixWorld}get isSubsystem(){return this._isUsedAsSubsystem}addBehaviour(n){return this._particleSystem?(n instanceof ip&&(n.system=this),Ye()&&console.log("add behaviour",n),this._particleSystem.addBehavior(n),!0):!1}removeBehaviour(n){if(!this._particleSystem)return!1;const e=this._particleSystem.behaviors,i=e.indexOf(n);return i!==-1&&e.splice(i,1),!0}removeAllBehaviours(){return this._particleSystem?(this._particleSystem.behaviors.length=0,!0):!1}get behaviours(){return this._particleSystem?this._particleSystem.behaviors:null}get particleSystem(){return this._particleSystem??null}set bursts(n){for(let e=0;e<n.length;e++){const i=n[e];if(!(i instanceof ix)){const s=new ix;a0(s,i),n[e]=s}}this._bursts=n}set subEmitterSystems(n){for(let e=0;e<n.length;e++){const i=n[e];if(!(i instanceof Tx)){const s=new Tx;a0(s,i),n[e]=s}}Ex&&n.length>0&&console.log("SubEmitters: ",n,this),this._subEmitterSystems=n}onAfterDeserialize(n){if(this._subEmitterSystems&&Array.isArray(this._subEmitterSystems))for(const e of this._subEmitterSystems)e._deserialize(this.context,this.gameObject)}awake(){if(this._worldPositionFrame=-1,this._renderer=this.gameObject.getComponent(el),!this.main)throw new Error("Not Supported: ParticleSystem needs a serialized MainModule. Creating new particle systems at runtime is currently not supported.");this._container=new ye,this._container.matrixAutoUpdate=!1,this.context.scene.add(this._container),this._batchSystem=new M1e,this._batchSystem.name=this.gameObject.name,this._container.add(this._batchSystem),this._interface=new mwe(this),this._particleSystem=new f1e(this._interface),this._particleSystem.addBehavior(new hwe(this)),this._particleSystem.addBehavior(new pwe(this)),this._particleSystem.addBehavior(new awe(this)),this._particleSystem.addBehavior(new lwe(this)),this._particleSystem.addBehavior(new dwe(this)),this._particleSystem.addBehavior(new uwe(this)),this._batchSystem.addSystem(this._particleSystem);const n=this._particleSystem.emitter;this.context.scene.add(n),this.inheritVelocity.system&&this.inheritVelocity.system!==this&&(this.inheritVelocity=this.inheritVelocity.clone()),this.inheritVelocity.awake(this),Ex&&(console.log(this),this.gameObject.add(new io(1)))}start(){this.addSubParticleSystems(),this.updateLayers(),this.renderer.particleMesh instanceof pe&&this._interface.renderMode==at.Mesh&&mi.assignMeshLOD(this.renderer.particleMesh,0).then(n=>{n&&this.particleSystem&&this._interface.renderMode==at.Mesh&&(this.particleSystem.instancingGeometry=n)})}onDestroy(){var n,e,i,s;(n=this._container)==null||n.removeFromParent(),(e=this._batchSystem)==null||e.removeFromParent(),(i=this._particleSystem)==null||i.emitter.removeFromParent(),(s=this._particleSystem)==null||s.dispose()}onEnable(){this.main&&(this.inheritVelocity&&(this.inheritVelocity.system=this),this._batchSystem&&(this._batchSystem.visible=!0),this.playOnAwake&&this.play(),this._isPlaying=this.playOnAwake)}onDisable(){this._batchSystem&&(this._batchSystem.visible=!1)}onBeforeRender(){var n;this.main&&(this._didPreWarm===!1&&((n=this.main)==null?void 0:n.prewarm)===!0&&(this._didPreWarm=!0,this.preWarm()),this.onUpdate(),this.onSimulate(this.deltaTime))}preWarm(){var n;if(!((n=this.emission)!=null&&n.enabled)||this.emission.rateOverTime.getMax()<=0)return;const e=1/60,i=this.main.duration,s=this.main.startLifetime.getMax(),r=1e3,o=Math.min(Math.max(i,s)/Math.max(.01,this.main.simulationSpeed),r),a=Math.ceil(o/e),l=Date.now();Ex&&console.log(`Particles ${this.name} - Prewarm for ${a} frames (${o} sec). Duration: ${i}, Lifetime: ${s}`);for(let c=0;c<a&&!(this.currentParticles>=this.maxParticles);c++){const h=Date.now()-l;if(h>2e3){console.warn(`Particles ${this.name} - Prewarm took too long. Aborting: ${h}`);break}this.onUpdate(),this.onSimulate(e)}}onSimulate(n){if(this._batchSystem){let e=this.context.time.frameCount%60===0;this._lastBatchesCount!==this._batchSystem.batches.length&&(this._lastBatchesCount=this._batchSystem.batches.length,e=!0),e&&this.updateLayers(),this._batchSystem.update(n)}this._time+=n,this._time>this.duration&&(this._time=0)}updateLayers(){if(this._batchSystem)for(let n=0;n<this._batchSystem.batches.length;n++){const e=this._batchSystem.batches[n];e.layers.disableAll();const i=this.layer;e.layers.mask=1<<i}}onUpdate(){var n,e;const i=this.renderer.getMaterial(this.trails.enabled);if(i&&i.version!=this.lastMaterialVersion&&this._particleSystem&&(this.lastMaterialVersion=i.version,this._particleSystem.texture=this._interface.texture),this._bursts&&(this.emission.bursts=this._bursts,delete this._bursts),!this._isPlaying)return;const s=this.context.mainCamera;if(s){const a=Qi(s);this._cameraScale=a.x}const r=!this.worldspace,o=this.gameObject;if(ki(o,this.__worldQuaternion),this._worldQuaternionInverted.copy(this.__worldQuaternion).invert(),Qi(this.gameObject,this._worldScale),r&&this._container&&(n=this.gameObject)!=null&&n.parent){const a=RY(this,cG);this._container.matrix.makeScale(a.x,a.y,a.z),this._container.matrix.makeRotationFromQuaternion(this.__worldQuaternion),this._container.matrix.setPosition(this.worldPos),this._container.matrix.scale(this.gameObject.scale)}this.emission.system=this,this._interface.update(),this.shape.update(this,this.context,this.main.simulationSpace,this.gameObject),this.noise.update(this.context),(e=this.inheritVelocity)==null||e.update(this.context),this.velocityOverLifetime.update(this)}addSubParticleSystems(){var n;if(this._subEmitterSystems&&this._particleSystem)for(const e of this._subEmitterSystems){e.particleSystem&&(e.particleSystem.__internalAwake?e.particleSystem.__internalAwake():Ye()&&console.warn("SubParticleSystem serialization issue(?)",e.particleSystem,e));const i=(n=e.particleSystem)==null?void 0:n._particleSystem;if(i){e.particleSystem._isUsedAsSubsystem=!0;const s=new xE(this,this._particleSystem,e.particleSystem,i);s.emitterType=e.type,s.emitterProbability=e.emitProbability,this._particleSystem.addBehavior(s)}else Ex&&console.warn("Could not add SubParticleSystem",e,this)}}};let cs=AE;In([T(nx)],cs.prototype,"colorOverLifetime",2),In([T(ur)],cs.prototype,"main",2),In([T(zc)],cs.prototype,"emission",2),In([T(Hd)],cs.prototype,"sizeOverLifetime",2),In([T(Tn)],cs.prototype,"shape",2),In([T(Pi)],cs.prototype,"noise",2),In([T(xn)],cs.prototype,"trails",2),In([T(Rn)],cs.prototype,"velocityOverLifetime",2),In([T(as)],cs.prototype,"limitVelocityOverLifetime",2),In([T(jd)],cs.prototype,"inheritVelocity",2),In([T(Ym)],cs.prototype,"colorBySpeed",2),In([T(dr)],cs.prototype,"textureSheetAnimation",2),In([T(qa)],cs.prototype,"rotationOverLifetime",2),In([T(ma)],cs.prototype,"rotationBySpeed",2),In([T(bo)],cs.prototype,"sizeBySpeed",2);class Tx{constructor(){p(this,"particleSystem"),p(this,"emitProbability",1),p(this,"properties"),p(this,"type")}_deserialize(e,i){const s=this.particleSystem;if(s instanceof cs)return;let r="";s&&typeof s.guid=="string"&&(r=s.guid,this.particleSystem=ie.findByGuid(r,i)),Ex&&!(this.particleSystem instanceof cs)&&console.warn("Could not find particle system for sub emitter",r,i,this)}}function RY(n,e){if(e.set(1,1,1),n.gameObject.parent&&n.localspace)switch(n.main.scalingMode){case nO.Local:e=Qi(n.gameObject.parent,e),e.x=1/e.x,e.y=1/e.y,e.z=1/e.z;break;default:if(!n.unsupported_scaling_mode){n.unsupported_scaling_mode=!0;const i="ParticleSystem scale mode "+nO[n.main.scalingMode]+" is not supported";Ye()&&zi(i),console.warn(i,n.name,n)}e=Qi(n.gameObject,e);break}return e}new E(1,1,1),new E(0,0,1);class xE{constructor(e,i,s,r){p(this,"type","NeedleParticleSubEmitter"),p(this,"emitterType"),p(this,"emitterProbability"),p(this,"q_",new Se),p(this,"v_",new E),p(this,"v2_",new E),p(this,"_emitterMatrix",new he),p(this,"_circularBuffer"),this.system=e,this.particleSystem=i,this.subSystem=s,this.subParticleSystem=r,this.subParticleSystem&&this.subParticleSystem&&(this.subParticleSystem.onlyUsedByOther=!0);const o=1e3;this._circularBuffer=new Qo(()=>new he,o)}clone(){throw new Error("Method not implemented.")}initialize(e){e.emissionState={burstIndex:0,burstWaveIndex:0,time:0,waitEmiting:0},this._emitterMatrix.copy(this.subSystem.matrixWorld).invert().premultiply(this.system.matrixWorld),this._emitterMatrix.setPosition(0,0,0),this.emitterType===sG.Birth&&this.run(e)}update(e,i){this.run(e)}frameUpdate(e){}toJSON(){}reset(){}run(e){if(this.subSystem.currentParticles>=this.subSystem.main.maxParticles||!this.subParticleSystem||!e.emissionState||this.emitterProbability&&Math.random()>this.emitterProbability)return;const i=this.system.deltaTime;if(this.emitterType===sG.Death){let r=e.life;if(e[hy]!==void 0&&(r=e[hy]),!(e.age+i*1.2>=r))return;const o=this.subSystem.main.maxParticles-this.subSystem.currentParticles;e.emissionState.waitEmiting=o}const s=new he;s.set(1,0,0,e.position.x,0,1,0,e.position.y,0,0,1,e.position.z,0,0,0,1),this.particleSystem.worldSpace||s.multiplyMatrices(this._emitterMatrix,s),this.subParticleSystem.emit(i,e.emissionState,s)}}var gwe=Object.defineProperty,ywe=Object.getOwnPropertyDescriptor,vwe=(n,e,i,s)=>{for(var r=s>1?void 0:s?ywe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&gwe(e,i,r),r};class Rx extends Vs{constructor(){super(...arguments),p(this,"granularity",new Je(10))}get typeName(){return"PixelationEffect"}onCreateEffect(){const e=new iV;return this.granularity.onValueChanged=i=>{e.granularity=i},e}}vwe([T(Je)],Rx.prototype,"granularity",2),Ka("PixelationEffect",Rx);class Wy extends Pe{constructor(){super(...arguments),p(this,"_didAssignPlayerColor",!1),p(this,"tryAssignColor",()=>{const e=ie.getComponentInParent(this.gameObject,la);if(e&&e.owner)return this._didAssignPlayerColor=!0,this.assignUserColor(e.owner),!0;const i=ie.getComponentInParent(this.gameObject,lr);return i!=null&&i.connectionId?(this._didAssignPlayerColor=!0,this.assignUserColor(i.connectionId),!0):!1})}onEnable(){this.context.connection.beginListen(Xt.JoinedRoom,this.tryAssignColor),this._didAssignPlayerColor||this.startCoroutine(this.waitForConnection())}onDisable(){this.context.connection.stopListen(Xt.JoinedRoom,this.tryAssignColor)}*waitForConnection(){for(;!this.destroyed&&this.activeAndEnabled&&(yield _4(.2),!this.tryAssignColor()););}assignUserColor(e){const i=Wy.hashCode(e),s=Wy.colorFromHashCode(i);if(this.gameObject.type==="Mesh"){const r=this.gameObject;this.assignColor(s,e,r)}else if(this.gameObject.children)for(const r of this.gameObject.children){const o=r;o.material&&o.material.color&&this.assignColor(s,e,o)}}assignColor(e,i,s){let r=s.material;r&&(r._playerMaterial!==i&&(r=r.clone(),r._playerMaterial=i,s.material=r),r.color=e)}static hashCode(e){var i=0,s,r;if(e.length===0)return i;for(s=0;s<e.length;s++)r=e.charCodeAt(s),i=(i<<5)-i+r,i|=0;return i}static colorFromHashCode(e){const i=(e&16711680)>>16,s=(e&65280)>>8,r=e&255;return new Ae(i/255,s/255,r/255)}}const Ix=new dt;Ix.setAttribute("position",new qe(new Float32Array([-1,-1,3,-1,-1,3]),2)),Ix.setAttribute("uv",new qe(new Float32Array([0,0,2,0,0,2]),2)),Ix.boundingSphere=new tn,Ix.computeBoundingSphere=function(){};const bwe=new ic;class lf{constructor(e){this._mesh=new pe(Ix,e),this._mesh.frustumCulled=!1}render(e){e.render(this._mesh,bwe)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}dispose(){this._mesh.material.dispose(),this._mesh.geometry.dispose()}}const Awe={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},sceneNormal:{value:null},projMat:{value:new he},viewMat:{value:new he},projViewMat:{value:new he},projectionMatrixInv:{value:new he},viewMatrixInv:{value:new he},cameraPos:{value:new E},resolution:{value:new Y},biasAdjustment:{value:new Y},time:{value:0},samples:{value:[]},bluenoise:{value:null},distanceFalloff:{value:1},radius:{value:5},near:{value:.1},far:{value:1e3},logDepth:{value:!1},ortho:{value:!1},screenSpaceRadius:{value:!1},frame:{value:0}},depthWrite:!1,depthTest:!1,vertexShader:`
varying vec2 vUv;
void main() {
  vUv = uv;
  gl_Position = vec4(position, 1);
}`,fragmentShader:`
    #define SAMPLES 16
    #define FSAMPLES 16.0
uniform sampler2D sceneDiffuse;
uniform highp sampler2D sceneNormal;
uniform highp sampler2D sceneDepth;
uniform mat4 projectionMatrixInv;
uniform mat4 viewMatrixInv;
uniform mat4 projMat;
uniform mat4 viewMat;
uniform mat4 projViewMat;
uniform vec3 cameraPos;
uniform vec2 resolution;
uniform vec2 biasAdjustment;
uniform float time;
uniform vec3[SAMPLES] samples;
uniform float radius;
uniform float distanceFalloff;
uniform float near;
uniform float far;
uniform float frame;
uniform bool logDepth;
uniform bool ortho;
uniform bool screenSpaceRadius;
uniform sampler2D bluenoise;
    varying vec2 vUv;
    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        return (zFar * zNear) / (zFar - d * (zFar - zNear));
    }
    highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
      return nearZ + (farZ - nearZ) * d;
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
      float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      /*return ortho ? linearize_depth_ortho(
        linDepth,
        nearZ,
        farZ
      ) :linearize_depth(linDepth, nearZ, farZ);*/
       #ifdef ORTHO

       return linearize_depth_ortho(d, nearZ, farZ);

        #else
        return linearize_depth(linDepth, nearZ, farZ);
        #endif
    }

    vec3 getWorldPosLog(vec3 posS) {
      vec2 uv = posS.xy;
      float z = posS.z;
      float nearZ =near;
      float farZ = far;
      float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
      vec4 wpos = projectionMatrixInv * clipVec;
      return wpos.xyz / wpos.w;
    }
    vec3 getWorldPos(float depth, vec2 coord) {
      #ifdef LOGDEPTH
        #ifndef ORTHO
          return getWorldPosLog(vec3(coord, depth));
        #endif
      #endif
      float z = depth * 2.0 - 1.0;
      vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
      vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
      // Perspective division
     vec4 worldSpacePosition = viewSpacePosition;
     worldSpacePosition.xyz /= worldSpacePosition.w;
      return worldSpacePosition.xyz;
  }

  vec3 computeNormal(vec3 worldPos, vec2 vUv) {
    ivec2 p = ivec2(vUv * resolution);
    float c0 = texelFetch(sceneDepth, p, 0).x;
    float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
    float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
    float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
    float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
    float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
    float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
    float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
    float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;

    float dl = abs((2.0 * l1 - l2) - c0);
    float dr = abs((2.0 * r1 - r2) - c0);
    float db = abs((2.0 * b1 - b2) - c0);
    float dt = abs((2.0 * t1 - t2) - c0);

    vec3 ce = getWorldPos(c0, vUv).xyz;

    vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                          : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
    vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                          : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;

    return normalize(cross(dpdx, dpdy));
}

mat3 makeRotationZ(float theta) {
	float c = cos(theta);
	float s = sin(theta);
	return mat3(c, - s, 0,
			s,  c, 0,
			0,  0, 1);
  }

void main() {
      vec4 diffuse = texture2D(sceneDiffuse, vUv);
      float depth = texture2D(sceneDepth, vUv).x;
      if (depth == 1.0) {
        gl_FragColor = vec4(vec3(1.0), 1.0);
        return;
      }
      vec3 worldPos = getWorldPos(depth, vUv);
      #ifdef HALFRES
        vec3 normal = texture2D(sceneNormal, vUv).rgb;
      #else
        vec3 normal = computeNormal(worldPos, vUv);
      #endif
      vec4 noise = texture2D(bluenoise, gl_FragCoord.xy / 128.0);
      vec2 harmoniousNumbers = vec2(
        1.618033988749895,
        1.324717957244746
      );
      noise.rg += harmoniousNumbers * frame;
      noise.rg = fract(noise.rg);
        vec3 helperVec = vec3(0.0, 1.0, 0.0);
        if (dot(helperVec, normal) > 0.99) {
          helperVec = vec3(1.0, 0.0, 0.0);
        }
        vec3 tangent = normalize(cross(helperVec, normal));
        vec3 bitangent = cross(normal, tangent);
        mediump mat3 tbn = mat3(tangent, bitangent, normal) *  makeRotationZ( noise.r * 3.1415962 * 2.0) ;

      mediump float occluded = 0.0;
      mediump float totalWeight = 0.0;
      float radiusToUse = screenSpaceRadius ? distance(
        worldPos,
        getWorldPos(depth, vUv +
          vec2(radius, 0.0) / resolution)
      ) : radius;
      float distanceFalloffToUse =screenSpaceRadius ?
          radiusToUse * distanceFalloff
      : radiusToUse * distanceFalloff * 0.2;
      float bias = (min(
        0.1,
        distanceFalloffToUse * 0.1
      ) / near) * fwidth(distance(worldPos, cameraPos)) / radiusToUse;
      bias = biasAdjustment.x + biasAdjustment.y * bias;
      mediump float offsetMove = noise.g;
      mediump float offsetMoveInv = 1.0 / FSAMPLES;
      float farTimesNear = far * near;
      float farMinusNear = far - near;
      
      for(int i = 0; i < SAMPLES; i++) {
        mediump vec3 sampleDirection = tbn * samples[i];

        float moveAmt = fract(offsetMove);
        offsetMove += offsetMoveInv;
        vec3 samplePos = worldPos + radiusToUse * moveAmt * sampleDirection;
        vec4 offset = projMat * vec4(samplePos, 1.0);
        offset.xyz /= offset.w;
        offset.xyz = offset.xyz * 0.5 + 0.5;
        
        if (all(greaterThan(offset.xyz * (1.0 - offset.xyz), vec3(0.0)))) {
          float sampleDepth = textureLod(sceneDepth, offset.xy, 0.0).x;

          /*#ifdef LOGDEPTH
          float distSample = linearize_depth_log(sampleDepth, near, far);
      #else
          #ifdef ORTHO
              float distSample = near + farMinusNear * sampleDepth;
          #else
              float distSample = (farTimesNear) / (far - sampleDepth * farMinusNear);
          #endif
      #endif*/
      #ifdef ORTHO
          float distSample = near + sampleDepth * farMinusNear;
      #else
          #ifdef LOGDEPTH
              float distSample = linearize_depth_log(sampleDepth, near, far);
          #else
              float distSample = (farTimesNear) / (far - sampleDepth * farMinusNear);
          #endif
      #endif
      
      #ifdef ORTHO
          float distWorld = near + offset.z * farMinusNear;
      #else
          float distWorld = (farTimesNear) / (far - offset.z * farMinusNear);
      #endif
          
          mediump float rangeCheck = smoothstep(0.0, 1.0, distanceFalloffToUse / (abs(distSample - distWorld)));
          vec2 diff = gl_FragCoord.xy - floor(offset.xy * resolution);
          occluded += rangeCheck * float(distSample != distWorld) * float(sampleDepth != depth) * step(distSample + bias, distWorld) * step(
            1.0,
            dot(diff, diff)
          );
          
          totalWeight ++;
        }
      }
      float occ = clamp(1.0 - occluded / (totalWeight == 0.0 ? 1.0 : totalWeight), 0.0, 1.0);
      gl_FragColor = vec4(occ, 0.5 + 0.5 * normal);
}`},xwe={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},tDiffuse:{value:null},transparencyDWFalse:{value:null},transparencyDWTrue:{value:null},transparencyDWTrueDepth:{value:null},transparencyAware:{value:!1},projMat:{value:new he},viewMat:{value:new he},projectionMatrixInv:{value:new he},viewMatrixInv:{value:new he},cameraPos:{value:new E},resolution:{value:new Y},color:{value:new E(0,0,0)},blueNoise:{value:null},downsampledDepth:{value:null},time:{value:0},intensity:{value:10},renderMode:{value:0},gammaCorrection:{value:!1},logDepth:{value:!1},ortho:{value:!1},near:{value:.1},far:{value:1e3},screenSpaceRadius:{value:!1},radius:{value:0},distanceFalloff:{value:1},fog:{value:!1},fogExp:{value:!1},fogDensity:{value:0},fogNear:{value:1/0},fogFar:{value:1/0},colorMultiply:{value:!0},aoTones:{value:0}},depthWrite:!1,depthTest:!1,vertexShader:`
		varying vec2 vUv;
		void main() {
			vUv = uv;
			gl_Position = vec4(position, 1);
		}`,fragmentShader:`
		uniform sampler2D sceneDiffuse;
    uniform highp sampler2D sceneDepth;
    uniform highp sampler2D downsampledDepth;
    uniform highp sampler2D transparencyDWFalse;
    uniform highp sampler2D transparencyDWTrue;
    uniform highp sampler2D transparencyDWTrueDepth;
    uniform sampler2D tDiffuse;
    uniform sampler2D blueNoise;
    uniform vec2 resolution;
    uniform vec3 color;
    uniform mat4 projectionMatrixInv;
    uniform mat4 viewMatrixInv;
    uniform float intensity;
    uniform float renderMode;
    uniform float near;
    uniform float far;
    uniform float aoTones;
    uniform bool gammaCorrection;
    uniform bool logDepth;
    uniform bool ortho;
    uniform bool screenSpaceRadius;
    uniform bool fog;
    uniform bool fogExp;
    uniform bool colorMultiply;
    uniform bool transparencyAware;
    uniform float fogDensity;
    uniform float fogNear;
    uniform float fogFar;
    uniform float radius;
    uniform float distanceFalloff;
    uniform vec3 cameraPos;
    varying vec2 vUv;
    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        return (zFar * zNear) / (zFar - d * (zFar - zNear));
    }
    highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
      return nearZ + (farZ - nearZ) * d;
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
      float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      return ortho ? linearize_depth_ortho(
        linDepth,
        nearZ,
        farZ
      ) :linearize_depth(linDepth, nearZ, farZ);
    }
    vec3 getWorldPosLog(vec3 posS) {
        vec2 uv = posS.xy;
        float z = posS.z;
        float nearZ =near;
        float farZ = far;
        float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
        float a = farZ / (farZ - nearZ);
        float b = farZ * nearZ / (nearZ - farZ);
        float linDepth = a + b / depth;
        vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
        vec4 wpos = projectionMatrixInv * clipVec;
        return wpos.xyz / wpos.w;
      }
      vec3 getWorldPos(float depth, vec2 coord) {
       // if (logDepth) {
        #ifdef LOGDEPTH
          #ifndef ORTHO
            return getWorldPosLog(vec3(coord, depth));
          #endif
        #endif
      //  }
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
  
    vec3 computeNormal(vec3 worldPos, vec2 vUv) {
      ivec2 p = ivec2(vUv * resolution);
      float c0 = texelFetch(sceneDepth, p, 0).x;
      float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
      float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
      float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
      float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
      float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
      float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
      float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
      float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;
  
      float dl = abs((2.0 * l1 - l2) - c0);
      float dr = abs((2.0 * r1 - r2) - c0);
      float db = abs((2.0 * b1 - b2) - c0);
      float dt = abs((2.0 * t1 - t2) - c0);
  
      vec3 ce = getWorldPos(c0, vUv).xyz;
  
      vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                            : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
      vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                            : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;
  
      return normalize(cross(dpdx, dpdy));
  }

    #include <common>
    #include <dithering_pars_fragment>
    void main() {
        //vec4 texel = texture2D(tDiffuse, vUv);//vec3(0.0);
        vec4 sceneTexel = texture2D(sceneDiffuse, vUv);
        float depth = texture2D(
            sceneDepth,
            vUv
        ).x;
        #ifdef HALFRES 
        vec4 texel;
        if (depth == 1.0) {
            texel = vec4(0.0, 0.0, 0.0, 1.0);
        } else {
        vec3 worldPos = getWorldPos(depth, vUv);
        vec3 normal = computeNormal(getWorldPos(depth, vUv), vUv);
       // vec4 texel = texture2D(tDiffuse, vUv);
       // Find closest depth;
       float totalWeight = 0.0;
       float radiusToUse = screenSpaceRadius ? distance(
        worldPos,
        getWorldPos(depth, vUv +
          vec2(radius, 0.0) / resolution)
      ) : radius;
      float distanceFalloffToUse =screenSpaceRadius ?
          radiusToUse * distanceFalloff
      : distanceFalloff;
        for(float x = -1.0; x <= 1.0; x++) {
            for(float y = -1.0; y <= 1.0; y++) {
                vec2 offset = vec2(x, y);
                ivec2 p = ivec2(
                    (vUv * resolution * 0.5) + offset
                );
                vec2 pUv = vec2(p) / (resolution * 0.5);
                float sampleDepth = texelFetch(downsampledDepth,p, 0).x;
                vec4 sampleInfo = texelFetch(tDiffuse, p, 0);
                vec3 normalSample = sampleInfo.gba * 2.0 - 1.0;
                vec3 worldPosSample = getWorldPos(sampleDepth, pUv);
                float tangentPlaneDist = abs(dot(worldPosSample - worldPos, normal));
                float rangeCheck = exp(-1.0 * tangentPlaneDist * (1.0 / distanceFalloffToUse)) * max(dot(normal, normalSample), 0.0);
                float weight = rangeCheck;
                totalWeight += weight;
                texel += sampleInfo * weight;
            }
        }
        if (totalWeight == 0.0) {
            texel = texture2D(tDiffuse, vUv);
        } else {
            texel /= totalWeight;
        }
    }
        #else
        vec4 texel = texture2D(tDiffuse, vUv);
        #endif

        #ifdef LOGDEPTH
        texel.r = clamp(texel.r, 0.0, 1.0);
        if (texel.r == 0.0) {
          texel.r = 1.0;
        }
        #endif
     
        float finalAo = pow(texel.r, intensity);
        if (aoTones > 0.0) {
            finalAo = ceil(finalAo * aoTones) / aoTones;
        }
        float fogFactor;
        float fogDepth = distance(
            cameraPos,
            getWorldPos(depth, vUv)
        );
        if (fog) {
            if (fogExp) {
                fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );
            } else {
                fogFactor = smoothstep( fogNear, fogFar, fogDepth );
            }
        }
        if (transparencyAware) {
            float transparencyDWOff = texture2D(transparencyDWFalse, vUv).a;
            float transparencyDWOn = texture2D(transparencyDWTrue, vUv).a;
            float adjustmentFactorOff = transparencyDWOff;
            float adjustmentFactorOn = (1.0 - transparencyDWOn) * (
                texture2D(transparencyDWTrueDepth, vUv).r == texture2D(sceneDepth, vUv).r ? 1.0 : 0.0
            );
            float adjustmentFactor = max(adjustmentFactorOff, adjustmentFactorOn);
            finalAo = mix(finalAo, 1.0, adjustmentFactor);
        }
        finalAo = mix(finalAo, 1.0, fogFactor);
        vec3 aoApplied = color * mix(vec3(1.0), sceneTexel.rgb, float(colorMultiply));
        if (renderMode == 0.0) {
            gl_FragColor = vec4( mix(sceneTexel.rgb, aoApplied, 1.0 - finalAo), sceneTexel.a);
        } else if (renderMode == 1.0) {
            gl_FragColor = vec4( mix(vec3(1.0), aoApplied, 1.0 - finalAo), sceneTexel.a);
        } else if (renderMode == 2.0) {
            gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
        } else if (renderMode == 3.0) {
            if (vUv.x < 0.5) {
                gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
            } else if (abs(vUv.x - 0.5) < 1.0 / resolution.x) {
                gl_FragColor = vec4(1.0);
            } else {
                gl_FragColor = vec4( mix(sceneTexel.rgb, aoApplied, 1.0 - finalAo), sceneTexel.a);
            }
        } else if (renderMode == 4.0) {
            if (vUv.x < 0.5) {
                gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
            } else if (abs(vUv.x - 0.5) < 1.0 / resolution.x) {
                gl_FragColor = vec4(1.0);
            } else {
                gl_FragColor = vec4( mix(vec3(1.0), aoApplied, 1.0 - finalAo), sceneTexel.a);
            }
        }
        #include <dithering_fragment>
        if (gammaCorrection) {
            gl_FragColor = sRGBTransferOETF(gl_FragColor);
        }
    }
    `},wwe={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},tDiffuse:{value:null},projMat:{value:new he},viewMat:{value:new he},projectionMatrixInv:{value:new he},viewMatrixInv:{value:new he},cameraPos:{value:new E},resolution:{value:new Y},time:{value:0},r:{value:5},blueNoise:{value:null},radius:{value:12},worldRadius:{value:5},index:{value:0},poissonDisk:{value:[]},distanceFalloff:{value:1},near:{value:.1},far:{value:1e3},logDepth:{value:!1},screenSpaceRadius:{value:!1}},depthWrite:!1,depthTest:!1,vertexShader:`
		varying vec2 vUv;
		void main() {
			vUv = uv;
			gl_Position = vec4(position, 1.0);
		}`,fragmentShader:`
		uniform sampler2D sceneDiffuse;
    uniform highp sampler2D sceneDepth;
    uniform sampler2D tDiffuse;
    uniform sampler2D blueNoise;
    uniform mat4 projectionMatrixInv;
    uniform mat4 viewMatrixInv;
    uniform vec2 resolution;
    uniform float r;
    uniform float radius;
     uniform float worldRadius;
    uniform float index;
     uniform float near;
     uniform float far;
     uniform float distanceFalloff;
     uniform bool logDepth;
     uniform bool screenSpaceRadius;
    varying vec2 vUv;

    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        highp float z_n = 2.0 * d - 1.0;
        return 2.0 * zNear * zFar / (zFar + zNear - z_n * (zFar - zNear));
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
     float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
     float a = farZ / (farZ - nearZ);
     float b = farZ * nearZ / (nearZ - farZ);
     float linDepth = a + b / depth;
     return linearize_depth(linDepth, nearZ, farZ);
   }
   highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
     return nearZ + (farZ - nearZ) * d;
   }
   vec3 getWorldPosLog(vec3 posS) {
     vec2 uv = posS.xy;
     float z = posS.z;
     float nearZ =near;
     float farZ = far;
     float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
     float a = farZ / (farZ - nearZ);
     float b = farZ * nearZ / (nearZ - farZ);
     float linDepth = a + b / depth;
     vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
     vec4 wpos = projectionMatrixInv * clipVec;
     return wpos.xyz / wpos.w;
   }
    vec3 getWorldPos(float depth, vec2 coord) {
     #ifdef LOGDEPTH
      #ifndef ORTHO
          return getWorldPosLog(vec3(coord, depth));
      #endif
     #endif
        
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
    #include <common>
    #define NUM_SAMPLES 16
    uniform vec2 poissonDisk[NUM_SAMPLES];
    void main() {
        const float pi = 3.14159;
        vec2 texelSize = vec2(1.0 / resolution.x, 1.0 / resolution.y);
        vec2 uv = vUv;
        vec4 data = texture2D(tDiffuse, vUv);
        float occlusion = data.r;
        float baseOcc = data.r;
        vec3 normal = data.gba * 2.0 - 1.0;
        float count = 1.0;
        float d = texture2D(sceneDepth, vUv).x;
        if (d == 1.0) {
          gl_FragColor = data;
          return;
        }
        vec3 worldPos = getWorldPos(d, vUv);
        float size = radius;
        float angle;
        if (index == 0.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).x * PI2;
        } else if (index == 1.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).y * PI2;
        } else if (index == 2.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).z * PI2;
        } else {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).w * PI2;
        }

        mat2 rotationMatrix = mat2(cos(angle), -sin(angle), sin(angle), cos(angle));
        float radiusToUse = screenSpaceRadius ? distance(
          worldPos,
          getWorldPos(d, vUv +
            vec2(worldRadius, 0.0) / resolution)
        ) : worldRadius;
        float distanceFalloffToUse =screenSpaceRadius ?
        radiusToUse * distanceFalloff
    : radiusToUse * distanceFalloff * 0.2;

        float invDistance = (1.0 / distanceFalloffToUse);
        for(int i = 0; i < NUM_SAMPLES; i++) {
            vec2 offset = (rotationMatrix * poissonDisk[i]) * texelSize * size;
            vec4 dataSample = texture2D(tDiffuse, uv + offset);
            float occSample = dataSample.r;
            vec3 normalSample = dataSample.gba * 2.0 - 1.0;
            float dSample = texture2D(sceneDepth, uv + offset).x;
            vec3 worldPosSample = getWorldPos(dSample, uv + offset);
            float tangentPlaneDist = abs(dot(worldPosSample - worldPos, normal));
            float rangeCheck = float(dSample != 1.0) * exp(-1.0 * tangentPlaneDist * invDistance ) * max(dot(normal, normalSample), 0.0);
            occlusion += occSample * rangeCheck;
            count += rangeCheck;
        }
        if (count > 0.0) {
          occlusion /= count;
        }
        #ifdef LOGDEPTH
          occlusion = clamp(occlusion, 0.0, 1.0);
          if (occlusion == 0.0) {
            occlusion = 1.0;
          }
        #endif
        gl_FragColor = vec4(occlusion, 0.5 + 0.5 * normal);
    }
    `},_we={uniforms:{sceneDepth:{value:null},resolution:{value:new Y},near:{value:.1},far:{value:1e3},viewMatrixInv:{value:new he},projectionMatrixInv:{value:new he},logDepth:{value:!1},ortho:{value:!1}},depthWrite:!1,depthTest:!1,vertexShader:`
    varying vec2 vUv;
    void main() {
        vUv = uv;
        gl_Position = vec4(position, 1);
    }`,fragmentShader:`
    uniform highp sampler2D sceneDepth;
    uniform vec2 resolution;
    uniform float near;
    uniform float far;
    uniform bool logDepth;
    uniform bool ortho;
    uniform mat4 viewMatrixInv;
    uniform mat4 projectionMatrixInv;
    varying vec2 vUv;
    layout(location = 1) out vec4 gNormal;
    vec3 getWorldPosLog(vec3 posS) {
        vec2 uv = posS.xy;
        float z = posS.z;
        float nearZ =near;
        float farZ = far;
        float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
        float a = farZ / (farZ - nearZ);
        float b = farZ * nearZ / (nearZ - farZ);
        float linDepth = a + b / depth;
        vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
        vec4 wpos = projectionMatrixInv * clipVec;
        return wpos.xyz / wpos.w;
      }
      vec3 getWorldPos(float depth, vec2 coord) {
        if (logDepth && !ortho) {
          return getWorldPosLog(vec3(coord, depth));
        }
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
  
    vec3 computeNormal(vec3 worldPos, vec2 vUv) {
      ivec2 p = ivec2(vUv * resolution);
      float c0 = texelFetch(sceneDepth, p, 0).x;
      float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
      float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
      float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
      float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
      float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
      float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
      float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
      float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;
  
      float dl = abs((2.0 * l1 - l2) - c0);
      float dr = abs((2.0 * r1 - r2) - c0);
      float db = abs((2.0 * b1 - b2) - c0);
      float dt = abs((2.0 * t1 - t2) - c0);
  
      vec3 ce = getWorldPos(c0, vUv).xyz;
  
      vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                            : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
      vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                            : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;
  
      return normalize(cross(dpdx, dpdy));
  }
    void main() {
        vec2 uv = vUv - vec2(0.5) / resolution;
        vec2 pixelSize = vec2(1.0) / resolution;
        highp vec2[4] uvSamples;
        uvSamples[0] = uv;
        uvSamples[1] = uv + vec2(pixelSize.x, 0.0);
        uvSamples[2] = uv + vec2(0.0, pixelSize.y);
        uvSamples[3] = uv + pixelSize;
        float depth00 = texture2D(sceneDepth, uvSamples[0]).r;
        float depth10 = texture2D(sceneDepth, uvSamples[1]).r;
        float depth01 = texture2D(sceneDepth, uvSamples[2]).r;
        float depth11 = texture2D(sceneDepth, uvSamples[3]).r;
        float minDepth = min(min(depth00, depth10), min(depth01, depth11));
        float maxDepth = max(max(depth00, depth10), max(depth01, depth11));
        float targetDepth = minDepth;
        // Checkerboard pattern to avoid artifacts
        if (mod(gl_FragCoord.x + gl_FragCoord.y, 2.0) > 0.5) { 
            targetDepth = maxDepth;
        }
        int chosenIndex = 0;
        float[4] samples;
        samples[0] = depth00;
        samples[1] = depth10;
        samples[2] = depth01;
        samples[3] = depth11;
        for(int i = 0; i < 4; ++i) {
            if (samples[i] == targetDepth) {
                chosenIndex = i;
                break;
            }
        }
        gl_FragColor = vec4(samples[chosenIndex], 0.0, 0.0, 1.0);
        gNormal = vec4(computeNormal(
            getWorldPos(samples[chosenIndex], uvSamples[chosenIndex]), uvSamples[chosenIndex]
        ), 0.0);
    }`};var IY="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";const Swe=Uint8Array.from(atob(IY),n=>n.charCodeAt(0));function LY(n,e,i){if(e.getQueryParameter(n,e.QUERY_RESULT_AVAILABLE)){const s=e.getQueryParameter(n,e.QUERY_RESULT)/1e6;i.lastTime=i.lastTime===0?s:i.timeRollingAverage*i.lastTime+(1-i.timeRollingAverage)*s}else setTimeout(()=>{LY(n,e,i)},1)}class PY extends Ps{constructor(e,i,s=512,r=512){super(),this.width=s,this.height=r,this.clear=!0,this.camera=i,this.scene=e,this.autosetGamma=!0,this.configuration=new Proxy({aoSamples:16,aoRadius:5,aoTones:0,denoiseSamples:8,denoiseRadius:12,distanceFalloff:1,intensity:5,denoiseIterations:2,renderMode:0,biasOffset:0,biasMultiplier:0,color:new Ae(0,0,0),gammaCorrection:!0,logarithmicDepthBuffer:!1,screenSpaceRadius:!1,halfRes:!1,depthAwareUpsampling:!0,colorMultiply:!0,transparencyAware:!1,accumulate:!1},{set:(o,a,l)=>{const c=o[a];return o[a]=l,l.equals?l.equals(c)||this.firstFrame():c!==l&&this.firstFrame(),a==="aoSamples"&&c!==l&&this.configureAOPass(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),a==="denoiseSamples"&&c!==l&&this.configureDenoisePass(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),a==="halfRes"&&c!==l&&(this.configureAOPass(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),this.configureHalfResTargets(),this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),this.setSize(this.width,this.height)),a==="depthAwareUpsampling"&&c!==l&&this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),a==="gammaCorrection"&&(this.autosetGamma=!1),a==="transparencyAware"&&c!==l&&(this.autoDetectTransparency=!1,this.configureTransparencyTarget()),!0}}),this.samples=[],this.samplesDenoise=[],this.autoDetectTransparency=!0,this.frames=0,this.lastViewMatrix=new he,this.lastProjectionMatrix=new he,this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer),this.configureSampleDependentPasses(),this.configureHalfResTargets(),this.detectTransparency(),this.configureTransparencyTarget(),this.copyQuad=new lf(new kt({uniforms:{tDiffuse:{value:null}},depthWrite:!1,vertexShader:`
            varying vec2 vUv;
            void main() {
                vUv = uv;
                gl_Position = vec4(position, 1);
            }
            `,fragmentShader:`
            uniform sampler2D tDiffuse;
            varying vec2 vUv;
            void main() {
                gl_FragColor = texture2D(tDiffuse, vUv);
            }
            `})),this.writeTargetInternal=new Zt(this.width,this.height,{minFilter:Ot,magFilter:Ot,depthBuffer:!1,format:_i}),this.readTargetInternal=new Zt(this.width,this.height,{minFilter:Ot,magFilter:Ot,depthBuffer:!1,format:_i}),this.outputTargetInternal=new Zt(this.width,this.height,{minFilter:Ot,magFilter:Ot,depthBuffer:!1}),this.accumulationRenderTarget=new Zt(this.width,this.height,{minFilter:Ot,magFilter:Ot,depthBuffer:!1,format:_i,type:ms,stencilBuffer:!1,depthBuffer:!1,alpha:!0}),this.accumulationQuad=new lf(new kt({uniforms:{frame:{value:0},tDiffuse:{value:null}},transparent:!0,opacity:1,vertexShader:`
             varying vec2 vUv;
             void main() {
                 vUv = uv;
                 gl_Position = vec4(position, 1);
             }`,fragmentShader:`
             uniform sampler2D tDiffuse;
             uniform float frame;
                varying vec2 vUv;
                void main() {
                    vec4 color = texture2D(tDiffuse, vUv);
                    gl_FragColor = vec4(color.rgb, 1.0 / (frame + 1.0));
                }
                `})),this.bluenoise=new Tr(Swe,128,128),this.bluenoise.colorSpace=Co,this.bluenoise.wrapS=_o,this.bluenoise.wrapT=_o,this.bluenoise.minFilter=Dt,this.bluenoise.magFilter=Dt,this.bluenoise.needsUpdate=!0,this.lastTime=0,this.timeRollingAverage=.99,this.needsDepthTexture=!0,this.needsSwap=!0,this._r=new Y,this._c=new Ae}configureHalfResTargets(){this.firstFrame(),this.configuration.halfRes?(this.depthDownsampleTarget=new Zt(this.width/2,this.height/2,{count:2}),this.depthDownsampleTarget.textures[0].format=Sp,this.depthDownsampleTarget.textures[0].type=Hi,this.depthDownsampleTarget.textures[0].minFilter=Dt,this.depthDownsampleTarget.textures[0].magFilter=Dt,this.depthDownsampleTarget.textures[0].depthBuffer=!1,this.depthDownsampleTarget.textures[1].format=_i,this.depthDownsampleTarget.textures[1].type=ms,this.depthDownsampleTarget.textures[1].minFilter=Dt,this.depthDownsampleTarget.textures[1].magFilter=Dt,this.depthDownsampleTarget.textures[1].depthBuffer=!1,this.depthDownsampleQuad=new lf(new kt(_we))):(this.depthDownsampleTarget&&(this.depthDownsampleTarget.dispose(),this.depthDownsampleTarget=null),this.depthDownsampleQuad&&(this.depthDownsampleQuad.dispose(),this.depthDownsampleQuad=null))}detectTransparency(){if(this.autoDetectTransparency){let e=!1;this.scene.traverse(i=>{i.material&&i.material.transparent&&(e=!0)}),e&&(this.configuration.transparencyAware=!0)}}configureTransparencyTarget(){this.configuration.transparencyAware?(this.transparencyRenderTargetDWFalse=new Zt(this.width,this.height,{minFilter:Ot,magFilter:Dt,type:ms,format:_i}),this.transparencyRenderTargetDWTrue=new Zt(this.width,this.height,{minFilter:Ot,magFilter:Dt,type:ms,format:_i}),this.transparencyRenderTargetDWTrue.depthTexture=new tg(this.width,this.height,_r),this.depthCopyPass=new lf(new kt({uniforms:{depthTexture:{value:this.depthTexture}},vertexShader:`
            varying vec2 vUv;
            void main() {
                vUv = uv;
                gl_Position = vec4(position, 1);
            }`,fragmentShader:`
            uniform sampler2D depthTexture;
            varying vec2 vUv;
            void main() {
               gl_FragDepth = texture2D(depthTexture, vUv).r + 0.00001;
               gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
            }
            `}))):(this.transparencyRenderTargetDWFalse&&(this.transparencyRenderTargetDWFalse.dispose(),this.transparencyRenderTargetDWFalse=null),this.transparencyRenderTargetDWTrue&&(this.transparencyRenderTargetDWTrue.dispose(),this.transparencyRenderTargetDWTrue=null),this.depthCopyPass&&(this.depthCopyPass.dispose(),this.depthCopyPass=null))}renderTransparency(e){const i=this.scene.background,s=e.getClearColor(new Ae),r=e.getClearAlpha(),o=new Map,a=e.autoClearDepth;this.scene.traverse(l=>{o.set(l,l.visible)}),this.scene.background=null,e.autoClearDepth=!1,e.setClearColor(new Ae(0,0,0),0),this.depthCopyPass.material.uniforms.depthTexture.value=this.depthTexture,e.setRenderTarget(this.transparencyRenderTargetDWFalse),this.scene.traverse(l=>{l.material&&(l.visible=o.get(l)&&(l.material.transparent&&!l.material.depthWrite&&!l.userData.treatAsOpaque||!!l.userData.cannotReceiveAO))}),e.clear(!0,!0,!0),this.depthCopyPass.render(e),e.render(this.scene,this.camera),e.setRenderTarget(this.transparencyRenderTargetDWTrue),this.scene.traverse(l=>{l.material&&(l.visible=o.get(l)&&l.material.transparent&&l.material.depthWrite&&!l.userData.treatAsOpaque)}),e.clear(!0,!0,!0),this.depthCopyPass.render(e),e.render(this.scene,this.camera),this.scene.traverse(l=>{l.visible=o.get(l)}),e.setClearColor(s,r),this.scene.background=i,e.autoClearDepth=a}configureSampleDependentPasses(){this.configureAOPass(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),this.configureDenoisePass(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera)}configureAOPass(e=!1,i=!1){this.firstFrame(),this.samples=this.generateHemisphereSamples(this.configuration.aoSamples);const s={...Awe};s.fragmentShader=s.fragmentShader.replace("16",this.configuration.aoSamples).replace("16.0",this.configuration.aoSamples+".0"),e&&(s.fragmentShader=`#define LOGDEPTH
`+s.fragmentShader),i&&(s.fragmentShader=`#define ORTHO
`+s.fragmentShader),this.configuration.halfRes&&(s.fragmentShader=`#define HALFRES
`+s.fragmentShader),this.effectShaderQuad?(this.effectShaderQuad.material.dispose(),this.effectShaderQuad.material=new kt(s)):this.effectShaderQuad=new lf(new kt(s))}configureDenoisePass(e=!1,i=!1){this.firstFrame(),this.samplesDenoise=this.generateDenoiseSamples(this.configuration.denoiseSamples,11);const s={...wwe};s.fragmentShader=s.fragmentShader.replace("16",this.configuration.denoiseSamples),e&&(s.fragmentShader=`#define LOGDEPTH
`+s.fragmentShader),i&&(s.fragmentShader=`#define ORTHO
`+s.fragmentShader),this.poissonBlurQuad?(this.poissonBlurQuad.material.dispose(),this.poissonBlurQuad.material=new kt(s)):this.poissonBlurQuad=new lf(new kt(s))}configureEffectCompositer(e=!1,i=!1){this.firstFrame();const s={...xwe};e&&(s.fragmentShader=`#define LOGDEPTH
`+s.fragmentShader),i&&(s.fragmentShader=`#define ORTHO
`+s.fragmentShader),this.configuration.halfRes&&this.configuration.depthAwareUpsampling&&(s.fragmentShader=`#define HALFRES
`+s.fragmentShader),this.effectCompositerQuad?(this.effectCompositerQuad.material.dispose(),this.effectCompositerQuad.material=new kt(s)):this.effectCompositerQuad=new lf(new kt(s))}generateHemisphereSamples(e){const i=[];for(let s=0;s<e;s++){const r=2.399963*s,o=Math.sqrt(s+.5)/Math.sqrt(e),a=o*Math.cos(r),l=o*Math.sin(r),c=Math.sqrt(1-(a*a+l*l));i.push(new E(a,l,c))}return i}generateDenoiseSamples(e,i){const s=2*Math.PI*i/e,r=1/e,o=r,a=[];let l=r,c=0;for(let h=0;h<e;h++)a.push(new Y(Math.cos(c),Math.sin(c)).multiplyScalar(Math.pow(l,.75))),l+=o,c+=s;return a}setSize(e,i){this.firstFrame(),this.width=e,this.height=i;const s=this.configuration.halfRes?.5:1;this.writeTargetInternal.setSize(e*s,i*s),this.readTargetInternal.setSize(e*s,i*s),this.accumulationRenderTarget.setSize(e*s,i*s),this.configuration.halfRes&&this.depthDownsampleTarget.setSize(e*s,i*s),this.configuration.transparencyAware&&(this.transparencyRenderTargetDWFalse.setSize(e,i),this.transparencyRenderTargetDWTrue.setSize(e,i)),this.outputTargetInternal.setSize(e,i)}setDepthTexture(e){this.depthTexture=e}firstFrame(){this.needsFrame=!0}render(e,i,s){const r=e.xr.enabled;e.xr.enabled=!1,e.capabilities.logarithmicDepthBuffer!==this.configuration.logarithmicDepthBuffer&&(this.configuration.logarithmicDepthBuffer=e.capabilities.logarithmicDepthBuffer,this.configureAOPass(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),this.configureDenoisePass(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera)),this.detectTransparency(),(i.texture.type!==this.outputTargetInternal.texture.type||i.texture.format!==this.outputTargetInternal.texture.format)&&(this.outputTargetInternal.texture.type=i.texture.type,this.outputTargetInternal.texture.format=i.texture.format,this.outputTargetInternal.texture.needsUpdate=!0),this.camera.updateMatrixWorld(),this.lastViewMatrix.equals(this.camera.matrixWorldInverse)&&this.lastProjectionMatrix.equals(this.camera.projectionMatrix)&&this.configuration.accumulate&&!this.needsFrame?this.frame++:(this.configuration.accumulate&&(e.setRenderTarget(this.accumulationRenderTarget),e.clear(!0,!0,!0)),this.frame=0,this.needsFrame=!1),this.lastViewMatrix.copy(this.camera.matrixWorldInverse),this.lastProjectionMatrix.copy(this.camera.projectionMatrix);let o,a,l;this.debugMode&&(o=e.getContext(),a=o.getExtension("EXT_disjoint_timer_query_webgl2"),a===null&&(console.error("EXT_disjoint_timer_query_webgl2 not available, disabling debug mode."),this.debugMode=!1)),this.debugMode&&(l=o.createQuery(),o.beginQuery(a.TIME_ELAPSED_EXT,l)),this.configuration.transparencyAware&&this.renderTransparency(e),this._r.set(this.width,this.height);let c=this.configuration.aoRadius;if(this.configuration.halfRes&&this.configuration.screenSpaceRadius&&(c*=.5),this.frame<1024/this.configuration.aoSamples){this.configuration.halfRes&&(e.setRenderTarget(this.depthDownsampleTarget),this.depthDownsampleQuad.material.uniforms.sceneDepth.value=this.depthTexture,this.depthDownsampleQuad.material.uniforms.resolution.value=this._r,this.depthDownsampleQuad.material.uniforms.near.value=this.camera.near,this.depthDownsampleQuad.material.uniforms.far.value=this.camera.far,this.depthDownsampleQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.depthDownsampleQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.depthDownsampleQuad.material.uniforms.logDepth.value=this.configuration.logarithmicDepthBuffer,this.depthDownsampleQuad.material.uniforms.ortho.value=this.camera.isOrthographicCamera,this.depthDownsampleQuad.render(e)),this.effectShaderQuad.material.uniforms.sceneDiffuse.value=i.texture,this.effectShaderQuad.material.uniforms.sceneDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.textures[0]:this.depthTexture,this.effectShaderQuad.material.uniforms.sceneNormal.value=this.configuration.halfRes?this.depthDownsampleTarget.textures[1]:null,this.effectShaderQuad.material.uniforms.projMat.value=this.camera.projectionMatrix,this.effectShaderQuad.material.uniforms.viewMat.value=this.camera.matrixWorldInverse,this.effectShaderQuad.material.uniforms.projViewMat.value=this.camera.projectionMatrix.clone().multiply(this.camera.matrixWorldInverse.clone()),this.effectShaderQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.effectShaderQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.effectShaderQuad.material.uniforms.cameraPos.value=this.camera.getWorldPosition(new E),this.effectShaderQuad.material.uniforms.biasAdjustment.value=new Y(this.configuration.biasOffset,this.configuration.biasMultiplier),this.effectShaderQuad.material.uniforms.resolution.value=this.configuration.halfRes?this._r.clone().multiplyScalar(.5).floor():this._r,this.effectShaderQuad.material.uniforms.time.value=performance.now()/1e3,this.effectShaderQuad.material.uniforms.samples.value=this.samples,this.effectShaderQuad.material.uniforms.bluenoise.value=this.bluenoise,this.effectShaderQuad.material.uniforms.radius.value=c,this.effectShaderQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.effectShaderQuad.material.uniforms.near.value=this.camera.near,this.effectShaderQuad.material.uniforms.far.value=this.camera.far,this.effectShaderQuad.material.uniforms.logDepth.value=e.capabilities.logarithmicDepthBuffer,this.effectShaderQuad.material.uniforms.ortho.value=this.camera.isOrthographicCamera,this.effectShaderQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,this.effectShaderQuad.material.uniforms.frame.value=this.frame,e.setRenderTarget(this.writeTargetInternal),this.effectShaderQuad.render(e);for(let u=0;u<this.configuration.denoiseIterations;u++)[this.writeTargetInternal,this.readTargetInternal]=[this.readTargetInternal,this.writeTargetInternal],this.poissonBlurQuad.material.uniforms.tDiffuse.value=this.readTargetInternal.texture,this.poissonBlurQuad.material.uniforms.sceneDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.textures[0]:this.depthTexture,this.poissonBlurQuad.material.uniforms.projMat.value=this.camera.projectionMatrix,this.poissonBlurQuad.material.uniforms.viewMat.value=this.camera.matrixWorldInverse,this.poissonBlurQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.poissonBlurQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.poissonBlurQuad.material.uniforms.cameraPos.value=this.camera.getWorldPosition(new E),this.poissonBlurQuad.material.uniforms.resolution.value=this.configuration.halfRes?this._r.clone().multiplyScalar(.5).floor():this._r,this.poissonBlurQuad.material.uniforms.time.value=performance.now()/1e3,this.poissonBlurQuad.material.uniforms.blueNoise.value=this.bluenoise,this.poissonBlurQuad.material.uniforms.radius.value=this.configuration.denoiseRadius*(this.configuration.halfRes?.5:1),this.poissonBlurQuad.material.uniforms.worldRadius.value=c,this.poissonBlurQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.poissonBlurQuad.material.uniforms.index.value=u,this.poissonBlurQuad.material.uniforms.poissonDisk.value=this.samplesDenoise,this.poissonBlurQuad.material.uniforms.near.value=this.camera.near,this.poissonBlurQuad.material.uniforms.far.value=this.camera.far,this.poissonBlurQuad.material.uniforms.logDepth.value=e.capabilities.logarithmicDepthBuffer,this.poissonBlurQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,e.setRenderTarget(this.writeTargetInternal),this.poissonBlurQuad.render(e);e.setRenderTarget(this.accumulationRenderTarget);const h=e.autoClear;e.autoClear=!1,this.accumulationQuad.material.uniforms.tDiffuse.value=this.writeTargetInternal.texture,this.accumulationQuad.material.uniforms.frame.value=this.frame,this.accumulationQuad.render(e),e.autoClear=h}this.configuration.transparencyAware&&(this.effectCompositerQuad.material.uniforms.transparencyDWFalse.value=this.transparencyRenderTargetDWFalse.texture,this.effectCompositerQuad.material.uniforms.transparencyDWTrue.value=this.transparencyRenderTargetDWTrue.texture,this.effectCompositerQuad.material.uniforms.transparencyDWTrueDepth.value=this.transparencyRenderTargetDWTrue.depthTexture,this.effectCompositerQuad.material.uniforms.transparencyAware.value=!0),this.effectCompositerQuad.material.uniforms.sceneDiffuse.value=i.texture,this.effectCompositerQuad.material.uniforms.sceneDepth.value=this.depthTexture,this.effectCompositerQuad.material.uniforms.aoTones.value=this.configuration.aoTones,this.effectCompositerQuad.material.uniforms.near.value=this.camera.near,this.effectCompositerQuad.material.uniforms.far.value=this.camera.far,this.effectCompositerQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.effectCompositerQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.effectCompositerQuad.material.uniforms.logDepth.value=e.capabilities.logarithmicDepthBuffer,this.effectCompositerQuad.material.uniforms.ortho.value=this.camera.isOrthographicCamera,this.effectCompositerQuad.material.uniforms.downsampledDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.textures[0]:this.depthTexture,this.effectCompositerQuad.material.uniforms.resolution.value=this._r,this.effectCompositerQuad.material.uniforms.blueNoise.value=this.bluenoise,this.effectCompositerQuad.material.uniforms.intensity.value=this.configuration.intensity,this.effectCompositerQuad.material.uniforms.renderMode.value=this.configuration.renderMode,this.effectCompositerQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,this.effectCompositerQuad.material.uniforms.radius.value=c,this.effectCompositerQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.effectCompositerQuad.material.uniforms.gammaCorrection.value=this.autosetGamma?this.renderToScreen:this.configuration.gammaCorrection,this.effectCompositerQuad.material.uniforms.tDiffuse.value=this.accumulationRenderTarget.texture,this.effectCompositerQuad.material.uniforms.color.value=this._c.copy(this.configuration.color).convertSRGBToLinear(),this.effectCompositerQuad.material.uniforms.colorMultiply.value=this.configuration.colorMultiply,this.effectCompositerQuad.material.uniforms.cameraPos.value=this.camera.getWorldPosition(new E),this.effectCompositerQuad.material.uniforms.fog.value=!!this.scene.fog,this.scene.fog&&(this.scene.fog.isFog?(this.effectCompositerQuad.material.uniforms.fogExp.value=!1,this.effectCompositerQuad.material.uniforms.fogNear.value=this.scene.fog.near,this.effectCompositerQuad.material.uniforms.fogFar.value=this.scene.fog.far):this.scene.fog.isFogExp2?(this.effectCompositerQuad.material.uniforms.fogExp.value=!0,this.effectCompositerQuad.material.uniforms.fogDensity.value=this.scene.fog.density):console.error(`Unsupported fog type ${this.scene.fog.constructor.name} in SSAOPass.`)),e.setRenderTarget(this.outputTargetInternal),this.effectCompositerQuad.render(e),e.setRenderTarget(this.renderToScreen?null:s),this.copyQuad.material.uniforms.tDiffuse.value=this.outputTargetInternal.texture,this.copyQuad.render(e),this.debugMode&&(o.endQuery(a.TIME_ELAPSED_EXT),LY(l,o,this)),e.xr.enabled=r}enableDebugMode(){this.debugMode=!0}disableDebugMode(){this.debugMode=!1}setDisplayMode(e){this.configuration.renderMode=["Combined","AO","No AO","Split","Split AO"].indexOf(e)}setQualityMode(e){e==="Performance"?(this.configuration.aoSamples=8,this.configuration.denoiseSamples=4,this.configuration.denoiseRadius=12):e==="Low"?(this.configuration.aoSamples=16,this.configuration.denoiseSamples=4,this.configuration.denoiseRadius=12):e==="Medium"?(this.configuration.aoSamples=16,this.configuration.denoiseSamples=8,this.configuration.denoiseRadius=12):e==="High"?(this.configuration.aoSamples=64,this.configuration.denoiseSamples=8,this.configuration.denoiseRadius=6):e==="Ultra"&&(this.configuration.aoSamples=64,this.configuration.denoiseSamples=16,this.configuration.denoiseRadius=6)}}Uint8Array.from(atob(IY),n=>n.charCodeAt(0));var Cwe=Object.defineProperty,Mwe=Object.getOwnPropertyDescriptor,BY=(n,e,i,s)=>{for(var r=s>1?void 0:s?Mwe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&Cwe(e,i,r),r};class Lx extends Vs{constructor(){super(...arguments),p(this,"_effect")}get typeName(){return"Sharpening"}onCreateEffect(){return this.effect}get effect(){return this._effect??(this._effect=new kY),this._effect}set amount(e){this.effect.uniforms.get("amount").value=e}get amount(){return this.effect.uniforms.get("amount").value}set radius(e){this.effect.uniforms.get("radius").value=e}get radius(){return this.effect.uniforms.get("radius").value}}BY([T()],Lx.prototype,"amount",1),BY([T()],Lx.prototype,"radius",1);const Ewe=`
  void mainSupport() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }
`,Twe=`
uniform sampler2D tDiffuse;
uniform float amount;
uniform float radius;

void mainImage(const in vec4 inputColor, const in vec2 uv, out vec4 outputColor) {
    float tx = 1.0 / resolution.x;
    float ty = 1.0 / resolution.y;
    vec2 texelSize = vec2(tx, ty);

    vec4 blurred = vec4(0.0);
    float total = 0.0;

    for (float x = -radius; x <= radius; x++) {
        for (float y = -radius; y <= radius; y++) {
            vec2 offset = vec2(x, y) * texelSize;
            vec4 diffuse = texture2D(tDiffuse, uv + offset);
            float weight = exp(-length(offset) * amount);
            blurred += diffuse * weight;
            total += weight;
        }
    }

    if (total > 0.0) {
        blurred /= total;
    }

    // Calculate the sharpened color using inputColor
    vec4 sharp = inputColor + clamp(inputColor - blurred, 0.0, 1.0) * amount;
    // Keep original alpha
    sharp.a = inputColor.a;

    // Ensure the sharp color does not go below 0 or above 1
    // This means: sharpening must happen AFTER tonemapping.
    sharp = clamp(sharp, 0.0, 1.0);

    outputColor = sharp;
}

`;class kY extends so{constructor(){super("Sharpening",Twe,{vertexShader:Ewe,blendFunction:Ht.NORMAL,uniforms:new Map([["amount",new Ce(1)],["radius",new Ce(1)]])})}}const cf=te("debugpost"),hG=Symbol("needle:postprocessing-handler"),uG=Symbol("needle:previous-autoclear-state");class wE{constructor(e){p(this,"_composer",null),p(this,"_lastVolumeComponents"),p(this,"_effects",[]),p(this,"_isActive",!1),p(this,"context"),this.context=e}get isActive(){return this._isActive}get composer(){return this._composer}apply(e){this._isActive=!0,this.onApply(this.context,e)}unapply(){var e;if(cf&&console.log("Unapplying postprocessing effects"),this._isActive=!1,this._lastVolumeComponents){for(const s of this._lastVolumeComponents)s.unapply();this._lastVolumeComponents.length=0}const i=this.context;i[hG]===this&&delete i[hG],i.composer===this._composer&&((e=i.composer)==null||e.dispose(),i.composer=null),typeof i.renderer[uG]=="boolean"&&(i.renderer.autoClear=i.renderer[uG])}dispose(){this.unapply();for(const e of this._effects)e.dispose();this._effects.length=0,this._composer=null}onApply(e,i){if(!i)return;e[hG]=this,cf&&console.log("Apply Postprocessing Effects",i),this._lastVolumeComponents=[...i],this._effects.length=0;const s={handler:this,components:this._lastVolumeComponents};for(let r=0;r<this._lastVolumeComponents.length;r++){const o=this._lastVolumeComponents[r];if(o.context=e,o.apply){if(o.active){if(!e.mainCameraComponent){console.error("No camera in scene found or available yet - can not create postprocessing effects");return}const a=o.apply(s);if(!a)continue;Array.isArray(a)?this._effects.push(...a):this._effects.push(a)}}else o.active&&zi("Volume component is not a VolumeComponent: "+o.__type)}if(this.context.renderer.toneMapping!=Yr&&!this._effects.find(r=>r instanceof k_)){const r=new k_;this._effects.push(r)}this.applyEffects(e)}applyEffects(e){const i=this._effects;if(i.length<=0)return;const s=e.mainCameraComponent,r=e.renderer,o=e.scene,a=s.threeCamera;r[uG]=r.autoClear;const l=r.capabilities.maxSamples;this._composer||(this._composer=new yL(r,{frameBufferType:ms,stencilBuffer:!0,multisampling:Math.min(xt.isMobileDevice()?4:8,l)})),e.composer&&e.composer!==this._composer&&console.warn("There's already an active EffectComposer in your scene: replacing it with a new one. This might cause unexpected behaviour. Make sure to only use one PostprocessingManager/Volume in your scene."),e.composer=this._composer;const c=e.composer;c.setMainCamera(a),c.setRenderer(r),c.setMainScene(o);for(const u of c.passes)u.dispose();c.removeAllPasses();const h=new B_(o,a);h.name="Render To Screen",h.mainScene=o,c.addPass(h);try{this.orderEffects();const u=[];for(const d of i)if(d instanceof so)u.push(d);else if(d instanceof Ps){const m=new dV(a,...u);m.mainScene=o,m.name=u.map(f=>f.constructor.name).join(", "),m.enabled=!0,u.length=0,c.addPass(d)}if(u.length>0){const d=new dV(a,...u);d.name=u.map(m=>m.name).join(" "),d.mainScene=o,d.enabled=!0,c.addPass(d)}}catch(u){console.error("Error while applying postprocessing effects",u),c.removeAllPasses()}cf&&console.log("PostProcessing Passes",i,"->",c.passes)}orderEffects(){var e;cf&&console.log("Before ordering effects",[...this._effects]);const i=this._effects;i.sort((s,r)=>{const o=dG.findIndex(l=>s.constructor.name.endsWith(l.name)),a=dG.findIndex(l=>r.constructor.name.endsWith(l.name));return o<0?(cf&&console.warn("Unknown effect found: ",s.constructor.name),-1):a<0?(cf&&console.warn("Unknown effect found: ",r.constructor.name),1):o<0?1:a<0?-1:o-a}),cf&&console.log("After ordering effects",[...this._effects]);for(let s=0;s<i.length;s++){const r=i[s];if(((e=r?.configuration)==null?void 0:e.gammaCorrection)!==void 0){const o=s===i.length-1;r.configuration.gammaCorrection=o}}}}const dG=[pV,_L,oV,lV,PY,cV,eV,J5,xL,nV,hV,iV,k_,tV,K5,kY];async function pG(n){const{NeedleEngineHTMLElement:e}=await Promise.resolve().then(()=>pSe);e.observedAttributes.includes(n)||e.observedAttributes.push(n)}var Rwe=Object.defineProperty,Iwe=Object.getOwnPropertyDescriptor,Px=(n,e,i,s)=>{for(var r=s>1?void 0:s?Iwe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&Rwe(e,i,r),r};const tl=te("debugskybox");pG("skybox-image"),pG("environment-image");function DY(n,e,i,s,r){const o=new Yc;o.allowDrop=!1,o.allowNetworking=!1,o.background=i,o.environment=s,ie.addComponent(n.scene,o);const a=l=>{typeof l=="string"&&(tl&&console.log(r,"CHANGED TO",l),o.setSkybox(l))};return dU(n.domElement,r,a),o.addEventListener("destroy",()=>{tl&&console.log("Destroyed attribute remote skybox",r),pU(n.domElement,r,a)}),o.setSkybox(e)}yi.addContextCreatedCallback(n=>{var e;const i=n.context,s=i.domElement.getAttribute("skybox-image")||i.domElement.getAttribute("background-image"),r=i.domElement.getAttribute("environment-image"),o=new Array;if(s){tl&&console.log("Creating remote skybox to load "+s),((e=i.mainCameraComponent)==null?void 0:e.clearFlags)!==Id.Skybox&&console.warn('"skybox-image"/"background-image" attribute has no effect: camera clearflags are not set to "Skybox"');const a=DY(i,s,!0,!1,"skybox-image");o.push(a)}if(r){tl&&console.log("Creating remote environment to load "+r);const a=DY(i,r,!1,!0,"environment-image");o.push(a)}return o.length>0?h_(o):Promise.resolve()});function OY(){return globalThis.NEEDLE_ENGINE_SKYBOX_TEXTURES||(globalThis.NEEDLE_ENGINE_SKYBOX_TEXTURES=new Array),globalThis.NEEDLE_ENGINE_SKYBOX_TEXTURES}function GY(n){const e=OY().find(i=>i.src===n);return e?(tl&&console.log("Skybox: Found previously loaded texture for "+n),e.texture):null}async function Lwe(n){const e=await n;TB(e,!0),Zi(e)}function Pwe(n,e){const i=OY();for(;i.length>5;){const s=i.shift();s&&Lwe(s.texture)}e.then(s=>TB(s,!1)),i.push({src:n,texture:e})}class Yc extends Pe{constructor(){super(...arguments),p(this,"url"),p(this,"allowDrop",!0),p(this,"background",!0),p(this,"environment",!0),p(this,"allowNetworking",!0),p(this,"_loader"),p(this,"_prevUrl"),p(this,"_prevLoadedEnvironment"),p(this,"_prevEnvironment",null),p(this,"_prevBackground",null),p(this,"validTextureTypes",[".hdr",".exr",".jpg",".jpeg",".png"]),p(this,"onDragOverEvent",e=>{if(this.allowDrop&&e.dataTransfer)for(const i of e.dataTransfer.types)(i==="text/uri-list"||i==="Files")&&e.preventDefault()}),p(this,"onDrop",e=>{var i,s,r,o;if(this.allowDrop&&e.dataTransfer){for(const a of e.dataTransfer.types)if(tl&&console.log(a),a==="text/uri-list"){const l=e.dataTransfer.getData(a);tl&&console.log(a,l);let c=(s=(i=new RegExp(/polyhaven.com\/asset_img\/.+?\/(?<name>.+)\.png/).exec(l))==null?void 0:i.groups)==null?void 0:s.name;if(c||(c=(o=(r=new RegExp(/polyhaven\.com\/a\/(?<name>.+)/).exec(l))==null?void 0:r.groups)==null?void 0:o.name),tl&&console.log(c),c){const h="https://dl.polyhaven.org/file/ph-assets/HDRIs/exr/1k/"+c+"_1k.exr";console.log(`[Remote Skybox] Setting skybox from url: ${h}`),e.preventDefault(),this.setSkybox(h);break}else if(this.isValidTextureType(l)){console.log("[Remote Skybox] Setting skybox from url: "+l),e.preventDefault(),this.setSkybox(l);break}else{console.warn(`[RemoteSkybox] Unknown url ${l}. If you want to load a skybox from a url, make sure it is a valid image url. Url must end with${this.validTextureTypes.join(", ")}.`);const h=new CustomEvent("dropped-unknown-url",{detail:{sender:this,event:e,url:l,apply:u=>{e.preventDefault(),this.setSkybox(u)}}});this.dispatchEvent(h)}}else if(a=="Files"){const l=e.dataTransfer.files.item(0);if(tl&&console.log(a,l),!l)continue;if(!this.isValidTextureType(l.name)){console.warn(`[RemoteSkybox]: File "${l.name}" is not supported. Supported files are ${this.validTextureTypes.join(", ")}`);return}if(GY(l.name)===null){const c=new Blob([l]),h=URL.createObjectURL(c);e.preventDefault(),this.setSkybox(h,l.name)}else e.preventDefault(),this.setSkybox(l.name);break}}})}onEnable(){this.setSkybox(this.url),this.registerDropEvents()}onDisable(){var e;this.context.scene.environment===this._prevLoadedEnvironment&&(this.context.scene.environment=this._prevEnvironment,Fi.backgroundShouldBeTransparent(this.context)||(this.context.scene.background=this._prevBackground),this._prevLoadedEnvironment=void 0),this.unregisterDropEvents(),(e=this.context.mainCameraComponent)==null||e.applyClearFlags()}urlChangedSyncField(){this.allowNetworking&&this.url&&this.isRemoteTexture(this.url)&&this.setSkybox(this.url)}async setSkybox(e,i){var s;if(!this.activeAndEnabled||(e=Bwe(e,this.environment,this.background),!e))return!1;if(i??(i=e),this.isValidTextureType(i)||console.warn("Potentially invalid skybox url",i,"on",this.name),tl&&console.log("Set remote skybox url: "+e),this._prevUrl===e&&this._prevLoadedEnvironment)return this.applySkybox(),!0;(s=this._prevLoadedEnvironment)==null||s.dispose(),this._prevLoadedEnvironment=void 0,this._prevUrl=e;const r=await this.loadTexture(e,i);if(!r||!this.enabled)return!1;this.url=e;const o=e.lastIndexOf("/");return r.name=e.substring(o>=0?o+1:0),this._loader instanceof sc&&(r.colorSpace=vt),this._prevLoadedEnvironment=r,this.applySkybox(),!0}async loadTexture(e,i){var s,r,o,a,l;if(!e)return Promise.resolve(null);i??(i=e);const c=GY(i);if(c){const m=await c;if(((r=(s=m.source)==null?void 0:s.data)==null?void 0:r.length)>0||(l=(a=(o=m.source)==null?void 0:o.data)==null?void 0:a.data)!=null&&l.length)return m}const h=i.endsWith(".exr"),u=i.endsWith(".hdr");h?this._loader instanceof oA||(this._loader=new oA):u?this._loader instanceof _C||(this._loader=new _C):this._loader instanceof sc||(this._loader=new sc),tl&&console.log("Loading skybox: "+e);const d=this._loader.loadAsync(e);return Pwe(i,d),await d}applySkybox(){var e;const i=this._prevLoadedEnvironment;i&&(i.mapping=If,i.needsUpdate=!0,this.context.scene.background!==i&&(this._prevBackground=this.context.scene.background),this.context.scene.environment!==i&&(this._prevEnvironment=this.context.scene.environment),tl&&console.log("Set remote skybox",this.url,!Fi.backgroundShouldBeTransparent(this.context)),this.environment&&(this.context.scene.environment=i),this.background&&!Fi.backgroundShouldBeTransparent(this.context)&&(this.context.scene.background=i),((e=this.context.mainCameraComponent)==null?void 0:e.backgroundBlurriness)!==void 0&&(this.context.scene.backgroundBlurriness=this.context.mainCameraComponent.backgroundBlurriness))}isRemoteTexture(e){return e.startsWith("http://")||e.startsWith("https://")}isValidTextureType(e){for(const i of this.validTextureTypes)if(e.endsWith(i))return!0;return!1}registerDropEvents(){this.unregisterDropEvents(),this.context.domElement.addEventListener("dragover",this.onDragOverEvent),this.context.domElement.addEventListener("drop",this.onDrop)}unregisterDropEvents(){this.context.domElement.removeEventListener("dragover",this.onDragOverEvent),this.context.domElement.removeEventListener("drop",this.onDrop)}}Px([bD(Yc.prototype.urlChangedSyncField),T(URL)],Yc.prototype,"url",2),Px([T()],Yc.prototype,"allowDrop",2),Px([T()],Yc.prototype,"background",2),Px([T()],Yc.prototype,"environment",2),Px([T()],Yc.prototype,"allowNetworking",2);function Bwe(n,e,i){const s=e&&!i;switch(n?.toLowerCase()){case"studio":return s?"https://cdn.needle.tools/static/skybox/modelviewer-Neutral-small.hdr":"https://cdn.needle.tools/static/skybox/modelviewer-Neutral.hdr";case"blurred-skybox":return s?"https://cdn.needle.tools/static/skybox/blurred-skybox-small.exr":"https://cdn.needle.tools/static/skybox/blurred-skybox.exr";case"quicklook-ar":return s?"https://cdn.needle.tools/static/skybox/QuickLook-ARMode-small.exr":"https://cdn.needle.tools/static/skybox/QuickLook-ARMode.exr";case"quicklook":return s?"https://cdn.needle.tools/static/skybox/QuickLook-ObjectMode-small.exr":"https://cdn.needle.tools/static/skybox/QuickLook-ObjectMode.exr"}return n===void 0?null:n}var kwe=Object.defineProperty,Dwe=Object.getOwnPropertyDescriptor,Hr=(n,e,i,s)=>{for(var r=s>1?void 0:s?Dwe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&kwe(e,i,r),r};const zo=te("debugsceneswitcher"),Owe=te("sceneswitcher:clearscene"),_E="scene";pG(_E);const np=Promise.resolve(!1);class Cs extends Pe{constructor(){super(...arguments),p(this,"autoLoadFirstScene",!0),p(this,"scenes",[]),p(this,"loadingScene"),p(this,"queryParameterName","scene"),p(this,"useSceneName",!0),p(this,"clamp",!0),p(this,"useHistory",!0),p(this,"useKeyboard",!0),p(this,"useSwipe",!0),p(this,"useSceneLighting",!0),p(this,"useSceneBackground",!0),p(this,"preloadNext",1),p(this,"preloadPrevious",1),p(this,"preloadConcurrent",2),p(this,"createMenuButtons",!1),p(this,"sceneLoaded",new en),p(this,"_currentIndex",-1),p(this,"_currentScene"),p(this,"_engineElementOverserver"),p(this,"_preloadScheduler"),p(this,"_menuButtons"),p(this,"onPopState",async e=>{if(!this.useHistory)return;const i=this.useHistory;try{this.useHistory=!1;let s=!1;if(this.queryParameterName&&(s=await this.tryLoadFromQueryParam()),!s){const r=e?.state;if(r&&r.startsWith(this.guid)){const o=r.substr(this.guid.length+2);zo&&console.log("PopState",o),await this.trySelectSceneFromValue(o)}}}finally{this.useHistory=i}}),p(this,"normalizedSwipeThresholdX",.1),p(this,"_didSwipe",!1),p(this,"onInputPointerMove",e=>{if(this.useSwipe&&!this._didSwipe&&e.button===0&&e.pointerType==="touch"&&this.context.input.getPointerPressedCount()===1){const i=this.context.input.getPointerPositionDelta(e.button);if(i){const s=i.x/this.context.domWidth;s>=this.normalizedSwipeThresholdX?(this._didSwipe=!0,this.selectPrev()):s<=-this.normalizedSwipeThresholdX&&(this._didSwipe=!0,this.selectNext())}}}),p(this,"onInputPointerUp",e=>{e.button===0&&(this._didSwipe=!1)}),p(this,"onInputKeyDown",e=>{if(!this.useKeyboard||!this.scenes)return;const i=e.key.toLowerCase();if(!i)return;const s=parseInt(i)-1;if(s>=0){this.trySelectSceneFromValue(s);return}switch(i){case"arrowright":case"d":this.selectNext();break;case"arrowleft":case"a":this.selectPrev();break}}),p(this,"__lastSwitchScene"),p(this,"__lastSwitchScenePromise"),p(this,"_currentlyLoadingScene"),p(this,"_lastLoadingScene"),p(this,"_loadingScenePromise"),p(this,"_isCurrentlyLoading",!1),p(this,"_currentLoadingProgress")}get currentIndex(){return this._currentIndex}get currentLoadingProgress(){return this._currentLoadingProgress}get currentlyLoadingScene(){return this._currentlyLoadingScene}get currentlyLoadedScene(){return this._currentScene}awake(){this.scenes===void 0&&(this.scenes=[]);for(const e of this.scenes)e&&!e.hasUrl&&e.asset instanceof ye&&e.asset.removeFromParent();zo&&console.log("SceneSwitcher",this)}async onEnable(){if(globalThis.addEventListener("popstate",this.onPopState),this.context.input.addEventListener(yn.KeyDown,this.onInputKeyDown),this.context.input.addEventListener(yn.PointerMove,this.onInputPointerMove),this.context.input.addEventListener(yn.PointerUp,this.onInputPointerUp),this._engineElementOverserver||(this._engineElementOverserver=new MutationObserver(e=>{for(const i of e)if(i.type==="attributes"&&i.attributeName===_E){const s=this.context.domElement.getAttribute(_E);s!==null&&this.trySelectSceneFromValue(s)}})),this._engineElementOverserver.observe(this.context.domElement,{attributes:!0}),this._preloadScheduler||(this._preloadScheduler=new Gwe(this)),this._preloadScheduler.maxLoadAhead=this.preloadNext,this._preloadScheduler.maxLoadBehind=this.preloadPrevious,this._preloadScheduler.maxConcurrent=this.preloadConcurrent,this._preloadScheduler.begin(),this.autoLoadFirstScene&&this._currentIndex===-1&&!await this.tryLoadFromQueryParam()){const e=this.context.domElement.getAttribute(_E);try{(e===null||!await this.trySelectSceneFromValue(e))&&this._currentIndex===-1&&this.select(0)}finally{}}this.createMenuButtons&&(this._menuButtons??(this._menuButtons=[]),this._menuButtons.push(this.context.menu.appendChild({label:"Previous",icon:"arrow_back_ios",onClick:()=>this.selectPrev(),priority:-1005,class:"row2"})),this._menuButtons.push(this.context.menu.appendChild({label:"Next",icon:"arrow_forward_ios",iconSide:"right",onClick:()=>this.selectNext(),priority:-1e3,class:"row2"})))}onDisable(){var e;if(globalThis.removeEventListener("popstate",this.onPopState),this.context.input.removeEventListener(yn.KeyDown,this.onInputKeyDown),this.context.input.removeEventListener(yn.PointerMove,this.onInputPointerMove),this.context.input.removeEventListener(yn.PointerUp,this.onInputPointerUp),(e=this._preloadScheduler)==null||e.stop(),this._menuButtons){for(const i of this._menuButtons)i.remove();this._menuButtons=void 0}}addScene(e){if(typeof e=="string"){let i=this.context.addressables.findAssetReference(e);return i||(i=new ei(e),this.context.addressables.registerAssetReference(i)),this.scenes.push(i),i}return this.scenes.push(e),e}selectNext(){return this.select(this._currentIndex+1)}selectPrev(){return this.select(this._currentIndex-1)}select(e){var i,s,r;if(zo&&console.log("select",e),typeof e=="object"&&console.warn('Switching to "'+e+'" might not work. Please either use an index or a AssetReference (not a scene reference)'),typeof e=="string"){const a=(i=this.scenes)==null?void 0:i.find(l=>l.url===e);if(!a){const l=ei.getOrCreate(this.sourceId??"",e,this.context);return this.switchScene(l)}if(a)e=(s=this.scenes)==null?void 0:s.indexOf(a);else return np}if(!((r=this.scenes)!=null&&r.length))return np;if(e<0){if(this.clamp)return np;e=this.scenes.length-1}else if(e>=this.scenes.length){if(this.clamp)return np;e=0}const o=this.scenes[e];return this.switchScene(o)}async switchScene(e){if(!(e instanceof ei)){const i=typeof e;return i==="string"?this.select(e):i==="number"?this.select(e):(console.warn("SceneSwitcher: Can't switch to scene",e,"of type",i),!1)}return e.url===this.sourceId?(console.warn("SceneSwitcher: can't load own scene - prevent recursive loading",this.sourceId),!1):this.__lastSwitchScene===e&&this.__lastSwitchScenePromise?this.__lastSwitchScenePromise:(this.__lastSwitchScene=e,this.__lastSwitchScenePromise=this.__internalSwitchScene(e),await this.__lastSwitchScenePromise)}async __internalSwitchScene(e){var i,s,r,o;if(this._currentScene){zo&&console.log("UNLOAD",this._currentScene.url,"HasURL?: "+this._currentScene.hasUrl);const l=this.tryGetSceneEventListener(this._currentScene.asset);if(l!=null&&l.sceneClosing){const c=l.sceneClosing();c instanceof Promise&&await c}this._currentScene.hasUrl?this._currentScene.unload():this._currentScene.asset instanceof ye&&this._currentScene.asset.removeFromParent()}this._currentScene=void 0;const a=this._currentIndex=((i=this.scenes)==null?void 0:i.indexOf(e))??-1;try{this._currentlyLoadingScene=e,this._currentLoadingProgress=new ProgressEvent("progress",{loaded:0,total:1});const l=new CustomEvent("loadscene-start",{detail:{scene:e,switcher:this,index:a}});this.dispatchEvent(l),await this.onStartLoading(),await e.loadAssetAsync((h,u)=>{this._currentLoadingProgress=u,this.dispatchEvent(u)}).catch(console.error),await this.onEndLoading();const c=new CustomEvent("loadscene-finished",{detail:{scene:e,switcher:this,index:a}});if(this.dispatchEvent(c),this._currentLoadingProgress=void 0,this._currentlyLoadingScene=void 0,c.defaultPrevented)return zo&&console.warn("Adding loaded scene prevented:",e,c),!1;if(!e.asset)return zo&&console.warn("Failed loading scene:",e),!1;if(this._currentIndex===a){if(zo&&console.log("ADD",e.url),this._currentScene=e,Owe){const d=((s=this.context.mainCameraComponent)==null?void 0:s.gameObject)||this.context.mainCamera;d?.removeFromParent();const m=this.gameObject.removeFromParent();ia(this.context.scene,!0,!0),this.context.scene=new Ls,this.context.scene.add(m),d&&this.context.scene.add(d)}if(ie.add(e.asset,this.gameObject),this.useSceneLighting&&this.context.sceneLighting.enable(e),this.useSceneBackground){const d=this.context.lightmaps.tryGetSkybox(e.url);d?(d.mapping=Kr,this.context.scene.background=d):zo&&console.warn("SceneSwitcher: Can't find skybox for scene "+e.url)}if(this.useHistory&&a>=0){let d=a.toString();if(this.useSceneName&&(d=zY(e.url)),(r=this.queryParameterName)!=null&&r.length)o_(this.queryParameterName,d,this.useHistory);else{const m=history.state,f=this.guid+"::"+a;m!==f&&history.pushState(f,"unused",location.href)}}const h=this.tryGetSceneEventListener(e.asset);if(h!=null&&h.sceneOpened){const d=h.sceneOpened(this);d instanceof Promise&&await d}const u=new CustomEvent("scene-opened",{detail:{scene:e,switcher:this,index:a}});return this.dispatchEvent(u),(o=this.sceneLoaded)==null||o.invoke(this),!0}}catch(l){console.error(l)}return!1}preload(e){if(e>=0&&e<this.scenes.length){const i=this.scenes[e];if(i instanceof ei)return i.preload()}return np}tryLoadFromQueryParam(){var e;if(!((e=this.queryParameterName)!=null&&e.length))return np;const i=te(this.queryParameterName);return typeof i=="boolean"?np:this.trySelectSceneFromValue(i)}trySelectSceneFromValue(e){if(typeof e=="string"){const i=parseInt(e);if(i>=0&&i<this.scenes.length)return this.select(i);{const s=e.toLowerCase();for(let r=0;r<this.scenes.length;r++){const o=this.scenes[r];if(o&&zY(o.url).toLowerCase().includes(s))return this.select(r)}}}else if(typeof e=="number"&&e>=0&&e<this.scenes.length)return this.select(e);return no()&&console.warn('Can not find scene: "'+e+'"',this),np}async onStartLoading(){var e,i;if(this._isCurrentlyLoading=!0,this.loadingScene&&(this._lastLoadingScene!==this.loadingScene&&(this._loadingScenePromise=void 0),this._lastLoadingScene=this.loadingScene,this._loadingScenePromise||(this._loadingScenePromise=(e=this.loadingScene)==null?void 0:e.loadAssetAsync()),await this._loadingScenePromise,this._isCurrentlyLoading&&(i=this.loadingScene)!=null&&i.asset)){zo&&console.log("Add loading scene",this.loadingScene.url,this.loadingScene.asset);const s=this.loadingScene.asset;ie.add(s,this.gameObject);const r=this.tryGetSceneEventListener(s);if(r!=null&&r.sceneOpened){const o=r.sceneOpened(this);o instanceof Promise&&await o}}if(this._isCurrentlyLoading){const s=this.tryGetSceneEventListener(this.gameObject);if(s&&s.sceneOpened){const r=s.sceneOpened(this);r instanceof Promise&&await r}}}async onEndLoading(){var e;if(this._isCurrentlyLoading=!1,(e=this.loadingScene)!=null&&e.asset){zo&&console.log("Remove loading scene",this.loadingScene.url);const i=this.loadingScene.asset,s=this.tryGetSceneEventListener(i);if(typeof s?.sceneClosing=="function"){const r=s.sceneClosing();r instanceof Promise&&await r}ie.remove(i)}if(!this._isCurrentlyLoading){const i=this.tryGetSceneEventListener(this.gameObject);if(i&&i.sceneClosing){const s=i.sceneClosing();s instanceof Promise&&await s}}}tryGetSceneEventListener(e,i=0){const s=ie.foreachComponent(e,r=>{const o=r;if(o.sceneClosing||o.sceneOpened)return o});if(i===0&&!s&&e.children.length)for(const r of e.children){const o=this.tryGetSceneEventListener(r,i+1);if(o)return o}return s||null}}Hr([T()],Cs.prototype,"autoLoadFirstScene",2),Hr([T(ei)],Cs.prototype,"scenes",2),Hr([T(ei)],Cs.prototype,"loadingScene",2),Hr([T()],Cs.prototype,"queryParameterName",2),Hr([T()],Cs.prototype,"useSceneName",2),Hr([T()],Cs.prototype,"clamp",2),Hr([T()],Cs.prototype,"useHistory",2),Hr([T()],Cs.prototype,"useKeyboard",2),Hr([T()],Cs.prototype,"useSwipe",2),Hr([T()],Cs.prototype,"useSceneLighting",2),Hr([T()],Cs.prototype,"useSceneBackground",2),Hr([T()],Cs.prototype,"preloadNext",2),Hr([T()],Cs.prototype,"preloadPrevious",2),Hr([T()],Cs.prototype,"preloadConcurrent",2),Hr([T()],Cs.prototype,"createMenuButtons",2),Hr([T(en)],Cs.prototype,"sceneLoaded",2);function zY(n){const e=n.split("/").pop(),i=e?.split(".").shift();return i!=null&&i.length?i:n}class Gwe{constructor(e,i=1,s=1,r=2){p(this,"maxLoadAhead"),p(this,"maxLoadBehind"),p(this,"maxConcurrent"),p(this,"_isRunning",!1),p(this,"_switcher"),p(this,"_loadTasks",[]),p(this,"_maxConcurrentLoads",1),this._switcher=e,this.maxLoadAhead=i,this.maxLoadBehind=s,this.maxConcurrent=r}begin(){if(this._isRunning)return;zo&&console.log("Preload begin"),this._isRunning=!0;let e=-1,i,s;const r=this._switcher.scenes,o=setInterval(()=>{if(this.allLoaded()&&(zo&&console.log("All scenes loaded"),this.stop()),!this._isRunning){clearInterval(o);return}if(this.canLoadNewScene()===!1)return;e!==this._switcher.currentIndex&&(e=this._switcher.currentIndex,s=0,i=0);const a=s%2===0;a&&(i+=1),s+=1;const l=a?this.maxLoadAhead:this.maxLoadBehind;if(i>l)return;const c=a?e+i:e-i;if(c<0||c<0||c>=r.length)return;const h=r[c];new zwe(c,h,this._loadTasks)},200)}stop(){this._isRunning=!1}canLoadNewScene(){return this._loadTasks.length<this._maxConcurrentLoads}allLoaded(){if(this._switcher.scenes){for(const e of this._switcher.scenes)if(e?.isLoaded()===!1)return!1}return!0}}class zwe{constructor(e,i,s){p(this,"index"),p(this,"asset"),p(this,"tasks"),this.index=e,this.asset=i,this.tasks=s,s.push(this),this.awaitLoading()}async awaitLoading(){this.asset&&!this.asset.isLoaded()&&(zo&&console.log("Preload start: "+this.asset.url,this.index),await this.asset.preload(),zo&&console.log("Preload finished: "+this.asset.url,this.index));const e=this.tasks.indexOf(this);e>=0&&this.tasks.splice(e,1)}}function Fwe(){return new Promise((n,e)=>{const i=()=>{i!=null&&(document.removeEventListener("pointerdown",i),document.removeEventListener("click",i),document.removeEventListener("dragstart",i),document.removeEventListener("touchstart",i),n())};document.addEventListener("pointerdown",i),document.addEventListener("click",i),document.addEventListener("dragstart",i),document.addEventListener("touchstart",i)})}async function Nwe(n){await Fwe(),n()}var Uwe=Object.defineProperty,Vwe=Object.getOwnPropertyDescriptor,va=(n,e,i,s)=>{for(var r=s>1?void 0:s?Vwe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&Uwe(e,i,r),r};const js=te("debugvideo");var FY=(n=>(n[n.None=0]="None",n[n.AdjustHeight=1]="AdjustHeight",n[n.AdjustWidth=2]="AdjustWidth",n))(FY||{}),NY=(n=>(n[n.VideoClip=0]="VideoClip",n[n.Url=1]="Url",n))(NY||{}),UY=(n=>(n[n.CameraFarPlane=0]="CameraFarPlane",n[n.CameraNearPlane=1]="CameraNearPlane",n[n.RenderTexture=2]="RenderTexture",n[n.MaterialOverride=3]="MaterialOverride",n))(UY||{});class Ms extends Pe{constructor(){super(),p(this,"playOnAwake",!0),p(this,"aspectMode",0),p(this,"clip",null),p(this,"source",1),p(this,"_url",null),p(this,"renderMode"),p(this,"targetMaterialProperty"),p(this,"targetMaterialRenderer"),p(this,"targetTexture"),p(this,"time",0),p(this,"_playbackSpeed",1),p(this,"_isLooping",!1),p(this,"_muted",!1),p(this,"_audioOutputMode",2),p(this,"playInBackground",!0),p(this,"_crossOrigin","anonymous"),p(this,"_videoElement",null),p(this,"_videoTexture",null),p(this,"_videoMaterial",null),p(this,"_isPlaying",!1),p(this,"wasPlaying",!1),p(this,"visibilityChanged",e=>{switch(document.visibilityState){case"hidden":this.playInBackground||(this.wasPlaying=this._isPlaying,this.pause());break;case"visible":this.wasPlaying&&!this._isPlaying&&this.play();break}}),p(this,"_receivedInput",!1),p(this,"_overlay",null),p(this,"_targetObjects"),p(this,"_updateAspectRoutineId",-1),p(this,"_hls"),p(this,"onHlsAvailable",()=>{var e;js&&console.log("HLS: available",this.clip),!(!this.shouldUseM3U||!this.url)&&(this._hls||(this._hls=new Hls),this.videoElement.autoplay=!0,this._hls.loadSource(this.url),this._hls.attachMedia(this.videoElement),(e=this._videoElement)==null||e.play(),js&&console.log("HLS: loaded",this.clip))}),Nwe(()=>{this._receivedInput=!0,this.updateVideoElementSettings()}),this._targetObjects=[],te("videoscreenspace")&&window.addEventListener("keydown",e=>{e.key==="f"&&(this.screenspace=!this.screenspace)})}get url(){return this._url}set url(e){const i=this._url!==e;this.__didAwake?i&&this.setClipURL(e??""):this._url=e}get playbackSpeed(){var e;return((e=this._videoElement)==null?void 0:e.playbackRate)??this._playbackSpeed}set playbackSpeed(e){this._playbackSpeed=e,this._videoElement&&(this._videoElement.playbackRate=e)}get isLooping(){var e;return((e=this._videoElement)==null?void 0:e.loop)??this._isLooping}set isLooping(e){this._isLooping=e,this._videoElement&&(this._videoElement.loop=e)}get currentTime(){var e;return((e=this._videoElement)==null?void 0:e.currentTime)??this.time}set currentTime(e){this._videoElement?this._videoElement.currentTime=e:this.time=e}get isPlaying(){const e=this._videoElement;return!!(e&&(e.currentTime>0&&!e.paused&&!e.ended&&e.readyState>e.HAVE_CURRENT_DATA||e.srcObject&&e.srcObject.active))}get crossOrigin(){var e;return((e=this._videoElement)==null?void 0:e.crossOrigin)??this._crossOrigin}set crossOrigin(e){this._crossOrigin=e,this._videoElement&&(e!==null?this._videoElement.setAttribute("crossorigin",e):this._videoElement.removeAttribute("crossorigin"))}get videoMaterial(){return!this._videoMaterial&&!this.create(!1)?null:this._videoMaterial}get videoTexture(){return!this._videoTexture&&!this.create(!1)?null:this._videoTexture}get videoElement(){return!this._videoElement&&!this.create(!1)?null:this._videoElement}requestPictureInPicture(){return this._videoElement?this._videoElement.requestPictureInPicture():null}get muted(){var e;return((e=this._videoElement)==null?void 0:e.muted)??this._muted}set muted(e){this._muted=e,this._videoElement&&(this._videoElement.muted=e)}get currentVideo(){return this.clip}set audioOutputMode(e){e!==this._audioOutputMode&&(e===1&&Ye()&&console.warn("VideoAudioOutputMode.AudioSource is not yet implemented"),this._audioOutputMode=e,this.updateVideoElementSettings())}get audioOutputMode(){return this._audioOutputMode}preloadVideo(){js&&console.log("Video Preload: "+this.name,this.clip),this.create(!1)}preload(){this.preloadVideo()}setVideo(e){this.clip=e,this.source=0,this._videoElement?(this._videoElement.srcObject=e,this._isPlaying&&this.play(),this.updateAspect()):this.create(this.playOnAwake)}setClipURL(e){this._url!==e&&(this._url=e,this.source=1,js&&console.log("set url",e),this._videoElement?e.endsWith(".m3u8")||e.includes(".m3u")?this.ensureM3UCanBePlayed():(this._videoElement.src=e,this._isPlaying&&(this.stop(),this.play())):this.create(this.playOnAwake))}onEnable(){var e,i;js&&console.log("VideoPlayer.onEnable",NY[this.source],this.clip,this.url,this),window.addEventListener("visibilitychange",this.visibilityChanged),this.playOnAwake===!0?this.create(!0):this.preloadVideo(),this.screenspace?(e=this._overlay)==null||e.start():(i=this._overlay)==null||i.stop()}onDisable(){var e;window.removeEventListener("visibilitychange",this.visibilityChanged),(e=this._overlay)==null||e.stop(),this.pause()}onDestroy(){var e;this._videoElement&&((e=this.videoElement)==null||e.remove(),this._videoElement=null),this._videoTexture&&(this._videoTexture.dispose(),this._videoTexture=null)}play(){var e,i;if(this._videoElement||this.create(!1),!this._videoElement){js&&console.warn("Can not play: no video element found",this);return}if(!(this._isPlaying&&!((e=this._videoElement)!=null&&e.ended)&&!((i=this._videoElement)!=null&&i.paused))){if(this._isPlaying=!0,this._receivedInput||(this._videoElement.muted=!0),this.handleBeginPlaying(!1),this.shouldUseM3U){this.ensureM3UCanBePlayed();return}js&&console.log("Video Play()",this.clip,this._videoElement,this.time),this._videoElement.currentTime=this.time,this._videoElement.play().catch(s=>{var r;console.log(s),js&&console.error("Error playing video",s,"CODE="+s.code,(r=this.videoElement)==null?void 0:r.src,this),setTimeout(()=>{this._isPlaying&&!this.destroyed&&this.activeAndEnabled&&this.play()},1e3)}),js&&console.log("play",this._videoElement,this.time)}}stop(){this._isPlaying=!1,this.time=0,this._videoElement&&(this._videoElement.currentTime=0,this._videoElement.pause(),js&&console.log("STOP",this))}pause(){var e,i;this.time=((e=this._videoElement)==null?void 0:e.currentTime)??0,this._isPlaying=!1,(i=this._videoElement)==null||i.pause(),js&&console.log("PAUSE",this,this.currentTime)}create(e){let i;switch(this.source){case 0:i=this.clip;break;case 1:i=this.url,!(i!=null&&i.length)&&typeof this.clip=="string"&&(i=this.clip);break}return i?(this._videoElement||(js&&console.warn("Create VideoElement",this),this._videoElement=this.createVideoElement(),this.context.domElement.shadowRoot.prepend(this._videoElement),this.updateVideoElementStyles()),typeof i=="string"?(js&&console.log("Set Video src",i),this._videoElement.src=i):(js&&console.log("Set Video srcObject",i),this._videoElement.srcObject=i),this._videoTexture||(this._videoTexture=new $F(this._videoElement)),this._videoTexture.flipY=!1,this._videoTexture.colorSpace=vt,e&&this.handleBeginPlaying(e),js&&console.log("Video: handle playing done...",i,e),!0):(js&&console.warn("No video source set",this),!1)}updateAspect(){this.aspectMode!==0&&this.startCoroutine(this.updateAspectImpl())}get screenspace(){var e;return((e=this._overlay)==null?void 0:e.enabled)??!1}set screenspace(e){var i;if(e){if(!this._videoTexture)return;this._overlay||(this._overlay=new Xwe(this.context)),this._overlay.add(this._videoTexture)}else(i=this._overlay)==null||i.remove(this._videoTexture);this._overlay&&(this._overlay.enabled=e)}createVideoElement(){const e=document.createElement("video");return this._crossOrigin&&e.setAttribute("crossorigin",this._crossOrigin),js&&console.log("created video element",e),e}handleBeginPlaying(e){var i,s;if(!this.activeAndEnabled||!this._videoElement)return;this._targetObjects.length=0;let r=this.gameObject;switch(this.renderMode){case 3:r=(i=this.targetMaterialRenderer)==null?void 0:i.gameObject,r||(r=(s=ie.getComponent(this.gameObject,kn))==null?void 0:s.gameObject);break;case 2:console.error("VideoPlayer renderTexture not implemented yet. Please use material override instead");return}if(!r){console.error("Missing target for video material renderer",this.name,UY[this.renderMode],this);return}const o=r.material;if(o){this._targetObjects.push(r),o!==this._videoMaterial&&(this._videoMaterial=o.clone(),r.material=this._videoMaterial);const a="map",l=this._videoMaterial;if(!this.targetMaterialProperty)l[a]=this._videoTexture;else switch(this.targetMaterialProperty){default:l[a]=this._videoTexture;break}}else{console.warn("Can not play video, no material found, this might be a multimaterial case which is not supported yet");return}this.updateVideoElementSettings(),this.updateVideoElementStyles(),e&&(this.shouldUseM3U&&this.ensureM3UCanBePlayed(),this.play())}updateVideoElementSettings(){if(!this._videoElement)return;this._videoElement.loop=this._isLooping,this._videoElement.currentTime=this.currentTime,this._videoElement.playbackRate=this._playbackSpeed,this._videoElement.playsInline=!0;let e=!this._receivedInput||this.audioOutputMode===0;!e&&this._muted&&(e=!0),this._videoElement.muted=e,this.playOnAwake&&(this._videoElement.autoplay=!0)}updateVideoElementStyles(){this._videoElement&&(this._videoElement.style.userSelect="none",this._videoElement.style.visibility="hidden",this._videoElement.style.display="none",this.updateAspect())}*updateAspectImpl(){const e=++this._updateAspectRoutineId,i=void 0,s=this.clip;for(;e===this._updateAspectRoutineId&&this.aspectMode!==0&&this.clip&&s===this.clip&&this._isPlaying;){if(!s||typeof s=="string")return;let r;for(const o of s.getVideoTracks()){const a=o.getSettings();if(a&&a.width&&a.height){r=a.width/a.height;break}else r=this.context.renderer.domElement.clientWidth/this.context.renderer.domElement.clientHeight}if(r===void 0){for(let o=0;o<10;o++)yield;if(!this.isPlaying)break;continue}if(i===r){yield;continue}for(const o of this._targetObjects){let a=1;if(o.parent){const l=Qi(o.parent);a=l.x/l.y}switch(this.aspectMode){case 1:o.scale.y=1/r*o.scale.x*a;break;case 2:o.scale.x=r*o.scale.y*a;break}}for(let o=0;o<3;o++)yield}}get shouldUseM3U(){return this.url!=null&&(this.url.endsWith(".m3u8")||this.url.endsWith(".m3u"))&&this.source===1}ensureM3UCanBePlayed(){if(!this.shouldUseM3U)return;let e=document.head.querySelector("script[data-hls_library]");e?globalThis.Hls?this.onHlsAvailable():e.addEventListener("load",this.onHlsAvailable):(js&&console.log("HLS: load script"),e=document.createElement("script"),e.dataset.hls_library="hls.js",e.src="https://cdn.jsdelivr.net/npm/hls.js@1",e.addEventListener("load",this.onHlsAvailable),document.head.append(e))}}va([T()],Ms.prototype,"playOnAwake",2),va([T()],Ms.prototype,"aspectMode",2),va([T(URL)],Ms.prototype,"clip",2),va([T()],Ms.prototype,"source",2),va([T(URL)],Ms.prototype,"url",1),va([T()],Ms.prototype,"renderMode",2),va([T()],Ms.prototype,"targetMaterialProperty",2),va([T(kn)],Ms.prototype,"targetMaterialRenderer",2),va([T(Vt)],Ms.prototype,"targetTexture",2),va([T()],Ms.prototype,"time",2),va([T()],Ms.prototype,"playbackSpeed",1),va([T()],Ms.prototype,"isLooping",1),va([T()],Ms.prototype,"audioOutputMode",1);class Xwe{constructor(e){p(this,"context"),p(this,"_videos",[]),p(this,"_screenspaceModeQuad"),p(this,"_isInScreenspaceMode",!1),p(this,"_input"),this.context=e,this._input=new Wwe(this)}get enabled(){return this._isInScreenspaceMode}set enabled(e){e?this.start():this.stop()}add(e){this._videos.indexOf(e)===-1&&this._videos.push(e)}remove(e){if(!e)return;const i=this._videos.indexOf(e);i>=0&&this._videos.splice(i,1)}start(){var e;if(this._isInScreenspaceMode||this._videos.length<0)return;const i=this._videos[this._videos.length-1];if(!i)return;if(this._isInScreenspaceMode=!0,!this._screenspaceModeQuad){if(this._screenspaceModeQuad=dd.createPrimitive(bm.Quad,{material:new Hwe(i)}),!this._screenspaceModeQuad)return;this._screenspaceModeQuad.geometry.scale(2,2,2)}const s=this._screenspaceModeQuad;this.context.scene.add(s),this.updateScreenspaceMaterialUniforms();const r=s.material;r?.reset(),(e=this._input)==null||e.enable(r)}stop(){var e;this._isInScreenspaceMode=!1,this._screenspaceModeQuad&&((e=this._input)==null||e.disable(),this._screenspaceModeQuad.removeFromParent())}updateScreenspaceMaterialUniforms(){var e;const i=(e=this._screenspaceModeQuad)==null?void 0:e.material;i&&(i.screenAspect=this.context.domElement.clientWidth/this.context.domElement.clientHeight)}}class Wwe{constructor(e){p(this,"_onResizeScreenFn"),p(this,"_onKeyUpFn"),p(this,"_onMouseWheelFn"),p(this,"context"),p(this,"overlay"),p(this,"_material"),p(this,"_isPinching",!1),p(this,"_lastPinch",0),this.overlay=e,this.context=e.context}enable(e){this._material=e,window.addEventListener("resize",this._onResizeScreenFn=()=>{this.overlay.updateScreenspaceMaterialUniforms()}),window.addEventListener("keyup",this._onKeyUpFn=r=>{r.key==="Escape"&&this.overlay.stop()}),window.addEventListener("wheel",this._onMouseWheelFn=r=>{this.overlay.enabled&&(e.zoom+=r.deltaY*5e-4,r.preventDefault())},{passive:!1});const i=new Y;window.addEventListener("mousemove",r=>{if(this.overlay.enabled&&this.context.input.getPointerPressed(0)){const o=new Y(r.movementX,r.movementY);o.x/=this.context.domElement.clientWidth,o.y/=this.context.domElement.clientHeight,i.set(o.x,o.y),i.multiplyScalar(e.zoom/-this.context.time.deltaTime*.01),e.offset=e.offset.add(i)}}),window.addEventListener("pointermove",r=>{this.overlay.enabled&&this.context.input.getPointerPressed(0)&&this.context.input.getTouchesPressedCount()===1&&(i.set(r.movementX,r.movementY),i.multiplyScalar(e.zoom*-this.context.time.deltaTime*.05),e.offset=e.offset.add(i))});let s=0;window.addEventListener("touchstart",r=>{if(r.touches.length<2){this.context.time.time-s<.3&&this.overlay.stop(),s=this.context.time.time;return}this._isPinching=!0,this._lastPinch=0}),window.addEventListener("touchmove",r=>{if(!this._isPinching||!this._material)return;const o=r.touches[0],a=r.touches[1],l=o.clientX-a.clientX,c=o.clientY-a.clientY,h=Math.sqrt(l*l+c*c);if(this._lastPinch!==0){const u=h-this._lastPinch;this._material.zoom-=u*.004}this._lastPinch=h}),window.addEventListener("touchend",()=>{this._isPinching=!1})}disable(){this._onResizeScreenFn&&(window.removeEventListener("resize",this._onResizeScreenFn),this._onResizeScreenFn=void 0),this._onKeyUpFn&&(window.removeEventListener("keyup",this._onKeyUpFn),this._onKeyUpFn=void 0),this._onMouseWheelFn&&(window.removeEventListener("wheel",this._onMouseWheelFn),this._onMouseWheelFn=void 0)}}class Hwe extends kt{constructor(e){super(),p(this,"_offset",new Y),this.uniforms={map:{value:e},screenAspect:{value:1},offsetScale:{value:new Ze(0,0,1,1)}},this.vertexShader=`
        uniform sampler2D map;
        uniform float screenAspect;
        uniform vec4 offsetScale;
        varying vec2 vUv;

        void main() {

            gl_Position = vec4( position , 1.0 );
            vUv = uv;
            vUv.y = 1. - vUv.y;

            // fit into screen
            ivec2 res = textureSize(map, 0);
            float videoAspect = float(res.x) / float(res.y);
            float aspect = videoAspect / screenAspect;
            if(aspect >= 1.0) 
            {
                vUv.y = vUv.y * aspect;
                float offset = (1. - aspect) * .5;
                vUv.y = vUv.y + offset;
            }
            else
            {
                vUv.x = vUv.x / aspect;
                float offset = (1. - 1. / aspect) * .5;
                vUv.x = vUv.x + offset;
            }

            vUv.x -= .5;
            vUv.y -= .5;

            vUv.x *= offsetScale.z;
            vUv.y *= offsetScale.z;
            vUv.x += offsetScale.x;
            vUv.y += offsetScale.y;

            vUv.x += .5;
            vUv.y += .5;
        }

        `,this.fragmentShader=`
        uniform sampler2D map;
        varying vec2 vUv;
        void main() {
            if(vUv.x < 0. || vUv.x > 1. || vUv.y < 0. || vUv.y > 1.)
                gl_FragColor = vec4(0., 0., 0., 1.);
            else
            {
                vec4 texcolor = texture2D(map, vUv);
                texcolor = LinearTosRGB(texcolor);
                gl_FragColor = texcolor;
            }
        }
        `}set screenAspect(e){this.uniforms.screenAspect.value=e,this.needsUpdate=!0}set offset(e){const i=this.uniforms.offsetScale.value;i.x=e.x,i.y=e.y,this.uniforms.offsetScale.value=i,this.needsUpdate=!0}get offset(){const e=this.uniforms.offsetScale.value;return this._offset.set(e.x,e.y),this._offset}set zoom(e){const i=this.uniforms.offsetScale.value;e<.001&&(e=.001),i.z=e,this.needsUpdate=!0}get zoom(){return this.uniforms.offsetScale.value.z}reset(){this.offset=this.offset.set(0,0),this.zoom=1,this.needsUpdate=!0}}var jwe=Object.defineProperty,Qwe=Object.getOwnPropertyDescriptor,Bx=(n,e,i,s)=>{for(var r=s>1?void 0:s?Qwe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&jwe(e,i,r),r};const yr=te("debugscreensharing");var VY=(n=>(n[n.Screen=0]="Screen",n[n.Camera=1]="Camera",n[n.Canvas=2]="Canvas",n[n.Microphone=3]="Microphone",n))(VY||{});class sp extends Pe{constructor(){super(...arguments),p(this,"allowStartOnClick",!0),p(this,"autoConnect",!1),p(this,"_videoPlayer"),p(this,"_audioSource"),p(this,"device","Screen"),p(this,"deviceName"),p(this,"deviceFilter"),p(this,"_net"),p(this,"_requestOpen",!1),p(this,"_currentStream",null),p(this,"_currentMode",0),p(this,"onJoinedRoom",async()=>{await oc(1e3),this.autoConnect&&!this.isSending&&!this.isReceiving&&this.context.connection.isInRoom&&this.share()}),p(this,"_activeShareRequest",null),p(this,"onReceiveStream",e=>{var i;((i=e.stream)==null?void 0:i.active)===!0&&this.setStream(e.stream,2)}),p(this,"onCallEnded",e=>{yr&&console.log("CALL ENDED",this.isReceiving,this==null?void 0:this.screenspace),this.isReceiving&&(this.screenspace=!1)})}onPointerEnter(){this.context.connection.allowEditing!=!1&&this.allowStartOnClick&&this.context.input.setCursorPointer()}onPointerExit(){this.context.connection.allowEditing!=!1&&this.allowStartOnClick&&this.context.input.setCursorNormal()}onPointerClick(e){var i;if(this.context.connection.allowEditing!=!1&&this.allowStartOnClick&&!(e&&e.pointerId!==0)){if(this.isReceiving&&(i=this.videoPlayer)!=null&&i.isPlaying){this.videoPlayer&&(this.videoPlayer.screenspace=!this.videoPlayer.screenspace);return}if(this.isSending){this.close();return}this.share()}}set videoPlayer(e){this._videoPlayer&&(this.isSending||this.isReceiving)&&this._videoPlayer.stop(),this._videoPlayer=e,this._videoPlayer&&this._currentStream&&(this.isSending||this.isReceiving)&&this._videoPlayer.setVideo(this._currentStream)}get videoPlayer(){return this._videoPlayer}get screenspace(){var e;return((e=this.videoPlayer)==null?void 0:e.screenspace)??!1}set screenspace(e){this.videoPlayer&&(this.videoPlayer.screenspace=e)}get currentScream(){return this._currentStream}get currentMode(){return this._currentMode}get isSending(){var e;return((e=this._currentStream)==null?void 0:e.active)&&this._currentMode===1}get isReceiving(){if(this._currentMode===2){if(!this._currentStream||this._currentStream.active===!1)return!1;const e=this._currentStream.getTracks();for(const i of e)if(i.readyState==="live")return!0}return!1}get requiresVideoPlayer(){return this.device!=="Microphone"}awake(){typeof this.device=="number"&&(this.device=VY[this.device]),yr&&console.log("Screensharing",this.name,this),Sn.registerWaitForAllowAudio(()=>{this._videoPlayer&&this._currentStream&&this._currentMode===2&&(this._videoPlayer.playInBackground=!0,this._videoPlayer.setVideo(this._currentStream))}),this._net=new f1(this)}onEnable(){var e,i,s;(e=this._net)==null||e.enable(),(i=this._net)==null||i.addEventListener(Lc.StreamReceived,this.onReceiveStream),(s=this._net)==null||s.addEventListener(Lc.StreamEnded,this.onCallEnded),this.context.connection.beginListen(Xt.JoinedRoom,this.onJoinedRoom),this.autoConnect&&oc(1e3).then(()=>(this.enabled&&this.autoConnect&&!this.isReceiving&&!this.isSending&&this.context.connection.isInRoom&&this.share(),0))}onDisable(){var e,i,s;(e=this._net)==null||e.removeEventListener(Lc.StreamReceived,this.onReceiveStream),(i=this._net)==null||i.removeEventListener(Lc.StreamEnded,this.onCallEnded),this.context.connection.stopListen(Xt.JoinedRoom,this.onJoinedRoom),(s=this._net)==null||s.disable(),this.close()}_ensureVideoPlayer(){const e=new Ms;e.aspectMode=FY.AdjustWidth,ie.addComponent(this.gameObject,e),this._videoPlayer=e}async share(e){return this._activeShareRequest?this._activeShareRequest:(this._activeShareRequest=this.internalShare(e),this._activeShareRequest.then(()=>this._activeShareRequest=null))}async internalShare(e){if(this.context.connection.isInRoom===!1){console.warn("Can not start screensharing: requires network connection"),Ye()&&zi("Can not start screensharing: requires network connection. Add a SyncedRoom component or join a room first.");return}if(e!=null&&e.device&&(this.device=e.device),!this.videoPlayer&&this.requiresVideoPlayer&&(this._videoPlayer||(this._videoPlayer=ie.getComponent(this.gameObject,Ms)??void 0),this.videoPlayer||this._ensureVideoPlayer(),!this.videoPlayer)){console.warn("Can not share video without a videoPlayer assigned");return}this._requestOpen=!0;try{const i=e?.constraints??{echoCancellation:!0,autoGainControl:!1},s={video:i,audio:i},r=s.video;switch(r!==void 0&&typeof r!="boolean"&&(r.width||(r.width={max:1920}),r.height||(r.height={max:1920}),r.aspectRatio||(r.aspectRatio={ideal:1.7777777778}),r.frameRate||(r.frameRate={ideal:24}),r.facingMode||(r.facingMode={ideal:"user"})),this.device){case"Camera":this.tryShareUserCamera(s,e);break;case"Screen":{if(!navigator.mediaDevices.getDisplayMedia){console.error("No getDisplayMedia support");return}const l=await navigator.mediaDevices.getDisplayMedia(s);this._requestOpen?this.setStream(l,1):Pc(l)}break;case"Canvas":const o=0,a=this.context.renderer.domElement.captureStream(o);this.setStream(a,1);break;case"Microphone":{if(!navigator.mediaDevices.getUserMedia){console.error("No getDisplayMedia support");return}s.video=!1;const l=await navigator.mediaDevices.getUserMedia(s);this._requestOpen?this.setStream(l,1):Pc(l)}break;default:console.error("Can not start screen sharing: Unknown device type",this.device)}}catch(i){if(i.name==="NotAllowedError"){console.log("Selection cancelled"),this._requestOpen=!1;return}console.error("Error opening video",i)}}close(){var e;this._requestOpen=!1,this._currentStream&&(yr&&console.warn("Close current stream / disposing resources, stream was active?",this._currentStream.active),(e=this._net)==null||e.stopSendingStream(this._currentStream),Pc(this._currentStream),this._currentMode=0,this._currentStream=null)}setStream(e,i){var s,r,o;if(e===this._currentStream||(this.close(),!e))return;this._currentStream=e,this._requestOpen=!0,this._currentMode=i;const a=this.device!=="Microphone",l=i===1;a?(this._videoPlayer||this._ensureVideoPlayer(),this._videoPlayer?this._videoPlayer.setVideo(e):console.error("No video player assigned for video stream")):(this._audioSource||(this._audioSource=new Sn,this._audioSource.spatialBlend=0,this._audioSource.volume=1,this.gameObject.addComponent(this._audioSource)),l||(yr&&console.log("PLAY",e.getAudioTracks()),this._audioSource.volume=1,(s=this._audioSource)==null||s.play(e))),l&&((r=this._net)==null||r.startSendingStream(e)),l&&(this._videoPlayer&&(this._videoPlayer.muted=!0),(o=this._audioSource)==null||o.stop());for(const c of e.getTracks())c.addEventListener("ended",()=>{yr&&console.log("Track ended",c),this.close()}),yr&&c.kind==="video"&&console.log(l?"Video \u2192":"Video \u2190",c.getSettings())}async tryShareUserCamera(e,i){const s=(await navigator.mediaDevices.enumerateDevices()).filter(o=>o.kind==="videoinput");yr&&console.log(`Request camera. These are your kind:videoinput devices:
`,s);let r=!1;for(const o of s)try{if(!this._requestOpen){yr&&console.log("Camera selection cancelled");break}if(o.kind!=="videoinput"){yr&&console.log("Skipping non-video device",o);continue}const a=o.deviceId;if(i?.deviceId!=null||i?.deviceFilter!=null){if(i?.deviceId!==void 0&&a!==i.deviceId){yr&&console.log("Skipping device due to options.deviceId: "+o.label+"; "+o.deviceId);continue}if(i!=null&&i.deviceFilter&&i.deviceFilter(o)===!1){yr&&console.log("Skipping device due to options.deviceFilter: "+o.label+"; "+o.deviceId);continue}}else if(this.deviceFilter)if(this.deviceFilter(o)===!1){yr&&console.log("Skipping device due to ScreenShare.deviceFilter: "+o.label+"; "+o.deviceId);continue}else yr&&console.log("Selected device by filter",o);else if(this.deviceName){const c=o.label.toLowerCase(),h=this.deviceName.toLowerCase(),u=c.includes(h),d=o.deviceId===this.deviceName;if(!u&&!d){yr&&console.log("Skipping device due to ScreenShare.deviceName: "+o.label+"; "+o.deviceId);continue}else yr&&console.log("Selected device by name",o)}e.video!==!1&&((typeof e.video>"u"||typeof e.video=="boolean")&&(e.video={}),e.video.deviceId=a),r=!0;const l=await navigator.mediaDevices.getUserMedia(e).catch(c=>(console.error("Failed to get user media",c),null));if(l===null)continue;this._requestOpen?(this.setStream(l,1),yr&&console.log("Selected camera",o)):(Pc(l),yr&&console.log("Camera selection cancelled"));break}catch(a){if(a.message==="Failed to allocate videosource"||a.message==="Could not start video source"){zi("Failed to start video: Try another camera (Code "+a.code+")"),console.warn(a);continue}else console.error("Failed to get user media",a.message,a.code,a)}!r&&Ye()&&(zi("No camera found for sharing. Please connect a camera (see console for more information)"),console.warn("No camera found for sharing. Please connect a camera",s,this.deviceName,"Using deviceFilter? "+this.deviceFilter!=null,"Using options? "+i!=null,"Using deviceName? "+this.deviceName!=null,"Using options.deviceId? "+i?.deviceId!=null,"Using options.deviceFilter? "+i?.deviceFilter!=null))}}Bx([T()],sp.prototype,"allowStartOnClick",2),Bx([T()],sp.prototype,"autoConnect",2),Bx([T(Ms)],sp.prototype,"videoPlayer",1),Bx([T()],sp.prototype,"device",2),Bx([T()],sp.prototype,"deviceName",2);var Zwe=Object.defineProperty,Ywe=Object.getOwnPropertyDescriptor,kx=(n,e,i,s)=>{for(var r=s>1?void 0:s?Ywe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&Zwe(e,i,r),r};class cu extends Vs{constructor(){super(...arguments),p(this,"intensity",new Je(2)),p(this,"falloff",new Je(1)),p(this,"samples",new Je(9)),p(this,"color",new Je(new Ae(0,0,0))),p(this,"luminanceInfluence",new Je(.7)),p(this,"_ssao")}get typeName(){return"ScreenSpaceAmbientOcclusion"}onBeforeRender(){if(this._ssao&&this.context.mainCamera instanceof Lt){const e=this.context.mainCamera.far-this.context.mainCamera.near;this._ssao.ssaoMaterial.worldDistanceFalloff=e*.01,this._ssao.ssaoMaterial.worldDistanceThreshold=this.context.mainCamera.far}}onCreateEffect(){const e=this.context.mainCamera,i=new pV(this.context.scene,e),s=new _L({normalBuffer:i.texture,resolutionScale:.5}),r=this._ssao=new lV(e,i.texture,{normalDepthBuffer:s.texture,worldDistanceThreshold:1,worldDistanceFalloff:1,worldProximityThreshold:.1,worldProximityFalloff:2,intensity:1,blendFunction:Ht.MULTIPLY,luminanceInfluence:.5});this.intensity.onValueChanged=a=>{r.intensity=a},this.falloff.onValueChanged=a=>{r.ssaoMaterial.radius=a*.1},this.samples.onValueChanged=a=>{r.ssaoMaterial.samples=a},this.color.onValueChanged=a=>{r.color||(r.color=new Ae),r.color.copy(a)},this.luminanceInfluence.onValueChanged=a=>{r.luminanceInfluence=a};const o=new Array;return o.push(i),o.push(s),o.push(r),o}}kx([T(Je)],cu.prototype,"intensity",2),kx([T(Je)],cu.prototype,"falloff",2),kx([T(Je)],cu.prototype,"samples",2),kx([T(Je)],cu.prototype,"color",2),kx([T(Je)],cu.prototype,"luminanceInfluence",2),Ka("ScreenSpaceAmbientOcclusion",cu);var Kwe=Object.defineProperty,Jwe=Object.getOwnPropertyDescriptor,hf=(n,e,i,s)=>{for(var r=s>1?void 0:s?Jwe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&Kwe(e,i,r),r},mG=(n=>(n[n.Performance=0]="Performance",n[n.Low=1]="Low",n[n.Medium=2]="Medium",n[n.High=3]="High",n[n.Ultra=4]="Ultra",n))(mG||{});class Hl extends Vs{constructor(){super(...arguments),p(this,"gammaCorrection",!0),p(this,"aoRadius",new Je(1)),p(this,"falloff",new Je(1)),p(this,"intensity",new Je(1)),p(this,"color",new Je(new Ae(0,0,0))),p(this,"screenspaceRadius",!1),p(this,"quality",2),p(this,"_ssao")}get typeName(){return"ScreenSpaceAmbientOcclusionN8"}onValidate(){this._ssao&&(this._ssao.setQualityMode(mG[this.quality]),this._ssao.configuration.gammaCorrection=this.gammaCorrection,this._ssao.configuration.screenSpaceRadius=this.screenspaceRadius)}onCreateEffect(){const e=this.context.mainCamera,i=this._ssao=new PY(this.context.scene,e,this.context.domWidth,this.context.domHeight),s=mG[this.quality];i.setQualityMode(s),i.configuration.gammaCorrection=this.gammaCorrection,i.configuration.screenSpaceRadius=this.screenspaceRadius,this.intensity.onValueChanged=o=>{i.configuration.intensity=o},this.falloff.onValueChanged=o=>{i.configuration.distanceFalloff=o},this.aoRadius.onValueChanged=o=>{i.configuration.aoRadius=o},this.color.onValueChanged=o=>{i.color||(i.color=new Ae),i.configuration.color.copy(o)};const r=new Array;return r.push(i),r}}hf([or(),T()],Hl.prototype,"gammaCorrection",2),hf([T(Je)],Hl.prototype,"aoRadius",2),hf([T(Je)],Hl.prototype,"falloff",2),hf([T(Je)],Hl.prototype,"intensity",2),hf([T(Je)],Hl.prototype,"color",2),hf([or(),T()],Hl.prototype,"screenspaceRadius",2),hf([or(),T()],Hl.prototype,"quality",2),Ka("ScreenSpaceAmbientOcclusionN8",Hl);var qwe=Object.defineProperty,$we=Object.getOwnPropertyDescriptor,XY=(n,e,i,s)=>{for(var r=s>1?void 0:s?$we(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&qwe(e,i,r),r};class Dx extends Pe{constructor(){super(...arguments),p(this,"mode",0),p(this,"shadowColor",new Ii(0,0,0,1)),p(this,"targetMesh")}start(){if(this.gameObject instanceof pe)this.gameObject instanceof pe&&this.gameObject.material&&(this.gameObject.material=this.gameObject.material.clone(),this.targetMesh=this.gameObject,this.targetMesh.receiveShadow=!0);else{const e=dd.createPrimitive(bm.Quad,{name:"ShadowCatcher",material:new vs({color:10066329,roughness:1,metalness:0,transparent:!0})});e.receiveShadow=!0,e.geometry.rotateX(-Math.PI/2),this.gameObject.add(e),this.targetMesh=e}if(!this.targetMesh){console.warn("ShadowCatcher: no mesh to apply shadow catching to. Groups are currently not supported.");return}switch(this.targetMesh.layers.set(2),this.mode){case 0:this.applyShadowMaterial();break;case 1:this.applyLightBlendMaterial();break;case 2:this.applyOccluderMaterial();break}}applyLightBlendMaterial(){if(!this.targetMesh)return;const e=this.targetMesh.material;e.blending=bp,this.applyMaterialOptions(e),e.onBeforeCompile=i=>{i.fragmentShader=i.fragmentShader.replace("vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;",`vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
            // diffuse-only lighting with overdrive to somewhat compensate
            // for the loss of indirect lighting and to make it more visible.
            vec3 direct = (reflectedLight.directDiffuse + reflectedLight.directSpecular) * 6.6;
            float max = max(direct.r, max(direct.g, direct.b));
            
            // early out - we're simply returning direct lighting and some alpha based on it so it can 
            // be blended onto the scene.
            gl_FragColor = vec4(direct, max);
            return;
            `)}}applyShadowMaterial(){if(this.targetMesh)if(this.targetMesh.material.type!=="ShadowMaterial"){const e=new Uw;e.color=this.shadowColor,e.opacity=this.shadowColor.alpha,this.applyMaterialOptions(e),this.targetMesh.material=e}else{const e=this.targetMesh.material;e.color=this.shadowColor,e.opacity=this.shadowColor.alpha,this.applyMaterialOptions(e)}}applyOccluderMaterial(){if(this.targetMesh){let e=this.targetMesh.material;if(!e){const i=new Qt;this.targetMesh.material=i,e=i}e.depthWrite=!0,e.stencilWrite=!0,e.colorWrite=!1,this.gameObject.renderOrder=-100}}applyMaterialOptions(e){e&&(e.depthWrite=!1,e.stencilWrite=!1)}}XY([T()],Dx.prototype,"mode",2),XY([T(Ii)],Dx.prototype,"shadowColor",2);var e_e=Object.defineProperty,t_e=Object.getOwnPropertyDescriptor,SE=(n,e,i,s)=>{for(var r=s>1?void 0:s?t_e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&e_e(e,i,r),r},fG;const WY=(fG=class extends Pe{constructor(){super(...arguments),p(this,"target",null),p(this,"followFactor",.1),p(this,"rotateFactor",.1),p(this,"positionAxes",M0.All),p(this,"flipForward",!1),p(this,"_firstUpdate",!0)}onBeforeRender(){this.updateNow(!1)}updateNow(n){if(!(!this.target||this.target===this.gameObject)){if(this.followFactor>0){const e=zt(this.target),i=this._firstUpdate||n?1:tt.clamp01(this.context.time.deltaTime*this.followFactor),s=this.worldPosition;this.positionAxes&M0.X&&(s.x=tt.lerp(s.x,e.x,i)),this.positionAxes&M0.Y&&(s.y=tt.lerp(s.y,e.y,i)),this.positionAxes&M0.Z&&(s.z=tt.lerp(s.z,e.z,i)),this.worldPosition=s}if(this.rotateFactor>0){const e=ki(this.target);this.flipForward&&e.premultiply(WY._invertForward);const i=this._firstUpdate||n?1:tt.clamp01(this.context.time.deltaTime*this.rotateFactor);this.worldQuaternion=this.worldQuaternion.slerp(e,i)}this._firstUpdate=!1}}},p(fG,"_invertForward",new Se().setFromAxisAngle(new E(0,1,0),Math.PI)),fG);let rp=WY;SE([T(ye)],rp.prototype,"target",2),SE([T()],rp.prototype,"followFactor",2),SE([T()],rp.prototype,"rotateFactor",2),SE([T()],rp.prototype,"positionAxes",2);class i_e extends pe{constructor(e){const i=new n_e(e),s=new ds(i.image.width*.001,i.image.height*.001),r=new Qt({map:i,toneMapped:!1,transparent:!0});super(s,r);function o(a){r.map.dispatchDOMEvent(a)}this.addEventListener("mousedown",o),this.addEventListener("mousemove",o),this.addEventListener("mouseup",o),this.addEventListener("click",o),this.dispose=function(){s.dispose(),r.dispose(),r.map.dispose(),gG.delete(e),this.removeEventListener("mousedown",o),this.removeEventListener("mousemove",o),this.removeEventListener("mouseup",o),this.removeEventListener("click",o)}}}class n_e extends E2{constructor(e){super(HY(e)),this.dom=e,this.anisotropy=16,this.colorSpace=vt,this.minFilter=Ot,this.magFilter=Ot;const i=new MutationObserver(()=>{this.scheduleUpdate||(this.scheduleUpdate=setTimeout(()=>this.update(),16))}),s={attributes:!0,childList:!0,subtree:!0,characterData:!0};i.observe(e,s),this.observer=i}dispatchDOMEvent(e){e.data&&s_e(this.dom,e.type,e.data.x,e.data.y)}update(){this.image=HY(this.dom),this.needsUpdate=!0,this.scheduleUpdate=null}dispose(){this.observer&&this.observer.disconnect(),this.scheduleUpdate=clearTimeout(this.scheduleUpdate),super.dispose()}}const gG=new WeakMap;function HY(n){const e=document.createRange(),i=new Ae;function s(m){const f=[];let g=!1;function y(){if(g&&(g=!1,m.restore()),f.length===0)return;let v=-1/0,b=-1/0,A=1/0,x=1/0;for(let w=0;w<f.length;w++){const _=f[w];v=Math.max(v,_.x),b=Math.max(b,_.y),A=Math.min(A,_.x+_.width),x=Math.min(x,_.y+_.height)}m.save(),m.beginPath(),m.rect(v,b,A-v,x-b),m.clip(),g=!0}return{add:function(v){f.push(v),y()},remove:function(){f.pop(),y()}}}function r(m,f,g,y){y!==""&&(m.textTransform==="uppercase"&&(y=y.toUpperCase()),u.font=m.fontWeight+" "+m.fontSize+" "+m.fontFamily,u.textBaseline="top",u.fillStyle=m.color,u.fillText(y,f,g+parseFloat(m.fontSize)*.1))}function o(m,f,g,y,v){g<2*v&&(v=g/2),y<2*v&&(v=y/2),u.beginPath(),u.moveTo(m+v,f),u.arcTo(m+g,f,m+g,f+y,v),u.arcTo(m+g,f+y,m,f+y,v),u.arcTo(m,f+y,m,f,v),u.arcTo(m,f,m+g,f,v),u.closePath()}function a(m,f,g,y,v,b){const A=m[f+"Width"],x=m[f+"Style"],w=m[f+"Color"];A!=="0px"&&x!=="none"&&w!=="transparent"&&w!=="rgba(0, 0, 0, 0)"&&(u.strokeStyle=w,u.lineWidth=parseFloat(A),u.beginPath(),u.moveTo(g,y),u.lineTo(g+v,y+b),u.stroke())}function l(m,f){let g=0,y=0,v=0,b=0;if(m.nodeType===Node.TEXT_NODE){e.selectNode(m);const x=e.getBoundingClientRect();g=x.left-c.left-.5,y=x.top-c.top-.5,v=x.width,b=x.height,r(f,g,y,m.nodeValue.trim())}else{if(m.nodeType===Node.COMMENT_NODE)return;if(m instanceof HTMLCanvasElement){if(m.style.display==="none")return;const x=m.getBoundingClientRect();g=x.left-c.left-.5,y=x.top-c.top-.5,u.save();const w=window.devicePixelRatio;u.scale(1/w,1/w),u.drawImage(m,g,y),u.restore()}else if(m instanceof HTMLImageElement){if(m.style.display==="none")return;const x=m.getBoundingClientRect();g=x.left-c.left-.5,y=x.top-c.top-.5,v=x.width,b=x.height,u.drawImage(m,g,y,v,b)}else{if(m.style.display==="none")return;const x=m.getBoundingClientRect();g=x.left-c.left-.5,y=x.top-c.top-.5,v=x.width,b=x.height,f=window.getComputedStyle(m),o(g,y,v,b,parseFloat(f.borderRadius));const w=f.backgroundColor;w!=="transparent"&&w!=="rgba(0, 0, 0, 0)"&&(u.fillStyle=w,u.fill());const _=["borderTop","borderLeft","borderBottom","borderRight"];let S=!0,M=null;for(const R of _){if(M!==null&&(S=f[R+"Width"]===f[M+"Width"]&&f[R+"Color"]===f[M+"Color"]&&f[R+"Style"]===f[M+"Style"]),S===!1)break;M=R}if(S===!0){const R=parseFloat(f.borderTopWidth);f.borderTopWidth!=="0px"&&f.borderTopStyle!=="none"&&f.borderTopColor!=="transparent"&&f.borderTopColor!=="rgba(0, 0, 0, 0)"&&(u.strokeStyle=f.borderTopColor,u.lineWidth=R,u.stroke())}else a(f,"borderTop",g,y,v,0),a(f,"borderLeft",g,y,0,b),a(f,"borderBottom",g,y+b,v,0),a(f,"borderRight",g+v,y,0,b);if(m instanceof HTMLInputElement){let R=f.accentColor;(R===void 0||R==="auto")&&(R=f.color),i.set(R);const P=Math.sqrt(.299*i.r**2+.587*i.g**2+.114*i.b**2)<.5?"white":"#111111";if(m.type==="radio"&&(o(g,y,v,b,b),u.fillStyle="white",u.strokeStyle=R,u.lineWidth=1,u.fill(),u.stroke(),m.checked&&(o(g+2,y+2,v-4,b-4,b),u.fillStyle=R,u.strokeStyle=P,u.lineWidth=2,u.fill(),u.stroke())),m.type==="checkbox"&&(o(g,y,v,b,2),u.fillStyle=m.checked?R:"white",u.strokeStyle=m.checked?P:R,u.lineWidth=1,u.stroke(),u.fill(),m.checked)){const C=u.textAlign;u.textAlign="center";const L={color:P,fontFamily:f.fontFamily,fontSize:b+"px",fontWeight:"bold"};r(L,g+v/2,y,"\u2714"),u.textAlign=C}if(m.type==="range"){const[C,L,B]=["min","max","value"].map(D=>parseFloat(m[D])),z=(B-C)/(L-C)*(v-b);o(g,y+b/4,v,b/2,b/4),u.fillStyle=P,u.strokeStyle=R,u.lineWidth=1,u.fill(),u.stroke(),o(g,y+b/4,z+b/2,b/2,b/4),u.fillStyle=R,u.fill(),o(g+z,y,b,b,b/2),u.fillStyle=R,u.fill()}(m.type==="color"||m.type==="text"||m.type==="number")&&(d.add({x:g,y,width:v,height:b}),r(f,g+parseInt(f.paddingLeft),y+parseInt(f.paddingTop),m.value),d.remove())}}}const A=f.overflow==="auto"||f.overflow==="hidden";A&&d.add({x:g,y,width:v,height:b});for(let x=0;x<m.childNodes.length;x++)l(m.childNodes[x],f);A&&d.remove()}const c=n.getBoundingClientRect();let h=gG.get(n);h===void 0&&(h=document.createElement("canvas"),h.width=c.width,h.height=c.height,gG.set(n,h));const u=h.getContext("2d"),d=new s(u);return u.clearRect(0,0,h.width,h.height),l(n),h}function s_e(n,e,i,s){const r={clientX:i*n.offsetWidth+n.offsetLeft,clientY:s*n.offsetHeight+n.offsetTop,view:n.ownerDocument.defaultView};window.dispatchEvent(new MouseEvent(e,r));const o=n.getBoundingClientRect();i=i*o.width+o.left,s=s*o.height+o.top;function a(l){if(l.nodeType!==Node.TEXT_NODE&&l.nodeType!==Node.COMMENT_NODE){const c=l.getBoundingClientRect();if(i>c.left&&i<c.right&&s>c.top&&s<c.bottom&&(l.dispatchEvent(new MouseEvent(e,r)),l instanceof HTMLInputElement&&l.type==="range"&&(e==="mousedown"||e==="click"))){const[h,u]=["min","max"].map(f=>parseFloat(l[f])),d=c.width,m=(i-c.x)/d;l.value=h+(u-h)*m,l.dispatchEvent(new InputEvent("input",{bubbles:!0}))}for(let h=0;h<l.childNodes.length;h++)a(l.childNodes[h])}}a(n)}const CE=new Y,uy={type:"",data:CE},jY=new Nu;class r_e extends Vn{listenToPointerEvents(e,i){const s=this,r=new Nu,o=e.domElement;function a(l){l.stopPropagation();const c=e.domElement.getBoundingClientRect();CE.x=(l.clientX-c.left)/c.width*2-1,CE.y=-(l.clientY-c.top)/c.height*2+1,r.setFromCamera(CE,i);const h=r.intersectObjects(s.children,!1);if(h.length>0){const u=h[0],d=u.object,m=u.uv;uy.type=l.type,uy.data.set(m.x,1-m.y),d.dispatchEvent(uy)}}o.addEventListener("pointerdown",a),o.addEventListener("pointerup",a),o.addEventListener("pointermove",a),o.addEventListener("mousedown",a),o.addEventListener("mouseup",a),o.addEventListener("mousemove",a),o.addEventListener("click",a)}listenToXRControllerEvents(e){const i=this,s={move:"mousemove",select:"click",selectstart:"mousedown",selectend:"mouseup"};function r(o){const a=o.target;jY.setFromXRController(a);const l=jY.intersectObjects(i.children,!1);if(l.length>0){const c=l[0],h=c.object,u=c.uv;uy.type=s[o.type],uy.data.set(u.x,1-u.y),h.dispatchEvent(uy)}}e.addEventListener("move",r),e.addEventListener("select",r),e.addEventListener("selectstart",r),e.addEventListener("selectend",r)}}var o_e=Object.defineProperty,a_e=Object.getOwnPropertyDescriptor,QY=(n,e,i,s)=>{for(var r=s>1?void 0:s?a_e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&o_e(e,i,r),r};class Ox extends Pe{constructor(){super(...arguments),p(this,"id",null),p(this,"keepAspect",!1),p(this,"_object",null)}onEnable(){if(this._object){this.gameObject.add(this._object);return}if(!this.id||!this.context.mainCamera)return;const e=document.getElementById(this.id);if(!e){console.warn('Could not find element with id "'+this.id+'"');return}e.style.display="block",e.style.visibility="hidden";const i=new r_e;i.listenToPointerEvents(this.context.renderer,this.context.mainCamera),this.gameObject.add(i);const s=new i_e(e);i.add(s),s.visible=!1;const r=s.material;r.transparent=!0,setTimeout(()=>{s.visible=!0;const o=Vv(this.gameObject).clone();Xv(this.gameObject,0,0,0),this.gameObject.updateMatrixWorld();const a=new Wt;a.setFromObject(i),this.setWorldRotation(o.x,o.y,o.z);const l=a.max.x-a.min.x,c=a.max.y-a.min.y;if(this.keepAspect){const u=l/c;l>c?s.scale.set(1/l,1/c/u,1):s.scale.set(1/l*u,1/c,1)}else s.scale.set(1/l,1/c,1);const h=this.gameObject.scale;s.scale.multiply(h)},1)}onDisable(){var e;(e=this._object)==null||e.removeFromParent()}}QY([T()],Ox.prototype,"id",2),QY([T()],Ox.prototype,"keepAspect",2);var l_e=Object.defineProperty,c_e=Object.getOwnPropertyDescriptor,Gx=(n,e,i,s)=>{for(var r=s>1?void 0:s?c_e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&l_e(e,i,r),r};const zx=te("debugspatialtrigger"),ZY=new Mr,YY=new Mr;function h_e(n,e){return ZY.mask=n,YY.mask=e,ZY.test(YY)}class Kc extends Pe{constructor(){super(...arguments),p(this,"triggerMask",0),p(this,"onEnter"),p(this,"onStay"),p(this,"onExit"),p(this,"currentIntersected",[]),p(this,"lastIntersected",[])}start(){zx&&console.log(this.name,this.triggerMask,this)}update(){this.currentIntersected.length=0;for(const e of Fx.triggers)h_e(e.triggerMask,this.triggerMask)&&e.test(this.gameObject)&&this.currentIntersected.push(e);for(let e=this.lastIntersected.length-1;e>=0;e--){const i=this.lastIntersected[e];this.currentIntersected.indexOf(i)<0&&(this.onExitTrigger(i),this.lastIntersected.splice(e,1))}for(const e of this.currentIntersected)this.lastIntersected.indexOf(e)<0&&this.onEnterTrigger(e),this.onStayTrigger(e);this.lastIntersected.length=0,this.lastIntersected.push(...this.currentIntersected)}onEnterTrigger(e){var i;zx&&console.log("ENTER TRIGGER",this.name,e.name,this,e),e.raiseOnEnterEvent(this),(i=this.onEnter)==null||i.invoke(this,e)}onExitTrigger(e){var i;zx&&console.log("EXIT TRIGGER",this.name,e.name,this,e),e.raiseOnExitEvent(this),(i=this.onExit)==null||i.invoke(this,e)}onStayTrigger(e){var i;e.raiseOnStayEvent(this),(i=this.onStay)==null||i.invoke(this,e)}}Gx([T()],Kc.prototype,"triggerMask",2),Gx([T(en)],Kc.prototype,"onEnter",2),Gx([T(en)],Kc.prototype,"onStay",2),Gx([T(en)],Kc.prototype,"onExit",2);var yG;const ME=(yG=class extends Pe{constructor(){super(...arguments),p(this,"triggerMask"),p(this,"boxHelper")}start(){zx&&console.log(this.name,this.triggerMask,this)}onEnable(){var n;ME.triggers.push(this),this.boxHelper||(this.boxHelper=ie.addComponent(this.gameObject,Ja),(n=this.boxHelper)==null||n.showHelper(null,zx))}onDisable(){ME.triggers.splice(ME.triggers.indexOf(this),1)}test(n){return this.boxHelper?this.boxHelper.isInBox(n)??!1:!1}raiseOnEnterEvent(n){ie.foreachComponent(this.gameObject,e=>{e!==n&&e instanceof Kc&&e.onEnterTrigger(this)},!1)}raiseOnStayEvent(n){ie.foreachComponent(this.gameObject,e=>{e!==n&&e instanceof Kc&&e.onStayTrigger(this)},!1)}raiseOnExitEvent(n){ie.foreachComponent(this.gameObject,e=>{e!==n&&e instanceof Kc&&e.onExitTrigger(this)},!1)}},p(yG,"triggers",[]),yG);let Fx=ME;Gx([T()],Fx.prototype,"triggerMask",2);var u_e=Object.defineProperty,d_e=Object.getOwnPropertyDescriptor,p_e=(n,e,i,s)=>{for(var r=s>1?void 0:s?d_e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&u_e(e,i,r),r};const ba=te("debugspectator");class EE extends Pe{constructor(){super(...arguments),p(this,"cam",null),p(this,"useKeys",!0),p(this,"_mode",0),p(this,"orbit",null),p(this,"_handler"),p(this,"eventSub_WebXRRequestStartEvent",null),p(this,"eventSub_WebXRStartEvent",null),p(this,"eventSub_WebXREndEvent",null),p(this,"_debug"),p(this,"_networking")}get mode(){return this._mode}set mode(e){this._mode=e}get isSpectating(){var e;return((e=this._handler)==null?void 0:e.currentTarget)!==void 0}isSpectatingUser(e){var i;return((i=this.target)==null?void 0:i.userId)===e}isFollowedBy(e){var i;return(i=this.followers)==null?void 0:i.includes(e)}get followers(){return this._networking.followers}stopSpectating(){if(this.context.isInXR){this.followSelf();return}this.target=void 0}get localId(){return this.context.connection.connectionId??"local"}set target(e){var i;if(this._handler){const s=(i=this._handler.currentTarget)==null?void 0:i.userId,r=this.context.players.getPlayerView(this.localId);e===void 0||this.context.isInXR===!1&&r?.currentObject===e.currentObject?this._handler.currentTarget!==void 0&&(this._handler.disable(),ie.setActive(this.gameObject,!1),this.orbit&&(this.orbit.enabled=!0),this._networking.onSpectatedObjectChanged(e,s)):this._handler.currentTarget!==e&&(this._handler.set(e),ie.setActive(this.gameObject,!0),this.orbit&&(this.orbit.enabled=!1),this._networking.onSpectatedObjectChanged(e,s))}}get target(){var e;return(e=this._handler)==null?void 0:e.currentTarget}requestAllFollowMe(){this._networking.onRequestFollowMe()}get isSpectatingSelf(){var e,i;return this.isSpectating&&((e=this.target)==null?void 0:e.currentObject)===((i=this.context.players.getPlayerView(this.localId))==null?void 0:i.currentObject)}awake(){if(this._debug=new g_e(this.context,this),this._networking=new b_e(this.context,this),this._networking.awake(),ie.setActive(this.gameObject,!1),this.cam=ie.getComponent(this.gameObject,Fi),!this.cam){console.warn("SpectatorCamera: Spectator camera needs camera component on the same object.",this);return}!this._handler&&this.cam&&(this._handler=new m_e(this.context,this.cam,this)),this.orbit=ie.getComponent(this.context.mainCamera,Ei)}onDestroy(){var e,i;this.stopSpectating(),(e=this._handler)==null||e.destroy(),(i=this._networking)==null||i.destroy()}isSupportedPlatform(){const e=window.navigator.userAgent,i=/Windows|MacOS/.test(e),s=/Windows NT/.test(e)&&/Edg/.test(e)&&!/Win64/.test(e);return i&&!s}onBeforeXR(e){this.isSupportedPlatform()&&ie.setActive(this.gameObject,!0)}onEnterXR(e){this.isSupportedPlatform()&&(ba&&console.log(this.context.mainCamera),this.context.mainCamera&&this.followSelf())}onLeaveXR(e){var i,s;this.context.removeCamera(this.cam),ie.setActive(this.gameObject,!1),this.orbit&&(this.orbit.enabled=!0),(i=this._handler)==null||i.set(void 0),(s=this._handler)==null||s.disable(),this.isSpectatingSelf&&this.stopSpectating()}followSelf(){this.target=this.context.players.getPlayerView(this.context.connection.connectionId),this.target||(this.context.players.setPlayerView(this.localId,this.context.mainCamera,Ad.Headset),this.target=this.context.players.getPlayerView(this.localId)),ba&&console.log("Follow self",this.target)}onAfterRender(){var e,i,s;if(!this.cam)return;const r=this.context.renderer,o=r.xr.enabled;if(!r.xr.isPresenting&&!((e=this._handler)!=null&&e.currentTarget))return;(i=this._handler)==null||i.update(this._mode);const a=r.getRenderTarget();let l=null;const c=r.state;if(!a){if(!r.state.bindFramebuffer||!c.bindXRFramebuffer)return;l=r._framebuffer,c.bindXRFramebuffer(null)}this.setAvatarFlagsBeforeRender();const h=this.context.mainCameraComponent;if(h){const m=h.backgroundColor;m&&r.setClearColor(m,m.alpha),this.cam.backgroundColor=m,this.cam.clearFlags=h.clearFlags,this.cam.nearClipPlane=h.nearClipPlane,this.cam.farClipPlane=h.farClipPlane}else r.setClearColor(new Ae(1,1,1));r.setRenderTarget(null),r.xr.enabled=!1;const u=(s=this.cam)==null?void 0:s.threeCamera;this.context.updateAspect(u);const d=r.xr.isPresenting;r.xr.isPresenting=!1,r.setSize(this.context.domWidth,this.context.domHeight),r.render(this.context.scene,u),r.xr.isPresenting=d,r.xr.enabled=o,a?r.setRenderTarget(a):c.bindXRFramebuffer&&c.bindXRFramebuffer(l),this.resetAvatarFlags()}setAvatarFlagsBeforeRender(){const e=this._mode===0;for(const i of lr.instances)if(i.avatar&&"isLocalAvatar"in i.avatar&&"flags"in i.avatar){let s=Rc.All;this.isSpectatingSelf&&(s=e&&i.avatar.isLocalAvatar?Rc.FirstPerson:Rc.ThirdPerson);const r=i.avatar.flags;if(!r)continue;for(const o of r)o.UpdateVisible(s)}}resetAvatarFlags(){var e;for(const i of lr.instances)if(i.avatar&&"flags"in i.avatar){const s=i.avatar.flags;if(!s)continue;for(const r of s)"isLocalAvatar"in i.avatar&&(e=i.avatar)!=null&&e.isLocalAvatar?r.UpdateVisible(Rc.FirstPerson):r.UpdateVisible(Rc.ThirdPerson)}}}p_e([T()],EE.prototype,"useKeys",2);class m_e{constructor(e,i,s){p(this,"context"),p(this,"cam"),p(this,"spectator"),p(this,"follow"),p(this,"target"),p(this,"view"),p(this,"currentObject"),this.context=e,this.cam=i,this.spectator=s}get currentTarget(){return this.view}set(e){const i=e?.currentObject;if(!i){this.spectator.stopSpectating();return}i!==this.currentObject&&(this.currentObject=i,this.view=e,this.follow||(this.follow=ie.addComponent(this.cam.gameObject,rp)),this.target||(this.target=new ye),i.add(this.target),this.follow.enabled=!0,this.follow.target=this.target,ba&&console.log("FOLLOW",i),this.context.isInXR?this.context.removeCamera(this.cam):this.context.setCurrentCamera(this.cam))}disable(){ba&&console.log("STOP FOLLOW",this.currentObject),this.view=void 0,this.currentObject=void 0,this.context.removeCamera(this.cam),this.follow&&(this.follow.enabled=!1)}destroy(){var e;(e=this.target)==null||e.removeFromParent(),this.follow&&ie.destroy(this.follow)}update(e){var i,s,r,o,a,l;if(((i=this.currentTarget)==null?void 0:i.isConnected)===!1||((s=this.currentTarget)==null?void 0:s.removed)===!0){ba&&console.log("Target disconnected or timeout",this.currentTarget),this.spectator.stopSpectating();return}this.currentTarget&&((r=this.currentTarget)==null?void 0:r.currentObject)!==this.currentObject&&(ba&&console.log("Target changed",this.currentObject,"to",this.currentTarget.currentObject),this.set(this.currentTarget));const c=this.context.mainCamera;if(c){const u=this.cam.threeCamera;(u.near!==c.near||u.far!==c.far)&&(u.near=c.near,u.far=c.far,u.updateProjectionMatrix())}const h=(o=this.follow)==null?void 0:o.target;if(!(!h||!this.follow)){switch(e){case 0:((a=this.view)==null?void 0:a.viewDevice)!==Ad.Browser?(this.follow.followFactor=5,this.follow.rotateFactor=5):(this.follow.followFactor=50,this.follow.rotateFactor=50),h.position.set(0,0,0);break;case 1:this.follow.followFactor=3,this.follow.rotateFactor=2,h.position.set(0,.5,1.5);break}this.follow.flipForward=!1,((l=this.view)==null?void 0:l.viewDevice)!==Ad.Browser?h.quaternion.copy(f_e):h.quaternion.identity()}}}const f_e=new Se().setFromAxisAngle(new E(0,1,0),Math.PI);class g_e{constructor(e,i){p(this,"context"),p(this,"spectator"),this.context=e,this.spectator=i,console.log("[Spectator Camera] Click other avatars or cameras to follow them. Press ESC to exit spectator mode."),this.context.domElement.addEventListener("keydown",r=>{!this.spectator.useKeys||r.key==="Escape"&&this.spectator.stopSpectating()});let s=0;this.context.input.addEventListener(yn.PointerDown,r=>{s=this.context.time.time}),this.context.input.addEventListener(yn.PointerUp,r=>{const o=this.context.time.time-s;o>1?this.spectator.stopSpectating():this.context.input.getPointerClicked(0)&&o<.3&&this.trySelectObject()})}trySelectObject(){const e=new yc;e.setMask(16777215);const i=this.context.physics.raycast(e);if(ba&&console.log(...i),i!=null&&i.length)for(const s of i){if(s.distance<.2)continue;const r=s.object,o=ie.getComponentInParent(r,lr),a=o?.connectionId;if(a){const l=this.context.players.getPlayerView(a);this.spectator.target=l,ba&&console.log("spectate",a,o);break}}}}class y_e{constructor(e,i,s){p(this,"guid"),p(this,"dontSave",!0),p(this,"targetUserId"),p(this,"stoppedFollowing"),this.guid=e,this.targetUserId=i,this.stoppedFollowing=s}}class v_e{constructor(e,i){p(this,"guid"),p(this,"userId"),this.guid=e.guid,this.userId=i}}class b_e{constructor(e,i){p(this,"followers",[]),p(this,"context"),p(this,"spectator"),p(this,"_followerEventMethod"),p(this,"_requestFollowMethod"),p(this,"_joinedRoomMethod"),p(this,"_lastRequestFollowUser"),p(this,"_enforceFollowInterval"),this.context=e,this.spectator=i,this._followerEventMethod=this.onFollowerEvent.bind(this),this._requestFollowMethod=this.onRequestFollowEvent.bind(this),this._joinedRoomMethod=this.onUserJoinedRoom.bind(this)}awake(){this.context.connection.beginListen("spectator-follower-changed",this._followerEventMethod),this.context.connection.beginListen("spectator-request-follow",this._requestFollowMethod),this.context.connection.beginListen(Xt.JoinedRoom,this._joinedRoomMethod),this.context.domElement.addEventListener("keydown",e=>{this.spectator.useKeys&&(e.key==="f"?this.onRequestFollowMe():e.key==="Escape"&&this.onRequestFollowMe(!0))})}destroy(){this.context.connection.stopListen("spectator-follower-changed",this._followerEventMethod),this.context.connection.stopListen("spectator-request-follow",this._requestFollowMethod),this.context.connection.stopListen(Xt.JoinedRoom,this._joinedRoomMethod)}onSpectatedObjectChanged(e,i){if(ba&&console.log(this.context.connection.connectionId,"onSpectatedObjectChanged",e,i),this.context.connection.connectionId){const s=e?.userId===void 0,r=s?i:e?.userId,o=new y_e(this.context.connection.connectionId,r,s);this.context.connection.send("spectator-follower-changed",o)}}onRequestFollowMe(e=!1){if(ba&&console.log("Request follow",this.context.connection.connectionId),this.context.connection.connectionId){this.spectator.stopSpectating();const i=e?void 0:this.context.connection.connectionId,s=new v_e(this.spectator,i);this.context.connection.send("spectator-request-follow",s)}}onUserJoinedRoom(){te("followme")&&this.onRequestFollowMe()}onFollowerEvent(e){const i=e.targetUserId,s=e.guid;if(ba&&console.log(e),i===this.context.connection.connectionId)if(e.stoppedFollowing){const r=this.followers.indexOf(s);r!==-1&&(this.followers.splice(r,1),this.removeDisconnectedFollowers(),console.log(s,"unfollows you",this.followers.length))}else this.followers.includes(s)||(this.followers.push(s),this.removeDisconnectedFollowers(),console.log(s,"follows you",this.followers.length))}removeDisconnectedFollowers(){for(let e=this.followers.length-1;e>=0;e--){const i=this.followers[e];this.context.connection.userIsInRoom(i)===!1&&this.followers.splice(e,1)}}onRequestFollowEvent(e){if(this._lastRequestFollowUser=e,e.userId===this.context.connection.connectionId)this.spectator.stopSpectating();else if(e.userId===void 0)this.spectator.stopSpectating();else{const i=this.context.players.getPlayerView(e.userId);if(i)this.spectator.target=i;else return ba&&console.warn("Could not find view",e.userId),this.enforceFollow(),!1}return!0}enforceFollow(){this._enforceFollowInterval||(this._enforceFollowInterval=setInterval(()=>{this._lastRequestFollowUser===void 0||this._lastRequestFollowUser.userId&&this.spectator.isFollowedBy(this._lastRequestFollowUser.userId)?(clearInterval(this._enforceFollowInterval),this._enforceFollowInterval=void 0):(ba&&console.log("REQUEST FOLLOW AGAIN",this._lastRequestFollowUser.userId),this.onRequestFollowEvent(this._lastRequestFollowUser))},1e3))}}class eh{constructor(){p(this,"bb",null),p(this,"bb_pos",0)}__init(e,i){return this.bb_pos=e,this.bb=i,this}static getRootAsSyncedCameraModel(e,i){return(i||new eh).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsSyncedCameraModel(e,i){return e.setPosition(e.position()+UP),(i||new eh).__init(e.readInt32(e.position())+e.position(),e)}userId(e){const i=this.bb.__offset(this.bb_pos,4);return i?this.bb.__string(this.bb_pos+i,e):null}guid(e){const i=this.bb.__offset(this.bb_pos,6);return i?this.bb.__string(this.bb_pos+i,e):null}dontSave(){const e=this.bb.__offset(this.bb_pos,8);return e?!!this.bb.readInt8(this.bb_pos+e):!1}pos(e){const i=this.bb.__offset(this.bb_pos,10);return i?(e||new Om).__init(this.bb_pos+i,this.bb):null}rot(e){const i=this.bb.__offset(this.bb_pos,12);return i?(e||new Om).__init(this.bb_pos+i,this.bb):null}static startSyncedCameraModel(e){e.startObject(5)}static addUserId(e,i){e.addFieldOffset(0,i,0)}static addGuid(e,i){e.addFieldOffset(1,i,0)}static addDontSave(e,i){e.addFieldInt8(2,+i,0)}static addPos(e,i){e.addFieldStruct(3,i,0)}static addRot(e,i){e.addFieldStruct(4,i,0)}static endSyncedCameraModel(e){return e.endObject()}static finishSyncedCameraModelBuffer(e,i){e.finish(i)}static finishSizePrefixedSyncedCameraModelBuffer(e,i){e.finish(i,void 0,!0)}}var A_e=Object.defineProperty,x_e=Object.getOwnPropertyDescriptor,w_e=(n,e,i,s)=>{for(var r=s>1?void 0:s?x_e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&A_e(e,i,r),r};const TE="SCAM";WP(TE,eh.getRootAsSyncedCameraModel);const Aa=new m1;class __e{constructor(e,i){p(this,"userId"),p(this,"guid"),this.guid=i,this.userId=e}send(e,i){if(e){Aa.clear();const s=Aa.createString(this.guid),r=Aa.createString(this.userId);eh.startSyncedCameraModel(Aa),eh.addGuid(Aa,s),eh.addUserId(Aa,r);const o=zt(e),a=Vv(e);eh.addPos(Aa,Om.createVec3(Aa,o.x,o.y,o.z)),eh.addRot(Aa,Om.createVec3(Aa,a.x,a.y,a.z));const l=eh.endSyncedCameraModel(Aa);Aa.finish(l,TE),i.sendBinary(Aa.asUint8Array())}}}var vG;const bG=(vG=class extends Pe{constructor(){super(...arguments),p(this,"cameraPrefab",null),p(this,"_lastWorldPosition"),p(this,"_lastWorldQuaternion"),p(this,"_model",null),p(this,"_needsUpdate",!0),p(this,"_lastUpdateTime",0),p(this,"remoteCams",{}),p(this,"userToCamMap",{}),p(this,"_camTimeoutInSeconds",10),p(this,"_receiveCallback",null)}getCameraObject(n){const e=this.userToCamMap[n];return e?this.remoteCams[e].obj:null}async awake(){this._lastWorldPosition=this.worldPosition.clone(),this._lastWorldQuaternion=this.worldQuaternion.clone(),this.cameraPrefab&&("uri"in this.cameraPrefab&&(this.cameraPrefab=await this.cameraPrefab.instantiate(this.gameObject)),this.cameraPrefab&&"isObject3D"in this.cameraPrefab&&(this.cameraPrefab.visible=!1))}onEnable(){this._receiveCallback=this.context.connection.beginListenBinary(TE,this.onReceivedRemoteCameraInfoBin.bind(this))}onDisable(){this.context.connection.stopListenBinary(TE,this._receiveCallback)}update(){for(const s in this.remoteCams){const r=this.remoteCams[s],o=this.context.time.realtimeSinceStartup-r.lastUpdate;if(!r||o>this._camTimeoutInSeconds){Ye()&&console.log("Remote cam timeout",s),r!=null&&r.obj&&ie.destroy(r.obj),delete this.remoteCams[s],r&&delete this.userToCamMap[r.userId],bG.instances.push(r),this.context.players.removePlayerView(r.userId,Ad.Browser);continue}}if(this.context.isInXR)return;const n=this.context.mainCamera;if(n===null){this.enabled=!1;return}if(!this.context.connection.isConnected||this.context.connection.connectionId===null)return;this._model===null&&(this._model=new __e(this.context.connection.connectionId,this.context.connection.connectionId+"_camera"));const e=zt(n),i=ki(n);(e.distanceTo(this._lastWorldPosition)>.001||i.angleTo(this._lastWorldQuaternion)>.01)&&(this._needsUpdate=!0),this._lastWorldPosition.copy(e),this._lastWorldQuaternion.copy(i),!((!this._needsUpdate||this.context.time.frameCount%2!==0)&&!(this.context.time.realtimeSinceStartup-this._lastUpdateTime>this._camTimeoutInSeconds*.5))&&(this._lastUpdateTime=this.context.time.realtimeSinceStartup,this._needsUpdate=!1,this._model.send(n,this.context.connection),this.context.isInXR||this.context.players.setPlayerView(this.context.connection.connectionId,n,Ad.Browser))}onReceivedRemoteCameraInfoBin(n){const e=n.guid();if(!e)return;const i=n.userId();if(!i||!this.context.connection.userIsInRoom(i)||!this.cameraPrefab)return;let s=this.remoteCams[e];if(!s)if("isObject3D"in this.cameraPrefab){const l=new Jl;l.context=this.context;const c=ie.instantiate(this.cameraPrefab,l);s=this.remoteCams[e]={obj:c,lastUpdate:this.context.time.realtimeSinceStartup,userId:i},s.obj.visible=!0,this.gameObject.add(c),this.userToCamMap[i]=e,bG.instances.push(s);const h=ie.getOrAddComponent(c,lr);h.connectionId=i,h.avatar=c}else return;const r=s.obj;this.context.players.setPlayerView(i,r,Ad.Browser),s.lastUpdate=this.context.time.realtimeSinceStartup,hl.markDirty(r);const o=n.pos();o&&$p(r,o.x(),o.y(),o.z());const a=n.rot();a&&Xv(r,a.x(),a.y(),a.z())}},p(vG,"instances",[]),vG);let RE=bG;w_e([T([ye,ei])],RE.prototype,"cameraPrefab",2);var S_e=Object.defineProperty,C_e=Object.getOwnPropertyDescriptor,op=(n,e,i,s)=>{for(var r=s>1?void 0:s?C_e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&S_e(e,i,r),r};const AG="view",xG=te("debugsyncedroom");class jl extends Pe{constructor(){super(...arguments),p(this,"roomName",""),p(this,"urlParameterName","room"),p(this,"joinRandomRoom"),p(this,"requireRoomParameter",!1),p(this,"autoRejoin",!0),p(this,"createJoinButton",!0),p(this,"createViewOnlyButton",!1),p(this,"_lastJoinedRoom"),p(this,"_roomPrefix",""),p(this,"_lastPingTime",0),p(this,"_lastRoomTime",-1),p(this,"_userWantsToBeInARoom",!1),p(this,"_roomButton"),p(this,"_roomButtonIconJoin"),p(this,"_roomButtonIconLeave"),p(this,"updateRoomButtonState",()=>{var e,i;this._roomButton&&(this.context.connection.isInRoom?(this._roomButton.title="Leave the networked room",this._roomButton.textContent="Leave Room",(e=this._roomButtonIconJoin)==null||e.remove(),this._roomButton.prepend(this._roomButtonIconLeave)):(this._roomButton.title="Create or join a networked room",this._roomButton.textContent="Join Room",(i=this._roomButtonIconLeave)==null||i.remove(),this._roomButton.prepend(this._roomButtonIconJoin)))}),p(this,"_viewOnlyButton"),p(this,"onCreateViewOnlyButton",()=>{if(!this._viewOnlyButton){const e=document.createElement("button");this._viewOnlyButton=e,e.classList.add("view-only-button"),e.setAttribute("priority","90"),e.onclick=()=>{var i;const s=this.getViewOnlyUrl();s!=null&&s.length?navigator.canShare({url:s})?(i=navigator.share({url:s}))==null||i.catch(r=>{console.warn(r)}):(navigator.clipboard.writeText(s),gn("View only URL copied to clipboard")):zi("Could not create view only URL")},e.title="Copy the view only URL: A page accessed by the view only URL can not be modified by visiting users.",e.textContent="Share View URL",e.prepend(sr("visibility"))}this.context.menu.appendChild(this._viewOnlyButton)})}get currentRoomName(){return te(AG)||te(this.urlParameterName)}set roomPrefix(e){this._roomPrefix=e}get roomPrefix(){return this._roomPrefix}awake(){var e;this.joinRandomRoom===void 0&&((e=this.roomName)==null?void 0:e.length)<=0&&(this.joinRandomRoom=!0),xG&&console.log(`SyncedRoom roomName:${this.roomName}, urlParamName:${this.urlParameterName}, joinRandomRoom:${this.joinRandomRoom}`)}onEnable(){const e=te(AG);if(e&&typeof e=="string"&&e.length>0){console.log("Join as viewer"),this.context.connection.joinRoom(e,!0);return}if(this.tryJoinRoom(),this.createJoinButton){const i=this.createRoomButton();this.context.menu.appendChild(i)}this.createViewOnlyButton&&this.onEnableViewOnlyButton()}onDisable(){var e;(e=this._roomButton)==null||e.remove(),this.onDisableViewOnlyButton(),this.roomName&&this.roomName.length>0&&this.context.connection.leaveRoom(this.roomName)}onDestroy(){this.destroyRoomButton()}tryJoinRandomRoom(){this.setRandomRoomUrlParameter(),this.tryJoinRoom()}tryJoinRoom(e=0){var i;e===void 0&&(e=0);let s=!1;if(((i=this.urlParameterName)==null?void 0:i.length)>0){const r=te(this.urlParameterName);if(r&&(typeof r=="string"||typeof r=="number")){s=!0;const o=hU(r.toString());this.roomName=o}else if(this.joinRandomRoom&&(console.log("No room name found in url, generating random one"),this.setRandomRoomUrlParameter(),e<1))return this.tryJoinRoom(e+1)}else this.joinRandomRoom&&(this.roomName===null||this.roomName===void 0||this.roomName.length<=0)&&(this.roomName=this.generateRoomName());return this.requireRoomParameter&&!s?((xG||Ye())&&console.warn('[SyncedRoom] Missing required room parameter "'+this.urlParameterName+`" in url - will not connect.
To allow joining a room without a query parameter you can set "requireRoomParameter" to false.`),!1):(this.context.connection.isConnected||this.context.connection.connect(),this._lastJoinedRoom=this.roomName,this._roomPrefix&&(this.roomName=this._roomPrefix+this.roomName),this.roomName.length<=0?(console.warn(`[SyncedRoom] Room name is not set so we can not join a networked room.
Please choose one of the following options to fix this:
A) Set a room name in the SyncedRoom component
B) Set a room name in the URL parameter "?`+this.urlParameterName+`=my_room"
C) Set "joinRandomRoom" to true`),!1):(xG&&console.log("Join "+this.roomName),this._userWantsToBeInARoom=!0,this.context.connection.joinRoom(this.roomName),!0))}update(){this.context.connection.isConnected&&(this.context.time.time-this._lastPingTime>3&&(this._lastPingTime=this.context.time.time,this.context.connection.sendPing()),this.context.connection.isInRoom&&(this._lastRoomTime=this.context.time.time)),this._lastRoomTime>0&&this.context.time.time-this._lastRoomTime>.3&&(this._lastRoomTime=-1,this.autoRejoin?this._userWantsToBeInARoom&&(console.log("Disconnected from networking backend - attempt reconnecting now"),this.tryJoinRoom()):Ye()&&console.warn("You are not connected to a room anymore (possibly because the tab was inactive for too long and the server kicked you?)"))}getViewOnlyUrl(){if(this.context.connection.isConnected&&this.context.connection.currentRoomViewId){const e=window.location.search,i=new URLSearchParams(e);return i.has(this.urlParameterName)&&i.delete(this.urlParameterName),i.set(AG,this.context.connection.currentRoomViewId),window.location.origin+window.location.pathname+"?"+i.toString()}return null}setRandomRoomUrlParameter(){const e=kv(),i=this.generateRoomName();te(this.urlParameterName)?e.set(this.urlParameterName,i):e.append(this.urlParameterName,i),uI(i,e)}generateRoomName(){let e="";for(let i=0;i<6;i++)e+=Math.floor(Math.random()*10).toFixed(0);return e}createRoomButton(){if(this._roomButton)return this._roomButton;const e=document.createElement("button");return this._roomButton=e,e.classList.add("create-room-button"),e.setAttribute("priority","90"),e.onclick=()=>{if(this.context.connection.isInRoom)this.urlParameterName&&o_(this.urlParameterName,null),this.context.connection.leaveRoom(),this._userWantsToBeInARoom=!1;else{if(this.urlParameterName){const i=te(this.urlParameterName);(!i||i===!0)&&(this._lastJoinedRoom?o_(this.urlParameterName,this._lastJoinedRoom):this.setRandomRoomUrlParameter())}this.tryJoinRoom()}},this._roomButtonIconJoin=sr("group"),this._roomButtonIconLeave=sr("group_off"),this.updateRoomButtonState(),this.context.connection.beginListen(Xt.JoinedRoom,this.updateRoomButtonState),this.context.connection.beginListen(Xt.LeftRoom,this.updateRoomButtonState),e}destroyRoomButton(){this.context.connection.stopListen(Xt.JoinedRoom,this.updateRoomButtonState),this.context.connection.stopListen(Xt.LeftRoom,this.updateRoomButtonState)}onEnableViewOnlyButton(){this.context.connection.isConnected?this.onCreateViewOnlyButton():(this.context.connection.stopListen(Xt.JoinedRoom,this.onCreateViewOnlyButton),this.context.connection.beginListen(Xt.JoinedRoom,this.onCreateViewOnlyButton))}onDisableViewOnlyButton(){var e;this.context.connection.stopListen(Xt.JoinedRoom,this.onCreateViewOnlyButton),(e=this._viewOnlyButton)==null||e.remove()}}op([T()],jl.prototype,"roomName",2),op([T()],jl.prototype,"urlParameterName",2),op([T()],jl.prototype,"joinRandomRoom",2),op([T()],jl.prototype,"requireRoomParameter",2),op([T()],jl.prototype,"autoRejoin",2),op([T()],jl.prototype,"createJoinButton",2),op([T()],jl.prototype,"createViewOnlyButton",2),op([T()],jl.prototype,"roomPrefix",1);function M_e(){const n=te("testwindowcount")||0;n&&n>0&&E_e(n)}function E_e(n){if(te("testwindow"))return null;const e=new URL(window.location.href);hI(e.searchParams,Jye,1),hI(e.searchParams,"testwindow",1);const i=e.toString(),s=[];window.onbeforeunload=()=>{for(const c of s)c.close()};const r=.05,o=128;let a=0,l=0;for(let c=0;c<n;c++){a*o+o*.01>=window.innerWidth&&(l+=1,a=0);const h=a*(o*(1+r))+window.screenLeft,u=l*(o*(1+r))+window.screenTop+90+60*l;a+=1;const d=window.open(i,"test window "+c,`popup=yes width=${o} height=${o} top=${u} left=${h}`);if(!d){console.warn("Failed to open window");continue}s.push(d),d.onload=()=>{d.onbeforeunload=()=>{for(let m=0;m<s.length;m++){const f=s[m];f!==d&&f.close()}s.length=0}}}return s}class wG extends Pe{awake(){M_e()}}class _G extends Pe{constructor(){super(...arguments),p(this,"transformsPerFrame",10),p(this,"interval",0),p(this,"useFlatbuffers",!0),p(this,"builder",null),p(this,"models",null)}awake(){if(this.useFlatbuffers)this.context.connection.beginListenBinary(AA,e=>{});else{this.models=[];for(let e=0;e<this.transformsPerFrame;e++)this.models.push(new KY(this.context.connection.connectionId+"_simulatedTransform_"+e,this))}}update(){if(this.context.connection.isConnected){if(this.useFlatbuffers){if(!this.context.connection.connectionId||this.context.time.frameCount%this.interval!==0)return;this.builder===null&&(this.builder=new m1(1024));const e=this.builder;for(let i=0;i<this.transformsPerFrame;i++){e.clear();const s=sQ(this.context.connection.connectionId,this);this.context.connection.sendBinary(s)}}else if(this.models)for(let e=0;e<this.models.length;e++){const i=this.models[e];i.dontSave=!0,i.update(this,null),this.context.connection.send("TestSimulateUserData-"+e,i)}}}}class KY{constructor(e,i){p(this,"guid"),p(this,"fast",!1),p(this,"position"),p(this,"rotation"),p(this,"velocity"),p(this,"dontSave"),this.guid=e,this.position={x:0,y:0,z:0},this.rotation={x:0,y:0,z:0,w:0},this.update(i,null)}isValid(){return this.fast!==void 0||this.position!==void 0||this.rotation!==void 0||this.velocity!==void 0}update(e,i){const s=e.worldPosition;this.position.x=s.x,this.position.y=s.y,this.position.z=s.z;const r=e.worldQuaternion;if(this.rotation.x=r.x,this.rotation.y=r.y,this.rotation.z=r.z,this.rotation.w=r.w,this.fast=!1,i){const o=i.getVelocity();this.velocity===void 0&&(this.velocity={x:0,y:0,z:0}),this.velocity.x=o.x,this.velocity.y=o.y,this.velocity.z=o.z}}}p(KY,"temp",new E);var T_e=Object.defineProperty,R_e=Object.getOwnPropertyDescriptor,dy=(n,e,i,s)=>{for(var r=s>1?void 0:s?R_e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&T_e(e,i,r),r};class Jc extends Vs{constructor(){super(...arguments),p(this,"offset",new Je(0)),p(this,"rotation",new Je(0)),p(this,"focusArea",new Je(.4)),p(this,"feather",new Je(.3)),p(this,"kernelSize",new Je(cc.MEDIUM)),p(this,"resolutionScale",new Je(1/window.devicePixelRatio))}get typeName(){return"TiltShiftEffect"}init(){this.offset.defaultValue=0,this.rotation.defaultValue=0,this.focusArea.defaultValue=.4,this.feather.defaultValue=.3,this.kernelSize.defaultValue=cc.MEDIUM,this.resolutionScale.defaultValue=1/window.devicePixelRatio}onCreateEffect(){const e=new cV({kernelSize:cc.VERY_LARGE,offset:this.offset.value,rotation:this.rotation.value,focusArea:this.focusArea.value,feather:this.feather.value});return this.offset.onValueChanged=i=>e.offset=i,this.rotation.onValueChanged=i=>e.rotation=i,this.focusArea.onValueChanged=i=>e.focusArea=i,this.feather.onValueChanged=i=>e.feather=i,this.kernelSize.onValueChanged=i=>e.blurPass.kernelSize=i,this.resolutionScale.onValueChanged=i=>e.resolution.scale=i/window.devicePixelRatio,e}}dy([T(Je)],Jc.prototype,"offset",2),dy([T(Je)],Jc.prototype,"rotation",2),dy([T(Je)],Jc.prototype,"focusArea",2),dy([T(Je)],Jc.prototype,"feather",2),dy([T(Je)],Jc.prototype,"kernelSize",2),dy([T(Je)],Jc.prototype,"resolutionScale",2),Ka("TiltShiftEffect",Jc);var I_e=Object.defineProperty,L_e=Object.getOwnPropertyDescriptor,IE=(n,e,i,s)=>{for(var r=s>1?void 0:s?L_e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&I_e(e,i,r),r};class uf extends Pe{constructor(){super(...arguments),p(this,"isGizmo",!1),p(this,"translationSnap",1),p(this,"rotationSnapAngle",15),p(this,"scaleSnap",.25),p(this,"control"),p(this,"orbit"),p(this,"onControlChangedEvent",e=>{const i=this.orbit;if(i&&(i.enabled=!e.value),e.value){const s=ie.getComponentInParent(this.gameObject,Sc);s&&s.requestOwnership()}}),p(this,"windowKeyDownListener",e=>{if(this.enabled&&this.control)switch(e.keyCode){case 81:this.control.setSpace(this.control.space==="local"?"world":"local");break;case 16:this.enableSnapping();break;case 87:this.control.setMode("translate");break;case 69:this.control.setMode("rotate");break;case 82:this.control.setMode("scale");break;case 187:case 107:this.control.setSize(this.control.size+.1);break;case 189:case 109:this.control.setSize(Math.max(this.control.size-.1,.1));break;case 88:this.control.showX=!this.control.showX;break;case 89:this.control.showY=!this.control.showY;break;case 90:this.control.showZ=!this.control.showZ;break;case 32:this.control.enabled=!this.control.enabled;break}}),p(this,"windowKeyUpListener",e=>{if(this.enabled)switch(e.keyCode){case 16:this.disableSnapping();break}})}onEnable(){var e;this.isGizmo&&!Hb||this.context.mainCamera&&(this.control||(this.control=new Kme(this.context.mainCamera,this.context.renderer.domElement),this.control.visible=!0,this.control.enabled=!0,this.control.getRaycaster().layers.set(2),this.control.size=1,this.control.traverse(i=>{const s=i;if(s.layers.set(2),s){const r=s.material;r&&(r.opacity=.3)}}),this.orbit=ie.getComponentInParent(this.context.mainCamera,Ei)??void 0),this.control&&(this.context.scene.add(this.control),this.control.attach(this.gameObject),(e=this.control)==null||e.addEventListener("dragging-changed",this.onControlChangedEvent),window.addEventListener("keydown",this.windowKeyDownListener),window.addEventListener("keyup",this.windowKeyUpListener)))}onDisable(){var e,i;(e=this.control)==null||e.removeFromParent(),(i=this.control)==null||i.removeEventListener("dragging-changed",this.onControlChangedEvent),window.removeEventListener("keydown",this.windowKeyDownListener),window.removeEventListener("keyup",this.windowKeyUpListener)}enableSnapping(){this.control&&(this.control.setTranslationSnap(this.translationSnap),this.control.setRotationSnap(oi.degToRad(this.rotationSnapAngle)),this.control.setScaleSnap(this.scaleSnap))}disableSnapping(){this.control&&(this.control.setTranslationSnap(null),this.control.setRotationSnap(null),this.control.setScaleSnap(null))}}IE([T()],uf.prototype,"isGizmo",2),IE([T()],uf.prototype,"translationSnap",2),IE([T()],uf.prototype,"rotationSnapAngle",2),IE([T()],uf.prototype,"scaleSnap",2);var P_e=Object.defineProperty,B_e=Object.getOwnPropertyDescriptor,SG=(n,e,i,s)=>{for(var r=s>1?void 0:s?B_e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&P_e(e,i,r),r};class df extends Vs{constructor(){super(...arguments),p(this,"color",new Je({r:0,g:0,b:0,a:1})),p(this,"intensity",new Je(0)),p(this,"center",new Je({x:.5,y:.5}))}get typeName(){return"Vignette"}init(){this.color.defaultValue={r:0,g:0,b:0,a:1},this.intensity.defaultValue=0,this.center.defaultValue={x:.5,y:.5}}onCreateEffect(){const e=new hV;return this.intensity.onValueChanged=i=>{e.offset=i,this.updateDarkness(e)},this.color.onValueChanged=i=>{this.updateDarkness(e)},e}updateDarkness(e){const i=this.intensity.value;e.darkness=i}}SG([T(Je)],df.prototype,"color",2),SG([T(Je)],df.prototype,"intensity",2),SG([T(Je)],df.prototype,"center",2),Ka("Vignette",df);var k_e=Object.defineProperty,D_e=Object.getOwnPropertyDescriptor,O_e=(n,e,i,s)=>{for(var r=s>1?void 0:s?D_e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&k_e(e,i,r),r};const LE=te("debugpost");class py extends Pe{constructor(){super(...arguments),p(this,"sharedProfile"),p(this,"_postprocessing"),p(this,"_activeEffects",[]),p(this,"_effects",[]),p(this,"_lastApplyTime"),p(this,"_rapidApplyCount",0),p(this,"_isDirty",!1),p(this,"_modificationQueue"),p(this,"_recreateId",-1)}get isPostProcessingManager(){return!0}get effects(){return this._activeEffects}addEffect(e){let i=e;return i instanceof so&&(i=new px(i)),this._effects.includes(i)||(this._effects.push(i),this._isDirty=!0),e}removeEffect(e){var i,s,r,o;let a=-1;if(e instanceof so?a=this._effects.findIndex(l=>l instanceof px&&l.effect===e):a=this._effects.indexOf(e),a!==-1)return this._effects.splice(a,1),this._isDirty=!0,e;if(e instanceof Vs){const l=(s=(i=this.sharedProfile)==null?void 0:i.components)==null?void 0:s.indexOf(e);l!==void 0&&l!==-1&&(this._isDirty=!0,(o=(r=this.sharedProfile)==null?void 0:r.components)==null||o.splice(l,1))}return e}markDirty(){this._isDirty=!0}awake(){var e;LE&&(console.log("PostprocessingManager Awake",this),console.log("Press P to toggle post processing"),window.addEventListener("keydown",i=>{i.key==="p"&&(this.enabled=!this.enabled,gn("Toggle PostProcessing "+this.name+": Enabled="+this.enabled),this.markDirty())})),(e=this.sharedProfile)==null||e.init()}onEnable(){this._isDirty=!0}onDisable(){var e;(e=this._postprocessing)==null||e.unapply(),this._isDirty=!1}onBeforeRender(){var e;if(!this.context.isInXR){if(this.context.composer&&!(this.context.composer instanceof yL)){LE&&console.warn("PostProcessing: The current composer is not an EffectComposer - this is not supported");return}this.context.mainCamera&&this._isDirty&&this.apply(),this.context.composer&&((e=this._postprocessing)==null?void 0:e.composer)===this.context.composer&&(this.context.renderer.getContext().isContextLost()&&this.context.renderer.forceContextRestore(),this.context.composer.setRenderer(this.context.renderer),this.context.composer.setMainScene(this.context.scene),this.context.mainCamera&&this.context.composer.setMainCamera(this.context.mainCamera))}}onDestroy(){var e;(e=this._postprocessing)==null||e.dispose()}apply(){var e;if(LE&&console.log("Apply PostProcessing "+this.name),Ye()&&(this._lastApplyTime!==void 0&&Date.now()-this._lastApplyTime<100&&(this._rapidApplyCount++,this._rapidApplyCount===5&&console.warn("Detected rapid post processing modifications - this might be a bug",this)),this._lastApplyTime=Date.now()),this._isDirty=!1,this.unapply(),this._activeEffects.length=0,(e=this.sharedProfile)!=null&&e.components){const i=this.sharedProfile.components;for(const s of i)s.active&&!this._activeEffects.includes(s)&&this._activeEffects.push(s)}for(const i of this._effects)i.active&&!this._activeEffects.includes(i)&&this._activeEffects.push(i);LE&&console.log("Apply PostProcessing",this._activeEffects),this._activeEffects.length>0&&(this._postprocessing||(this._postprocessing=new wE(this.context)),this._postprocessing.apply(this._activeEffects),this._applyPostQueue())}unapply(){var e;(e=this._postprocessing)==null||e.unapply()}_applyPostQueue(){if(this._modificationQueue){for(const e of this._modificationQueue.values())this.onEditorModification(e);this._modificationQueue.clear()}}onEditorModification(e){var i,s;if(e.propertyName.startsWith("postprocessing.")){if(!this._postprocessing)return this._modificationQueue||(this._modificationQueue=new Map),this._modificationQueue.set(e.propertyName,e),!0;if(!((i=this._activeEffects)!=null&&i.length))return;const r=e.propertyName.split(".");if(r.length===3||r.length===4){const o=r[1],a=r[2];for(const l of this._activeEffects)if(((s=l.typeName)==null?void 0:s.toLowerCase())===o.toLowerCase()){if(a==="active"){l.active=e.value,this.scheduleRecreate();return}if(!PE.has(o)){const c=new Array;PE.set(o,c);const h=Object.keys(l);for(const u of h)l[u]instanceof Je&&c.push(u)}if(PE.has(o)){const c=a.toLowerCase(),h=PE.get(o);for(const u of h)if(u.toLowerCase()===c){const d=l[u];d instanceof Je&&(r.length===4&&r[3]==="active"?(d.overrideState=e.value,this.scheduleRecreate()):d&&d.value!==void 0&&(d.value=e.value));return}}console.warn("Unknown modification",a);return}}return!0}return!1}scheduleRecreate(){const e=++this._recreateId;setTimeout(()=>{e===this._recreateId&&(this.onDisable(),this.onEnable())},200)}}O_e([S0(LA)],py.prototype,"sharedProfile",2);const PE=new Map;pye(py);var G_e=Object.defineProperty,z_e=Object.getOwnPropertyDescriptor,F_e=(n,e,i,s)=>{for(var r=s>1?void 0:s?z_e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&G_e(e,i,r),r};const BE=te("debugarcamera");class kE extends Pe{constructor(){super(...arguments),p(this,"backgroundTint",new Ii(1,1,1,1)),p(this,"backgroundPlane"),p(this,"threeTexture"),p(this,"forceTextureInitialization",function(){const e=new Qt,i=new ds,s=new Ls;s.add(new pe(i,e));const r=new Lt;return function(o,a){e.map=a,o.render(s,r),BE&&console.warn("Force texture initialization")}}()),p(this,"preRender",()=>{if(!this||!this.gameObject)return;const e=this.context.renderer.xr.getFrame();e&&(!this.threeTexture&&this.context.renderer&&(this.threeTexture=new Vt,this.forceTextureInitialization(this.context.renderer,this.threeTexture)),this.backgroundPlane===void 0&&(this.backgroundPlane=U_e(this.backgroundTint)),this.backgroundPlane.parent!==this.scene&&this.scene.add(this.backgroundPlane),this.updateFromFrame(e))})}onBeforeXR(e,i){i.optionalFeatures=i.optionalFeatures||[],i.optionalFeatures.push("camera-access"),BE&&console.warn("Requesting camera-access")}onEnterXR(e){this.backgroundPlane&&(this.context.scene.add(this.backgroundPlane),this.backgroundPlane.visible=!1),this.backgroundPlane&&this.context.scene.add(this.backgroundPlane),this.context.pre_render_callbacks.push(this.preRender)}onLeaveXR(e){this.backgroundPlane&&this.backgroundPlane.removeFromParent();const i=this.context.pre_render_callbacks.indexOf(this.preRender);i>=0&&this.context.pre_render_callbacks.splice(i,1)}get background(){return this.backgroundPlane}onBeforeRender(e){this.updateFromFrame(e)}updateFromFrame(e){if(!e)return;const i=e.session.enabledFeatures;if(i&&!i.some(r=>r==="camera-access")){this.background&&(this.background.visible=!1);return}const s=e.getViewerPose(this.context.renderer.xr.getReferenceSpace());if(s){for(const r of s.views)if("camera"in r&&r.camera){let o=this.context.renderer.xr.getBinding();if(o||(o=new XRWebGLBinding(e.session,this.context.renderer.getContext())),o){let a=null;if("getCameraImage"in o){a=o.getCameraImage(r.camera);const l=this.context.renderer.properties.get(this.threeTexture);l.__webglTexture=a,this.backgroundPlane?(this.backgroundPlane.setTexture(this.threeTexture),this.backgroundPlane.visible=!0):BE&&console.warn("No background plane to set texture on")}}}}}}F_e([T(Ii)],kE.prototype,"backgroundTint",2);const N_e=`
uniform sampler2D t2D;

varying vec2 vUv;

void main() {

    vec4 texColor = texture2D( t2D, vUv );
    texColor.w = 1.0;

    // inline sRGB decode
    texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );

    gl_FragColor = texColor * <backgroundTint>;

    #include <tonemapping_fragment>
    #include <colorspace_fragment>
}
`;function U_e(n){const e="vec4("+n.r.toFixed(3)+","+n.g.toFixed(3)+","+n.b.toFixed(3)+","+n.a.toFixed(3)+")";BE&&console.log(e);const i=new pe(new ds(2,2),new kt({name:"BackgroundMaterial",uniforms:Kf.clone(Js.background.uniforms),vertexShader:Js.background.vertexShader,fragmentShader:N_e.replaceAll("<backgroundTint>",e),side:xi,depthTest:!1,depthWrite:!1,fog:!1}));return i.geometry.deleteAttribute("normal"),Object.defineProperty(i.material,"map",{get:function(){return this.threeTexture}}),i.renderOrder=-1e4,i.layers.set(2),i.frustumCulled=!1,i.setTexture=function(s){i.material.uniforms.t2D.value=s},i}var V_e=Object.defineProperty,X_e=Object.getOwnPropertyDescriptor,pf=(n,e,i,s)=>{for(var r=s>1?void 0:s?X_e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&V_e(e,i,r),r};const JY=te("debugimagetracking"),CG=class{constructor(n,e,i,s,r,o){p(this,"measuredSize"),p(this,"state"),p(this,"_position"),p(this,"_rotation"),p(this,"_trackingComponent"),p(this,"_trackedImage"),p(this,"_bitmap"),p(this,"_pose"),this._trackingComponent=n,this._trackedImage=e,this._bitmap=i,this.measuredSize=s,this.state=r,this._pose=o}get url(){return this._trackedImage.image??""}get widthInMeters(){return this._trackedImage.widthInMeters??void 0}get bitmap(){return this._bitmap}get model(){return this._trackedImage}getPosition(n){return this.ensureTransformData(),n.copy(this._position),n}getQuaternion(n){return this.ensureTransformData(),n.copy(this._rotation),n}applyToObject(n,e=void 0){this.ensureTransformData();const i=n.position.distanceToSquared(this._position)/.05+n.quaternion.angleTo(this._rotation)/.05;e&&(e*=Math.max(1,i)),e===void 0||e>=1?(n.position.copy(this._position),n.quaternion.copy(this._rotation)):(e=Math.max(0,Math.min(1,e)),n.position.lerp(this._position,e),n.quaternion.slerp(this._rotation,e))}ensureTransformData(){if(!this._position){this._position=CG._positionBuffer.get(),this._rotation=CG._rotationBuffer.get();const n=this._pose.transform,e=Et.active.convertSpace(n);this._position.copy(e?.position),this._rotation.copy(e?.quaternion)}}};let my=CG;p(my,"_positionBuffer",new Qo(()=>new E,20)),p(my,"_rotationBuffer",new Qo(()=>new Se,20));class qc{constructor(){p(this,"image"),p(this,"widthInMeters",.25),p(this,"object"),p(this,"createObjectInstance",!1),p(this,"imageDoesNotMove",!1),p(this,"hideWhenTrackingIsLost",!0)}}pf([T(URL)],qc.prototype,"image",2),pf([T()],qc.prototype,"widthInMeters",2),pf([T(ei)],qc.prototype,"object",2),pf([T()],qc.prototype,"createObjectInstance",2),pf([T()],qc.prototype,"imageDoesNotMove",2),pf([T()],qc.prototype,"hideWhenTrackingIsLost",2);class W_e{constructor(e,i,s){p(this,"filename"),p(this,"widthInMeters"),p(this,"imageData"),this.filename=e,this.imageData=i,this.widthInMeters=s}get extensionName(){return"image-tracking"}onAfterHierarchy(e,i){i.beginBlock('def Preliminary_ReferenceImage "AnchoringReferenceImage"'),i.appendLine("uniform asset image = @image_tracking/"+this.filename+"@"),i.appendLine("uniform double physicalWidth = "+(this.widthInMeters*100).toFixed(8)),i.closeBlock()}onBeforeBuildDocument(e){const i=ie.findObjectOfType(fy);!i||!i.trackedImages||i.trackedImages.length>1&&(Ye()&&zi("USDZ: Only one tracked image is supported."),console.warn("USDZ: Only one tracked image is supported."))}onAfterSerialize(e){e.files["image_tracking/"+this.filename]=this.imageData}onExportObject(e,i,s){var r;const o=ie.findObjectOfType(fy);if(!(!o||!o.trackedImages)){for(const a of o.trackedImages)if(((r=a.object)==null?void 0:r.asset)===e){const l=ie.findObjectOfType(Gn);if(!l)continue;const{scale:c,target:h}=l.getARScaleAndTarget();let u=e;const d=new he;if(e!==h)for(;u.parent&&u.parent!==h;)u=u.parent,d.premultiply(u.matrix);const m=d.clone().invert();i.setMatrix(m.scale(new E(c,c,c)));break}}}}var MG;const Nx=(MG=class extends Pe{constructor(){super(...arguments),p(this,"trackedImages"),p(this,"smooth",!0),p(this,"trackedImageIndexMap",new Map),p(this,"imageToObjectMap",new Map),p(this,"currentImages",[]),p(this,"onImageTrackingUpdate",n=>{const e=Et.active;if(e)for(const i of n){const s=i.model,r=i.state==="tracked";if(!s.object)continue;let o=this.imageToObjectMap.get(s);if(o===void 0)o={object:null,frames:0,lastTrackingTime:Date.now()},this.imageToObjectMap.set(s,o),s.object.loadAssetAsync().then(a=>{if(s.createObjectInstance&&a&&(a=ie.instantiate(a)),a){o.object=a;for(const l of a.getComponentsInChildren(kn))l.setInstancingEnabled(!1);e.rig?(e.rig.gameObject.add(a),i.applyToObject(a),a.activeSelf||ie.setActive(a,!0)):console.warn("XRImageTracking: missing XRRig")}});else{if(o.frames++,r&&(o.lastTrackingTime=Date.now()),s.imageDoesNotMove&&o.frames>10||!o.object)continue;e.rig&&(e.rig.gameObject.add(o.object),i.applyToObject(o.object,this.smooth?this.context.time.deltaTimeUnscaled*3:void 0),o.object.activeSelf||ie.setActive(o.object,!0))}}})}awake(){if(JY&&console.log(this),!!this.trackedImages){for(const n of this.trackedImages)if(n.image&&!Nx._imageElements.has(n.image)){const e=n.image;Nx._imageElements.set(e,null);const i=document.createElement("img");i.src=e,i.addEventListener("load",async()=>{const s=await createImageBitmap(i);Nx._imageElements.set(e,s);const r=await Pj(s);if(r){const o=await(await r.convertToBlob({type:"image/png"})).arrayBuffer(),a=ie.findObjectOfType(Gn);a&&this.trackedImages&&(a.extensions.push(new W_e("marker.png",new Uint8Array(o),this.trackedImages[0].widthInMeters)),a.anchoringType="image")}})}}}onBeforeXR(n,e){var i;if(this.trackedImages){e.optionalFeatures=e.optionalFeatures||[],e.optionalFeatures.includes("image-tracking")||e.optionalFeatures.push("image-tracking"),e.trackedImages=[];for(const s of this.trackedImages)if((i=s.image)!=null&&i.length&&s.widthInMeters>0){const r=Nx._imageElements.get(s.image);r&&(this.trackedImageIndexMap.set(e.trackedImages.length,s),e.trackedImages.push({image:r,widthInMeters:s.widthInMeters}))}}}onEnterXR(n){var e;if(this.trackedImages){for(const i of this.trackedImages)if((e=i.object)!=null&&e.asset){const s=i.object.asset;s.userData||(s.userData={});const r={visible:s.visible,parent:s.parent,matrix:s.matrix.clone()};s.userData["image-tracking"]=r}}for(const i of this.imageToObjectMap.values())i.frames=0}onLeaveXR(n){var e,i;if(this.trackedImages){for(const s of this.trackedImages)if((e=s.object)!=null&&e.asset){const r=s.object.asset;if(r.userData){const o=r.userData["image-tracking"];o&&(r.visible=o.visible,(i=o.parent)==null||i.add(r),r.matrix.copy(o.matrix),r.matrix.decompose(r.position,r.quaternion,r.scale)),delete r.userData["image-tracking"]}}}}onUpdateXR(n){var e;this.currentImages.length=0;const i=n.xr.frame;if(!i)return;if("getImageTrackingResults"in i){if(((e=n.xr.session.enabledFeatures)==null?void 0:e.includes("image-tracking"))===!1)return;if(i.session&&typeof i.getImageTrackingResults=="function"){const r=i.getImageTrackingResults();if(r.length>0){const o=this.context.renderer.xr.getReferenceSpace();if(o){for(const a of r){const l=a.trackingState,c=a.index,h=this.trackedImageIndexMap.get(c);if(h){const u=i.getPose(a.imageSpace,o),d=new my(this,h,a.image,a.measuredSize,l,u);this.currentImages.push(d)}else JY&&console.warn("No tracked image for index",c)}if(this.currentImages.length>0)try{this.dispatchEvent(new CustomEvent("image-tracking",{detail:this.currentImages})),this.onImageTrackingUpdate(this.currentImages)}catch(a){console.error(a)}}}}}else{const r=`Image tracking is currently not supported on this device. On Chrome for Android, you can enable the <a target="_blank" href="#" onclick="() => console.log('I')">chrome://flags/#webxr-incubations</a> flag.`;this.didPrintWarning||(this.didPrintWarning=!0,console.log(r)),zi(r);return}const s=1e3;for(const[r,o]of this.imageToObjectMap){if(!o.object||!r||r.hideWhenTrackingIsLost===!1)continue;let a=!1;for(const l of this.currentImages)if(l.model===r){const c=Date.now()-o.lastTrackingTime;if(r.imageDoesNotMove||l.state==="tracked"||c<=s){a=!0;break}}a||ie.setActive(o.object,!1)}}},p(MG,"_imageElements",new Map),MG);let fy=Nx;pf([T(qc)],fy.prototype,"trackedImages",2);const Ux=new E,Vx=new E,qY=new Gt;class H_e extends Ir{constructor(e,i=1,s=16711680){const r=new dt,o=e.geometry.attributes.normal.count,a=new st(o*2*3,3);r.setAttribute("position",a),super(r,new Vi({color:s,toneMapped:!1})),this.object=e,this.size=i,this.type="VertexNormalsHelper",this.matrixAutoUpdate=!1,this.update()}update(){this.object.updateMatrixWorld(!0),qY.getNormalMatrix(this.object.matrixWorld);const e=this.object.matrixWorld,i=this.geometry.attributes.position,s=this.object.geometry;if(s){const r=s.attributes.position,o=s.attributes.normal;let a=0;for(let l=0,c=r.count;l<c;l++)Ux.fromBufferAttribute(r,l).applyMatrix4(e),Vx.fromBufferAttribute(o,l),Vx.applyMatrix3(qY).normalize().multiplyScalar(this.size).add(Ux),i.setXYZ(a,Ux.x,Ux.y,Ux.z),a=a+1,i.setXYZ(a,Vx.x,Vx.y,Vx.z),a=a+1}i.needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}var j_e=Object.defineProperty,Q_e=Object.getOwnPropertyDescriptor,gy=(n,e,i,s)=>{for(var r=s>1?void 0:s?Q_e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&j_e(e,i,r),r};const mf=te("debugplanetracking");class hu extends Pe{constructor(){super(...arguments),p(this,"dataTemplate"),p(this,"occluder",!0),p(this,"initiateRoomCaptureIfNoData",!0),p(this,"usePlaneData",!0),p(this,"useMeshData",!0),p(this,"runInVR",!0),p(this,"bounds",new Wt),p(this,"center",new E),p(this,"labelOffset",new E),p(this,"_dataId",1),p(this,"_allPlanes",new Map),p(this,"_allMeshes",new Map),p(this,"firstTimeNoPlanesDetected",-100),p(this,"makeOccluder",(e,i,s=!1)=>{if(i){if(i instanceof Array){for(const r of i)this.makeOccluder(e,r,s);return}!s&&!i.name.toLowerCase().includes("occlu")||(i.colorWrite=!1,i.depthTest=!0,i.depthWrite=!0,i.transparent=!1,i.polygonOffset=!0,i.polygonOffsetFactor=1,i.polygonOffsetUnits=.1,e.renderOrder=-1e3)}}),p(this,"_flipForwardMatrix",new he().makeRotationY(Math.PI)),p(this,"_verticesCache",new Map)}get trackedPlanes(){return this._allPlanes.values()}get trackedMeshes(){return this._allMeshes.values()}onBeforeXR(e,i){e==="immersive-vr"&&!this.runInVR||(i.optionalFeatures=i.optionalFeatures||[],this.usePlaneData&&!i.optionalFeatures.includes("plane-detection")&&i.optionalFeatures.push("plane-detection"),this.useMeshData&&!i.optionalFeatures.includes("mesh-detection")&&i.optionalFeatures.push("mesh-detection"))}onEnterXR(e){for(const i of this._allPlanes.keys())this.removeData(i,this._allPlanes);for(const i of this._allMeshes.keys())this.removeData(i,this._allMeshes)}onLeaveXR(e){for(const i of this._allPlanes.keys())this.removeData(i,this._allPlanes);for(const i of this._allMeshes.keys())this.removeData(i,this._allMeshes)}onUpdateXR(e){if(!this.runInVR&&e.xr.isVR)return;const i=e.xr.rig;if(!i){console.warn("No XR rig found, cannot parent tracked planes to it");return}const s=e.xr.frame;if(!this.context.renderer.xr.getReferenceSpace())return;const r=s.detectedPlanes,o=s.detectedMeshes,a=r!==void 0&&r.size>0,l=o!==void 0&&o.size>0;if(this.initiateRoomCaptureIfNoData&&(!a&&!l&&this.firstTimeNoPlanesDetected<-10&&(this.firstTimeNoPlanesDetected=Date.now()),(a||l)&&(this.firstTimeNoPlanesDetected=-1),this.firstTimeNoPlanesDetected>0&&Date.now()-this.firstTimeNoPlanesDetected>2500&&"initiateRoomCapture"in s.session&&(s.session.initiateRoomCapture(),this.firstTimeNoPlanesDetected=-1)),r!==void 0&&this.processFrameData(e.xr,i.gameObject,s,r,this._allPlanes),o!==void 0&&this.processFrameData(e.xr,i.gameObject,s,o,this._allMeshes),mf){const c=this.context.mainCameraComponent.gameObject.worldPosition;for(const h of this._allPlanes.values())!h.mesh||!h.mesh.visible||(this.bounds.makeEmpty(),h.mesh.traverse(u=>{u instanceof pe&&this.bounds.expandByObject(u)}),this.bounds.getCenter(this.center),this.labelOffset.copy(c).sub(this.center).normalize().multiplyScalar(.1),ft.DrawLabel(this.center.add(this.labelOffset),(h.xrData.semanticLabel||"plane").toUpperCase()+`
`+h.xrData.lastChangedTime.toFixed(2),.02))}}removeData(e,i){const s=i.get(e);if(!s)return;i.delete(e),mf&&console.log("Plane no longer tracked, id="+s.id),s.mesh&&(s.mesh.removeFromParent(),s.mesh.traverse(o=>{const a=o.userData.normalsHelper;a?(a.dispose(),a.removeFromParent()):mf&&console.warn("No normals helper found for mesh",s.mesh)}),ia(s.mesh,!0,!0));const r=new CustomEvent("plane-tracking",{detail:{type:"plane-removed",context:s}});this.dispatchEvent(r)}processFrameData(e,i,s,r,o){const a=this.context.renderer.xr.getReferenceSpace();if(a){for(const l of o.keys())r.has(l)||this.removeData(l,o);for(const l of r){const c="planeSpace"in l?l.planeSpace:"meshSpace"in l?l.meshSpace:void 0;if(!c)continue;const h=s.getPose(c,a);let u;if(o.has(l)){const d=o.get(l);if(u=d.mesh,d.timestamp<l.lastChangedTime){if(d.timestamp=l.lastChangedTime,d.mesh){const f=this.createGeometry(l);if(d.mesh instanceof pe)d.mesh.geometry.dispose(),d.mesh.geometry=f,this.makeOccluder(d.mesh,d.mesh.material);else if(d.mesh instanceof Vn)for(const g of d.mesh.children)g instanceof pe&&(g.geometry.dispose(),g.geometry=f,this.makeOccluder(g,g.material));if(d.collider){const g=d.mesh;d.collider.sharedMesh=g,d.collider.convex=this.checkIfContextShouldBeConvex(g,d.xrData),d.collider.onDisable(),d.collider.onEnable()}mf&&(console.log("Plane updated, id="+d.id,d),d.mesh.traverse(g=>{if(!(g instanceof pe))return;const y=g.userData.normalsHelper;y&&y.update()}))}const m=new CustomEvent("plane-tracking",{detail:{type:"plane-updated",context:d}});this.dispatchEvent(m)}}else{if(!this.dataTemplate){const d=new pe;mf?d.material=new Xw:this.occluder?(d.material=new Qt,this.makeOccluder(d,d.material,!0)):d.material=new Qt({wireframe:!0,opacity:.5,transparent:!0,color:3355443}),this.dataTemplate=new ei("","",d)}if(!this.dataTemplate.asset)this.dataTemplate.loadAssetAsync();else{const d=ie.instantiate(this.dataTemplate.asset);if(d.name="xr-tracked-plane",u=d,lL(d,!1),d instanceof pe)Zi(d.geometry),d.geometry=this.createGeometry(l),this.makeOccluder(d,d.material,this.occluder);else if(d instanceof Vn)for(const g of d.children)g instanceof pe&&(Zi(g.geometry),g.geometry=this.createGeometry(l),this.makeOccluder(g,g.material,this.occluder));const m=d.getComponent(Nm);if(m){const g=d;m.sharedMesh=g,m.convex=this.checkIfContextShouldBeConvex(g,l),m.onDisable(),m.onEnable()}d.matrixAutoUpdate=!1,d.matrixWorldNeedsUpdate=!0,i.add(d);const f={id:this._dataId++,xrData:l,timestamp:l.lastChangedTime,mesh:d,collider:m};o.set(l,f),mf&&console.log("New plane detected, id="+f.id,f,{hasCollider:!!m,isGroup:d instanceof Vn});try{const g=new CustomEvent("plane-tracking",{detail:{type:"plane-added",context:f}});this.dispatchEvent(g)}catch(g){console.error(g)}}}u&&(h?(u.visible=!0,u.matrix.fromArray(h.transform.matrix),u.matrix.premultiply(this._flipForwardMatrix)):u.visible=!1,mf&&u.traverse(d=>{if(d instanceof pe)if(d.userData.normalsHelper)d.userData.normalsHelper.update();else{const m=new H_e(d,.05,255);m.layers.disableAll(),m.layers.set(2),this.context.scene.add(m),d.userData.normalsHelper=m}}))}}}checkIfContextShouldBeConvex(e,i){if(!e)return!0;if(e){const s=new Wt;s.expandByObject(e);const r=new E;s.getSize(r);let o=!0;return r.x>2&&r.y>2&&r.z>1.5&&(o=!1),o&&"semanticLabel"in i&&i.semanticLabel==="wall"&&(o=!0),o}return!0}createGeometry(e){return"polygon"in e?this.createPlaneGeometry(e.polygon):"vertices"in e&&"indices"in e?this.createMeshGeometry(e.vertices,e.indices):new dt}createMeshGeometry(e,i){const s=e.toString()+"_"+i.toString();if(this._verticesCache.has(s))return this._verticesCache.get(s);const r=new dt;r.setIndex(new qe(i,1)),r.setAttribute("position",new qe(e,3));const o=Array();for(let a=0;a<e.length;a+=3)o.push(e[a],e[a+2]);return r.setAttribute("uv",new qe(e,3)),r.computeVertexNormals(),this._verticesCache.set(s,r),r}createPlaneGeometry(e){const i=new dt,s=[],r=[];e.forEach(m=>{s.push(m.x,m.y,m.z),r.push(m.x,m.z)});const o=new E(s[0],s[1],s[2]),a=new E(s[3],s[4],s[5]),l=new E(s[6],s[7],s[8]),c=new E,h=new E;c.subVectors(a,o),h.subVectors(l,o),c.cross(h),c.normalize();const u=[];for(let m=0;m<s.length/3;m++)u.push(c.x,c.y,c.z);const d=[];for(let m=2;m<e.length;++m)d.push(0,m-1,m);return i.setAttribute("position",new qe(new Float32Array(s),3)),i.setAttribute("uv",new qe(new Float32Array(r),2)),i.setAttribute("normal",new qe(new Float32Array(u),3)),i.setIndex(d),i.computeBoundingBox(),i.computeBoundingSphere(),i}}gy([T(ei)],hu.prototype,"dataTemplate",2),gy([T()],hu.prototype,"occluder",2),gy([T()],hu.prototype,"initiateRoomCaptureIfNoData",2),gy([T()],hu.prototype,"usePlaneData",2),gy([T()],hu.prototype,"useMeshData",2),gy([T()],hu.prototype,"runInVR",2);var Z_e=Object.defineProperty,Y_e=Object.getOwnPropertyDescriptor,yy=(n,e,i,s)=>{for(var r=s>1?void 0:s?Y_e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&Z_e(e,i,r),r};class uu extends Pe{constructor(){super(...arguments),p(this,"side","none"),p(this,"controller",!0),p(this,"hands",!1),p(this,"controlVisibility",!0),p(this,"useGripSpace",!1),p(this,"resetTransformAfterXRSession",!0),p(this,"_startPosition",new E),p(this,"_startRotation",new Se),p(this,"_startScale",new E)}get activeAndEnabled(){return!0}onEnterXR(e){this._startPosition.copy(this.gameObject.position),this._startRotation.copy(this.gameObject.quaternion),this._startScale.copy(this.gameObject.scale)}onUpdateXR(e){const i=e.xr.getController(this.side);if(i){if(i.hand&&!this.hands){this.controlVisibility&&(this.gameObject.visible=!1);return}else if(!this.controller){this.controlVisibility&&(this.gameObject.visible=!1);return}this.controlVisibility&&(this.gameObject.visible=!0),this.useGripSpace||i.targetRayMode==="transient-pointer"?(this.gameObject.worldPosition=i.gripWorldPosition,this.gameObject.worldQuaternion=i.gripWorldQuaternion,this.gameObject.worldScale=mt(i.xr.rigScale,i.xr.rigScale,i.xr.rigScale).multiply(this._startScale)):(this.gameObject.worldPosition=i.rayWorldPosition,this.gameObject.worldQuaternion=i.rayWorldQuaternion,this.gameObject.worldScale=mt(i.xr.rigScale,i.xr.rigScale,i.xr.rigScale).multiply(this._startScale))}}onLeaveXR(e){this.resetTransformAfterXRSession&&(this.gameObject.position.copy(this._startPosition),this.gameObject.quaternion.copy(this._startRotation),this.gameObject.scale.copy(this._startScale))}}yy([T()],uu.prototype,"side",2),yy([T()],uu.prototype,"controller",2),yy([T()],uu.prototype,"hands",2),yy([T()],uu.prototype,"controlVisibility",2),yy([T()],uu.prototype,"useGripSpace",2),yy([T()],uu.prototype,"resetTransformAfterXRSession",2);var K_e=Object.defineProperty,J_e=Object.getOwnPropertyDescriptor,q_e=(n,e,i,s)=>{for(var r=s>1?void 0:s?J_e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&K_e(e,i,r),r};const $Y=te("debugwebxr");class DE extends Pe{constructor(){super(...arguments),p(this,"priority",0),p(this,"_startScale")}get isActive(){return this.activeAndEnabled&&this.gameObject.visible}setAsActiveXRRig(){var e;(e=Et.active)==null||e.setRigActive(this)}awake(){if($Y){const e=new ye;e.position.y+=.5,this.gameObject.add(e);const i=e.addNewComponent(Um);i&&(i.isGizmo=!1);const s=new io(.5);this.gameObject.add(s)}}isXRRig(){return!0}supportsXR(e){return!0}onEnterXR(e){this._startScale=this.gameObject.scale.clone(),e.xr.addRig(this),$Y&&console.log("WebXR: add Rig",this.name,this.priority)}onLeaveXR(e){e.xr.removeRig(this),this._startScale&&this.gameObject&&this.gameObject.scale.copy(this._startScale)}}q_e([T()],DE.prototype,"priority",2);class EG{}const $_e=Object.freeze(Object.defineProperty({__proto__:null,ActionBuilder:bi,ActionCollection:Yk,ActionModel:na,AlignmentConstraint:mA,Animation:Fr,AnimationCurve:km,AnimationExtension:yA,AnimationTrackHandler:cM,Animator:rr,AnimatorController:Sa,Antialiasing:PA,AudioExtension:mp,AudioListener:Pd,AudioSource:Sn,AudioTrackHandler:RA,Avatar:Dd,AvatarBlink_Simple:zm,AvatarEyeLook_Rotation:B0,AvatarLoader:ED,AvatarMarker:lr,AvatarModel:pM,Avatar_Brain_LookAt:GA,Avatar_MouthShapes:NA,Avatar_MustacheShake:SD,Avatar_POI:Ic,AxesHelper:k0,BaseUIComponent:cl,BasicIKConstraint:RD,BehaviorExtension:fM,BehaviorModel:Gs,BloomEffect:Fm,BoxCollider:O0,BoxGizmo:Um,BoxHelperComponent:Ja,Button:$h,CallInfo:Cc,Camera:Fi,CameraTargetReachedEvent:SA,Canvas:cr,CanvasGroup:Nd,CapsuleCollider:qh,ChangeMaterialOnClick:F0,ChangeTransformOnClick:Wm,CharacterController:Qm,CharacterControllerInput:tu,ChromaticAberration:YA,Collider:ha,ColorAdjustments:Xd,ColorBySpeedModule:Ym,ColorOverLifetimeModule:nx,ContactShadows:Xl,ControlTrackHandler:hM,CustomBranding:Jd,Deletable:yO,DeleteBox:hx,DepthOfField:Wl,DeviceFlag:KM,DocumentExtension:vO,DragControls:Oo,DropListener:$d,Duplicatable:tf,EffectWrapper:px,EmissionModule:zc,EmphasizeOnClick:U0,EventList:en,EventListEvent:$C,EventSystem:Ya,EventTrigger:qM,FieldWithDefault:tO,FixedJoint:MO,FlyControls:EO,Fog:ey,GltfExport:yx,GltfExportBox:BO,Gradient:Wd,Graphic:Vm,GraphicRaycaster:iM,GridHelper:ny,GridLayoutGroup:UD,GroundProjectedEnv:wc,GroupActionModel:Hh,HideOnStart:WD,HingeJoint:mx,HorizontalLayoutGroup:ND,Image:z0,InheritVelocityModule:jd,InputField:nf,InstanceHandle:KA,InstancingHandler:Q0,Interactable:gO,Keyframe:fo,LODGroup:bx,LODModel:sf,Light:Go,LimitVelocityOverLifetimeModule:as,LogStats:GO,LookAt:rf,LookAtConstraint:Dm,MainModule:ur,MaskableGraphic:HA,MeshCollider:Nm,MeshRenderer:$A,MinMaxCurve:gt,MinMaxGradient:vo,NeedleMenu:Nc,NestedGltf:rE,Networking:ry,NoiseModule:Pi,ObjectRaycaster:ra,OffsetConstraint:of,OpenURL:oy,OrbitControls:Ei,Outline:G0,Padding:zd,ParticleBurst:ix,ParticleSubEmitter:xE,ParticleSystem:cs,ParticleSystemRenderer:el,PhysicsExtension:HM,PixelationEffect:Rx,PlayAnimationOnClick:jm,PlayAudioOnClick:Ud,PlayableDirector:kd,PlayerColor:Wy,PointerEventData:Uy,PostProcessingHandler:wE,PreliminaryAction:V0,PreliminaryTrigger:QA,RawImage:bM,Rect:OD,RectTransform:Ur,ReflectionProbe:W0,RegisteredAnimationInfo:YC,RemoteSkybox:Yc,Renderer:kn,RendererLightmap:JA,Rigidbody:Li,RotationBySpeedModule:ma,RotationOverLifetimeModule:qa,SceneSwitcher:Cs,ScreenCapture:sp,ScreenSpaceAmbientOcclusion:cu,ScreenSpaceAmbientOcclusionN8:Hl,SetActiveOnClick:Hm,ShadowCatcher:Dx,ShapeModule:Tn,SharpeningEffect:Lx,SignalAsset:MA,SignalReceiver:I0,SignalReceiverEvent:R0,SignalTrackHandler:IA,Size:DD,SizeBySpeedModule:bo,SizeOverLifetimeModule:Hd,SkinnedMeshRenderer:iO,SmoothFollow:rp,SpatialGrabRaycaster:E0,SpatialHtml:Ox,SpatialTrigger:Fx,SpatialTriggerReceiver:Kc,SpectatorCamera:EE,SphereCollider:D0,Sprite:Fc,SpriteData:ou,SpriteRenderer:Do,SpriteSheet:Qd,SubEmitterSystem:Tx,SyncedCamera:RE,SyncedRoom:jl,SyncedTransform:Sc,TapGestureTrigger:HD,TeleportTarget:XM,TestRunner:wG,TestSimulateUserData:_G,Text:Vr,TextBuilder:jM,TextExtension:ax,TextureSheetAnimationModule:dr,TiltShiftEffect:Jc,ToneMappingEffect:Vd,TrailModule:xn,TransformData:Ns,TransformGizmo:uf,TriggerBuilder:zs,TriggerModel:wd,UIRaycastUtils:nM,UIRootComponent:wA,USDZExporter:Gn,USDZText:Kd,USDZUIExtension:QM,UsageMarker:cx,VariantAction:Zk,VelocityOverLifetimeModule:Rn,VerticalLayoutGroup:FD,VideoPlayer:Ms,Vignette:df,VisibilityAction:ZA,Voip:Od,Volume:py,VolumeParameter:Je,VolumeProfile:LA,WebARCameraBackground:kE,WebARSessionRoot:au,WebXR:On,WebXRImageTracking:fy,WebXRImageTrackingModel:qc,WebXRPlaneTracking:hu,WebXRTrackedImage:my,XRControllerFollow:uu,XRControllerModel:Vc,XRControllerMovement:fa,XRFlag:ca,XRRig:DE,XRState:yo,__Ignore:EG},Symbol.toStringTag,{value:"Module"}));class eSe extends Pe{constructor(){super(...arguments),p(this,"toggleKey","KeyP")}update(){this.context.input.isKeyDown(this.toggleKey)&&this.context.domElement.classList.toggle("presentation-mode")}}Z.add("__Ignore",EG),Z.add("ActionBuilder",bi),Z.add("ActionCollection",Yk),Z.add("ActionModel",na),Z.add("AlignmentConstraint",mA),Z.add("Animation",Fr),Z.add("AnimationCurve",km),Z.add("AnimationExtension",yA),Z.add("AnimationTrackHandler",cM),Z.add("Animator",rr),Z.add("AnimatorController",Sa),Z.add("Antialiasing",PA),Z.add("AudioExtension",mp),Z.add("AudioListener",Pd),Z.add("AudioSource",Sn),Z.add("AudioTrackHandler",RA),Z.add("Avatar",Dd),Z.add("Avatar_Brain_LookAt",GA),Z.add("Avatar_MouthShapes",NA),Z.add("Avatar_MustacheShake",SD),Z.add("Avatar_POI",Ic),Z.add("AvatarBlink_Simple",zm),Z.add("AvatarEyeLook_Rotation",B0),Z.add("AvatarLoader",ED),Z.add("AvatarMarker",lr),Z.add("AvatarModel",pM),Z.add("AxesHelper",k0),Z.add("BaseUIComponent",cl),Z.add("BasicIKConstraint",RD),Z.add("BehaviorExtension",fM),Z.add("BehaviorModel",Gs),Z.add("BloomEffect",Fm),Z.add("BoxCollider",O0),Z.add("BoxGizmo",Um),Z.add("BoxHelperComponent",Ja),Z.add("Button",$h),Z.add("CallInfo",Cc),Z.add("Camera",Fi),Z.add("CameraTargetReachedEvent",SA),Z.add("Canvas",cr),Z.add("CanvasGroup",Nd),Z.add("CapsuleCollider",qh),Z.add("ChangeMaterialOnClick",F0),Z.add("ChangeTransformOnClick",Wm),Z.add("CharacterController",Qm),Z.add("CharacterControllerInput",tu),Z.add("ChromaticAberration",YA),Z.add("Collider",ha),Z.add("ColorAdjustments",Xd),Z.add("ColorBySpeedModule",Ym),Z.add("ColorOverLifetimeModule",nx),Z.add("ContactShadows",Xl),Z.add("ControlTrackHandler",hM),Z.add("CustomBranding",Jd),Z.add("Deletable",yO),Z.add("DeleteBox",hx),Z.add("DepthOfField",Wl),Z.add("DeviceFlag",KM),Z.add("DocumentExtension",vO),Z.add("DragControls",Oo),Z.add("DropListener",$d),Z.add("Duplicatable",tf),Z.add("EffectWrapper",px),Z.add("EmissionModule",zc),Z.add("EmphasizeOnClick",U0),Z.add("EventList",en),Z.add("EventListEvent",$C),Z.add("EventSystem",Ya),Z.add("EventTrigger",qM),Z.add("FieldWithDefault",tO),Z.add("FixedJoint",MO),Z.add("FlyControls",EO),Z.add("Fog",ey),Z.add("GltfExport",yx),Z.add("GltfExportBox",BO),Z.add("Gradient",Wd),Z.add("Graphic",Vm),Z.add("GraphicRaycaster",iM),Z.add("GridHelper",ny),Z.add("GridLayoutGroup",UD),Z.add("GroundProjectedEnv",wc),Z.add("GroupActionModel",Hh),Z.add("HideOnStart",WD),Z.add("HingeJoint",mx),Z.add("HorizontalLayoutGroup",ND),Z.add("Image",z0),Z.add("InheritVelocityModule",jd),Z.add("InputField",nf),Z.add("InstanceHandle",KA),Z.add("InstancingHandler",Q0),Z.add("Interactable",gO),Z.add("Keyframe",fo),Z.add("Light",Go),Z.add("LimitVelocityOverLifetimeModule",as),Z.add("LODGroup",bx),Z.add("LODModel",sf),Z.add("LogStats",GO),Z.add("LookAt",rf),Z.add("LookAtConstraint",Dm),Z.add("MainModule",ur),Z.add("MaskableGraphic",HA),Z.add("MeshCollider",Nm),Z.add("MeshRenderer",$A),Z.add("MinMaxCurve",gt),Z.add("MinMaxGradient",vo),Z.add("NeedleMenu",Nc),Z.add("NestedGltf",rE),Z.add("Networking",ry),Z.add("NoiseModule",Pi),Z.add("ObjectRaycaster",ra),Z.add("OffsetConstraint",of),Z.add("OpenURL",oy),Z.add("OrbitControls",Ei),Z.add("Outline",G0),Z.add("Padding",zd),Z.add("ParticleBurst",ix),Z.add("ParticleSubEmitter",xE),Z.add("ParticleSystem",cs),Z.add("ParticleSystemRenderer",el),Z.add("PhysicsExtension",HM),Z.add("PixelationEffect",Rx),Z.add("PlayableDirector",kd),Z.add("PlayAnimationOnClick",jm),Z.add("PlayAudioOnClick",Ud),Z.add("PlayerColor",Wy),Z.add("PlayerState",la),Z.add("PlayerSync",L0),Z.add("PointerEventData",Uy),Z.add("PostProcessingHandler",wE),Z.add("PreliminaryAction",V0),Z.add("PreliminaryTrigger",QA),Z.add("PresentationMode",eSe),Z.add("RawImage",bM),Z.add("Rect",OD),Z.add("RectTransform",Ur),Z.add("ReflectionProbe",W0),Z.add("RegisteredAnimationInfo",YC),Z.add("RemoteSkybox",Yc),Z.add("Renderer",kn),Z.add("RendererLightmap",JA),Z.add("Rigidbody",Li),Z.add("RotationBySpeedModule",ma),Z.add("RotationOverLifetimeModule",qa),Z.add("SceneSwitcher",Cs),Z.add("ScreenCapture",sp),Z.add("ScreenSpaceAmbientOcclusion",cu),Z.add("ScreenSpaceAmbientOcclusionN8",Hl),Z.add("SetActiveOnClick",Hm),Z.add("ShadowCatcher",Dx),Z.add("ShapeModule",Tn),Z.add("SharpeningEffect",Lx),Z.add("SignalAsset",MA),Z.add("SignalReceiver",I0),Z.add("SignalReceiverEvent",R0),Z.add("SignalTrackHandler",IA),Z.add("Size",DD),Z.add("SizeBySpeedModule",bo),Z.add("SizeOverLifetimeModule",Hd),Z.add("SkinnedMeshRenderer",iO),Z.add("SmoothFollow",rp),Z.add("SpatialGrabRaycaster",E0),Z.add("SpatialHtml",Ox),Z.add("SpatialTrigger",Fx),Z.add("SpatialTriggerReceiver",Kc),Z.add("SpectatorCamera",EE),Z.add("SphereCollider",D0),Z.add("Sprite",Fc),Z.add("SpriteData",ou),Z.add("SpriteRenderer",Do),Z.add("SpriteSheet",Qd),Z.add("SubEmitterSystem",Tx),Z.add("SyncedCamera",RE),Z.add("SyncedRoom",jl),Z.add("SyncedTransform",Sc),Z.add("TapGestureTrigger",HD),Z.add("TeleportTarget",XM),Z.add("TestRunner",wG),Z.add("TestSimulateUserData",_G),Z.add("Text",Vr),Z.add("TextBuilder",jM),Z.add("TextExtension",ax),Z.add("TextureSheetAnimationModule",dr),Z.add("TiltShiftEffect",Jc),Z.add("ToneMappingEffect",Vd),Z.add("TrailModule",xn),Z.add("TransformData",Ns),Z.add("TransformGizmo",uf),Z.add("TriggerBuilder",zs),Z.add("TriggerModel",wd),Z.add("UIRaycastUtils",nM),Z.add("UIRootComponent",wA),Z.add("UsageMarker",cx),Z.add("USDZExporter",Gn),Z.add("USDZText",Kd),Z.add("USDZUIExtension",QM),Z.add("VariantAction",Zk),Z.add("VelocityOverLifetimeModule",Rn),Z.add("VerticalLayoutGroup",FD),Z.add("VideoPlayer",Ms),Z.add("Vignette",df),Z.add("VisibilityAction",ZA),Z.add("Voip",Od),Z.add("Volume",py),Z.add("VolumeParameter",Je),Z.add("VolumeProfile",LA),Z.add("WebARCameraBackground",kE),Z.add("WebARSessionRoot",au),Z.add("WebXR",On),Z.add("WebXRImageTracking",fy),Z.add("WebXRImageTrackingModel",qc),Z.add("WebXRPlaneTracking",hu),Z.add("WebXRTrackedImage",my),Z.add("XRControllerFollow",uu),Z.add("XRControllerModel",Vc),Z.add("XRControllerMovement",fa),Z.add("XRFlag",ca),Z.add("XRRig",DE),Z.add("XRState",yo);const Xx=Os,tSe=te("debugtypestore");tSe&&console.log(Z);function iSe(n,e){const i=z9(n,e);return i!==void 0?i:null}const nSe=new Nme,TG=Symbol("deserialize-queue");async function sSe(n,e,i,s=null,r){if(!i)return;let o=s;typeof o=="number"&&(o=new Es(s));const a=e.indexOf("?");e=a===-1?e:e.substring(0,a);const l=new jB(i.scene);l.gltfId=e,l.context=n,l.gltf=i,l.nodeToObject=r?.nodeToObjectMap,l.implementationInformation=nSe;let c=n[TG];if(c||(c=n[TG]=[]),i.scenes)for(const h of i.scenes)await LG(l,h,c);if(i.children)for(const h of i.children)await LG(l,h,c);n.new_scripts_pre_setup_callbacks.push(()=>{const h=n[TG];if(h){for(const u of h)rSe(u,l);h.length=0}if(o){const u={},d=[];IG(i,o,u,d);for(const m of i.scenes)IG(m,o,u,d);for(const m of d)m.resolveGuids(u)}})}const RG=Symbol("original-component-name"),vy=new Map;function IG(n,e,i,s){if(e===null||!n)return;const r=n.guid,o=n.guid;o!=null&&o.length&&(vy.has(o)||(Xx&&console.log('Creating InstanceIdProvider with key "'+o+'" for object '+n.name),vy.set(o,new Es(o))));const a=o&&vy.get(o)||e;if(n.guid=a.generateUUID(),r&&r!=="invalid"&&(i[r]=n.guid),n&&n.userData&&n.userData.components)for(const l of n.userData.components){if(l===null)continue;const c=l.guid;c?vy.has(c)||(Xx&&console.log('Creating InstanceIdProvider with key "'+c+'" for component '+l[RG]),vy.set(c,new Es(c))):Xx&&console.warn("Can not create IdProvider: component "+l[RG]+" has no guid",l.guid);const h=vy.get(c)||e,u=l.guid;l.guid=h.generateUUID(),u&&u!=="invalid"&&(i[u]=l.guid),l.resolveGuids&&s.push(l)}if(n.children)for(const l of n.children)IG(l,e,i,s)}const Wx=[];async function LG(n,e,i,s){if(!e)return;const r=e.userData;if(r){const o=r.builtin_components;if(o&&o.length>0)for(const a of o)try{if(a===null)continue;const l=Z.get(a.name);if(l!=null){const c=new l;c.sourceId=n.gltfId,a0(c,a,n.implementationInformation),c.context=n.context,"guid"in a&&(c[Qv]=a.guid),c[RG]=a.name,Cm(e,c,!1),i.push({instance:c,compData:a,obj:e}),c.isCamera&&n.context&&n.context.mainCamera===null&&c.tag==="MainCamera"&&n.context.setCurrentCamera(c)}else Xx&&console.debug("unknown component: "+a.name),Wx.includes(a.name)||Wx.push(a.name)}catch(l){console.error(a.name+" - "+l.message,l)}if(Wx.length>0){const a=Wx.join(", ");console.warn("unknown components: "+a),Wx.length=0,no()&&gn(`<strong>Unknown components in scene</strong>:

${a}

This could mean you forgot to add a npmdef to your ExportInfo
<a href="https://engine.needle.tools/docs/project_structure.html#creating-and-installing-a-npmdef" target="_blank">documentation</a>`,Zo.Warn)}}if(e.children)for(const o of e.children)await LG(n,o,i)}function rSe(n,e){const{instance:i,compData:s,obj:r}=n;e.object=r,e.target=i,$S(i,s,e),Xx&&console.debug("add "+s.name,s,i)}const OE=te("debugfileformat");async function eK(n,e=!0){var i;if(e){const r=n,o=new URL(r,globalThis.location.origin);let a=null;const l=o.searchParams.get("filetype");switch(l&&(a=l.toUpperCase()),a!=null&&a.length||(a=(i=o.pathname.split(".").pop())==null?void 0:i.toUpperCase()),OE&&console.debug("Use file extension to determine type: "+a),a){case"GLTF":return"gltf";case"VRM":return"vrm";case"GLB":return"glb";case"FBX":return"fbx";case"USD":return"usd";case"USDA":return"usda";case"USDZ":return"usdz";case"OBJ":return"obj"}}const s=await fetch(n,{method:"GET",headers:{range:"bytes=0-32"}}).catch(r=>null);if(s!=null&&s.ok){const r=await s.arrayBuffer(),o=tK(r);return OE&&console.log("Determined file type from header: "+o),o}return"unknown"}function tK(n){if(n.byteLength<4)return"unknown";const e=new Uint8Array(n);if(OE&&console.warn(`Trying to determine file type from binary data
`,'"'+new TextDecoder().decode(n)+`"
`,e),e[0]==103&&e[1]==108&&e[2]==84&&e[3]==70)return console.debug("GLTF detected"),"glb";if(e[0]==80&&e[1]==75&&e[2]==3&&e[3]==4)return console.debug("USDZ detected"),"usdz";if(e[0]==80&&e[1]==88&&e[2]==82&&e[3]==45&&e[4]==85&&e[5]==83&&e[6]==68&&e[7]==67)return console.debug("Binary USD detected"),"usd";if(e[0]==35&&e[1]==117&&e[2]==115&&e[3]==100&&e[4]==97)return console.debug("ASCII USD detected"),"usda";if(e[0]==75&&e[1]==97&&e[2]==121&&e[3]==100&&e[4]==97&&e[5]==114&&e[6]==97&&e[7]==32)return console.debug("Binary FBX detected"),"fbx";if(e[0]==59&&e[1]==32&&e[2]==70&&e[3]==66&&e[4]==88&&e[5]==32)return console.debug("ASCII FBX detected"),"fbx";if(e[0]==35&&e[1]==32&&e[2]==66&&e[3]==108&&e[4]==101&&e[5]==110&&e[6]==100&&e[7]==101&&e[8]==114&&e[9]==32||e[0]==35&&e[1]==32&&e[2]==65&&e[3]==108&&e[4]==105&&e[5]==97&&e[6]==115&&e[7]==32&&e[8]==79&&e[9]==66&&e[10]==74)return console.debug("OBJ detected"),"obj";if(e[0]==118&&e[1]==32||e[0]==102&&e[1]==32)return console.debug("OBJ detected (the file has no header and starts with vertex or face)"),"obj";if(e[0]==35&&e[1]==32&&e[2]==70&&e[3]==105&&e[4]==108&&e[5]==101&&e[6]==32&&e[7]==101&&e[8]==120&&e[9]==112&&e[10]==111&&e[11]==114&&e[12]==116&&e[13]==101&&e[14]==100&&e[15]==32&&e[16]==98&&e[17]==121&&e[18]==32&&e[19]==90&&e[20]==66&&e[21]==114&&e[22]==117&&e[23]==115&&e[24]==104)return console.debug("OBJ detected (exported by ZBrush)"),"obj";if(Ye()||OE){const i=new TextDecoder().decode(n.slice(0,16));console.debug('Could not determine file type from binary data: "'+i+'..."',e)}else console.debug("Could not determine file type from binary data",e);return"unknown"}class PG{createBuiltinComponents(e,i,s,r,o){return sSe(e,i,s,r,o)}writeBuiltinComponentData(e,i){return iSe(e,i)}parseSync(e,i,s,r){return oK(e,i,s,r)}loadSync(e,i,s,r,o){return kG(e,i,s,r,o)}}aI(PG);const iK=te("printGltf")||te("printgltf"),nK=te("downloadgltf"),oSe=te("debugfileformat");var sK=(n=>(n[n.BeforeLoad=0]="BeforeLoad",n[n.AfterLoaded=1]="AfterLoaded",n[n.FinishedSetup=10]="FinishedSetup",n))(sK||{});class ff{constructor(e,i,s,r){p(this,"context"),p(this,"loader"),p(this,"path"),p(this,"gltf"),this.context=e,this.path=i,this.loader=s,this.gltf=r}}const ap={};function aSe(n,e){ap[n]=ap[n]||[],ap[n].push(e)}function lSe(n,e){if(ap[n]){const i=ap[n].indexOf(e);i>=0&&ap[n].splice(i,1)}}function by(n,e){if(ap[n])for(const i of ap[n])i(e)}async function rK(n,e,i,s,r){iK&&console.warn("glTF",e,i),e.includes("?")&&(e=e.split("?")[0]),await yl().createBuiltinComponents(n,e,i,s,r)}async function BG(n,e){const i=await eK(n)||"unknown";switch(oSe&&console.debug("Determined file type: "+i+" for url",n),i){case"unknown":return console.warn("Unknown file type. Assuming glTF:",n),new Fh;case"fbx":return new uj;case"obj":return new zk;case"usd":case"usda":case"usdz":return console.warn("USD files are not supported."),null;default:console.warn("Unknown file type:",i);case"gltf":case"glb":case"vrm":const s=new Fh;return await qD(s,e,n),s}}async function oK(n,e,i,s){typeof i!="string"&&(console.warn("Parse gltf binary without path, this might lead to errors in resolving extensions. Please provide the source path of the gltf/glb file",i,typeof i),i=""),iK&&console.log("Parse glTF",i);const r=await BG(i,n);if(!r)return;if(r instanceof zk){typeof e!="string"&&(e=new TextDecoder().decode(e));const a=r.parse(e);return{animations:a.animations,scene:a,scenes:[a]}}if(!(r instanceof Fh)){const a=r.parse(e,i);return cK(r,a),{animations:a.animations,scene:a,scenes:[a]}}const o=JD(r);return new Promise((a,l)=>{try{let c=i.split("?")[0].trimEnd();if(c.endsWith(".glb")||c.endsWith(".gltf")){const u=c.split("/");u.pop(),c=u.join("/"),c.endsWith("/")||(c+="/")}r.resourcePath=c,GC(r,n),by(0,new ff(n,i,r));const h=n.mainCamera;r.parse(e,"",async u=>{eO(i,u,n),by(1,new ff(n,i,r,u)),await rK(n,i,u,s,o),await aK(u.scene,n,h),by(10,new ff(n,i,r,u)),a(u),nK&&lK(e)},u=>{console.error('Loading asset at "'+i+`" failed
`,u),a(void 0)})}catch(c){console.error(c),l(c)}})}async function kG(n,e,i,s,r){cSe(e);const o=await BG(e,n);if(!o)return;if(!(o instanceof Fh)){const l=await o.loadAsync(e,r);return cK(o,l),{animations:l.animations,scene:l,scenes:[l]}}const a=JD(o);return new Promise((l,c)=>{try{GC(o,n),by(0,new ff(n,e,o));const h=n.mainCamera;o.load(e,async u=>{eO(e,u,n),by(1,new ff(n,e,o,u)),await rK(n,i,u,s,a),await aK(u.scene,n,h),by(10,new ff(n,e,o,u)),l(u),nK&&lK(e)},u=>{r?.call(o,u)},u=>{console.error('Loading asset at "'+e+`" failed
`,u),l(void 0)})}catch(h){console.error(h),c(h)}})}async function aK(n,e,i){i||(i=e.mainCamera);try{i?await e.renderer.compileAsync(n,i,e.scene).catch(s=>{console.warn(s.message)}):mme(n,e)}catch(s){console.warn(s?.message||s)}}function cSe(n){if(new URL(n,window.location.href).href.startsWith("file://")){const e=`Hi - it looks like you are trying to load a local file which will not work. You need to use a webserver to serve your files.
Please refer to the documentation on <a href="https://fwd.needle.tools/needle-engine/docs/local-server">https://docs.needle.tools</a> or ask for help in our <a href="https://discord.needle.tools">discord community</a>`;gn(e),console.warn(e)}}function lK(n){if(typeof n=="string"){const e=document.createElement("a");e.href=n,e.download=n.split("/").pop(),e.click()}else{const e=new Blob([n],{type:"application/octet-stream"}),i=window.URL.createObjectURL(e),s=document.createElement("a");s.href=i,s.download="download.glb",s.click()}}function cK(n,e){if(e!=null&&e.isObject3D){const i=e;n instanceof uj?i.traverse(s=>{const r=s;r!=null&&r.isMesh&&cL(r,r.material)}):n instanceof zk&&i.traverse(s=>{})}}aI(PG);const zn=te("debugwebcomponent"),hK="needle-engine",uK="vr",dK="desktop",hSe=[oj,uK,dK],Hx="ar-session-active",jx="desktop-session-active",uSe=["hash","src","camera-controls","loadstart","progress","loadfinished","dracoDecoderPath","dracoDecoderType","ktx2DecoderPath","tone-mapping","tone-mapping-exposure","background-blurriness","background-color"];class DG extends HTMLElement{constructor(){super(),p(this,"_context"),p(this,"_overlay_ar"),p(this,"_loadingProgress01",0),p(this,"_loadingView"),p(this,"_previousSrc",null),p(this,"_didFullyLoad",!1),p(this,"_loadId",0),p(this,"_abortController",null),p(this,"_lastSourceFiles",null),p(this,"_createContextPromise",null),p(this,"onXRSessionStarted",()=>{var i;const s=this.context.xrSessionMode;s==="immersive-ar"?this.onEnterAR(this.context.xrSession):s==="immersive-vr"&&this.onEnterVR(this.context.xrSession),(i=this.context.xrSession)==null||i.addEventListener("end",()=>{this.dispatchEvent(new CustomEvent("xr-session-ended",{detail:{session:this.context.xrSession,context:this._context,sessionMode:s}})),s==="immersive-ar"?this.onExitAR(this.context.xrSession):s==="immersive-vr"&&this.onExitVR(this.context.xrSession)})}),p(this,"onReady",()=>{var i;return(i=this._loadingView)==null?void 0:i.onLoadingFinished()}),p(this,"onError",()=>{var i;return(i=this._loadingView)==null?void 0:i.setMessage("Loading failed!")}),p(this,"_previouslyRegisteredMap",new Map),this._overlay_ar=new uge,this.addEventListener("ready",this.onReady),K4(),this.attachShadow({mode:"open"});const e=document.createElement("template");e.innerHTML=`<style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto+Flex:opsz,wght@8..144,100..1000&display=swap');

    :host {
        position: absolute;
        display: block;
        width: max(600px, 100%);
        height: max(300px, 100%);
        touch-action: none;

        -webkit-tap-highlight-color: transparent;
    }

    @media (max-width: 600px) {
        :host {
            width: 100%;
        }
    }
    @media (max-height: 300px) {
        :host {
            height: 100%;
        }
    }
    :host canvas {   
        position: absolute;
        user-select: none;
        -webkit-user-select: none;

        /** allow touch panning but no pinch zoom **/
        /** but this doesnt work yet: 
         * touch-action: pan-x, pan-y;
         **/
        
        -webkit-touch-callout: none;
        -webkit-user-drag: none;
        -webkit-user-modify: none;
    }
    :host .content {
        position: absolute;
        width: 100%;
        height: 100%;
        visibility: visible;
        z-index: 500; /* < must be less than the webxr buttons element */
        pointer-events: none;
    }
    :host .overlay-content {
        position: absolute;
        user-select: auto;
        pointer-events: all;
    }
    :host slot[name="quit-ar"]:hover {
        cursor: pointer;
    }
    :host .quit-ar-button {
        position: absolute;
        // top: env(titlebar-area-y); /** this doesnt work **/
        top: 60px; /** camera access needs a bit more space **/
        right: 20px;
        z-index: 9999;
    }
</style>
<div> <!-- this wrapper is necessary for WebXR https://github.com/meta-quest/immersive-web-emulator/issues/55 -->
    <canvas></canvas>
</div>
<div class="content">
    <slot class="overlay-content"></slot>
</div>
`,this.shadowRoot&&this.shadowRoot.appendChild(e.content.cloneNode(!0)),this._context=new Pt({domElement:this}),this.addEventListener("error",this.onError)}static get observedAttributes(){return uSe}get loadingProgress01(){return this._loadingProgress01}get loadingFinished(){return this.loadingProgress01>.999}get cameraControls(){const e=this.getAttribute("camera-controls");return e==null?null:!(e===null||e==="False"||e==="false"||e==="0")}getContext(){return new Promise((e,i)=>{if(this._context&&this.loadingFinished)e(this._context);else{const s=()=>{this.removeEventListener("loadfinished",s),this._context&&this.loadingFinished&&e(this._context)};this.addEventListener("loadfinished",s)}})}get context(){return this._context}async connectedCallback(){if(zn&&console.log("<needle-engine> connected"),this.addEventListener("xr-session-started",this.onXRSessionStarted),this.onSetupDesktop(),!this.getAttribute("src")){const i=globalThis["needle:codegen_files"];zn&&console.log('src is null, trying to load from globalThis["needle:codegen_files"]',i),i&&(zn&&console.log('globalThis["needle:codegen_files"]',i),this.setAttribute("src",i))}zn&&console.log("src",this.getAttribute("src"));const e=this._loadId;setTimeout(()=>{this.isConnected!==!1&&e===this._loadId&&this.onLoad()},1),xl!=null&&xl.length&&this.setAttribute("version",xl)}disconnectedCallback(){var e;this.removeEventListener("xr-session-started",this.onXRSessionStarted),this._didFullyLoad=!1;const i=this.getAttribute("keep-alive"),s=i==null||i?.length>0&&i!=="true"&&i!=="1";zn&&console.warn('<needle-engine> disconnected, keep-alive: "'+i+'"',typeof i,"Dispose=",s),s?(zn&&console.warn("<needle-engine> dispose"),(e=this._context)==null||e.dispose(),this._context=null,this._lastSourceFiles=null,this._loadId+=1):zn&&console.warn("<needle-engine> is not disposed because keep-alive is set")}attributeChangedCallback(e,i,s){switch(zn&&console.log("attributeChangedCallback",e,i,s),e){case"src":zn&&console.warn(`<needle-engine src>
changed from "`,i,'" to "',s,'"'),this.onLoad();break;case"hash":this._context&&(this._context.hash=s);break;case"loadstart":case"progress":case"loadfinished":typeof s=="string"&&s.length>0&&(zn&&console.log(e+" attribute changed",s),this.registerEventFromAttribute(e,s));break;case"dracoDecoderPath":zn&&console.log("dracoDecoderPath",s),aj(s);break;case"dracoDecoderType":s==="wasm"||s==="js"?(zn&&console.log("dracoDecoderType",s),lj(s)):console.error("Invalid dracoDecoderType",s,"expected js or wasm");break;case"ktx2DecoderPath":zn&&console.log("ktx2DecoderPath",s),cj(s);break;case"tone-mapping":{this.applyAttributes();break}case"tone-mapping-exposure":{this.applyAttributes();break}case"background-blurriness":{const r=parseFloat(s);r!=null&&this._context&&(this._context.scene.backgroundBlurriness=r);break}case"background-color":{this.applyAttributes();break}}}async onLoad(){var e,i;if(!this.isConnected)return;if(this._context||(zn&&console.warn("Create new context"),this._context=new Pt({domElement:this})),!this._context){console.error("Needle Engine: Context not initialized");return}const s=this.getSourceFiles();if(!this.checkIfSourceHasChanged(s,this._lastSourceFiles))return;this._abortController&&(zn&&console.warn("Abort previous loading process"),this._abortController.abort(),this._abortController=null),this._lastSourceFiles=s;const r=++this._loadId;if((s==null||s.length<=0)&&(zn&&console.warn("Clear scene",s),this._context.clear(),r!==this._loadId))return;const o=this.getAttribute("alias");this.classList.add("loading");const a=Wh();this.ensureLoadStartIsRegistered();let l=this.dispatchEvent(new CustomEvent("loadstart",{detail:{context:this._context,alias:o},cancelable:!0}));if(a){const v=this.getAttribute("hide-loading-overlay");v!=null&&v!=="0"&&(l=!1)}l===!1&&!a&&(Ye()||(l=!0),console.warn("Needle Engine: You need a commercial license to override the default loading view. Visit https://needle.tools/pricing"),Ye()&&zi('You need a <a target="_blank" href="https://needle.tools/pricing">commercial license</a> to override the default loading view. This will not work in production.')),!this._loadingView&&l&&(this._loadingView=new Pk(this)),l&&(this._didFullyLoad!==!0?(e=this._loadingView)==null||e.onLoadingBegin("begin load"):setTimeout(()=>{this._loadingView&&this._loadingProgress01<.3&&this._loadId===r&&this._loadingView.onLoadingBegin("begin load")},300)),zn&&console.warn(`--------------
Needle Engine: Begin loading `+r+`
`,s),this.onBeforeBeginLoading();const c=[],h={context:this._context,name:"",progress:{},index:0,count:s.length,totalProgress01:this._loadingProgress01},u=new CustomEvent("progress",{detail:h}),d=new Array,m=new AbortController;this._abortController=m;const f={files:s,abortSignal:m.signal,onLoadingProgress:v=>{var b;if(m.signal.aborted)return;const A=v.index;!d[A]&&v.name&&(d[A]=dSe(v.name)),v.name=d[A],l&&((b=this._loadingView)==null||b.onLoadingUpdate(v)),h.name=v.name,h.progress=v.progress,this._loadingProgress01=Ik(v),h.totalProgress01=this._loadingProgress01,this.dispatchEvent(u)},onLoadingFinished:(v,b,A)=>{m.signal.aborted||A&&c.push({src:b,file:A})}},g=this.getAttribute("hash");g!=null&&(this._context.hash=g),this._context.alias=o,this._createContextPromise=this._context.create(f);const y=await this._createContextPromise;if(this.applyAttributes(),zn&&console.warn(`--------------
Needle Engine: finished loading `+r+`
`,s,`Aborted? ${m.signal.aborted}`),this._loadId!==r||m.signal.aborted){console.log("Loading finished but aborted...");return}this._loadingProgress01=1,l&&y&&((i=this._loadingView)==null||i.onLoadingUpdate(1,"creating scene")),this._didFullyLoad=!0,this.classList.remove("loading"),this.classList.add("loading-finished"),this.dispatchEvent(new CustomEvent("loadfinished",{detail:{context:this._context,src:o,loadedFiles:c}}))}applyAttributes(){if(this._context.renderer){const s=this.getAttribute("tonemapping")||this.getAttribute("tone-mapping");switch(s?.toLowerCase()){case"none":this._context.renderer.toneMapping=Yr;break;case"linear":this._context.renderer.toneMapping=Tf;break;case"neutral":this._context.renderer.toneMapping=xp;break;case"agx":this._context.renderer.toneMapping=Rf;break;default:s!=null&&console.warn("Invalid tone-mapping attribute: "+s)}const r=this.getAttribute("tone-mapping-exposure");if(r!=null){const o=parseFloat(r);isNaN(o)||(this._context.renderer.toneMappingExposure=o)}}const e=this.getAttribute("background-blurriness");if(e!=null){const s=parseFloat(e);s!==void 0&&this._context&&(this._context.scene.backgroundBlurriness=s)}const i=this.getAttribute("background-color");if(this._context&&typeof i=="string"&&i.length>0){const s=this._context.scene.background;s instanceof Ae?s.set(i):this._context.scene.background=new Ae(i)}}internalSetLoadingMessage(e){var i;(i=this._loadingView)==null||i.setMessage(e)}getSourceFiles(){const e=this.getAttribute("src");if(!e)return[];let i;Array.isArray(e)?i=e:e.startsWith("[")&&e.endsWith("]")?i=JSON.parse(e):e.includes(",")?i=e.split(","):i=[e];for(let s=i.length-1;s>=0;s--){const r=i[s];(r==="null"||r==="undefined"||r?.length<=0)&&i.splice(s,1)}return i}checkIfSourceHasChanged(e,i){if(e?.length!==i?.length||e==null&&i!==null||e!==null&&i==null)return!0;if(e!==null&&i!==null){for(let s=0;s<e?.length;s++)if(e[s]!==i[s])return!0}return!1}ensureLoadStartIsRegistered(){const e=this.getAttribute("loadstart");e&&this.registerEventFromAttribute("loadstart",e)}registerEventFromAttribute(e,i){const s=this._previouslyRegisteredMap.get(e);if(s&&(this._previouslyRegisteredMap.delete(e),this.removeEventListener(e,s)),typeof i=="string"&&i.length>0)try{const r=(0,eval)(i);typeof r=="function"&&(this._previouslyRegisteredMap.set(e,r),this.addEventListener(e,o=>r?.call(globalThis,this._context,o)))}catch(r){console.error("Error registering event "+e+'="'+i+`" failed with the following error:
`,r)}}getAROverlayContainer(){return this._overlay_ar.createOverlayContainer(this)}getVROverlayContainer(){for(let e=0;e<this.children.length;e++){const i=this.children[e];if(i.classList.contains("vr"))return i}return null}onEnterAR(e){var i;this.onSetupAR();const s=this.getAROverlayContainer();this._overlay_ar.onBegin(this._context,s,e),this.dispatchEvent(new CustomEvent("enter-ar",{detail:{session:e,context:this._context,htmlContainer:(i=this._overlay_ar)==null?void 0:i.ARContainer}}))}onExitAR(e){var i;this._overlay_ar.onEnd(this._context),this.onSetupDesktop(),this.dispatchEvent(new CustomEvent("exit-ar",{detail:{session:e,context:this._context,htmlContainer:(i=this._overlay_ar)==null?void 0:i.ARContainer}}))}onEnterVR(e){this.onSetupVR(),this.dispatchEvent(new CustomEvent("enter-vr",{detail:{session:e,context:this._context}}))}onExitVR(e){this.onSetupDesktop(),this.dispatchEvent(new CustomEvent("exit-vr",{detail:{session:e,context:this._context}}))}onSetupAR(){this.classList.add(Hx),this.classList.remove(jx);const e=this.getAROverlayContainer();zn&&console.warn("onSetupAR:",e),e&&(e.classList.add(Hx),e.classList.remove(jx)),this.foreachHtmlElement(i=>this.setupElementsForMode(i,oj))}onSetupVR(){this.classList.remove(Hx),this.classList.remove(jx),this.foreachHtmlElement(e=>this.setupElementsForMode(e,uK))}onSetupDesktop(){this.classList.remove(Hx),this.classList.add(jx);const e=this.getAROverlayContainer();e&&(e.classList.remove(Hx),e.classList.add(jx)),this.foreachHtmlElement(i=>this.setupElementsForMode(i,dK))}setupElementsForMode(e,i,s=null){var r,o;if(!(e===((o=(r=this._context)==null?void 0:r.renderer)==null?void 0:o.domElement)||e.id==="VRButton"||e.id==="ARButton"))if(e.classList.contains(i))e.style.visibility="visible",e.style.display==="none"&&(e.style.display="block");else for(const a of hSe)e.classList.contains(a)&&(e.style.visibility="hidden",e.style.display="none")}foreachHtmlElement(e){for(let i=0;i<this.children.length;i++){const s=this.children[i];s.style&&e(s)}}onBeforeBeginLoading(){const e=this.getAttribute("dracoDecoderPath");e&&(zn&&console.log("using custom draco decoder path",e),aj(e));const i=this.getAttribute("dracoDecoderType");i&&(zn&&console.log("using custom draco decoder type",i),lj(i));const s=this.getAttribute("ktx2DecoderPath");s&&(zn&&console.log("using custom ktx2 decoder path",s),cj(s))}}typeof window<"u"&&!window.customElements.get(hK)&&window.customElements.define(hK,DG);function dSe(n){if(n.startsWith("blob:"))return"blob";const e=n.split("/");let i=e[e.length-1];const s=i.indexOf("?");s>0&&(i=i.substring(0,s));const r=i.indexOf("=");r>0&&(i=i.substring(r));const o=i.split(".").pop(),a=o?["glb","gltf","usdz","usd","fbx","obj","mtl"].indexOf(o.toLowerCase()):-1;if(o&&a>=0&&(i=i.substring(0,i.length-o.length-1)),i=decodeURIComponent(i),i.length>3){let l="",c=!1;const h=["(",")","[","]","{","}",":",";",",",".","!","?"];for(let u=0;u<i.length;u++){let d=i[u];(d==="_"||d==="-")&&(d=" "),!(d===" "&&l.length<=0||h.includes(d)||(l.length===0&&(d=d.toUpperCase()),c&&d===" "))&&(c&&(d=d.toUpperCase()),c=!1,l+=d,d===" "&&(c=!0))}return Ye()&&i!==l&&console.debug('Generated display name: "'+i+'" \u2192 "'+l+'"'),l.trim()}return Ye()&&console.debug("Loading: use default name",i),i}const pSe=Object.freeze(Object.defineProperty({__proto__:null,NeedleEngineHTMLElement:DG},Symbol.toStringTag,{value:"Module"}));function mSe(){Uh.registerWaitForInteraction(()=>{const n=Yw.getContext();n.addEventListener("statechange",()=>{setTimeout(()=>{const e=n.state;(e==="suspended"||e==="interrupted")&&n.resume().then(()=>{console.log("AudioContext resumed successfully")}).catch(i=>{console.log("Failed to resume AudioContext: "+i)})},500)})})}setTimeout(mSe,1e3);const GE=te("debughotreload");let Qx=!1;const Zx=new Map;function fSe(){return Qx}function gSe(n){var e;if(Qx)return;const i=n.constructor.name;Zx.has(i)?(e=Zx.get(i))==null||e.push(n):Zx.set(i,[n])}function ySe(n){if(Qx)return;const e=n.constructor.name,i=Zx.get(e);if(!i)return;const s=i.indexOf(n);s!==-1&&i.splice(s,1)}let pK=!1;function vSe(){if(GE||pK)return;pK=!0;const n=console.error;console.error=(...e)=>{if(e.length){const i=e[0];if(typeof i=="string"&&i.includes("[hmr] Failed to reload ")){console.log("[Needle Engine] Hot reloading failed"),window.location.reload();return}}n.apply(console,e)}}function bSe(n){GE&&console.log("[HMR] Apply changes",n,Object.keys(n)),vSe();for(const e of Object.keys(n))try{Qx=!0;const i=Z.get(e);if(!i){GE&&console.log("[HMR] Type not found: "+e);continue}const s=n[e],r=Zx.get(s.name);let o="[Needle Engine] Updating type: "+e;const a=r?.length??-1;a>0?o+=" x"+a:o+=" - no instances",console.log(o);const l=Object.getOwnPropertyNames(i.prototype),c=Object.getOwnPropertyDescriptors(s.prototype);for(const h in c)c[h].writable&&(i.prototype[h]=n[e].prototype[h]);for(const h of l)c[h]||delete i.prototype[h];if(r){const h=new s,u=Object.getOwnPropertyDescriptors(h);for(const d of r){const m=d,f=m.isComponent===!0,g=f?m.activeAndEnabled:!0,y=f?m.context:void 0;try{if(f&&y&&Nh(m,y),f&&g&&(m.enabled=!1),d.onBeforeHotReloadFields&&d.onBeforeHotReloadFields()===!1)continue;for(const v in u)if(u[v].writable){if(d[v]===void 0)d[v]=h[v];else if(typeof d[v]=="function"&&!d[v].prototype){const b=d[v],A=b.name,x="bound ";if(A===x)continue;const w=b.name.substring(x.length),_=s.prototype[w];_&&(d[v]=_.bind(d))}}d.onAfterHotReloadFields&&d.onAfterHotReloadFields()}finally{f&&y&&PB(m,y),f&&g&&(m.enabled=!0)}}}}catch(i){if(GE)console.error(i);else return!1}finally{Qx=!1,ac(Zo.Log,"Script changes applied (HMR)")}return!0}let Fe;const Yx=new Array(128).fill(void 0);Yx.push(void 0,null,!0,!1),Yx.length;let zE=null;function mK(){return zE!==null&&zE.byteLength!==0||(zE=new Int32Array(Fe.memory.buffer)),zE}const ASe=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&ASe.decode();function yt(n,e){if(!(n instanceof e))throw new Error(`expected instance of ${e.name}`);return n.ptr}let FE=null;function xSe(){return FE!==null&&FE.byteLength!==0||(FE=new Float32Array(Fe.memory.buffer)),FE}let Kx=128;function fK(n){if(Kx==1)throw new Error("out of js stack");return Yx[--Kx]=n,Kx}let NE=null;function wSe(){return NE!==null&&NE.byteLength!==0||(NE=new Uint32Array(Fe.memory.buffer)),NE}let xa=0;function gf(n,e){const i=e(4*n.length,4)>>>0;return xSe().set(n,i/4),xa=n.length,i}function UE(n,e){const i=e(4*n.length,4)>>>0;return wSe().set(n,i/4),xa=n.length,i}const vr=Object.freeze({Ball:0,0:"Ball",Cuboid:1,1:"Cuboid",Capsule:2,2:"Capsule",Segment:3,3:"Segment",Polyline:4,4:"Polyline",Triangle:5,5:"Triangle",TriMesh:6,6:"TriMesh",HeightField:7,7:"HeightField",Compound:8,8:"Compound",ConvexPolyhedron:9,9:"ConvexPolyhedron",Cylinder:10,10:"Cylinder",Cone:11,11:"Cone",RoundCuboid:12,12:"RoundCuboid",RoundTriangle:13,13:"RoundTriangle",RoundCylinder:14,14:"RoundCylinder",RoundCone:15,15:"RoundCone",RoundConvexPolyhedron:16,16:"RoundConvexPolyhedron",HalfSpace:17,17:"HalfSpace"});class _Se{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Fe.__wbg_raweventqueue_free(e)}constructor(e){const i=Fe.raweventqueue_new(e);return this.__wbg_ptr=i>>>0,this}drainCollisionEvents(e){try{Fe.raweventqueue_drainCollisionEvents(this.__wbg_ptr,fK(e))}finally{Yx[Kx++]=void 0}}drainContactForceEvents(e){try{Fe.raweventqueue_drainContactForceEvents(this.__wbg_ptr,fK(e))}finally{Yx[Kx++]=void 0}}clear(){Fe.raweventqueue_clear(this.__wbg_ptr)}}class Zr{static __wrap(e){e>>>=0;const i=Object.create(Zr.prototype);return i.__wbg_ptr=e,i}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Fe.__wbg_rawgenericjoint_free(e)}static generic(e,i,s,r){yt(e,lt),yt(i,lt),yt(s,lt);const o=Fe.rawgenericjoint_generic(e.__wbg_ptr,i.__wbg_ptr,s.__wbg_ptr,r);return o===0?void 0:Zr.__wrap(o)}static spring(e,i,s,r,o){yt(r,lt),yt(o,lt);const a=Fe.rawgenericjoint_spring(e,i,s,r.__wbg_ptr,o.__wbg_ptr);return Zr.__wrap(a)}static rope(e,i,s){yt(i,lt),yt(s,lt);const r=Fe.rawgenericjoint_rope(e,i.__wbg_ptr,s.__wbg_ptr);return Zr.__wrap(r)}static spherical(e,i){yt(e,lt),yt(i,lt);const s=Fe.rawgenericjoint_spherical(e.__wbg_ptr,i.__wbg_ptr);return Zr.__wrap(s)}static prismatic(e,i,s,r,o,a){yt(e,lt),yt(i,lt),yt(s,lt);const l=Fe.rawgenericjoint_prismatic(e.__wbg_ptr,i.__wbg_ptr,s.__wbg_ptr,r,o,a);return l===0?void 0:Zr.__wrap(l)}static fixed(e,i,s,r){yt(e,lt),yt(i,Ar),yt(s,lt),yt(r,Ar);const o=Fe.rawgenericjoint_fixed(e.__wbg_ptr,i.__wbg_ptr,s.__wbg_ptr,r.__wbg_ptr);return Zr.__wrap(o)}static revolute(e,i,s){yt(e,lt),yt(i,lt),yt(s,lt);const r=Fe.rawgenericjoint_revolute(e.__wbg_ptr,i.__wbg_ptr,s.__wbg_ptr);return r===0?void 0:Zr.__wrap(r)}}class T3{static __wrap(e){e>>>=0;const i=Object.create(T3.prototype);return i.__wbg_ptr=e,i}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Fe.__wbg_rawpointprojection_free(e)}point(){const e=Fe.rawpointprojection_point(this.__wbg_ptr);return lt.__wrap(e)}isInside(){return Fe.rawpointprojection_isInside(this.__wbg_ptr)!==0}}class R3{static __wrap(e){e>>>=0;const i=Object.create(R3.prototype);return i.__wbg_ptr=e,i}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Fe.__wbg_rawrayintersection_free(e)}normal(){const e=Fe.rawraycolliderintersection_normal(this.__wbg_ptr);return lt.__wrap(e)}toi(){return Fe.rawraycolliderintersection_toi(this.__wbg_ptr)}featureType(){return Fe.rawpointcolliderprojection_featureType(this.__wbg_ptr)}featureId(){try{const s=Fe.__wbindgen_add_to_stack_pointer(-16);Fe.rawpointcolliderprojection_featureId(s,this.__wbg_ptr);var e=mK()[s/4+0],i=mK()[s/4+1];return e===0?void 0:i>>>0}finally{Fe.__wbindgen_add_to_stack_pointer(16)}}}class Ar{static __wrap(e){e>>>=0;const i=Object.create(Ar.prototype);return i.__wbg_ptr=e,i}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Fe.__wbg_rawrotation_free(e)}constructor(e,i,s,r){const o=Fe.rawrotation_new(e,i,s,r);return this.__wbg_ptr=o>>>0,this}static identity(){const e=Fe.rawrotation_identity();return Ar.__wrap(e)}get x(){return Fe.rawrotation_x(this.__wbg_ptr)}get y(){return Fe.rawintegrationparameters_dt(this.__wbg_ptr)}get z(){return Fe.rawraycolliderintersection_toi(this.__wbg_ptr)}get w(){return Fe.rawintegrationparameters_erp(this.__wbg_ptr)}}class Yt{static __wrap(e){e>>>=0;const i=Object.create(Yt.prototype);return i.__wbg_ptr=e,i}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Fe.__wbg_rawshape_free(e)}static cuboid(e,i,s){const r=Fe.rawshape_cuboid(e,i,s);return Yt.__wrap(r)}static roundCuboid(e,i,s,r){const o=Fe.rawshape_roundCuboid(e,i,s,r);return Yt.__wrap(o)}static ball(e){const i=Fe.rawshape_ball(e);return Yt.__wrap(i)}static halfspace(e){yt(e,lt);const i=Fe.rawshape_halfspace(e.__wbg_ptr);return Yt.__wrap(i)}static capsule(e,i){const s=Fe.rawshape_capsule(e,i);return Yt.__wrap(s)}static cylinder(e,i){const s=Fe.rawshape_cylinder(e,i);return Yt.__wrap(s)}static roundCylinder(e,i,s){const r=Fe.rawshape_roundCylinder(e,i,s);return Yt.__wrap(r)}static cone(e,i){const s=Fe.rawshape_cone(e,i);return Yt.__wrap(s)}static roundCone(e,i,s){const r=Fe.rawshape_roundCone(e,i,s);return Yt.__wrap(r)}static polyline(e,i){const s=gf(e,Fe.__wbindgen_malloc),r=xa,o=UE(i,Fe.__wbindgen_malloc),a=xa,l=Fe.rawshape_polyline(s,r,o,a);return Yt.__wrap(l)}static trimesh(e,i){const s=gf(e,Fe.__wbindgen_malloc),r=xa,o=UE(i,Fe.__wbindgen_malloc),a=xa,l=Fe.rawshape_trimesh(s,r,o,a);return Yt.__wrap(l)}static heightfield(e,i,s,r){const o=gf(s,Fe.__wbindgen_malloc),a=xa;yt(r,lt);const l=Fe.rawshape_heightfield(e,i,o,a,r.__wbg_ptr);return Yt.__wrap(l)}static segment(e,i){yt(e,lt),yt(i,lt);const s=Fe.rawshape_segment(e.__wbg_ptr,i.__wbg_ptr);return Yt.__wrap(s)}static triangle(e,i,s){yt(e,lt),yt(i,lt),yt(s,lt);const r=Fe.rawshape_triangle(e.__wbg_ptr,i.__wbg_ptr,s.__wbg_ptr);return Yt.__wrap(r)}static roundTriangle(e,i,s,r){yt(e,lt),yt(i,lt),yt(s,lt);const o=Fe.rawshape_roundTriangle(e.__wbg_ptr,i.__wbg_ptr,s.__wbg_ptr,r);return Yt.__wrap(o)}static convexHull(e){const i=gf(e,Fe.__wbindgen_malloc),s=xa,r=Fe.rawshape_convexHull(i,s);return r===0?void 0:Yt.__wrap(r)}static roundConvexHull(e,i){const s=gf(e,Fe.__wbindgen_malloc),r=xa,o=Fe.rawshape_roundConvexHull(s,r,i);return o===0?void 0:Yt.__wrap(o)}static convexMesh(e,i){const s=gf(e,Fe.__wbindgen_malloc),r=xa,o=UE(i,Fe.__wbindgen_malloc),a=xa,l=Fe.rawshape_convexMesh(s,r,o,a);return l===0?void 0:Yt.__wrap(l)}static roundConvexMesh(e,i,s){const r=gf(e,Fe.__wbindgen_malloc),o=xa,a=UE(i,Fe.__wbindgen_malloc),l=xa,c=Fe.rawshape_roundConvexMesh(r,o,a,l,s);return c===0?void 0:Yt.__wrap(c)}castShape(e,i,s,r,o,a,l,c,h){yt(e,lt),yt(i,Ar),yt(s,lt),yt(r,Yt),yt(o,lt),yt(a,Ar),yt(l,lt);const u=Fe.rawshape_castShape(this.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,s.__wbg_ptr,r.__wbg_ptr,o.__wbg_ptr,a.__wbg_ptr,l.__wbg_ptr,c,h);return u===0?void 0:L3.__wrap(u)}intersectsShape(e,i,s,r,o){return yt(e,lt),yt(i,Ar),yt(s,Yt),yt(r,lt),yt(o,Ar),Fe.rawshape_intersectsShape(this.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,s.__wbg_ptr,r.__wbg_ptr,o.__wbg_ptr)!==0}contactShape(e,i,s,r,o,a){yt(e,lt),yt(i,Ar),yt(s,Yt),yt(r,lt),yt(o,Ar);const l=Fe.rawshape_contactShape(this.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,s.__wbg_ptr,r.__wbg_ptr,o.__wbg_ptr,a);return l===0?void 0:I3.__wrap(l)}containsPoint(e,i,s){return yt(e,lt),yt(i,Ar),yt(s,lt),Fe.rawshape_containsPoint(this.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,s.__wbg_ptr)!==0}projectPoint(e,i,s,r){yt(e,lt),yt(i,Ar),yt(s,lt);const o=Fe.rawshape_projectPoint(this.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,s.__wbg_ptr,r);return T3.__wrap(o)}intersectsRay(e,i,s,r,o){return yt(e,lt),yt(i,Ar),yt(s,lt),yt(r,lt),Fe.rawshape_intersectsRay(this.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,s.__wbg_ptr,r.__wbg_ptr,o)!==0}castRay(e,i,s,r,o,a){return yt(e,lt),yt(i,Ar),yt(s,lt),yt(r,lt),Fe.rawshape_castRay(this.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,s.__wbg_ptr,r.__wbg_ptr,o,a)}castRayAndGetNormal(e,i,s,r,o,a){yt(e,lt),yt(i,Ar),yt(s,lt),yt(r,lt);const l=Fe.rawshape_castRayAndGetNormal(this.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,s.__wbg_ptr,r.__wbg_ptr,o,a);return l===0?void 0:R3.__wrap(l)}}class I3{static __wrap(e){e>>>=0;const i=Object.create(I3.prototype);return i.__wbg_ptr=e,i}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Fe.__wbg_rawshapecontact_free(e)}distance(){return Fe.rawkinematiccharactercontroller_maxSlopeClimbAngle(this.__wbg_ptr)}point1(){const e=Fe.rawpointprojection_point(this.__wbg_ptr);return lt.__wrap(e)}point2(){const e=Fe.rawraycolliderintersection_normal(this.__wbg_ptr);return lt.__wrap(e)}normal1(){const e=Fe.rawshapecollidertoi_witness2(this.__wbg_ptr);return lt.__wrap(e)}normal2(){const e=Fe.rawcharactercollision_translationDeltaApplied(this.__wbg_ptr);return lt.__wrap(e)}}class L3{static __wrap(e){e>>>=0;const i=Object.create(L3.prototype);return i.__wbg_ptr=e,i}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Fe.__wbg_rawshapetoi_free(e)}toi(){return Fe.rawrotation_x(this.__wbg_ptr)}witness1(){const e=Fe.rawshapetoi_witness1(this.__wbg_ptr);return lt.__wrap(e)}witness2(){const e=Fe.rawcontactforceevent_total_force(this.__wbg_ptr);return lt.__wrap(e)}normal1(){const e=Fe.rawshapetoi_normal1(this.__wbg_ptr);return lt.__wrap(e)}normal2(){const e=Fe.rawshapetoi_normal2(this.__wbg_ptr);return lt.__wrap(e)}}class lt{static __wrap(e){e>>>=0;const i=Object.create(lt.prototype);return i.__wbg_ptr=e,i}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Fe.__wbg_rawvector_free(e)}static zero(){const e=Fe.rawvector_zero();return lt.__wrap(e)}constructor(e,i,s){const r=Fe.rawvector_new(e,i,s);return this.__wbg_ptr=r>>>0,this}get x(){return Fe.rawrotation_x(this.__wbg_ptr)}set x(e){Fe.rawvector_set_x(this.__wbg_ptr,e)}get y(){return Fe.rawintegrationparameters_dt(this.__wbg_ptr)}set y(e){Fe.rawintegrationparameters_set_dt(this.__wbg_ptr,e)}get z(){return Fe.rawraycolliderintersection_toi(this.__wbg_ptr)}set z(e){Fe.rawvector_set_z(this.__wbg_ptr,e)}xyz(){const e=Fe.rawvector_xyz(this.__wbg_ptr);return lt.__wrap(e)}yxz(){const e=Fe.rawvector_yxz(this.__wbg_ptr);return lt.__wrap(e)}zxy(){const e=Fe.rawvector_zxy(this.__wbg_ptr);return lt.__wrap(e)}xzy(){const e=Fe.rawvector_xzy(this.__wbg_ptr);return lt.__wrap(e)}yzx(){const e=Fe.rawvector_yzx(this.__wbg_ptr);return lt.__wrap(e)}zyx(){const e=Fe.rawvector_zyx(this.__wbg_ptr);return lt.__wrap(e)}}class SSe{constructor(e,i,s){this.x=e,this.y=i,this.z=s}}class Be{static new(e,i,s){return new SSe(e,i,s)}static intoRaw(e){return new lt(e.x,e.y,e.z)}static zeros(){return Be.new(0,0,0)}static fromRaw(e){if(!e)return null;let i=Be.new(e.x,e.y,e.z);return e.free(),i}static copy(e,i){e.x=i.x,e.y=i.y,e.z=i.z}}class gK{constructor(e,i,s,r){this.x=e,this.y=i,this.z=s,this.w=r}}class Ji{static identity(){return new gK(0,0,0,1)}static fromRaw(e){if(!e)return null;let i=new gK(e.x,e.y,e.z,e.w);return e.free(),i}static intoRaw(e){return new Ar(e.x,e.y,e.z,e.w)}static copy(e,i){e.x=i.x,e.y=i.y,e.z=i.z,e.w=i.w}}class CSe{constructor(e){this.elements=e}get m11(){return this.elements[0]}get m12(){return this.elements[1]}get m21(){return this.m12}get m13(){return this.elements[2]}get m31(){return this.m13}get m22(){return this.elements[3]}get m23(){return this.elements[4]}get m32(){return this.m23}get m33(){return this.elements[5]}}class yK{static fromRaw(e){const i=new CSe(e.elements());return e.free(),i}}var Jx,jr,vK,bK,hs,OG,Zn,AK,VE,GG,xK,XE,Ay;(function(n){n[n.Dynamic=0]="Dynamic",n[n.Fixed=1]="Fixed",n[n.KinematicPositionBased=2]="KinematicPositionBased",n[n.KinematicVelocityBased=3]="KinematicVelocityBased"})(Jx||(Jx={}));class wK{constructor(e,i,s){this.rawSet=e,this.colliderSet=i,this.handle=s}finalizeDeserialization(e){this.colliderSet=e}isValid(){return this.rawSet.contains(this.handle)}lockTranslations(e,i){return this.rawSet.rbLockTranslations(this.handle,e,i)}lockRotations(e,i){return this.rawSet.rbLockRotations(this.handle,e,i)}setEnabledTranslations(e,i,s,r){return this.rawSet.rbSetEnabledTranslations(this.handle,e,i,s,r)}restrictTranslations(e,i,s,r){this.setEnabledTranslations(e,i,s,r)}setEnabledRotations(e,i,s,r){return this.rawSet.rbSetEnabledRotations(this.handle,e,i,s,r)}restrictRotations(e,i,s,r){this.setEnabledRotations(e,i,s,r)}dominanceGroup(){return this.rawSet.rbDominanceGroup(this.handle)}setDominanceGroup(e){this.rawSet.rbSetDominanceGroup(this.handle,e)}additionalSolverIterations(){return this.rawSet.rbAdditionalSolverIterations(this.handle)}setAdditionalSolverIterations(e){this.rawSet.rbSetAdditionalSolverIterations(this.handle,e)}enableCcd(e){this.rawSet.rbEnableCcd(this.handle,e)}translation(){let e=this.rawSet.rbTranslation(this.handle);return Be.fromRaw(e)}rotation(){let e=this.rawSet.rbRotation(this.handle);return Ji.fromRaw(e)}nextTranslation(){let e=this.rawSet.rbNextTranslation(this.handle);return Be.fromRaw(e)}nextRotation(){let e=this.rawSet.rbNextRotation(this.handle);return Ji.fromRaw(e)}setTranslation(e,i){this.rawSet.rbSetTranslation(this.handle,e.x,e.y,e.z,i)}setLinvel(e,i){let s=Be.intoRaw(e);this.rawSet.rbSetLinvel(this.handle,s,i),s.free()}gravityScale(){return this.rawSet.rbGravityScale(this.handle)}setGravityScale(e,i){this.rawSet.rbSetGravityScale(this.handle,e,i)}setRotation(e,i){this.rawSet.rbSetRotation(this.handle,e.x,e.y,e.z,e.w,i)}setAngvel(e,i){let s=Be.intoRaw(e);this.rawSet.rbSetAngvel(this.handle,s,i),s.free()}setNextKinematicTranslation(e){this.rawSet.rbSetNextKinematicTranslation(this.handle,e.x,e.y,e.z)}setNextKinematicRotation(e){this.rawSet.rbSetNextKinematicRotation(this.handle,e.x,e.y,e.z,e.w)}linvel(){return Be.fromRaw(this.rawSet.rbLinvel(this.handle))}angvel(){return Be.fromRaw(this.rawSet.rbAngvel(this.handle))}mass(){return this.rawSet.rbMass(this.handle)}effectiveInvMass(){return Be.fromRaw(this.rawSet.rbEffectiveInvMass(this.handle))}invMass(){return this.rawSet.rbInvMass(this.handle)}localCom(){return Be.fromRaw(this.rawSet.rbLocalCom(this.handle))}worldCom(){return Be.fromRaw(this.rawSet.rbWorldCom(this.handle))}invPrincipalInertiaSqrt(){return Be.fromRaw(this.rawSet.rbInvPrincipalInertiaSqrt(this.handle))}principalInertia(){return Be.fromRaw(this.rawSet.rbPrincipalInertia(this.handle))}principalInertiaLocalFrame(){return Ji.fromRaw(this.rawSet.rbPrincipalInertiaLocalFrame(this.handle))}effectiveWorldInvInertiaSqrt(){return yK.fromRaw(this.rawSet.rbEffectiveWorldInvInertiaSqrt(this.handle))}effectiveAngularInertia(){return yK.fromRaw(this.rawSet.rbEffectiveAngularInertia(this.handle))}sleep(){this.rawSet.rbSleep(this.handle)}wakeUp(){this.rawSet.rbWakeUp(this.handle)}isCcdEnabled(){return this.rawSet.rbIsCcdEnabled(this.handle)}numColliders(){return this.rawSet.rbNumColliders(this.handle)}collider(e){return this.colliderSet.get(this.rawSet.rbCollider(this.handle,e))}setEnabled(e){this.rawSet.rbSetEnabled(this.handle,e)}isEnabled(){return this.rawSet.rbIsEnabled(this.handle)}bodyType(){return this.rawSet.rbBodyType(this.handle)}setBodyType(e,i){return this.rawSet.rbSetBodyType(this.handle,e,i)}isSleeping(){return this.rawSet.rbIsSleeping(this.handle)}isMoving(){return this.rawSet.rbIsMoving(this.handle)}isFixed(){return this.rawSet.rbIsFixed(this.handle)}isKinematic(){return this.rawSet.rbIsKinematic(this.handle)}isDynamic(){return this.rawSet.rbIsDynamic(this.handle)}linearDamping(){return this.rawSet.rbLinearDamping(this.handle)}angularDamping(){return this.rawSet.rbAngularDamping(this.handle)}setLinearDamping(e){this.rawSet.rbSetLinearDamping(this.handle,e)}recomputeMassPropertiesFromColliders(){this.rawSet.rbRecomputeMassPropertiesFromColliders(this.handle,this.colliderSet.raw)}setAdditionalMass(e,i){this.rawSet.rbSetAdditionalMass(this.handle,e,i)}setAdditionalMassProperties(e,i,s,r,o){let a=Be.intoRaw(i),l=Be.intoRaw(s),c=Ji.intoRaw(r);this.rawSet.rbSetAdditionalMassProperties(this.handle,e,a,l,c,o),a.free(),l.free(),c.free()}setAngularDamping(e){this.rawSet.rbSetAngularDamping(this.handle,e)}resetForces(e){this.rawSet.rbResetForces(this.handle,e)}resetTorques(e){this.rawSet.rbResetTorques(this.handle,e)}addForce(e,i){const s=Be.intoRaw(e);this.rawSet.rbAddForce(this.handle,s,i),s.free()}applyImpulse(e,i){const s=Be.intoRaw(e);this.rawSet.rbApplyImpulse(this.handle,s,i),s.free()}addTorque(e,i){const s=Be.intoRaw(e);this.rawSet.rbAddTorque(this.handle,s,i),s.free()}applyTorqueImpulse(e,i){const s=Be.intoRaw(e);this.rawSet.rbApplyTorqueImpulse(this.handle,s,i),s.free()}addForceAtPoint(e,i,s){const r=Be.intoRaw(e),o=Be.intoRaw(i);this.rawSet.rbAddForceAtPoint(this.handle,r,o,s),r.free(),o.free()}applyImpulseAtPoint(e,i,s){const r=Be.intoRaw(e),o=Be.intoRaw(i);this.rawSet.rbApplyImpulseAtPoint(this.handle,r,o,s),r.free(),o.free()}}(function(n){n[n.Revolute=0]="Revolute",n[n.Fixed=1]="Fixed",n[n.Prismatic=2]="Prismatic",n[n.Rope=3]="Rope",n[n.Spring=4]="Spring",n[n.Spherical=5]="Spherical",n[n.Generic=6]="Generic"})(jr||(jr={})),function(n){n[n.AccelerationBased=0]="AccelerationBased",n[n.ForceBased=1]="ForceBased"}(vK||(vK={})),function(n){n[n.X=1]="X",n[n.Y=2]="Y",n[n.Z=4]="Z",n[n.AngX=8]="AngX",n[n.AngY=16]="AngY",n[n.AngZ=32]="AngZ"}(bK||(bK={}));class vu{constructor(){}static fixed(e,i,s,r){let o=new vu;return o.anchor1=e,o.anchor2=s,o.frame1=i,o.frame2=r,o.jointType=jr.Fixed,o}static spring(e,i,s,r,o){let a=new vu;return a.anchor1=r,a.anchor2=o,a.length=e,a.stiffness=i,a.damping=s,a.jointType=jr.Spring,a}static rope(e,i,s){let r=new vu;return r.anchor1=i,r.anchor2=s,r.length=e,r.jointType=jr.Rope,r}static generic(e,i,s,r){let o=new vu;return o.anchor1=e,o.anchor2=i,o.axis=s,o.axesMask=r,o.jointType=jr.Generic,o}static spherical(e,i){let s=new vu;return s.anchor1=e,s.anchor2=i,s.jointType=jr.Spherical,s}static prismatic(e,i,s){let r=new vu;return r.anchor1=e,r.anchor2=i,r.axis=s,r.jointType=jr.Prismatic,r}static revolute(e,i,s){let r=new vu;return r.anchor1=e,r.anchor2=i,r.axis=s,r.jointType=jr.Revolute,r}intoRaw(){let e,i,s=Be.intoRaw(this.anchor1),r=Be.intoRaw(this.anchor2),o=!1,a=0,l=0;switch(this.jointType){case jr.Fixed:let c=Ji.intoRaw(this.frame1),h=Ji.intoRaw(this.frame2);i=Zr.fixed(s,c,r,h),c.free(),h.free();break;case jr.Spring:i=Zr.spring(this.length,this.stiffness,this.damping,s,r);break;case jr.Rope:i=Zr.rope(this.length,s,r);break;case jr.Prismatic:e=Be.intoRaw(this.axis),this.limitsEnabled&&(o=!0,a=this.limits[0],l=this.limits[1]),i=Zr.prismatic(s,r,e,o,a,l),e.free();break;case jr.Generic:e=Be.intoRaw(this.axis);let u=this.axesMask;i=Zr.generic(s,r,e,u);break;case jr.Spherical:i=Zr.spherical(s,r);break;case jr.Revolute:e=Be.intoRaw(this.axis),i=Zr.revolute(s,r,e),e.free()}return s.free(),r.free(),i}}(function(n){n[n.Average=0]="Average",n[n.Min=1]="Min",n[n.Multiply=2]="Multiply",n[n.Max=3]="Max"})(hs||(hs={}));class g1{constructor(e,i,s,r,o){this.distance=e,this.point1=i,this.point2=s,this.normal1=r,this.normal2=o}static fromRaw(e){if(!e)return null;const i=new g1(e.distance(),Be.fromRaw(e.point1()),Be.fromRaw(e.point2()),Be.fromRaw(e.normal1()),Be.fromRaw(e.normal2()));return e.free(),i}}(function(n){n[n.Vertex=0]="Vertex",n[n.Edge=1]="Edge",n[n.Face=2]="Face",n[n.Unknown=3]="Unknown"})(OG||(OG={}));class kT{constructor(e,i){this.point=e,this.isInside=i}static fromRaw(e){if(!e)return null;const i=new kT(Be.fromRaw(e.point()),e.isInside());return e.free(),i}}class MSe{constructor(e,i){this.origin=e,this.dir=i}pointAt(e){return{x:this.origin.x+this.dir.x*e,y:this.origin.y+this.dir.y*e,z:this.origin.z+this.dir.z*e}}}class DT{constructor(e,i,s,r){this.featureType=OG.Unknown,this.featureId=void 0,this.toi=e,this.normal=i,r!==void 0&&(this.featureId=r),s!==void 0&&(this.featureType=s)}static fromRaw(e){if(!e)return null;const i=new DT(e.toi(),Be.fromRaw(e.normal()),e.featureType(),e.featureId());return e.free(),i}}class y1{constructor(e,i,s,r,o){this.toi=e,this.witness1=i,this.witness2=s,this.normal1=r,this.normal2=o}static fromRaw(e,i){if(!i)return null;const s=new y1(i.toi(),Be.fromRaw(i.witness1()),Be.fromRaw(i.witness2()),Be.fromRaw(i.normal1()),Be.fromRaw(i.normal2()));return i.free(),s}}class P3 extends y1{constructor(e,i,s,r,o,a){super(i,s,r,o,a),this.collider=e}static fromRaw(e,i){if(!i)return null;const s=new P3(e.get(i.colliderHandle()),i.toi(),Be.fromRaw(i.witness1()),Be.fromRaw(i.witness2()),Be.fromRaw(i.normal1()),Be.fromRaw(i.normal2()));return i.free(),s}}class Qs{static fromRaw(e,i){const s=e.coShapeType(i);let r,o,a,l,c,h,u;switch(s){case vr.Ball:return new zG(e.coRadius(i));case vr.Cuboid:return r=e.coHalfExtents(i),new _K(r.x,r.y,r.z);case vr.RoundCuboid:return r=e.coHalfExtents(i),o=e.coRoundRadius(i),new SK(r.x,r.y,r.z,o);case vr.Capsule:return c=e.coHalfHeight(i),h=e.coRadius(i),new CK(c,h);case vr.Segment:return a=e.coVertices(i),new MK(Be.new(a[0],a[1],a[2]),Be.new(a[3],a[4],a[5]));case vr.Polyline:return a=e.coVertices(i),l=e.coIndices(i),new RK(a,l);case vr.Triangle:return a=e.coVertices(i),new EK(Be.new(a[0],a[1],a[2]),Be.new(a[3],a[4],a[5]),Be.new(a[6],a[7],a[8]));case vr.RoundTriangle:return a=e.coVertices(i),o=e.coRoundRadius(i),new TK(Be.new(a[0],a[1],a[2]),Be.new(a[3],a[4],a[5]),Be.new(a[6],a[7],a[8]),o);case vr.HalfSpace:return u=Be.fromRaw(e.coHalfspaceNormal(i)),new ESe(u);case vr.TriMesh:return a=e.coVertices(i),l=e.coIndices(i),new IK(a,l);case vr.HeightField:const d=e.coHeightfieldScale(i),m=e.coHeightfieldHeights(i),f=e.coHeightfieldNRows(i),g=e.coHeightfieldNCols(i);return new LK(f,g,m,d);case vr.ConvexPolyhedron:return a=e.coVertices(i),l=e.coIndices(i),new FG(a,l);case vr.RoundConvexPolyhedron:return a=e.coVertices(i),l=e.coIndices(i),o=e.coRoundRadius(i),new NG(a,l,o);case vr.Cylinder:return c=e.coHalfHeight(i),h=e.coRadius(i),new PK(c,h);case vr.RoundCylinder:return c=e.coHalfHeight(i),h=e.coRadius(i),o=e.coRoundRadius(i),new BK(c,h,o);case vr.Cone:return c=e.coHalfHeight(i),h=e.coRadius(i),new kK(c,h);case vr.RoundCone:return c=e.coHalfHeight(i),h=e.coRadius(i),o=e.coRoundRadius(i),new DK(c,h,o);default:throw new Error("unknown shape type: "+s)}}castShape(e,i,s,r,o,a,l,c,h){let u=Be.intoRaw(e),d=Ji.intoRaw(i),m=Be.intoRaw(s),f=Be.intoRaw(o),g=Ji.intoRaw(a),y=Be.intoRaw(l),v=this.intoRaw(),b=r.intoRaw(),A=y1.fromRaw(null,v.castShape(u,d,m,b,f,g,y,c,h));return u.free(),d.free(),m.free(),f.free(),g.free(),y.free(),v.free(),b.free(),A}intersectsShape(e,i,s,r,o){let a=Be.intoRaw(e),l=Ji.intoRaw(i),c=Be.intoRaw(r),h=Ji.intoRaw(o),u=this.intoRaw(),d=s.intoRaw(),m=u.intersectsShape(a,l,d,c,h);return a.free(),l.free(),c.free(),h.free(),u.free(),d.free(),m}contactShape(e,i,s,r,o,a){let l=Be.intoRaw(e),c=Ji.intoRaw(i),h=Be.intoRaw(r),u=Ji.intoRaw(o),d=this.intoRaw(),m=s.intoRaw(),f=g1.fromRaw(d.contactShape(l,c,m,h,u,a));return l.free(),c.free(),h.free(),u.free(),d.free(),m.free(),f}containsPoint(e,i,s){let r=Be.intoRaw(e),o=Ji.intoRaw(i),a=Be.intoRaw(s),l=this.intoRaw(),c=l.containsPoint(r,o,a);return r.free(),o.free(),a.free(),l.free(),c}projectPoint(e,i,s,r){let o=Be.intoRaw(e),a=Ji.intoRaw(i),l=Be.intoRaw(s),c=this.intoRaw(),h=kT.fromRaw(c.projectPoint(o,a,l,r));return o.free(),a.free(),l.free(),c.free(),h}intersectsRay(e,i,s,r){let o=Be.intoRaw(i),a=Ji.intoRaw(s),l=Be.intoRaw(e.origin),c=Be.intoRaw(e.dir),h=this.intoRaw(),u=h.intersectsRay(o,a,l,c,r);return o.free(),a.free(),l.free(),c.free(),h.free(),u}castRay(e,i,s,r,o){let a=Be.intoRaw(i),l=Ji.intoRaw(s),c=Be.intoRaw(e.origin),h=Be.intoRaw(e.dir),u=this.intoRaw(),d=u.castRay(a,l,c,h,r,o);return a.free(),l.free(),c.free(),h.free(),u.free(),d}castRayAndGetNormal(e,i,s,r,o){let a=Be.intoRaw(i),l=Ji.intoRaw(s),c=Be.intoRaw(e.origin),h=Be.intoRaw(e.dir),u=this.intoRaw(),d=DT.fromRaw(u.castRayAndGetNormal(a,l,c,h,r,o));return a.free(),l.free(),c.free(),h.free(),u.free(),d}}(function(n){n[n.Ball=0]="Ball",n[n.Cuboid=1]="Cuboid",n[n.Capsule=2]="Capsule",n[n.Segment=3]="Segment",n[n.Polyline=4]="Polyline",n[n.Triangle=5]="Triangle",n[n.TriMesh=6]="TriMesh",n[n.HeightField=7]="HeightField",n[n.ConvexPolyhedron=9]="ConvexPolyhedron",n[n.Cylinder=10]="Cylinder",n[n.Cone=11]="Cone",n[n.RoundCuboid=12]="RoundCuboid",n[n.RoundTriangle=13]="RoundTriangle",n[n.RoundCylinder=14]="RoundCylinder",n[n.RoundCone=15]="RoundCone",n[n.RoundConvexPolyhedron=16]="RoundConvexPolyhedron",n[n.HalfSpace=17]="HalfSpace"})(Zn||(Zn={}));class zG extends Qs{constructor(e){super(),this.type=Zn.Ball,this.radius=e}intoRaw(){return Yt.ball(this.radius)}}class ESe extends Qs{constructor(e){super(),this.type=Zn.HalfSpace,this.normal=e}intoRaw(){let e=Be.intoRaw(this.normal),i=Yt.halfspace(e);return e.free(),i}}class _K extends Qs{constructor(e,i,s){super(),this.type=Zn.Cuboid,this.halfExtents=Be.new(e,i,s)}intoRaw(){return Yt.cuboid(this.halfExtents.x,this.halfExtents.y,this.halfExtents.z)}}class SK extends Qs{constructor(e,i,s,r){super(),this.type=Zn.RoundCuboid,this.halfExtents=Be.new(e,i,s),this.borderRadius=r}intoRaw(){return Yt.roundCuboid(this.halfExtents.x,this.halfExtents.y,this.halfExtents.z,this.borderRadius)}}class CK extends Qs{constructor(e,i){super(),this.type=Zn.Capsule,this.halfHeight=e,this.radius=i}intoRaw(){return Yt.capsule(this.halfHeight,this.radius)}}class MK extends Qs{constructor(e,i){super(),this.type=Zn.Segment,this.a=e,this.b=i}intoRaw(){let e=Be.intoRaw(this.a),i=Be.intoRaw(this.b),s=Yt.segment(e,i);return e.free(),i.free(),s}}class EK extends Qs{constructor(e,i,s){super(),this.type=Zn.Triangle,this.a=e,this.b=i,this.c=s}intoRaw(){let e=Be.intoRaw(this.a),i=Be.intoRaw(this.b),s=Be.intoRaw(this.c),r=Yt.triangle(e,i,s);return e.free(),i.free(),s.free(),r}}class TK extends Qs{constructor(e,i,s,r){super(),this.type=Zn.RoundTriangle,this.a=e,this.b=i,this.c=s,this.borderRadius=r}intoRaw(){let e=Be.intoRaw(this.a),i=Be.intoRaw(this.b),s=Be.intoRaw(this.c),r=Yt.roundTriangle(e,i,s,this.borderRadius);return e.free(),i.free(),s.free(),r}}class RK extends Qs{constructor(e,i){super(),this.type=Zn.Polyline,this.vertices=e,this.indices=i??new Uint32Array(0)}intoRaw(){return Yt.polyline(this.vertices,this.indices)}}class IK extends Qs{constructor(e,i){super(),this.type=Zn.TriMesh,this.vertices=e,this.indices=i}intoRaw(){return Yt.trimesh(this.vertices,this.indices)}}class FG extends Qs{constructor(e,i){super(),this.type=Zn.ConvexPolyhedron,this.vertices=e,this.indices=i}intoRaw(){return this.indices?Yt.convexMesh(this.vertices,this.indices):Yt.convexHull(this.vertices)}}class NG extends Qs{constructor(e,i,s){super(),this.type=Zn.RoundConvexPolyhedron,this.vertices=e,this.indices=i,this.borderRadius=s}intoRaw(){return this.indices?Yt.roundConvexMesh(this.vertices,this.indices,this.borderRadius):Yt.roundConvexHull(this.vertices,this.borderRadius)}}class LK extends Qs{constructor(e,i,s,r){super(),this.type=Zn.HeightField,this.nrows=e,this.ncols=i,this.heights=s,this.scale=r}intoRaw(){let e=Be.intoRaw(this.scale),i=Yt.heightfield(this.nrows,this.ncols,this.heights,e);return e.free(),i}}class PK extends Qs{constructor(e,i){super(),this.type=Zn.Cylinder,this.halfHeight=e,this.radius=i}intoRaw(){return Yt.cylinder(this.halfHeight,this.radius)}}class BK extends Qs{constructor(e,i,s){super(),this.type=Zn.RoundCylinder,this.borderRadius=s,this.halfHeight=e,this.radius=i}intoRaw(){return Yt.roundCylinder(this.halfHeight,this.radius,this.borderRadius)}}class kK extends Qs{constructor(e,i){super(),this.type=Zn.Cone,this.halfHeight=e,this.radius=i}intoRaw(){return Yt.cone(this.halfHeight,this.radius)}}class DK extends Qs{constructor(e,i,s){super(),this.type=Zn.RoundCone,this.halfHeight=e,this.radius=i,this.borderRadius=s}intoRaw(){return Yt.roundCone(this.halfHeight,this.radius,this.borderRadius)}}(function(n){n[n.EXCLUDE_FIXED=1]="EXCLUDE_FIXED",n[n.EXCLUDE_KINEMATIC=2]="EXCLUDE_KINEMATIC",n[n.EXCLUDE_DYNAMIC=4]="EXCLUDE_DYNAMIC",n[n.EXCLUDE_SENSORS=8]="EXCLUDE_SENSORS",n[n.EXCLUDE_SOLIDS=16]="EXCLUDE_SOLIDS",n[n.ONLY_DYNAMIC=3]="ONLY_DYNAMIC",n[n.ONLY_KINEMATIC=5]="ONLY_KINEMATIC",n[n.ONLY_FIXED=6]="ONLY_FIXED"})(AK||(AK={})),function(n){n[n.NONE=0]="NONE",n[n.COLLISION_EVENTS=1]="COLLISION_EVENTS",n[n.CONTACT_FORCE_EVENTS=2]="CONTACT_FORCE_EVENTS"}(VE||(VE={}));class TSe{free(){this.raw&&this.raw.free(),this.raw=void 0}collider1(){return this.raw.collider1()}collider2(){return this.raw.collider2()}totalForce(){return Be.fromRaw(this.raw.total_force())}totalForceMagnitude(){return this.raw.total_force_magnitude()}maxForceDirection(){return Be.fromRaw(this.raw.max_force_direction())}maxForceMagnitude(){return this.raw.max_force_magnitude()}}class RSe{constructor(e,i){this.raw=i||new _Se(e)}free(){this.raw&&this.raw.free(),this.raw=void 0}drainCollisionEvents(e){this.raw.drainCollisionEvents(e)}drainContactForceEvents(e){let i=new TSe;this.raw.drainContactForceEvents(s=>{i.raw=s,e(i),i.free()})}clear(){this.raw.clear()}}(function(n){n[n.NONE=0]="NONE",n[n.FILTER_CONTACT_PAIRS=1]="FILTER_CONTACT_PAIRS",n[n.FILTER_INTERSECTION_PAIRS=2]="FILTER_INTERSECTION_PAIRS"})(GG||(GG={})),function(n){n[n.EMPTY=0]="EMPTY",n[n.COMPUTE_IMPULSE=1]="COMPUTE_IMPULSE"}(xK||(xK={})),function(n){n[n.DYNAMIC_DYNAMIC=1]="DYNAMIC_DYNAMIC",n[n.DYNAMIC_KINEMATIC=12]="DYNAMIC_KINEMATIC",n[n.DYNAMIC_FIXED=2]="DYNAMIC_FIXED",n[n.KINEMATIC_KINEMATIC=52224]="KINEMATIC_KINEMATIC",n[n.KINEMATIC_FIXED=8704]="KINEMATIC_FIXED",n[n.FIXED_FIXED=32]="FIXED_FIXED",n[n.DEFAULT=15]="DEFAULT",n[n.ALL=60943]="ALL"}(XE||(XE={}));class OK{constructor(e,i,s,r){this.colliderSet=e,this.handle=i,this._parent=s,this._shape=r}finalizeDeserialization(e){this.handle!=null&&(this._parent=e.get(this.colliderSet.raw.coParent(this.handle)))}ensureShapeIsCached(){this._shape||(this._shape=Qs.fromRaw(this.colliderSet.raw,this.handle))}get shape(){return this.ensureShapeIsCached(),this._shape}isValid(){return this.colliderSet.raw.contains(this.handle)}translation(){return Be.fromRaw(this.colliderSet.raw.coTranslation(this.handle))}rotation(){return Ji.fromRaw(this.colliderSet.raw.coRotation(this.handle))}isSensor(){return this.colliderSet.raw.coIsSensor(this.handle)}setSensor(e){this.colliderSet.raw.coSetSensor(this.handle,e)}setShape(e){let i=e.intoRaw();this.colliderSet.raw.coSetShape(this.handle,i),i.free(),this._shape=e}setEnabled(e){this.colliderSet.raw.coSetEnabled(this.handle,e)}isEnabled(){return this.colliderSet.raw.coIsEnabled(this.handle)}setRestitution(e){this.colliderSet.raw.coSetRestitution(this.handle,e)}setFriction(e){this.colliderSet.raw.coSetFriction(this.handle,e)}frictionCombineRule(){return this.colliderSet.raw.coFrictionCombineRule(this.handle)}setFrictionCombineRule(e){this.colliderSet.raw.coSetFrictionCombineRule(this.handle,e)}restitutionCombineRule(){return this.colliderSet.raw.coRestitutionCombineRule(this.handle)}setRestitutionCombineRule(e){this.colliderSet.raw.coSetRestitutionCombineRule(this.handle,e)}setCollisionGroups(e){this.colliderSet.raw.coSetCollisionGroups(this.handle,e)}setSolverGroups(e){this.colliderSet.raw.coSetSolverGroups(this.handle,e)}activeHooks(){return this.colliderSet.raw.coActiveHooks(this.handle)}setActiveHooks(e){this.colliderSet.raw.coSetActiveHooks(this.handle,e)}activeEvents(){return this.colliderSet.raw.coActiveEvents(this.handle)}setActiveEvents(e){this.colliderSet.raw.coSetActiveEvents(this.handle,e)}activeCollisionTypes(){return this.colliderSet.raw.coActiveCollisionTypes(this.handle)}setContactForceEventThreshold(e){return this.colliderSet.raw.coSetContactForceEventThreshold(this.handle,e)}contactForceEventThreshold(){return this.colliderSet.raw.coContactForceEventThreshold(this.handle)}setActiveCollisionTypes(e){this.colliderSet.raw.coSetActiveCollisionTypes(this.handle,e)}setDensity(e){this.colliderSet.raw.coSetDensity(this.handle,e)}setMass(e){this.colliderSet.raw.coSetMass(this.handle,e)}setMassProperties(e,i,s,r){let o=Be.intoRaw(i),a=Be.intoRaw(s),l=Ji.intoRaw(r);this.colliderSet.raw.coSetMassProperties(this.handle,e,o,a,l),o.free(),a.free(),l.free()}setTranslation(e){this.colliderSet.raw.coSetTranslation(this.handle,e.x,e.y,e.z)}setTranslationWrtParent(e){this.colliderSet.raw.coSetTranslationWrtParent(this.handle,e.x,e.y,e.z)}setRotation(e){this.colliderSet.raw.coSetRotation(this.handle,e.x,e.y,e.z,e.w)}setRotationWrtParent(e){this.colliderSet.raw.coSetRotationWrtParent(this.handle,e.x,e.y,e.z,e.w)}shapeType(){return this.colliderSet.raw.coShapeType(this.handle)}halfExtents(){return Be.fromRaw(this.colliderSet.raw.coHalfExtents(this.handle))}setHalfExtents(e){const i=Be.intoRaw(e);this.colliderSet.raw.coSetHalfExtents(this.handle,i)}radius(){return this.colliderSet.raw.coRadius(this.handle)}setRadius(e){this.colliderSet.raw.coSetRadius(this.handle,e)}roundRadius(){return this.colliderSet.raw.coRoundRadius(this.handle)}setRoundRadius(e){this.colliderSet.raw.coSetRoundRadius(this.handle,e)}halfHeight(){return this.colliderSet.raw.coHalfHeight(this.handle)}setHalfHeight(e){this.colliderSet.raw.coSetHalfHeight(this.handle,e)}vertices(){return this.colliderSet.raw.coVertices(this.handle)}indices(){return this.colliderSet.raw.coIndices(this.handle)}heightfieldHeights(){return this.colliderSet.raw.coHeightfieldHeights(this.handle)}heightfieldScale(){let e=this.colliderSet.raw.coHeightfieldScale(this.handle);return Be.fromRaw(e)}heightfieldNRows(){return this.colliderSet.raw.coHeightfieldNRows(this.handle)}heightfieldNCols(){return this.colliderSet.raw.coHeightfieldNCols(this.handle)}parent(){return this._parent}friction(){return this.colliderSet.raw.coFriction(this.handle)}restitution(){return this.colliderSet.raw.coRestitution(this.handle)}density(){return this.colliderSet.raw.coDensity(this.handle)}mass(){return this.colliderSet.raw.coMass(this.handle)}volume(){return this.colliderSet.raw.coVolume(this.handle)}collisionGroups(){return this.colliderSet.raw.coCollisionGroups(this.handle)}solverGroups(){return this.colliderSet.raw.coSolverGroups(this.handle)}containsPoint(e){let i=Be.intoRaw(e),s=this.colliderSet.raw.coContainsPoint(this.handle,i);return i.free(),s}projectPoint(e,i){let s=Be.intoRaw(e),r=kT.fromRaw(this.colliderSet.raw.coProjectPoint(this.handle,s,i));return s.free(),r}intersectsRay(e,i){let s=Be.intoRaw(e.origin),r=Be.intoRaw(e.dir),o=this.colliderSet.raw.coIntersectsRay(this.handle,s,r,i);return s.free(),r.free(),o}castShape(e,i,s,r,o,a,l){let c=Be.intoRaw(e),h=Be.intoRaw(s),u=Ji.intoRaw(r),d=Be.intoRaw(o),m=i.intoRaw(),f=y1.fromRaw(this.colliderSet,this.colliderSet.raw.coCastShape(this.handle,c,m,h,u,d,a,l));return c.free(),h.free(),u.free(),d.free(),m.free(),f}castCollider(e,i,s,r,o){let a=Be.intoRaw(e),l=Be.intoRaw(s),c=P3.fromRaw(this.colliderSet,this.colliderSet.raw.coCastCollider(this.handle,a,i.handle,l,r,o));return a.free(),l.free(),c}intersectsShape(e,i,s){let r=Be.intoRaw(i),o=Ji.intoRaw(s),a=e.intoRaw(),l=this.colliderSet.raw.coIntersectsShape(this.handle,a,r,o);return r.free(),o.free(),a.free(),l}contactShape(e,i,s,r){let o=Be.intoRaw(i),a=Ji.intoRaw(s),l=e.intoRaw(),c=g1.fromRaw(this.colliderSet.raw.coContactShape(this.handle,l,o,a,r));return o.free(),a.free(),l.free(),c}contactCollider(e,i){return g1.fromRaw(this.colliderSet.raw.coContactCollider(this.handle,e.handle,i))}castRay(e,i,s){let r=Be.intoRaw(e.origin),o=Be.intoRaw(e.dir),a=this.colliderSet.raw.coCastRay(this.handle,r,o,i,s);return r.free(),o.free(),a}castRayAndGetNormal(e,i,s){let r=Be.intoRaw(e.origin),o=Be.intoRaw(e.dir),a=DT.fromRaw(this.colliderSet.raw.coCastRayAndGetNormal(this.handle,r,o,i,s));return r.free(),o.free(),a}}(function(n){n[n.Density=0]="Density",n[n.Mass=1]="Mass",n[n.MassProps=2]="MassProps"})(Ay||(Ay={}));class wn{constructor(e){this.enabled=!0,this.shape=e,this.massPropsMode=Ay.Density,this.density=1,this.friction=.5,this.restitution=0,this.rotation=Ji.identity(),this.translation=Be.zeros(),this.isSensor=!1,this.collisionGroups=4294967295,this.solverGroups=4294967295,this.frictionCombineRule=hs.Average,this.restitutionCombineRule=hs.Average,this.activeCollisionTypes=XE.DEFAULT,this.activeEvents=VE.NONE,this.activeHooks=GG.NONE,this.mass=0,this.centerOfMass=Be.zeros(),this.contactForceEventThreshold=0,this.principalAngularInertia=Be.zeros(),this.angularInertiaLocalFrame=Ji.identity()}static ball(e){const i=new zG(e);return new wn(i)}static capsule(e,i){const s=new CK(e,i);return new wn(s)}static segment(e,i){const s=new MK(e,i);return new wn(s)}static triangle(e,i,s){const r=new EK(e,i,s);return new wn(r)}static roundTriangle(e,i,s,r){const o=new TK(e,i,s,r);return new wn(o)}static polyline(e,i){const s=new RK(e,i);return new wn(s)}static trimesh(e,i){const s=new IK(e,i);return new wn(s)}static cuboid(e,i,s){const r=new _K(e,i,s);return new wn(r)}static roundCuboid(e,i,s,r){const o=new SK(e,i,s,r);return new wn(o)}static heightfield(e,i,s,r){const o=new LK(e,i,s,r);return new wn(o)}static cylinder(e,i){const s=new PK(e,i);return new wn(s)}static roundCylinder(e,i,s){const r=new BK(e,i,s);return new wn(r)}static cone(e,i){const s=new kK(e,i);return new wn(s)}static roundCone(e,i,s){const r=new DK(e,i,s);return new wn(r)}static convexHull(e){const i=new FG(e,null);return new wn(i)}static convexMesh(e,i){const s=new FG(e,i);return new wn(s)}static roundConvexHull(e,i){const s=new NG(e,null,i);return new wn(s)}static roundConvexMesh(e,i,s){const r=new NG(e,i,s);return new wn(r)}setTranslation(e,i,s){if(typeof e!="number"||typeof i!="number"||typeof s!="number")throw TypeError("The translation components must be numbers.");return this.translation={x:e,y:i,z:s},this}setRotation(e){return Ji.copy(this.rotation,e),this}setSensor(e){return this.isSensor=e,this}setEnabled(e){return this.enabled=e,this}setDensity(e){return this.massPropsMode=Ay.Density,this.density=e,this}setMass(e){return this.massPropsMode=Ay.Mass,this.mass=e,this}setMassProperties(e,i,s,r){return this.massPropsMode=Ay.MassProps,this.mass=e,Be.copy(this.centerOfMass,i),Be.copy(this.principalAngularInertia,s),Ji.copy(this.angularInertiaLocalFrame,r),this}setRestitution(e){return this.restitution=e,this}setFriction(e){return this.friction=e,this}setFrictionCombineRule(e){return this.frictionCombineRule=e,this}setRestitutionCombineRule(e){return this.restitutionCombineRule=e,this}setCollisionGroups(e){return this.collisionGroups=e,this}setSolverGroups(e){return this.solverGroups=e,this}setActiveHooks(e){return this.activeHooks=e,this}setActiveEvents(e){return this.activeEvents=e,this}setActiveCollisionTypes(e){return this.activeCollisionTypes=e,this}setContactForceEventThreshold(e){return this.contactForceEventThreshold=e,this}}for(var BMe={byteLength:function(n){var e=GK(n),i=e[0],s=e[1];return 3*(i+s)/4-s},toByteArray:function(n){var e,i,s=GK(n),r=s[0],o=s[1],a=new ISe(function(h,u,d){return 3*(u+d)/4-d}(0,r,o)),l=0,c=o>0?r-4:r;for(i=0;i<c;i+=4)e=il[n.charCodeAt(i)]<<18|il[n.charCodeAt(i+1)]<<12|il[n.charCodeAt(i+2)]<<6|il[n.charCodeAt(i+3)],a[l++]=e>>16&255,a[l++]=e>>8&255,a[l++]=255&e;return o===2&&(e=il[n.charCodeAt(i)]<<2|il[n.charCodeAt(i+1)]>>4,a[l++]=255&e),o===1&&(e=il[n.charCodeAt(i)]<<10|il[n.charCodeAt(i+1)]<<4|il[n.charCodeAt(i+2)]>>2,a[l++]=e>>8&255,a[l++]=255&e),a},fromByteArray:function(n){for(var e,i=n.length,s=i%3,r=[],o=16383,a=0,l=i-s;a<l;a+=o)r.push(PSe(n,a,a+o>l?l:a+o));return s===1?(e=n[i-1],r.push($c[e>>2]+$c[e<<4&63]+"==")):s===2&&(e=(n[i-2]<<8)+n[i-1],r.push($c[e>>10]+$c[e>>4&63]+$c[e<<2&63]+"=")),r.join("")}},$c=[],il=[],ISe=typeof Uint8Array<"u"?Uint8Array:Array,UG="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",xy=0,LSe=UG.length;xy<LSe;++xy)$c[xy]=UG[xy],il[UG.charCodeAt(xy)]=xy;function GK(n){var e=n.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var i=n.indexOf("=");return i===-1&&(i=e),[i,i===e?0:4-i%4]}function PSe(n,e,i){for(var s,r,o=[],a=e;a<i;a+=3)s=(n[a]<<16&16711680)+(n[a+1]<<8&65280)+(255&n[a+2]),o.push($c[(r=s)>>18&63]+$c[r>>12&63]+$c[r>>6&63]+$c[63&r]);return o.join("")}il["-".charCodeAt(0)]=62,il["_".charCodeAt(0)]=63;const br=te("debugphysics"),VG=te("debugcolliderplacement"),XG=te("debugcollisions"),BSe=te("showcolliders"),WG=te("debugraycasts"),Fo=Symbol("needle component"),Ao=Symbol("physics body"),zK=Symbol("rigidbody");let yf;globalThis.false=globalThis.false!==void 0?globalThis.false:!0,br&&console.log("Use Rapier",!1,globalThis.false);const WE=class{constructor(){p(this,"debugRenderColliders",!1),p(this,"debugRenderRaycasts",!1),p(this,"context"),p(this,"_initializePromise"),p(this,"_isInitialized",!1),p(this,"rapierRay",new MSe({x:0,y:0,z:0},{x:0,y:0,z:1})),p(this,"raycastVectorsBuffer",new Qo(()=>new E,10)),p(this,"rapierSphere",null),p(this,"rapierColliderArray",[]),p(this,"rapierIdentityRotation",{x:0,y:0,z:0,w:1}),p(this,"rapierForwardVector",{x:0,y:0,z:1}),p(this,"enabled",!1),p(this,"_tempPosition",new E),p(this,"_tempQuaternion",new Se),p(this,"_tempScale",new E),p(this,"_tempMatrix",new he),p(this,"_isUpdatingPhysicsWorld",!1),p(this,"_world"),p(this,"_hasCreatedWorld",!1),p(this,"eventQueue"),p(this,"collisionHandler"),p(this,"objects",[]),p(this,"bodies",[]),p(this,"_meshCache",new Map),p(this,"_gravity",{x:0,y:-9.81,z:0}),p(this,"lines"),p(this,"_tempCenterPos",new E),p(this,"_tempCenterVec",new E),p(this,"_tempCenterQuaternion",new Se)}removeBody(n){var e,i,s;if(!n)return;this.validate();const r=n[Ao];if(n[Ao]=null,r&&this.world){const o=this.objects.findIndex(a=>a===n);if(o>=0){const a=this.bodies[o];if(this.bodies.splice(o,1),this.objects.splice(o,1),a instanceof OK){const l=a;(e=this.world)==null||e.removeCollider(l,!0);const c=l.parent();c&&c.numColliders()<=0&&(c[Fo]||(i=this.world)==null||i.removeRigidBody(c))}else a instanceof wK&&(a.numColliders()<=0?(s=this.world)==null||s.removeRigidBody(a):Ye()&&(a.did_log_removing||setTimeout(()=>{a.numColliders()>0&&(a.did_log_removing=!0,console.warn("RapierPhysics: removing rigidbody with colliders from the physics world is not possible right now, please remove the colliders first"))},1)))}}}updateBody(n,e,i){if(this.validate(),!!this.enabled&&!(n.destroyed||!n.gameObject)&&!(!e&&!i))if(n.isCollider===!0)console.warn("TODO: implement updating collider position");else{const s=n,r=s[Ao];r&&this.syncPhysicsBody(s.gameObject,r,e,i)}}updateProperties(n){if(this.validate(),n.isCollider){const e=n,i=e[Ao];i&&(this.internalUpdateColliderProperties(e,i),e.sharedMaterial&&this.updatePhysicsMaterial(e))}else{const e=n,i=this.internal_getRigidbody(e);i&&this.internalUpdateRigidbodyProperties(e,i)}}addForce(n,e,i){this.validate();const s=this.internal_getRigidbody(n);s?s.addForce(e,i):console.warn("Rigidbody doesn't exist: can not apply force (does your object with the Rigidbody have a collider?)")}addImpulse(n,e,i){this.validate();const s=this.internal_getRigidbody(n);s?s.applyImpulse(e,i):console.warn("Rigidbody doesn't exist: can not apply impulse (does your object with the Rigidbody have a collider?)")}getLinearVelocity(n){this.validate();const e=this.internal_getRigidbody(n);return e?e.linvel():null}getAngularVelocity(n){this.validate();const e=this.internal_getRigidbody(n);return e?e.angvel():null}resetForces(n,e){this.validate();const i=this.internal_getRigidbody(n);i?.resetForces(e)}resetTorques(n,e){this.validate();const i=this.internal_getRigidbody(n);i?.resetTorques(e)}applyImpulse(n,e,i){this.validate();const s=this.internal_getRigidbody(n);s?s.applyImpulse(e,i):console.warn("Rigidbody doesn't exist: can not apply impulse (does your object with the Rigidbody have a collider?)")}wakeup(n){this.validate();const e=this.internal_getRigidbody(n);e?e.wakeUp():console.warn("Rigidbody doesn't exist: can not wake up (does your object with the Rigidbody have a collider?)")}isSleeping(n){this.validate();const e=this.internal_getRigidbody(n);return e?.isSleeping()}setAngularVelocity(n,e,i){this.validate();const s=this.internal_getRigidbody(n);s?s.setAngvel(e,i):console.warn("Rigidbody doesn't exist: can not set angular velocity (does your object with the Rigidbody have a collider?)")}setLinearVelocity(n,e,i){this.validate();const s=this.internal_getRigidbody(n);s?s.setLinvel(e,i):console.warn("Rigidbody doesn't exist: can not set linear velocity (does your object with the Rigidbody have a collider?)")}async initialize(n){return this.context=n,this._initializePromise||(this._initializePromise=this.internalInitialization()),this._initializePromise}async internalInitialization(){return br&&console.log("Initialize rapier physics engine"),"env"in import.meta&&{}.VITE_NEEDLE_USE_RAPIER==="false"&&br&&console.log("Rapier disabled"),!1}validate(){this._isInitialized||br&&(this._lastWarnTime=this._lastWarnTime??0,Date.now()-this._lastWarnTime>1e3&&(this._lastWarnTime=Date.now(),console.warn("Physics engine is not initialized")))}raycast(n,e,i){var s;let r=i?.maxDistance,o=i?.solid;r===void 0&&(r=1/0),o===void 0&&(o=!0);const a=this.getPhysicsRay(this.rapierRay,n,e);if(!a)return null;(this.debugRenderRaycasts||WG)&&ft.DrawRay(a.origin,a.dir,255,1);const l=(s=this.world)==null?void 0:s.castRay(a,r,o,i?.queryFilterFlags,i?.filterGroups,void 0,void 0,c=>{const h=c[Fo];return i!=null&&i.filterPredicate?i.filterPredicate(h):i?.useIgnoreRaycastLayer!==!1?!(h!=null&&h.gameObject.layers.isEnabled(2)):!0});if(l){const c=a.pointAt(l.toi),h=this.raycastVectorsBuffer.get();return h.set(c.x,c.y,c.z),{point:h,collider:l.collider[Fo]}}return null}raycastAndGetNormal(n,e,i){var s;let r=i?.maxDistance,o=i?.solid;r===void 0&&(r=1/0),o===void 0&&(o=!0);const a=this.getPhysicsRay(this.rapierRay,n,e);if(!a)return null;(this.debugRenderRaycasts||WG)&&ft.DrawRay(a.origin,a.dir,255,1);const l=(s=this.world)==null?void 0:s.castRayAndGetNormal(a,r,o,i?.queryFilterFlags,i?.filterGroups,void 0,void 0,c=>{const h=c[Fo];return i!=null&&i.filterPredicate?i.filterPredicate(h):i?.useIgnoreRaycastLayer!==!1?!(h!=null&&h.gameObject.layers.isEnabled(2)):!0});if(l){const c=a.pointAt(l.toi),h=l.normal,u=this.raycastVectorsBuffer.get(),d=this.raycastVectorsBuffer.get();return u.set(c.x,c.y,c.z),d.set(h.x,h.y,h.z),{point:u,normal:d,collider:l.collider[Fo]}}return null}getPhysicsRay(n,e,i){var s,r,o;const a=(s=this.context)==null?void 0:s.mainCamera;if(e===void 0){const h=(r=this.context)==null?void 0:r.input.getPointerPosition(0);if(h)e=h;else return null}if(e.z===void 0){if(!a)return console.error("Can not perform raycast from 2d point - no main camera found"),null;const h=this.raycastVectorsBuffer.get();h.x=e.x,h.y=e.y,h.z=0,(h.x>1||h.y>1||h.y<-1||h.x<-1)&&(br&&console.warn("Converting screenspace to raycast space",h),(o=this.context)==null||o.input.convertScreenspaceToRaycastSpace(h)),h.unproject(a),e=h}const l=e;n.origin.x=l.x,n.origin.y=l.y,n.origin.z=l.z;const c=this.raycastVectorsBuffer.get();if(i)c.set(i.x,i.y,i.z);else{if(!a)return console.error("Can not perform raycast - no camera found"),null;c.set(n.origin.x,n.origin.y,n.origin.z);const h=zt(a);c.sub(h)}return c.normalize(),n.dir.x=c.x,n.dir.y=c.y,n.dir.z=c.z,n}sphereOverlap(n,e){return this.rapierColliderArray.length=0,this.world?(this.rapierSphere||(this.rapierSphere=new zG(e)),this.rapierSphere.radius=e,(this.debugRenderRaycasts||WG)&&ft.DrawWireSphere(n,e,3359999,1),this.world.intersectionsWithShape(n,this.rapierIdentityRotation,this.rapierSphere,i=>{const s=i[Fo],r=new wQ(s.gameObject,s);return this.rapierColliderArray.push(r),!0},void 0,void 0,void 0,void 0,i=>i.isSensor()?!1:i[Fo].gameObject.layers.isEnabled(2)==!1),this.rapierColliderArray):this.rapierColliderArray}get world(){return this._world}get isUpdating(){return this._isUpdatingPhysicsWorld}get gravity(){var n;return((n=this.world)==null?void 0:n.gravity)??this._gravity}set gravity(n){this.world?this.world.gravity=n:this._gravity=n}clearCaches(){var n,e,i,s;this._meshCache.clear(),(n=this.eventQueue)!=null&&n.raw&&((e=this.eventQueue)==null||e.free()),(i=this.world)!=null&&i.bodies&&((s=this.world)==null||s.free())}async addBoxCollider(n,e){if(this._isInitialized||await this.initialize(n.context),!n.activeAndEnabled)return;if(!this.enabled){br&&console.warn("Physics are disabled");return}const i=n.gameObject,s=Qi(i,this._tempPosition).multiply(e);s.multiplyScalar(.5),s.x<0&&(s.x=Math.abs(s.x)),s.y<0&&(s.y=Math.abs(s.y)),s.z<0&&(s.z=Math.abs(s.z)),s.x==0&&(s.x=1e-7),s.y==0&&(s.y=1e-7),s.z==0&&(s.z=1e-7);const r=wn.cuboid(s.x,s.y,s.z);this.createCollider(n,r)}async addSphereCollider(n){if(this._isInitialized||await this.initialize(n.context),!n.activeAndEnabled)return;if(!this.enabled){br&&console.warn("Physics are disabled");return}const e=wn.ball(.5);this.createCollider(n,e),this.updateProperties(n)}async addCapsuleCollider(n,e,i){if(this._isInitialized||await this.initialize(n.context),!n.activeAndEnabled)return;if(!this.enabled){br&&console.warn("Physics are disabled");return}const s=n.gameObject,r=Qi(s,this._tempPosition);r.x=Math.abs(r.x),r.y=Math.abs(r.y);const o=i*r.x;e=Math.max(e,o*2);const a=tt.clamp(e*.5*r.y-i*r.x,0,Number.MAX_SAFE_INTEGER),l=wn.capsule(a,o);this.createCollider(n,l)}async addMeshCollider(n,e,i,s){var r,o,a;if(this._isInitialized||await this.initialize(n.context),!n.activeAndEnabled)return;if(!this.enabled){br&&console.warn("Physics are disabled");return}let l=e.geometry;if(!l){br&&console.warn("Missing mesh geometry",e.name);return}(o=(r=l.index)==null?void 0:r.array)!=null&&o.length||(console.warn(`Your MeshCollider is missing vertices or indices in the assined mesh "${e.name}". Consider providing an indexed geometry.`),l=dpe(l));let c=l.getAttribute("position").array;const h=(a=l.index)==null?void 0:a.array;if(Math.abs(s.x-1)>1e-4||Math.abs(s.y-1)>1e-4||Math.abs(s.z-1)>1e-4){const d=l.uuid+"_"+s.x+"_"+s.y+"_"+s.z+"_"+i;if(this._meshCache.has(d))br&&console.warn("Use cached mesh collider"),c=this._meshCache.get(d);else{(br||Ye())&&console.warn(`Your MeshCollider "${n.name}" is scaled: consider applying the scale to the collider mesh instead (${s.x}, ${s.y}, ${s.z})`);const m=new Float32Array(c.length);for(let f=0;f<c.length;f+=3)m[f]=c[f]*s.x,m[f+1]=c[f+1]*s.y,m[f+2]=c[f+2]*s.z;c=m,this._meshCache.set(d,m)}}const u=i?wn.convexHull(c):wn.trimesh(c,h);u&&this.createCollider(n,u)}updatePhysicsMaterial(n){if(!n)return;const e=n.sharedMaterial,i=n[Ao];if(i&&e){if(e.bounciness!==void 0&&i.setRestitution(e.bounciness),e.bounceCombine!==void 0)switch(e.bounceCombine){case Us.Average:i.setRestitutionCombineRule(hs.Average);break;case Us.Maximum:i.setRestitutionCombineRule(hs.Max);break;case Us.Minimum:i.setRestitutionCombineRule(hs.Min);break;case Us.Multiply:i.setRestitutionCombineRule(hs.Multiply);break}if(e.dynamicFriction!==void 0&&i.setFriction(e.dynamicFriction),e.frictionCombine!==void 0)switch(e.frictionCombine){case Us.Average:i.setFrictionCombineRule(hs.Average);break;case Us.Maximum:i.setFrictionCombineRule(hs.Max);break;case Us.Minimum:i.setFrictionCombineRule(hs.Min);break;case Us.Multiply:i.setFrictionCombineRule(hs.Multiply);break}}}getBody(n){return n?n[Ao]:null}getComponent(n){return n?n[Fo]:null}createCollider(n,e){var i;if(!this.world)throw new Error("Physics world not initialized");const s=this._tempMatrix;let r;n.attachedRigidbody?r=this.getRigidbody(n,this._tempMatrix):(br&&console.log("Create collider without rigidbody",n.name),s.makeRotationFromQuaternion(ki(n.gameObject)),s.setPosition(zt(n.gameObject))),s.decompose(this._tempPosition,this._tempQuaternion,this._tempScale),this.tryApplyCenter(n,this._tempPosition),e.setTranslation(this._tempPosition.x,this._tempPosition.y,this._tempPosition.z),e.setRotation(this._tempQuaternion),e.setSensor(n.isTrigger);const o=n.sharedMaterial;if(o){if(o.bounciness!==void 0&&e.setRestitution(o.bounciness),o.bounceCombine!==void 0)switch(o.bounceCombine){case Us.Average:e.setRestitutionCombineRule(hs.Average);break;case Us.Maximum:e.setRestitutionCombineRule(hs.Max);break;case Us.Minimum:e.setRestitutionCombineRule(hs.Min);break;case Us.Multiply:e.setRestitutionCombineRule(hs.Multiply);break}if(o.dynamicFriction!==void 0&&e.setFriction(o.dynamicFriction),o.frictionCombine!==void 0)switch(o.frictionCombine){case Us.Average:e.setFrictionCombineRule(hs.Average);break;case Us.Maximum:e.setFrictionCombineRule(hs.Max);break;case Us.Minimum:e.setFrictionCombineRule(hs.Min);break;case Us.Multiply:e.setFrictionCombineRule(hs.Multiply);break}}((i=n.attachedRigidbody)==null?void 0:i.autoMass)===!1&&(e.setDensity(1e-6),e.setMass(1e-6));try{const a=this.world.createCollider(e,r);return a[Fo]=n,n[Ao]=a,a.setActiveEvents(VE.COLLISION_EVENTS),a.setActiveCollisionTypes(XE.ALL),this.objects.push(n),this.bodies.push(a),this.updateColliderCollisionGroups(n),a}catch(a){return console.error('Error creating collider "'+n.name+`"
Error:`,a),null}}updateColliderCollisionGroups(n){const e=n[Ao],i=n.membership;let s=0;if(i==null)s=65535;else for(let a=0;a<i.length;a++){const l=i[a];l>31?console.error(`Rapier only supports 32 layers, layer ${l} is not supported`):s|=1<<Math.floor(l)}const r=n.filter;let o=0;if(r==null)o=65535;else for(let a=0;a<r.length;a++){const l=r[a];l>31?console.error(`Rapier only supports 32 layers, layer ${l} is not supported`):o|=1<<Math.floor(l)}e.setCollisionGroups(s<<16|o)}getRigidbody(n,e){if(!this.world)throw new Error("Physics world not initialized");let i=null;if(n.attachedRigidbody){const s=n.attachedRigidbody;if(i=s[Ao],!i){const r=s.isKinematic&&!VG;br&&console.log("Create rigidbody",r);const o=r?yf.RigidBodyDesc.kinematicPositionBased():yf.RigidBodyDesc.dynamic(),a=zt(n.attachedRigidbody.gameObject);o.setTranslation(a.x,a.y,a.z),o.setRotation(ki(n.attachedRigidbody.gameObject)),o.centerOfMass=new yf.Vector3(s.centerOfMass.x,s.centerOfMass.y,s.centerOfMass.z),i=this.world.createRigidBody(o),this.bodies.push(i),this.objects.push(s)}i[Fo]=s,s[Ao]=i,this.internalUpdateRigidbodyProperties(s,i),this.getRigidbodyRelativeMatrix(n.gameObject,s.gameObject,e),n[zK]=i}else{const s=yf.RigidBodyDesc.kinematicPositionBased(),r=zt(n.gameObject);s.setTranslation(r.x,r.y,r.z),s.setRotation(ki(n.gameObject)),i=this.world.createRigidBody(s),e.identity(),i[Fo]=null}return i}internal_getRigidbody(n){return n.isCollider===!0?n[zK]:n[Ao]}internalUpdateColliderProperties(n,e){const i=e.shape;let s=!1;switch(i.type){case Zn.Ball:{const d=i,m=n,f=n.gameObject,g=Qi(f,this._tempPosition),y=Math.abs(m.radius*g.x);s=d.radius!==y,d.radius=y,s&&e.setShape(d);break}case Zn.Cuboid:const r=i,o=n,a=n.gameObject,l=Qi(a,this._tempPosition),c=o.size.x*.5*l.x,h=o.size.y*.5*l.y,u=o.size.z*.5*l.z;s=r.halfExtents.x!==c||r.halfExtents.y!==h||r.halfExtents.z!==u,r.halfExtents.x=c,r.halfExtents.y=h,r.halfExtents.z=u,s&&e.setShape(r);break}if(s){const r=n.attachedRigidbody;if(r!=null&&r.autoMass){const o=this.getBody(r);o?.recomputeMassPropertiesFromColliders()}}this.updateColliderCollisionGroups(n),n.isTrigger!==e.isSensor()&&e.setSensor(n.isTrigger)}internalUpdateRigidbodyProperties(n,e){if(e.enableCcd(n.collisionDetectionMode!==JC.Discrete),e.setLinearDamping(n.drag),e.setAngularDamping(n.angularDrag),e.setGravityScale(n.useGravity?n.gravityScale:0,!0),n.dominanceGroup<=127&&n.dominanceGroup>=-127?e.setDominanceGroup(Math.floor(n.dominanceGroup)):e.setDominanceGroup(0),n.autoMass){e.setAdditionalMass(0,!1);for(let i=0;i<e.numColliders();i++)e.collider(i).setDensity(1);e.recomputeMassPropertiesFromColliders()}else{e.setAdditionalMass(n.mass,!1);for(let i=0;i<e.numColliders();i++)e.collider(i).setDensity(1e-7);e.recomputeMassPropertiesFromColliders()}e.setEnabledRotations(!n.lockRotationX,!n.lockRotationY,!n.lockRotationZ,!1),e.setEnabledTranslations(!n.lockPositionX,!n.lockPositionY,!n.lockPositionZ,!1),n.isKinematic?e.setBodyType(yf.RigidBodyType.KinematicPositionBased,!1):e.setBodyType(yf.RigidBodyType.Dynamic,!1)}step(n){if(this.world&&this.enabled){if(this._isUpdatingPhysicsWorld=!0,this.eventQueue||(this.eventQueue=new RSe(!1)),n===void 0||n<=0){this._isUpdatingPhysicsWorld=!1;return}else n!==void 0&&(this.world.timestep=tt.lerp(this.world.timestep,n,.8));try{this.world.step(this.eventQueue)}catch(e){console.warn("Error running physics step",e)}this._isUpdatingPhysicsWorld=!1}}postStep(){this.world&&this.enabled&&(this._isUpdatingPhysicsWorld=!0,this.syncObjects(),this._isUpdatingPhysicsWorld=!1,this.eventQueue&&!this.collisionHandler&&(this.collisionHandler=new kSe(this.world,this.eventQueue)),this.collisionHandler&&(this.collisionHandler.handleCollisionEvents(),this.collisionHandler.update()),this.updateDebugRendering(this.world))}updateDebugRendering(n){var e,i,s,r;if(br||VG||BSe||this.debugRenderColliders===!0){if(!this.lines){const a=new Vi({color:7855479,fog:!1}),l=new dt;this.lines=new Ir(l,a),this.lines.layers.disableAll(),this.lines.layers.enable(2)}this.lines.parent!==((e=this.context)==null?void 0:e.scene)&&((i=this.context)==null||i.scene.add(this.lines));const o=n.debugRender();this.lines.geometry.setAttribute("position",new qe(o.vertices,3)),this.lines.geometry.setAttribute("color",new qe(o.colors,4)),(this.context.time.frame%30===0||((s=this.lines.geometry.boundingSphere)==null?void 0:s.radius)===0)&&this.lines.geometry.computeBoundingSphere()}else this.lines&&((r=this.context)==null||r.scene.remove(this.lines))}syncObjects(){if(!VG)for(let n=0;n<this.bodies.length;n++){const e=this.objects[n],i=this.bodies[n],s=e;if(s?.isCollider===!0&&!s.attachedRigidbody){const l=i.parent();l?this.syncPhysicsBody(e.gameObject,l,!0,!0):this.syncPhysicsBody(e.gameObject,i,!0,!0);continue}const r=i.translation(),o=i.rotation();if(Number.isNaN(r.x)||Number.isNaN(o.x)){!s.__COLLIDER_NAN&&Ye()&&(console.warn("Collider has NaN values",s.name,s.gameObject,i),s.__COLLIDER_NAN=!0);continue}const a=e.center;if(a&&a.isVector3){this._tempQuaternion.set(o.x,o.y,o.z,o.w);const l=this._tempPosition.copy(a).applyQuaternion(this._tempQuaternion),c=Qi(e.gameObject);l.multiply(c),r.x-=l.x,r.y-=l.y,r.z-=l.z}$p(e.gameObject,r.x,r.y,r.z),nL(e.gameObject,o.x,o.y,o.z,o.w)}}syncPhysicsBody(n,e,i,s){if(e instanceof wK){const r=zt(n,this._tempPosition),o=ki(n,this._tempQuaternion);switch(e.bodyType()){case Jx.Fixed:case Jx.KinematicPositionBased:case Jx.KinematicVelocityBased:i&&e.setNextKinematicTranslation(r),s&&e.setNextKinematicRotation(o);break;default:i&&e.setTranslation(r,!1),s&&e.setRotation(o,!1);break}}else if(e instanceof OK){n.matrixWorldNeedsUpdate&&n.updateWorldMatrix(!0,!1),n.matrixWorld.decompose(this._tempPosition,this._tempQuaternion,this._tempScale);const r=this._tempPosition,o=this._tempQuaternion,a=e[Fo];if(this.tryApplyCenter(a,r),i){const l=e.translation();(l.x!==r.x||l.y!==r.y||l.z!==r.z)&&e.setTranslation(r)}if(s){const l=e.rotation();(l.x!==o.x||l.y!==o.y||l.z!==o.z||l.w!==o.w)&&e.setRotation(o)}}}tryApplyCenter(n,e){const i=n.center;i&&n.gameObject&&(i.x!==0||i.y!==0||i.z!==0)&&(this._tempCenterPos.x=i.x,this._tempCenterPos.y=i.y,this._tempCenterPos.z=i.z,Qi(n.gameObject,this._tempCenterVec),this._tempCenterPos.multiply(this._tempCenterVec),n.attachedRigidbody?this._tempCenterPos.applyQuaternion(n.gameObject.quaternion):(ki(n.gameObject,this._tempCenterQuaternion),this._tempCenterPos.applyQuaternion(this._tempCenterQuaternion)),e.x+=this._tempCenterPos.x,e.y+=this._tempCenterPos.y,e.z+=this._tempCenterPos.z)}getRigidbodyRelativeMatrix(n,e,i,s){if(s===void 0&&(s=WE._matricesBuffer,s.length=0),n===e){const r=Qi(n,this._tempPosition);i.makeScale(r.x,r.y,r.z);for(let o=s.length-1;o>=0;o--)i.multiply(s[o]);return i}return s.push(n.matrix),n.parent&&this.getRigidbodyRelativeMatrix(n.parent,e,i,s),i}addFixedJoint(n,e){if(!this.world){console.error("Physics world not initialized");return}const i=n[Ao],s=e[Ao];this.calculateJointRelativeMatrices(n.gameObject,e.gameObject,this._tempMatrix),this._tempMatrix.decompose(this._tempPosition,this._tempQuaternion,this._tempScale);const r=vu.fixed(WE.centerConnectionPos,WE.centerConnectionRot,this._tempPosition,this._tempQuaternion),o=this.world.createImpulseJoint(r,i,s,!0);br&&console.log("ADD FIXED JOINT",o)}addHingeJoint(n,e,i,s){if(!this.world){console.error("Physics world not initialized");return}const r=n[Ao],o=e[Ao];this.calculateJointRelativeMatrices(n.gameObject,e.gameObject,this._tempMatrix),this._tempMatrix.decompose(this._tempPosition,this._tempQuaternion,this._tempScale);const a=yf.JointData.revolute(i,this._tempPosition,s),l=this.world.createImpulseJoint(a,r,o,!0);br&&console.log("ADD HINGE JOINT",l)}calculateJointRelativeMatrices(n,e,i){n.updateWorldMatrix(!0,!1),e.updateWorldMatrix(!0,!1);const s=n.matrixWorld,r=e.matrixWorld;s.elements[0]=1,s.elements[5]=1,s.elements[10]=1,r.elements[0]=1,r.elements[5]=1,r.elements[10]=1,i.copy(r).premultiply(s.invert()).invert()}};let qx=WE;p(qx,"_didLoadPhysicsEngine",!1),p(qx,"_matricesBuffer",[]),p(qx,"centerConnectionPos",{x:0,y:0,z:0}),p(qx,"centerConnectionRot",{x:0,y:0,z:0,w:1});class kSe{constructor(e,i){p(this,"world"),p(this,"eventQueue"),p(this,"activeCollisions",[]),p(this,"activeCollisionsStay",[]),p(this,"activeTriggers",[]),this.world=e,this.eventQueue=i}handleCollisionEvents(){this.eventQueue&&this.world&&this.eventQueue.drainCollisionEvents((e,i,s)=>{const r=this.world.getCollider(e),o=this.world.getCollider(i);if(!r||!o)return;const a=r[Fo],l=o[Fo];XG&&console.log("EVT",a.name,l.name,s,r,o),a&&l&&(s?(this.onCollisionStarted(a,r,l,o),this.onCollisionStarted(l,o,a,r)):(this.onCollisionEnded(a,l),this.onCollisionEnded(l,a)))})}update(){this.onHandleCollisionStay()}onCollisionStarted(e,i,s,r){let o=null;if(e.isTrigger||s.isTrigger)Tm(e.gameObject,a=>{a.onTriggerEnter&&!a.destroyed&&a.onTriggerEnter(s),this.activeTriggers.push({collider:e,component:a,otherCollider:s})});else{const a=e.gameObject;this.world.contactPair(i,r,(l,c)=>{Tm(a,h=>{var u;if(h.destroyed)return;const d=h.onCollisionEnter||h.onCollisionStay||h.onCollisionExit;if(d||XG){if(!o){const m=[],f=l.normal();for(let g=0;g<l.numSolverContacts();g++){const y=l.solverContactPoint(g),v=l.contactImpulse(g);if(y){const b=l.contactDist(g),A=l.solverContactFriction(g),x=l.solverContactTangentVelocity(g),w=new AQ(y,b,f,v,A,x);m.push(w),XG&&ft.DrawDirection(y,f,16711680,3,!0)}}o=new xQ(a,s,m)}if(d){const m={collider:e,component:h,collision:o};this.activeCollisions.push(m),h.onCollisionStay&&this.activeCollisionsStay.push(m),(u=h.onCollisionEnter)==null||u.call(h,o)}}})})}}onHandleCollisionStay(){for(const e of this.activeCollisionsStay){const i=e.component;if(!i.destroyed&&i.activeAndEnabled&&i.onCollisionStay){if(e.collision.collider.destroyed)continue;const s=e.collision;i.onCollisionStay(s)}}for(const e of this.activeTriggers){const i=e.component;if(!i.destroyed&&i.activeAndEnabled&&i.onTriggerStay){const s=e.otherCollider;if(s.destroyed)continue;i.onTriggerStay(s)}}}onCollisionEnded(e,i){if(!(e.destroyed||i.destroyed)){for(let s=0;s<this.activeCollisions.length;s++){const r=this.activeCollisions[s],o=r.collider;if(o.destroyed||r.collision.collider.destroyed){this.activeCollisions.splice(s,1),s--;continue}if(o===e&&r.collision.collider===i){const a=r.component;if(this.activeCollisions.splice(s,1),s--,a.activeAndEnabled&&a.onCollisionExit){const l=r.collision;a.onCollisionExit(l)}}}for(let s=0;s<this.activeCollisionsStay.length;s++){const r=this.activeCollisionsStay[s],o=r.collider;if(o.destroyed||r.collision.collider.destroyed){this.activeCollisionsStay.splice(s,1),s--;continue}if(o===e&&r.collision.collider===i){const a=r.component;if(this.activeCollisionsStay.splice(s,1),s--,a.activeAndEnabled&&a.onCollisionExit){const l=r.collision;a.onCollisionExit(l)}}}for(let s=0;s<this.activeTriggers.length;s++){const r=this.activeTriggers[s],o=r.collider;if(o.destroyed||r.otherCollider.destroyed){this.activeTriggers.splice(s,1),s--;continue}if(o===e&&r.otherCollider===i){const a=r.component;if(this.activeTriggers.splice(s,1),s--,a.activeAndEnabled&&a.onTriggerExit){const l=r.otherCollider;a.onTriggerExit(l)}}}}}}class DSe{static async createComparisonScene(e){const{files:i}=e,s=await Promise.all(i.map(g=>new ei(g).loadAssetAsync())),r=new Ls;let o=0;for(const g of s)if(g instanceof ye){g.position.y=o,r.add(g);const y=Ba([g]);o+=y.getSize(new E).y,o+=.1}const a=new Lt(20);r.add(a);const l=e.environment||"https://dl.polyhaven.org/file/ph-assets/HDRIs/exr/1k/studio_small_09_1k.exr";if(l){let g=null;if(l.endsWith(".hdr")){const y=(await Promise.resolve().then(()=>kfe)).RGBELoader;g=new y}else if(l.endsWith(".exr")){const y=(await Promise.resolve().then(()=>Bfe)).EXRLoader;g=new y}if(g){const y=await g.loadAsync(l).catch(v=>(console.error(v),null));y&&(y.mapping=Kr,y.needsUpdate=!0,r.background=y,r.environment=y,r.backgroundBlurriness=.75)}else console.warn("Unsupported environment map format",l)}const c=Ba(r.children),h=c.getCenter(new E),u=c.getSize(new E),d=Math.max(u.x,u.y,u.z)/(2*Math.tan(Math.PI*a.fov/360));a.position.set(h.x,h.y,d),a.lookAt(h);const m=new tQ(a,e.domElement||document.body);m.target=h,m.update();const f=(e.domElement||document.body).getBoundingClientRect();return a.aspect=f.width/f.height,a.updateProjectionMatrix(),{scene:r,camera:a}}}function OSe(n,e,i,s="image/webp",r){return FK({context:n,width:e,height:i,mimeType:s,camera:r})}function FK(n){n||(n={});const{mimeType:e="image/png",transparent:i=!1}=n;let{context:s,width:r,height:o,camera:a}=n;if(!s&&(s=yi.Current,!s))return console.error("Can not save screenshot: No needle-engine context found or provided."),null;if(!a&&(a=s.mainCamera,!a))return console.error("No camera found"),null;const l=s.renderer.domElement.width,c=s.renderer.domElement.height;r||(r=l),o||(o=c);const h=window.devicePixelRatio||1;r/=h,o/=h;const u=s.renderer.xr.enabled;s.renderer.xr.enabled=!1,s.renderer.domElement.style.width=r+"px",s.renderer.domElement.style.height=o+"px";const d=s.renderer.getRenderTarget(),m=s.renderer.getClearColor(new Ae),f=s.renderer.getClearAlpha(),g=s.scene.background,y="aspect"in a?a.aspect:null;try{const v=s.renderer.domElement,b=n.render_events!==!1,A=new Array;b&&(l0(s.scene,kn,A),A.forEach(S=>S?.onBeforeRender())),i&&(s.scene.background=null,s.renderer.setClearColor(0,0)),n.background&&(s.scene.background=null,s.renderer.setClearColor(n.background),n.background instanceof Ii&&s.renderer.setClearAlpha(n.background.a)),i&&s.renderer.setClearAlpha(0),s.renderer.setSize(r,o,!1),"cam"in a&&(a=a.threeCamera),a instanceof Lt&&(a.aspect=r/o,a.updateProjectionMatrix());const x="type"in n&&n.type==="texture";let w=null;if(x&&(w=new Zt(r,o,{wrapS:oh,wrapT:oh,format:1023}),s.renderer.setRenderTarget(w)),s.renderNow(a||null),b&&A.forEach(S=>S.onAfterRender()),"type"in n){if(n.type==="texture")return w?(n.target&&(n.target.image=w?.texture.image,n.target.needsUpdate=!0),w.texture.offset.set(0,-1),w.texture.needsUpdate=!0,w.texture):(console.error("No target texture found"),null);if(n.type==="blob")return new Promise((S,M)=>{v.toBlob(R=>{S(R)},e)})}const _=v.toDataURL(e);return"download_filename"in n&&n.download_filename&&NK(_,n.download_filename),_}finally{s.renderer.setRenderTarget(d),s.scene.background=g,s.renderer.setSize(l,c,!1),s.updateSize(!0),s.renderer.setClearColor(m,f),y!=null&&a instanceof Lt&&(a.aspect=y,a.updateProjectionMatrix()),s.renderer.xr.enabled=u}return null}let $x=null;function NK(n,e){if(n){if(!n.startsWith("data:image")){console.error("Can not save image: Data url is not an image",n);return}$x||($x=document.createElement("a")),$x.href=n,$x.download=e,$x.click()}}let HG=0;function UK(n){n?HG++:HG--}function GSe(){return HG>0}class VK{constructor(e){p(this,"writer"),this.writer=e}writeNode(e){}}class zSe extends VK{beforeWriteNode(e,i){ft.isGizmo(e)&&(i.keep=!1)}}class FSe extends VK{beforeWriteTexture(e,i){e.isRenderTargetTexture&&(i.newTexture=bk(new Ii(1,1,1,0)))}}const NSe={binary:!0,animations:!0};async function USe(n){if(!n.context)throw new Error("No context provided to exportAsGLTF");n.scene||(n.scene=n.context.scene);const e={...NSe,...n},{context:i}=e,s=new eE;s.register(l=>new kZ(l)),s.register(l=>new zSe(l)),s.register(l=>new FSe(l)),$D(s,e.context);const r={binary:e.binary,animations:XSe(i,e.scene,[])},o=new VSe;console.log("Exporting GLTF",r),o.onBeforeExport(e),UK(!0);const a=await s.parseAsync(e.scene,r).catch(l=>(console.error(l),null));if(UK(!1),o.onAfterExport(e),!a)throw new Error("Failed to export GLTF");if(e.downloadAs!=null){let l=null;if(a instanceof ArrayBuffer?l=new Blob([a],{type:"application/octet-stream"}):console.error("Can not download GLTF as a blob",a),l){const c=URL.createObjectURL(l),h=document.createElement("a");h.href=c;let u=e.downloadAs;!u.endsWith(".glb")&&!u.endsWith(".gltf")&&(u+=e.binary?".glb":".gltf"),h.download=u,h.click()}}return a}const XK=Symbol("needle:weight");class VSe{constructor(){p(this,"_undo",[])}onBeforeExport(e){e.context.animations.mixers.forEach(i=>{const s=d0.tryGetActionsFromMixer(i);if(s)for(let r=0;r<s.length;r++){const o=s[r];o[XK]=o.weight,o.weight=0,this._undo.push(()=>{o.weight=o[XK]})}i.update(0)})}onAfterExport(e){this._undo.forEach(i=>i()),this._undo.length=0}}function XSe(n,e,i){n.animations.mixers.forEach(r=>{const o=d0.tryGetActionsFromMixer(r);if(o)for(let a=0;a<o.length;a++){const l=o[a].getClip();i.push(l)}}),Array.isArray(e)||(e=[e]);for(const r of e)d0.tryGetAnimationClipsFromObjectHierarchy(r,i);const s=new Set(i);return Array.from(s)}const WK="needle-button",jG=Ye();var vf,bf,Af,No,Ql,wy,QG,HK,ZG,jK,HE;class YG extends HTMLElement{constructor(){super(),Ea(this,QG),Ea(this,ZG),Ea(this,vf,void 0),Ea(this,bf,void 0),Ea(this,Af,void 0),Ea(this,No,void 0),Ea(this,Ql,void 0),Ea(this,wy,void 0),Ea(this,HE,e=>{jG&&console.log("Needle Button clicked"),!e.defaultPrevented&&Ai(this,No)&&Ai(this,No).click()}),this.removeEventListener("click",Ai(this,HE)),this.addEventListener("click",Ai(this,HE))}attributeChangedCallback(e,i,s){Mf(this,QG,HK).call(this)}}vf=new WeakMap,bf=new WeakMap,Af=new WeakMap,No=new WeakMap,Ql=new WeakMap,wy=new WeakMap,QG=new WeakSet,HK=function(){var n,e;if((n=Ai(this,No))==null||n.remove(),this.getAttribute("ar")!=null)Ai(this,Ql)??ql(this,Ql,new Km),ql(this,No,Ai(this,Ql).createARButton());else if(this.getAttribute("vr")!=null)Ai(this,Ql)??ql(this,Ql,new Km),ql(this,No,Ai(this,Ql).createVRButton());else if(this.getAttribute("quicklook")!=null)Ai(this,Ql)??ql(this,Ql,new Km),ql(this,No,Ai(this,Ql).createQuicklookButton());else{jG?console.warn("No button type specified for <needle-button>. Use either ar, vr or quicklook attribute."):console.debug("No button type specified for <needle-button>. Use either ar, vr or quicklook attribute.");return}Ai(this,vf)??ql(this,vf,this.attachShadow({mode:"open"})),Ai(this,bf)??ql(this,bf,document.createElement("slot")),Ai(this,Af)??ql(this,Af,document.createElement("style")),Ai(this,Af).innerHTML=`
            button {
                all: initial;
                cursor: inherit;
                color: inherit;
                font-family: inherit;
                gap: inherit;
                white-space: nowrap;
            }
        `,this.getAttribute("unstyled")!=null||(Ai(this,Af).innerHTML+=`
            :host {
                display: inline-block;
                background: rgba(255, 255, 255, .8);
                backdrop-filter: blur(10px);
                width: fit-content;
                transition: background .2s;

                cursor: pointer;
                padding: 0.4rem .5rem;
                border-radius: 0.8rem;
                color: black;
                background: rgba(245, 245, 245, .8);
                outline: rgba(0,0,0,.05) 1px solid;
            }
            :host(:hover) {
                background: rgba(255, 255, 255, 1);
                transition: background .2s;
            }
            slot {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: .5rem;
            }
`),Ai(this,bf).innerHTML=Ai(this,No).innerHTML,Ai(this,bf).style.cssText="display: flex; align-items: center; justify-content: center;",Ai(this,No).innerHTML=Ai(this,bf).outerHTML,Ai(this,vf).innerHTML=Ai(this,No).outerHTML,Ai(this,vf).prepend(Ai(this,Af)),RC(Sk,{element:Ai(this,vf)}),(e=Ai(this,wy))==null||e.disconnect(),Ai(this,wy)??ql(this,wy,new MutationObserver(()=>Mf(this,ZG,jK).call(this))),Ai(this,wy).observe(Ai(this,No),{attributes:!0}),jG&&console.log("Needle Button updated")},ZG=new WeakSet,jK=function(){Ai(this,No)&&(Ai(this,No).style.display==="none"?this.style.display="none":this.style.display==="none"&&(this.style.display=""))},HE=new WeakMap,p(YG,"observedAttributes",["ar","vr","quicklook"]),typeof window<"u"&&!window.customElements.get(WK)&&window.customElements.define(WK,YG);const jE=te("debugmissingcamera");yi.registerCallback(wi.MissingCamera,n=>{var e,i,s;jE&&console.warn("Creating missing camera");const r=n.context.scene,o=new Lt;o.name="Default Fallback Camera",r.add(o);const a=new Fi;a.sourceId=((i=(e=n.files)==null?void 0:e[0])==null?void 0:i.src)??"unknown",(s=n.context.domElement.getAttribute("skybox-image"))!=null&&s.length||0>0||n.context.lightmaps.tryGetSkybox(a.sourceId)?a.clearFlags=Id.Skybox:a.clearFlags=Id.SolidColor,a.backgroundColor=new Ii(.5,.5,.5,1),a.fieldOfView=35,n.context.domElement.getAttribute("transparent")!=null&&(a.clearFlags=Id.Uninitialized),a.backgroundBlurriness=.2;const l=Cm(o,a,!0);o.position.x=0,o.position.y=1,o.position.z=2;const c=n.context.domElement;return c?.cameraControls!=!1&&QK(n.context,l),l}),yi.registerCallback(wi.ContextCreated,n=>{if(!n.context.mainCamera){jE&&console.log("Will not auto-fit because a default camera exists");return}const e=n.context.domElement;if(e?.cameraControls==!0){const i=w5(n.context.mainCamera);if(i?.isCameraController==!0){jE&&console.log("Will not auto-fit because a camera controller exists");return}QK(n.context)}});function QK(n,e){e=e??n.mainCameraComponent;const i=e?.gameObject;if(jE&&console.log("Creating default camera controls",e?.name),i){const s=Kb(i,Ei);s.sourceId=e?.sourceId??"unknown";const r=n.domElement.getAttribute("auto-rotate");if(s.autoRotate=r!=null&&r!="0"&&r?.toLowerCase()!="false",s.autoRotateSpeed=.5,s.autoFit=!0,s.autoRotate&&r){const o=parseFloat(r);isNaN(o)||(s.autoRotateSpeed=o)}}else console.warn("Missing camera object, can not add orbit controls")}yi.registerCallback(wi.ContextCreated,n=>{const e=n.context.domElement.getAttribute("autoplay");if(e!==void 0&&(e===""||e==="true"||e==="1")&&n.files)for(const i of n.files)ie.foreachComponent(i.file.scene,s=>{if(s.enabled!==!1){if(s instanceof Fr&&s.playAutomatically||s instanceof rr||s instanceof kd&&s.playOnAwake===!0)return!0;if(s instanceof Fr)return s.playAutomatically=!0,!0;if(s instanceof kd)return s.playOnAwake=!0,!0}},!0)!==!0&&d0.assignAnimationsFromFile(i.file,{createAnimationComponent:(s,r)=>ta(s,Fr)})});const xf={Context:Pt,glTF:{loadFromURL:kG}};globalThis.Needle!==void 0&&console.warn("Needle Engine is already imported"),globalThis.Needle=xf;function ZK(n){for(const e in n)xf[e]=n[e]}ZK(e0e),ZK($_e),xf.onStart=tD,xf.onUpdate=iD,xf.onBeforeRender=iQ,xf.NeedleXRSession=Et;for(const n of Object.getOwnPropertyNames(ie))switch(n){case"prototype":case"constructor":case"length":case"name":continue;default:xf[n]=ie[n];break}globalThis.THREE?console.warn("Threejs is already imported"):globalThis.THREE=hie;class WSe{constructor(e){if(this._retries=0,!Number.isInteger(e)||e<0)throw new Error("Backoff must be a positive integer");this.backoff=e}get retries(){return this._retries}get current(){return this.backoff}next(){return this._retries++,this.backoff}reset(){this._retries=0}}class HSe{constructor(e,i){if(this._retries=0,!Number.isInteger(e)||e<0)throw new Error("Base must be a positive integer or zero");if(i!==void 0&&(!Number.isInteger(i)||i<0))throw new Error("ExpMax must be a undefined, a positive integer or zero");this.base=e,this.expMax=i,this.i=0}get retries(){return this._retries}get current(){return this.base*Math.pow(2,this.i)}next(){return this._retries++,this.i=this.expMax===void 0?this.i+1:Math.min(this.i+1,this.expMax),this.current}reset(){this._retries=0,this.i=0}}class jSe{constructor(e,i,s){if(this.i=0,this._retries=0,e<0)throw new Error("Initial must be a positive number or zero");if(i<0)throw new Error("Increment must be a positive number or zero");if(s!==void 0&&s<0)throw new Error("Max must be undefined, a positive number or zero");if(s!==void 0&&s<e)throw new Error("Max must be undefined or greater than or equal to initial");this.initial=e,this.increment=i,this.max=s}get retries(){return this._retries}get current(){return this.max===void 0?this.initial+this.increment*this.i:Math.min(this.initial+this.increment*this.i,this.max)}next(){return this._retries++,this.i++,this.current}reset(){this._retries=0,this.i=0}}class QSe{constructor(){this.elements=[]}add(e){this.elements.push(e)}clear(){this.elements.length=0}forEach(e){this.elements.forEach(e)}length(){return this.elements.length}isEmpty(){return this.elements.length===0}peek(){return this.elements[0]}read(){return this.elements.shift()}}class ZSe{constructor(e){if(!Number.isInteger(e)||e<=0)throw new Error("Capacity must be a positive integer");this.elements=new Array(e+1),this.head=0,this.tail=0}add(e){this.elements[this.head]=e,this.head=(this.head+1)%this.elements.length,this.head===this.tail&&(this.tail=(this.tail+1)%this.elements.length)}clear(){this.head=0,this.tail=0}forEach(e){for(let i=this.tail;i!==this.head;i=(i+1)%this.elements.length)e(this.elements[i])}length(){return this.tail===this.head?0:this.tail<this.head?this.head-this.tail:this.elements.length-this.tail+this.head}isEmpty(){return this.head===this.tail}peek(){return this.isEmpty()?void 0:this.elements[this.tail]}read(){const e=this.peek();return e!==void 0&&(this.tail=(this.tail+1)%this.elements.length),e}}var Ni;(function(n){n.open="open",n.close="close",n.error="error",n.message="message",n.retry="retry",n.reconnect="reconnect"})(Ni||(Ni={}));class YK{constructor(e,i,s){var r,o,a,l,c,h,u,d,m,f,g,y,v,b,A;this._closedByUser=!1,this.handleOpenEvent=x=>this.handleEvent(Ni.open,x),this.handleErrorEvent=x=>this.handleEvent(Ni.error,x),this.handleCloseEvent=x=>this.handleEvent(Ni.close,x),this.handleMessageEvent=x=>this.handleEvent(Ni.message,x),this._url=e,this._protocols=i,this._options={buffer:s?.buffer,retry:{maxRetries:(r=s?.retry)===null||r===void 0?void 0:r.maxRetries,instantReconnect:(o=s?.retry)===null||o===void 0?void 0:o.instantReconnect,backoff:(a=s?.retry)===null||a===void 0?void 0:a.backoff},listeners:{open:[...(c=(l=s?.listeners)===null||l===void 0?void 0:l.open)!==null&&c!==void 0?c:[]],close:[...(u=(h=s?.listeners)===null||h===void 0?void 0:h.close)!==null&&u!==void 0?u:[]],error:[...(m=(d=s?.listeners)===null||d===void 0?void 0:d.error)!==null&&m!==void 0?m:[]],message:[...(g=(f=s?.listeners)===null||f===void 0?void 0:f.message)!==null&&g!==void 0?g:[]],retry:[...(v=(y=s?.listeners)===null||y===void 0?void 0:y.retry)!==null&&v!==void 0?v:[]],reconnect:[...(A=(b=s?.listeners)===null||b===void 0?void 0:b.reconnect)!==null&&A!==void 0?A:[]]}},this._underlyingWebsocket=this.tryConnect()}get url(){return this._url}get protocols(){return this._protocols}get buffer(){return this._options.buffer}get maxRetries(){return this._options.retry.maxRetries}get instantReconnect(){return this._options.retry.instantReconnect}get backoff(){return this._options.retry.backoff}get closedByUser(){return this._closedByUser}get lastConnection(){return this._lastConnection}get underlyingWebsocket(){return this._underlyingWebsocket}get readyState(){return this._underlyingWebsocket.readyState}get bufferedAmount(){return this._underlyingWebsocket.bufferedAmount}get extensions(){return this._underlyingWebsocket.extensions}get binaryType(){return this._underlyingWebsocket.binaryType}set binaryType(e){this._underlyingWebsocket.binaryType=e}send(e){this.closedByUser||(this._underlyingWebsocket.readyState===this._underlyingWebsocket.OPEN?this._underlyingWebsocket.send(e):this.buffer!==void 0&&this.buffer.add(e))}close(e,i){this.cancelScheduledConnectionRetry(),this._closedByUser=!0,this._underlyingWebsocket.close(e,i)}addEventListener(e,i,s){this._options.listeners[e].push({listener:i,options:s})}removeEventListener(e,i,s){const r=o=>o.listener!==i||o.options!==s;this._options.listeners[e]=this._options.listeners[e].filter(r)}tryConnect(){return this._underlyingWebsocket=new WebSocket(this.url,this.protocols),this._underlyingWebsocket.addEventListener(Ni.open,this.handleOpenEvent),this._underlyingWebsocket.addEventListener(Ni.close,this.handleCloseEvent),this._underlyingWebsocket.addEventListener(Ni.error,this.handleErrorEvent),this._underlyingWebsocket.addEventListener(Ni.message,this.handleMessageEvent),this._underlyingWebsocket}clearWebsocket(){this._underlyingWebsocket.removeEventListener(Ni.open,this.handleOpenEvent),this._underlyingWebsocket.removeEventListener(Ni.close,this.handleCloseEvent),this._underlyingWebsocket.removeEventListener(Ni.error,this.handleErrorEvent),this._underlyingWebsocket.removeEventListener(Ni.message,this.handleMessageEvent),this._underlyingWebsocket.close()}dispatchEvent(e,i){const s=this._options.listeners[e],r=[];s.forEach(({listener:o,options:a})=>{o(this,i),(a===void 0||a.once===void 0||!a.once)&&r.push({listener:o,options:a})}),this._options.listeners[e]=r}handleEvent(e,i){switch(e){case Ni.close:this.dispatchEvent(e,i),this.scheduleConnectionRetryIfNeeded();break;case Ni.open:if(this.backoff!==void 0&&this._lastConnection!==void 0){const s={retries:this.backoff.retries,lastConnection:new Date(this._lastConnection)},r=new CustomEvent(Ni.reconnect,{detail:s});this.dispatchEvent(Ni.reconnect,r),this.backoff.reset()}this._lastConnection=new Date,this.dispatchEvent(e,i),this.sendBufferedData();break;case Ni.retry:this.dispatchEvent(e,i),this.clearWebsocket(),this.tryConnect();break;default:this.dispatchEvent(e,i);break}}sendBufferedData(){if(this.buffer!==void 0)for(let e=this.buffer.read();e!==void 0;e=this.buffer.read())this.send(e)}scheduleConnectionRetryIfNeeded(){if(this.closedByUser||this.backoff===void 0)return;const e=s=>{const r=new CustomEvent(Ni.retry,{detail:s});this.handleEvent(Ni.retry,r)},i={backoff:this._options.retry.instantReconnect===!0?0:this.backoff.next(),retries:this._options.retry.instantReconnect===!0?0:this.backoff.retries,lastConnection:this._lastConnection};(this._options.retry.maxRetries===void 0||i.retries<=this._options.retry.maxRetries)&&(this.retryTimeout=globalThis.setTimeout(()=>e(i),i.backoff))}cancelScheduledConnectionRetry(){globalThis.clearTimeout(this.retryTimeout)}}class YSe{constructor(e){this._url=e}get url(){return this._url}withProtocols(e){return this._protocols=e,this}get protocols(){return this._protocols}withMaxRetries(e){var i;return this._options=Object.assign(Object.assign({},this._options),{retry:Object.assign(Object.assign({},(i=this._options)===null||i===void 0?void 0:i.retry),{maxRetries:e})}),this}get maxRetries(){var e,i;return(i=(e=this._options)===null||e===void 0?void 0:e.retry)===null||i===void 0?void 0:i.maxRetries}withInstantReconnect(e){var i;return this._options=Object.assign(Object.assign({},this._options),{retry:Object.assign(Object.assign({},(i=this._options)===null||i===void 0?void 0:i.retry),{instantReconnect:e})}),this}get instantReconnect(){var e,i;return(i=(e=this._options)===null||e===void 0?void 0:e.retry)===null||i===void 0?void 0:i.instantReconnect}withBackoff(e){var i;return this._options=Object.assign(Object.assign({},this._options),{retry:Object.assign(Object.assign({},(i=this._options)===null||i===void 0?void 0:i.retry),{backoff:e})}),this}get backoff(){var e,i;return(i=(e=this._options)===null||e===void 0?void 0:e.retry)===null||i===void 0?void 0:i.backoff}withBuffer(e){return this._options=Object.assign(Object.assign({},this._options),{buffer:e}),this}get buffer(){var e;return(e=this._options)===null||e===void 0?void 0:e.buffer}onOpen(e,i){return this.addListener(Ni.open,e,i),this}onClose(e,i){return this.addListener(Ni.close,e,i),this}onError(e,i){return this.addListener(Ni.error,e,i),this}onMessage(e,i){return this.addListener(Ni.message,e,i),this}onRetry(e,i){return this.addListener(Ni.retry,e,i),this}onReconnect(e,i){return this.addListener(Ni.reconnect,e,i),this}build(){return new YK(this._url,this._protocols,this._options)}addListener(e,i,s){var r,o,a,l,c,h,u,d,m,f,g,y,v,b,A,x,w,_,S,M,R;return this._options=Object.assign(Object.assign({},this._options),{listeners:{open:(a=(o=(r=this._options)===null||r===void 0?void 0:r.listeners)===null||o===void 0?void 0:o.open)!==null&&a!==void 0?a:[],close:(h=(c=(l=this._options)===null||l===void 0?void 0:l.listeners)===null||c===void 0?void 0:c.close)!==null&&h!==void 0?h:[],error:(m=(d=(u=this._options)===null||u===void 0?void 0:u.listeners)===null||d===void 0?void 0:d.error)!==null&&m!==void 0?m:[],message:(y=(g=(f=this._options)===null||f===void 0?void 0:f.listeners)===null||g===void 0?void 0:g.message)!==null&&y!==void 0?y:[],retry:(A=(b=(v=this._options)===null||v===void 0?void 0:v.listeners)===null||b===void 0?void 0:b.retry)!==null&&A!==void 0?A:[],reconnect:(_=(w=(x=this._options)===null||x===void 0?void 0:x.listeners)===null||w===void 0?void 0:w.reconnect)!==null&&_!==void 0?_:[],[e]:[...(R=(M=(S=this._options)===null||S===void 0?void 0:S.listeners)===null||M===void 0?void 0:M[e])!==null&&R!==void 0?R:[],{listener:i,options:s}]}}),this}}const KSe=Object.freeze(Object.defineProperty({__proto__:null,ArrayQueue:QSe,ConstantBackoff:WSe,ExponentialBackoff:HSe,LinearBackoff:jSe,RingQueue:ZSe,Websocket:YK,WebsocketBuilder:YSe,get WebsocketEvent(){return Ni}},Symbol.toStringTag,{value:"Module"})),KG=0,KK=1,JK=2,JSe=0,qSe=1,JG=2,QE=1.25,qG=1,lp=6*4+4+4,ZE=65535,$Se=Math.pow(2,-24),$G=Symbol("SKIP_GENERATION");function qK(n){return n.index?n.index.count:n.attributes.position.count}function _y(n){return qK(n)/3}function $K(n,e=ArrayBuffer){return n>65535?new Uint32Array(new e(4*n)):new Uint16Array(new e(2*n))}function eCe(n,e){if(!n.index){const i=n.attributes.position.count,s=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,r=$K(i,s);n.setIndex(new qe(r,1));for(let o=0;o<i;o++)r[o]=o}}function e6(n){const e=_y(n),i=n.drawRange,s=i.start/3,r=(i.start+i.count)/3,o=Math.max(0,s),a=Math.min(e,r)-o;return[{offset:Math.floor(o),count:Math.floor(a)}]}function t6(n){if(!n.groups||!n.groups.length)return e6(n);const e=[],i=new Set,s=n.drawRange,r=s.start/3,o=(s.start+s.count)/3;for(const l of n.groups){const c=l.start/3,h=(l.start+l.count)/3;i.add(Math.max(r,c)),i.add(Math.min(o,h))}const a=Array.from(i.values()).sort((l,c)=>l-c);for(let l=0;l<a.length-1;l++){const c=a[l],h=a[l+1];e.push({offset:Math.floor(c),count:Math.floor(h-c)})}return e}function tCe(n){if(n.groups.length===0)return!1;const e=_y(n),i=t6(n).sort((o,a)=>o.offset-a.offset),s=i[i.length-1];s.count=Math.min(e-s.offset,s.count);let r=0;return i.forEach(({count:o})=>r+=o),e!==r}function e3(n,e,i,s,r){let o=1/0,a=1/0,l=1/0,c=-1/0,h=-1/0,u=-1/0,d=1/0,m=1/0,f=1/0,g=-1/0,y=-1/0,v=-1/0;for(let b=e*6,A=(e+i)*6;b<A;b+=6){const x=n[b+0],w=n[b+1],_=x-w,S=x+w;_<o&&(o=_),S>c&&(c=S),x<d&&(d=x),x>g&&(g=x);const M=n[b+2],R=n[b+3],P=M-R,C=M+R;P<a&&(a=P),C>h&&(h=C),M<m&&(m=M),M>y&&(y=M);const L=n[b+4],B=n[b+5],z=L-B,D=L+B;z<l&&(l=z),D>u&&(u=D),L<f&&(f=L),L>v&&(v=L)}s[0]=o,s[1]=a,s[2]=l,s[3]=c,s[4]=h,s[5]=u,r[0]=d,r[1]=m,r[2]=f,r[3]=g,r[4]=y,r[5]=v}function iCe(n,e=null,i=null,s=null){const r=n.attributes.position,o=n.index?n.index.array:null,a=_y(n),l=r.normalized;let c;e===null?(c=new Float32Array(a*6*4),i=0,s=a):(c=e,i=i||0,s=s||a);const h=r.array,u=r.offset||0;let d=3;r.isInterleavedBufferAttribute&&(d=r.data.stride);const m=["getX","getY","getZ"];for(let f=i;f<i+s;f++){const g=f*3,y=f*6;let v=g+0,b=g+1,A=g+2;o&&(v=o[v],b=o[b],A=o[A]),l||(v=v*d+u,b=b*d+u,A=A*d+u);for(let x=0;x<3;x++){let w,_,S;l?(w=r[m[x]](v),_=r[m[x]](b),S=r[m[x]](A)):(w=h[v+x],_=h[b+x],S=h[A+x]);let M=w;_<M&&(M=_),S<M&&(M=S);let R=w;_>R&&(R=_),S>R&&(R=S);const P=(R-M)/2,C=x*2;c[y+C+0]=M+P,c[y+C+1]=P+(Math.abs(M)+P)*$Se}}return c}function qi(n,e,i){return i.min.x=e[n],i.min.y=e[n+1],i.min.z=e[n+2],i.max.x=e[n+3],i.max.y=e[n+4],i.max.z=e[n+5],i}function i6(n){let e=-1,i=-1/0;for(let s=0;s<3;s++){const r=n[s+3]-n[s];r>i&&(i=r,e=s)}return e}function n6(n,e){e.set(n)}function s6(n,e,i){let s,r;for(let o=0;o<3;o++){const a=o+3;s=n[o],r=e[o],i[o]=s<r?s:r,s=n[a],r=e[a],i[a]=s>r?s:r}}function YE(n,e,i){for(let s=0;s<3;s++){const r=e[n+2*s],o=e[n+2*s+1],a=r-o,l=r+o;a<i[s]&&(i[s]=a),l>i[s+3]&&(i[s+3]=l)}}function e1(n){const e=n[3]-n[0],i=n[4]-n[1],s=n[5]-n[2];return 2*(e*i+i*s+s*e)}const du=32,nCe=(n,e)=>n.candidate-e.candidate,cp=new Array(du).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),KE=new Float32Array(6);function sCe(n,e,i,s,r,o){let a=-1,l=0;if(o===KG)a=i6(e),a!==-1&&(l=(e[a]+e[a+3])/2);else if(o===KK)a=i6(n),a!==-1&&(l=rCe(i,s,r,a));else if(o===JK){const c=e1(n);let h=QE*r;const u=s*6,d=(s+r)*6;for(let m=0;m<3;m++){const f=e[m],g=(e[m+3]-f)/du;if(r<du/4){const y=[...cp];y.length=r;let v=0;for(let A=u;A<d;A+=6,v++){const x=y[v];x.candidate=i[A+2*m],x.count=0;const{bounds:w,leftCacheBounds:_,rightCacheBounds:S}=x;for(let M=0;M<3;M++)S[M]=1/0,S[M+3]=-1/0,_[M]=1/0,_[M+3]=-1/0,w[M]=1/0,w[M+3]=-1/0;YE(A,i,w)}y.sort(nCe);let b=r;for(let A=0;A<b;A++){const x=y[A];for(;A+1<b&&y[A+1].candidate===x.candidate;)y.splice(A+1,1),b--}for(let A=u;A<d;A+=6){const x=i[A+2*m];for(let w=0;w<b;w++){const _=y[w];x>=_.candidate?YE(A,i,_.rightCacheBounds):(YE(A,i,_.leftCacheBounds),_.count++)}}for(let A=0;A<b;A++){const x=y[A],w=x.count,_=r-x.count,S=x.leftCacheBounds,M=x.rightCacheBounds;let R=0;w!==0&&(R=e1(S)/c);let P=0;_!==0&&(P=e1(M)/c);const C=qG+QE*(R*w+P*_);C<h&&(a=m,h=C,l=x.candidate)}}else{for(let b=0;b<du;b++){const A=cp[b];A.count=0,A.candidate=f+g+b*g;const x=A.bounds;for(let w=0;w<3;w++)x[w]=1/0,x[w+3]=-1/0}for(let b=u;b<d;b+=6){let A=~~((i[b+2*m]-f)/g);A>=du&&(A=du-1);const x=cp[A];x.count++,YE(b,i,x.bounds)}const y=cp[du-1];n6(y.bounds,y.rightCacheBounds);for(let b=du-2;b>=0;b--){const A=cp[b],x=cp[b+1];s6(A.bounds,x.rightCacheBounds,A.rightCacheBounds)}let v=0;for(let b=0;b<du-1;b++){const A=cp[b],x=A.count,w=A.bounds,_=cp[b+1].rightCacheBounds;x!==0&&(v===0?n6(w,KE):s6(w,KE,KE)),v+=x;let S=0,M=0;v!==0&&(S=e1(KE)/c);const R=r-v;R!==0&&(M=e1(_)/c);const P=qG+QE*(S*v+M*R);P<h&&(a=m,h=P,l=A.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${o} used.`);return{axis:a,pos:l}}function rCe(n,e,i,s){let r=0;for(let o=e,a=e+i;o<a;o++)r+=n[o*6+s*2];return r/i}class t3{constructor(){this.boundingData=new Float32Array(6)}}function oCe(n,e,i,s,r,o){let a=s,l=s+r-1;const c=o.pos,h=o.axis*2;for(;;){for(;a<=l&&i[a*6+h]<c;)a++;for(;a<=l&&i[l*6+h]>=c;)l--;if(a<l){for(let u=0;u<3;u++){let d=e[a*3+u];e[a*3+u]=e[l*3+u],e[l*3+u]=d}for(let u=0;u<6;u++){let d=i[a*6+u];i[a*6+u]=i[l*6+u],i[l*6+u]=d}a++,l--}else return a}}function aCe(n,e,i,s,r,o){let a=s,l=s+r-1;const c=o.pos,h=o.axis*2;for(;;){for(;a<=l&&i[a*6+h]<c;)a++;for(;a<=l&&i[l*6+h]>=c;)l--;if(a<l){let u=n[a];n[a]=n[l],n[l]=u;for(let d=0;d<6;d++){let m=i[a*6+d];i[a*6+d]=i[l*6+d],i[l*6+d]=m}a++,l--}else return a}}function xo(n,e){return e[n+15]===65535}function Uo(n,e){return e[n+6]}function wa(n,e){return e[n+14]}function nl(n){return n+8}function _a(n,e){return e[n+6]}function i3(n,e){return e[n+7]}let r6,t1,JE,o6;const lCe=Math.pow(2,32);function n3(n){return"count"in n?1:1+n3(n.left)+n3(n.right)}function cCe(n,e,i){return r6=new Float32Array(i),t1=new Uint32Array(i),JE=new Uint16Array(i),o6=new Uint8Array(i),s3(n,e)}function s3(n,e){const i=n/4,s=n/2,r="count"in e,o=e.boundingData;for(let a=0;a<6;a++)r6[i+a]=o[a];if(r)if(e.buffer){const a=e.buffer;o6.set(new Uint8Array(a),n);for(let l=n,c=n+a.byteLength;l<c;l+=lp){const h=l/2;xo(h,JE)||(t1[l/4+6]+=i)}return n+a.byteLength}else{const a=e.offset,l=e.count;return t1[i+6]=a,JE[s+14]=l,JE[s+15]=ZE,n+lp}else{const a=e.left,l=e.right,c=e.splitAxis;let h;if(h=s3(n+lp,a),h/4>lCe)throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return t1[i+6]=h/4,h=s3(h,l),t1[i+7]=c,h}}function hCe(n,e){const i=(n.index?n.index.count:n.attributes.position.count)/3,s=i>2**16,r=s?4:2,o=e?new SharedArrayBuffer(i*r):new ArrayBuffer(i*r),a=s?new Uint32Array(o):new Uint16Array(o);for(let l=0,c=a.length;l<c;l++)a[l]=l;return a}function uCe(n,e,i,s,r){const{maxDepth:o,verbose:a,maxLeafTris:l,strategy:c,onProgress:h,indirect:u}=r,d=n._indirectBuffer,m=n.geometry,f=m.index?m.index.array:null,g=u?aCe:oCe,y=_y(m),v=new Float32Array(6);let b=!1;const A=new t3;return e3(e,i,s,A.boundingData,v),w(A,i,s,v),A;function x(_){h&&h(_/y)}function w(_,S,M,R=null,P=0){if(!b&&P>=o&&(b=!0,a&&(console.warn(`MeshBVH: Max depth of ${o} reached when generating BVH. Consider increasing maxDepth.`),console.warn(m))),M<=l||P>=o)return x(S+M),_.offset=S,_.count=M,_;const C=sCe(_.boundingData,R,e,S,M,c);if(C.axis===-1)return x(S+M),_.offset=S,_.count=M,_;const L=g(d,f,e,S,M,C);if(L===S||L===S+M)x(S+M),_.offset=S,_.count=M;else{_.splitAxis=C.axis;const B=new t3,z=S,D=L-S;_.left=B,e3(e,z,D,B.boundingData,v),w(B,z,D,v,P+1);const W=new t3,O=L,F=M-D;_.right=W,e3(e,O,F,W.boundingData,v),w(W,O,F,v,P+1)}return _}}function dCe(n,e){const i=n.geometry;e.indirect&&(n._indirectBuffer=hCe(i,e.useSharedArrayBuffer),tCe(i)&&!e.verbose&&console.warn('MeshBVH: Provided geometry contains groups that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),n._indirectBuffer||eCe(i,e);const s=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,r=iCe(i),o=e.indirect?e6(i):t6(i);n._roots=o.map(a=>{const l=uCe(n,r,a.offset,a.count,e),c=n3(l),h=new s(lp*c);return cCe(0,l,h),h})}class pu{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,i){let s=1/0,r=-1/0;for(let o=0,a=e.length;o<a;o++){const l=e[o][i];s=l<s?l:s,r=l>r?l:r}this.min=s,this.max=r}setFromPoints(e,i){let s=1/0,r=-1/0;for(let o=0,a=i.length;o<a;o++){const l=i[o],c=e.dot(l);s=c<s?c:s,r=c>r?c:r}this.min=s,this.max=r}isSeparated(e){return this.min>e.max||e.min>this.max}}pu.prototype.setFromBox=function(){const n=new E;return function(e,i){const s=i.min,r=i.max;let o=1/0,a=-1/0;for(let l=0;l<=1;l++)for(let c=0;c<=1;c++)for(let h=0;h<=1;h++){n.x=s.x*l+r.x*(1-l),n.y=s.y*c+r.y*(1-c),n.z=s.z*h+r.z*(1-h);const u=e.dot(n);o=Math.min(u,o),a=Math.max(u,a)}this.min=o,this.max=a}}();const pCe=function(){const n=new E,e=new E,i=new E;return function(s,r,o){const a=s.start,l=n,c=r.start,h=e;i.subVectors(a,c),n.subVectors(s.end,s.start),e.subVectors(r.end,r.start);const u=i.dot(h),d=h.dot(l),m=h.dot(h),f=i.dot(l),g=l.dot(l)*m-d*d;let y,v;g!==0?y=(u*d-f*m)/g:y=0,v=(u+y*d)/m,o.x=y,o.y=v}}(),r3=function(){const n=new Y,e=new E,i=new E;return function(s,r,o,a){pCe(s,r,n);let l=n.x,c=n.y;if(l>=0&&l<=1&&c>=0&&c<=1){s.at(l,o),r.at(c,a);return}else if(l>=0&&l<=1){c<0?r.at(0,a):r.at(1,a),s.closestPointToPoint(a,!0,o);return}else if(c>=0&&c<=1){l<0?s.at(0,o):s.at(1,o),r.closestPointToPoint(o,!0,a);return}else{let h;l<0?h=s.start:h=s.end;let u;c<0?u=r.start:u=r.end;const d=e,m=i;if(s.closestPointToPoint(u,!0,e),r.closestPointToPoint(h,!0,i),d.distanceToSquared(u)<=m.distanceToSquared(h)){o.copy(d),a.copy(u);return}else{o.copy(h),a.copy(m);return}}}}(),mCe=function(){const n=new E,e=new E,i=new fs,s=new jo;return function(r,o){const{radius:a,center:l}=r,{a:c,b:h,c:u}=o;if(s.start=c,s.end=h,s.closestPointToPoint(l,!0,n).distanceTo(l)<=a||(s.start=c,s.end=u,s.closestPointToPoint(l,!0,n).distanceTo(l)<=a)||(s.start=h,s.end=u,s.closestPointToPoint(l,!0,n).distanceTo(l)<=a))return!0;const d=o.getPlane(i);if(Math.abs(d.distanceToPoint(l))<=a){const m=d.projectPoint(l,e);if(o.containsPoint(m))return!0}return!1}}(),fCe=1e-15;function o3(n){return Math.abs(n)<fCe}class sl extends Ks{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new E),this.satBounds=new Array(4).fill().map(()=>new pu),this.points=[this.a,this.b,this.c],this.sphere=new tn,this.plane=new fs,this.needsUpdate=!0}intersectsSphere(e){return mCe(e,this)}update(){const e=this.a,i=this.b,s=this.c,r=this.points,o=this.satAxes,a=this.satBounds,l=o[0],c=a[0];this.getNormal(l),c.setFromPoints(l,r);const h=o[1],u=a[1];h.subVectors(e,i),u.setFromPoints(h,r);const d=o[2],m=a[2];d.subVectors(i,s),m.setFromPoints(d,r);const f=o[3],g=a[3];f.subVectors(s,e),g.setFromPoints(f,r),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(l,e),this.needsUpdate=!1}}sl.prototype.closestPointToSegment=function(){const n=new E,e=new E,i=new jo;return function(s,r=null,o=null){const{start:a,end:l}=s,c=this.points;let h,u=1/0;for(let d=0;d<3;d++){const m=(d+1)%3;i.start.copy(c[d]),i.end.copy(c[m]),r3(i,s,n,e),h=n.distanceToSquared(e),h<u&&(u=h,r&&r.copy(n),o&&o.copy(e))}return this.closestPointToPoint(a,n),h=a.distanceToSquared(n),h<u&&(u=h,r&&r.copy(n),o&&o.copy(a)),this.closestPointToPoint(l,n),h=l.distanceToSquared(n),h<u&&(u=h,r&&r.copy(n),o&&o.copy(l)),Math.sqrt(u)}}(),sl.prototype.intersectsTriangle=function(){const n=new sl,e=new Array(3),i=new Array(3),s=new pu,r=new pu,o=new E,a=new E,l=new E,c=new E,h=new E,u=new jo,d=new jo,m=new jo,f=new E;function g(y,v,b){const A=y.points;let x=0,w=-1;for(let _=0;_<3;_++){const{start:S,end:M}=u;S.copy(A[_]),M.copy(A[(_+1)%3]),u.delta(a);const R=o3(v.distanceToPoint(S));if(o3(v.normal.dot(a))&&R){b.copy(u),x=2;break}const P=v.intersectLine(u,f);if(!P&&R&&f.copy(S),(P||R)&&!o3(f.distanceTo(M))){if(x<=1)(x===1?b.start:b.end).copy(f),R&&(w=x);else if(x>=2){(w===1?b.start:b.end).copy(f),x=2;break}if(x++,x===2&&w===-1)break}}return x}return function(y,v=null,b=!1){this.needsUpdate&&this.update(),y.isExtendedTriangle?y.needsUpdate&&y.update():(n.copy(y),n.update(),y=n);const A=this.plane,x=y.plane;if(Math.abs(A.normal.dot(x.normal))>1-1e-10){const w=this.satBounds,_=this.satAxes;i[0]=y.a,i[1]=y.b,i[2]=y.c;for(let R=0;R<4;R++){const P=w[R],C=_[R];if(s.setFromPoints(C,i),P.isSeparated(s))return!1}const S=y.satBounds,M=y.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let R=0;R<4;R++){const P=S[R],C=M[R];if(s.setFromPoints(C,e),P.isSeparated(s))return!1}for(let R=0;R<4;R++){const P=_[R];for(let C=0;C<4;C++){const L=M[C];if(o.crossVectors(P,L),s.setFromPoints(o,e),r.setFromPoints(o,i),s.isSeparated(r))return!1}}return v&&(b||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),v.start.set(0,0,0),v.end.set(0,0,0)),!0}else{const w=g(this,x,d);if(w===1&&y.containsPoint(d.end))return v&&(v.start.copy(d.end),v.end.copy(d.end)),!0;if(w!==2)return!1;const _=g(y,A,m);if(_===1&&this.containsPoint(m.end))return v&&(v.start.copy(m.end),v.end.copy(m.end)),!0;if(_!==2)return!1;if(d.delta(l),m.delta(c),l.dot(c)<0){let B=m.start;m.start=m.end,m.end=B}const S=d.start.dot(l),M=d.end.dot(l),R=m.start.dot(l),P=m.end.dot(l),C=M<R,L=S<P;return S!==P&&R!==M&&C===L?!1:(v&&(h.subVectors(d.start,m.start),h.dot(l)>0?v.start.copy(d.start):v.start.copy(m.start),h.subVectors(d.end,m.end),h.dot(l)<0?v.end.copy(d.end):v.end.copy(m.end)),!0)}}}(),sl.prototype.distanceToPoint=function(){const n=new E;return function(e){return this.closestPointToPoint(e,n),e.distanceTo(n)}}(),sl.prototype.distanceToTriangle=function(){const n=new E,e=new E,i=["a","b","c"],s=new jo,r=new jo;return function(o,a=null,l=null){const c=a||l?s:null;if(this.intersectsTriangle(o,c))return(a||l)&&(a&&c.getCenter(a),l&&c.getCenter(l)),0;let h=1/0;for(let u=0;u<3;u++){let d;const m=i[u],f=o[m];this.closestPointToPoint(f,n),d=f.distanceToSquared(n),d<h&&(h=d,a&&a.copy(n),l&&l.copy(f));const g=this[m];o.closestPointToPoint(g,n),d=g.distanceToSquared(n),d<h&&(h=d,a&&a.copy(g),l&&l.copy(n))}for(let u=0;u<3;u++){const d=i[u],m=i[(u+1)%3];s.set(this[d],this[m]);for(let f=0;f<3;f++){const g=i[f],y=i[(f+1)%3];r.set(o[g],o[y]),r3(s,r,n,e);const v=n.distanceToSquared(e);v<h&&(h=v,a&&a.copy(n),l&&l.copy(e))}}return Math.sqrt(h)}}();class Qr{constructor(e,i,s){this.isOrientedBox=!0,this.min=new E,this.max=new E,this.matrix=new he,this.invMatrix=new he,this.points=new Array(8).fill().map(()=>new E),this.satAxes=new Array(3).fill().map(()=>new E),this.satBounds=new Array(3).fill().map(()=>new pu),this.alignedSatBounds=new Array(3).fill().map(()=>new pu),this.needsUpdate=!1,e&&this.min.copy(e),i&&this.max.copy(i),s&&this.matrix.copy(s)}set(e,i,s){this.min.copy(e),this.max.copy(i),this.matrix.copy(s),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}Qr.prototype.update=function(){return function(){const n=this.matrix,e=this.min,i=this.max,s=this.points;for(let c=0;c<=1;c++)for(let h=0;h<=1;h++)for(let u=0;u<=1;u++){const d=1*c|2*h|4*u,m=s[d];m.x=c?i.x:e.x,m.y=h?i.y:e.y,m.z=u?i.z:e.z,m.applyMatrix4(n)}const r=this.satBounds,o=this.satAxes,a=s[0];for(let c=0;c<3;c++){const h=o[c],u=r[c],d=1<<c,m=s[d];h.subVectors(a,m),u.setFromPoints(h,s)}const l=this.alignedSatBounds;l[0].setFromPointsField(s,"x"),l[1].setFromPointsField(s,"y"),l[2].setFromPointsField(s,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}(),Qr.prototype.intersectsBox=function(){const n=new pu;return function(e){this.needsUpdate&&this.update();const i=e.min,s=e.max,r=this.satBounds,o=this.satAxes,a=this.alignedSatBounds;if(n.min=i.x,n.max=s.x,a[0].isSeparated(n)||(n.min=i.y,n.max=s.y,a[1].isSeparated(n))||(n.min=i.z,n.max=s.z,a[2].isSeparated(n)))return!1;for(let l=0;l<3;l++){const c=o[l],h=r[l];if(n.setFromBox(c,e),h.isSeparated(n))return!1}return!0}}(),Qr.prototype.intersectsTriangle=function(){const n=new sl,e=new Array(3),i=new pu,s=new pu,r=new E;return function(o){this.needsUpdate&&this.update(),o.isExtendedTriangle?o.needsUpdate&&o.update():(n.copy(o),n.update(),o=n);const a=this.satBounds,l=this.satAxes;e[0]=o.a,e[1]=o.b,e[2]=o.c;for(let d=0;d<3;d++){const m=a[d],f=l[d];if(i.setFromPoints(f,e),m.isSeparated(i))return!1}const c=o.satBounds,h=o.satAxes,u=this.points;for(let d=0;d<3;d++){const m=c[d],f=h[d];if(i.setFromPoints(f,u),m.isSeparated(i))return!1}for(let d=0;d<3;d++){const m=l[d];for(let f=0;f<4;f++){const g=h[f];if(r.crossVectors(m,g),i.setFromPoints(r,e),s.setFromPoints(r,u),i.isSeparated(s))return!1}}return!0}}(),Qr.prototype.closestPointToPoint=function(){return function(n,e){return this.needsUpdate&&this.update(),e.copy(n).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e}}(),Qr.prototype.distanceToPoint=function(){const n=new E;return function(e){return this.closestPointToPoint(e,n),e.distanceTo(n)}}(),Qr.prototype.distanceToBox=function(){const n=["x","y","z"],e=new Array(12).fill().map(()=>new jo),i=new Array(12).fill().map(()=>new jo),s=new E,r=new E;return function(o,a=0,l=null,c=null){if(this.needsUpdate&&this.update(),this.intersectsBox(o))return(l||c)&&(o.getCenter(r),this.closestPointToPoint(r,s),o.closestPointToPoint(s,r),l&&l.copy(s),c&&c.copy(r)),0;const h=a*a,u=o.min,d=o.max,m=this.points;let f=1/0;for(let y=0;y<8;y++){const v=m[y];r.copy(v).clamp(u,d);const b=v.distanceToSquared(r);if(b<f&&(f=b,l&&l.copy(v),c&&c.copy(r),b<h))return Math.sqrt(b)}let g=0;for(let y=0;y<3;y++)for(let v=0;v<=1;v++)for(let b=0;b<=1;b++){const A=(y+1)%3,x=(y+2)%3,w=v<<A|b<<x,_=1<<y|v<<A|b<<x,S=m[w],M=m[_];e[g].set(S,M);const R=n[y],P=n[A],C=n[x],L=i[g],B=L.start,z=L.end;B[R]=u[R],B[P]=v?u[P]:d[P],B[C]=b?u[C]:d[P],z[R]=d[R],z[P]=v?u[P]:d[P],z[C]=b?u[C]:d[P],g++}for(let y=0;y<=1;y++)for(let v=0;v<=1;v++)for(let b=0;b<=1;b++){r.x=y?d.x:u.x,r.y=v?d.y:u.y,r.z=b?d.z:u.z,this.closestPointToPoint(r,s);const A=r.distanceToSquared(s);if(A<f&&(f=A,l&&l.copy(s),c&&c.copy(r),A<h))return Math.sqrt(A)}for(let y=0;y<12;y++){const v=e[y];for(let b=0;b<12;b++){const A=i[b];r3(v,A,s,r);const x=s.distanceToSquared(r);if(x<f&&(f=x,l&&l.copy(s),c&&c.copy(r),x<h))return Math.sqrt(x)}}return Math.sqrt(f)}}();class a3{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}class gCe extends a3{constructor(){super(()=>new sl)}}const rl=new gCe;class yCe{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const e=[];let i=null;this.setBuffer=s=>{i&&e.push(i),i=s,this.float32Array=new Float32Array(s),this.uint16Array=new Uint16Array(s),this.uint32Array=new Uint32Array(s)},this.clearBuffer=()=>{i=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,e.length!==0&&this.setBuffer(e.pop())}}}const ln=new yCe;let hp,Sy;const Cy=[],qE=new a3(()=>new Wt);function vCe(n,e,i,s,r,o){hp=qE.getPrimitive(),Sy=qE.getPrimitive(),Cy.push(hp,Sy),ln.setBuffer(n._roots[e]);const a=l3(0,n.geometry,i,s,r,o);ln.clearBuffer(),qE.releasePrimitive(hp),qE.releasePrimitive(Sy),Cy.pop(),Cy.pop();const l=Cy.length;return l>0&&(Sy=Cy[l-1],hp=Cy[l-2]),a}function l3(n,e,i,s,r=null,o=0,a=0){const{float32Array:l,uint16Array:c,uint32Array:h}=ln;let u=n*2;if(xo(u,c)){const d=Uo(n,h),m=wa(u,c);return qi(n,l,hp),s(d,m,!1,a,o+n,hp)}else{let d=function(L){const{uint16Array:B,uint32Array:z}=ln;let D=L*2;for(;!xo(D,B);)L=nl(L),D=L*2;return Uo(L,z)},m=function(L){const{uint16Array:B,uint32Array:z}=ln;let D=L*2;for(;!xo(D,B);)L=_a(L,z),D=L*2;return Uo(L,z)+wa(D,B)};const f=nl(n),g=_a(n,h);let y=f,v=g,b,A,x,w;if(r&&(x=hp,w=Sy,qi(y,l,x),qi(v,l,w),b=r(x),A=r(w),A<b)){y=g,v=f;const L=b;b=A,A=L,x=w}x||(x=hp,qi(y,l,x));const _=xo(y*2,c),S=i(x,_,b,a+1,o+y);let M;if(S===JG){const L=d(y),B=m(y)-L;M=s(L,B,!0,a+1,o+y,x)}else M=S&&l3(y,e,i,s,r,o,a+1);if(M)return!0;w=Sy,qi(v,l,w);const R=xo(v*2,c),P=i(w,R,A,a+1,o+v);let C;if(P===JG){const L=d(v),B=m(v)-L;C=s(L,B,!0,a+1,o+v,w)}else C=P&&l3(v,e,i,s,r,o,a+1);return!!C}}const i1=new E,c3=new E;function bCe(n,e,i={},s=0,r=1/0){const o=s*s,a=r*r;let l=1/0,c=null;if(n.shapecast({boundsTraverseOrder:u=>(i1.copy(e).clamp(u.min,u.max),i1.distanceToSquared(e)),intersectsBounds:(u,d,m)=>m<l&&m<a,intersectsTriangle:(u,d)=>{u.closestPointToPoint(e,i1);const m=e.distanceToSquared(i1);return m<l&&(c3.copy(i1),l=m,c=d),m<o}}),l===1/0)return null;const h=Math.sqrt(l);return i.point?i.point.copy(c3):i.point=c3.clone(),i.distance=h,i.faceIndex=c,i}const My=new E,Ey=new E,Ty=new E,$E=new Y,eT=new Y,tT=new Y,a6=new E,l6=new E,c6=new E,iT=new E;function ACe(n,e,i,s,r,o,a,l){let c;if(o===un?c=n.intersectTriangle(s,i,e,!0,r):c=n.intersectTriangle(e,i,s,o!==xi,r),c===null)return null;const h=n.origin.distanceTo(r);return h<a||h>l?null:{distance:h,point:r.clone()}}function xCe(n,e,i,s,r,o,a,l,c,h,u){My.fromBufferAttribute(e,o),Ey.fromBufferAttribute(e,a),Ty.fromBufferAttribute(e,l);const d=ACe(n,My,Ey,Ty,iT,c,h,u);if(d){s&&($E.fromBufferAttribute(s,o),eT.fromBufferAttribute(s,a),tT.fromBufferAttribute(s,l),d.uv=Ks.getInterpolation(iT,My,Ey,Ty,$E,eT,tT,new Y)),r&&($E.fromBufferAttribute(r,o),eT.fromBufferAttribute(r,a),tT.fromBufferAttribute(r,l),d.uv1=Ks.getInterpolation(iT,My,Ey,Ty,$E,eT,tT,new Y)),i&&(a6.fromBufferAttribute(i,o),l6.fromBufferAttribute(i,a),c6.fromBufferAttribute(i,l),d.normal=Ks.getInterpolation(iT,My,Ey,Ty,a6,l6,c6,new E),d.normal.dot(n.direction)>0&&d.normal.multiplyScalar(-1));const m={a:o,b:a,c:l,normal:new E,materialIndex:0};Ks.getNormal(My,Ey,Ty,m.normal),d.face=m,d.faceIndex=o}return d}function nT(n,e,i,s,r,o,a){const l=s*3;let c=l+0,h=l+1,u=l+2;const d=n.index;n.index&&(c=d.getX(c),h=d.getX(h),u=d.getX(u));const{position:m,normal:f,uv:g,uv1:y}=n.attributes,v=xCe(i,m,f,g,y,c,h,u,e,o,a);return v?(v.faceIndex=s,r&&r.push(v),v):null}function us(n,e,i,s){const r=n.a,o=n.b,a=n.c;let l=e,c=e+1,h=e+2;i&&(l=i.getX(l),c=i.getX(c),h=i.getX(h)),r.x=s.getX(l),r.y=s.getY(l),r.z=s.getZ(l),o.x=s.getX(c),o.y=s.getY(c),o.z=s.getZ(c),a.x=s.getX(h),a.y=s.getY(h),a.z=s.getZ(h)}const sT=new E,rT=new E,oT=new E,h6=new Y,u6=new Y,d6=new Y;function wCe(n,e,i,s){const r=e.getIndex().array,o=e.getAttribute("position"),a=e.getAttribute("uv"),l=r[i*3],c=r[i*3+1],h=r[i*3+2];sT.fromBufferAttribute(o,l),rT.fromBufferAttribute(o,c),oT.fromBufferAttribute(o,h);let u=0;const d=e.groups,m=i*3;for(let g=0,y=d.length;g<y;g++){const v=d[g],{start:b,count:A}=v;if(m>=b&&m<b+A){u=v.materialIndex;break}}let f=null;return a&&(h6.fromBufferAttribute(a,l),u6.fromBufferAttribute(a,c),d6.fromBufferAttribute(a,h),s&&s.uv?f=s.uv:f=new Y,Ks.getInterpolation(n,sT,rT,oT,h6,u6,d6,f)),s?(s.face||(s.face={}),s.face.a=l,s.face.b=c,s.face.c=h,s.face.materialIndex=u,s.face.normal||(s.face.normal=new E),Ks.getNormal(sT,rT,oT,s.face.normal),f&&(s.uv=f),s):{face:{a:l,b:c,c:h,materialIndex:u,normal:Ks.getNormal(sT,rT,oT,new E)},uv:f}}function _Ce(n,e,i,s,r,o,a,l){const{geometry:c,_indirectBuffer:h}=n;for(let u=s,d=s+r;u<d;u++)nT(c,e,i,u,o,a,l)}function SCe(n,e,i,s,r,o,a){const{geometry:l,_indirectBuffer:c}=n;let h=1/0,u=null;for(let d=s,m=s+r;d<m;d++){let f;f=nT(l,e,i,d,null,o,a),f&&f.distance<h&&(u=f,h=f.distance)}return u}function CCe(n,e,i,s,r,o,a){const{geometry:l}=i,{index:c}=l,h=l.attributes.position;for(let u=n,d=e+n;u<d;u++){let m;if(m=u,us(a,m*3,c,h),a.needsUpdate=!0,s(a,m,r,o))return!0}return!1}function MCe(n,e=null){e&&Array.isArray(e)&&(e=new Set(e));const i=n.geometry,s=i.index?i.index.array:null,r=i.attributes.position;let o,a,l,c,h=0;const u=n._roots;for(let m=0,f=u.length;m<f;m++)o=u[m],a=new Uint32Array(o),l=new Uint16Array(o),c=new Float32Array(o),d(0,h),h+=o.byteLength;function d(m,f,g=!1){const y=m*2;if(l[y+15]===ZE){const v=a[m+6],b=l[y+14];let A=1/0,x=1/0,w=1/0,_=-1/0,S=-1/0,M=-1/0;for(let R=3*v,P=3*(v+b);R<P;R++){let C=s[R];const L=r.getX(C),B=r.getY(C),z=r.getZ(C);L<A&&(A=L),L>_&&(_=L),B<x&&(x=B),B>S&&(S=B),z<w&&(w=z),z>M&&(M=z)}return c[m+0]!==A||c[m+1]!==x||c[m+2]!==w||c[m+3]!==_||c[m+4]!==S||c[m+5]!==M?(c[m+0]=A,c[m+1]=x,c[m+2]=w,c[m+3]=_,c[m+4]=S,c[m+5]=M,!0):!1}else{const v=m+8,b=a[m+6],A=v+f,x=b+f;let w=g,_=!1,S=!1;e?w||(_=e.has(A),S=e.has(x),w=!_&&!S):(_=!0,S=!0);const M=w||_,R=w||S;let P=!1;M&&(P=d(v,f,w));let C=!1;R&&(C=d(b,f,w));const L=P||C;if(L)for(let B=0;B<3;B++){const z=v+B,D=b+B,W=c[z],O=c[z+3],F=c[D],X=c[D+3];c[m+B]=W<F?W:F,c[m+B+3]=O>X?O:X}return L}}}function up(n,e,i,s,r){let o,a,l,c,h,u;const d=1/i.direction.x,m=1/i.direction.y,f=1/i.direction.z,g=i.origin.x,y=i.origin.y,v=i.origin.z;let b=e[n],A=e[n+3],x=e[n+1],w=e[n+3+1],_=e[n+2],S=e[n+3+2];return d>=0?(o=(b-g)*d,a=(A-g)*d):(o=(A-g)*d,a=(b-g)*d),m>=0?(l=(x-y)*m,c=(w-y)*m):(l=(w-y)*m,c=(x-y)*m),o>c||l>a||((l>o||isNaN(o))&&(o=l),(c<a||isNaN(a))&&(a=c),f>=0?(h=(_-v)*f,u=(S-v)*f):(h=(S-v)*f,u=(_-v)*f),o>u||h>a)?!1:((h>o||o!==o)&&(o=h),(u<a||a!==a)&&(a=u),o<=r&&a>=s)}function ECe(n,e,i,s,r,o,a,l){const{geometry:c,_indirectBuffer:h}=n;for(let u=s,d=s+r;u<d;u++){let m=h?h[u]:u;nT(c,e,i,m,o,a,l)}}function TCe(n,e,i,s,r,o,a){const{geometry:l,_indirectBuffer:c}=n;let h=1/0,u=null;for(let d=s,m=s+r;d<m;d++){let f;f=nT(l,e,i,c?c[d]:d,null,o,a),f&&f.distance<h&&(u=f,h=f.distance)}return u}function RCe(n,e,i,s,r,o,a){const{geometry:l}=i,{index:c}=l,h=l.attributes.position;for(let u=n,d=e+n;u<d;u++){let m;if(m=i.resolveTriangleIndex(u),us(a,m*3,c,h),a.needsUpdate=!0,s(a,m,r,o))return!0}return!1}function ICe(n,e,i,s,r,o,a){ln.setBuffer(n._roots[e]),h3(0,n,i,s,r,o,a),ln.clearBuffer()}function h3(n,e,i,s,r,o,a){const{float32Array:l,uint16Array:c,uint32Array:h}=ln,u=n*2;if(xo(u,c)){const d=Uo(n,h),m=wa(u,c);_Ce(e,i,s,d,m,r,o,a)}else{const d=nl(n);up(d,l,s,o,a)&&h3(d,e,i,s,r,o,a);const m=_a(n,h);up(m,l,s,o,a)&&h3(m,e,i,s,r,o,a)}}const LCe=["x","y","z"];function PCe(n,e,i,s,r,o){ln.setBuffer(n._roots[e]);const a=u3(0,n,i,s,r,o);return ln.clearBuffer(),a}function u3(n,e,i,s,r,o){const{float32Array:a,uint16Array:l,uint32Array:c}=ln;let h=n*2;if(xo(h,l)){const u=Uo(n,c),d=wa(h,l);return SCe(e,i,s,u,d,r,o)}else{const u=i3(n,c),d=LCe[u],m=s.direction[d]>=0;let f,g;m?(f=nl(n),g=_a(n,c)):(f=_a(n,c),g=nl(n));const y=up(f,a,s,r,o)?u3(f,e,i,s,r,o):null;if(y){const b=y.point[d];if(m?b<=a[g+u]:b>=a[g+u+3])return y}const v=up(g,a,s,r,o)?u3(g,e,i,s,r,o):null;return y&&v?y.distance<=v.distance?y:v:y||v||null}}const aT=new Wt,Ry=new sl,Iy=new sl,n1=new he,p6=new Qr,lT=new Qr;function BCe(n,e,i,s){ln.setBuffer(n._roots[e]);const r=d3(0,n,i,s);return ln.clearBuffer(),r}function d3(n,e,i,s,r=null){const{float32Array:o,uint16Array:a,uint32Array:l}=ln;let c=n*2;if(r===null&&(i.boundingBox||i.computeBoundingBox(),p6.set(i.boundingBox.min,i.boundingBox.max,s),r=p6),xo(c,a)){const h=e.geometry,u=h.index,d=h.attributes.position,m=i.index,f=i.attributes.position,g=Uo(n,l),y=wa(c,a);if(n1.copy(s).invert(),i.boundsTree)return qi(n,o,lT),lT.matrix.copy(n1),lT.needsUpdate=!0,i.boundsTree.shapecast({intersectsBounds:v=>lT.intersectsBox(v),intersectsTriangle:v=>{v.a.applyMatrix4(s),v.b.applyMatrix4(s),v.c.applyMatrix4(s),v.needsUpdate=!0;for(let b=g*3,A=(y+g)*3;b<A;b+=3)if(us(Iy,b,u,d),Iy.needsUpdate=!0,v.intersectsTriangle(Iy))return!0;return!1}});for(let v=g*3,b=(y+g)*3;v<b;v+=3){us(Ry,v,u,d),Ry.a.applyMatrix4(n1),Ry.b.applyMatrix4(n1),Ry.c.applyMatrix4(n1),Ry.needsUpdate=!0;for(let A=0,x=m.count;A<x;A+=3)if(us(Iy,A,m,f),Iy.needsUpdate=!0,Ry.intersectsTriangle(Iy))return!0}}else{const h=n+8,u=l[n+6];return qi(h,o,aT),!!(r.intersectsBox(aT)&&d3(h,e,i,s,r)||(qi(u,o,aT),r.intersectsBox(aT)&&d3(u,e,i,s,r)))}}const cT=new he,p3=new Qr,s1=new Qr,kCe=new E,DCe=new E,OCe=new E,GCe=new E;function zCe(n,e,i,s={},r={},o=0,a=1/0){e.boundingBox||e.computeBoundingBox(),p3.set(e.boundingBox.min,e.boundingBox.max,i),p3.needsUpdate=!0;const l=n.geometry,c=l.attributes.position,h=l.index,u=e.attributes.position,d=e.index,m=rl.getPrimitive(),f=rl.getPrimitive();let g=kCe,y=DCe,v=null,b=null;r&&(v=OCe,b=GCe);let A=1/0,x=null,w=null;return cT.copy(i).invert(),s1.matrix.copy(cT),n.shapecast({boundsTraverseOrder:_=>p3.distanceToBox(_),intersectsBounds:(_,S,M)=>M<A&&M<a?(S&&(s1.min.copy(_.min),s1.max.copy(_.max),s1.needsUpdate=!0),!0):!1,intersectsRange:(_,S)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:M=>s1.distanceToBox(M),intersectsBounds:(M,R,P)=>P<A&&P<a,intersectsRange:(M,R)=>{for(let P=M,C=M+R;P<C;P++){us(f,3*P,d,u),f.a.applyMatrix4(i),f.b.applyMatrix4(i),f.c.applyMatrix4(i),f.needsUpdate=!0;for(let L=_,B=_+S;L<B;L++){us(m,3*L,h,c),m.needsUpdate=!0;const z=m.distanceToTriangle(f,g,v);if(z<A&&(y.copy(g),b&&b.copy(v),A=z,x=L,w=P),z<o)return!0}}}});{const M=_y(e);for(let R=0,P=M;R<P;R++){us(f,3*R,d,u),f.a.applyMatrix4(i),f.b.applyMatrix4(i),f.c.applyMatrix4(i),f.needsUpdate=!0;for(let C=_,L=_+S;C<L;C++){us(m,3*C,h,c),m.needsUpdate=!0;const B=m.distanceToTriangle(f,g,v);if(B<A&&(y.copy(g),b&&b.copy(v),A=B,x=C,w=R),B<o)return!0}}}}}),rl.releasePrimitive(m),rl.releasePrimitive(f),A===1/0?null:(s.point?s.point.copy(y):s.point=y.clone(),s.distance=A,s.faceIndex=x,r&&(r.point?r.point.copy(b):r.point=b.clone(),r.point.applyMatrix4(cT),y.applyMatrix4(cT),r.distance=y.sub(r.point).length(),r.faceIndex=w),s)}function FCe(n,e=null){e&&Array.isArray(e)&&(e=new Set(e));const i=n.geometry,s=i.index?i.index.array:null,r=i.attributes.position;let o,a,l,c,h=0;const u=n._roots;for(let m=0,f=u.length;m<f;m++)o=u[m],a=new Uint32Array(o),l=new Uint16Array(o),c=new Float32Array(o),d(0,h),h+=o.byteLength;function d(m,f,g=!1){const y=m*2;if(l[y+15]===ZE){const v=a[m+6],b=l[y+14];let A=1/0,x=1/0,w=1/0,_=-1/0,S=-1/0,M=-1/0;for(let R=v,P=v+b;R<P;R++){const C=3*n.resolveTriangleIndex(R);for(let L=0;L<3;L++){let B=C+L;B=s?s[B]:B;const z=r.getX(B),D=r.getY(B),W=r.getZ(B);z<A&&(A=z),z>_&&(_=z),D<x&&(x=D),D>S&&(S=D),W<w&&(w=W),W>M&&(M=W)}}return c[m+0]!==A||c[m+1]!==x||c[m+2]!==w||c[m+3]!==_||c[m+4]!==S||c[m+5]!==M?(c[m+0]=A,c[m+1]=x,c[m+2]=w,c[m+3]=_,c[m+4]=S,c[m+5]=M,!0):!1}else{const v=m+8,b=a[m+6],A=v+f,x=b+f;let w=g,_=!1,S=!1;e?w||(_=e.has(A),S=e.has(x),w=!_&&!S):(_=!0,S=!0);const M=w||_,R=w||S;let P=!1;M&&(P=d(v,f,w));let C=!1;R&&(C=d(b,f,w));const L=P||C;if(L)for(let B=0;B<3;B++){const z=v+B,D=b+B,W=c[z],O=c[z+3],F=c[D],X=c[D+3];c[m+B]=W<F?W:F,c[m+B+3]=O>X?O:X}return L}}}function NCe(n,e,i,s,r,o,a){ln.setBuffer(n._roots[e]),m3(0,n,i,s,r,o,a),ln.clearBuffer()}function m3(n,e,i,s,r,o,a){const{float32Array:l,uint16Array:c,uint32Array:h}=ln,u=n*2;if(xo(u,c)){const d=Uo(n,h),m=wa(u,c);ECe(e,i,s,d,m,r,o,a)}else{const d=nl(n);up(d,l,s,o,a)&&m3(d,e,i,s,r,o,a);const m=_a(n,h);up(m,l,s,o,a)&&m3(m,e,i,s,r,o,a)}}const UCe=["x","y","z"];function VCe(n,e,i,s,r,o){ln.setBuffer(n._roots[e]);const a=f3(0,n,i,s,r,o);return ln.clearBuffer(),a}function f3(n,e,i,s,r,o){const{float32Array:a,uint16Array:l,uint32Array:c}=ln;let h=n*2;if(xo(h,l)){const u=Uo(n,c),d=wa(h,l);return TCe(e,i,s,u,d,r,o)}else{const u=i3(n,c),d=UCe[u],m=s.direction[d]>=0;let f,g;m?(f=nl(n),g=_a(n,c)):(f=_a(n,c),g=nl(n));const y=up(f,a,s,r,o)?f3(f,e,i,s,r,o):null;if(y){const b=y.point[d];if(m?b<=a[g+u]:b>=a[g+u+3])return y}const v=up(g,a,s,r,o)?f3(g,e,i,s,r,o):null;return y&&v?y.distance<=v.distance?y:v:y||v||null}}const hT=new Wt,Ly=new sl,Py=new sl,r1=new he,m6=new Qr,uT=new Qr;function XCe(n,e,i,s){ln.setBuffer(n._roots[e]);const r=g3(0,n,i,s);return ln.clearBuffer(),r}function g3(n,e,i,s,r=null){const{float32Array:o,uint16Array:a,uint32Array:l}=ln;let c=n*2;if(r===null&&(i.boundingBox||i.computeBoundingBox(),m6.set(i.boundingBox.min,i.boundingBox.max,s),r=m6),xo(c,a)){const h=e.geometry,u=h.index,d=h.attributes.position,m=i.index,f=i.attributes.position,g=Uo(n,l),y=wa(c,a);if(r1.copy(s).invert(),i.boundsTree)return qi(n,o,uT),uT.matrix.copy(r1),uT.needsUpdate=!0,i.boundsTree.shapecast({intersectsBounds:v=>uT.intersectsBox(v),intersectsTriangle:v=>{v.a.applyMatrix4(s),v.b.applyMatrix4(s),v.c.applyMatrix4(s),v.needsUpdate=!0;for(let b=g,A=y+g;b<A;b++)if(us(Py,3*e.resolveTriangleIndex(b),u,d),Py.needsUpdate=!0,v.intersectsTriangle(Py))return!0;return!1}});for(let v=g,b=y+g;v<b;v++){const A=e.resolveTriangleIndex(v);us(Ly,3*A,u,d),Ly.a.applyMatrix4(r1),Ly.b.applyMatrix4(r1),Ly.c.applyMatrix4(r1),Ly.needsUpdate=!0;for(let x=0,w=m.count;x<w;x+=3)if(us(Py,x,m,f),Py.needsUpdate=!0,Ly.intersectsTriangle(Py))return!0}}else{const h=n+8,u=l[n+6];return qi(h,o,hT),!!(r.intersectsBox(hT)&&g3(h,e,i,s,r)||(qi(u,o,hT),r.intersectsBox(hT)&&g3(u,e,i,s,r)))}}const dT=new he,y3=new Qr,o1=new Qr,WCe=new E,HCe=new E,jCe=new E,QCe=new E;function ZCe(n,e,i,s={},r={},o=0,a=1/0){e.boundingBox||e.computeBoundingBox(),y3.set(e.boundingBox.min,e.boundingBox.max,i),y3.needsUpdate=!0;const l=n.geometry,c=l.attributes.position,h=l.index,u=e.attributes.position,d=e.index,m=rl.getPrimitive(),f=rl.getPrimitive();let g=WCe,y=HCe,v=null,b=null;r&&(v=jCe,b=QCe);let A=1/0,x=null,w=null;return dT.copy(i).invert(),o1.matrix.copy(dT),n.shapecast({boundsTraverseOrder:_=>y3.distanceToBox(_),intersectsBounds:(_,S,M)=>M<A&&M<a?(S&&(o1.min.copy(_.min),o1.max.copy(_.max),o1.needsUpdate=!0),!0):!1,intersectsRange:(_,S)=>{if(e.boundsTree){const M=e.boundsTree;return M.shapecast({boundsTraverseOrder:R=>o1.distanceToBox(R),intersectsBounds:(R,P,C)=>C<A&&C<a,intersectsRange:(R,P)=>{for(let C=R,L=R+P;C<L;C++){const B=M.resolveTriangleIndex(C);us(f,3*B,d,u),f.a.applyMatrix4(i),f.b.applyMatrix4(i),f.c.applyMatrix4(i),f.needsUpdate=!0;for(let z=_,D=_+S;z<D;z++){const W=n.resolveTriangleIndex(z);us(m,3*W,h,c),m.needsUpdate=!0;const O=m.distanceToTriangle(f,g,v);if(O<A&&(y.copy(g),b&&b.copy(v),A=O,x=z,w=C),O<o)return!0}}}})}else{const M=_y(e);for(let R=0,P=M;R<P;R++){us(f,3*R,d,u),f.a.applyMatrix4(i),f.b.applyMatrix4(i),f.c.applyMatrix4(i),f.needsUpdate=!0;for(let C=_,L=_+S;C<L;C++){const B=n.resolveTriangleIndex(C);us(m,3*B,h,c),m.needsUpdate=!0;const z=m.distanceToTriangle(f,g,v);if(z<A&&(y.copy(g),b&&b.copy(v),A=z,x=C,w=R),z<o)return!0}}}}}),rl.releasePrimitive(m),rl.releasePrimitive(f),A===1/0?null:(s.point?s.point.copy(y):s.point=y.clone(),s.distance=A,s.faceIndex=x,r&&(r.point?r.point.copy(b):r.point=b.clone(),r.point.applyMatrix4(dT),y.applyMatrix4(dT),r.distance=y.sub(r.point).length(),r.faceIndex=w),s)}function f6(){return typeof SharedArrayBuffer<"u"}const a1=new ln.constructor,pT=new ln.constructor,dp=new a3(()=>new Wt),By=new Wt,ky=new Wt,v3=new Wt,b3=new Wt;let A3=!1;function YCe(n,e,i,s){if(A3)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");A3=!0;const r=n._roots,o=e._roots;let a,l=0,c=0;const h=new he().copy(i).invert();for(let u=0,d=r.length;u<d;u++){a1.setBuffer(r[u]),c=0;const m=dp.getPrimitive();qi(0,a1.float32Array,m),m.applyMatrix4(h);for(let f=0,g=o.length;f<g&&(pT.setBuffer(o[u]),a=Zl(0,0,i,h,s,l,c,0,0,m),pT.clearBuffer(),c+=o[f].length,!a);f++);if(dp.releasePrimitive(m),a1.clearBuffer(),l+=r[u].length,a)break}return A3=!1,a}function Zl(n,e,i,s,r,o=0,a=0,l=0,c=0,h=null,u=!1){let d,m;u?(d=pT,m=a1):(d=a1,m=pT);const f=d.float32Array,g=d.uint32Array,y=d.uint16Array,v=m.float32Array,b=m.uint32Array,A=m.uint16Array,x=n*2,w=e*2,_=xo(x,y),S=xo(w,A);let M=!1;if(S&&_)u?M=r(Uo(e,b),wa(e*2,A),Uo(n,g),wa(n*2,y),c,a+e,l,o+n):M=r(Uo(n,g),wa(n*2,y),Uo(e,b),wa(e*2,A),l,o+n,c,a+e);else if(S){const R=dp.getPrimitive();qi(e,v,R),R.applyMatrix4(i);const P=nl(n),C=_a(n,g);qi(P,f,By),qi(C,f,ky);const L=R.intersectsBox(By),B=R.intersectsBox(ky);M=L&&Zl(e,P,s,i,r,a,o,c,l+1,R,!u)||B&&Zl(e,C,s,i,r,a,o,c,l+1,R,!u),dp.releasePrimitive(R)}else{const R=nl(e),P=_a(e,b);qi(R,v,v3),qi(P,v,b3);const C=h.intersectsBox(v3),L=h.intersectsBox(b3);if(C&&L)M=Zl(n,R,i,s,r,o,a,l,c+1,h,u)||Zl(n,P,i,s,r,o,a,l,c+1,h,u);else if(C)if(_)M=Zl(n,R,i,s,r,o,a,l,c+1,h,u);else{const B=dp.getPrimitive();B.copy(v3).applyMatrix4(i);const z=nl(n),D=_a(n,g);qi(z,f,By),qi(D,f,ky);const W=B.intersectsBox(By),O=B.intersectsBox(ky);M=W&&Zl(R,z,s,i,r,a,o,c,l+1,B,!u)||O&&Zl(R,D,s,i,r,a,o,c,l+1,B,!u),dp.releasePrimitive(B)}else if(L)if(_)M=Zl(n,P,i,s,r,o,a,l,c+1,h,u);else{const B=dp.getPrimitive();B.copy(b3).applyMatrix4(i);const z=nl(n),D=_a(n,g);qi(z,f,By),qi(D,f,ky);const W=B.intersectsBox(By),O=B.intersectsBox(ky);M=W&&Zl(P,z,s,i,r,a,o,c,l+1,B,!u)||O&&Zl(P,D,s,i,r,a,o,c,l+1,B,!u),dp.releasePrimitive(B)}}return M}const mT=new Qr,g6=new Wt,KCe={strategy:KG,maxDepth:40,maxLeafTris:10,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,verbose:!0};class Vy{static serialize(e,i={}){i={cloneBuffers:!0,...i};const s=e.geometry,r=e._roots,o=e._indirectBuffer,a=s.getIndex();let l;return i.cloneBuffers?l={roots:r.map(c=>c.slice()),index:a?a.array.slice():null,indirectBuffer:o?o.slice():null}:l={roots:r,index:a?a.array:null,indirectBuffer:o},l}static deserialize(e,i,s={}){s={setIndex:!0,indirect:!!e.indirectBuffer,...s};const{index:r,roots:o,indirectBuffer:a}=e,l=new Vy(i,{...s,[$G]:!0});if(l._roots=o,l._indirectBuffer=a||null,s.setIndex){const c=i.getIndex();if(c===null){const h=new qe(e.index,1,!1);i.setIndex(h)}else c.array!==r&&(c.array.set(r),c.needsUpdate=!0)}return l}get indirect(){return!!this._indirectBuffer}constructor(e,i={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(i=Object.assign({...KCe,[$G]:!1},i),i.useSharedArrayBuffer&&!f6())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=e,this._roots=null,this._indirectBuffer=null,i[$G]||(dCe(this,i),!e.boundingBox&&i.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new Wt))),this.resolveTriangleIndex=i.indirect?s=>this._indirectBuffer[s]:s=>s}refit(e=null){return(this.indirect?FCe:MCe)(this,e)}traverse(e,i=0){const s=this._roots[i],r=new Uint32Array(s),o=new Uint16Array(s);a(0);function a(l,c=0){const h=l*2,u=o[h+15]===ZE;if(u){const d=r[l+6],m=o[h+14];e(c,u,new Float32Array(s,l*4,6),d,m)}else{const d=l+lp/4,m=r[l+6],f=r[l+7];e(c,u,new Float32Array(s,l*4,6),f)||(a(d,c+1),a(m,c+1))}}}raycast(e,i=Un,s=0,r=1/0){const o=this._roots,a=this.geometry,l=[],c=i.isMaterial,h=Array.isArray(i),u=a.groups,d=c?i.side:i,m=this.indirect?NCe:ICe;for(let f=0,g=o.length;f<g;f++){const y=h?i[u[f].materialIndex].side:d,v=l.length;if(m(this,f,y,e,l,s,r),h){const b=u[f].materialIndex;for(let A=v,x=l.length;A<x;A++)l[A].face.materialIndex=b}}return l}raycastFirst(e,i=Un,s=0,r=1/0){const o=this._roots,a=this.geometry,l=i.isMaterial,c=Array.isArray(i);let h=null;const u=a.groups,d=l?i.side:i,m=this.indirect?VCe:PCe;for(let f=0,g=o.length;f<g;f++){const y=c?i[u[f].materialIndex].side:d,v=m(this,f,y,e,s,r);v!=null&&(h==null||v.distance<h.distance)&&(h=v,c&&(v.face.materialIndex=u[f].materialIndex))}return h}intersectsGeometry(e,i){let s=!1;const r=this._roots,o=this.indirect?XCe:BCe;for(let a=0,l=r.length;a<l&&(s=o(this,a,e,i),!s);a++);return s}shapecast(e){const i=rl.getPrimitive(),s=this.indirect?RCe:CCe;let{boundsTraverseOrder:r,intersectsBounds:o,intersectsRange:a,intersectsTriangle:l}=e;if(a&&l){const d=a;a=(m,f,g,y,v)=>d(m,f,g,y,v)?!0:s(m,f,this,l,g,y,i)}else a||(l?a=(d,m,f,g)=>s(d,m,this,l,f,g,i):a=(d,m,f)=>f);let c=!1,h=0;const u=this._roots;for(let d=0,m=u.length;d<m;d++){const f=u[d];if(c=vCe(this,d,o,a,r,h),c)break;h+=f.byteLength}return rl.releasePrimitive(i),c}bvhcast(e,i,s){let{intersectsRanges:r,intersectsTriangles:o}=s;const a=rl.getPrimitive(),l=this.geometry.index,c=this.geometry.attributes.position,h=this.indirect?g=>{const y=this.resolveTriangleIndex(g);us(a,y*3,l,c)}:g=>{us(a,g*3,l,c)},u=rl.getPrimitive(),d=e.geometry.index,m=e.geometry.attributes.position,f=e.indirect?g=>{const y=e.resolveTriangleIndex(g);us(u,y*3,d,m)}:g=>{us(u,g*3,d,m)};if(o){const g=(y,v,b,A,x,w,_,S)=>{for(let M=b,R=b+A;M<R;M++){f(M),u.a.applyMatrix4(i),u.b.applyMatrix4(i),u.c.applyMatrix4(i),u.needsUpdate=!0;for(let P=y,C=y+v;P<C;P++)if(h(P),a.needsUpdate=!0,o(a,u,P,M,x,w,_,S))return!0}return!1};if(r){const y=r;r=function(v,b,A,x,w,_,S,M){return y(v,b,A,x,w,_,S,M)?!0:g(v,b,A,x,w,_,S,M)}}else r=g}return YCe(this,e,i,r)}intersectsBox(e,i){return mT.set(e.min,e.max,i),mT.needsUpdate=!0,this.shapecast({intersectsBounds:s=>mT.intersectsBox(s),intersectsTriangle:s=>mT.intersectsTriangle(s)})}intersectsSphere(e){return this.shapecast({intersectsBounds:i=>e.intersectsBox(i),intersectsTriangle:i=>i.intersectsSphere(e)})}closestPointToGeometry(e,i,s={},r={},o=0,a=1/0){return(this.indirect?ZCe:zCe)(this,e,i,s,r,o,a)}closestPointToPoint(e,i={},s=0,r=1/0){return bCe(this,e,i,s,r)}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(i=>{qi(0,new Float32Array(i),g6),e.union(g6)}),e}}const y6=new Wt;class JCe extends ye{get isMesh(){return!this.displayEdges}get isLineSegments(){return this.displayEdges}get isLine(){return this.displayEdges}constructor(e,i,s=10,r=0){super(),this.material=i,this.geometry=new dt,this.name="MeshBVHRootHelper",this.depth=s,this.displayParents=!1,this.bvh=e,this.displayEdges=!0,this._group=r}raycast(){}update(){const e=this.geometry,i=this.bvh,s=this._group;if(e.dispose(),this.visible=!1,i){const r=this.depth-1,o=this.displayParents;let a=0;i.traverse((m,f)=>{if(m>=r||f)return a++,!0;o&&a++},s);let l=0;const c=new Float32Array(8*3*a);i.traverse((m,f,g)=>{const y=m>=r||f;if(y||o){qi(0,g,y6);const{min:v,max:b}=y6;for(let A=-1;A<=1;A+=2){const x=A<0?v.x:b.x;for(let w=-1;w<=1;w+=2){const _=w<0?v.y:b.y;for(let S=-1;S<=1;S+=2){const M=S<0?v.z:b.z;c[l+0]=x,c[l+1]=_,c[l+2]=M,l+=3}}}return y}},s);let h,u;this.displayEdges?u=new Uint8Array([0,4,1,5,2,6,3,7,0,2,1,3,4,6,5,7,0,1,2,3,4,5,6,7]):u=new Uint8Array([0,1,2,2,1,3,4,6,5,6,7,5,1,4,5,0,4,1,2,3,6,3,7,6,0,2,4,2,6,4,1,5,3,3,5,7]),c.length>65535?h=new Uint32Array(u.length*a):h=new Uint16Array(u.length*a);const d=u.length;for(let m=0;m<a;m++){const f=m*8,g=m*d;for(let y=0;y<d;y++)h[g+y]=f+u[y]}e.setIndex(new qe(h,1,!1)),e.setAttribute("position",new qe(c,3,!1)),this.visible=!0}}}class B3 extends Vn{get color(){return this.edgeMaterial.color}get opacity(){return this.edgeMaterial.opacity}set opacity(e){this.edgeMaterial.opacity=e,this.meshMaterial.opacity=e}constructor(e=null,i=null,s=10){e instanceof Vy&&(s=i||10,i=e,e=null),typeof i=="number"&&(s=i,i=null),super(),this.name="MeshBVHHelper",this.depth=s,this.mesh=e,this.bvh=i,this.displayParents=!1,this.displayEdges=!0,this._roots=[];const r=new Vi({color:65416,transparent:!0,opacity:.3,depthWrite:!1}),o=new Qt({color:65416,transparent:!0,opacity:.3,depthWrite:!1});o.color=r.color,this.edgeMaterial=r,this.meshMaterial=o,this.update()}update(){const e=this.bvh||this.mesh.geometry.boundsTree,i=e?e._roots.length:0;for(;this._roots.length>i;){const s=this._roots.pop();s.geometry.dispose(),this.remove(s)}for(let s=0;s<i;s++){const{depth:r,edgeMaterial:o,meshMaterial:a,displayParents:l,displayEdges:c}=this;if(s>=this._roots.length){const u=new JCe(e,o,r,s);this.add(u),this._roots.push(u)}const h=this._roots[s];h.bvh=e,h.depth=r,h.displayParents=l,h.displayEdges=c,h.material=c?o:a,h.update()}}updateMatrixWorld(...e){const i=this.mesh,s=this.parent;i!==null&&(i.updateWorldMatrix(!0,!1),s?this.matrix.copy(s.matrixWorld).invert().multiply(i.matrixWorld):this.matrix.copy(i.matrixWorld),this.matrix.decompose(this.position,this.quaternion,this.scale)),super.updateMatrixWorld(...e)}copy(e){this.depth=e.depth,this.mesh=e.mesh,this.bvh=e.bvh,this.opacity=e.opacity,this.color.copy(e.color)}clone(){return new B3(this.mesh,this.bvh,this.depth)}dispose(){this.edgeMaterial.dispose(),this.meshMaterial.dispose();const e=this.children;for(let i=0,s=e.length;i<s;i++)e[i].geometry.dispose()}}const l1=new Wt,v6=new Wt,Dy=new E;function b6(n){switch(typeof n){case"number":return 8;case"string":return n.length*2;case"boolean":return 4;default:return 0}}function qCe(n){return/(Uint|Int|Float)(8|16|32)Array/.test(n.constructor.name)}function $Ce(n,e){const i={nodeCount:0,leafNodeCount:0,depth:{min:1/0,max:-1/0},tris:{min:1/0,max:-1/0},splits:[0,0,0],surfaceAreaScore:0};return n.traverse((s,r,o,a,l)=>{const c=o[3]-o[0],h=o[1+3]-o[1],u=o[2+3]-o[2],d=2*(c*h+h*u+u*c);i.nodeCount++,r?(i.leafNodeCount++,i.depth.min=Math.min(s,i.depth.min),i.depth.max=Math.max(s,i.depth.max),i.tris.min=Math.min(l,i.tris.min),i.tris.max=Math.max(l,i.tris.max),i.surfaceAreaScore+=d*QE*l):(i.splits[a]++,i.surfaceAreaScore+=d*qG)},e),i.tris.min===1/0&&(i.tris.min=0,i.tris.max=0),i.depth.min===1/0&&(i.depth.min=0,i.depth.max=0),i}function eMe(n){return n._roots.map((e,i)=>$Ce(n,i))}function tMe(n){const e=new Set,i=[n];let s=0;for(;i.length;){const r=i.pop();if(!e.has(r)){e.add(r);for(let o in r){if(!Object.hasOwn(r,o))continue;s+=b6(o);const a=r[o];a&&(typeof a=="object"||typeof a=="function")?qCe(a)||f6()&&a instanceof SharedArrayBuffer||a instanceof ArrayBuffer?s+=a.byteLength:i.push(a):s+=b6(a)}}}return s}function iMe(n){const e=n.geometry,i=[],s=e.index,r=e.getAttribute("position");let o=!0;return n.traverse((a,l,c,h,u)=>{const d={depth:a,isLeaf:l,boundingData:c,offset:h,count:u};i[a]=d,qi(0,c,l1);const m=i[a-1];if(l)for(let f=h,g=h+u;f<g;f++){const y=n.resolveTriangleIndex(f);let v=3*y,b=3*y+1,A=3*y+2;s&&(v=s.getX(v),b=s.getX(b),A=s.getX(A));let x;Dy.fromBufferAttribute(r,v),x=l1.containsPoint(Dy),Dy.fromBufferAttribute(r,b),x=x&&l1.containsPoint(Dy),Dy.fromBufferAttribute(r,A),x=x&&l1.containsPoint(Dy),console.assert(x,"Leaf bounds does not fully contain triangle."),o=o&&x}if(m){qi(0,c,v6);const f=v6.containsBox(l1);console.assert(f,"Parent bounds does not fully contain child."),o=o&&f}}),o}function nMe(n){const e=[];return n.traverse((i,s,r,o,a)=>{const l={bounds:qi(0,r,new Wt)};s?(l.count=a,l.offset=o):(l.left=null,l.right=null),e[i]=l;const c=e[i-1];c&&(c.left===null?c.left=l:c.right=l)}),e[0]}function A6(n,e,i){return n===null?null:(n.point.applyMatrix4(e.matrixWorld),n.distance=n.point.distanceTo(i.ray.origin),n.object=e,n)}const fT=new qr,x6=new E,w6=new he,sMe=pe.prototype.raycast,_6=new E;function rMe(n,e){if(this.geometry.boundsTree){if(this.material===void 0)return;w6.copy(this.matrixWorld).invert(),fT.copy(n.ray).applyMatrix4(w6),lMe(this.matrixWorld,_6),x6.copy(fT.direction).multiply(_6);const i=x6.length(),s=n.near/i,r=n.far/i,o=this.geometry.boundsTree;if(n.firstHitOnly===!0){const a=A6(o.raycastFirst(fT,this.material,s,r),this,n);a&&e.push(a)}else{const a=o.raycast(fT,this.material,s,r);for(let l=0,c=a.length;l<c;l++){const h=A6(a[l],this,n);h&&e.push(h)}}}else sMe.call(this,n,e)}function oMe(n){return this.boundsTree=new Vy(this,n),this.boundsTree}function aMe(){this.boundsTree=null}function lMe(n,e){const i=n.elements,s=e.set(i[0],i[1],i[2]).length(),r=e.set(i[4],i[5],i[6]).length(),o=e.set(i[8],i[9],i[10]).length();return e.set(s,r,o)}function cMe(n){switch(n){case 1:return"R";case 2:return"RG";case 3:return"RGBA";case 4:return"RGBA"}throw new Error}function hMe(n){switch(n){case 1:return Sp;case 2:return P1;case 3:return _i;case 4:return _i}}function S6(n){switch(n){case 1:return L1;case 2:return qy;case 3:return Bf;case 4:return Bf}}class gT extends Tr{constructor(){super(),this.minFilter=Dt,this.magFilter=Dt,this.generateMipmaps=!1,this.overrideItemSize=null,this._forcedType=null}updateFrom(e){const i=this.overrideItemSize,s=e.itemSize,r=e.count;if(i!==null){if(s*r%i!==0)throw new Error("VertexAttributeTexture: overrideItemSize must divide evenly into buffer length.");e.itemSize=i,e.count=r*s/i}const o=e.itemSize,a=e.count,l=e.normalized,c=e.array.constructor,h=c.BYTES_PER_ELEMENT;let u=this._forcedType,d=o;if(u===null)switch(c){case Float32Array:u=Hi;break;case Uint8Array:case Uint16Array:case Uint32Array:u=_r;break;case Int8Array:case Int16Array:case Int32Array:u=_p;break}let m,f,g,y,v=cMe(o);switch(u){case Hi:g=1,f=hMe(o),l&&h===1?(y=c,v+="8",c===Uint8Array?m=pn:(m=R1,v+="_SNORM")):(y=Float32Array,v+="32F",m=Hi);break;case _p:v+=h*8+"I",g=l?Math.pow(2,c.BYTES_PER_ELEMENT*8-1):1,f=S6(o),h===1?(y=Int8Array,m=R1):h===2?(y=Int16Array,m=JT):(y=Int32Array,m=_p);break;case _r:v+=h*8+"UI",g=l?Math.pow(2,c.BYTES_PER_ELEMENT*8-1):1,f=S6(o),h===1?(y=Uint8Array,m=pn):h===2?(y=Uint16Array,m=Jy):(y=Uint32Array,m=_r);break}d===3&&(f===_i||f===Bf)&&(d=4);const b=Math.ceil(Math.sqrt(a))||1,A=d*b*b,x=new y(A),w=e.normalized;e.normalized=!1;for(let _=0;_<a;_++){const S=d*_;x[S]=e.getX(_)/g,o>=2&&(x[S+1]=e.getY(_)/g),o>=3&&(x[S+2]=e.getZ(_)/g,d===4&&(x[S+3]=1)),o>=4&&(x[S+3]=e.getW(_)/g)}e.normalized=w,this.internalFormat=v,this.format=f,this.type=m,this.image.width=b,this.image.height=b,this.image.data=x,this.needsUpdate=!0,this.dispose(),e.itemSize=s,e.count=r}}class C6 extends gT{constructor(){super(),this._forcedType=_r}}class uMe extends gT{constructor(){super(),this._forcedType=_p}}class M6 extends gT{constructor(){super(),this._forcedType=Hi}}class dMe{constructor(){this.index=new C6,this.position=new M6,this.bvhBounds=new Tr,this.bvhContents=new Tr,this._cachedIndexAttr=null,this.index.overrideItemSize=3}updateFrom(e){const{geometry:i}=e;if(mMe(e,this.bvhBounds,this.bvhContents),this.position.updateFrom(i.attributes.position),e.indirect){const s=e._indirectBuffer;if(this._cachedIndexAttr===null||this._cachedIndexAttr.count!==s.length)if(i.index)this._cachedIndexAttr=i.index.clone();else{const r=$K(qK(i));this._cachedIndexAttr=new qe(r,1,!1)}pMe(i,s,this._cachedIndexAttr),this.index.updateFrom(this._cachedIndexAttr)}else this.index.updateFrom(i.index)}dispose(){const{index:e,position:i,bvhBounds:s,bvhContents:r}=this;e&&e.dispose(),i&&i.dispose(),s&&s.dispose(),r&&r.dispose()}}function pMe(n,e,i){const s=i.array,r=n.index?n.index.array:null;for(let o=0,a=e.length;o<a;o++){const l=3*o,c=3*e[o];for(let h=0;h<3;h++)s[l+h]=r?r[c+h]:c+h}}function mMe(n,e,i){const s=n._roots;if(s.length!==1)throw new Error("MeshBVHUniformStruct: Multi-root BVHs not supported.");const r=s[0],o=new Uint16Array(r),a=new Uint32Array(r),l=new Float32Array(r),c=r.byteLength/lp,h=2*Math.ceil(Math.sqrt(c/2)),u=new Float32Array(4*h*h),d=Math.ceil(Math.sqrt(c)),m=new Uint32Array(2*d*d);for(let f=0;f<c;f++){const g=f*lp/4,y=g*2,v=g;for(let b=0;b<3;b++)u[8*f+0+b]=l[v+0+b],u[8*f+4+b]=l[v+3+b];if(xo(y,o)){const b=wa(y,o),A=Uo(g,a),x=4294901760|b;m[f*2+0]=x,m[f*2+1]=A}else{const b=4*_a(g,a)/lp,A=i3(g,a);m[f*2+0]=A,m[f*2+1]=b}}e.image.data=u,e.image.width=h,e.image.height=h,e.format=_i,e.type=Hi,e.internalFormat="RGBA32F",e.minFilter=Dt,e.magFilter=Dt,e.generateMipmaps=!1,e.needsUpdate=!0,e.dispose(),i.image.data=m,i.image.width=d,i.image.height=d,i.format=qy,i.type=_r,i.internalFormat="RG32UI",i.minFilter=Dt,i.magFilter=Dt,i.generateMipmaps=!1,i.needsUpdate=!0,i.dispose()}const wf=new E,_f=new E,Sf=new E,E6=new Ze,yT=new E,x3=new E,T6=new Ze,R6=new Ze,vT=new he,I6=new he;function c1(n,e){if(!n&&!e)return;const i=n.count===e.count,s=n.normalized===e.normalized,r=n.array.constructor===e.array.constructor,o=n.itemSize===e.itemSize;if(!i||!s||!r||!o)throw new Error}function h1(n,e=null){const i=n.array.constructor,s=n.normalized,r=n.itemSize,o=e===null?n.count:e;return new qe(new i(r*o),r,s)}function L6(n,e,i=0){if(n.isInterleavedBufferAttribute){const s=n.itemSize;for(let r=0,o=n.count;r<o;r++){const a=r+i;e.setX(a,n.getX(r)),s>=2&&e.setY(a,n.getY(r)),s>=3&&e.setZ(a,n.getZ(r)),s>=4&&e.setW(a,n.getW(r))}}else{const s=e.array,r=s.constructor,o=s.BYTES_PER_ELEMENT*n.itemSize*i;new r(s.buffer,o,n.array.length).set(n.array)}}function fMe(n,e,i){const s=n.elements,r=e.elements;for(let o=0,a=r.length;o<a;o++)s[o]+=r[o]*i}function P6(n,e,i){const s=n.skeleton,r=n.geometry,o=s.bones,a=s.boneInverses;T6.fromBufferAttribute(r.attributes.skinIndex,e),R6.fromBufferAttribute(r.attributes.skinWeight,e),vT.elements.fill(0);for(let l=0;l<4;l++){const c=R6.getComponent(l);if(c!==0){const h=T6.getComponent(l);I6.multiplyMatrices(o[h].matrixWorld,a[h]),fMe(vT,I6,c)}}return vT.multiply(n.bindMatrix).premultiply(n.bindMatrixInverse),i.transformDirection(vT),i}function w3(n,e,i,s,r){yT.set(0,0,0);for(let o=0,a=n.length;o<a;o++){const l=e[o],c=n[o];l!==0&&(x3.fromBufferAttribute(c,s),i?yT.addScaledVector(x3,l):yT.addScaledVector(x3.sub(r),l))}r.add(yT)}function gMe(n,e={useGroups:!1,updateIndex:!1,skipAttributes:[]},i=new dt){const s=n[0].index!==null,{useGroups:r=!1,updateIndex:o=!1,skipAttributes:a=[]}=e,l=new Set(Object.keys(n[0].attributes)),c={};let h=0;i.clearGroups();for(let u=0;u<n.length;++u){const d=n[u];let m=0;if(s!==(d.index!==null))throw new Error("StaticGeometryGenerator: All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them.");for(const f in d.attributes){if(!l.has(f))throw new Error('StaticGeometryGenerator: All geometries must have compatible attributes; make sure "'+f+'" attribute exists among all geometries, or in none of them.');c[f]===void 0&&(c[f]=[]),c[f].push(d.attributes[f]),m++}if(m!==l.size)throw new Error("StaticGeometryGenerator: Make sure all geometries have the same number of attributes.");if(r){let f;if(s)f=d.index.count;else if(d.attributes.position!==void 0)f=d.attributes.position.count;else throw new Error("StaticGeometryGenerator: The geometry must have either an index or a position attribute");i.addGroup(h,f,u),h+=f}}if(s){let u=!1;if(!i.index){let d=0;for(let m=0;m<n.length;++m)d+=n[m].index.count;i.setIndex(new qe(new Uint32Array(d),1,!1)),u=!0}if(o||u){const d=i.index;let m=0,f=0;for(let g=0;g<n.length;++g){const y=n[g],v=y.index;if(a[g]!==!0)for(let b=0;b<v.count;++b)d.setX(m,v.getX(b)+f),m++;f+=y.attributes.position.count}}}for(const u in c){const d=c[u];if(!(u in i.attributes)){let g=0;for(const y in d)g+=d[y].count;i.setAttribute(u,h1(c[u][0],g))}const m=i.attributes[u];let f=0;for(let g=0,y=d.length;g<y;g++){const v=d[g];a[g]!==!0&&L6(v,m,f),f+=v.count}}return i}function yMe(n,e){if(n===null||e===null)return n===e;if(n.length!==e.length)return!1;for(let i=0,s=n.length;i<s;i++)if(n[i]!==e[i])return!1;return!0}function vMe(n){const{index:e,attributes:i}=n;if(e)for(let s=0,r=e.count;s<r;s+=3){const o=e.getX(s),a=e.getX(s+2);e.setX(s,a),e.setX(s+2,o)}else for(const s in i){const r=i[s],o=r.itemSize;for(let a=0,l=r.count;a<l;a+=3)for(let c=0;c<o;c++){const h=r.getComponent(a,c),u=r.getComponent(a+2,c);r.setComponent(a,c,u),r.setComponent(a+2,c,h)}}return n}class bMe{constructor(e){this.matrixWorld=new he,this.geometryHash=null,this.boneMatrices=null,this.primitiveCount=-1,this.mesh=e,this.update()}update(){const e=this.mesh,i=e.geometry,s=e.skeleton,r=(i.index?i.index.count:i.attributes.position.count)/3;if(this.matrixWorld.copy(e.matrixWorld),this.geometryHash=i.attributes.position.version,this.primitiveCount=r,s){s.boneTexture||s.computeBoneTexture(),s.update();const o=s.boneMatrices;!this.boneMatrices||this.boneMatrices.length!==o.length?this.boneMatrices=o.slice():this.boneMatrices.set(o)}else this.boneMatrices=null}didChange(){const e=this.mesh,i=e.geometry,s=(i.index?i.index.count:i.attributes.position.count)/3;return!(this.matrixWorld.equals(e.matrixWorld)&&this.geometryHash===i.attributes.position.version&&yMe(e.skeleton&&e.skeleton.boneMatrices||null,this.boneMatrices)&&this.primitiveCount===s)}}class AMe{constructor(e){Array.isArray(e)||(e=[e]);const i=[];e.forEach(s=>{s.traverseVisible(r=>{r.isMesh&&i.push(r)})}),this.meshes=i,this.useGroups=!0,this.applyWorldTransforms=!0,this.attributes=["position","normal","color","tangent","uv","uv2"],this._intermediateGeometry=new Array(i.length).fill().map(()=>new dt),this._diffMap=new WeakMap}getMaterials(){const e=[];return this.meshes.forEach(i=>{Array.isArray(i.material)?e.push(...i.material):e.push(i.material)}),e}generate(e=new dt){let i=[];const{meshes:s,useGroups:r,_intermediateGeometry:o,_diffMap:a}=this;for(let l=0,c=s.length;l<c;l++){const h=s[l],u=o[l],d=a.get(h);!d||d.didChange(h)?(this._convertToStaticGeometry(h,u),i.push(!1),d?d.update():a.set(h,new bMe(h))):i.push(!0)}if(o.length===0){e.setIndex(null);const l=e.attributes;for(const c in l)e.deleteAttribute(c);for(const c in this.attributes)e.setAttribute(this.attributes[c],new qe(new Float32Array(0),4,!1))}else gMe(o,{useGroups:r,skipAttributes:i},e);for(const l in e.attributes)e.attributes[l].needsUpdate=!0;return e}_convertToStaticGeometry(e,i=new dt){const s=e.geometry,r=this.applyWorldTransforms,o=this.attributes.includes("normal"),a=this.attributes.includes("tangent"),l=s.attributes,c=i.attributes;!i.index&&s.index&&(i.index=s.index.clone()),c.position||i.setAttribute("position",h1(l.position)),o&&!c.normal&&l.normal&&i.setAttribute("normal",h1(l.normal)),a&&!c.tangent&&l.tangent&&i.setAttribute("tangent",h1(l.tangent)),c1(s.index,i.index),c1(l.position,c.position),o&&c1(l.normal,c.normal),a&&c1(l.tangent,c.tangent);const h=l.position,u=o?l.normal:null,d=a?l.tangent:null,m=s.morphAttributes.position,f=s.morphAttributes.normal,g=s.morphAttributes.tangent,y=s.morphTargetsRelative,v=e.morphTargetInfluences,b=new Gt;b.getNormalMatrix(e.matrixWorld),s.index&&i.index.array.set(s.index.array);for(let A=0,x=l.position.count;A<x;A++)wf.fromBufferAttribute(h,A),u&&_f.fromBufferAttribute(u,A),d&&(E6.fromBufferAttribute(d,A),Sf.fromBufferAttribute(d,A)),v&&(m&&w3(m,v,y,A,wf),f&&w3(f,v,y,A,_f),g&&w3(g,v,y,A,Sf)),e.isSkinnedMesh&&(e.applyBoneTransform(A,wf),u&&P6(e,A,_f),d&&P6(e,A,Sf)),r&&wf.applyMatrix4(e.matrixWorld),c.position.setXYZ(A,wf.x,wf.y,wf.z),u&&(r&&_f.applyNormalMatrix(b),c.normal.setXYZ(A,_f.x,_f.y,_f.z)),d&&(r&&Sf.transformDirection(e.matrixWorld),c.tangent.setXYZW(A,Sf.x,Sf.y,Sf.z,E6.w));for(const A in this.attributes){const x=this.attributes[A];x==="position"||x==="tangent"||x==="normal"||!(x in l)||(c[x]||i.setAttribute(x,h1(l[x])),c1(l[x],c[x]),L6(l[x],c[x]))}return e.matrixWorld.determinant()<0&&vMe(i),i}}const B6=`

// A stack of uint32 indices can can store the indices for
// a perfectly balanced tree with a depth up to 31. Lower stack
// depth gets higher performance.
//
// However not all trees are balanced. Best value to set this to
// is the trees max depth.
#ifndef BVH_STACK_DEPTH
#define BVH_STACK_DEPTH 60
#endif

#ifndef INFINITY
#define INFINITY 1e20
#endif

// Utilities
uvec4 uTexelFetch1D( usampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

ivec4 iTexelFetch1D( isampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

vec4 texelFetch1D( sampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

vec4 textureSampleBarycoord( sampler2D tex, vec3 barycoord, uvec3 faceIndices ) {

	return
		barycoord.x * texelFetch1D( tex, faceIndices.x ) +
		barycoord.y * texelFetch1D( tex, faceIndices.y ) +
		barycoord.z * texelFetch1D( tex, faceIndices.z );

}

void ndcToCameraRay(
	vec2 coord, mat4 cameraWorld, mat4 invProjectionMatrix,
	out vec3 rayOrigin, out vec3 rayDirection
) {

	// get camera look direction and near plane for camera clipping
	vec4 lookDirection = cameraWorld * vec4( 0.0, 0.0, - 1.0, 0.0 );
	vec4 nearVector = invProjectionMatrix * vec4( 0.0, 0.0, - 1.0, 1.0 );
	float near = abs( nearVector.z / nearVector.w );

	// get the camera direction and position from camera matrices
	vec4 origin = cameraWorld * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec4 direction = invProjectionMatrix * vec4( coord, 0.5, 1.0 );
	direction /= direction.w;
	direction = cameraWorld * direction - origin;

	// slide the origin along the ray until it sits at the near clip plane position
	origin.xyz += direction.xyz * near / dot( direction, lookDirection );

	rayOrigin = origin.xyz;
	rayDirection = direction.xyz;

}
`,k6=`

float dot2( vec3 v ) {

	return dot( v, v );

}

// https://www.shadertoy.com/view/ttfGWl
vec3 closestPointToTriangle( vec3 p, vec3 v0, vec3 v1, vec3 v2, out vec3 barycoord ) {

    vec3 v10 = v1 - v0;
    vec3 v21 = v2 - v1;
    vec3 v02 = v0 - v2;

	vec3 p0 = p - v0;
	vec3 p1 = p - v1;
	vec3 p2 = p - v2;

    vec3 nor = cross( v10, v02 );

    // method 2, in barycentric space
    vec3  q = cross( nor, p0 );
    float d = 1.0 / dot2( nor );
    float u = d * dot( q, v02 );
    float v = d * dot( q, v10 );
    float w = 1.0 - u - v;

	if( u < 0.0 ) {

		w = clamp( dot( p2, v02 ) / dot2( v02 ), 0.0, 1.0 );
		u = 0.0;
		v = 1.0 - w;

	} else if( v < 0.0 ) {

		u = clamp( dot( p0, v10 ) / dot2( v10 ), 0.0, 1.0 );
		v = 0.0;
		w = 1.0 - u;

	} else if( w < 0.0 ) {

		v = clamp( dot( p1, v21 ) / dot2( v21 ), 0.0, 1.0 );
		w = 0.0;
		u = 1.0-v;

	}

	barycoord = vec3( u, v, w );
    return u * v1 + v * v2 + w * v0;

}

float distanceToTriangles(
	// geometry info and triangle range
	sampler2D positionAttr, usampler2D indexAttr, uint offset, uint count,

	// point and cut off range
	vec3 point, float closestDistanceSquared,

	// outputs
	inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord, inout float side, inout vec3 outPoint
) {

	bool found = false;
	vec3 localBarycoord;
	for ( uint i = offset, l = offset + count; i < l; i ++ ) {

		uvec3 indices = uTexelFetch1D( indexAttr, i ).xyz;
		vec3 a = texelFetch1D( positionAttr, indices.x ).rgb;
		vec3 b = texelFetch1D( positionAttr, indices.y ).rgb;
		vec3 c = texelFetch1D( positionAttr, indices.z ).rgb;

		// get the closest point and barycoord
		vec3 closestPoint = closestPointToTriangle( point, a, b, c, localBarycoord );
		vec3 delta = point - closestPoint;
		float sqDist = dot2( delta );
		if ( sqDist < closestDistanceSquared ) {

			// set the output results
			closestDistanceSquared = sqDist;
			faceIndices = uvec4( indices.xyz, i );
			faceNormal = normalize( cross( a - b, b - c ) );
			barycoord = localBarycoord;
			outPoint = closestPoint;
			side = sign( dot( faceNormal, delta ) );

		}

	}

	return closestDistanceSquared;

}

float distanceSqToBounds( vec3 point, vec3 boundsMin, vec3 boundsMax ) {

	vec3 clampedPoint = clamp( point, boundsMin, boundsMax );
	vec3 delta = point - clampedPoint;
	return dot( delta, delta );

}

float distanceSqToBVHNodeBoundsPoint( vec3 point, sampler2D bvhBounds, uint currNodeIndex ) {

	uint cni2 = currNodeIndex * 2u;
	vec3 boundsMin = texelFetch1D( bvhBounds, cni2 ).xyz;
	vec3 boundsMax = texelFetch1D( bvhBounds, cni2 + 1u ).xyz;
	return distanceSqToBounds( point, boundsMin, boundsMax );

}

// use a macro to hide the fact that we need to expand the struct into separate fields
#define	bvhClosestPointToPoint(		bvh,		point, faceIndices, faceNormal, barycoord, side, outPoint	)	_bvhClosestPointToPoint(		bvh.position, bvh.index, bvh.bvhBounds, bvh.bvhContents,		point, faceIndices, faceNormal, barycoord, side, outPoint	)

float _bvhClosestPointToPoint(
	// bvh info
	sampler2D bvh_position, usampler2D bvh_index, sampler2D bvh_bvhBounds, usampler2D bvh_bvhContents,

	// point to check
	vec3 point,

	// output variables
	inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,
	inout float side, inout vec3 outPoint
 ) {

	// stack needs to be twice as long as the deepest tree we expect because
	// we push both the left and right child onto the stack every traversal
	int ptr = 0;
	uint stack[ BVH_STACK_DEPTH ];
	stack[ 0 ] = 0u;

	float closestDistanceSquared = pow( 100000.0, 2.0 );
	bool found = false;
	while ( ptr > - 1 && ptr < BVH_STACK_DEPTH ) {

		uint currNodeIndex = stack[ ptr ];
		ptr --;

		// check if we intersect the current bounds
		float boundsHitDistance = distanceSqToBVHNodeBoundsPoint( point, bvh_bvhBounds, currNodeIndex );
		if ( boundsHitDistance > closestDistanceSquared ) {

			continue;

		}

		uvec2 boundsInfo = uTexelFetch1D( bvh_bvhContents, currNodeIndex ).xy;
		bool isLeaf = bool( boundsInfo.x & 0xffff0000u );
		if ( isLeaf ) {

			uint count = boundsInfo.x & 0x0000ffffu;
			uint offset = boundsInfo.y;
			closestDistanceSquared = distanceToTriangles(
				bvh_position, bvh_index, offset, count, point, closestDistanceSquared,

				// outputs
				faceIndices, faceNormal, barycoord, side, outPoint
			);

		} else {

			uint leftIndex = currNodeIndex + 1u;
			uint splitAxis = boundsInfo.x & 0x0000ffffu;
			uint rightIndex = boundsInfo.y;
			bool leftToRight = distanceSqToBVHNodeBoundsPoint( point, bvh_bvhBounds, leftIndex ) < distanceSqToBVHNodeBoundsPoint( point, bvh_bvhBounds, rightIndex );//rayDirection[ splitAxis ] >= 0.0;
			uint c1 = leftToRight ? leftIndex : rightIndex;
			uint c2 = leftToRight ? rightIndex : leftIndex;

			// set c2 in the stack so we traverse it later. We need to keep track of a pointer in
			// the stack while we traverse. The second pointer added is the one that will be
			// traversed first
			ptr ++;
			stack[ ptr ] = c2;
			ptr ++;
			stack[ ptr ] = c1;

		}

	}

	return sqrt( closestDistanceSquared );

}
`,D6=`

#ifndef TRI_INTERSECT_EPSILON
#define TRI_INTERSECT_EPSILON 1e-5
#endif

// Raycasting
bool intersectsBounds( vec3 rayOrigin, vec3 rayDirection, vec3 boundsMin, vec3 boundsMax, out float dist ) {

	// https://www.reddit.com/r/opengl/comments/8ntzz5/fast_glsl_ray_box_intersection/
	// https://tavianator.com/2011/ray_box.html
	vec3 invDir = 1.0 / rayDirection;

	// find intersection distances for each plane
	vec3 tMinPlane = invDir * ( boundsMin - rayOrigin );
	vec3 tMaxPlane = invDir * ( boundsMax - rayOrigin );

	// get the min and max distances from each intersection
	vec3 tMinHit = min( tMaxPlane, tMinPlane );
	vec3 tMaxHit = max( tMaxPlane, tMinPlane );

	// get the furthest hit distance
	vec2 t = max( tMinHit.xx, tMinHit.yz );
	float t0 = max( t.x, t.y );

	// get the minimum hit distance
	t = min( tMaxHit.xx, tMaxHit.yz );
	float t1 = min( t.x, t.y );

	// set distance to 0.0 if the ray starts inside the box
	dist = max( t0, 0.0 );

	return t1 >= dist;

}

bool intersectsTriangle(
	vec3 rayOrigin, vec3 rayDirection, vec3 a, vec3 b, vec3 c,
	out vec3 barycoord, out vec3 norm, out float dist, out float side
) {

	// https://stackoverflow.com/questions/42740765/intersection-between-line-and-triangle-in-3d
	vec3 edge1 = b - a;
	vec3 edge2 = c - a;
	norm = cross( edge1, edge2 );

	float det = - dot( rayDirection, norm );
	float invdet = 1.0 / det;

	vec3 AO = rayOrigin - a;
	vec3 DAO = cross( AO, rayDirection );

	vec4 uvt;
	uvt.x = dot( edge2, DAO ) * invdet;
	uvt.y = - dot( edge1, DAO ) * invdet;
	uvt.z = dot( AO, norm ) * invdet;
	uvt.w = 1.0 - uvt.x - uvt.y;

	// set the hit information
	barycoord = uvt.wxy; // arranged in A, B, C order
	dist = uvt.z;
	side = sign( det );
	norm = side * normalize( norm );

	// add an epsilon to avoid misses between triangles
	uvt += vec4( TRI_INTERSECT_EPSILON );

	return all( greaterThanEqual( uvt, vec4( 0.0 ) ) );

}

bool intersectTriangles(
	// geometry info and triangle range
	sampler2D positionAttr, usampler2D indexAttr, uint offset, uint count,

	// ray
	vec3 rayOrigin, vec3 rayDirection,

	// outputs
	inout float minDistance, inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,
	inout float side, inout float dist
) {

	bool found = false;
	vec3 localBarycoord, localNormal;
	float localDist, localSide;
	for ( uint i = offset, l = offset + count; i < l; i ++ ) {

		uvec3 indices = uTexelFetch1D( indexAttr, i ).xyz;
		vec3 a = texelFetch1D( positionAttr, indices.x ).rgb;
		vec3 b = texelFetch1D( positionAttr, indices.y ).rgb;
		vec3 c = texelFetch1D( positionAttr, indices.z ).rgb;

		if (
			intersectsTriangle( rayOrigin, rayDirection, a, b, c, localBarycoord, localNormal, localDist, localSide )
			&& localDist < minDistance
		) {

			found = true;
			minDistance = localDist;

			faceIndices = uvec4( indices.xyz, i );
			faceNormal = localNormal;

			side = localSide;
			barycoord = localBarycoord;
			dist = localDist;

		}

	}

	return found;

}

bool intersectsBVHNodeBounds( vec3 rayOrigin, vec3 rayDirection, sampler2D bvhBounds, uint currNodeIndex, out float dist ) {

	uint cni2 = currNodeIndex * 2u;
	vec3 boundsMin = texelFetch1D( bvhBounds, cni2 ).xyz;
	vec3 boundsMax = texelFetch1D( bvhBounds, cni2 + 1u ).xyz;
	return intersectsBounds( rayOrigin, rayDirection, boundsMin, boundsMax, dist );

}

// use a macro to hide the fact that we need to expand the struct into separate fields
#define	bvhIntersectFirstHit(		bvh,		rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist	)	_bvhIntersectFirstHit(		bvh.position, bvh.index, bvh.bvhBounds, bvh.bvhContents,		rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist	)

bool _bvhIntersectFirstHit(
	// bvh info
	sampler2D bvh_position, usampler2D bvh_index, sampler2D bvh_bvhBounds, usampler2D bvh_bvhContents,

	// ray
	vec3 rayOrigin, vec3 rayDirection,

	// output variables split into separate variables due to output precision
	inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,
	inout float side, inout float dist
) {

	// stack needs to be twice as long as the deepest tree we expect because
	// we push both the left and right child onto the stack every traversal
	int ptr = 0;
	uint stack[ BVH_STACK_DEPTH ];
	stack[ 0 ] = 0u;

	float triangleDistance = INFINITY;
	bool found = false;
	while ( ptr > - 1 && ptr < BVH_STACK_DEPTH ) {

		uint currNodeIndex = stack[ ptr ];
		ptr --;

		// check if we intersect the current bounds
		float boundsHitDistance;
		if (
			! intersectsBVHNodeBounds( rayOrigin, rayDirection, bvh_bvhBounds, currNodeIndex, boundsHitDistance )
			|| boundsHitDistance > triangleDistance
		) {

			continue;

		}

		uvec2 boundsInfo = uTexelFetch1D( bvh_bvhContents, currNodeIndex ).xy;
		bool isLeaf = bool( boundsInfo.x & 0xffff0000u );

		if ( isLeaf ) {

			uint count = boundsInfo.x & 0x0000ffffu;
			uint offset = boundsInfo.y;

			found = intersectTriangles(
				bvh_position, bvh_index, offset, count,
				rayOrigin, rayDirection, triangleDistance,
				faceIndices, faceNormal, barycoord, side, dist
			) || found;

		} else {

			uint leftIndex = currNodeIndex + 1u;
			uint splitAxis = boundsInfo.x & 0x0000ffffu;
			uint rightIndex = boundsInfo.y;

			bool leftToRight = rayDirection[ splitAxis ] >= 0.0;
			uint c1 = leftToRight ? leftIndex : rightIndex;
			uint c2 = leftToRight ? rightIndex : leftIndex;

			// set c2 in the stack so we traverse it later. We need to keep track of a pointer in
			// the stack while we traverse. The second pointer added is the one that will be
			// traversed first
			ptr ++;
			stack[ ptr ] = c2;

			ptr ++;
			stack[ ptr ] = c1;

		}

	}

	return found;

}
`,O6=`
struct BVH {

	usampler2D index;
	sampler2D position;

	sampler2D bvhBounds;
	usampler2D bvhContents;

};
`,xMe=Object.freeze(Object.defineProperty({__proto__:null,bvh_distance_functions:k6,bvh_ray_functions:D6,bvh_struct_definitions:O6,common_functions:B6},Symbol.toStringTag,{value:"Module"})),wMe=O6,_Me=k6,SMe=`
	${B6}
	${D6}
`,CMe=Object.freeze(Object.defineProperty({__proto__:null,AVERAGE:KK,BVHShaderGLSL:xMe,CENTER:KG,CONTAINED:JG,ExtendedTriangle:sl,FloatVertexAttributeTexture:M6,INTERSECTED:qSe,IntVertexAttributeTexture:uMe,MeshBVH:Vy,MeshBVHHelper:B3,MeshBVHUniformStruct:dMe,NOT_INTERSECTED:JSe,OrientedBox:Qr,SAH:JK,StaticGeometryGenerator:AMe,UIntVertexAttributeTexture:C6,VertexAttributeTexture:gT,acceleratedRaycast:rMe,computeBoundsTree:oMe,disposeBoundsTree:aMe,estimateMemoryInBytes:tMe,getBVHExtremes:eMe,getJSONStructure:nMe,getTriangleHitPointInfo:wCe,shaderDistanceFunction:_Me,shaderIntersectFunction:SMe,shaderStructs:wMe,validateBounds:iMe},Symbol.toStringTag,{value:"Module"}));class MMe{constructor(e){this.name="WorkerBase",this.running=!1,this.worker=e,this.worker.onerror=i=>{throw i.message?new Error(`${this.name}: Could not create Web Worker with error "${i.message}"`):new Error(`${this.name}: Could not create Web Worker.`)}}runTask(){}generate(...e){if(this.running)throw new Error("GenerateMeshBVHWorker: Already running job.");if(this.worker===null)throw new Error("GenerateMeshBVHWorker: Worker has been disposed.");this.running=!0;const i=this.runTask(this.worker,...e);return i.finally(()=>{this.running=!1}),i}dispose(){this.worker.terminate(),this.worker=null}}const G6="KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiOy8qKgogKiBAbGljZW5zZQogKiBDb3B5cmlnaHQgMjAxMC0yMDIzIFRocmVlLmpzIEF1dGhvcnMKICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVAogKi9jb25zdCBXZT0iMTYyIixzcz0iIjtjbGFzcyBYZXthZGRFdmVudExpc3RlbmVyKHQsZSl7dGhpcy5fbGlzdGVuZXJzPT09dm9pZCAwJiYodGhpcy5fbGlzdGVuZXJzPXt9KTtjb25zdCBpPXRoaXMuX2xpc3RlbmVycztpW3RdPT09dm9pZCAwJiYoaVt0XT1bXSksaVt0XS5pbmRleE9mKGUpPT09LTEmJmlbdF0ucHVzaChlKX1oYXNFdmVudExpc3RlbmVyKHQsZSl7aWYodGhpcy5fbGlzdGVuZXJzPT09dm9pZCAwKXJldHVybiExO2NvbnN0IGk9dGhpcy5fbGlzdGVuZXJzO3JldHVybiBpW3RdIT09dm9pZCAwJiZpW3RdLmluZGV4T2YoZSkhPT0tMX1yZW1vdmVFdmVudExpc3RlbmVyKHQsZSl7aWYodGhpcy5fbGlzdGVuZXJzPT09dm9pZCAwKXJldHVybjtjb25zdCBzPXRoaXMuX2xpc3RlbmVyc1t0XTtpZihzIT09dm9pZCAwKXtjb25zdCBuPXMuaW5kZXhPZihlKTtuIT09LTEmJnMuc3BsaWNlKG4sMSl9fWRpc3BhdGNoRXZlbnQodCl7aWYodGhpcy5fbGlzdGVuZXJzPT09dm9pZCAwKXJldHVybjtjb25zdCBpPXRoaXMuX2xpc3RlbmVyc1t0LnR5cGVdO2lmKGkhPT12b2lkIDApe3QudGFyZ2V0PXRoaXM7Y29uc3Qgcz1pLnNsaWNlKDApO2ZvcihsZXQgbj0wLHI9cy5sZW5ndGg7bjxyO24rKylzW25dLmNhbGwodGhpcyx0KTt0LnRhcmdldD1udWxsfX19Y29uc3QgcT1bIjAwIiwiMDEiLCIwMiIsIjAzIiwiMDQiLCIwNSIsIjA2IiwiMDciLCIwOCIsIjA5IiwiMGEiLCIwYiIsIjBjIiwiMGQiLCIwZSIsIjBmIiwiMTAiLCIxMSIsIjEyIiwiMTMiLCIxNCIsIjE1IiwiMTYiLCIxNyIsIjE4IiwiMTkiLCIxYSIsIjFiIiwiMWMiLCIxZCIsIjFlIiwiMWYiLCIyMCIsIjIxIiwiMjIiLCIyMyIsIjI0IiwiMjUiLCIyNiIsIjI3IiwiMjgiLCIyOSIsIjJhIiwiMmIiLCIyYyIsIjJkIiwiMmUiLCIyZiIsIjMwIiwiMzEiLCIzMiIsIjMzIiwiMzQiLCIzNSIsIjM2IiwiMzciLCIzOCIsIjM5IiwiM2EiLCIzYiIsIjNjIiwiM2QiLCIzZSIsIjNmIiwiNDAiLCI0MSIsIjQyIiwiNDMiLCI0NCIsIjQ1IiwiNDYiLCI0NyIsIjQ4IiwiNDkiLCI0YSIsIjRiIiwiNGMiLCI0ZCIsIjRlIiwiNGYiLCI1MCIsIjUxIiwiNTIiLCI1MyIsIjU0IiwiNTUiLCI1NiIsIjU3IiwiNTgiLCI1OSIsIjVhIiwiNWIiLCI1YyIsIjVkIiwiNWUiLCI1ZiIsIjYwIiwiNjEiLCI2MiIsIjYzIiwiNjQiLCI2NSIsIjY2IiwiNjciLCI2OCIsIjY5IiwiNmEiLCI2YiIsIjZjIiwiNmQiLCI2ZSIsIjZmIiwiNzAiLCI3MSIsIjcyIiwiNzMiLCI3NCIsIjc1IiwiNzYiLCI3NyIsIjc4IiwiNzkiLCI3YSIsIjdiIiwiN2MiLCI3ZCIsIjdlIiwiN2YiLCI4MCIsIjgxIiwiODIiLCI4MyIsIjg0IiwiODUiLCI4NiIsIjg3IiwiODgiLCI4OSIsIjhhIiwiOGIiLCI4YyIsIjhkIiwiOGUiLCI4ZiIsIjkwIiwiOTEiLCI5MiIsIjkzIiwiOTQiLCI5NSIsIjk2IiwiOTciLCI5OCIsIjk5IiwiOWEiLCI5YiIsIjljIiwiOWQiLCI5ZSIsIjlmIiwiYTAiLCJhMSIsImEyIiwiYTMiLCJhNCIsImE1IiwiYTYiLCJhNyIsImE4IiwiYTkiLCJhYSIsImFiIiwiYWMiLCJhZCIsImFlIiwiYWYiLCJiMCIsImIxIiwiYjIiLCJiMyIsImI0IiwiYjUiLCJiNiIsImI3IiwiYjgiLCJiOSIsImJhIiwiYmIiLCJiYyIsImJkIiwiYmUiLCJiZiIsImMwIiwiYzEiLCJjMiIsImMzIiwiYzQiLCJjNSIsImM2IiwiYzciLCJjOCIsImM5IiwiY2EiLCJjYiIsImNjIiwiY2QiLCJjZSIsImNmIiwiZDAiLCJkMSIsImQyIiwiZDMiLCJkNCIsImQ1IiwiZDYiLCJkNyIsImQ4IiwiZDkiLCJkYSIsImRiIiwiZGMiLCJkZCIsImRlIiwiZGYiLCJlMCIsImUxIiwiZTIiLCJlMyIsImU0IiwiZTUiLCJlNiIsImU3IiwiZTgiLCJlOSIsImVhIiwiZWIiLCJlYyIsImVkIiwiZWUiLCJlZiIsImYwIiwiZjEiLCJmMiIsImYzIiwiZjQiLCJmNSIsImY2IiwiZjciLCJmOCIsImY5IiwiZmEiLCJmYiIsImZjIiwiZmQiLCJmZSIsImZmIl07ZnVuY3Rpb24gZmUoKXtjb25zdCB1PU1hdGgucmFuZG9tKCkqNDI5NDk2NzI5NXwwLHQ9TWF0aC5yYW5kb20oKSo0Mjk0OTY3Mjk1fDAsZT1NYXRoLnJhbmRvbSgpKjQyOTQ5NjcyOTV8MCxpPU1hdGgucmFuZG9tKCkqNDI5NDk2NzI5NXwwO3JldHVybihxW3UmMjU1XStxW3U+PjgmMjU1XStxW3U+PjE2JjI1NV0rcVt1Pj4yNCYyNTVdKyItIitxW3QmMjU1XStxW3Q+PjgmMjU1XSsiLSIrcVt0Pj4xNiYxNXw2NF0rcVt0Pj4yNCYyNTVdKyItIitxW2UmNjN8MTI4XStxW2U+PjgmMjU1XSsiLSIrcVtlPj4xNiYyNTVdK3FbZT4+MjQmMjU1XStxW2kmMjU1XStxW2k+PjgmMjU1XStxW2k+PjE2JjI1NV0rcVtpPj4yNCYyNTVdKS50b0xvd2VyQ2FzZSgpfWZ1bmN0aW9uIGF0KHUsdCxlKXtyZXR1cm4gTWF0aC5tYXgodCxNYXRoLm1pbihlLHUpKX1mdW5jdGlvbiBKdCh1LHQpe3N3aXRjaCh0LmNvbnN0cnVjdG9yKXtjYXNlIEZsb2F0MzJBcnJheTpyZXR1cm4gdTtjYXNlIFVpbnQzMkFycmF5OnJldHVybiB1LzQyOTQ5NjcyOTU7Y2FzZSBVaW50MTZBcnJheTpyZXR1cm4gdS82NTUzNTtjYXNlIFVpbnQ4QXJyYXk6cmV0dXJuIHUvMjU1O2Nhc2UgSW50MzJBcnJheTpyZXR1cm4gTWF0aC5tYXgodS8yMTQ3NDgzNjQ3LC0xKTtjYXNlIEludDE2QXJyYXk6cmV0dXJuIE1hdGgubWF4KHUvMzI3NjcsLTEpO2Nhc2UgSW50OEFycmF5OnJldHVybiBNYXRoLm1heCh1LzEyNywtMSk7ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgY29tcG9uZW50IHR5cGUuIil9fWZ1bmN0aW9uIE8odSx0KXtzd2l0Y2godC5jb25zdHJ1Y3Rvcil7Y2FzZSBGbG9hdDMyQXJyYXk6cmV0dXJuIHU7Y2FzZSBVaW50MzJBcnJheTpyZXR1cm4gTWF0aC5yb3VuZCh1KjQyOTQ5NjcyOTUpO2Nhc2UgVWludDE2QXJyYXk6cmV0dXJuIE1hdGgucm91bmQodSo2NTUzNSk7Y2FzZSBVaW50OEFycmF5OnJldHVybiBNYXRoLnJvdW5kKHUqMjU1KTtjYXNlIEludDMyQXJyYXk6cmV0dXJuIE1hdGgucm91bmQodSoyMTQ3NDgzNjQ3KTtjYXNlIEludDE2QXJyYXk6cmV0dXJuIE1hdGgucm91bmQodSozMjc2Nyk7Y2FzZSBJbnQ4QXJyYXk6cmV0dXJuIE1hdGgucm91bmQodSoxMjcpO2RlZmF1bHQ6dGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIGNvbXBvbmVudCB0eXBlLiIpfX1jbGFzcyB2e2NvbnN0cnVjdG9yKHQ9MCxlPTApe3YucHJvdG90eXBlLmlzVmVjdG9yMj0hMCx0aGlzLng9dCx0aGlzLnk9ZX1nZXQgd2lkdGgoKXtyZXR1cm4gdGhpcy54fXNldCB3aWR0aCh0KXt0aGlzLng9dH1nZXQgaGVpZ2h0KCl7cmV0dXJuIHRoaXMueX1zZXQgaGVpZ2h0KHQpe3RoaXMueT10fXNldCh0LGUpe3JldHVybiB0aGlzLng9dCx0aGlzLnk9ZSx0aGlzfXNldFNjYWxhcih0KXtyZXR1cm4gdGhpcy54PXQsdGhpcy55PXQsdGhpc31zZXRYKHQpe3JldHVybiB0aGlzLng9dCx0aGlzfXNldFkodCl7cmV0dXJuIHRoaXMueT10LHRoaXN9c2V0Q29tcG9uZW50KHQsZSl7c3dpdGNoKHQpe2Nhc2UgMDp0aGlzLng9ZTticmVhaztjYXNlIDE6dGhpcy55PWU7YnJlYWs7ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoImluZGV4IGlzIG91dCBvZiByYW5nZTogIit0KX1yZXR1cm4gdGhpc31nZXRDb21wb25lbnQodCl7c3dpdGNoKHQpe2Nhc2UgMDpyZXR1cm4gdGhpcy54O2Nhc2UgMTpyZXR1cm4gdGhpcy55O2RlZmF1bHQ6dGhyb3cgbmV3IEVycm9yKCJpbmRleCBpcyBvdXQgb2YgcmFuZ2U6ICIrdCl9fWNsb25lKCl7cmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKHRoaXMueCx0aGlzLnkpfWNvcHkodCl7cmV0dXJuIHRoaXMueD10LngsdGhpcy55PXQueSx0aGlzfWFkZCh0KXtyZXR1cm4gdGhpcy54Kz10LngsdGhpcy55Kz10LnksdGhpc31hZGRTY2FsYXIodCl7cmV0dXJuIHRoaXMueCs9dCx0aGlzLnkrPXQsdGhpc31hZGRWZWN0b3JzKHQsZSl7cmV0dXJuIHRoaXMueD10LngrZS54LHRoaXMueT10LnkrZS55LHRoaXN9YWRkU2NhbGVkVmVjdG9yKHQsZSl7cmV0dXJuIHRoaXMueCs9dC54KmUsdGhpcy55Kz10LnkqZSx0aGlzfXN1Yih0KXtyZXR1cm4gdGhpcy54LT10LngsdGhpcy55LT10LnksdGhpc31zdWJTY2FsYXIodCl7cmV0dXJuIHRoaXMueC09dCx0aGlzLnktPXQsdGhpc31zdWJWZWN0b3JzKHQsZSl7cmV0dXJuIHRoaXMueD10LngtZS54LHRoaXMueT10LnktZS55LHRoaXN9bXVsdGlwbHkodCl7cmV0dXJuIHRoaXMueCo9dC54LHRoaXMueSo9dC55LHRoaXN9bXVsdGlwbHlTY2FsYXIodCl7cmV0dXJuIHRoaXMueCo9dCx0aGlzLnkqPXQsdGhpc31kaXZpZGUodCl7cmV0dXJuIHRoaXMueC89dC54LHRoaXMueS89dC55LHRoaXN9ZGl2aWRlU2NhbGFyKHQpe3JldHVybiB0aGlzLm11bHRpcGx5U2NhbGFyKDEvdCl9YXBwbHlNYXRyaXgzKHQpe2NvbnN0IGU9dGhpcy54LGk9dGhpcy55LHM9dC5lbGVtZW50cztyZXR1cm4gdGhpcy54PXNbMF0qZStzWzNdKmkrc1s2XSx0aGlzLnk9c1sxXSplK3NbNF0qaStzWzddLHRoaXN9bWluKHQpe3JldHVybiB0aGlzLng9TWF0aC5taW4odGhpcy54LHQueCksdGhpcy55PU1hdGgubWluKHRoaXMueSx0LnkpLHRoaXN9bWF4KHQpe3JldHVybiB0aGlzLng9TWF0aC5tYXgodGhpcy54LHQueCksdGhpcy55PU1hdGgubWF4KHRoaXMueSx0LnkpLHRoaXN9Y2xhbXAodCxlKXtyZXR1cm4gdGhpcy54PU1hdGgubWF4KHQueCxNYXRoLm1pbihlLngsdGhpcy54KSksdGhpcy55PU1hdGgubWF4KHQueSxNYXRoLm1pbihlLnksdGhpcy55KSksdGhpc31jbGFtcFNjYWxhcih0LGUpe3JldHVybiB0aGlzLng9TWF0aC5tYXgodCxNYXRoLm1pbihlLHRoaXMueCkpLHRoaXMueT1NYXRoLm1heCh0LE1hdGgubWluKGUsdGhpcy55KSksdGhpc31jbGFtcExlbmd0aCh0LGUpe2NvbnN0IGk9dGhpcy5sZW5ndGgoKTtyZXR1cm4gdGhpcy5kaXZpZGVTY2FsYXIoaXx8MSkubXVsdGlwbHlTY2FsYXIoTWF0aC5tYXgodCxNYXRoLm1pbihlLGkpKSl9Zmxvb3IoKXtyZXR1cm4gdGhpcy54PU1hdGguZmxvb3IodGhpcy54KSx0aGlzLnk9TWF0aC5mbG9vcih0aGlzLnkpLHRoaXN9Y2VpbCgpe3JldHVybiB0aGlzLng9TWF0aC5jZWlsKHRoaXMueCksdGhpcy55PU1hdGguY2VpbCh0aGlzLnkpLHRoaXN9cm91bmQoKXtyZXR1cm4gdGhpcy54PU1hdGgucm91bmQodGhpcy54KSx0aGlzLnk9TWF0aC5yb3VuZCh0aGlzLnkpLHRoaXN9cm91bmRUb1plcm8oKXtyZXR1cm4gdGhpcy54PU1hdGgudHJ1bmModGhpcy54KSx0aGlzLnk9TWF0aC50cnVuYyh0aGlzLnkpLHRoaXN9bmVnYXRlKCl7cmV0dXJuIHRoaXMueD0tdGhpcy54LHRoaXMueT0tdGhpcy55LHRoaXN9ZG90KHQpe3JldHVybiB0aGlzLngqdC54K3RoaXMueSp0Lnl9Y3Jvc3ModCl7cmV0dXJuIHRoaXMueCp0LnktdGhpcy55KnQueH1sZW5ndGhTcSgpe3JldHVybiB0aGlzLngqdGhpcy54K3RoaXMueSp0aGlzLnl9bGVuZ3RoKCl7cmV0dXJuIE1hdGguc3FydCh0aGlzLngqdGhpcy54K3RoaXMueSp0aGlzLnkpfW1hbmhhdHRhbkxlbmd0aCgpe3JldHVybiBNYXRoLmFicyh0aGlzLngpK01hdGguYWJzKHRoaXMueSl9bm9ybWFsaXplKCl7cmV0dXJuIHRoaXMuZGl2aWRlU2NhbGFyKHRoaXMubGVuZ3RoKCl8fDEpfWFuZ2xlKCl7cmV0dXJuIE1hdGguYXRhbjIoLXRoaXMueSwtdGhpcy54KStNYXRoLlBJfWFuZ2xlVG8odCl7Y29uc3QgZT1NYXRoLnNxcnQodGhpcy5sZW5ndGhTcSgpKnQubGVuZ3RoU3EoKSk7aWYoZT09PTApcmV0dXJuIE1hdGguUEkvMjtjb25zdCBpPXRoaXMuZG90KHQpL2U7cmV0dXJuIE1hdGguYWNvcyhhdChpLC0xLDEpKX1kaXN0YW5jZVRvKHQpe3JldHVybiBNYXRoLnNxcnQodGhpcy5kaXN0YW5jZVRvU3F1YXJlZCh0KSl9ZGlzdGFuY2VUb1NxdWFyZWQodCl7Y29uc3QgZT10aGlzLngtdC54LGk9dGhpcy55LXQueTtyZXR1cm4gZSplK2kqaX1tYW5oYXR0YW5EaXN0YW5jZVRvKHQpe3JldHVybiBNYXRoLmFicyh0aGlzLngtdC54KStNYXRoLmFicyh0aGlzLnktdC55KX1zZXRMZW5ndGgodCl7cmV0dXJuIHRoaXMubm9ybWFsaXplKCkubXVsdGlwbHlTY2FsYXIodCl9bGVycCh0LGUpe3JldHVybiB0aGlzLngrPSh0LngtdGhpcy54KSplLHRoaXMueSs9KHQueS10aGlzLnkpKmUsdGhpc31sZXJwVmVjdG9ycyh0LGUsaSl7cmV0dXJuIHRoaXMueD10LngrKGUueC10LngpKmksdGhpcy55PXQueSsoZS55LXQueSkqaSx0aGlzfWVxdWFscyh0KXtyZXR1cm4gdC54PT09dGhpcy54JiZ0Lnk9PT10aGlzLnl9ZnJvbUFycmF5KHQsZT0wKXtyZXR1cm4gdGhpcy54PXRbZV0sdGhpcy55PXRbZSsxXSx0aGlzfXRvQXJyYXkodD1bXSxlPTApe3JldHVybiB0W2VdPXRoaXMueCx0W2UrMV09dGhpcy55LHR9ZnJvbUJ1ZmZlckF0dHJpYnV0ZSh0LGUpe3JldHVybiB0aGlzLng9dC5nZXRYKGUpLHRoaXMueT10LmdldFkoZSksdGhpc31yb3RhdGVBcm91bmQodCxlKXtjb25zdCBpPU1hdGguY29zKGUpLHM9TWF0aC5zaW4oZSksbj10aGlzLngtdC54LHI9dGhpcy55LXQueTtyZXR1cm4gdGhpcy54PW4qaS1yKnMrdC54LHRoaXMueT1uKnMrcippK3QueSx0aGlzfXJhbmRvbSgpe3JldHVybiB0aGlzLng9TWF0aC5yYW5kb20oKSx0aGlzLnk9TWF0aC5yYW5kb20oKSx0aGlzfSpbU3ltYm9sLml0ZXJhdG9yXSgpe3lpZWxkIHRoaXMueCx5aWVsZCB0aGlzLnl9fWNsYXNzIFR0e2NvbnN0cnVjdG9yKHQsZSxpLHMsbixyLGEsbyxoKXtUdC5wcm90b3R5cGUuaXNNYXRyaXgzPSEwLHRoaXMuZWxlbWVudHM9WzEsMCwwLDAsMSwwLDAsMCwxXSx0IT09dm9pZCAwJiZ0aGlzLnNldCh0LGUsaSxzLG4scixhLG8saCl9c2V0KHQsZSxpLHMsbixyLGEsbyxoKXtjb25zdCBjPXRoaXMuZWxlbWVudHM7cmV0dXJuIGNbMF09dCxjWzFdPXMsY1syXT1hLGNbM109ZSxjWzRdPW4sY1s1XT1vLGNbNl09aSxjWzddPXIsY1s4XT1oLHRoaXN9aWRlbnRpdHkoKXtyZXR1cm4gdGhpcy5zZXQoMSwwLDAsMCwxLDAsMCwwLDEpLHRoaXN9Y29weSh0KXtjb25zdCBlPXRoaXMuZWxlbWVudHMsaT10LmVsZW1lbnRzO3JldHVybiBlWzBdPWlbMF0sZVsxXT1pWzFdLGVbMl09aVsyXSxlWzNdPWlbM10sZVs0XT1pWzRdLGVbNV09aVs1XSxlWzZdPWlbNl0sZVs3XT1pWzddLGVbOF09aVs4XSx0aGlzfWV4dHJhY3RCYXNpcyh0LGUsaSl7cmV0dXJuIHQuc2V0RnJvbU1hdHJpeDNDb2x1bW4odGhpcywwKSxlLnNldEZyb21NYXRyaXgzQ29sdW1uKHRoaXMsMSksaS5zZXRGcm9tTWF0cml4M0NvbHVtbih0aGlzLDIpLHRoaXN9c2V0RnJvbU1hdHJpeDQodCl7Y29uc3QgZT10LmVsZW1lbnRzO3JldHVybiB0aGlzLnNldChlWzBdLGVbNF0sZVs4XSxlWzFdLGVbNV0sZVs5XSxlWzJdLGVbNl0sZVsxMF0pLHRoaXN9bXVsdGlwbHkodCl7cmV0dXJuIHRoaXMubXVsdGlwbHlNYXRyaWNlcyh0aGlzLHQpfXByZW11bHRpcGx5KHQpe3JldHVybiB0aGlzLm11bHRpcGx5TWF0cmljZXModCx0aGlzKX1tdWx0aXBseU1hdHJpY2VzKHQsZSl7Y29uc3QgaT10LmVsZW1lbnRzLHM9ZS5lbGVtZW50cyxuPXRoaXMuZWxlbWVudHMscj1pWzBdLGE9aVszXSxvPWlbNl0saD1pWzFdLGM9aVs0XSxmPWlbN10sbD1pWzJdLGQ9aVs1XSxwPWlbOF0seT1zWzBdLHg9c1szXSxtPXNbNl0sZz1zWzFdLHc9c1s0XSxNPXNbN10sYj1zWzJdLHo9c1s1XSxfPXNbOF07cmV0dXJuIG5bMF09cip5K2EqZytvKmIsblszXT1yKngrYSp3K28qeixuWzZdPXIqbSthKk0rbypfLG5bMV09aCp5K2MqZytmKmIsbls0XT1oKngrYyp3K2YqeixuWzddPWgqbStjKk0rZipfLG5bMl09bCp5K2QqZytwKmIsbls1XT1sKngrZCp3K3AqeixuWzhdPWwqbStkKk0rcCpfLHRoaXN9bXVsdGlwbHlTY2FsYXIodCl7Y29uc3QgZT10aGlzLmVsZW1lbnRzO3JldHVybiBlWzBdKj10LGVbM10qPXQsZVs2XSo9dCxlWzFdKj10LGVbNF0qPXQsZVs3XSo9dCxlWzJdKj10LGVbNV0qPXQsZVs4XSo9dCx0aGlzfWRldGVybWluYW50KCl7Y29uc3QgdD10aGlzLmVsZW1lbnRzLGU9dFswXSxpPXRbMV0scz10WzJdLG49dFszXSxyPXRbNF0sYT10WzVdLG89dFs2XSxoPXRbN10sYz10WzhdO3JldHVybiBlKnIqYy1lKmEqaC1pKm4qYytpKmEqbytzKm4qaC1zKnIqb31pbnZlcnQoKXtjb25zdCB0PXRoaXMuZWxlbWVudHMsZT10WzBdLGk9dFsxXSxzPXRbMl0sbj10WzNdLHI9dFs0XSxhPXRbNV0sbz10WzZdLGg9dFs3XSxjPXRbOF0sZj1jKnItYSpoLGw9YSpvLWMqbixkPWgqbi1yKm8scD1lKmYraSpsK3MqZDtpZihwPT09MClyZXR1cm4gdGhpcy5zZXQoMCwwLDAsMCwwLDAsMCwwLDApO2NvbnN0IHk9MS9wO3JldHVybiB0WzBdPWYqeSx0WzFdPShzKmgtYyppKSp5LHRbMl09KGEqaS1zKnIpKnksdFszXT1sKnksdFs0XT0oYyplLXMqbykqeSx0WzVdPShzKm4tYSplKSp5LHRbNl09ZCp5LHRbN109KGkqby1oKmUpKnksdFs4XT0ociplLWkqbikqeSx0aGlzfXRyYW5zcG9zZSgpe2xldCB0O2NvbnN0IGU9dGhpcy5lbGVtZW50cztyZXR1cm4gdD1lWzFdLGVbMV09ZVszXSxlWzNdPXQsdD1lWzJdLGVbMl09ZVs2XSxlWzZdPXQsdD1lWzVdLGVbNV09ZVs3XSxlWzddPXQsdGhpc31nZXROb3JtYWxNYXRyaXgodCl7cmV0dXJuIHRoaXMuc2V0RnJvbU1hdHJpeDQodCkuaW52ZXJ0KCkudHJhbnNwb3NlKCl9dHJhbnNwb3NlSW50b0FycmF5KHQpe2NvbnN0IGU9dGhpcy5lbGVtZW50cztyZXR1cm4gdFswXT1lWzBdLHRbMV09ZVszXSx0WzJdPWVbNl0sdFszXT1lWzFdLHRbNF09ZVs0XSx0WzVdPWVbN10sdFs2XT1lWzJdLHRbN109ZVs1XSx0WzhdPWVbOF0sdGhpc31zZXRVdlRyYW5zZm9ybSh0LGUsaSxzLG4scixhKXtjb25zdCBvPU1hdGguY29zKG4pLGg9TWF0aC5zaW4obik7cmV0dXJuIHRoaXMuc2V0KGkqbyxpKmgsLWkqKG8qcitoKmEpK3IrdCwtcypoLHMqbywtcyooLWgqcitvKmEpK2ErZSwwLDAsMSksdGhpc31zY2FsZSh0LGUpe3JldHVybiB0aGlzLnByZW11bHRpcGx5KE9lLm1ha2VTY2FsZSh0LGUpKSx0aGlzfXJvdGF0ZSh0KXtyZXR1cm4gdGhpcy5wcmVtdWx0aXBseShPZS5tYWtlUm90YXRpb24oLXQpKSx0aGlzfXRyYW5zbGF0ZSh0LGUpe3JldHVybiB0aGlzLnByZW11bHRpcGx5KE9lLm1ha2VUcmFuc2xhdGlvbih0LGUpKSx0aGlzfW1ha2VUcmFuc2xhdGlvbih0LGUpe3JldHVybiB0LmlzVmVjdG9yMj90aGlzLnNldCgxLDAsdC54LDAsMSx0LnksMCwwLDEpOnRoaXMuc2V0KDEsMCx0LDAsMSxlLDAsMCwxKSx0aGlzfW1ha2VSb3RhdGlvbih0KXtjb25zdCBlPU1hdGguY29zKHQpLGk9TWF0aC5zaW4odCk7cmV0dXJuIHRoaXMuc2V0KGUsLWksMCxpLGUsMCwwLDAsMSksdGhpc31tYWtlU2NhbGUodCxlKXtyZXR1cm4gdGhpcy5zZXQodCwwLDAsMCxlLDAsMCwwLDEpLHRoaXN9ZXF1YWxzKHQpe2NvbnN0IGU9dGhpcy5lbGVtZW50cyxpPXQuZWxlbWVudHM7Zm9yKGxldCBzPTA7czw5O3MrKylpZihlW3NdIT09aVtzXSlyZXR1cm4hMTtyZXR1cm4hMH1mcm9tQXJyYXkodCxlPTApe2ZvcihsZXQgaT0wO2k8OTtpKyspdGhpcy5lbGVtZW50c1tpXT10W2krZV07cmV0dXJuIHRoaXN9dG9BcnJheSh0PVtdLGU9MCl7Y29uc3QgaT10aGlzLmVsZW1lbnRzO3JldHVybiB0W2VdPWlbMF0sdFtlKzFdPWlbMV0sdFtlKzJdPWlbMl0sdFtlKzNdPWlbM10sdFtlKzRdPWlbNF0sdFtlKzVdPWlbNV0sdFtlKzZdPWlbNl0sdFtlKzddPWlbN10sdFtlKzhdPWlbOF0sdH1jbG9uZSgpe3JldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmZyb21BcnJheSh0aGlzLmVsZW1lbnRzKX19Y29uc3QgT2U9bmV3IFR0O2Z1bmN0aW9uIG5zKHUpe2ZvcihsZXQgdD11Lmxlbmd0aC0xO3Q+PTA7LS10KWlmKHVbdF0+PTY1NTM1KXJldHVybiEwO3JldHVybiExfWZ1bmN0aW9uIFRpKHUpe3JldHVybiBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiLHUpfWNvbnN0IFBpPXt9O2Z1bmN0aW9uIHJzKHUpe3UgaW4gUGl8fChQaVt1XT0hMCxjb25zb2xlLndhcm4odSkpfWZ1bmN0aW9uIFllKHUpe3JldHVybiB1PC4wNDA0NT91Ki4wNzczOTkzODA4Ok1hdGgucG93KHUqLjk0Nzg2NzI5ODYrLjA1MjEzMjcwMTQsMi40KX1sZXQgRXQ7Y2xhc3Mgb3N7c3RhdGljIGdldERhdGFVUkwodCl7aWYoL15kYXRhOi9pLnRlc3QodC5zcmMpfHx0eXBlb2YgSFRNTENhbnZhc0VsZW1lbnQ+InUiKXJldHVybiB0LnNyYztsZXQgZTtpZih0IGluc3RhbmNlb2YgSFRNTENhbnZhc0VsZW1lbnQpZT10O2Vsc2V7RXQ9PT12b2lkIDAmJihFdD1UaSgiY2FudmFzIikpLEV0LndpZHRoPXQud2lkdGgsRXQuaGVpZ2h0PXQuaGVpZ2h0O2NvbnN0IGk9RXQuZ2V0Q29udGV4dCgiMmQiKTt0IGluc3RhbmNlb2YgSW1hZ2VEYXRhP2kucHV0SW1hZ2VEYXRhKHQsMCwwKTppLmRyYXdJbWFnZSh0LDAsMCx0LndpZHRoLHQuaGVpZ2h0KSxlPUV0fXJldHVybiBlLndpZHRoPjIwNDh8fGUuaGVpZ2h0PjIwNDg/KGNvbnNvbGUud2FybigiVEhSRUUuSW1hZ2VVdGlscy5nZXREYXRhVVJMOiBJbWFnZSBjb252ZXJ0ZWQgdG8ganBnIGZvciBwZXJmb3JtYW5jZSByZWFzb25zIix0KSxlLnRvRGF0YVVSTCgiaW1hZ2UvanBlZyIsLjYpKTplLnRvRGF0YVVSTCgiaW1hZ2UvcG5nIil9c3RhdGljIHNSR0JUb0xpbmVhcih0KXtpZih0eXBlb2YgSFRNTEltYWdlRWxlbWVudDwidSImJnQgaW5zdGFuY2VvZiBIVE1MSW1hZ2VFbGVtZW50fHx0eXBlb2YgSFRNTENhbnZhc0VsZW1lbnQ8InUiJiZ0IGluc3RhbmNlb2YgSFRNTENhbnZhc0VsZW1lbnR8fHR5cGVvZiBJbWFnZUJpdG1hcDwidSImJnQgaW5zdGFuY2VvZiBJbWFnZUJpdG1hcCl7Y29uc3QgZT1UaSgiY2FudmFzIik7ZS53aWR0aD10LndpZHRoLGUuaGVpZ2h0PXQuaGVpZ2h0O2NvbnN0IGk9ZS5nZXRDb250ZXh0KCIyZCIpO2kuZHJhd0ltYWdlKHQsMCwwLHQud2lkdGgsdC5oZWlnaHQpO2NvbnN0IHM9aS5nZXRJbWFnZURhdGEoMCwwLHQud2lkdGgsdC5oZWlnaHQpLG49cy5kYXRhO2ZvcihsZXQgcj0wO3I8bi5sZW5ndGg7cisrKW5bcl09WWUobltyXS8yNTUpKjI1NTtyZXR1cm4gaS5wdXRJbWFnZURhdGEocywwLDApLGV9ZWxzZSBpZih0LmRhdGEpe2NvbnN0IGU9dC5kYXRhLnNsaWNlKDApO2ZvcihsZXQgaT0wO2k8ZS5sZW5ndGg7aSsrKWUgaW5zdGFuY2VvZiBVaW50OEFycmF5fHxlIGluc3RhbmNlb2YgVWludDhDbGFtcGVkQXJyYXk/ZVtpXT1NYXRoLmZsb29yKFllKGVbaV0vMjU1KSoyNTUpOmVbaV09WWUoZVtpXSk7cmV0dXJue2RhdGE6ZSx3aWR0aDp0LndpZHRoLGhlaWdodDp0LmhlaWdodH19ZWxzZSByZXR1cm4gY29uc29sZS53YXJuKCJUSFJFRS5JbWFnZVV0aWxzLnNSR0JUb0xpbmVhcigpOiBVbnN1cHBvcnRlZCBpbWFnZSB0eXBlLiBObyBjb2xvciBzcGFjZSBjb252ZXJzaW9uIGFwcGxpZWQuIiksdH19bGV0IGFzPTA7Y2xhc3MgY3N7Y29uc3RydWN0b3IodD1udWxsKXt0aGlzLmlzU291cmNlPSEwLE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCJpZCIse3ZhbHVlOmFzKyt9KSx0aGlzLnV1aWQ9ZmUoKSx0aGlzLmRhdGE9dCx0aGlzLmRhdGFSZWFkeT0hMCx0aGlzLnZlcnNpb249MH1zZXQgbmVlZHNVcGRhdGUodCl7dD09PSEwJiZ0aGlzLnZlcnNpb24rK310b0pTT04odCl7Y29uc3QgZT10PT09dm9pZCAwfHx0eXBlb2YgdD09InN0cmluZyI7aWYoIWUmJnQuaW1hZ2VzW3RoaXMudXVpZF0hPT12b2lkIDApcmV0dXJuIHQuaW1hZ2VzW3RoaXMudXVpZF07Y29uc3QgaT17dXVpZDp0aGlzLnV1aWQsdXJsOiIifSxzPXRoaXMuZGF0YTtpZihzIT09bnVsbCl7bGV0IG47aWYoQXJyYXkuaXNBcnJheShzKSl7bj1bXTtmb3IobGV0IHI9MCxhPXMubGVuZ3RoO3I8YTtyKyspc1tyXS5pc0RhdGFUZXh0dXJlP24ucHVzaChaZShzW3JdLmltYWdlKSk6bi5wdXNoKFplKHNbcl0pKX1lbHNlIG49WmUocyk7aS51cmw9bn1yZXR1cm4gZXx8KHQuaW1hZ2VzW3RoaXMudXVpZF09aSksaX19ZnVuY3Rpb24gWmUodSl7cmV0dXJuIHR5cGVvZiBIVE1MSW1hZ2VFbGVtZW50PCJ1IiYmdSBpbnN0YW5jZW9mIEhUTUxJbWFnZUVsZW1lbnR8fHR5cGVvZiBIVE1MQ2FudmFzRWxlbWVudDwidSImJnUgaW5zdGFuY2VvZiBIVE1MQ2FudmFzRWxlbWVudHx8dHlwZW9mIEltYWdlQml0bWFwPCJ1IiYmdSBpbnN0YW5jZW9mIEltYWdlQml0bWFwP29zLmdldERhdGFVUkwodSk6dS5kYXRhP3tkYXRhOkFycmF5LmZyb20odS5kYXRhKSx3aWR0aDp1LndpZHRoLGhlaWdodDp1LmhlaWdodCx0eXBlOnUuZGF0YS5jb25zdHJ1Y3Rvci5uYW1lfTooY29uc29sZS53YXJuKCJUSFJFRS5UZXh0dXJlOiBVbmFibGUgdG8gc2VyaWFsaXplIFRleHR1cmUuIikse30pfWxldCBocz0wO2NsYXNzIGd0IGV4dGVuZHMgWGV7Y29uc3RydWN0b3IodD1ndC5ERUZBVUxUX0lNQUdFLGU9Z3QuREVGQVVMVF9NQVBQSU5HLGk9MTAwMSxzPTEwMDEsbj0xMDA2LHI9MTAwOCxhPTEwMjMsbz0xMDA5LGg9Z3QuREVGQVVMVF9BTklTT1RST1BZLGM9c3Mpe3N1cGVyKCksdGhpcy5pc1RleHR1cmU9ITAsT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsImlkIix7dmFsdWU6aHMrK30pLHRoaXMudXVpZD1mZSgpLHRoaXMubmFtZT0iIix0aGlzLnNvdXJjZT1uZXcgY3ModCksdGhpcy5taXBtYXBzPVtdLHRoaXMubWFwcGluZz1lLHRoaXMuY2hhbm5lbD0wLHRoaXMud3JhcFM9aSx0aGlzLndyYXBUPXMsdGhpcy5tYWdGaWx0ZXI9bix0aGlzLm1pbkZpbHRlcj1yLHRoaXMuYW5pc290cm9weT1oLHRoaXMuZm9ybWF0PWEsdGhpcy5pbnRlcm5hbEZvcm1hdD1udWxsLHRoaXMudHlwZT1vLHRoaXMub2Zmc2V0PW5ldyB2KDAsMCksdGhpcy5yZXBlYXQ9bmV3IHYoMSwxKSx0aGlzLmNlbnRlcj1uZXcgdigwLDApLHRoaXMucm90YXRpb249MCx0aGlzLm1hdHJpeEF1dG9VcGRhdGU9ITAsdGhpcy5tYXRyaXg9bmV3IFR0LHRoaXMuZ2VuZXJhdGVNaXBtYXBzPSEwLHRoaXMucHJlbXVsdGlwbHlBbHBoYT0hMSx0aGlzLmZsaXBZPSEwLHRoaXMudW5wYWNrQWxpZ25tZW50PTQsdGhpcy5jb2xvclNwYWNlPWMsdGhpcy51c2VyRGF0YT17fSx0aGlzLnZlcnNpb249MCx0aGlzLm9uVXBkYXRlPW51bGwsdGhpcy5pc1JlbmRlclRhcmdldFRleHR1cmU9ITEsdGhpcy5uZWVkc1BNUkVNVXBkYXRlPSExfWdldCBpbWFnZSgpe3JldHVybiB0aGlzLnNvdXJjZS5kYXRhfXNldCBpbWFnZSh0PW51bGwpe3RoaXMuc291cmNlLmRhdGE9dH11cGRhdGVNYXRyaXgoKXt0aGlzLm1hdHJpeC5zZXRVdlRyYW5zZm9ybSh0aGlzLm9mZnNldC54LHRoaXMub2Zmc2V0LnksdGhpcy5yZXBlYXQueCx0aGlzLnJlcGVhdC55LHRoaXMucm90YXRpb24sdGhpcy5jZW50ZXIueCx0aGlzLmNlbnRlci55KX1jbG9uZSgpe3JldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmNvcHkodGhpcyl9Y29weSh0KXtyZXR1cm4gdGhpcy5uYW1lPXQubmFtZSx0aGlzLnNvdXJjZT10LnNvdXJjZSx0aGlzLm1pcG1hcHM9dC5taXBtYXBzLnNsaWNlKDApLHRoaXMubWFwcGluZz10Lm1hcHBpbmcsdGhpcy5jaGFubmVsPXQuY2hhbm5lbCx0aGlzLndyYXBTPXQud3JhcFMsdGhpcy53cmFwVD10LndyYXBULHRoaXMubWFnRmlsdGVyPXQubWFnRmlsdGVyLHRoaXMubWluRmlsdGVyPXQubWluRmlsdGVyLHRoaXMuYW5pc290cm9weT10LmFuaXNvdHJvcHksdGhpcy5mb3JtYXQ9dC5mb3JtYXQsdGhpcy5pbnRlcm5hbEZvcm1hdD10LmludGVybmFsRm9ybWF0LHRoaXMudHlwZT10LnR5cGUsdGhpcy5vZmZzZXQuY29weSh0Lm9mZnNldCksdGhpcy5yZXBlYXQuY29weSh0LnJlcGVhdCksdGhpcy5jZW50ZXIuY29weSh0LmNlbnRlciksdGhpcy5yb3RhdGlvbj10LnJvdGF0aW9uLHRoaXMubWF0cml4QXV0b1VwZGF0ZT10Lm1hdHJpeEF1dG9VcGRhdGUsdGhpcy5tYXRyaXguY29weSh0Lm1hdHJpeCksdGhpcy5nZW5lcmF0ZU1pcG1hcHM9dC5nZW5lcmF0ZU1pcG1hcHMsdGhpcy5wcmVtdWx0aXBseUFscGhhPXQucHJlbXVsdGlwbHlBbHBoYSx0aGlzLmZsaXBZPXQuZmxpcFksdGhpcy51bnBhY2tBbGlnbm1lbnQ9dC51bnBhY2tBbGlnbm1lbnQsdGhpcy5jb2xvclNwYWNlPXQuY29sb3JTcGFjZSx0aGlzLnVzZXJEYXRhPUpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodC51c2VyRGF0YSkpLHRoaXMubmVlZHNVcGRhdGU9ITAsdGhpc310b0pTT04odCl7Y29uc3QgZT10PT09dm9pZCAwfHx0eXBlb2YgdD09InN0cmluZyI7aWYoIWUmJnQudGV4dHVyZXNbdGhpcy51dWlkXSE9PXZvaWQgMClyZXR1cm4gdC50ZXh0dXJlc1t0aGlzLnV1aWRdO2NvbnN0IGk9e21ldGFkYXRhOnt2ZXJzaW9uOjQuNix0eXBlOiJUZXh0dXJlIixnZW5lcmF0b3I6IlRleHR1cmUudG9KU09OIn0sdXVpZDp0aGlzLnV1aWQsbmFtZTp0aGlzLm5hbWUsaW1hZ2U6dGhpcy5zb3VyY2UudG9KU09OKHQpLnV1aWQsbWFwcGluZzp0aGlzLm1hcHBpbmcsY2hhbm5lbDp0aGlzLmNoYW5uZWwscmVwZWF0Olt0aGlzLnJlcGVhdC54LHRoaXMucmVwZWF0LnldLG9mZnNldDpbdGhpcy5vZmZzZXQueCx0aGlzLm9mZnNldC55XSxjZW50ZXI6W3RoaXMuY2VudGVyLngsdGhpcy5jZW50ZXIueV0scm90YXRpb246dGhpcy5yb3RhdGlvbix3cmFwOlt0aGlzLndyYXBTLHRoaXMud3JhcFRdLGZvcm1hdDp0aGlzLmZvcm1hdCxpbnRlcm5hbEZvcm1hdDp0aGlzLmludGVybmFsRm9ybWF0LHR5cGU6dGhpcy50eXBlLGNvbG9yU3BhY2U6dGhpcy5jb2xvclNwYWNlLG1pbkZpbHRlcjp0aGlzLm1pbkZpbHRlcixtYWdGaWx0ZXI6dGhpcy5tYWdGaWx0ZXIsYW5pc290cm9weTp0aGlzLmFuaXNvdHJvcHksZmxpcFk6dGhpcy5mbGlwWSxnZW5lcmF0ZU1pcG1hcHM6dGhpcy5nZW5lcmF0ZU1pcG1hcHMscHJlbXVsdGlwbHlBbHBoYTp0aGlzLnByZW11bHRpcGx5QWxwaGEsdW5wYWNrQWxpZ25tZW50OnRoaXMudW5wYWNrQWxpZ25tZW50fTtyZXR1cm4gT2JqZWN0LmtleXModGhpcy51c2VyRGF0YSkubGVuZ3RoPjAmJihpLnVzZXJEYXRhPXRoaXMudXNlckRhdGEpLGV8fCh0LnRleHR1cmVzW3RoaXMudXVpZF09aSksaX1kaXNwb3NlKCl7dGhpcy5kaXNwYXRjaEV2ZW50KHt0eXBlOiJkaXNwb3NlIn0pfXRyYW5zZm9ybVV2KHQpe2lmKHRoaXMubWFwcGluZyE9PTMwMClyZXR1cm4gdDtpZih0LmFwcGx5TWF0cml4Myh0aGlzLm1hdHJpeCksdC54PDB8fHQueD4xKXN3aXRjaCh0aGlzLndyYXBTKXtjYXNlIDFlMzp0Lng9dC54LU1hdGguZmxvb3IodC54KTticmVhaztjYXNlIDEwMDE6dC54PXQueDwwPzA6MTticmVhaztjYXNlIDEwMDI6TWF0aC5hYnMoTWF0aC5mbG9vcih0LngpJTIpPT09MT90Lng9TWF0aC5jZWlsKHQueCktdC54OnQueD10LngtTWF0aC5mbG9vcih0LngpO2JyZWFrfWlmKHQueTwwfHx0Lnk+MSlzd2l0Y2godGhpcy53cmFwVCl7Y2FzZSAxZTM6dC55PXQueS1NYXRoLmZsb29yKHQueSk7YnJlYWs7Y2FzZSAxMDAxOnQueT10Lnk8MD8wOjE7YnJlYWs7Y2FzZSAxMDAyOk1hdGguYWJzKE1hdGguZmxvb3IodC55KSUyKT09PTE/dC55PU1hdGguY2VpbCh0LnkpLXQueTp0Lnk9dC55LU1hdGguZmxvb3IodC55KTticmVha31yZXR1cm4gdGhpcy5mbGlwWSYmKHQueT0xLXQueSksdH1zZXQgbmVlZHNVcGRhdGUodCl7dD09PSEwJiYodGhpcy52ZXJzaW9uKyssdGhpcy5zb3VyY2UubmVlZHNVcGRhdGU9ITApfX1ndC5ERUZBVUxUX0lNQUdFPW51bGwsZ3QuREVGQVVMVF9NQVBQSU5HPTMwMCxndC5ERUZBVUxUX0FOSVNPVFJPUFk9MTtjbGFzcyBRdHtjb25zdHJ1Y3Rvcih0PTAsZT0wLGk9MCxzPTEpe3RoaXMuaXNRdWF0ZXJuaW9uPSEwLHRoaXMuX3g9dCx0aGlzLl95PWUsdGhpcy5fej1pLHRoaXMuX3c9c31zdGF0aWMgc2xlcnBGbGF0KHQsZSxpLHMsbixyLGEpe2xldCBvPWlbcyswXSxoPWlbcysxXSxjPWlbcysyXSxmPWlbcyszXTtjb25zdCBsPW5bciswXSxkPW5bcisxXSxwPW5bcisyXSx5PW5bciszXTtpZihhPT09MCl7dFtlKzBdPW8sdFtlKzFdPWgsdFtlKzJdPWMsdFtlKzNdPWY7cmV0dXJufWlmKGE9PT0xKXt0W2UrMF09bCx0W2UrMV09ZCx0W2UrMl09cCx0W2UrM109eTtyZXR1cm59aWYoZiE9PXl8fG8hPT1sfHxoIT09ZHx8YyE9PXApe2xldCB4PTEtYTtjb25zdCBtPW8qbCtoKmQrYypwK2YqeSxnPW0+PTA/MTotMSx3PTEtbSptO2lmKHc+TnVtYmVyLkVQU0lMT04pe2NvbnN0IGI9TWF0aC5zcXJ0KHcpLHo9TWF0aC5hdGFuMihiLG0qZyk7eD1NYXRoLnNpbih4KnopL2IsYT1NYXRoLnNpbihhKnopL2J9Y29uc3QgTT1hKmc7aWYobz1vKngrbCpNLGg9aCp4K2QqTSxjPWMqeCtwKk0sZj1mKngreSpNLHg9PT0xLWEpe2NvbnN0IGI9MS9NYXRoLnNxcnQobypvK2gqaCtjKmMrZipmKTtvKj1iLGgqPWIsYyo9YixmKj1ifX10W2VdPW8sdFtlKzFdPWgsdFtlKzJdPWMsdFtlKzNdPWZ9c3RhdGljIG11bHRpcGx5UXVhdGVybmlvbnNGbGF0KHQsZSxpLHMsbixyKXtjb25zdCBhPWlbc10sbz1pW3MrMV0saD1pW3MrMl0sYz1pW3MrM10sZj1uW3JdLGw9bltyKzFdLGQ9bltyKzJdLHA9bltyKzNdO3JldHVybiB0W2VdPWEqcCtjKmYrbypkLWgqbCx0W2UrMV09bypwK2MqbCtoKmYtYSpkLHRbZSsyXT1oKnArYypkK2EqbC1vKmYsdFtlKzNdPWMqcC1hKmYtbypsLWgqZCx0fWdldCB4KCl7cmV0dXJuIHRoaXMuX3h9c2V0IHgodCl7dGhpcy5feD10LHRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKX1nZXQgeSgpe3JldHVybiB0aGlzLl95fXNldCB5KHQpe3RoaXMuX3k9dCx0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCl9Z2V0IHooKXtyZXR1cm4gdGhpcy5fen1zZXQgeih0KXt0aGlzLl96PXQsdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpfWdldCB3KCl7cmV0dXJuIHRoaXMuX3d9c2V0IHcodCl7dGhpcy5fdz10LHRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKX1zZXQodCxlLGkscyl7cmV0dXJuIHRoaXMuX3g9dCx0aGlzLl95PWUsdGhpcy5fej1pLHRoaXMuX3c9cyx0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCksdGhpc31jbG9uZSgpe3JldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3Rvcih0aGlzLl94LHRoaXMuX3ksdGhpcy5feix0aGlzLl93KX1jb3B5KHQpe3JldHVybiB0aGlzLl94PXQueCx0aGlzLl95PXQueSx0aGlzLl96PXQueix0aGlzLl93PXQudyx0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCksdGhpc31zZXRGcm9tRXVsZXIodCxlPSEwKXtjb25zdCBpPXQuX3gscz10Ll95LG49dC5feixyPXQuX29yZGVyLGE9TWF0aC5jb3Msbz1NYXRoLnNpbixoPWEoaS8yKSxjPWEocy8yKSxmPWEobi8yKSxsPW8oaS8yKSxkPW8ocy8yKSxwPW8obi8yKTtzd2l0Y2gocil7Y2FzZSJYWVoiOnRoaXMuX3g9bCpjKmYraCpkKnAsdGhpcy5feT1oKmQqZi1sKmMqcCx0aGlzLl96PWgqYypwK2wqZCpmLHRoaXMuX3c9aCpjKmYtbCpkKnA7YnJlYWs7Y2FzZSJZWFoiOnRoaXMuX3g9bCpjKmYraCpkKnAsdGhpcy5feT1oKmQqZi1sKmMqcCx0aGlzLl96PWgqYypwLWwqZCpmLHRoaXMuX3c9aCpjKmYrbCpkKnA7YnJlYWs7Y2FzZSJaWFkiOnRoaXMuX3g9bCpjKmYtaCpkKnAsdGhpcy5feT1oKmQqZitsKmMqcCx0aGlzLl96PWgqYypwK2wqZCpmLHRoaXMuX3c9aCpjKmYtbCpkKnA7YnJlYWs7Y2FzZSJaWVgiOnRoaXMuX3g9bCpjKmYtaCpkKnAsdGhpcy5feT1oKmQqZitsKmMqcCx0aGlzLl96PWgqYypwLWwqZCpmLHRoaXMuX3c9aCpjKmYrbCpkKnA7YnJlYWs7Y2FzZSJZWlgiOnRoaXMuX3g9bCpjKmYraCpkKnAsdGhpcy5feT1oKmQqZitsKmMqcCx0aGlzLl96PWgqYypwLWwqZCpmLHRoaXMuX3c9aCpjKmYtbCpkKnA7YnJlYWs7Y2FzZSJYWlkiOnRoaXMuX3g9bCpjKmYtaCpkKnAsdGhpcy5feT1oKmQqZi1sKmMqcCx0aGlzLl96PWgqYypwK2wqZCpmLHRoaXMuX3c9aCpjKmYrbCpkKnA7YnJlYWs7ZGVmYXVsdDpjb25zb2xlLndhcm4oIlRIUkVFLlF1YXRlcm5pb246IC5zZXRGcm9tRXVsZXIoKSBlbmNvdW50ZXJlZCBhbiB1bmtub3duIG9yZGVyOiAiK3IpfXJldHVybiBlPT09ITAmJnRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKSx0aGlzfXNldEZyb21BeGlzQW5nbGUodCxlKXtjb25zdCBpPWUvMixzPU1hdGguc2luKGkpO3JldHVybiB0aGlzLl94PXQueCpzLHRoaXMuX3k9dC55KnMsdGhpcy5fej10Lnoqcyx0aGlzLl93PU1hdGguY29zKGkpLHRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKSx0aGlzfXNldEZyb21Sb3RhdGlvbk1hdHJpeCh0KXtjb25zdCBlPXQuZWxlbWVudHMsaT1lWzBdLHM9ZVs0XSxuPWVbOF0scj1lWzFdLGE9ZVs1XSxvPWVbOV0saD1lWzJdLGM9ZVs2XSxmPWVbMTBdLGw9aSthK2Y7aWYobD4wKXtjb25zdCBkPS41L01hdGguc3FydChsKzEpO3RoaXMuX3c9LjI1L2QsdGhpcy5feD0oYy1vKSpkLHRoaXMuX3k9KG4taCkqZCx0aGlzLl96PShyLXMpKmR9ZWxzZSBpZihpPmEmJmk+Zil7Y29uc3QgZD0yKk1hdGguc3FydCgxK2ktYS1mKTt0aGlzLl93PShjLW8pL2QsdGhpcy5feD0uMjUqZCx0aGlzLl95PShzK3IpL2QsdGhpcy5fej0obitoKS9kfWVsc2UgaWYoYT5mKXtjb25zdCBkPTIqTWF0aC5zcXJ0KDErYS1pLWYpO3RoaXMuX3c9KG4taCkvZCx0aGlzLl94PShzK3IpL2QsdGhpcy5feT0uMjUqZCx0aGlzLl96PShvK2MpL2R9ZWxzZXtjb25zdCBkPTIqTWF0aC5zcXJ0KDErZi1pLWEpO3RoaXMuX3c9KHItcykvZCx0aGlzLl94PShuK2gpL2QsdGhpcy5feT0obytjKS9kLHRoaXMuX3o9LjI1KmR9cmV0dXJuIHRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKSx0aGlzfXNldEZyb21Vbml0VmVjdG9ycyh0LGUpe2xldCBpPXQuZG90KGUpKzE7cmV0dXJuIGk8TnVtYmVyLkVQU0lMT04/KGk9MCxNYXRoLmFicyh0LngpPk1hdGguYWJzKHQueik/KHRoaXMuX3g9LXQueSx0aGlzLl95PXQueCx0aGlzLl96PTAsdGhpcy5fdz1pKToodGhpcy5feD0wLHRoaXMuX3k9LXQueix0aGlzLl96PXQueSx0aGlzLl93PWkpKToodGhpcy5feD10LnkqZS56LXQueiplLnksdGhpcy5feT10LnoqZS54LXQueCplLnosdGhpcy5fej10LngqZS55LXQueSplLngsdGhpcy5fdz1pKSx0aGlzLm5vcm1hbGl6ZSgpfWFuZ2xlVG8odCl7cmV0dXJuIDIqTWF0aC5hY29zKE1hdGguYWJzKGF0KHRoaXMuZG90KHQpLC0xLDEpKSl9cm90YXRlVG93YXJkcyh0LGUpe2NvbnN0IGk9dGhpcy5hbmdsZVRvKHQpO2lmKGk9PT0wKXJldHVybiB0aGlzO2NvbnN0IHM9TWF0aC5taW4oMSxlL2kpO3JldHVybiB0aGlzLnNsZXJwKHQscyksdGhpc31pZGVudGl0eSgpe3JldHVybiB0aGlzLnNldCgwLDAsMCwxKX1pbnZlcnQoKXtyZXR1cm4gdGhpcy5jb25qdWdhdGUoKX1jb25qdWdhdGUoKXtyZXR1cm4gdGhpcy5feCo9LTEsdGhpcy5feSo9LTEsdGhpcy5feio9LTEsdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpLHRoaXN9ZG90KHQpe3JldHVybiB0aGlzLl94KnQuX3grdGhpcy5feSp0Ll95K3RoaXMuX3oqdC5feit0aGlzLl93KnQuX3d9bGVuZ3RoU3EoKXtyZXR1cm4gdGhpcy5feCp0aGlzLl94K3RoaXMuX3kqdGhpcy5feSt0aGlzLl96KnRoaXMuX3ordGhpcy5fdyp0aGlzLl93fWxlbmd0aCgpe3JldHVybiBNYXRoLnNxcnQodGhpcy5feCp0aGlzLl94K3RoaXMuX3kqdGhpcy5feSt0aGlzLl96KnRoaXMuX3ordGhpcy5fdyp0aGlzLl93KX1ub3JtYWxpemUoKXtsZXQgdD10aGlzLmxlbmd0aCgpO3JldHVybiB0PT09MD8odGhpcy5feD0wLHRoaXMuX3k9MCx0aGlzLl96PTAsdGhpcy5fdz0xKToodD0xL3QsdGhpcy5feD10aGlzLl94KnQsdGhpcy5feT10aGlzLl95KnQsdGhpcy5fej10aGlzLl96KnQsdGhpcy5fdz10aGlzLl93KnQpLHRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKSx0aGlzfW11bHRpcGx5KHQpe3JldHVybiB0aGlzLm11bHRpcGx5UXVhdGVybmlvbnModGhpcyx0KX1wcmVtdWx0aXBseSh0KXtyZXR1cm4gdGhpcy5tdWx0aXBseVF1YXRlcm5pb25zKHQsdGhpcyl9bXVsdGlwbHlRdWF0ZXJuaW9ucyh0LGUpe2NvbnN0IGk9dC5feCxzPXQuX3ksbj10Ll96LHI9dC5fdyxhPWUuX3gsbz1lLl95LGg9ZS5feixjPWUuX3c7cmV0dXJuIHRoaXMuX3g9aSpjK3IqYStzKmgtbipvLHRoaXMuX3k9cypjK3IqbytuKmEtaSpoLHRoaXMuX3o9bipjK3IqaCtpKm8tcyphLHRoaXMuX3c9cipjLWkqYS1zKm8tbipoLHRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKSx0aGlzfXNsZXJwKHQsZSl7aWYoZT09PTApcmV0dXJuIHRoaXM7aWYoZT09PTEpcmV0dXJuIHRoaXMuY29weSh0KTtjb25zdCBpPXRoaXMuX3gscz10aGlzLl95LG49dGhpcy5feixyPXRoaXMuX3c7bGV0IGE9cip0Ll93K2kqdC5feCtzKnQuX3krbip0Ll96O2lmKGE8MD8odGhpcy5fdz0tdC5fdyx0aGlzLl94PS10Ll94LHRoaXMuX3k9LXQuX3ksdGhpcy5fej0tdC5feixhPS1hKTp0aGlzLmNvcHkodCksYT49MSlyZXR1cm4gdGhpcy5fdz1yLHRoaXMuX3g9aSx0aGlzLl95PXMsdGhpcy5fej1uLHRoaXM7Y29uc3Qgbz0xLWEqYTtpZihvPD1OdW1iZXIuRVBTSUxPTil7Y29uc3QgZD0xLWU7cmV0dXJuIHRoaXMuX3c9ZCpyK2UqdGhpcy5fdyx0aGlzLl94PWQqaStlKnRoaXMuX3gsdGhpcy5feT1kKnMrZSp0aGlzLl95LHRoaXMuX3o9ZCpuK2UqdGhpcy5feix0aGlzLm5vcm1hbGl6ZSgpLHRoaXN9Y29uc3QgaD1NYXRoLnNxcnQobyksYz1NYXRoLmF0YW4yKGgsYSksZj1NYXRoLnNpbigoMS1lKSpjKS9oLGw9TWF0aC5zaW4oZSpjKS9oO3JldHVybiB0aGlzLl93PXIqZit0aGlzLl93KmwsdGhpcy5feD1pKmYrdGhpcy5feCpsLHRoaXMuX3k9cypmK3RoaXMuX3kqbCx0aGlzLl96PW4qZit0aGlzLl96KmwsdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpLHRoaXN9c2xlcnBRdWF0ZXJuaW9ucyh0LGUsaSl7cmV0dXJuIHRoaXMuY29weSh0KS5zbGVycChlLGkpfXJhbmRvbSgpe2NvbnN0IHQ9MipNYXRoLlBJKk1hdGgucmFuZG9tKCksZT0yKk1hdGguUEkqTWF0aC5yYW5kb20oKSxpPU1hdGgucmFuZG9tKCkscz1NYXRoLnNxcnQoMS1pKSxuPU1hdGguc3FydChpKTtyZXR1cm4gdGhpcy5zZXQocypNYXRoLnNpbih0KSxzKk1hdGguY29zKHQpLG4qTWF0aC5zaW4oZSksbipNYXRoLmNvcyhlKSl9ZXF1YWxzKHQpe3JldHVybiB0Ll94PT09dGhpcy5feCYmdC5feT09PXRoaXMuX3kmJnQuX3o9PT10aGlzLl96JiZ0Ll93PT09dGhpcy5fd31mcm9tQXJyYXkodCxlPTApe3JldHVybiB0aGlzLl94PXRbZV0sdGhpcy5feT10W2UrMV0sdGhpcy5fej10W2UrMl0sdGhpcy5fdz10W2UrM10sdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpLHRoaXN9dG9BcnJheSh0PVtdLGU9MCl7cmV0dXJuIHRbZV09dGhpcy5feCx0W2UrMV09dGhpcy5feSx0W2UrMl09dGhpcy5feix0W2UrM109dGhpcy5fdyx0fWZyb21CdWZmZXJBdHRyaWJ1dGUodCxlKXtyZXR1cm4gdGhpcy5feD10LmdldFgoZSksdGhpcy5feT10LmdldFkoZSksdGhpcy5fej10LmdldFooZSksdGhpcy5fdz10LmdldFcoZSksdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpLHRoaXN9dG9KU09OKCl7cmV0dXJuIHRoaXMudG9BcnJheSgpfV9vbkNoYW5nZSh0KXtyZXR1cm4gdGhpcy5fb25DaGFuZ2VDYWxsYmFjaz10LHRoaXN9X29uQ2hhbmdlQ2FsbGJhY2soKXt9KltTeW1ib2wuaXRlcmF0b3JdKCl7eWllbGQgdGhpcy5feCx5aWVsZCB0aGlzLl95LHlpZWxkIHRoaXMuX3oseWllbGQgdGhpcy5fd319Y2xhc3MgQXtjb25zdHJ1Y3Rvcih0PTAsZT0wLGk9MCl7QS5wcm90b3R5cGUuaXNWZWN0b3IzPSEwLHRoaXMueD10LHRoaXMueT1lLHRoaXMuej1pfXNldCh0LGUsaSl7cmV0dXJuIGk9PT12b2lkIDAmJihpPXRoaXMueiksdGhpcy54PXQsdGhpcy55PWUsdGhpcy56PWksdGhpc31zZXRTY2FsYXIodCl7cmV0dXJuIHRoaXMueD10LHRoaXMueT10LHRoaXMuej10LHRoaXN9c2V0WCh0KXtyZXR1cm4gdGhpcy54PXQsdGhpc31zZXRZKHQpe3JldHVybiB0aGlzLnk9dCx0aGlzfXNldFoodCl7cmV0dXJuIHRoaXMuej10LHRoaXN9c2V0Q29tcG9uZW50KHQsZSl7c3dpdGNoKHQpe2Nhc2UgMDp0aGlzLng9ZTticmVhaztjYXNlIDE6dGhpcy55PWU7YnJlYWs7Y2FzZSAyOnRoaXMuej1lO2JyZWFrO2RlZmF1bHQ6dGhyb3cgbmV3IEVycm9yKCJpbmRleCBpcyBvdXQgb2YgcmFuZ2U6ICIrdCl9cmV0dXJuIHRoaXN9Z2V0Q29tcG9uZW50KHQpe3N3aXRjaCh0KXtjYXNlIDA6cmV0dXJuIHRoaXMueDtjYXNlIDE6cmV0dXJuIHRoaXMueTtjYXNlIDI6cmV0dXJuIHRoaXMuejtkZWZhdWx0OnRocm93IG5ldyBFcnJvcigiaW5kZXggaXMgb3V0IG9mIHJhbmdlOiAiK3QpfX1jbG9uZSgpe3JldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3Rvcih0aGlzLngsdGhpcy55LHRoaXMueil9Y29weSh0KXtyZXR1cm4gdGhpcy54PXQueCx0aGlzLnk9dC55LHRoaXMuej10LnosdGhpc31hZGQodCl7cmV0dXJuIHRoaXMueCs9dC54LHRoaXMueSs9dC55LHRoaXMueis9dC56LHRoaXN9YWRkU2NhbGFyKHQpe3JldHVybiB0aGlzLngrPXQsdGhpcy55Kz10LHRoaXMueis9dCx0aGlzfWFkZFZlY3RvcnModCxlKXtyZXR1cm4gdGhpcy54PXQueCtlLngsdGhpcy55PXQueStlLnksdGhpcy56PXQueitlLnosdGhpc31hZGRTY2FsZWRWZWN0b3IodCxlKXtyZXR1cm4gdGhpcy54Kz10LngqZSx0aGlzLnkrPXQueSplLHRoaXMueis9dC56KmUsdGhpc31zdWIodCl7cmV0dXJuIHRoaXMueC09dC54LHRoaXMueS09dC55LHRoaXMuei09dC56LHRoaXN9c3ViU2NhbGFyKHQpe3JldHVybiB0aGlzLngtPXQsdGhpcy55LT10LHRoaXMuei09dCx0aGlzfXN1YlZlY3RvcnModCxlKXtyZXR1cm4gdGhpcy54PXQueC1lLngsdGhpcy55PXQueS1lLnksdGhpcy56PXQuei1lLnosdGhpc31tdWx0aXBseSh0KXtyZXR1cm4gdGhpcy54Kj10LngsdGhpcy55Kj10LnksdGhpcy56Kj10LnosdGhpc31tdWx0aXBseVNjYWxhcih0KXtyZXR1cm4gdGhpcy54Kj10LHRoaXMueSo9dCx0aGlzLnoqPXQsdGhpc31tdWx0aXBseVZlY3RvcnModCxlKXtyZXR1cm4gdGhpcy54PXQueCplLngsdGhpcy55PXQueSplLnksdGhpcy56PXQueiplLnosdGhpc31hcHBseUV1bGVyKHQpe3JldHVybiB0aGlzLmFwcGx5UXVhdGVybmlvbihDaS5zZXRGcm9tRXVsZXIodCkpfWFwcGx5QXhpc0FuZ2xlKHQsZSl7cmV0dXJuIHRoaXMuYXBwbHlRdWF0ZXJuaW9uKENpLnNldEZyb21BeGlzQW5nbGUodCxlKSl9YXBwbHlNYXRyaXgzKHQpe2NvbnN0IGU9dGhpcy54LGk9dGhpcy55LHM9dGhpcy56LG49dC5lbGVtZW50cztyZXR1cm4gdGhpcy54PW5bMF0qZStuWzNdKmkrbls2XSpzLHRoaXMueT1uWzFdKmUrbls0XSppK25bN10qcyx0aGlzLno9blsyXSplK25bNV0qaStuWzhdKnMsdGhpc31hcHBseU5vcm1hbE1hdHJpeCh0KXtyZXR1cm4gdGhpcy5hcHBseU1hdHJpeDModCkubm9ybWFsaXplKCl9YXBwbHlNYXRyaXg0KHQpe2NvbnN0IGU9dGhpcy54LGk9dGhpcy55LHM9dGhpcy56LG49dC5lbGVtZW50cyxyPTEvKG5bM10qZStuWzddKmkrblsxMV0qcytuWzE1XSk7cmV0dXJuIHRoaXMueD0oblswXSplK25bNF0qaStuWzhdKnMrblsxMl0pKnIsdGhpcy55PShuWzFdKmUrbls1XSppK25bOV0qcytuWzEzXSkqcix0aGlzLno9KG5bMl0qZStuWzZdKmkrblsxMF0qcytuWzE0XSkqcix0aGlzfWFwcGx5UXVhdGVybmlvbih0KXtjb25zdCBlPXRoaXMueCxpPXRoaXMueSxzPXRoaXMueixuPXQueCxyPXQueSxhPXQueixvPXQudyxoPTIqKHIqcy1hKmkpLGM9MiooYSplLW4qcyksZj0yKihuKmktciplKTtyZXR1cm4gdGhpcy54PWUrbypoK3IqZi1hKmMsdGhpcy55PWkrbypjK2EqaC1uKmYsdGhpcy56PXMrbypmK24qYy1yKmgsdGhpc31wcm9qZWN0KHQpe3JldHVybiB0aGlzLmFwcGx5TWF0cml4NCh0Lm1hdHJpeFdvcmxkSW52ZXJzZSkuYXBwbHlNYXRyaXg0KHQucHJvamVjdGlvbk1hdHJpeCl9dW5wcm9qZWN0KHQpe3JldHVybiB0aGlzLmFwcGx5TWF0cml4NCh0LnByb2plY3Rpb25NYXRyaXhJbnZlcnNlKS5hcHBseU1hdHJpeDQodC5tYXRyaXhXb3JsZCl9dHJhbnNmb3JtRGlyZWN0aW9uKHQpe2NvbnN0IGU9dGhpcy54LGk9dGhpcy55LHM9dGhpcy56LG49dC5lbGVtZW50cztyZXR1cm4gdGhpcy54PW5bMF0qZStuWzRdKmkrbls4XSpzLHRoaXMueT1uWzFdKmUrbls1XSppK25bOV0qcyx0aGlzLno9blsyXSplK25bNl0qaStuWzEwXSpzLHRoaXMubm9ybWFsaXplKCl9ZGl2aWRlKHQpe3JldHVybiB0aGlzLngvPXQueCx0aGlzLnkvPXQueSx0aGlzLnovPXQueix0aGlzfWRpdmlkZVNjYWxhcih0KXtyZXR1cm4gdGhpcy5tdWx0aXBseVNjYWxhcigxL3QpfW1pbih0KXtyZXR1cm4gdGhpcy54PU1hdGgubWluKHRoaXMueCx0LngpLHRoaXMueT1NYXRoLm1pbih0aGlzLnksdC55KSx0aGlzLno9TWF0aC5taW4odGhpcy56LHQueiksdGhpc31tYXgodCl7cmV0dXJuIHRoaXMueD1NYXRoLm1heCh0aGlzLngsdC54KSx0aGlzLnk9TWF0aC5tYXgodGhpcy55LHQueSksdGhpcy56PU1hdGgubWF4KHRoaXMueix0LnopLHRoaXN9Y2xhbXAodCxlKXtyZXR1cm4gdGhpcy54PU1hdGgubWF4KHQueCxNYXRoLm1pbihlLngsdGhpcy54KSksdGhpcy55PU1hdGgubWF4KHQueSxNYXRoLm1pbihlLnksdGhpcy55KSksdGhpcy56PU1hdGgubWF4KHQueixNYXRoLm1pbihlLnosdGhpcy56KSksdGhpc31jbGFtcFNjYWxhcih0LGUpe3JldHVybiB0aGlzLng9TWF0aC5tYXgodCxNYXRoLm1pbihlLHRoaXMueCkpLHRoaXMueT1NYXRoLm1heCh0LE1hdGgubWluKGUsdGhpcy55KSksdGhpcy56PU1hdGgubWF4KHQsTWF0aC5taW4oZSx0aGlzLnopKSx0aGlzfWNsYW1wTGVuZ3RoKHQsZSl7Y29uc3QgaT10aGlzLmxlbmd0aCgpO3JldHVybiB0aGlzLmRpdmlkZVNjYWxhcihpfHwxKS5tdWx0aXBseVNjYWxhcihNYXRoLm1heCh0LE1hdGgubWluKGUsaSkpKX1mbG9vcigpe3JldHVybiB0aGlzLng9TWF0aC5mbG9vcih0aGlzLngpLHRoaXMueT1NYXRoLmZsb29yKHRoaXMueSksdGhpcy56PU1hdGguZmxvb3IodGhpcy56KSx0aGlzfWNlaWwoKXtyZXR1cm4gdGhpcy54PU1hdGguY2VpbCh0aGlzLngpLHRoaXMueT1NYXRoLmNlaWwodGhpcy55KSx0aGlzLno9TWF0aC5jZWlsKHRoaXMueiksdGhpc31yb3VuZCgpe3JldHVybiB0aGlzLng9TWF0aC5yb3VuZCh0aGlzLngpLHRoaXMueT1NYXRoLnJvdW5kKHRoaXMueSksdGhpcy56PU1hdGgucm91bmQodGhpcy56KSx0aGlzfXJvdW5kVG9aZXJvKCl7cmV0dXJuIHRoaXMueD1NYXRoLnRydW5jKHRoaXMueCksdGhpcy55PU1hdGgudHJ1bmModGhpcy55KSx0aGlzLno9TWF0aC50cnVuYyh0aGlzLnopLHRoaXN9bmVnYXRlKCl7cmV0dXJuIHRoaXMueD0tdGhpcy54LHRoaXMueT0tdGhpcy55LHRoaXMuej0tdGhpcy56LHRoaXN9ZG90KHQpe3JldHVybiB0aGlzLngqdC54K3RoaXMueSp0LnkrdGhpcy56KnQuen1sZW5ndGhTcSgpe3JldHVybiB0aGlzLngqdGhpcy54K3RoaXMueSp0aGlzLnkrdGhpcy56KnRoaXMuen1sZW5ndGgoKXtyZXR1cm4gTWF0aC5zcXJ0KHRoaXMueCp0aGlzLngrdGhpcy55KnRoaXMueSt0aGlzLnoqdGhpcy56KX1tYW5oYXR0YW5MZW5ndGgoKXtyZXR1cm4gTWF0aC5hYnModGhpcy54KStNYXRoLmFicyh0aGlzLnkpK01hdGguYWJzKHRoaXMueil9bm9ybWFsaXplKCl7cmV0dXJuIHRoaXMuZGl2aWRlU2NhbGFyKHRoaXMubGVuZ3RoKCl8fDEpfXNldExlbmd0aCh0KXtyZXR1cm4gdGhpcy5ub3JtYWxpemUoKS5tdWx0aXBseVNjYWxhcih0KX1sZXJwKHQsZSl7cmV0dXJuIHRoaXMueCs9KHQueC10aGlzLngpKmUsdGhpcy55Kz0odC55LXRoaXMueSkqZSx0aGlzLnorPSh0LnotdGhpcy56KSplLHRoaXN9bGVycFZlY3RvcnModCxlLGkpe3JldHVybiB0aGlzLng9dC54KyhlLngtdC54KSppLHRoaXMueT10LnkrKGUueS10LnkpKmksdGhpcy56PXQueisoZS56LXQueikqaSx0aGlzfWNyb3NzKHQpe3JldHVybiB0aGlzLmNyb3NzVmVjdG9ycyh0aGlzLHQpfWNyb3NzVmVjdG9ycyh0LGUpe2NvbnN0IGk9dC54LHM9dC55LG49dC56LHI9ZS54LGE9ZS55LG89ZS56O3JldHVybiB0aGlzLng9cypvLW4qYSx0aGlzLnk9bipyLWkqbyx0aGlzLno9aSphLXMqcix0aGlzfXByb2plY3RPblZlY3Rvcih0KXtjb25zdCBlPXQubGVuZ3RoU3EoKTtpZihlPT09MClyZXR1cm4gdGhpcy5zZXQoMCwwLDApO2NvbnN0IGk9dC5kb3QodGhpcykvZTtyZXR1cm4gdGhpcy5jb3B5KHQpLm11bHRpcGx5U2NhbGFyKGkpfXByb2plY3RPblBsYW5lKHQpe3JldHVybiBIZS5jb3B5KHRoaXMpLnByb2plY3RPblZlY3Rvcih0KSx0aGlzLnN1YihIZSl9cmVmbGVjdCh0KXtyZXR1cm4gdGhpcy5zdWIoSGUuY29weSh0KS5tdWx0aXBseVNjYWxhcigyKnRoaXMuZG90KHQpKSl9YW5nbGVUbyh0KXtjb25zdCBlPU1hdGguc3FydCh0aGlzLmxlbmd0aFNxKCkqdC5sZW5ndGhTcSgpKTtpZihlPT09MClyZXR1cm4gTWF0aC5QSS8yO2NvbnN0IGk9dGhpcy5kb3QodCkvZTtyZXR1cm4gTWF0aC5hY29zKGF0KGksLTEsMSkpfWRpc3RhbmNlVG8odCl7cmV0dXJuIE1hdGguc3FydCh0aGlzLmRpc3RhbmNlVG9TcXVhcmVkKHQpKX1kaXN0YW5jZVRvU3F1YXJlZCh0KXtjb25zdCBlPXRoaXMueC10LngsaT10aGlzLnktdC55LHM9dGhpcy56LXQuejtyZXR1cm4gZSplK2kqaStzKnN9bWFuaGF0dGFuRGlzdGFuY2VUbyh0KXtyZXR1cm4gTWF0aC5hYnModGhpcy54LXQueCkrTWF0aC5hYnModGhpcy55LXQueSkrTWF0aC5hYnModGhpcy56LXQueil9c2V0RnJvbVNwaGVyaWNhbCh0KXtyZXR1cm4gdGhpcy5zZXRGcm9tU3BoZXJpY2FsQ29vcmRzKHQucmFkaXVzLHQucGhpLHQudGhldGEpfXNldEZyb21TcGhlcmljYWxDb29yZHModCxlLGkpe2NvbnN0IHM9TWF0aC5zaW4oZSkqdDtyZXR1cm4gdGhpcy54PXMqTWF0aC5zaW4oaSksdGhpcy55PU1hdGguY29zKGUpKnQsdGhpcy56PXMqTWF0aC5jb3MoaSksdGhpc31zZXRGcm9tQ3lsaW5kcmljYWwodCl7cmV0dXJuIHRoaXMuc2V0RnJvbUN5bGluZHJpY2FsQ29vcmRzKHQucmFkaXVzLHQudGhldGEsdC55KX1zZXRGcm9tQ3lsaW5kcmljYWxDb29yZHModCxlLGkpe3JldHVybiB0aGlzLng9dCpNYXRoLnNpbihlKSx0aGlzLnk9aSx0aGlzLno9dCpNYXRoLmNvcyhlKSx0aGlzfXNldEZyb21NYXRyaXhQb3NpdGlvbih0KXtjb25zdCBlPXQuZWxlbWVudHM7cmV0dXJuIHRoaXMueD1lWzEyXSx0aGlzLnk9ZVsxM10sdGhpcy56PWVbMTRdLHRoaXN9c2V0RnJvbU1hdHJpeFNjYWxlKHQpe2NvbnN0IGU9dGhpcy5zZXRGcm9tTWF0cml4Q29sdW1uKHQsMCkubGVuZ3RoKCksaT10aGlzLnNldEZyb21NYXRyaXhDb2x1bW4odCwxKS5sZW5ndGgoKSxzPXRoaXMuc2V0RnJvbU1hdHJpeENvbHVtbih0LDIpLmxlbmd0aCgpO3JldHVybiB0aGlzLng9ZSx0aGlzLnk9aSx0aGlzLno9cyx0aGlzfXNldEZyb21NYXRyaXhDb2x1bW4odCxlKXtyZXR1cm4gdGhpcy5mcm9tQXJyYXkodC5lbGVtZW50cyxlKjQpfXNldEZyb21NYXRyaXgzQ29sdW1uKHQsZSl7cmV0dXJuIHRoaXMuZnJvbUFycmF5KHQuZWxlbWVudHMsZSozKX1zZXRGcm9tRXVsZXIodCl7cmV0dXJuIHRoaXMueD10Ll94LHRoaXMueT10Ll95LHRoaXMuej10Ll96LHRoaXN9c2V0RnJvbUNvbG9yKHQpe3JldHVybiB0aGlzLng9dC5yLHRoaXMueT10LmcsdGhpcy56PXQuYix0aGlzfWVxdWFscyh0KXtyZXR1cm4gdC54PT09dGhpcy54JiZ0Lnk9PT10aGlzLnkmJnQuej09PXRoaXMuen1mcm9tQXJyYXkodCxlPTApe3JldHVybiB0aGlzLng9dFtlXSx0aGlzLnk9dFtlKzFdLHRoaXMuej10W2UrMl0sdGhpc310b0FycmF5KHQ9W10sZT0wKXtyZXR1cm4gdFtlXT10aGlzLngsdFtlKzFdPXRoaXMueSx0W2UrMl09dGhpcy56LHR9ZnJvbUJ1ZmZlckF0dHJpYnV0ZSh0LGUpe3JldHVybiB0aGlzLng9dC5nZXRYKGUpLHRoaXMueT10LmdldFkoZSksdGhpcy56PXQuZ2V0WihlKSx0aGlzfXJhbmRvbSgpe3JldHVybiB0aGlzLng9TWF0aC5yYW5kb20oKSx0aGlzLnk9TWF0aC5yYW5kb20oKSx0aGlzLno9TWF0aC5yYW5kb20oKSx0aGlzfXJhbmRvbURpcmVjdGlvbigpe2NvbnN0IHQ9TWF0aC5yYW5kb20oKSpNYXRoLlBJKjIsZT1NYXRoLnJhbmRvbSgpKjItMSxpPU1hdGguc3FydCgxLWUqZSk7cmV0dXJuIHRoaXMueD1pKk1hdGguY29zKHQpLHRoaXMueT1lLHRoaXMuej1pKk1hdGguc2luKHQpLHRoaXN9KltTeW1ib2wuaXRlcmF0b3JdKCl7eWllbGQgdGhpcy54LHlpZWxkIHRoaXMueSx5aWVsZCB0aGlzLnp9fWNvbnN0IEhlPW5ldyBBLENpPW5ldyBRdDtjbGFzcyBXe2NvbnN0cnVjdG9yKHQ9bmV3IEEoMS8wLDEvMCwxLzApLGU9bmV3IEEoLTEvMCwtMS8wLC0xLzApKXt0aGlzLmlzQm94Mz0hMCx0aGlzLm1pbj10LHRoaXMubWF4PWV9c2V0KHQsZSl7cmV0dXJuIHRoaXMubWluLmNvcHkodCksdGhpcy5tYXguY29weShlKSx0aGlzfXNldEZyb21BcnJheSh0KXt0aGlzLm1ha2VFbXB0eSgpO2ZvcihsZXQgZT0wLGk9dC5sZW5ndGg7ZTxpO2UrPTMpdGhpcy5leHBhbmRCeVBvaW50KGV0LmZyb21BcnJheSh0LGUpKTtyZXR1cm4gdGhpc31zZXRGcm9tQnVmZmVyQXR0cmlidXRlKHQpe3RoaXMubWFrZUVtcHR5KCk7Zm9yKGxldCBlPTAsaT10LmNvdW50O2U8aTtlKyspdGhpcy5leHBhbmRCeVBvaW50KGV0LmZyb21CdWZmZXJBdHRyaWJ1dGUodCxlKSk7cmV0dXJuIHRoaXN9c2V0RnJvbVBvaW50cyh0KXt0aGlzLm1ha2VFbXB0eSgpO2ZvcihsZXQgZT0wLGk9dC5sZW5ndGg7ZTxpO2UrKyl0aGlzLmV4cGFuZEJ5UG9pbnQodFtlXSk7cmV0dXJuIHRoaXN9c2V0RnJvbUNlbnRlckFuZFNpemUodCxlKXtjb25zdCBpPWV0LmNvcHkoZSkubXVsdGlwbHlTY2FsYXIoLjUpO3JldHVybiB0aGlzLm1pbi5jb3B5KHQpLnN1YihpKSx0aGlzLm1heC5jb3B5KHQpLmFkZChpKSx0aGlzfXNldEZyb21PYmplY3QodCxlPSExKXtyZXR1cm4gdGhpcy5tYWtlRW1wdHkoKSx0aGlzLmV4cGFuZEJ5T2JqZWN0KHQsZSl9Y2xvbmUoKXtyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KHRoaXMpfWNvcHkodCl7cmV0dXJuIHRoaXMubWluLmNvcHkodC5taW4pLHRoaXMubWF4LmNvcHkodC5tYXgpLHRoaXN9bWFrZUVtcHR5KCl7cmV0dXJuIHRoaXMubWluLng9dGhpcy5taW4ueT10aGlzLm1pbi56PTEvMCx0aGlzLm1heC54PXRoaXMubWF4Lnk9dGhpcy5tYXguej0tMS8wLHRoaXN9aXNFbXB0eSgpe3JldHVybiB0aGlzLm1heC54PHRoaXMubWluLnh8fHRoaXMubWF4Lnk8dGhpcy5taW4ueXx8dGhpcy5tYXguejx0aGlzLm1pbi56fWdldENlbnRlcih0KXtyZXR1cm4gdGhpcy5pc0VtcHR5KCk/dC5zZXQoMCwwLDApOnQuYWRkVmVjdG9ycyh0aGlzLm1pbix0aGlzLm1heCkubXVsdGlwbHlTY2FsYXIoLjUpfWdldFNpemUodCl7cmV0dXJuIHRoaXMuaXNFbXB0eSgpP3Quc2V0KDAsMCwwKTp0LnN1YlZlY3RvcnModGhpcy5tYXgsdGhpcy5taW4pfWV4cGFuZEJ5UG9pbnQodCl7cmV0dXJuIHRoaXMubWluLm1pbih0KSx0aGlzLm1heC5tYXgodCksdGhpc31leHBhbmRCeVZlY3Rvcih0KXtyZXR1cm4gdGhpcy5taW4uc3ViKHQpLHRoaXMubWF4LmFkZCh0KSx0aGlzfWV4cGFuZEJ5U2NhbGFyKHQpe3JldHVybiB0aGlzLm1pbi5hZGRTY2FsYXIoLXQpLHRoaXMubWF4LmFkZFNjYWxhcih0KSx0aGlzfWV4cGFuZEJ5T2JqZWN0KHQsZT0hMSl7dC51cGRhdGVXb3JsZE1hdHJpeCghMSwhMSk7Y29uc3QgaT10Lmdlb21ldHJ5O2lmKGkhPT12b2lkIDApe2NvbnN0IG49aS5nZXRBdHRyaWJ1dGUoInBvc2l0aW9uIik7aWYoZT09PSEwJiZuIT09dm9pZCAwJiZ0LmlzSW5zdGFuY2VkTWVzaCE9PSEwKWZvcihsZXQgcj0wLGE9bi5jb3VudDtyPGE7cisrKXQuaXNNZXNoPT09ITA/dC5nZXRWZXJ0ZXhQb3NpdGlvbihyLGV0KTpldC5mcm9tQnVmZmVyQXR0cmlidXRlKG4sciksZXQuYXBwbHlNYXRyaXg0KHQubWF0cml4V29ybGQpLHRoaXMuZXhwYW5kQnlQb2ludChldCk7ZWxzZSB0LmJvdW5kaW5nQm94IT09dm9pZCAwPyh0LmJvdW5kaW5nQm94PT09bnVsbCYmdC5jb21wdXRlQm91bmRpbmdCb3goKSxkZS5jb3B5KHQuYm91bmRpbmdCb3gpKTooaS5ib3VuZGluZ0JveD09PW51bGwmJmkuY29tcHV0ZUJvdW5kaW5nQm94KCksZGUuY29weShpLmJvdW5kaW5nQm94KSksZGUuYXBwbHlNYXRyaXg0KHQubWF0cml4V29ybGQpLHRoaXMudW5pb24oZGUpfWNvbnN0IHM9dC5jaGlsZHJlbjtmb3IobGV0IG49MCxyPXMubGVuZ3RoO248cjtuKyspdGhpcy5leHBhbmRCeU9iamVjdChzW25dLGUpO3JldHVybiB0aGlzfWNvbnRhaW5zUG9pbnQodCl7cmV0dXJuISh0Lng8dGhpcy5taW4ueHx8dC54PnRoaXMubWF4Lnh8fHQueTx0aGlzLm1pbi55fHx0Lnk+dGhpcy5tYXgueXx8dC56PHRoaXMubWluLnp8fHQuej50aGlzLm1heC56KX1jb250YWluc0JveCh0KXtyZXR1cm4gdGhpcy5taW4ueDw9dC5taW4ueCYmdC5tYXgueDw9dGhpcy5tYXgueCYmdGhpcy5taW4ueTw9dC5taW4ueSYmdC5tYXgueTw9dGhpcy5tYXgueSYmdGhpcy5taW4uejw9dC5taW4ueiYmdC5tYXguejw9dGhpcy5tYXguen1nZXRQYXJhbWV0ZXIodCxlKXtyZXR1cm4gZS5zZXQoKHQueC10aGlzLm1pbi54KS8odGhpcy5tYXgueC10aGlzLm1pbi54KSwodC55LXRoaXMubWluLnkpLyh0aGlzLm1heC55LXRoaXMubWluLnkpLCh0LnotdGhpcy5taW4ueikvKHRoaXMubWF4LnotdGhpcy5taW4ueikpfWludGVyc2VjdHNCb3godCl7cmV0dXJuISh0Lm1heC54PHRoaXMubWluLnh8fHQubWluLng+dGhpcy5tYXgueHx8dC5tYXgueTx0aGlzLm1pbi55fHx0Lm1pbi55PnRoaXMubWF4Lnl8fHQubWF4Lno8dGhpcy5taW4uenx8dC5taW4uej50aGlzLm1heC56KX1pbnRlcnNlY3RzU3BoZXJlKHQpe3JldHVybiB0aGlzLmNsYW1wUG9pbnQodC5jZW50ZXIsZXQpLGV0LmRpc3RhbmNlVG9TcXVhcmVkKHQuY2VudGVyKTw9dC5yYWRpdXMqdC5yYWRpdXN9aW50ZXJzZWN0c1BsYW5lKHQpe2xldCBlLGk7cmV0dXJuIHQubm9ybWFsLng+MD8oZT10Lm5vcm1hbC54KnRoaXMubWluLngsaT10Lm5vcm1hbC54KnRoaXMubWF4LngpOihlPXQubm9ybWFsLngqdGhpcy5tYXgueCxpPXQubm9ybWFsLngqdGhpcy5taW4ueCksdC5ub3JtYWwueT4wPyhlKz10Lm5vcm1hbC55KnRoaXMubWluLnksaSs9dC5ub3JtYWwueSp0aGlzLm1heC55KTooZSs9dC5ub3JtYWwueSp0aGlzLm1heC55LGkrPXQubm9ybWFsLnkqdGhpcy5taW4ueSksdC5ub3JtYWwuej4wPyhlKz10Lm5vcm1hbC56KnRoaXMubWluLnosaSs9dC5ub3JtYWwueip0aGlzLm1heC56KTooZSs9dC5ub3JtYWwueip0aGlzLm1heC56LGkrPXQubm9ybWFsLnoqdGhpcy5taW4ueiksZTw9LXQuY29uc3RhbnQmJmk+PS10LmNvbnN0YW50fWludGVyc2VjdHNUcmlhbmdsZSh0KXtpZih0aGlzLmlzRW1wdHkoKSlyZXR1cm4hMTt0aGlzLmdldENlbnRlcihLdCkscGUuc3ViVmVjdG9ycyh0aGlzLm1heCxLdCksRnQuc3ViVmVjdG9ycyh0LmEsS3QpLFV0LnN1YlZlY3RvcnModC5iLEt0KSxSdC5zdWJWZWN0b3JzKHQuYyxLdCksYnQuc3ViVmVjdG9ycyhVdCxGdCksd3Quc3ViVmVjdG9ycyhSdCxVdCksUHQuc3ViVmVjdG9ycyhGdCxSdCk7bGV0IGU9WzAsLWJ0LnosYnQueSwwLC13dC56LHd0LnksMCwtUHQueixQdC55LGJ0LnosMCwtYnQueCx3dC56LDAsLXd0LngsUHQueiwwLC1QdC54LC1idC55LGJ0LngsMCwtd3QueSx3dC54LDAsLVB0LnksUHQueCwwXTtyZXR1cm4hJGUoZSxGdCxVdCxSdCxwZSl8fChlPVsxLDAsMCwwLDEsMCwwLDAsMV0sISRlKGUsRnQsVXQsUnQscGUpKT8hMToobWUuY3Jvc3NWZWN0b3JzKGJ0LHd0KSxlPVttZS54LG1lLnksbWUuel0sJGUoZSxGdCxVdCxSdCxwZSkpfWNsYW1wUG9pbnQodCxlKXtyZXR1cm4gZS5jb3B5KHQpLmNsYW1wKHRoaXMubWluLHRoaXMubWF4KX1kaXN0YW5jZVRvUG9pbnQodCl7cmV0dXJuIHRoaXMuY2xhbXBQb2ludCh0LGV0KS5kaXN0YW5jZVRvKHQpfWdldEJvdW5kaW5nU3BoZXJlKHQpe3JldHVybiB0aGlzLmlzRW1wdHkoKT90Lm1ha2VFbXB0eSgpOih0aGlzLmdldENlbnRlcih0LmNlbnRlciksdC5yYWRpdXM9dGhpcy5nZXRTaXplKGV0KS5sZW5ndGgoKSouNSksdH1pbnRlcnNlY3QodCl7cmV0dXJuIHRoaXMubWluLm1heCh0Lm1pbiksdGhpcy5tYXgubWluKHQubWF4KSx0aGlzLmlzRW1wdHkoKSYmdGhpcy5tYWtlRW1wdHkoKSx0aGlzfXVuaW9uKHQpe3JldHVybiB0aGlzLm1pbi5taW4odC5taW4pLHRoaXMubWF4Lm1heCh0Lm1heCksdGhpc31hcHBseU1hdHJpeDQodCl7cmV0dXJuIHRoaXMuaXNFbXB0eSgpP3RoaXM6KHV0WzBdLnNldCh0aGlzLm1pbi54LHRoaXMubWluLnksdGhpcy5taW4ueikuYXBwbHlNYXRyaXg0KHQpLHV0WzFdLnNldCh0aGlzLm1pbi54LHRoaXMubWluLnksdGhpcy5tYXgueikuYXBwbHlNYXRyaXg0KHQpLHV0WzJdLnNldCh0aGlzLm1pbi54LHRoaXMubWF4LnksdGhpcy5taW4ueikuYXBwbHlNYXRyaXg0KHQpLHV0WzNdLnNldCh0aGlzLm1pbi54LHRoaXMubWF4LnksdGhpcy5tYXgueikuYXBwbHlNYXRyaXg0KHQpLHV0WzRdLnNldCh0aGlzLm1heC54LHRoaXMubWluLnksdGhpcy5taW4ueikuYXBwbHlNYXRyaXg0KHQpLHV0WzVdLnNldCh0aGlzLm1heC54LHRoaXMubWluLnksdGhpcy5tYXgueikuYXBwbHlNYXRyaXg0KHQpLHV0WzZdLnNldCh0aGlzLm1heC54LHRoaXMubWF4LnksdGhpcy5taW4ueikuYXBwbHlNYXRyaXg0KHQpLHV0WzddLnNldCh0aGlzLm1heC54LHRoaXMubWF4LnksdGhpcy5tYXgueikuYXBwbHlNYXRyaXg0KHQpLHRoaXMuc2V0RnJvbVBvaW50cyh1dCksdGhpcyl9dHJhbnNsYXRlKHQpe3JldHVybiB0aGlzLm1pbi5hZGQodCksdGhpcy5tYXguYWRkKHQpLHRoaXN9ZXF1YWxzKHQpe3JldHVybiB0Lm1pbi5lcXVhbHModGhpcy5taW4pJiZ0Lm1heC5lcXVhbHModGhpcy5tYXgpfX1jb25zdCB1dD1bbmV3IEEsbmV3IEEsbmV3IEEsbmV3IEEsbmV3IEEsbmV3IEEsbmV3IEEsbmV3IEFdLGV0PW5ldyBBLGRlPW5ldyBXLEZ0PW5ldyBBLFV0PW5ldyBBLFJ0PW5ldyBBLGJ0PW5ldyBBLHd0PW5ldyBBLFB0PW5ldyBBLEt0PW5ldyBBLHBlPW5ldyBBLG1lPW5ldyBBLEN0PW5ldyBBO2Z1bmN0aW9uICRlKHUsdCxlLGkscyl7Zm9yKGxldCBuPTAscj11Lmxlbmd0aC0zO248PXI7bis9Myl7Q3QuZnJvbUFycmF5KHUsbik7Y29uc3QgYT1zLngqTWF0aC5hYnMoQ3QueCkrcy55Kk1hdGguYWJzKEN0LnkpK3MueipNYXRoLmFicyhDdC56KSxvPXQuZG90KEN0KSxoPWUuZG90KEN0KSxjPWkuZG90KEN0KTtpZihNYXRoLm1heCgtTWF0aC5tYXgobyxoLGMpLE1hdGgubWluKG8saCxjKSk+YSlyZXR1cm4hMX1yZXR1cm4hMH1jb25zdCBscz1uZXcgVyx0ZT1uZXcgQSxqZT1uZXcgQTtjbGFzcyBFaXtjb25zdHJ1Y3Rvcih0PW5ldyBBLGU9LTEpe3RoaXMuaXNTcGhlcmU9ITAsdGhpcy5jZW50ZXI9dCx0aGlzLnJhZGl1cz1lfXNldCh0LGUpe3JldHVybiB0aGlzLmNlbnRlci5jb3B5KHQpLHRoaXMucmFkaXVzPWUsdGhpc31zZXRGcm9tUG9pbnRzKHQsZSl7Y29uc3QgaT10aGlzLmNlbnRlcjtlIT09dm9pZCAwP2kuY29weShlKTpscy5zZXRGcm9tUG9pbnRzKHQpLmdldENlbnRlcihpKTtsZXQgcz0wO2ZvcihsZXQgbj0wLHI9dC5sZW5ndGg7bjxyO24rKylzPU1hdGgubWF4KHMsaS5kaXN0YW5jZVRvU3F1YXJlZCh0W25dKSk7cmV0dXJuIHRoaXMucmFkaXVzPU1hdGguc3FydChzKSx0aGlzfWNvcHkodCl7cmV0dXJuIHRoaXMuY2VudGVyLmNvcHkodC5jZW50ZXIpLHRoaXMucmFkaXVzPXQucmFkaXVzLHRoaXN9aXNFbXB0eSgpe3JldHVybiB0aGlzLnJhZGl1czwwfW1ha2VFbXB0eSgpe3JldHVybiB0aGlzLmNlbnRlci5zZXQoMCwwLDApLHRoaXMucmFkaXVzPS0xLHRoaXN9Y29udGFpbnNQb2ludCh0KXtyZXR1cm4gdC5kaXN0YW5jZVRvU3F1YXJlZCh0aGlzLmNlbnRlcik8PXRoaXMucmFkaXVzKnRoaXMucmFkaXVzfWRpc3RhbmNlVG9Qb2ludCh0KXtyZXR1cm4gdC5kaXN0YW5jZVRvKHRoaXMuY2VudGVyKS10aGlzLnJhZGl1c31pbnRlcnNlY3RzU3BoZXJlKHQpe2NvbnN0IGU9dGhpcy5yYWRpdXMrdC5yYWRpdXM7cmV0dXJuIHQuY2VudGVyLmRpc3RhbmNlVG9TcXVhcmVkKHRoaXMuY2VudGVyKTw9ZSplfWludGVyc2VjdHNCb3godCl7cmV0dXJuIHQuaW50ZXJzZWN0c1NwaGVyZSh0aGlzKX1pbnRlcnNlY3RzUGxhbmUodCl7cmV0dXJuIE1hdGguYWJzKHQuZGlzdGFuY2VUb1BvaW50KHRoaXMuY2VudGVyKSk8PXRoaXMucmFkaXVzfWNsYW1wUG9pbnQodCxlKXtjb25zdCBpPXRoaXMuY2VudGVyLmRpc3RhbmNlVG9TcXVhcmVkKHQpO3JldHVybiBlLmNvcHkodCksaT50aGlzLnJhZGl1cyp0aGlzLnJhZGl1cyYmKGUuc3ViKHRoaXMuY2VudGVyKS5ub3JtYWxpemUoKSxlLm11bHRpcGx5U2NhbGFyKHRoaXMucmFkaXVzKS5hZGQodGhpcy5jZW50ZXIpKSxlfWdldEJvdW5kaW5nQm94KHQpe3JldHVybiB0aGlzLmlzRW1wdHkoKT8odC5tYWtlRW1wdHkoKSx0KToodC5zZXQodGhpcy5jZW50ZXIsdGhpcy5jZW50ZXIpLHQuZXhwYW5kQnlTY2FsYXIodGhpcy5yYWRpdXMpLHQpfWFwcGx5TWF0cml4NCh0KXtyZXR1cm4gdGhpcy5jZW50ZXIuYXBwbHlNYXRyaXg0KHQpLHRoaXMucmFkaXVzPXRoaXMucmFkaXVzKnQuZ2V0TWF4U2NhbGVPbkF4aXMoKSx0aGlzfXRyYW5zbGF0ZSh0KXtyZXR1cm4gdGhpcy5jZW50ZXIuYWRkKHQpLHRoaXN9ZXhwYW5kQnlQb2ludCh0KXtpZih0aGlzLmlzRW1wdHkoKSlyZXR1cm4gdGhpcy5jZW50ZXIuY29weSh0KSx0aGlzLnJhZGl1cz0wLHRoaXM7dGUuc3ViVmVjdG9ycyh0LHRoaXMuY2VudGVyKTtjb25zdCBlPXRlLmxlbmd0aFNxKCk7aWYoZT50aGlzLnJhZGl1cyp0aGlzLnJhZGl1cyl7Y29uc3QgaT1NYXRoLnNxcnQoZSkscz0oaS10aGlzLnJhZGl1cykqLjU7dGhpcy5jZW50ZXIuYWRkU2NhbGVkVmVjdG9yKHRlLHMvaSksdGhpcy5yYWRpdXMrPXN9cmV0dXJuIHRoaXN9dW5pb24odCl7cmV0dXJuIHQuaXNFbXB0eSgpP3RoaXM6dGhpcy5pc0VtcHR5KCk/KHRoaXMuY29weSh0KSx0aGlzKToodGhpcy5jZW50ZXIuZXF1YWxzKHQuY2VudGVyKT09PSEwP3RoaXMucmFkaXVzPU1hdGgubWF4KHRoaXMucmFkaXVzLHQucmFkaXVzKTooamUuc3ViVmVjdG9ycyh0LmNlbnRlcix0aGlzLmNlbnRlcikuc2V0TGVuZ3RoKHQucmFkaXVzKSx0aGlzLmV4cGFuZEJ5UG9pbnQodGUuY29weSh0LmNlbnRlcikuYWRkKGplKSksdGhpcy5leHBhbmRCeVBvaW50KHRlLmNvcHkodC5jZW50ZXIpLnN1YihqZSkpKSx0aGlzKX1lcXVhbHModCl7cmV0dXJuIHQuY2VudGVyLmVxdWFscyh0aGlzLmNlbnRlcikmJnQucmFkaXVzPT09dGhpcy5yYWRpdXN9Y2xvbmUoKXtyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KHRoaXMpfX1jbGFzcyBOe2NvbnN0cnVjdG9yKHQsZSxpLHMsbixyLGEsbyxoLGMsZixsLGQscCx5LHgpe04ucHJvdG90eXBlLmlzTWF0cml4ND0hMCx0aGlzLmVsZW1lbnRzPVsxLDAsMCwwLDAsMSwwLDAsMCwwLDEsMCwwLDAsMCwxXSx0IT09dm9pZCAwJiZ0aGlzLnNldCh0LGUsaSxzLG4scixhLG8saCxjLGYsbCxkLHAseSx4KX1zZXQodCxlLGkscyxuLHIsYSxvLGgsYyxmLGwsZCxwLHkseCl7Y29uc3QgbT10aGlzLmVsZW1lbnRzO3JldHVybiBtWzBdPXQsbVs0XT1lLG1bOF09aSxtWzEyXT1zLG1bMV09bixtWzVdPXIsbVs5XT1hLG1bMTNdPW8sbVsyXT1oLG1bNl09YyxtWzEwXT1mLG1bMTRdPWwsbVszXT1kLG1bN109cCxtWzExXT15LG1bMTVdPXgsdGhpc31pZGVudGl0eSgpe3JldHVybiB0aGlzLnNldCgxLDAsMCwwLDAsMSwwLDAsMCwwLDEsMCwwLDAsMCwxKSx0aGlzfWNsb25lKCl7cmV0dXJuIG5ldyBOKCkuZnJvbUFycmF5KHRoaXMuZWxlbWVudHMpfWNvcHkodCl7Y29uc3QgZT10aGlzLmVsZW1lbnRzLGk9dC5lbGVtZW50cztyZXR1cm4gZVswXT1pWzBdLGVbMV09aVsxXSxlWzJdPWlbMl0sZVszXT1pWzNdLGVbNF09aVs0XSxlWzVdPWlbNV0sZVs2XT1pWzZdLGVbN109aVs3XSxlWzhdPWlbOF0sZVs5XT1pWzldLGVbMTBdPWlbMTBdLGVbMTFdPWlbMTFdLGVbMTJdPWlbMTJdLGVbMTNdPWlbMTNdLGVbMTRdPWlbMTRdLGVbMTVdPWlbMTVdLHRoaXN9Y29weVBvc2l0aW9uKHQpe2NvbnN0IGU9dGhpcy5lbGVtZW50cyxpPXQuZWxlbWVudHM7cmV0dXJuIGVbMTJdPWlbMTJdLGVbMTNdPWlbMTNdLGVbMTRdPWlbMTRdLHRoaXN9c2V0RnJvbU1hdHJpeDModCl7Y29uc3QgZT10LmVsZW1lbnRzO3JldHVybiB0aGlzLnNldChlWzBdLGVbM10sZVs2XSwwLGVbMV0sZVs0XSxlWzddLDAsZVsyXSxlWzVdLGVbOF0sMCwwLDAsMCwxKSx0aGlzfWV4dHJhY3RCYXNpcyh0LGUsaSl7cmV0dXJuIHQuc2V0RnJvbU1hdHJpeENvbHVtbih0aGlzLDApLGUuc2V0RnJvbU1hdHJpeENvbHVtbih0aGlzLDEpLGkuc2V0RnJvbU1hdHJpeENvbHVtbih0aGlzLDIpLHRoaXN9bWFrZUJhc2lzKHQsZSxpKXtyZXR1cm4gdGhpcy5zZXQodC54LGUueCxpLngsMCx0LnksZS55LGkueSwwLHQueixlLnosaS56LDAsMCwwLDAsMSksdGhpc31leHRyYWN0Um90YXRpb24odCl7Y29uc3QgZT10aGlzLmVsZW1lbnRzLGk9dC5lbGVtZW50cyxzPTEva3Quc2V0RnJvbU1hdHJpeENvbHVtbih0LDApLmxlbmd0aCgpLG49MS9rdC5zZXRGcm9tTWF0cml4Q29sdW1uKHQsMSkubGVuZ3RoKCkscj0xL2t0LnNldEZyb21NYXRyaXhDb2x1bW4odCwyKS5sZW5ndGgoKTtyZXR1cm4gZVswXT1pWzBdKnMsZVsxXT1pWzFdKnMsZVsyXT1pWzJdKnMsZVszXT0wLGVbNF09aVs0XSpuLGVbNV09aVs1XSpuLGVbNl09aVs2XSpuLGVbN109MCxlWzhdPWlbOF0qcixlWzldPWlbOV0qcixlWzEwXT1pWzEwXSpyLGVbMTFdPTAsZVsxMl09MCxlWzEzXT0wLGVbMTRdPTAsZVsxNV09MSx0aGlzfW1ha2VSb3RhdGlvbkZyb21FdWxlcih0KXtjb25zdCBlPXRoaXMuZWxlbWVudHMsaT10Lngscz10Lnksbj10Lnoscj1NYXRoLmNvcyhpKSxhPU1hdGguc2luKGkpLG89TWF0aC5jb3MocyksaD1NYXRoLnNpbihzKSxjPU1hdGguY29zKG4pLGY9TWF0aC5zaW4obik7aWYodC5vcmRlcj09PSJYWVoiKXtjb25zdCBsPXIqYyxkPXIqZixwPWEqYyx5PWEqZjtlWzBdPW8qYyxlWzRdPS1vKmYsZVs4XT1oLGVbMV09ZCtwKmgsZVs1XT1sLXkqaCxlWzldPS1hKm8sZVsyXT15LWwqaCxlWzZdPXArZCpoLGVbMTBdPXIqb31lbHNlIGlmKHQub3JkZXI9PT0iWVhaIil7Y29uc3QgbD1vKmMsZD1vKmYscD1oKmMseT1oKmY7ZVswXT1sK3kqYSxlWzRdPXAqYS1kLGVbOF09cipoLGVbMV09cipmLGVbNV09cipjLGVbOV09LWEsZVsyXT1kKmEtcCxlWzZdPXkrbCphLGVbMTBdPXIqb31lbHNlIGlmKHQub3JkZXI9PT0iWlhZIil7Y29uc3QgbD1vKmMsZD1vKmYscD1oKmMseT1oKmY7ZVswXT1sLXkqYSxlWzRdPS1yKmYsZVs4XT1wK2QqYSxlWzFdPWQrcCphLGVbNV09cipjLGVbOV09eS1sKmEsZVsyXT0tcipoLGVbNl09YSxlWzEwXT1yKm99ZWxzZSBpZih0Lm9yZGVyPT09IlpZWCIpe2NvbnN0IGw9cipjLGQ9cipmLHA9YSpjLHk9YSpmO2VbMF09bypjLGVbNF09cCpoLWQsZVs4XT1sKmgreSxlWzFdPW8qZixlWzVdPXkqaCtsLGVbOV09ZCpoLXAsZVsyXT0taCxlWzZdPWEqbyxlWzEwXT1yKm99ZWxzZSBpZih0Lm9yZGVyPT09IllaWCIpe2NvbnN0IGw9cipvLGQ9cipoLHA9YSpvLHk9YSpoO2VbMF09bypjLGVbNF09eS1sKmYsZVs4XT1wKmYrZCxlWzFdPWYsZVs1XT1yKmMsZVs5XT0tYSpjLGVbMl09LWgqYyxlWzZdPWQqZitwLGVbMTBdPWwteSpmfWVsc2UgaWYodC5vcmRlcj09PSJYWlkiKXtjb25zdCBsPXIqbyxkPXIqaCxwPWEqbyx5PWEqaDtlWzBdPW8qYyxlWzRdPS1mLGVbOF09aCpjLGVbMV09bCpmK3ksZVs1XT1yKmMsZVs5XT1kKmYtcCxlWzJdPXAqZi1kLGVbNl09YSpjLGVbMTBdPXkqZitsfXJldHVybiBlWzNdPTAsZVs3XT0wLGVbMTFdPTAsZVsxMl09MCxlWzEzXT0wLGVbMTRdPTAsZVsxNV09MSx0aGlzfW1ha2VSb3RhdGlvbkZyb21RdWF0ZXJuaW9uKHQpe3JldHVybiB0aGlzLmNvbXBvc2UodXMsdCxmcyl9bG9va0F0KHQsZSxpKXtjb25zdCBzPXRoaXMuZWxlbWVudHM7cmV0dXJuIFouc3ViVmVjdG9ycyh0LGUpLFoubGVuZ3RoU3EoKT09PTAmJihaLno9MSksWi5ub3JtYWxpemUoKSxfdC5jcm9zc1ZlY3RvcnMoaSxaKSxfdC5sZW5ndGhTcSgpPT09MCYmKE1hdGguYWJzKGkueik9PT0xP1oueCs9MWUtNDpaLnorPTFlLTQsWi5ub3JtYWxpemUoKSxfdC5jcm9zc1ZlY3RvcnMoaSxaKSksX3Qubm9ybWFsaXplKCkseWUuY3Jvc3NWZWN0b3JzKFosX3QpLHNbMF09X3QueCxzWzRdPXllLngsc1s4XT1aLngsc1sxXT1fdC55LHNbNV09eWUueSxzWzldPVoueSxzWzJdPV90Lnosc1s2XT15ZS56LHNbMTBdPVoueix0aGlzfW11bHRpcGx5KHQpe3JldHVybiB0aGlzLm11bHRpcGx5TWF0cmljZXModGhpcyx0KX1wcmVtdWx0aXBseSh0KXtyZXR1cm4gdGhpcy5tdWx0aXBseU1hdHJpY2VzKHQsdGhpcyl9bXVsdGlwbHlNYXRyaWNlcyh0LGUpe2NvbnN0IGk9dC5lbGVtZW50cyxzPWUuZWxlbWVudHMsbj10aGlzLmVsZW1lbnRzLHI9aVswXSxhPWlbNF0sbz1pWzhdLGg9aVsxMl0sYz1pWzFdLGY9aVs1XSxsPWlbOV0sZD1pWzEzXSxwPWlbMl0seT1pWzZdLHg9aVsxMF0sbT1pWzE0XSxnPWlbM10sdz1pWzddLE09aVsxMV0sYj1pWzE1XSx6PXNbMF0sXz1zWzRdLFM9c1s4XSxCPXNbMTJdLFQ9c1sxXSxDPXNbNV0sUD1zWzldLEU9c1sxM10sRj1zWzJdLFU9c1s2XSxSPXNbMTBdLGo9c1sxNF0saHQ9c1szXSxsdD1zWzddLHFlPXNbMTFdLHZlPXNbMTVdO3JldHVybiBuWzBdPXIqeithKlQrbypGK2gqaHQsbls0XT1yKl8rYSpDK28qVStoKmx0LG5bOF09cipTK2EqUCtvKlIraCpxZSxuWzEyXT1yKkIrYSpFK28qaitoKnZlLG5bMV09Yyp6K2YqVCtsKkYrZCpodCxuWzVdPWMqXytmKkMrbCpVK2QqbHQsbls5XT1jKlMrZipQK2wqUitkKnFlLG5bMTNdPWMqQitmKkUrbCpqK2QqdmUsblsyXT1wKnoreSpUK3gqRittKmh0LG5bNl09cCpfK3kqQyt4KlUrbSpsdCxuWzEwXT1wKlMreSpQK3gqUittKnFlLG5bMTRdPXAqQit5KkUreCpqK20qdmUsblszXT1nKnordypUK00qRitiKmh0LG5bN109ZypfK3cqQytNKlUrYipsdCxuWzExXT1nKlMrdypQK00qUitiKnFlLG5bMTVdPWcqQit3KkUrTSpqK2IqdmUsdGhpc31tdWx0aXBseVNjYWxhcih0KXtjb25zdCBlPXRoaXMuZWxlbWVudHM7cmV0dXJuIGVbMF0qPXQsZVs0XSo9dCxlWzhdKj10LGVbMTJdKj10LGVbMV0qPXQsZVs1XSo9dCxlWzldKj10LGVbMTNdKj10LGVbMl0qPXQsZVs2XSo9dCxlWzEwXSo9dCxlWzE0XSo9dCxlWzNdKj10LGVbN10qPXQsZVsxMV0qPXQsZVsxNV0qPXQsdGhpc31kZXRlcm1pbmFudCgpe2NvbnN0IHQ9dGhpcy5lbGVtZW50cyxlPXRbMF0saT10WzRdLHM9dFs4XSxuPXRbMTJdLHI9dFsxXSxhPXRbNV0sbz10WzldLGg9dFsxM10sYz10WzJdLGY9dFs2XSxsPXRbMTBdLGQ9dFsxNF0scD10WzNdLHk9dFs3XSx4PXRbMTFdLG09dFsxNV07cmV0dXJuIHAqKCtuKm8qZi1zKmgqZi1uKmEqbCtpKmgqbCtzKmEqZC1pKm8qZCkreSooK2UqbypkLWUqaCpsK24qcipsLXMqcipkK3MqaCpjLW4qbypjKSt4KigrZSpoKmYtZSphKmQtbipyKmYraSpyKmQrbiphKmMtaSpoKmMpK20qKC1zKmEqYy1lKm8qZitlKmEqbCtzKnIqZi1pKnIqbCtpKm8qYyl9dHJhbnNwb3NlKCl7Y29uc3QgdD10aGlzLmVsZW1lbnRzO2xldCBlO3JldHVybiBlPXRbMV0sdFsxXT10WzRdLHRbNF09ZSxlPXRbMl0sdFsyXT10WzhdLHRbOF09ZSxlPXRbNl0sdFs2XT10WzldLHRbOV09ZSxlPXRbM10sdFszXT10WzEyXSx0WzEyXT1lLGU9dFs3XSx0WzddPXRbMTNdLHRbMTNdPWUsZT10WzExXSx0WzExXT10WzE0XSx0WzE0XT1lLHRoaXN9c2V0UG9zaXRpb24odCxlLGkpe2NvbnN0IHM9dGhpcy5lbGVtZW50cztyZXR1cm4gdC5pc1ZlY3RvcjM/KHNbMTJdPXQueCxzWzEzXT10Lnksc1sxNF09dC56KTooc1sxMl09dCxzWzEzXT1lLHNbMTRdPWkpLHRoaXN9aW52ZXJ0KCl7Y29uc3QgdD10aGlzLmVsZW1lbnRzLGU9dFswXSxpPXRbMV0scz10WzJdLG49dFszXSxyPXRbNF0sYT10WzVdLG89dFs2XSxoPXRbN10sYz10WzhdLGY9dFs5XSxsPXRbMTBdLGQ9dFsxMV0scD10WzEyXSx5PXRbMTNdLHg9dFsxNF0sbT10WzE1XSxnPWYqeCpoLXkqbCpoK3kqbypkLWEqeCpkLWYqbyptK2EqbCptLHc9cCpsKmgtYyp4KmgtcCpvKmQrcip4KmQrYypvKm0tcipsKm0sTT1jKnkqaC1wKmYqaCtwKmEqZC1yKnkqZC1jKmEqbStyKmYqbSxiPXAqZipvLWMqeSpvLXAqYSpsK3IqeSpsK2MqYSp4LXIqZip4LHo9ZSpnK2kqdytzKk0rbipiO2lmKHo9PT0wKXJldHVybiB0aGlzLnNldCgwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwKTtjb25zdCBfPTEvejtyZXR1cm4gdFswXT1nKl8sdFsxXT0oeSpsKm4tZip4Km4teSpzKmQraSp4KmQrZipzKm0taSpsKm0pKl8sdFsyXT0oYSp4Km4teSpvKm4reSpzKmgtaSp4KmgtYSpzKm0raSpvKm0pKl8sdFszXT0oZipvKm4tYSpsKm4tZipzKmgraSpsKmgrYSpzKmQtaSpvKmQpKl8sdFs0XT13Kl8sdFs1XT0oYyp4Km4tcCpsKm4rcCpzKmQtZSp4KmQtYypzKm0rZSpsKm0pKl8sdFs2XT0ocCpvKm4tcip4Km4tcCpzKmgrZSp4KmgrcipzKm0tZSpvKm0pKl8sdFs3XT0ocipsKm4tYypvKm4rYypzKmgtZSpsKmgtcipzKmQrZSpvKmQpKl8sdFs4XT1NKl8sdFs5XT0ocCpmKm4tYyp5Km4tcCppKmQrZSp5KmQrYyppKm0tZSpmKm0pKl8sdFsxMF09KHIqeSpuLXAqYSpuK3AqaSpoLWUqeSpoLXIqaSptK2UqYSptKSpfLHRbMTFdPShjKmEqbi1yKmYqbi1jKmkqaCtlKmYqaCtyKmkqZC1lKmEqZCkqXyx0WzEyXT1iKl8sdFsxM109KGMqeSpzLXAqZipzK3AqaSpsLWUqeSpsLWMqaSp4K2UqZip4KSpfLHRbMTRdPShwKmEqcy1yKnkqcy1wKmkqbytlKnkqbytyKmkqeC1lKmEqeCkqXyx0WzE1XT0ocipmKnMtYyphKnMrYyppKm8tZSpmKm8tcippKmwrZSphKmwpKl8sdGhpc31zY2FsZSh0KXtjb25zdCBlPXRoaXMuZWxlbWVudHMsaT10Lngscz10Lnksbj10Lno7cmV0dXJuIGVbMF0qPWksZVs0XSo9cyxlWzhdKj1uLGVbMV0qPWksZVs1XSo9cyxlWzldKj1uLGVbMl0qPWksZVs2XSo9cyxlWzEwXSo9bixlWzNdKj1pLGVbN10qPXMsZVsxMV0qPW4sdGhpc31nZXRNYXhTY2FsZU9uQXhpcygpe2NvbnN0IHQ9dGhpcy5lbGVtZW50cyxlPXRbMF0qdFswXSt0WzFdKnRbMV0rdFsyXSp0WzJdLGk9dFs0XSp0WzRdK3RbNV0qdFs1XSt0WzZdKnRbNl0scz10WzhdKnRbOF0rdFs5XSp0WzldK3RbMTBdKnRbMTBdO3JldHVybiBNYXRoLnNxcnQoTWF0aC5tYXgoZSxpLHMpKX1tYWtlVHJhbnNsYXRpb24odCxlLGkpe3JldHVybiB0LmlzVmVjdG9yMz90aGlzLnNldCgxLDAsMCx0LngsMCwxLDAsdC55LDAsMCwxLHQueiwwLDAsMCwxKTp0aGlzLnNldCgxLDAsMCx0LDAsMSwwLGUsMCwwLDEsaSwwLDAsMCwxKSx0aGlzfW1ha2VSb3RhdGlvblgodCl7Y29uc3QgZT1NYXRoLmNvcyh0KSxpPU1hdGguc2luKHQpO3JldHVybiB0aGlzLnNldCgxLDAsMCwwLDAsZSwtaSwwLDAsaSxlLDAsMCwwLDAsMSksdGhpc31tYWtlUm90YXRpb25ZKHQpe2NvbnN0IGU9TWF0aC5jb3ModCksaT1NYXRoLnNpbih0KTtyZXR1cm4gdGhpcy5zZXQoZSwwLGksMCwwLDEsMCwwLC1pLDAsZSwwLDAsMCwwLDEpLHRoaXN9bWFrZVJvdGF0aW9uWih0KXtjb25zdCBlPU1hdGguY29zKHQpLGk9TWF0aC5zaW4odCk7cmV0dXJuIHRoaXMuc2V0KGUsLWksMCwwLGksZSwwLDAsMCwwLDEsMCwwLDAsMCwxKSx0aGlzfW1ha2VSb3RhdGlvbkF4aXModCxlKXtjb25zdCBpPU1hdGguY29zKGUpLHM9TWF0aC5zaW4oZSksbj0xLWkscj10LngsYT10Lnksbz10LnosaD1uKnIsYz1uKmE7cmV0dXJuIHRoaXMuc2V0KGgqcitpLGgqYS1zKm8saCpvK3MqYSwwLGgqYStzKm8sYyphK2ksYypvLXMqciwwLGgqby1zKmEsYypvK3MqcixuKm8qbytpLDAsMCwwLDAsMSksdGhpc31tYWtlU2NhbGUodCxlLGkpe3JldHVybiB0aGlzLnNldCh0LDAsMCwwLDAsZSwwLDAsMCwwLGksMCwwLDAsMCwxKSx0aGlzfW1ha2VTaGVhcih0LGUsaSxzLG4scil7cmV0dXJuIHRoaXMuc2V0KDEsaSxuLDAsdCwxLHIsMCxlLHMsMSwwLDAsMCwwLDEpLHRoaXN9Y29tcG9zZSh0LGUsaSl7Y29uc3Qgcz10aGlzLmVsZW1lbnRzLG49ZS5feCxyPWUuX3ksYT1lLl96LG89ZS5fdyxoPW4rbixjPXIrcixmPWErYSxsPW4qaCxkPW4qYyxwPW4qZix5PXIqYyx4PXIqZixtPWEqZixnPW8qaCx3PW8qYyxNPW8qZixiPWkueCx6PWkueSxfPWkuejtyZXR1cm4gc1swXT0oMS0oeSttKSkqYixzWzFdPShkK00pKmIsc1syXT0ocC13KSpiLHNbM109MCxzWzRdPShkLU0pKnosc1s1XT0oMS0obCttKSkqeixzWzZdPSh4K2cpKnosc1s3XT0wLHNbOF09KHArdykqXyxzWzldPSh4LWcpKl8sc1sxMF09KDEtKGwreSkpKl8sc1sxMV09MCxzWzEyXT10Lngsc1sxM109dC55LHNbMTRdPXQueixzWzE1XT0xLHRoaXN9ZGVjb21wb3NlKHQsZSxpKXtjb25zdCBzPXRoaXMuZWxlbWVudHM7bGV0IG49a3Quc2V0KHNbMF0sc1sxXSxzWzJdKS5sZW5ndGgoKTtjb25zdCByPWt0LnNldChzWzRdLHNbNV0sc1s2XSkubGVuZ3RoKCksYT1rdC5zZXQoc1s4XSxzWzldLHNbMTBdKS5sZW5ndGgoKTt0aGlzLmRldGVybWluYW50KCk8MCYmKG49LW4pLHQueD1zWzEyXSx0Lnk9c1sxM10sdC56PXNbMTRdLGl0LmNvcHkodGhpcyk7Y29uc3QgaD0xL24sYz0xL3IsZj0xL2E7cmV0dXJuIGl0LmVsZW1lbnRzWzBdKj1oLGl0LmVsZW1lbnRzWzFdKj1oLGl0LmVsZW1lbnRzWzJdKj1oLGl0LmVsZW1lbnRzWzRdKj1jLGl0LmVsZW1lbnRzWzVdKj1jLGl0LmVsZW1lbnRzWzZdKj1jLGl0LmVsZW1lbnRzWzhdKj1mLGl0LmVsZW1lbnRzWzldKj1mLGl0LmVsZW1lbnRzWzEwXSo9ZixlLnNldEZyb21Sb3RhdGlvbk1hdHJpeChpdCksaS54PW4saS55PXIsaS56PWEsdGhpc31tYWtlUGVyc3BlY3RpdmUodCxlLGkscyxuLHIsYT0yZTMpe2NvbnN0IG89dGhpcy5lbGVtZW50cyxoPTIqbi8oZS10KSxjPTIqbi8oaS1zKSxmPShlK3QpLyhlLXQpLGw9KGkrcykvKGktcyk7bGV0IGQscDtpZihhPT09MmUzKWQ9LShyK24pLyhyLW4pLHA9LTIqcipuLyhyLW4pO2Vsc2UgaWYoYT09PTIwMDEpZD0tci8oci1uKSxwPS1yKm4vKHItbik7ZWxzZSB0aHJvdyBuZXcgRXJyb3IoIlRIUkVFLk1hdHJpeDQubWFrZVBlcnNwZWN0aXZlKCk6IEludmFsaWQgY29vcmRpbmF0ZSBzeXN0ZW06ICIrYSk7cmV0dXJuIG9bMF09aCxvWzRdPTAsb1s4XT1mLG9bMTJdPTAsb1sxXT0wLG9bNV09YyxvWzldPWwsb1sxM109MCxvWzJdPTAsb1s2XT0wLG9bMTBdPWQsb1sxNF09cCxvWzNdPTAsb1s3XT0wLG9bMTFdPS0xLG9bMTVdPTAsdGhpc31tYWtlT3J0aG9ncmFwaGljKHQsZSxpLHMsbixyLGE9MmUzKXtjb25zdCBvPXRoaXMuZWxlbWVudHMsaD0xLyhlLXQpLGM9MS8oaS1zKSxmPTEvKHItbiksbD0oZSt0KSpoLGQ9KGkrcykqYztsZXQgcCx5O2lmKGE9PT0yZTMpcD0ocituKSpmLHk9LTIqZjtlbHNlIGlmKGE9PT0yMDAxKXA9bipmLHk9LTEqZjtlbHNlIHRocm93IG5ldyBFcnJvcigiVEhSRUUuTWF0cml4NC5tYWtlT3J0aG9ncmFwaGljKCk6IEludmFsaWQgY29vcmRpbmF0ZSBzeXN0ZW06ICIrYSk7cmV0dXJuIG9bMF09MipoLG9bNF09MCxvWzhdPTAsb1sxMl09LWwsb1sxXT0wLG9bNV09MipjLG9bOV09MCxvWzEzXT0tZCxvWzJdPTAsb1s2XT0wLG9bMTBdPXksb1sxNF09LXAsb1szXT0wLG9bN109MCxvWzExXT0wLG9bMTVdPTEsdGhpc31lcXVhbHModCl7Y29uc3QgZT10aGlzLmVsZW1lbnRzLGk9dC5lbGVtZW50cztmb3IobGV0IHM9MDtzPDE2O3MrKylpZihlW3NdIT09aVtzXSlyZXR1cm4hMTtyZXR1cm4hMH1mcm9tQXJyYXkodCxlPTApe2ZvcihsZXQgaT0wO2k8MTY7aSsrKXRoaXMuZWxlbWVudHNbaV09dFtpK2VdO3JldHVybiB0aGlzfXRvQXJyYXkodD1bXSxlPTApe2NvbnN0IGk9dGhpcy5lbGVtZW50cztyZXR1cm4gdFtlXT1pWzBdLHRbZSsxXT1pWzFdLHRbZSsyXT1pWzJdLHRbZSszXT1pWzNdLHRbZSs0XT1pWzRdLHRbZSs1XT1pWzVdLHRbZSs2XT1pWzZdLHRbZSs3XT1pWzddLHRbZSs4XT1pWzhdLHRbZSs5XT1pWzldLHRbZSsxMF09aVsxMF0sdFtlKzExXT1pWzExXSx0W2UrMTJdPWlbMTJdLHRbZSsxM109aVsxM10sdFtlKzE0XT1pWzE0XSx0W2UrMTVdPWlbMTVdLHR9fWNvbnN0IGt0PW5ldyBBLGl0PW5ldyBOLHVzPW5ldyBBKDAsMCwwKSxmcz1uZXcgQSgxLDEsMSksX3Q9bmV3IEEseWU9bmV3IEEsWj1uZXcgQSxGaT1uZXcgTixVaT1uZXcgUXQ7Y2xhc3MgeGV7Y29uc3RydWN0b3IodD0wLGU9MCxpPTAscz14ZS5ERUZBVUxUX09SREVSKXt0aGlzLmlzRXVsZXI9ITAsdGhpcy5feD10LHRoaXMuX3k9ZSx0aGlzLl96PWksdGhpcy5fb3JkZXI9c31nZXQgeCgpe3JldHVybiB0aGlzLl94fXNldCB4KHQpe3RoaXMuX3g9dCx0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCl9Z2V0IHkoKXtyZXR1cm4gdGhpcy5feX1zZXQgeSh0KXt0aGlzLl95PXQsdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpfWdldCB6KCl7cmV0dXJuIHRoaXMuX3p9c2V0IHoodCl7dGhpcy5fej10LHRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKX1nZXQgb3JkZXIoKXtyZXR1cm4gdGhpcy5fb3JkZXJ9c2V0IG9yZGVyKHQpe3RoaXMuX29yZGVyPXQsdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpfXNldCh0LGUsaSxzPXRoaXMuX29yZGVyKXtyZXR1cm4gdGhpcy5feD10LHRoaXMuX3k9ZSx0aGlzLl96PWksdGhpcy5fb3JkZXI9cyx0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCksdGhpc31jbG9uZSgpe3JldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3Rvcih0aGlzLl94LHRoaXMuX3ksdGhpcy5feix0aGlzLl9vcmRlcil9Y29weSh0KXtyZXR1cm4gdGhpcy5feD10Ll94LHRoaXMuX3k9dC5feSx0aGlzLl96PXQuX3osdGhpcy5fb3JkZXI9dC5fb3JkZXIsdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpLHRoaXN9c2V0RnJvbVJvdGF0aW9uTWF0cml4KHQsZT10aGlzLl9vcmRlcixpPSEwKXtjb25zdCBzPXQuZWxlbWVudHMsbj1zWzBdLHI9c1s0XSxhPXNbOF0sbz1zWzFdLGg9c1s1XSxjPXNbOV0sZj1zWzJdLGw9c1s2XSxkPXNbMTBdO3N3aXRjaChlKXtjYXNlIlhZWiI6dGhpcy5feT1NYXRoLmFzaW4oYXQoYSwtMSwxKSksTWF0aC5hYnMoYSk8Ljk5OTk5OTk/KHRoaXMuX3g9TWF0aC5hdGFuMigtYyxkKSx0aGlzLl96PU1hdGguYXRhbjIoLXIsbikpOih0aGlzLl94PU1hdGguYXRhbjIobCxoKSx0aGlzLl96PTApO2JyZWFrO2Nhc2UiWVhaIjp0aGlzLl94PU1hdGguYXNpbigtYXQoYywtMSwxKSksTWF0aC5hYnMoYyk8Ljk5OTk5OTk/KHRoaXMuX3k9TWF0aC5hdGFuMihhLGQpLHRoaXMuX3o9TWF0aC5hdGFuMihvLGgpKToodGhpcy5feT1NYXRoLmF0YW4yKC1mLG4pLHRoaXMuX3o9MCk7YnJlYWs7Y2FzZSJaWFkiOnRoaXMuX3g9TWF0aC5hc2luKGF0KGwsLTEsMSkpLE1hdGguYWJzKGwpPC45OTk5OTk5Pyh0aGlzLl95PU1hdGguYXRhbjIoLWYsZCksdGhpcy5fej1NYXRoLmF0YW4yKC1yLGgpKToodGhpcy5feT0wLHRoaXMuX3o9TWF0aC5hdGFuMihvLG4pKTticmVhaztjYXNlIlpZWCI6dGhpcy5feT1NYXRoLmFzaW4oLWF0KGYsLTEsMSkpLE1hdGguYWJzKGYpPC45OTk5OTk5Pyh0aGlzLl94PU1hdGguYXRhbjIobCxkKSx0aGlzLl96PU1hdGguYXRhbjIobyxuKSk6KHRoaXMuX3g9MCx0aGlzLl96PU1hdGguYXRhbjIoLXIsaCkpO2JyZWFrO2Nhc2UiWVpYIjp0aGlzLl96PU1hdGguYXNpbihhdChvLC0xLDEpKSxNYXRoLmFicyhvKTwuOTk5OTk5OT8odGhpcy5feD1NYXRoLmF0YW4yKC1jLGgpLHRoaXMuX3k9TWF0aC5hdGFuMigtZixuKSk6KHRoaXMuX3g9MCx0aGlzLl95PU1hdGguYXRhbjIoYSxkKSk7YnJlYWs7Y2FzZSJYWlkiOnRoaXMuX3o9TWF0aC5hc2luKC1hdChyLC0xLDEpKSxNYXRoLmFicyhyKTwuOTk5OTk5OT8odGhpcy5feD1NYXRoLmF0YW4yKGwsaCksdGhpcy5feT1NYXRoLmF0YW4yKGEsbikpOih0aGlzLl94PU1hdGguYXRhbjIoLWMsZCksdGhpcy5feT0wKTticmVhaztkZWZhdWx0OmNvbnNvbGUud2FybigiVEhSRUUuRXVsZXI6IC5zZXRGcm9tUm90YXRpb25NYXRyaXgoKSBlbmNvdW50ZXJlZCBhbiB1bmtub3duIG9yZGVyOiAiK2UpfXJldHVybiB0aGlzLl9vcmRlcj1lLGk9PT0hMCYmdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpLHRoaXN9c2V0RnJvbVF1YXRlcm5pb24odCxlLGkpe3JldHVybiBGaS5tYWtlUm90YXRpb25Gcm9tUXVhdGVybmlvbih0KSx0aGlzLnNldEZyb21Sb3RhdGlvbk1hdHJpeChGaSxlLGkpfXNldEZyb21WZWN0b3IzKHQsZT10aGlzLl9vcmRlcil7cmV0dXJuIHRoaXMuc2V0KHQueCx0LnksdC56LGUpfXJlb3JkZXIodCl7cmV0dXJuIFVpLnNldEZyb21FdWxlcih0aGlzKSx0aGlzLnNldEZyb21RdWF0ZXJuaW9uKFVpLHQpfWVxdWFscyh0KXtyZXR1cm4gdC5feD09PXRoaXMuX3gmJnQuX3k9PT10aGlzLl95JiZ0Ll96PT09dGhpcy5feiYmdC5fb3JkZXI9PT10aGlzLl9vcmRlcn1mcm9tQXJyYXkodCl7cmV0dXJuIHRoaXMuX3g9dFswXSx0aGlzLl95PXRbMV0sdGhpcy5fej10WzJdLHRbM10hPT12b2lkIDAmJih0aGlzLl9vcmRlcj10WzNdKSx0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCksdGhpc310b0FycmF5KHQ9W10sZT0wKXtyZXR1cm4gdFtlXT10aGlzLl94LHRbZSsxXT10aGlzLl95LHRbZSsyXT10aGlzLl96LHRbZSszXT10aGlzLl9vcmRlcix0fV9vbkNoYW5nZSh0KXtyZXR1cm4gdGhpcy5fb25DaGFuZ2VDYWxsYmFjaz10LHRoaXN9X29uQ2hhbmdlQ2FsbGJhY2soKXt9KltTeW1ib2wuaXRlcmF0b3JdKCl7eWllbGQgdGhpcy5feCx5aWVsZCB0aGlzLl95LHlpZWxkIHRoaXMuX3oseWllbGQgdGhpcy5fb3JkZXJ9fXhlLkRFRkFVTFRfT1JERVI9IlhZWiI7Y2xhc3MgZHN7Y29uc3RydWN0b3IoKXt0aGlzLm1hc2s9MX1zZXQodCl7dGhpcy5tYXNrPSgxPDx0fDApPj4+MH1lbmFibGUodCl7dGhpcy5tYXNrfD0xPDx0fDB9ZW5hYmxlQWxsKCl7dGhpcy5tYXNrPS0xfXRvZ2dsZSh0KXt0aGlzLm1hc2tePTE8PHR8MH1kaXNhYmxlKHQpe3RoaXMubWFzayY9figxPDx0fDApfWRpc2FibGVBbGwoKXt0aGlzLm1hc2s9MH10ZXN0KHQpe3JldHVybih0aGlzLm1hc2smdC5tYXNrKSE9PTB9aXNFbmFibGVkKHQpe3JldHVybih0aGlzLm1hc2smKDE8PHR8MCkpIT09MH19bGV0IHBzPTA7Y29uc3QgUmk9bmV3IEEsTHQ9bmV3IFF0LGZ0PW5ldyBOLGdlPW5ldyBBLGVlPW5ldyBBLG1zPW5ldyBBLHlzPW5ldyBRdCxraT1uZXcgQSgxLDAsMCksTGk9bmV3IEEoMCwxLDApLElpPW5ldyBBKDAsMCwxKSx4cz17dHlwZToiYWRkZWQifSxncz17dHlwZToicmVtb3ZlZCJ9LEdlPXt0eXBlOiJjaGlsZGFkZGVkIixjaGlsZDpudWxsfSxKZT17dHlwZToiY2hpbGRyZW1vdmVkIixjaGlsZDpudWxsfTtjbGFzcyBNdCBleHRlbmRzIFhle2NvbnN0cnVjdG9yKCl7c3VwZXIoKSx0aGlzLmlzT2JqZWN0M0Q9ITAsT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsImlkIix7dmFsdWU6cHMrK30pLHRoaXMudXVpZD1mZSgpLHRoaXMubmFtZT0iIix0aGlzLnR5cGU9Ik9iamVjdDNEIix0aGlzLnBhcmVudD1udWxsLHRoaXMuY2hpbGRyZW49W10sdGhpcy51cD1NdC5ERUZBVUxUX1VQLmNsb25lKCk7Y29uc3QgdD1uZXcgQSxlPW5ldyB4ZSxpPW5ldyBRdCxzPW5ldyBBKDEsMSwxKTtmdW5jdGlvbiBuKCl7aS5zZXRGcm9tRXVsZXIoZSwhMSl9ZnVuY3Rpb24gcigpe2Uuc2V0RnJvbVF1YXRlcm5pb24oaSx2b2lkIDAsITEpfWUuX29uQ2hhbmdlKG4pLGkuX29uQ2hhbmdlKHIpLE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRoaXMse3Bvc2l0aW9uOntjb25maWd1cmFibGU6ITAsZW51bWVyYWJsZTohMCx2YWx1ZTp0fSxyb3RhdGlvbjp7Y29uZmlndXJhYmxlOiEwLGVudW1lcmFibGU6ITAsdmFsdWU6ZX0scXVhdGVybmlvbjp7Y29uZmlndXJhYmxlOiEwLGVudW1lcmFibGU6ITAsdmFsdWU6aX0sc2NhbGU6e2NvbmZpZ3VyYWJsZTohMCxlbnVtZXJhYmxlOiEwLHZhbHVlOnN9LG1vZGVsVmlld01hdHJpeDp7dmFsdWU6bmV3IE59LG5vcm1hbE1hdHJpeDp7dmFsdWU6bmV3IFR0fX0pLHRoaXMubWF0cml4PW5ldyBOLHRoaXMubWF0cml4V29ybGQ9bmV3IE4sdGhpcy5tYXRyaXhBdXRvVXBkYXRlPU10LkRFRkFVTFRfTUFUUklYX0FVVE9fVVBEQVRFLHRoaXMubWF0cml4V29ybGRBdXRvVXBkYXRlPU10LkRFRkFVTFRfTUFUUklYX1dPUkxEX0FVVE9fVVBEQVRFLHRoaXMubWF0cml4V29ybGROZWVkc1VwZGF0ZT0hMSx0aGlzLmxheWVycz1uZXcgZHMsdGhpcy52aXNpYmxlPSEwLHRoaXMuY2FzdFNoYWRvdz0hMSx0aGlzLnJlY2VpdmVTaGFkb3c9ITEsdGhpcy5mcnVzdHVtQ3VsbGVkPSEwLHRoaXMucmVuZGVyT3JkZXI9MCx0aGlzLmFuaW1hdGlvbnM9W10sdGhpcy51c2VyRGF0YT17fX1vbkJlZm9yZVNoYWRvdygpe31vbkFmdGVyU2hhZG93KCl7fW9uQmVmb3JlUmVuZGVyKCl7fW9uQWZ0ZXJSZW5kZXIoKXt9YXBwbHlNYXRyaXg0KHQpe3RoaXMubWF0cml4QXV0b1VwZGF0ZSYmdGhpcy51cGRhdGVNYXRyaXgoKSx0aGlzLm1hdHJpeC5wcmVtdWx0aXBseSh0KSx0aGlzLm1hdHJpeC5kZWNvbXBvc2UodGhpcy5wb3NpdGlvbix0aGlzLnF1YXRlcm5pb24sdGhpcy5zY2FsZSl9YXBwbHlRdWF0ZXJuaW9uKHQpe3JldHVybiB0aGlzLnF1YXRlcm5pb24ucHJlbXVsdGlwbHkodCksdGhpc31zZXRSb3RhdGlvbkZyb21BeGlzQW5nbGUodCxlKXt0aGlzLnF1YXRlcm5pb24uc2V0RnJvbUF4aXNBbmdsZSh0LGUpfXNldFJvdGF0aW9uRnJvbUV1bGVyKHQpe3RoaXMucXVhdGVybmlvbi5zZXRGcm9tRXVsZXIodCwhMCl9c2V0Um90YXRpb25Gcm9tTWF0cml4KHQpe3RoaXMucXVhdGVybmlvbi5zZXRGcm9tUm90YXRpb25NYXRyaXgodCl9c2V0Um90YXRpb25Gcm9tUXVhdGVybmlvbih0KXt0aGlzLnF1YXRlcm5pb24uY29weSh0KX1yb3RhdGVPbkF4aXModCxlKXtyZXR1cm4gTHQuc2V0RnJvbUF4aXNBbmdsZSh0LGUpLHRoaXMucXVhdGVybmlvbi5tdWx0aXBseShMdCksdGhpc31yb3RhdGVPbldvcmxkQXhpcyh0LGUpe3JldHVybiBMdC5zZXRGcm9tQXhpc0FuZ2xlKHQsZSksdGhpcy5xdWF0ZXJuaW9uLnByZW11bHRpcGx5KEx0KSx0aGlzfXJvdGF0ZVgodCl7cmV0dXJuIHRoaXMucm90YXRlT25BeGlzKGtpLHQpfXJvdGF0ZVkodCl7cmV0dXJuIHRoaXMucm90YXRlT25BeGlzKExpLHQpfXJvdGF0ZVoodCl7cmV0dXJuIHRoaXMucm90YXRlT25BeGlzKElpLHQpfXRyYW5zbGF0ZU9uQXhpcyh0LGUpe3JldHVybiBSaS5jb3B5KHQpLmFwcGx5UXVhdGVybmlvbih0aGlzLnF1YXRlcm5pb24pLHRoaXMucG9zaXRpb24uYWRkKFJpLm11bHRpcGx5U2NhbGFyKGUpKSx0aGlzfXRyYW5zbGF0ZVgodCl7cmV0dXJuIHRoaXMudHJhbnNsYXRlT25BeGlzKGtpLHQpfXRyYW5zbGF0ZVkodCl7cmV0dXJuIHRoaXMudHJhbnNsYXRlT25BeGlzKExpLHQpfXRyYW5zbGF0ZVoodCl7cmV0dXJuIHRoaXMudHJhbnNsYXRlT25BeGlzKElpLHQpfWxvY2FsVG9Xb3JsZCh0KXtyZXR1cm4gdGhpcy51cGRhdGVXb3JsZE1hdHJpeCghMCwhMSksdC5hcHBseU1hdHJpeDQodGhpcy5tYXRyaXhXb3JsZCl9d29ybGRUb0xvY2FsKHQpe3JldHVybiB0aGlzLnVwZGF0ZVdvcmxkTWF0cml4KCEwLCExKSx0LmFwcGx5TWF0cml4NChmdC5jb3B5KHRoaXMubWF0cml4V29ybGQpLmludmVydCgpKX1sb29rQXQodCxlLGkpe3QuaXNWZWN0b3IzP2dlLmNvcHkodCk6Z2Uuc2V0KHQsZSxpKTtjb25zdCBzPXRoaXMucGFyZW50O3RoaXMudXBkYXRlV29ybGRNYXRyaXgoITAsITEpLGVlLnNldEZyb21NYXRyaXhQb3NpdGlvbih0aGlzLm1hdHJpeFdvcmxkKSx0aGlzLmlzQ2FtZXJhfHx0aGlzLmlzTGlnaHQ/ZnQubG9va0F0KGVlLGdlLHRoaXMudXApOmZ0Lmxvb2tBdChnZSxlZSx0aGlzLnVwKSx0aGlzLnF1YXRlcm5pb24uc2V0RnJvbVJvdGF0aW9uTWF0cml4KGZ0KSxzJiYoZnQuZXh0cmFjdFJvdGF0aW9uKHMubWF0cml4V29ybGQpLEx0LnNldEZyb21Sb3RhdGlvbk1hdHJpeChmdCksdGhpcy5xdWF0ZXJuaW9uLnByZW11bHRpcGx5KEx0LmludmVydCgpKSl9YWRkKHQpe2lmKGFyZ3VtZW50cy5sZW5ndGg+MSl7Zm9yKGxldCBlPTA7ZTxhcmd1bWVudHMubGVuZ3RoO2UrKyl0aGlzLmFkZChhcmd1bWVudHNbZV0pO3JldHVybiB0aGlzfXJldHVybiB0PT09dGhpcz8oY29uc29sZS5lcnJvcigiVEhSRUUuT2JqZWN0M0QuYWRkOiBvYmplY3QgY2FuJ3QgYmUgYWRkZWQgYXMgYSBjaGlsZCBvZiBpdHNlbGYuIix0KSx0aGlzKToodCYmdC5pc09iamVjdDNEPyh0LnBhcmVudCE9PW51bGwmJnQucGFyZW50LnJlbW92ZSh0KSx0LnBhcmVudD10aGlzLHRoaXMuY2hpbGRyZW4ucHVzaCh0KSx0LmRpc3BhdGNoRXZlbnQoeHMpLEdlLmNoaWxkPXQsdGhpcy5kaXNwYXRjaEV2ZW50KEdlKSxHZS5jaGlsZD1udWxsKTpjb25zb2xlLmVycm9yKCJUSFJFRS5PYmplY3QzRC5hZGQ6IG9iamVjdCBub3QgYW4gaW5zdGFuY2Ugb2YgVEhSRUUuT2JqZWN0M0QuIix0KSx0aGlzKX1yZW1vdmUodCl7aWYoYXJndW1lbnRzLmxlbmd0aD4xKXtmb3IobGV0IGk9MDtpPGFyZ3VtZW50cy5sZW5ndGg7aSsrKXRoaXMucmVtb3ZlKGFyZ3VtZW50c1tpXSk7cmV0dXJuIHRoaXN9Y29uc3QgZT10aGlzLmNoaWxkcmVuLmluZGV4T2YodCk7cmV0dXJuIGUhPT0tMSYmKHQucGFyZW50PW51bGwsdGhpcy5jaGlsZHJlbi5zcGxpY2UoZSwxKSx0LmRpc3BhdGNoRXZlbnQoZ3MpLEplLmNoaWxkPXQsdGhpcy5kaXNwYXRjaEV2ZW50KEplKSxKZS5jaGlsZD1udWxsKSx0aGlzfXJlbW92ZUZyb21QYXJlbnQoKXtjb25zdCB0PXRoaXMucGFyZW50O3JldHVybiB0IT09bnVsbCYmdC5yZW1vdmUodGhpcyksdGhpc31jbGVhcigpe3JldHVybiB0aGlzLnJlbW92ZSguLi50aGlzLmNoaWxkcmVuKX1hdHRhY2godCl7cmV0dXJuIHRoaXMudXBkYXRlV29ybGRNYXRyaXgoITAsITEpLGZ0LmNvcHkodGhpcy5tYXRyaXhXb3JsZCkuaW52ZXJ0KCksdC5wYXJlbnQhPT1udWxsJiYodC5wYXJlbnQudXBkYXRlV29ybGRNYXRyaXgoITAsITEpLGZ0Lm11bHRpcGx5KHQucGFyZW50Lm1hdHJpeFdvcmxkKSksdC5hcHBseU1hdHJpeDQoZnQpLHRoaXMuYWRkKHQpLHQudXBkYXRlV29ybGRNYXRyaXgoITEsITApLHRoaXN9Z2V0T2JqZWN0QnlJZCh0KXtyZXR1cm4gdGhpcy5nZXRPYmplY3RCeVByb3BlcnR5KCJpZCIsdCl9Z2V0T2JqZWN0QnlOYW1lKHQpe3JldHVybiB0aGlzLmdldE9iamVjdEJ5UHJvcGVydHkoIm5hbWUiLHQpfWdldE9iamVjdEJ5UHJvcGVydHkodCxlKXtpZih0aGlzW3RdPT09ZSlyZXR1cm4gdGhpcztmb3IobGV0IGk9MCxzPXRoaXMuY2hpbGRyZW4ubGVuZ3RoO2k8cztpKyspe2NvbnN0IHI9dGhpcy5jaGlsZHJlbltpXS5nZXRPYmplY3RCeVByb3BlcnR5KHQsZSk7aWYociE9PXZvaWQgMClyZXR1cm4gcn19Z2V0T2JqZWN0c0J5UHJvcGVydHkodCxlLGk9W10pe3RoaXNbdF09PT1lJiZpLnB1c2godGhpcyk7Y29uc3Qgcz10aGlzLmNoaWxkcmVuO2ZvcihsZXQgbj0wLHI9cy5sZW5ndGg7bjxyO24rKylzW25dLmdldE9iamVjdHNCeVByb3BlcnR5KHQsZSxpKTtyZXR1cm4gaX1nZXRXb3JsZFBvc2l0aW9uKHQpe3JldHVybiB0aGlzLnVwZGF0ZVdvcmxkTWF0cml4KCEwLCExKSx0LnNldEZyb21NYXRyaXhQb3NpdGlvbih0aGlzLm1hdHJpeFdvcmxkKX1nZXRXb3JsZFF1YXRlcm5pb24odCl7cmV0dXJuIHRoaXMudXBkYXRlV29ybGRNYXRyaXgoITAsITEpLHRoaXMubWF0cml4V29ybGQuZGVjb21wb3NlKGVlLHQsbXMpLHR9Z2V0V29ybGRTY2FsZSh0KXtyZXR1cm4gdGhpcy51cGRhdGVXb3JsZE1hdHJpeCghMCwhMSksdGhpcy5tYXRyaXhXb3JsZC5kZWNvbXBvc2UoZWUseXMsdCksdH1nZXRXb3JsZERpcmVjdGlvbih0KXt0aGlzLnVwZGF0ZVdvcmxkTWF0cml4KCEwLCExKTtjb25zdCBlPXRoaXMubWF0cml4V29ybGQuZWxlbWVudHM7cmV0dXJuIHQuc2V0KGVbOF0sZVs5XSxlWzEwXSkubm9ybWFsaXplKCl9cmF5Y2FzdCgpe310cmF2ZXJzZSh0KXt0KHRoaXMpO2NvbnN0IGU9dGhpcy5jaGlsZHJlbjtmb3IobGV0IGk9MCxzPWUubGVuZ3RoO2k8cztpKyspZVtpXS50cmF2ZXJzZSh0KX10cmF2ZXJzZVZpc2libGUodCl7aWYodGhpcy52aXNpYmxlPT09ITEpcmV0dXJuO3QodGhpcyk7Y29uc3QgZT10aGlzLmNoaWxkcmVuO2ZvcihsZXQgaT0wLHM9ZS5sZW5ndGg7aTxzO2krKyllW2ldLnRyYXZlcnNlVmlzaWJsZSh0KX10cmF2ZXJzZUFuY2VzdG9ycyh0KXtjb25zdCBlPXRoaXMucGFyZW50O2UhPT1udWxsJiYodChlKSxlLnRyYXZlcnNlQW5jZXN0b3JzKHQpKX11cGRhdGVNYXRyaXgoKXt0aGlzLm1hdHJpeC5jb21wb3NlKHRoaXMucG9zaXRpb24sdGhpcy5xdWF0ZXJuaW9uLHRoaXMuc2NhbGUpLHRoaXMubWF0cml4V29ybGROZWVkc1VwZGF0ZT0hMH11cGRhdGVNYXRyaXhXb3JsZCh0KXt0aGlzLm1hdHJpeEF1dG9VcGRhdGUmJnRoaXMudXBkYXRlTWF0cml4KCksKHRoaXMubWF0cml4V29ybGROZWVkc1VwZGF0ZXx8dCkmJih0aGlzLnBhcmVudD09PW51bGw/dGhpcy5tYXRyaXhXb3JsZC5jb3B5KHRoaXMubWF0cml4KTp0aGlzLm1hdHJpeFdvcmxkLm11bHRpcGx5TWF0cmljZXModGhpcy5wYXJlbnQubWF0cml4V29ybGQsdGhpcy5tYXRyaXgpLHRoaXMubWF0cml4V29ybGROZWVkc1VwZGF0ZT0hMSx0PSEwKTtjb25zdCBlPXRoaXMuY2hpbGRyZW47Zm9yKGxldCBpPTAscz1lLmxlbmd0aDtpPHM7aSsrKXtjb25zdCBuPWVbaV07KG4ubWF0cml4V29ybGRBdXRvVXBkYXRlPT09ITB8fHQ9PT0hMCkmJm4udXBkYXRlTWF0cml4V29ybGQodCl9fXVwZGF0ZVdvcmxkTWF0cml4KHQsZSl7Y29uc3QgaT10aGlzLnBhcmVudDtpZih0PT09ITAmJmkhPT1udWxsJiZpLm1hdHJpeFdvcmxkQXV0b1VwZGF0ZT09PSEwJiZpLnVwZGF0ZVdvcmxkTWF0cml4KCEwLCExKSx0aGlzLm1hdHJpeEF1dG9VcGRhdGUmJnRoaXMudXBkYXRlTWF0cml4KCksdGhpcy5wYXJlbnQ9PT1udWxsP3RoaXMubWF0cml4V29ybGQuY29weSh0aGlzLm1hdHJpeCk6dGhpcy5tYXRyaXhXb3JsZC5tdWx0aXBseU1hdHJpY2VzKHRoaXMucGFyZW50Lm1hdHJpeFdvcmxkLHRoaXMubWF0cml4KSxlPT09ITApe2NvbnN0IHM9dGhpcy5jaGlsZHJlbjtmb3IobGV0IG49MCxyPXMubGVuZ3RoO248cjtuKyspe2NvbnN0IGE9c1tuXTthLm1hdHJpeFdvcmxkQXV0b1VwZGF0ZT09PSEwJiZhLnVwZGF0ZVdvcmxkTWF0cml4KCExLCEwKX19fXRvSlNPTih0KXtjb25zdCBlPXQ9PT12b2lkIDB8fHR5cGVvZiB0PT0ic3RyaW5nIixpPXt9O2UmJih0PXtnZW9tZXRyaWVzOnt9LG1hdGVyaWFsczp7fSx0ZXh0dXJlczp7fSxpbWFnZXM6e30sc2hhcGVzOnt9LHNrZWxldG9uczp7fSxhbmltYXRpb25zOnt9LG5vZGVzOnt9fSxpLm1ldGFkYXRhPXt2ZXJzaW9uOjQuNix0eXBlOiJPYmplY3QiLGdlbmVyYXRvcjoiT2JqZWN0M0QudG9KU09OIn0pO2NvbnN0IHM9e307cy51dWlkPXRoaXMudXVpZCxzLnR5cGU9dGhpcy50eXBlLHRoaXMubmFtZSE9PSIiJiYocy5uYW1lPXRoaXMubmFtZSksdGhpcy5jYXN0U2hhZG93PT09ITAmJihzLmNhc3RTaGFkb3c9ITApLHRoaXMucmVjZWl2ZVNoYWRvdz09PSEwJiYocy5yZWNlaXZlU2hhZG93PSEwKSx0aGlzLnZpc2libGU9PT0hMSYmKHMudmlzaWJsZT0hMSksdGhpcy5mcnVzdHVtQ3VsbGVkPT09ITEmJihzLmZydXN0dW1DdWxsZWQ9ITEpLHRoaXMucmVuZGVyT3JkZXIhPT0wJiYocy5yZW5kZXJPcmRlcj10aGlzLnJlbmRlck9yZGVyKSxPYmplY3Qua2V5cyh0aGlzLnVzZXJEYXRhKS5sZW5ndGg+MCYmKHMudXNlckRhdGE9dGhpcy51c2VyRGF0YSkscy5sYXllcnM9dGhpcy5sYXllcnMubWFzayxzLm1hdHJpeD10aGlzLm1hdHJpeC50b0FycmF5KCkscy51cD10aGlzLnVwLnRvQXJyYXkoKSx0aGlzLm1hdHJpeEF1dG9VcGRhdGU9PT0hMSYmKHMubWF0cml4QXV0b1VwZGF0ZT0hMSksdGhpcy5pc0luc3RhbmNlZE1lc2gmJihzLnR5cGU9Ikluc3RhbmNlZE1lc2giLHMuY291bnQ9dGhpcy5jb3VudCxzLmluc3RhbmNlTWF0cml4PXRoaXMuaW5zdGFuY2VNYXRyaXgudG9KU09OKCksdGhpcy5pbnN0YW5jZUNvbG9yIT09bnVsbCYmKHMuaW5zdGFuY2VDb2xvcj10aGlzLmluc3RhbmNlQ29sb3IudG9KU09OKCkpKSx0aGlzLmlzQmF0Y2hlZE1lc2gmJihzLnR5cGU9IkJhdGNoZWRNZXNoIixzLnBlck9iamVjdEZydXN0dW1DdWxsZWQ9dGhpcy5wZXJPYmplY3RGcnVzdHVtQ3VsbGVkLHMuc29ydE9iamVjdHM9dGhpcy5zb3J0T2JqZWN0cyxzLmRyYXdSYW5nZXM9dGhpcy5fZHJhd1JhbmdlcyxzLnJlc2VydmVkUmFuZ2VzPXRoaXMuX3Jlc2VydmVkUmFuZ2VzLHMudmlzaWJpbGl0eT10aGlzLl92aXNpYmlsaXR5LHMuYWN0aXZlPXRoaXMuX2FjdGl2ZSxzLmJvdW5kcz10aGlzLl9ib3VuZHMubWFwKGE9Pih7Ym94SW5pdGlhbGl6ZWQ6YS5ib3hJbml0aWFsaXplZCxib3hNaW46YS5ib3gubWluLnRvQXJyYXkoKSxib3hNYXg6YS5ib3gubWF4LnRvQXJyYXkoKSxzcGhlcmVJbml0aWFsaXplZDphLnNwaGVyZUluaXRpYWxpemVkLHNwaGVyZVJhZGl1czphLnNwaGVyZS5yYWRpdXMsc3BoZXJlQ2VudGVyOmEuc3BoZXJlLmNlbnRlci50b0FycmF5KCl9KSkscy5tYXhHZW9tZXRyeUNvdW50PXRoaXMuX21heEdlb21ldHJ5Q291bnQscy5tYXhWZXJ0ZXhDb3VudD10aGlzLl9tYXhWZXJ0ZXhDb3VudCxzLm1heEluZGV4Q291bnQ9dGhpcy5fbWF4SW5kZXhDb3VudCxzLmdlb21ldHJ5SW5pdGlhbGl6ZWQ9dGhpcy5fZ2VvbWV0cnlJbml0aWFsaXplZCxzLmdlb21ldHJ5Q291bnQ9dGhpcy5fZ2VvbWV0cnlDb3VudCxzLm1hdHJpY2VzVGV4dHVyZT10aGlzLl9tYXRyaWNlc1RleHR1cmUudG9KU09OKHQpLHRoaXMuYm91bmRpbmdTcGhlcmUhPT1udWxsJiYocy5ib3VuZGluZ1NwaGVyZT17Y2VudGVyOnMuYm91bmRpbmdTcGhlcmUuY2VudGVyLnRvQXJyYXkoKSxyYWRpdXM6cy5ib3VuZGluZ1NwaGVyZS5yYWRpdXN9KSx0aGlzLmJvdW5kaW5nQm94IT09bnVsbCYmKHMuYm91bmRpbmdCb3g9e21pbjpzLmJvdW5kaW5nQm94Lm1pbi50b0FycmF5KCksbWF4OnMuYm91bmRpbmdCb3gubWF4LnRvQXJyYXkoKX0pKTtmdW5jdGlvbiBuKGEsbyl7cmV0dXJuIGFbby51dWlkXT09PXZvaWQgMCYmKGFbby51dWlkXT1vLnRvSlNPTih0KSksby51dWlkfWlmKHRoaXMuaXNTY2VuZSl0aGlzLmJhY2tncm91bmQmJih0aGlzLmJhY2tncm91bmQuaXNDb2xvcj9zLmJhY2tncm91bmQ9dGhpcy5iYWNrZ3JvdW5kLnRvSlNPTigpOnRoaXMuYmFja2dyb3VuZC5pc1RleHR1cmUmJihzLmJhY2tncm91bmQ9dGhpcy5iYWNrZ3JvdW5kLnRvSlNPTih0KS51dWlkKSksdGhpcy5lbnZpcm9ubWVudCYmdGhpcy5lbnZpcm9ubWVudC5pc1RleHR1cmUmJnRoaXMuZW52aXJvbm1lbnQuaXNSZW5kZXJUYXJnZXRUZXh0dXJlIT09ITAmJihzLmVudmlyb25tZW50PXRoaXMuZW52aXJvbm1lbnQudG9KU09OKHQpLnV1aWQpO2Vsc2UgaWYodGhpcy5pc01lc2h8fHRoaXMuaXNMaW5lfHx0aGlzLmlzUG9pbnRzKXtzLmdlb21ldHJ5PW4odC5nZW9tZXRyaWVzLHRoaXMuZ2VvbWV0cnkpO2NvbnN0IGE9dGhpcy5nZW9tZXRyeS5wYXJhbWV0ZXJzO2lmKGEhPT12b2lkIDAmJmEuc2hhcGVzIT09dm9pZCAwKXtjb25zdCBvPWEuc2hhcGVzO2lmKEFycmF5LmlzQXJyYXkobykpZm9yKGxldCBoPTAsYz1vLmxlbmd0aDtoPGM7aCsrKXtjb25zdCBmPW9baF07bih0LnNoYXBlcyxmKX1lbHNlIG4odC5zaGFwZXMsbyl9fWlmKHRoaXMuaXNTa2lubmVkTWVzaCYmKHMuYmluZE1vZGU9dGhpcy5iaW5kTW9kZSxzLmJpbmRNYXRyaXg9dGhpcy5iaW5kTWF0cml4LnRvQXJyYXkoKSx0aGlzLnNrZWxldG9uIT09dm9pZCAwJiYobih0LnNrZWxldG9ucyx0aGlzLnNrZWxldG9uKSxzLnNrZWxldG9uPXRoaXMuc2tlbGV0b24udXVpZCkpLHRoaXMubWF0ZXJpYWwhPT12b2lkIDApaWYoQXJyYXkuaXNBcnJheSh0aGlzLm1hdGVyaWFsKSl7Y29uc3QgYT1bXTtmb3IobGV0IG89MCxoPXRoaXMubWF0ZXJpYWwubGVuZ3RoO288aDtvKyspYS5wdXNoKG4odC5tYXRlcmlhbHMsdGhpcy5tYXRlcmlhbFtvXSkpO3MubWF0ZXJpYWw9YX1lbHNlIHMubWF0ZXJpYWw9bih0Lm1hdGVyaWFscyx0aGlzLm1hdGVyaWFsKTtpZih0aGlzLmNoaWxkcmVuLmxlbmd0aD4wKXtzLmNoaWxkcmVuPVtdO2ZvcihsZXQgYT0wO2E8dGhpcy5jaGlsZHJlbi5sZW5ndGg7YSsrKXMuY2hpbGRyZW4ucHVzaCh0aGlzLmNoaWxkcmVuW2FdLnRvSlNPTih0KS5vYmplY3QpfWlmKHRoaXMuYW5pbWF0aW9ucy5sZW5ndGg+MCl7cy5hbmltYXRpb25zPVtdO2ZvcihsZXQgYT0wO2E8dGhpcy5hbmltYXRpb25zLmxlbmd0aDthKyspe2NvbnN0IG89dGhpcy5hbmltYXRpb25zW2FdO3MuYW5pbWF0aW9ucy5wdXNoKG4odC5hbmltYXRpb25zLG8pKX19aWYoZSl7Y29uc3QgYT1yKHQuZ2VvbWV0cmllcyksbz1yKHQubWF0ZXJpYWxzKSxoPXIodC50ZXh0dXJlcyksYz1yKHQuaW1hZ2VzKSxmPXIodC5zaGFwZXMpLGw9cih0LnNrZWxldG9ucyksZD1yKHQuYW5pbWF0aW9ucykscD1yKHQubm9kZXMpO2EubGVuZ3RoPjAmJihpLmdlb21ldHJpZXM9YSksby5sZW5ndGg+MCYmKGkubWF0ZXJpYWxzPW8pLGgubGVuZ3RoPjAmJihpLnRleHR1cmVzPWgpLGMubGVuZ3RoPjAmJihpLmltYWdlcz1jKSxmLmxlbmd0aD4wJiYoaS5zaGFwZXM9ZiksbC5sZW5ndGg+MCYmKGkuc2tlbGV0b25zPWwpLGQubGVuZ3RoPjAmJihpLmFuaW1hdGlvbnM9ZCkscC5sZW5ndGg+MCYmKGkubm9kZXM9cCl9cmV0dXJuIGkub2JqZWN0PXMsaTtmdW5jdGlvbiByKGEpe2NvbnN0IG89W107Zm9yKGNvbnN0IGggaW4gYSl7Y29uc3QgYz1hW2hdO2RlbGV0ZSBjLm1ldGFkYXRhLG8ucHVzaChjKX1yZXR1cm4gb319Y2xvbmUodCl7cmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSh0aGlzLHQpfWNvcHkodCxlPSEwKXtpZih0aGlzLm5hbWU9dC5uYW1lLHRoaXMudXAuY29weSh0LnVwKSx0aGlzLnBvc2l0aW9uLmNvcHkodC5wb3NpdGlvbiksdGhpcy5yb3RhdGlvbi5vcmRlcj10LnJvdGF0aW9uLm9yZGVyLHRoaXMucXVhdGVybmlvbi5jb3B5KHQucXVhdGVybmlvbiksdGhpcy5zY2FsZS5jb3B5KHQuc2NhbGUpLHRoaXMubWF0cml4LmNvcHkodC5tYXRyaXgpLHRoaXMubWF0cml4V29ybGQuY29weSh0Lm1hdHJpeFdvcmxkKSx0aGlzLm1hdHJpeEF1dG9VcGRhdGU9dC5tYXRyaXhBdXRvVXBkYXRlLHRoaXMubWF0cml4V29ybGRBdXRvVXBkYXRlPXQubWF0cml4V29ybGRBdXRvVXBkYXRlLHRoaXMubWF0cml4V29ybGROZWVkc1VwZGF0ZT10Lm1hdHJpeFdvcmxkTmVlZHNVcGRhdGUsdGhpcy5sYXllcnMubWFzaz10LmxheWVycy5tYXNrLHRoaXMudmlzaWJsZT10LnZpc2libGUsdGhpcy5jYXN0U2hhZG93PXQuY2FzdFNoYWRvdyx0aGlzLnJlY2VpdmVTaGFkb3c9dC5yZWNlaXZlU2hhZG93LHRoaXMuZnJ1c3R1bUN1bGxlZD10LmZydXN0dW1DdWxsZWQsdGhpcy5yZW5kZXJPcmRlcj10LnJlbmRlck9yZGVyLHRoaXMuYW5pbWF0aW9ucz10LmFuaW1hdGlvbnMuc2xpY2UoKSx0aGlzLnVzZXJEYXRhPUpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodC51c2VyRGF0YSkpLGU9PT0hMClmb3IobGV0IGk9MDtpPHQuY2hpbGRyZW4ubGVuZ3RoO2krKyl7Y29uc3Qgcz10LmNoaWxkcmVuW2ldO3RoaXMuYWRkKHMuY2xvbmUoKSl9cmV0dXJuIHRoaXN9fU10LkRFRkFVTFRfVVA9bmV3IEEoMCwxLDApLE10LkRFRkFVTFRfTUFUUklYX0FVVE9fVVBEQVRFPSEwLE10LkRFRkFVTFRfTUFUUklYX1dPUkxEX0FVVE9fVVBEQVRFPSEwO2NvbnN0IHN0PW5ldyBBLGR0PW5ldyBBLFFlPW5ldyBBLHB0PW5ldyBBLEl0PW5ldyBBLER0PW5ldyBBLERpPW5ldyBBLEtlPW5ldyBBLHRpPW5ldyBBLGVpPW5ldyBBO2NsYXNzIG50e2NvbnN0cnVjdG9yKHQ9bmV3IEEsZT1uZXcgQSxpPW5ldyBBKXt0aGlzLmE9dCx0aGlzLmI9ZSx0aGlzLmM9aX1zdGF0aWMgZ2V0Tm9ybWFsKHQsZSxpLHMpe3Muc3ViVmVjdG9ycyhpLGUpLHN0LnN1YlZlY3RvcnModCxlKSxzLmNyb3NzKHN0KTtjb25zdCBuPXMubGVuZ3RoU3EoKTtyZXR1cm4gbj4wP3MubXVsdGlwbHlTY2FsYXIoMS9NYXRoLnNxcnQobikpOnMuc2V0KDAsMCwwKX1zdGF0aWMgZ2V0QmFyeWNvb3JkKHQsZSxpLHMsbil7c3Quc3ViVmVjdG9ycyhzLGUpLGR0LnN1YlZlY3RvcnMoaSxlKSxRZS5zdWJWZWN0b3JzKHQsZSk7Y29uc3Qgcj1zdC5kb3Qoc3QpLGE9c3QuZG90KGR0KSxvPXN0LmRvdChRZSksaD1kdC5kb3QoZHQpLGM9ZHQuZG90KFFlKSxmPXIqaC1hKmE7aWYoZj09PTApcmV0dXJuIG4uc2V0KDAsMCwwKSxudWxsO2NvbnN0IGw9MS9mLGQ9KGgqby1hKmMpKmwscD0ocipjLWEqbykqbDtyZXR1cm4gbi5zZXQoMS1kLXAscCxkKX1zdGF0aWMgY29udGFpbnNQb2ludCh0LGUsaSxzKXtyZXR1cm4gdGhpcy5nZXRCYXJ5Y29vcmQodCxlLGkscyxwdCk9PT1udWxsPyExOnB0Lng+PTAmJnB0Lnk+PTAmJnB0LngrcHQueTw9MX1zdGF0aWMgZ2V0SW50ZXJwb2xhdGlvbih0LGUsaSxzLG4scixhLG8pe3JldHVybiB0aGlzLmdldEJhcnljb29yZCh0LGUsaSxzLHB0KT09PW51bGw/KG8ueD0wLG8ueT0wLCJ6ImluIG8mJihvLno9MCksInciaW4gbyYmKG8udz0wKSxudWxsKTooby5zZXRTY2FsYXIoMCksby5hZGRTY2FsZWRWZWN0b3IobixwdC54KSxvLmFkZFNjYWxlZFZlY3RvcihyLHB0LnkpLG8uYWRkU2NhbGVkVmVjdG9yKGEscHQueiksbyl9c3RhdGljIGlzRnJvbnRGYWNpbmcodCxlLGkscyl7cmV0dXJuIHN0LnN1YlZlY3RvcnMoaSxlKSxkdC5zdWJWZWN0b3JzKHQsZSksc3QuY3Jvc3MoZHQpLmRvdChzKTwwfXNldCh0LGUsaSl7cmV0dXJuIHRoaXMuYS5jb3B5KHQpLHRoaXMuYi5jb3B5KGUpLHRoaXMuYy5jb3B5KGkpLHRoaXN9c2V0RnJvbVBvaW50c0FuZEluZGljZXModCxlLGkscyl7cmV0dXJuIHRoaXMuYS5jb3B5KHRbZV0pLHRoaXMuYi5jb3B5KHRbaV0pLHRoaXMuYy5jb3B5KHRbc10pLHRoaXN9c2V0RnJvbUF0dHJpYnV0ZUFuZEluZGljZXModCxlLGkscyl7cmV0dXJuIHRoaXMuYS5mcm9tQnVmZmVyQXR0cmlidXRlKHQsZSksdGhpcy5iLmZyb21CdWZmZXJBdHRyaWJ1dGUodCxpKSx0aGlzLmMuZnJvbUJ1ZmZlckF0dHJpYnV0ZSh0LHMpLHRoaXN9Y2xvbmUoKXtyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KHRoaXMpfWNvcHkodCl7cmV0dXJuIHRoaXMuYS5jb3B5KHQuYSksdGhpcy5iLmNvcHkodC5iKSx0aGlzLmMuY29weSh0LmMpLHRoaXN9Z2V0QXJlYSgpe3JldHVybiBzdC5zdWJWZWN0b3JzKHRoaXMuYyx0aGlzLmIpLGR0LnN1YlZlY3RvcnModGhpcy5hLHRoaXMuYiksc3QuY3Jvc3MoZHQpLmxlbmd0aCgpKi41fWdldE1pZHBvaW50KHQpe3JldHVybiB0LmFkZFZlY3RvcnModGhpcy5hLHRoaXMuYikuYWRkKHRoaXMuYykubXVsdGlwbHlTY2FsYXIoMS8zKX1nZXROb3JtYWwodCl7cmV0dXJuIG50LmdldE5vcm1hbCh0aGlzLmEsdGhpcy5iLHRoaXMuYyx0KX1nZXRQbGFuZSh0KXtyZXR1cm4gdC5zZXRGcm9tQ29wbGFuYXJQb2ludHModGhpcy5hLHRoaXMuYix0aGlzLmMpfWdldEJhcnljb29yZCh0LGUpe3JldHVybiBudC5nZXRCYXJ5Y29vcmQodCx0aGlzLmEsdGhpcy5iLHRoaXMuYyxlKX1nZXRJbnRlcnBvbGF0aW9uKHQsZSxpLHMsbil7cmV0dXJuIG50LmdldEludGVycG9sYXRpb24odCx0aGlzLmEsdGhpcy5iLHRoaXMuYyxlLGkscyxuKX1jb250YWluc1BvaW50KHQpe3JldHVybiBudC5jb250YWluc1BvaW50KHQsdGhpcy5hLHRoaXMuYix0aGlzLmMpfWlzRnJvbnRGYWNpbmcodCl7cmV0dXJuIG50LmlzRnJvbnRGYWNpbmcodGhpcy5hLHRoaXMuYix0aGlzLmMsdCl9aW50ZXJzZWN0c0JveCh0KXtyZXR1cm4gdC5pbnRlcnNlY3RzVHJpYW5nbGUodGhpcyl9Y2xvc2VzdFBvaW50VG9Qb2ludCh0LGUpe2NvbnN0IGk9dGhpcy5hLHM9dGhpcy5iLG49dGhpcy5jO2xldCByLGE7SXQuc3ViVmVjdG9ycyhzLGkpLER0LnN1YlZlY3RvcnMobixpKSxLZS5zdWJWZWN0b3JzKHQsaSk7Y29uc3Qgbz1JdC5kb3QoS2UpLGg9RHQuZG90KEtlKTtpZihvPD0wJiZoPD0wKXJldHVybiBlLmNvcHkoaSk7dGkuc3ViVmVjdG9ycyh0LHMpO2NvbnN0IGM9SXQuZG90KHRpKSxmPUR0LmRvdCh0aSk7aWYoYz49MCYmZjw9YylyZXR1cm4gZS5jb3B5KHMpO2NvbnN0IGw9bypmLWMqaDtpZihsPD0wJiZvPj0wJiZjPD0wKXJldHVybiByPW8vKG8tYyksZS5jb3B5KGkpLmFkZFNjYWxlZFZlY3RvcihJdCxyKTtlaS5zdWJWZWN0b3JzKHQsbik7Y29uc3QgZD1JdC5kb3QoZWkpLHA9RHQuZG90KGVpKTtpZihwPj0wJiZkPD1wKXJldHVybiBlLmNvcHkobik7Y29uc3QgeT1kKmgtbypwO2lmKHk8PTAmJmg+PTAmJnA8PTApcmV0dXJuIGE9aC8oaC1wKSxlLmNvcHkoaSkuYWRkU2NhbGVkVmVjdG9yKER0LGEpO2NvbnN0IHg9YypwLWQqZjtpZih4PD0wJiZmLWM+PTAmJmQtcD49MClyZXR1cm4gRGkuc3ViVmVjdG9ycyhuLHMpLGE9KGYtYykvKGYtYysoZC1wKSksZS5jb3B5KHMpLmFkZFNjYWxlZFZlY3RvcihEaSxhKTtjb25zdCBtPTEvKHgreStsKTtyZXR1cm4gcj15Km0sYT1sKm0sZS5jb3B5KGkpLmFkZFNjYWxlZFZlY3RvcihJdCxyKS5hZGRTY2FsZWRWZWN0b3IoRHQsYSl9ZXF1YWxzKHQpe3JldHVybiB0LmEuZXF1YWxzKHRoaXMuYSkmJnQuYi5lcXVhbHModGhpcy5iKSYmdC5jLmVxdWFscyh0aGlzLmMpfX1jb25zdCBJPW5ldyBBLGJlPW5ldyB2O2NsYXNzIGN0e2NvbnN0cnVjdG9yKHQsZSxpPSExKXtpZihBcnJheS5pc0FycmF5KHQpKXRocm93IG5ldyBUeXBlRXJyb3IoIlRIUkVFLkJ1ZmZlckF0dHJpYnV0ZTogYXJyYXkgc2hvdWxkIGJlIGEgVHlwZWQgQXJyYXkuIik7dGhpcy5pc0J1ZmZlckF0dHJpYnV0ZT0hMCx0aGlzLm5hbWU9IiIsdGhpcy5hcnJheT10LHRoaXMuaXRlbVNpemU9ZSx0aGlzLmNvdW50PXQhPT12b2lkIDA/dC5sZW5ndGgvZTowLHRoaXMubm9ybWFsaXplZD1pLHRoaXMudXNhZ2U9MzUwNDQsdGhpcy5fdXBkYXRlUmFuZ2U9e29mZnNldDowLGNvdW50Oi0xfSx0aGlzLnVwZGF0ZVJhbmdlcz1bXSx0aGlzLmdwdVR5cGU9MTAxNSx0aGlzLnZlcnNpb249MH1vblVwbG9hZENhbGxiYWNrKCl7fXNldCBuZWVkc1VwZGF0ZSh0KXt0PT09ITAmJnRoaXMudmVyc2lvbisrfWdldCB1cGRhdGVSYW5nZSgpe3JldHVybiBycygiVEhSRUUuQnVmZmVyQXR0cmlidXRlOiB1cGRhdGVSYW5nZSgpIGlzIGRlcHJlY2F0ZWQgYW5kIHdpbGwgYmUgcmVtb3ZlZCBpbiByMTY5LiBVc2UgYWRkVXBkYXRlUmFuZ2UoKSBpbnN0ZWFkLiIpLHRoaXMuX3VwZGF0ZVJhbmdlfXNldFVzYWdlKHQpe3JldHVybiB0aGlzLnVzYWdlPXQsdGhpc31hZGRVcGRhdGVSYW5nZSh0LGUpe3RoaXMudXBkYXRlUmFuZ2VzLnB1c2goe3N0YXJ0OnQsY291bnQ6ZX0pfWNsZWFyVXBkYXRlUmFuZ2VzKCl7dGhpcy51cGRhdGVSYW5nZXMubGVuZ3RoPTB9Y29weSh0KXtyZXR1cm4gdGhpcy5uYW1lPXQubmFtZSx0aGlzLmFycmF5PW5ldyB0LmFycmF5LmNvbnN0cnVjdG9yKHQuYXJyYXkpLHRoaXMuaXRlbVNpemU9dC5pdGVtU2l6ZSx0aGlzLmNvdW50PXQuY291bnQsdGhpcy5ub3JtYWxpemVkPXQubm9ybWFsaXplZCx0aGlzLnVzYWdlPXQudXNhZ2UsdGhpcy5ncHVUeXBlPXQuZ3B1VHlwZSx0aGlzfWNvcHlBdCh0LGUsaSl7dCo9dGhpcy5pdGVtU2l6ZSxpKj1lLml0ZW1TaXplO2ZvcihsZXQgcz0wLG49dGhpcy5pdGVtU2l6ZTtzPG47cysrKXRoaXMuYXJyYXlbdCtzXT1lLmFycmF5W2krc107cmV0dXJuIHRoaXN9Y29weUFycmF5KHQpe3JldHVybiB0aGlzLmFycmF5LnNldCh0KSx0aGlzfWFwcGx5TWF0cml4Myh0KXtpZih0aGlzLml0ZW1TaXplPT09Milmb3IobGV0IGU9MCxpPXRoaXMuY291bnQ7ZTxpO2UrKyliZS5mcm9tQnVmZmVyQXR0cmlidXRlKHRoaXMsZSksYmUuYXBwbHlNYXRyaXgzKHQpLHRoaXMuc2V0WFkoZSxiZS54LGJlLnkpO2Vsc2UgaWYodGhpcy5pdGVtU2l6ZT09PTMpZm9yKGxldCBlPTAsaT10aGlzLmNvdW50O2U8aTtlKyspSS5mcm9tQnVmZmVyQXR0cmlidXRlKHRoaXMsZSksSS5hcHBseU1hdHJpeDModCksdGhpcy5zZXRYWVooZSxJLngsSS55LEkueik7cmV0dXJuIHRoaXN9YXBwbHlNYXRyaXg0KHQpe2ZvcihsZXQgZT0wLGk9dGhpcy5jb3VudDtlPGk7ZSsrKUkuZnJvbUJ1ZmZlckF0dHJpYnV0ZSh0aGlzLGUpLEkuYXBwbHlNYXRyaXg0KHQpLHRoaXMuc2V0WFlaKGUsSS54LEkueSxJLnopO3JldHVybiB0aGlzfWFwcGx5Tm9ybWFsTWF0cml4KHQpe2ZvcihsZXQgZT0wLGk9dGhpcy5jb3VudDtlPGk7ZSsrKUkuZnJvbUJ1ZmZlckF0dHJpYnV0ZSh0aGlzLGUpLEkuYXBwbHlOb3JtYWxNYXRyaXgodCksdGhpcy5zZXRYWVooZSxJLngsSS55LEkueik7cmV0dXJuIHRoaXN9dHJhbnNmb3JtRGlyZWN0aW9uKHQpe2ZvcihsZXQgZT0wLGk9dGhpcy5jb3VudDtlPGk7ZSsrKUkuZnJvbUJ1ZmZlckF0dHJpYnV0ZSh0aGlzLGUpLEkudHJhbnNmb3JtRGlyZWN0aW9uKHQpLHRoaXMuc2V0WFlaKGUsSS54LEkueSxJLnopO3JldHVybiB0aGlzfXNldCh0LGU9MCl7cmV0dXJuIHRoaXMuYXJyYXkuc2V0KHQsZSksdGhpc31nZXRDb21wb25lbnQodCxlKXtsZXQgaT10aGlzLmFycmF5W3QqdGhpcy5pdGVtU2l6ZStlXTtyZXR1cm4gdGhpcy5ub3JtYWxpemVkJiYoaT1KdChpLHRoaXMuYXJyYXkpKSxpfXNldENvbXBvbmVudCh0LGUsaSl7cmV0dXJuIHRoaXMubm9ybWFsaXplZCYmKGk9TyhpLHRoaXMuYXJyYXkpKSx0aGlzLmFycmF5W3QqdGhpcy5pdGVtU2l6ZStlXT1pLHRoaXN9Z2V0WCh0KXtsZXQgZT10aGlzLmFycmF5W3QqdGhpcy5pdGVtU2l6ZV07cmV0dXJuIHRoaXMubm9ybWFsaXplZCYmKGU9SnQoZSx0aGlzLmFycmF5KSksZX1zZXRYKHQsZSl7cmV0dXJuIHRoaXMubm9ybWFsaXplZCYmKGU9TyhlLHRoaXMuYXJyYXkpKSx0aGlzLmFycmF5W3QqdGhpcy5pdGVtU2l6ZV09ZSx0aGlzfWdldFkodCl7bGV0IGU9dGhpcy5hcnJheVt0KnRoaXMuaXRlbVNpemUrMV07cmV0dXJuIHRoaXMubm9ybWFsaXplZCYmKGU9SnQoZSx0aGlzLmFycmF5KSksZX1zZXRZKHQsZSl7cmV0dXJuIHRoaXMubm9ybWFsaXplZCYmKGU9TyhlLHRoaXMuYXJyYXkpKSx0aGlzLmFycmF5W3QqdGhpcy5pdGVtU2l6ZSsxXT1lLHRoaXN9Z2V0Wih0KXtsZXQgZT10aGlzLmFycmF5W3QqdGhpcy5pdGVtU2l6ZSsyXTtyZXR1cm4gdGhpcy5ub3JtYWxpemVkJiYoZT1KdChlLHRoaXMuYXJyYXkpKSxlfXNldFoodCxlKXtyZXR1cm4gdGhpcy5ub3JtYWxpemVkJiYoZT1PKGUsdGhpcy5hcnJheSkpLHRoaXMuYXJyYXlbdCp0aGlzLml0ZW1TaXplKzJdPWUsdGhpc31nZXRXKHQpe2xldCBlPXRoaXMuYXJyYXlbdCp0aGlzLml0ZW1TaXplKzNdO3JldHVybiB0aGlzLm5vcm1hbGl6ZWQmJihlPUp0KGUsdGhpcy5hcnJheSkpLGV9c2V0Vyh0LGUpe3JldHVybiB0aGlzLm5vcm1hbGl6ZWQmJihlPU8oZSx0aGlzLmFycmF5KSksdGhpcy5hcnJheVt0KnRoaXMuaXRlbVNpemUrM109ZSx0aGlzfXNldFhZKHQsZSxpKXtyZXR1cm4gdCo9dGhpcy5pdGVtU2l6ZSx0aGlzLm5vcm1hbGl6ZWQmJihlPU8oZSx0aGlzLmFycmF5KSxpPU8oaSx0aGlzLmFycmF5KSksdGhpcy5hcnJheVt0KzBdPWUsdGhpcy5hcnJheVt0KzFdPWksdGhpc31zZXRYWVoodCxlLGkscyl7cmV0dXJuIHQqPXRoaXMuaXRlbVNpemUsdGhpcy5ub3JtYWxpemVkJiYoZT1PKGUsdGhpcy5hcnJheSksaT1PKGksdGhpcy5hcnJheSkscz1PKHMsdGhpcy5hcnJheSkpLHRoaXMuYXJyYXlbdCswXT1lLHRoaXMuYXJyYXlbdCsxXT1pLHRoaXMuYXJyYXlbdCsyXT1zLHRoaXN9c2V0WFlaVyh0LGUsaSxzLG4pe3JldHVybiB0Kj10aGlzLml0ZW1TaXplLHRoaXMubm9ybWFsaXplZCYmKGU9TyhlLHRoaXMuYXJyYXkpLGk9TyhpLHRoaXMuYXJyYXkpLHM9TyhzLHRoaXMuYXJyYXkpLG49TyhuLHRoaXMuYXJyYXkpKSx0aGlzLmFycmF5W3QrMF09ZSx0aGlzLmFycmF5W3QrMV09aSx0aGlzLmFycmF5W3QrMl09cyx0aGlzLmFycmF5W3QrM109bix0aGlzfW9uVXBsb2FkKHQpe3JldHVybiB0aGlzLm9uVXBsb2FkQ2FsbGJhY2s9dCx0aGlzfWNsb25lKCl7cmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKHRoaXMuYXJyYXksdGhpcy5pdGVtU2l6ZSkuY29weSh0aGlzKX10b0pTT04oKXtjb25zdCB0PXtpdGVtU2l6ZTp0aGlzLml0ZW1TaXplLHR5cGU6dGhpcy5hcnJheS5jb25zdHJ1Y3Rvci5uYW1lLGFycmF5OkFycmF5LmZyb20odGhpcy5hcnJheSksbm9ybWFsaXplZDp0aGlzLm5vcm1hbGl6ZWR9O3JldHVybiB0aGlzLm5hbWUhPT0iIiYmKHQubmFtZT10aGlzLm5hbWUpLHRoaXMudXNhZ2UhPT0zNTA0NCYmKHQudXNhZ2U9dGhpcy51c2FnZSksdH19Y2xhc3MgYnMgZXh0ZW5kcyBjdHtjb25zdHJ1Y3Rvcih0LGUsaSl7c3VwZXIobmV3IFVpbnQxNkFycmF5KHQpLGUsaSl9fWNsYXNzIHdzIGV4dGVuZHMgY3R7Y29uc3RydWN0b3IodCxlLGkpe3N1cGVyKG5ldyBVaW50MzJBcnJheSh0KSxlLGkpfX1jbGFzcyBfcyBleHRlbmRzIGN0e2NvbnN0cnVjdG9yKHQsZSxpKXtzdXBlcihuZXcgRmxvYXQzMkFycmF5KHQpLGUsaSl9fWxldCBNcz0wO2NvbnN0IEc9bmV3IE4saWk9bmV3IE10LFZ0PW5ldyBBLEg9bmV3IFcsaWU9bmV3IFcsVj1uZXcgQTtjbGFzcyBzaSBleHRlbmRzIFhle2NvbnN0cnVjdG9yKCl7c3VwZXIoKSx0aGlzLmlzQnVmZmVyR2VvbWV0cnk9ITAsT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsImlkIix7dmFsdWU6TXMrK30pLHRoaXMudXVpZD1mZSgpLHRoaXMubmFtZT0iIix0aGlzLnR5cGU9IkJ1ZmZlckdlb21ldHJ5Iix0aGlzLmluZGV4PW51bGwsdGhpcy5hdHRyaWJ1dGVzPXt9LHRoaXMubW9ycGhBdHRyaWJ1dGVzPXt9LHRoaXMubW9ycGhUYXJnZXRzUmVsYXRpdmU9ITEsdGhpcy5ncm91cHM9W10sdGhpcy5ib3VuZGluZ0JveD1udWxsLHRoaXMuYm91bmRpbmdTcGhlcmU9bnVsbCx0aGlzLmRyYXdSYW5nZT17c3RhcnQ6MCxjb3VudDoxLzB9LHRoaXMudXNlckRhdGE9e319Z2V0SW5kZXgoKXtyZXR1cm4gdGhpcy5pbmRleH1zZXRJbmRleCh0KXtyZXR1cm4gQXJyYXkuaXNBcnJheSh0KT90aGlzLmluZGV4PW5ldyhucyh0KT93czpicykodCwxKTp0aGlzLmluZGV4PXQsdGhpc31nZXRBdHRyaWJ1dGUodCl7cmV0dXJuIHRoaXMuYXR0cmlidXRlc1t0XX1zZXRBdHRyaWJ1dGUodCxlKXtyZXR1cm4gdGhpcy5hdHRyaWJ1dGVzW3RdPWUsdGhpc31kZWxldGVBdHRyaWJ1dGUodCl7cmV0dXJuIGRlbGV0ZSB0aGlzLmF0dHJpYnV0ZXNbdF0sdGhpc31oYXNBdHRyaWJ1dGUodCl7cmV0dXJuIHRoaXMuYXR0cmlidXRlc1t0XSE9PXZvaWQgMH1hZGRHcm91cCh0LGUsaT0wKXt0aGlzLmdyb3Vwcy5wdXNoKHtzdGFydDp0LGNvdW50OmUsbWF0ZXJpYWxJbmRleDppfSl9Y2xlYXJHcm91cHMoKXt0aGlzLmdyb3Vwcz1bXX1zZXREcmF3UmFuZ2UodCxlKXt0aGlzLmRyYXdSYW5nZS5zdGFydD10LHRoaXMuZHJhd1JhbmdlLmNvdW50PWV9YXBwbHlNYXRyaXg0KHQpe2NvbnN0IGU9dGhpcy5hdHRyaWJ1dGVzLnBvc2l0aW9uO2UhPT12b2lkIDAmJihlLmFwcGx5TWF0cml4NCh0KSxlLm5lZWRzVXBkYXRlPSEwKTtjb25zdCBpPXRoaXMuYXR0cmlidXRlcy5ub3JtYWw7aWYoaSE9PXZvaWQgMCl7Y29uc3Qgbj1uZXcgVHQoKS5nZXROb3JtYWxNYXRyaXgodCk7aS5hcHBseU5vcm1hbE1hdHJpeChuKSxpLm5lZWRzVXBkYXRlPSEwfWNvbnN0IHM9dGhpcy5hdHRyaWJ1dGVzLnRhbmdlbnQ7cmV0dXJuIHMhPT12b2lkIDAmJihzLnRyYW5zZm9ybURpcmVjdGlvbih0KSxzLm5lZWRzVXBkYXRlPSEwKSx0aGlzLmJvdW5kaW5nQm94IT09bnVsbCYmdGhpcy5jb21wdXRlQm91bmRpbmdCb3goKSx0aGlzLmJvdW5kaW5nU3BoZXJlIT09bnVsbCYmdGhpcy5jb21wdXRlQm91bmRpbmdTcGhlcmUoKSx0aGlzfWFwcGx5UXVhdGVybmlvbih0KXtyZXR1cm4gRy5tYWtlUm90YXRpb25Gcm9tUXVhdGVybmlvbih0KSx0aGlzLmFwcGx5TWF0cml4NChHKSx0aGlzfXJvdGF0ZVgodCl7cmV0dXJuIEcubWFrZVJvdGF0aW9uWCh0KSx0aGlzLmFwcGx5TWF0cml4NChHKSx0aGlzfXJvdGF0ZVkodCl7cmV0dXJuIEcubWFrZVJvdGF0aW9uWSh0KSx0aGlzLmFwcGx5TWF0cml4NChHKSx0aGlzfXJvdGF0ZVoodCl7cmV0dXJuIEcubWFrZVJvdGF0aW9uWih0KSx0aGlzLmFwcGx5TWF0cml4NChHKSx0aGlzfXRyYW5zbGF0ZSh0LGUsaSl7cmV0dXJuIEcubWFrZVRyYW5zbGF0aW9uKHQsZSxpKSx0aGlzLmFwcGx5TWF0cml4NChHKSx0aGlzfXNjYWxlKHQsZSxpKXtyZXR1cm4gRy5tYWtlU2NhbGUodCxlLGkpLHRoaXMuYXBwbHlNYXRyaXg0KEcpLHRoaXN9bG9va0F0KHQpe3JldHVybiBpaS5sb29rQXQodCksaWkudXBkYXRlTWF0cml4KCksdGhpcy5hcHBseU1hdHJpeDQoaWkubWF0cml4KSx0aGlzfWNlbnRlcigpe3JldHVybiB0aGlzLmNvbXB1dGVCb3VuZGluZ0JveCgpLHRoaXMuYm91bmRpbmdCb3guZ2V0Q2VudGVyKFZ0KS5uZWdhdGUoKSx0aGlzLnRyYW5zbGF0ZShWdC54LFZ0LnksVnQueiksdGhpc31zZXRGcm9tUG9pbnRzKHQpe2NvbnN0IGU9W107Zm9yKGxldCBpPTAscz10Lmxlbmd0aDtpPHM7aSsrKXtjb25zdCBuPXRbaV07ZS5wdXNoKG4ueCxuLnksbi56fHwwKX1yZXR1cm4gdGhpcy5zZXRBdHRyaWJ1dGUoInBvc2l0aW9uIixuZXcgX3MoZSwzKSksdGhpc31jb21wdXRlQm91bmRpbmdCb3goKXt0aGlzLmJvdW5kaW5nQm94PT09bnVsbCYmKHRoaXMuYm91bmRpbmdCb3g9bmV3IFcpO2NvbnN0IHQ9dGhpcy5hdHRyaWJ1dGVzLnBvc2l0aW9uLGU9dGhpcy5tb3JwaEF0dHJpYnV0ZXMucG9zaXRpb247aWYodCYmdC5pc0dMQnVmZmVyQXR0cmlidXRlKXtjb25zb2xlLmVycm9yKCJUSFJFRS5CdWZmZXJHZW9tZXRyeS5jb21wdXRlQm91bmRpbmdCb3goKTogR0xCdWZmZXJBdHRyaWJ1dGUgcmVxdWlyZXMgYSBtYW51YWwgYm91bmRpbmcgYm94LiIsdGhpcyksdGhpcy5ib3VuZGluZ0JveC5zZXQobmV3IEEoLTEvMCwtMS8wLC0xLzApLG5ldyBBKDEvMCwxLzAsMS8wKSk7cmV0dXJufWlmKHQhPT12b2lkIDApe2lmKHRoaXMuYm91bmRpbmdCb3guc2V0RnJvbUJ1ZmZlckF0dHJpYnV0ZSh0KSxlKWZvcihsZXQgaT0wLHM9ZS5sZW5ndGg7aTxzO2krKyl7Y29uc3Qgbj1lW2ldO0guc2V0RnJvbUJ1ZmZlckF0dHJpYnV0ZShuKSx0aGlzLm1vcnBoVGFyZ2V0c1JlbGF0aXZlPyhWLmFkZFZlY3RvcnModGhpcy5ib3VuZGluZ0JveC5taW4sSC5taW4pLHRoaXMuYm91bmRpbmdCb3guZXhwYW5kQnlQb2ludChWKSxWLmFkZFZlY3RvcnModGhpcy5ib3VuZGluZ0JveC5tYXgsSC5tYXgpLHRoaXMuYm91bmRpbmdCb3guZXhwYW5kQnlQb2ludChWKSk6KHRoaXMuYm91bmRpbmdCb3guZXhwYW5kQnlQb2ludChILm1pbiksdGhpcy5ib3VuZGluZ0JveC5leHBhbmRCeVBvaW50KEgubWF4KSl9fWVsc2UgdGhpcy5ib3VuZGluZ0JveC5tYWtlRW1wdHkoKTsoaXNOYU4odGhpcy5ib3VuZGluZ0JveC5taW4ueCl8fGlzTmFOKHRoaXMuYm91bmRpbmdCb3gubWluLnkpfHxpc05hTih0aGlzLmJvdW5kaW5nQm94Lm1pbi56KSkmJmNvbnNvbGUuZXJyb3IoJ1RIUkVFLkJ1ZmZlckdlb21ldHJ5LmNvbXB1dGVCb3VuZGluZ0JveCgpOiBDb21wdXRlZCBtaW4vbWF4IGhhdmUgTmFOIHZhbHVlcy4gVGhlICJwb3NpdGlvbiIgYXR0cmlidXRlIGlzIGxpa2VseSB0byBoYXZlIE5hTiB2YWx1ZXMuJyx0aGlzKX1jb21wdXRlQm91bmRpbmdTcGhlcmUoKXt0aGlzLmJvdW5kaW5nU3BoZXJlPT09bnVsbCYmKHRoaXMuYm91bmRpbmdTcGhlcmU9bmV3IEVpKTtjb25zdCB0PXRoaXMuYXR0cmlidXRlcy5wb3NpdGlvbixlPXRoaXMubW9ycGhBdHRyaWJ1dGVzLnBvc2l0aW9uO2lmKHQmJnQuaXNHTEJ1ZmZlckF0dHJpYnV0ZSl7Y29uc29sZS5lcnJvcigiVEhSRUUuQnVmZmVyR2VvbWV0cnkuY29tcHV0ZUJvdW5kaW5nU3BoZXJlKCk6IEdMQnVmZmVyQXR0cmlidXRlIHJlcXVpcmVzIGEgbWFudWFsIGJvdW5kaW5nIHNwaGVyZS4iLHRoaXMpLHRoaXMuYm91bmRpbmdTcGhlcmUuc2V0KG5ldyBBLDEvMCk7cmV0dXJufWlmKHQpe2NvbnN0IGk9dGhpcy5ib3VuZGluZ1NwaGVyZS5jZW50ZXI7aWYoSC5zZXRGcm9tQnVmZmVyQXR0cmlidXRlKHQpLGUpZm9yKGxldCBuPTAscj1lLmxlbmd0aDtuPHI7bisrKXtjb25zdCBhPWVbbl07aWUuc2V0RnJvbUJ1ZmZlckF0dHJpYnV0ZShhKSx0aGlzLm1vcnBoVGFyZ2V0c1JlbGF0aXZlPyhWLmFkZFZlY3RvcnMoSC5taW4saWUubWluKSxILmV4cGFuZEJ5UG9pbnQoViksVi5hZGRWZWN0b3JzKEgubWF4LGllLm1heCksSC5leHBhbmRCeVBvaW50KFYpKTooSC5leHBhbmRCeVBvaW50KGllLm1pbiksSC5leHBhbmRCeVBvaW50KGllLm1heCkpfUguZ2V0Q2VudGVyKGkpO2xldCBzPTA7Zm9yKGxldCBuPTAscj10LmNvdW50O248cjtuKyspVi5mcm9tQnVmZmVyQXR0cmlidXRlKHQsbikscz1NYXRoLm1heChzLGkuZGlzdGFuY2VUb1NxdWFyZWQoVikpO2lmKGUpZm9yKGxldCBuPTAscj1lLmxlbmd0aDtuPHI7bisrKXtjb25zdCBhPWVbbl0sbz10aGlzLm1vcnBoVGFyZ2V0c1JlbGF0aXZlO2ZvcihsZXQgaD0wLGM9YS5jb3VudDtoPGM7aCsrKVYuZnJvbUJ1ZmZlckF0dHJpYnV0ZShhLGgpLG8mJihWdC5mcm9tQnVmZmVyQXR0cmlidXRlKHQsaCksVi5hZGQoVnQpKSxzPU1hdGgubWF4KHMsaS5kaXN0YW5jZVRvU3F1YXJlZChWKSl9dGhpcy5ib3VuZGluZ1NwaGVyZS5yYWRpdXM9TWF0aC5zcXJ0KHMpLGlzTmFOKHRoaXMuYm91bmRpbmdTcGhlcmUucmFkaXVzKSYmY29uc29sZS5lcnJvcignVEhSRUUuQnVmZmVyR2VvbWV0cnkuY29tcHV0ZUJvdW5kaW5nU3BoZXJlKCk6IENvbXB1dGVkIHJhZGl1cyBpcyBOYU4uIFRoZSAicG9zaXRpb24iIGF0dHJpYnV0ZSBpcyBsaWtlbHkgdG8gaGF2ZSBOYU4gdmFsdWVzLicsdGhpcyl9fWNvbXB1dGVUYW5nZW50cygpe2NvbnN0IHQ9dGhpcy5pbmRleCxlPXRoaXMuYXR0cmlidXRlcztpZih0PT09bnVsbHx8ZS5wb3NpdGlvbj09PXZvaWQgMHx8ZS5ub3JtYWw9PT12b2lkIDB8fGUudXY9PT12b2lkIDApe2NvbnNvbGUuZXJyb3IoIlRIUkVFLkJ1ZmZlckdlb21ldHJ5OiAuY29tcHV0ZVRhbmdlbnRzKCkgZmFpbGVkLiBNaXNzaW5nIHJlcXVpcmVkIGF0dHJpYnV0ZXMgKGluZGV4LCBwb3NpdGlvbiwgbm9ybWFsIG9yIHV2KSIpO3JldHVybn1jb25zdCBpPWUucG9zaXRpb24scz1lLm5vcm1hbCxuPWUudXY7dGhpcy5oYXNBdHRyaWJ1dGUoInRhbmdlbnQiKT09PSExJiZ0aGlzLnNldEF0dHJpYnV0ZSgidGFuZ2VudCIsbmV3IGN0KG5ldyBGbG9hdDMyQXJyYXkoNCppLmNvdW50KSw0KSk7Y29uc3Qgcj10aGlzLmdldEF0dHJpYnV0ZSgidGFuZ2VudCIpLGE9W10sbz1bXTtmb3IobGV0IFM9MDtTPGkuY291bnQ7UysrKWFbU109bmV3IEEsb1tTXT1uZXcgQTtjb25zdCBoPW5ldyBBLGM9bmV3IEEsZj1uZXcgQSxsPW5ldyB2LGQ9bmV3IHYscD1uZXcgdix5PW5ldyBBLHg9bmV3IEE7ZnVuY3Rpb24gbShTLEIsVCl7aC5mcm9tQnVmZmVyQXR0cmlidXRlKGksUyksYy5mcm9tQnVmZmVyQXR0cmlidXRlKGksQiksZi5mcm9tQnVmZmVyQXR0cmlidXRlKGksVCksbC5mcm9tQnVmZmVyQXR0cmlidXRlKG4sUyksZC5mcm9tQnVmZmVyQXR0cmlidXRlKG4sQikscC5mcm9tQnVmZmVyQXR0cmlidXRlKG4sVCksYy5zdWIoaCksZi5zdWIoaCksZC5zdWIobCkscC5zdWIobCk7Y29uc3QgQz0xLyhkLngqcC55LXAueCpkLnkpO2lzRmluaXRlKEMpJiYoeS5jb3B5KGMpLm11bHRpcGx5U2NhbGFyKHAueSkuYWRkU2NhbGVkVmVjdG9yKGYsLWQueSkubXVsdGlwbHlTY2FsYXIoQykseC5jb3B5KGYpLm11bHRpcGx5U2NhbGFyKGQueCkuYWRkU2NhbGVkVmVjdG9yKGMsLXAueCkubXVsdGlwbHlTY2FsYXIoQyksYVtTXS5hZGQoeSksYVtCXS5hZGQoeSksYVtUXS5hZGQoeSksb1tTXS5hZGQoeCksb1tCXS5hZGQoeCksb1tUXS5hZGQoeCkpfWxldCBnPXRoaXMuZ3JvdXBzO2cubGVuZ3RoPT09MCYmKGc9W3tzdGFydDowLGNvdW50OnQuY291bnR9XSk7Zm9yKGxldCBTPTAsQj1nLmxlbmd0aDtTPEI7KytTKXtjb25zdCBUPWdbU10sQz1ULnN0YXJ0LFA9VC5jb3VudDtmb3IobGV0IEU9QyxGPUMrUDtFPEY7RSs9MyltKHQuZ2V0WChFKzApLHQuZ2V0WChFKzEpLHQuZ2V0WChFKzIpKX1jb25zdCB3PW5ldyBBLE09bmV3IEEsYj1uZXcgQSx6PW5ldyBBO2Z1bmN0aW9uIF8oUyl7Yi5mcm9tQnVmZmVyQXR0cmlidXRlKHMsUyksei5jb3B5KGIpO2NvbnN0IEI9YVtTXTt3LmNvcHkoQiksdy5zdWIoYi5tdWx0aXBseVNjYWxhcihiLmRvdChCKSkpLm5vcm1hbGl6ZSgpLE0uY3Jvc3NWZWN0b3JzKHosQik7Y29uc3QgQz1NLmRvdChvW1NdKTwwPy0xOjE7ci5zZXRYWVpXKFMsdy54LHcueSx3LnosQyl9Zm9yKGxldCBTPTAsQj1nLmxlbmd0aDtTPEI7KytTKXtjb25zdCBUPWdbU10sQz1ULnN0YXJ0LFA9VC5jb3VudDtmb3IobGV0IEU9QyxGPUMrUDtFPEY7RSs9MylfKHQuZ2V0WChFKzApKSxfKHQuZ2V0WChFKzEpKSxfKHQuZ2V0WChFKzIpKX19Y29tcHV0ZVZlcnRleE5vcm1hbHMoKXtjb25zdCB0PXRoaXMuaW5kZXgsZT10aGlzLmdldEF0dHJpYnV0ZSgicG9zaXRpb24iKTtpZihlIT09dm9pZCAwKXtsZXQgaT10aGlzLmdldEF0dHJpYnV0ZSgibm9ybWFsIik7aWYoaT09PXZvaWQgMClpPW5ldyBjdChuZXcgRmxvYXQzMkFycmF5KGUuY291bnQqMyksMyksdGhpcy5zZXRBdHRyaWJ1dGUoIm5vcm1hbCIsaSk7ZWxzZSBmb3IobGV0IGw9MCxkPWkuY291bnQ7bDxkO2wrKylpLnNldFhZWihsLDAsMCwwKTtjb25zdCBzPW5ldyBBLG49bmV3IEEscj1uZXcgQSxhPW5ldyBBLG89bmV3IEEsaD1uZXcgQSxjPW5ldyBBLGY9bmV3IEE7aWYodClmb3IobGV0IGw9MCxkPXQuY291bnQ7bDxkO2wrPTMpe2NvbnN0IHA9dC5nZXRYKGwrMCkseT10LmdldFgobCsxKSx4PXQuZ2V0WChsKzIpO3MuZnJvbUJ1ZmZlckF0dHJpYnV0ZShlLHApLG4uZnJvbUJ1ZmZlckF0dHJpYnV0ZShlLHkpLHIuZnJvbUJ1ZmZlckF0dHJpYnV0ZShlLHgpLGMuc3ViVmVjdG9ycyhyLG4pLGYuc3ViVmVjdG9ycyhzLG4pLGMuY3Jvc3MoZiksYS5mcm9tQnVmZmVyQXR0cmlidXRlKGkscCksby5mcm9tQnVmZmVyQXR0cmlidXRlKGkseSksaC5mcm9tQnVmZmVyQXR0cmlidXRlKGkseCksYS5hZGQoYyksby5hZGQoYyksaC5hZGQoYyksaS5zZXRYWVoocCxhLngsYS55LGEueiksaS5zZXRYWVooeSxvLngsby55LG8ueiksaS5zZXRYWVooeCxoLngsaC55LGgueil9ZWxzZSBmb3IobGV0IGw9MCxkPWUuY291bnQ7bDxkO2wrPTMpcy5mcm9tQnVmZmVyQXR0cmlidXRlKGUsbCswKSxuLmZyb21CdWZmZXJBdHRyaWJ1dGUoZSxsKzEpLHIuZnJvbUJ1ZmZlckF0dHJpYnV0ZShlLGwrMiksYy5zdWJWZWN0b3JzKHIsbiksZi5zdWJWZWN0b3JzKHMsbiksYy5jcm9zcyhmKSxpLnNldFhZWihsKzAsYy54LGMueSxjLnopLGkuc2V0WFlaKGwrMSxjLngsYy55LGMueiksaS5zZXRYWVoobCsyLGMueCxjLnksYy56KTt0aGlzLm5vcm1hbGl6ZU5vcm1hbHMoKSxpLm5lZWRzVXBkYXRlPSEwfX1ub3JtYWxpemVOb3JtYWxzKCl7Y29uc3QgdD10aGlzLmF0dHJpYnV0ZXMubm9ybWFsO2ZvcihsZXQgZT0wLGk9dC5jb3VudDtlPGk7ZSsrKVYuZnJvbUJ1ZmZlckF0dHJpYnV0ZSh0LGUpLFYubm9ybWFsaXplKCksdC5zZXRYWVooZSxWLngsVi55LFYueil9dG9Ob25JbmRleGVkKCl7ZnVuY3Rpb24gdChhLG8pe2NvbnN0IGg9YS5hcnJheSxjPWEuaXRlbVNpemUsZj1hLm5vcm1hbGl6ZWQsbD1uZXcgaC5jb25zdHJ1Y3RvcihvLmxlbmd0aCpjKTtsZXQgZD0wLHA9MDtmb3IobGV0IHk9MCx4PW8ubGVuZ3RoO3k8eDt5Kyspe2EuaXNJbnRlcmxlYXZlZEJ1ZmZlckF0dHJpYnV0ZT9kPW9beV0qYS5kYXRhLnN0cmlkZSthLm9mZnNldDpkPW9beV0qYztmb3IobGV0IG09MDttPGM7bSsrKWxbcCsrXT1oW2QrK119cmV0dXJuIG5ldyBjdChsLGMsZil9aWYodGhpcy5pbmRleD09PW51bGwpcmV0dXJuIGNvbnNvbGUud2FybigiVEhSRUUuQnVmZmVyR2VvbWV0cnkudG9Ob25JbmRleGVkKCk6IEJ1ZmZlckdlb21ldHJ5IGlzIGFscmVhZHkgbm9uLWluZGV4ZWQuIiksdGhpcztjb25zdCBlPW5ldyBzaSxpPXRoaXMuaW5kZXguYXJyYXkscz10aGlzLmF0dHJpYnV0ZXM7Zm9yKGNvbnN0IGEgaW4gcyl7Y29uc3Qgbz1zW2FdLGg9dChvLGkpO2Uuc2V0QXR0cmlidXRlKGEsaCl9Y29uc3Qgbj10aGlzLm1vcnBoQXR0cmlidXRlcztmb3IoY29uc3QgYSBpbiBuKXtjb25zdCBvPVtdLGg9blthXTtmb3IobGV0IGM9MCxmPWgubGVuZ3RoO2M8ZjtjKyspe2NvbnN0IGw9aFtjXSxkPXQobCxpKTtvLnB1c2goZCl9ZS5tb3JwaEF0dHJpYnV0ZXNbYV09b31lLm1vcnBoVGFyZ2V0c1JlbGF0aXZlPXRoaXMubW9ycGhUYXJnZXRzUmVsYXRpdmU7Y29uc3Qgcj10aGlzLmdyb3Vwcztmb3IobGV0IGE9MCxvPXIubGVuZ3RoO2E8bzthKyspe2NvbnN0IGg9clthXTtlLmFkZEdyb3VwKGguc3RhcnQsaC5jb3VudCxoLm1hdGVyaWFsSW5kZXgpfXJldHVybiBlfXRvSlNPTigpe2NvbnN0IHQ9e21ldGFkYXRhOnt2ZXJzaW9uOjQuNix0eXBlOiJCdWZmZXJHZW9tZXRyeSIsZ2VuZXJhdG9yOiJCdWZmZXJHZW9tZXRyeS50b0pTT04ifX07aWYodC51dWlkPXRoaXMudXVpZCx0LnR5cGU9dGhpcy50eXBlLHRoaXMubmFtZSE9PSIiJiYodC5uYW1lPXRoaXMubmFtZSksT2JqZWN0LmtleXModGhpcy51c2VyRGF0YSkubGVuZ3RoPjAmJih0LnVzZXJEYXRhPXRoaXMudXNlckRhdGEpLHRoaXMucGFyYW1ldGVycyE9PXZvaWQgMCl7Y29uc3Qgbz10aGlzLnBhcmFtZXRlcnM7Zm9yKGNvbnN0IGggaW4gbylvW2hdIT09dm9pZCAwJiYodFtoXT1vW2hdKTtyZXR1cm4gdH10LmRhdGE9e2F0dHJpYnV0ZXM6e319O2NvbnN0IGU9dGhpcy5pbmRleDtlIT09bnVsbCYmKHQuZGF0YS5pbmRleD17dHlwZTplLmFycmF5LmNvbnN0cnVjdG9yLm5hbWUsYXJyYXk6QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZS5hcnJheSl9KTtjb25zdCBpPXRoaXMuYXR0cmlidXRlcztmb3IoY29uc3QgbyBpbiBpKXtjb25zdCBoPWlbb107dC5kYXRhLmF0dHJpYnV0ZXNbb109aC50b0pTT04odC5kYXRhKX1jb25zdCBzPXt9O2xldCBuPSExO2Zvcihjb25zdCBvIGluIHRoaXMubW9ycGhBdHRyaWJ1dGVzKXtjb25zdCBoPXRoaXMubW9ycGhBdHRyaWJ1dGVzW29dLGM9W107Zm9yKGxldCBmPTAsbD1oLmxlbmd0aDtmPGw7ZisrKXtjb25zdCBkPWhbZl07Yy5wdXNoKGQudG9KU09OKHQuZGF0YSkpfWMubGVuZ3RoPjAmJihzW29dPWMsbj0hMCl9biYmKHQuZGF0YS5tb3JwaEF0dHJpYnV0ZXM9cyx0LmRhdGEubW9ycGhUYXJnZXRzUmVsYXRpdmU9dGhpcy5tb3JwaFRhcmdldHNSZWxhdGl2ZSk7Y29uc3Qgcj10aGlzLmdyb3VwcztyLmxlbmd0aD4wJiYodC5kYXRhLmdyb3Vwcz1KU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHIpKSk7Y29uc3QgYT10aGlzLmJvdW5kaW5nU3BoZXJlO3JldHVybiBhIT09bnVsbCYmKHQuZGF0YS5ib3VuZGluZ1NwaGVyZT17Y2VudGVyOmEuY2VudGVyLnRvQXJyYXkoKSxyYWRpdXM6YS5yYWRpdXN9KSx0fWNsb25lKCl7cmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSh0aGlzKX1jb3B5KHQpe3RoaXMuaW5kZXg9bnVsbCx0aGlzLmF0dHJpYnV0ZXM9e30sdGhpcy5tb3JwaEF0dHJpYnV0ZXM9e30sdGhpcy5ncm91cHM9W10sdGhpcy5ib3VuZGluZ0JveD1udWxsLHRoaXMuYm91bmRpbmdTcGhlcmU9bnVsbDtjb25zdCBlPXt9O3RoaXMubmFtZT10Lm5hbWU7Y29uc3QgaT10LmluZGV4O2khPT1udWxsJiZ0aGlzLnNldEluZGV4KGkuY2xvbmUoZSkpO2NvbnN0IHM9dC5hdHRyaWJ1dGVzO2Zvcihjb25zdCBoIGluIHMpe2NvbnN0IGM9c1toXTt0aGlzLnNldEF0dHJpYnV0ZShoLGMuY2xvbmUoZSkpfWNvbnN0IG49dC5tb3JwaEF0dHJpYnV0ZXM7Zm9yKGNvbnN0IGggaW4gbil7Y29uc3QgYz1bXSxmPW5baF07Zm9yKGxldCBsPTAsZD1mLmxlbmd0aDtsPGQ7bCsrKWMucHVzaChmW2xdLmNsb25lKGUpKTt0aGlzLm1vcnBoQXR0cmlidXRlc1toXT1jfXRoaXMubW9ycGhUYXJnZXRzUmVsYXRpdmU9dC5tb3JwaFRhcmdldHNSZWxhdGl2ZTtjb25zdCByPXQuZ3JvdXBzO2ZvcihsZXQgaD0wLGM9ci5sZW5ndGg7aDxjO2grKyl7Y29uc3QgZj1yW2hdO3RoaXMuYWRkR3JvdXAoZi5zdGFydCxmLmNvdW50LGYubWF0ZXJpYWxJbmRleCl9Y29uc3QgYT10LmJvdW5kaW5nQm94O2EhPT1udWxsJiYodGhpcy5ib3VuZGluZ0JveD1hLmNsb25lKCkpO2NvbnN0IG89dC5ib3VuZGluZ1NwaGVyZTtyZXR1cm4gbyE9PW51bGwmJih0aGlzLmJvdW5kaW5nU3BoZXJlPW8uY2xvbmUoKSksdGhpcy5kcmF3UmFuZ2Uuc3RhcnQ9dC5kcmF3UmFuZ2Uuc3RhcnQsdGhpcy5kcmF3UmFuZ2UuY291bnQ9dC5kcmF3UmFuZ2UuY291bnQsdGhpcy51c2VyRGF0YT10LnVzZXJEYXRhLHRoaXN9ZGlzcG9zZSgpe3RoaXMuZGlzcGF0Y2hFdmVudCh7dHlwZToiZGlzcG9zZSJ9KX19Y29uc3Qgbmk9bmV3IEEsQXM9bmV3IEEsenM9bmV3IFR0O2NsYXNzIFZpe2NvbnN0cnVjdG9yKHQ9bmV3IEEoMSwwLDApLGU9MCl7dGhpcy5pc1BsYW5lPSEwLHRoaXMubm9ybWFsPXQsdGhpcy5jb25zdGFudD1lfXNldCh0LGUpe3JldHVybiB0aGlzLm5vcm1hbC5jb3B5KHQpLHRoaXMuY29uc3RhbnQ9ZSx0aGlzfXNldENvbXBvbmVudHModCxlLGkscyl7cmV0dXJuIHRoaXMubm9ybWFsLnNldCh0LGUsaSksdGhpcy5jb25zdGFudD1zLHRoaXN9c2V0RnJvbU5vcm1hbEFuZENvcGxhbmFyUG9pbnQodCxlKXtyZXR1cm4gdGhpcy5ub3JtYWwuY29weSh0KSx0aGlzLmNvbnN0YW50PS1lLmRvdCh0aGlzLm5vcm1hbCksdGhpc31zZXRGcm9tQ29wbGFuYXJQb2ludHModCxlLGkpe2NvbnN0IHM9bmkuc3ViVmVjdG9ycyhpLGUpLmNyb3NzKEFzLnN1YlZlY3RvcnModCxlKSkubm9ybWFsaXplKCk7cmV0dXJuIHRoaXMuc2V0RnJvbU5vcm1hbEFuZENvcGxhbmFyUG9pbnQocyx0KSx0aGlzfWNvcHkodCl7cmV0dXJuIHRoaXMubm9ybWFsLmNvcHkodC5ub3JtYWwpLHRoaXMuY29uc3RhbnQ9dC5jb25zdGFudCx0aGlzfW5vcm1hbGl6ZSgpe2NvbnN0IHQ9MS90aGlzLm5vcm1hbC5sZW5ndGgoKTtyZXR1cm4gdGhpcy5ub3JtYWwubXVsdGlwbHlTY2FsYXIodCksdGhpcy5jb25zdGFudCo9dCx0aGlzfW5lZ2F0ZSgpe3JldHVybiB0aGlzLmNvbnN0YW50Kj0tMSx0aGlzLm5vcm1hbC5uZWdhdGUoKSx0aGlzfWRpc3RhbmNlVG9Qb2ludCh0KXtyZXR1cm4gdGhpcy5ub3JtYWwuZG90KHQpK3RoaXMuY29uc3RhbnR9ZGlzdGFuY2VUb1NwaGVyZSh0KXtyZXR1cm4gdGhpcy5kaXN0YW5jZVRvUG9pbnQodC5jZW50ZXIpLXQucmFkaXVzfXByb2plY3RQb2ludCh0LGUpe3JldHVybiBlLmNvcHkodCkuYWRkU2NhbGVkVmVjdG9yKHRoaXMubm9ybWFsLC10aGlzLmRpc3RhbmNlVG9Qb2ludCh0KSl9aW50ZXJzZWN0TGluZSh0LGUpe2NvbnN0IGk9dC5kZWx0YShuaSkscz10aGlzLm5vcm1hbC5kb3QoaSk7aWYocz09PTApcmV0dXJuIHRoaXMuZGlzdGFuY2VUb1BvaW50KHQuc3RhcnQpPT09MD9lLmNvcHkodC5zdGFydCk6bnVsbDtjb25zdCBuPS0odC5zdGFydC5kb3QodGhpcy5ub3JtYWwpK3RoaXMuY29uc3RhbnQpL3M7cmV0dXJuIG48MHx8bj4xP251bGw6ZS5jb3B5KHQuc3RhcnQpLmFkZFNjYWxlZFZlY3RvcihpLG4pfWludGVyc2VjdHNMaW5lKHQpe2NvbnN0IGU9dGhpcy5kaXN0YW5jZVRvUG9pbnQodC5zdGFydCksaT10aGlzLmRpc3RhbmNlVG9Qb2ludCh0LmVuZCk7cmV0dXJuIGU8MCYmaT4wfHxpPDAmJmU+MH1pbnRlcnNlY3RzQm94KHQpe3JldHVybiB0LmludGVyc2VjdHNQbGFuZSh0aGlzKX1pbnRlcnNlY3RzU3BoZXJlKHQpe3JldHVybiB0LmludGVyc2VjdHNQbGFuZSh0aGlzKX1jb3BsYW5hclBvaW50KHQpe3JldHVybiB0LmNvcHkodGhpcy5ub3JtYWwpLm11bHRpcGx5U2NhbGFyKC10aGlzLmNvbnN0YW50KX1hcHBseU1hdHJpeDQodCxlKXtjb25zdCBpPWV8fHpzLmdldE5vcm1hbE1hdHJpeCh0KSxzPXRoaXMuY29wbGFuYXJQb2ludChuaSkuYXBwbHlNYXRyaXg0KHQpLG49dGhpcy5ub3JtYWwuYXBwbHlNYXRyaXgzKGkpLm5vcm1hbGl6ZSgpO3JldHVybiB0aGlzLmNvbnN0YW50PS1zLmRvdChuKSx0aGlzfXRyYW5zbGF0ZSh0KXtyZXR1cm4gdGhpcy5jb25zdGFudC09dC5kb3QodGhpcy5ub3JtYWwpLHRoaXN9ZXF1YWxzKHQpe3JldHVybiB0Lm5vcm1hbC5lcXVhbHModGhpcy5ub3JtYWwpJiZ0LmNvbnN0YW50PT09dGhpcy5jb25zdGFudH1jbG9uZSgpe3JldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmNvcHkodGhpcyl9fWNsYXNzIFNzIGV4dGVuZHMgZ3R7Y29uc3RydWN0b3IodCxlLGkscyxuLHIsYSxvLGgsYyl7aWYoYz1jIT09dm9pZCAwP2M6MTAyNixjIT09MTAyNiYmYyE9PTEwMjcpdGhyb3cgbmV3IEVycm9yKCJEZXB0aFRleHR1cmUgZm9ybWF0IG11c3QgYmUgZWl0aGVyIFRIUkVFLkRlcHRoRm9ybWF0IG9yIFRIUkVFLkRlcHRoU3RlbmNpbEZvcm1hdCIpO2k9PT12b2lkIDAmJmM9PT0xMDI2JiYoaT0xMDE0KSxpPT09dm9pZCAwJiZjPT09MTAyNyYmKGk9MTAyMCksc3VwZXIobnVsbCxzLG4scixhLG8sYyxpLGgpLHRoaXMuaXNEZXB0aFRleHR1cmU9ITAsdGhpcy5pbWFnZT17d2lkdGg6dCxoZWlnaHQ6ZX0sdGhpcy5tYWdGaWx0ZXI9YSE9PXZvaWQgMD9hOjEwMDMsdGhpcy5taW5GaWx0ZXI9byE9PXZvaWQgMD9vOjEwMDMsdGhpcy5mbGlwWT0hMSx0aGlzLmdlbmVyYXRlTWlwbWFwcz0hMSx0aGlzLmNvbXBhcmVGdW5jdGlvbj1udWxsfWNvcHkodCl7cmV0dXJuIHN1cGVyLmNvcHkodCksdGhpcy5jb21wYXJlRnVuY3Rpb249dC5jb21wYXJlRnVuY3Rpb24sdGhpc310b0pTT04odCl7Y29uc3QgZT1zdXBlci50b0pTT04odCk7cmV0dXJuIHRoaXMuY29tcGFyZUZ1bmN0aW9uIT09bnVsbCYmKGUuY29tcGFyZUZ1bmN0aW9uPXRoaXMuY29tcGFyZUZ1bmN0aW9uKSxlfX1jb25zdCBCcz1uZXcgU3MoMSwxKTtCcy5jb21wYXJlRnVuY3Rpb249NTE1O2NvbnN0IE5pPW5ldyBBLHdlPW5ldyBBO2NsYXNzIG10e2NvbnN0cnVjdG9yKHQ9bmV3IEEsZT1uZXcgQSl7dGhpcy5zdGFydD10LHRoaXMuZW5kPWV9c2V0KHQsZSl7cmV0dXJuIHRoaXMuc3RhcnQuY29weSh0KSx0aGlzLmVuZC5jb3B5KGUpLHRoaXN9Y29weSh0KXtyZXR1cm4gdGhpcy5zdGFydC5jb3B5KHQuc3RhcnQpLHRoaXMuZW5kLmNvcHkodC5lbmQpLHRoaXN9Z2V0Q2VudGVyKHQpe3JldHVybiB0LmFkZFZlY3RvcnModGhpcy5zdGFydCx0aGlzLmVuZCkubXVsdGlwbHlTY2FsYXIoLjUpfWRlbHRhKHQpe3JldHVybiB0LnN1YlZlY3RvcnModGhpcy5lbmQsdGhpcy5zdGFydCl9ZGlzdGFuY2VTcSgpe3JldHVybiB0aGlzLnN0YXJ0LmRpc3RhbmNlVG9TcXVhcmVkKHRoaXMuZW5kKX1kaXN0YW5jZSgpe3JldHVybiB0aGlzLnN0YXJ0LmRpc3RhbmNlVG8odGhpcy5lbmQpfWF0KHQsZSl7cmV0dXJuIHRoaXMuZGVsdGEoZSkubXVsdGlwbHlTY2FsYXIodCkuYWRkKHRoaXMuc3RhcnQpfWNsb3Nlc3RQb2ludFRvUG9pbnRQYXJhbWV0ZXIodCxlKXtOaS5zdWJWZWN0b3JzKHQsdGhpcy5zdGFydCksd2Uuc3ViVmVjdG9ycyh0aGlzLmVuZCx0aGlzLnN0YXJ0KTtjb25zdCBpPXdlLmRvdCh3ZSk7bGV0IG49d2UuZG90KE5pKS9pO3JldHVybiBlJiYobj1hdChuLDAsMSkpLG59Y2xvc2VzdFBvaW50VG9Qb2ludCh0LGUsaSl7Y29uc3Qgcz10aGlzLmNsb3Nlc3RQb2ludFRvUG9pbnRQYXJhbWV0ZXIodCxlKTtyZXR1cm4gdGhpcy5kZWx0YShpKS5tdWx0aXBseVNjYWxhcihzKS5hZGQodGhpcy5zdGFydCl9YXBwbHlNYXRyaXg0KHQpe3JldHVybiB0aGlzLnN0YXJ0LmFwcGx5TWF0cml4NCh0KSx0aGlzLmVuZC5hcHBseU1hdHJpeDQodCksdGhpc31lcXVhbHModCl7cmV0dXJuIHQuc3RhcnQuZXF1YWxzKHRoaXMuc3RhcnQpJiZ0LmVuZC5lcXVhbHModGhpcy5lbmQpfWNsb25lKCl7cmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSh0aGlzKX19dHlwZW9mIF9fVEhSRUVfREVWVE9PTFNfXzwidSImJl9fVEhSRUVfREVWVE9PTFNfXy5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgicmVnaXN0ZXIiLHtkZXRhaWw6e3JldmlzaW9uOldlfX0pKSx0eXBlb2Ygd2luZG93PCJ1IiYmKHdpbmRvdy5fX1RIUkVFX18/Y29uc29sZS53YXJuKCJXQVJOSU5HOiBNdWx0aXBsZSBpbnN0YW5jZXMgb2YgVGhyZWUuanMgYmVpbmcgaW1wb3J0ZWQuIEV4aXN0aW5nOiAiK3dpbmRvdy5fX1RIUkVFX18rIiwgbmV3OiAiK1dlKTp3aW5kb3cuX19USFJFRV9fPVdlKTtjb25zdCBxaT0wLFRzPTEsUHM9Mix2aT0yLHJpPTEuMjUsV2k9MSxzZT02KjQrNCs0LF9lPTY1NTM1LENzPU1hdGgucG93KDIsLTI0KSxvaT1TeW1ib2woIlNLSVBfR0VORVJBVElPTiIpO2Z1bmN0aW9uIEVzKHUpe3JldHVybiB1LmluZGV4P3UuaW5kZXguY291bnQ6dS5hdHRyaWJ1dGVzLnBvc2l0aW9uLmNvdW50fWZ1bmN0aW9uIE50KHUpe3JldHVybiBFcyh1KS8zfWZ1bmN0aW9uIEZzKHUsdD1BcnJheUJ1ZmZlcil7cmV0dXJuIHU+NjU1MzU/bmV3IFVpbnQzMkFycmF5KG5ldyB0KDQqdSkpOm5ldyBVaW50MTZBcnJheShuZXcgdCgyKnUpKX1mdW5jdGlvbiBVcyh1LHQpe2lmKCF1LmluZGV4KXtjb25zdCBlPXUuYXR0cmlidXRlcy5wb3NpdGlvbi5jb3VudCxpPXQudXNlU2hhcmVkQXJyYXlCdWZmZXI/U2hhcmVkQXJyYXlCdWZmZXI6QXJyYXlCdWZmZXIscz1GcyhlLGkpO3Uuc2V0SW5kZXgobmV3IGN0KHMsMSkpO2ZvcihsZXQgbj0wO248ZTtuKyspc1tuXT1ufX1mdW5jdGlvbiBYaSh1KXtjb25zdCB0PU50KHUpLGU9dS5kcmF3UmFuZ2UsaT1lLnN0YXJ0LzMscz0oZS5zdGFydCtlLmNvdW50KS8zLG49TWF0aC5tYXgoMCxpKSxyPU1hdGgubWluKHQscyktbjtyZXR1cm5be29mZnNldDpNYXRoLmZsb29yKG4pLGNvdW50Ok1hdGguZmxvb3Iocil9XX1mdW5jdGlvbiBPaSh1KXtpZighdS5ncm91cHN8fCF1Lmdyb3Vwcy5sZW5ndGgpcmV0dXJuIFhpKHUpO2NvbnN0IHQ9W10sZT1uZXcgU2V0LGk9dS5kcmF3UmFuZ2Uscz1pLnN0YXJ0LzMsbj0oaS5zdGFydCtpLmNvdW50KS8zO2Zvcihjb25zdCBhIG9mIHUuZ3JvdXBzKXtjb25zdCBvPWEuc3RhcnQvMyxoPShhLnN0YXJ0K2EuY291bnQpLzM7ZS5hZGQoTWF0aC5tYXgocyxvKSksZS5hZGQoTWF0aC5taW4obixoKSl9Y29uc3Qgcj1BcnJheS5mcm9tKGUudmFsdWVzKCkpLnNvcnQoKGEsbyk9PmEtbyk7Zm9yKGxldCBhPTA7YTxyLmxlbmd0aC0xO2ErKyl7Y29uc3Qgbz1yW2FdLGg9clthKzFdO3QucHVzaCh7b2Zmc2V0Ok1hdGguZmxvb3IobyksY291bnQ6TWF0aC5mbG9vcihoLW8pfSl9cmV0dXJuIHR9ZnVuY3Rpb24gUnModSl7aWYodS5ncm91cHMubGVuZ3RoPT09MClyZXR1cm4hMTtjb25zdCB0PU50KHUpLGU9T2kodSkuc29ydCgobixyKT0+bi5vZmZzZXQtci5vZmZzZXQpLGk9ZVtlLmxlbmd0aC0xXTtpLmNvdW50PU1hdGgubWluKHQtaS5vZmZzZXQsaS5jb3VudCk7bGV0IHM9MDtyZXR1cm4gZS5mb3JFYWNoKCh7Y291bnQ6bn0pPT5zKz1uKSx0IT09c31mdW5jdGlvbiBhaSh1LHQsZSxpLHMpe2xldCBuPTEvMCxyPTEvMCxhPTEvMCxvPS0xLzAsaD0tMS8wLGM9LTEvMCxmPTEvMCxsPTEvMCxkPTEvMCxwPS0xLzAseT0tMS8wLHg9LTEvMDtmb3IobGV0IG09dCo2LGc9KHQrZSkqNjttPGc7bSs9Nil7Y29uc3Qgdz11W20rMF0sTT11W20rMV0sYj13LU0sej13K007YjxuJiYobj1iKSx6Pm8mJihvPXopLHc8ZiYmKGY9dyksdz5wJiYocD13KTtjb25zdCBfPXVbbSsyXSxTPXVbbSszXSxCPV8tUyxUPV8rUztCPHImJihyPUIpLFQ+aCYmKGg9VCksXzxsJiYobD1fKSxfPnkmJih5PV8pO2NvbnN0IEM9dVttKzRdLFA9dVttKzVdLEU9Qy1QLEY9QytQO0U8YSYmKGE9RSksRj5jJiYoYz1GKSxDPGQmJihkPUMpLEM+eCYmKHg9Qyl9aVswXT1uLGlbMV09cixpWzJdPWEsaVszXT1vLGlbNF09aCxpWzVdPWMsc1swXT1mLHNbMV09bCxzWzJdPWQsc1szXT1wLHNbNF09eSxzWzVdPXh9ZnVuY3Rpb24ga3ModSx0PW51bGwsZT1udWxsLGk9bnVsbCl7Y29uc3Qgcz11LmF0dHJpYnV0ZXMucG9zaXRpb24sbj11LmluZGV4P3UuaW5kZXguYXJyYXk6bnVsbCxyPU50KHUpLGE9cy5ub3JtYWxpemVkO2xldCBvO3Q9PT1udWxsPyhvPW5ldyBGbG9hdDMyQXJyYXkocio2KjQpLGU9MCxpPXIpOihvPXQsZT1lfHwwLGk9aXx8cik7Y29uc3QgaD1zLmFycmF5LGM9cy5vZmZzZXR8fDA7bGV0IGY9MztzLmlzSW50ZXJsZWF2ZWRCdWZmZXJBdHRyaWJ1dGUmJihmPXMuZGF0YS5zdHJpZGUpO2NvbnN0IGw9WyJnZXRYIiwiZ2V0WSIsImdldFoiXTtmb3IobGV0IGQ9ZTtkPGUraTtkKyspe2NvbnN0IHA9ZCozLHk9ZCo2O2xldCB4PXArMCxtPXArMSxnPXArMjtuJiYoeD1uW3hdLG09blttXSxnPW5bZ10pLGF8fCh4PXgqZitjLG09bSpmK2MsZz1nKmYrYyk7Zm9yKGxldCB3PTA7dzwzO3crKyl7bGV0IE0sYix6O2E/KE09c1tsW3ddXSh4KSxiPXNbbFt3XV0obSksej1zW2xbd11dKGcpKTooTT1oW3grd10sYj1oW20rd10sej1oW2crd10pO2xldCBfPU07YjxfJiYoXz1iKSx6PF8mJihfPXopO2xldCBTPU07Yj5TJiYoUz1iKSx6PlMmJihTPXopO2NvbnN0IEI9KFMtXykvMixUPXcqMjtvW3krVCswXT1fK0Isb1t5K1QrMV09QisoTWF0aC5hYnMoXykrQikqQ3N9fXJldHVybiBvfWZ1bmN0aW9uIEwodSx0LGUpe3JldHVybiBlLm1pbi54PXRbdV0sZS5taW4ueT10W3UrMV0sZS5taW4uej10W3UrMl0sZS5tYXgueD10W3UrM10sZS5tYXgueT10W3UrNF0sZS5tYXguej10W3UrNV0sZX1mdW5jdGlvbiBZaSh1KXtsZXQgdD0tMSxlPS0xLzA7Zm9yKGxldCBpPTA7aTwzO2krKyl7Y29uc3Qgcz11W2krM10tdVtpXTtzPmUmJihlPXMsdD1pKX1yZXR1cm4gdH1mdW5jdGlvbiBaaSh1LHQpe3Quc2V0KHUpfWZ1bmN0aW9uIEhpKHUsdCxlKXtsZXQgaSxzO2ZvcihsZXQgbj0wO248MztuKyspe2NvbnN0IHI9biszO2k9dVtuXSxzPXRbbl0sZVtuXT1pPHM/aTpzLGk9dVtyXSxzPXRbcl0sZVtyXT1pPnM/aTpzfX1mdW5jdGlvbiBNZSh1LHQsZSl7Zm9yKGxldCBpPTA7aTwzO2krKyl7Y29uc3Qgcz10W3UrMippXSxuPXRbdSsyKmkrMV0scj1zLW4sYT1zK247cjxlW2ldJiYoZVtpXT1yKSxhPmVbaSszXSYmKGVbaSszXT1hKX19ZnVuY3Rpb24gbmUodSl7Y29uc3QgdD11WzNdLXVbMF0sZT11WzRdLXVbMV0saT11WzVdLXVbMl07cmV0dXJuIDIqKHQqZStlKmkraSp0KX1jb25zdCB5dD0zMixMcz0odSx0KT0+dS5jYW5kaWRhdGUtdC5jYW5kaWRhdGUsQXQ9bmV3IEFycmF5KHl0KS5maWxsKCkubWFwKCgpPT4oe2NvdW50OjAsYm91bmRzOm5ldyBGbG9hdDMyQXJyYXkoNikscmlnaHRDYWNoZUJvdW5kczpuZXcgRmxvYXQzMkFycmF5KDYpLGxlZnRDYWNoZUJvdW5kczpuZXcgRmxvYXQzMkFycmF5KDYpLGNhbmRpZGF0ZTowfSkpLEFlPW5ldyBGbG9hdDMyQXJyYXkoNik7ZnVuY3Rpb24gSXModSx0LGUsaSxzLG4pe2xldCByPS0xLGE9MDtpZihuPT09cWkpcj1ZaSh0KSxyIT09LTEmJihhPSh0W3JdK3RbciszXSkvMik7ZWxzZSBpZihuPT09VHMpcj1ZaSh1KSxyIT09LTEmJihhPURzKGUsaSxzLHIpKTtlbHNlIGlmKG49PT1Qcyl7Y29uc3Qgbz1uZSh1KTtsZXQgaD1yaSpzO2NvbnN0IGM9aSo2LGY9KGkrcykqNjtmb3IobGV0IGw9MDtsPDM7bCsrKXtjb25zdCBkPXRbbF0seD0odFtsKzNdLWQpL3l0O2lmKHM8eXQvNCl7Y29uc3QgbT1bLi4uQXRdO20ubGVuZ3RoPXM7bGV0IGc9MDtmb3IobGV0IE09YztNPGY7TSs9NixnKyspe2NvbnN0IGI9bVtnXTtiLmNhbmRpZGF0ZT1lW00rMipsXSxiLmNvdW50PTA7Y29uc3R7Ym91bmRzOnosbGVmdENhY2hlQm91bmRzOl8scmlnaHRDYWNoZUJvdW5kczpTfT1iO2ZvcihsZXQgQj0wO0I8MztCKyspU1tCXT0xLzAsU1tCKzNdPS0xLzAsX1tCXT0xLzAsX1tCKzNdPS0xLzAseltCXT0xLzAseltCKzNdPS0xLzA7TWUoTSxlLHopfW0uc29ydChMcyk7bGV0IHc9cztmb3IobGV0IE09MDtNPHc7TSsrKXtjb25zdCBiPW1bTV07Zm9yKDtNKzE8dyYmbVtNKzFdLmNhbmRpZGF0ZT09PWIuY2FuZGlkYXRlOyltLnNwbGljZShNKzEsMSksdy0tfWZvcihsZXQgTT1jO008ZjtNKz02KXtjb25zdCBiPWVbTSsyKmxdO2ZvcihsZXQgej0wO3o8dzt6Kyspe2NvbnN0IF89bVt6XTtiPj1fLmNhbmRpZGF0ZT9NZShNLGUsXy5yaWdodENhY2hlQm91bmRzKTooTWUoTSxlLF8ubGVmdENhY2hlQm91bmRzKSxfLmNvdW50KyspfX1mb3IobGV0IE09MDtNPHc7TSsrKXtjb25zdCBiPW1bTV0sej1iLmNvdW50LF89cy1iLmNvdW50LFM9Yi5sZWZ0Q2FjaGVCb3VuZHMsQj1iLnJpZ2h0Q2FjaGVCb3VuZHM7bGV0IFQ9MDt6IT09MCYmKFQ9bmUoUykvbyk7bGV0IEM9MDtfIT09MCYmKEM9bmUoQikvbyk7Y29uc3QgUD1XaStyaSooVCp6K0MqXyk7UDxoJiYocj1sLGg9UCxhPWIuY2FuZGlkYXRlKX19ZWxzZXtmb3IobGV0IHc9MDt3PHl0O3crKyl7Y29uc3QgTT1BdFt3XTtNLmNvdW50PTAsTS5jYW5kaWRhdGU9ZCt4K3cqeDtjb25zdCBiPU0uYm91bmRzO2ZvcihsZXQgej0wO3o8Mzt6KyspYlt6XT0xLzAsYlt6KzNdPS0xLzB9Zm9yKGxldCB3PWM7dzxmO3crPTYpe2xldCB6PX5+KChlW3crMipsXS1kKS94KTt6Pj15dCYmKHo9eXQtMSk7Y29uc3QgXz1BdFt6XTtfLmNvdW50KyssTWUodyxlLF8uYm91bmRzKX1jb25zdCBtPUF0W3l0LTFdO1ppKG0uYm91bmRzLG0ucmlnaHRDYWNoZUJvdW5kcyk7Zm9yKGxldCB3PXl0LTI7dz49MDt3LS0pe2NvbnN0IE09QXRbd10sYj1BdFt3KzFdO0hpKE0uYm91bmRzLGIucmlnaHRDYWNoZUJvdW5kcyxNLnJpZ2h0Q2FjaGVCb3VuZHMpfWxldCBnPTA7Zm9yKGxldCB3PTA7dzx5dC0xO3crKyl7Y29uc3QgTT1BdFt3XSxiPU0uY291bnQsej1NLmJvdW5kcyxTPUF0W3crMV0ucmlnaHRDYWNoZUJvdW5kcztiIT09MCYmKGc9PT0wP1ppKHosQWUpOkhpKHosQWUsQWUpKSxnKz1iO2xldCBCPTAsVD0wO2chPT0wJiYoQj1uZShBZSkvbyk7Y29uc3QgQz1zLWc7QyE9PTAmJihUPW5lKFMpL28pO2NvbnN0IFA9V2krcmkqKEIqZytUKkMpO1A8aCYmKHI9bCxoPVAsYT1NLmNhbmRpZGF0ZSl9fX19ZWxzZSBjb25zb2xlLndhcm4oYE1lc2hCVkg6IEludmFsaWQgYnVpbGQgc3RyYXRlZ3kgdmFsdWUgJHtufSB1c2VkLmApO3JldHVybntheGlzOnIscG9zOmF9fWZ1bmN0aW9uIERzKHUsdCxlLGkpe2xldCBzPTA7Zm9yKGxldCBuPXQscj10K2U7bjxyO24rKylzKz11W24qNitpKjJdO3JldHVybiBzL2V9Y2xhc3MgY2l7Y29uc3RydWN0b3IoKXt0aGlzLmJvdW5kaW5nRGF0YT1uZXcgRmxvYXQzMkFycmF5KDYpfX1mdW5jdGlvbiBWcyh1LHQsZSxpLHMsbil7bGV0IHI9aSxhPWkrcy0xO2NvbnN0IG89bi5wb3MsaD1uLmF4aXMqMjtmb3IoOzspe2Zvcig7cjw9YSYmZVtyKjYraF08bzspcisrO2Zvcig7cjw9YSYmZVthKjYraF0+PW87KWEtLTtpZihyPGEpe2ZvcihsZXQgYz0wO2M8MztjKyspe2xldCBmPXRbciozK2NdO3RbciozK2NdPXRbYSozK2NdLHRbYSozK2NdPWZ9Zm9yKGxldCBjPTA7Yzw2O2MrKyl7bGV0IGY9ZVtyKjYrY107ZVtyKjYrY109ZVthKjYrY10sZVthKjYrY109Zn1yKyssYS0tfWVsc2UgcmV0dXJuIHJ9fWZ1bmN0aW9uIE5zKHUsdCxlLGkscyxuKXtsZXQgcj1pLGE9aStzLTE7Y29uc3Qgbz1uLnBvcyxoPW4uYXhpcyoyO2Zvcig7Oyl7Zm9yKDtyPD1hJiZlW3IqNitoXTxvOylyKys7Zm9yKDtyPD1hJiZlW2EqNitoXT49bzspYS0tO2lmKHI8YSl7bGV0IGM9dVtyXTt1W3JdPXVbYV0sdVthXT1jO2ZvcihsZXQgZj0wO2Y8NjtmKyspe2xldCBsPWVbcio2K2ZdO2Vbcio2K2ZdPWVbYSo2K2ZdLGVbYSo2K2ZdPWx9cisrLGEtLX1lbHNlIHJldHVybiByfX1mdW5jdGlvbiBZKHUsdCl7cmV0dXJuIHRbdSsxNV09PT02NTUzNX1mdW5jdGlvbiAkKHUsdCl7cmV0dXJuIHRbdSs2XX1mdW5jdGlvbiBKKHUsdCl7cmV0dXJuIHRbdSsxNF19ZnVuY3Rpb24gUSh1KXtyZXR1cm4gdSs4fWZ1bmN0aW9uIEsodSx0KXtyZXR1cm4gdFt1KzZdfWZ1bmN0aW9uICRpKHUsdCl7cmV0dXJuIHRbdSs3XX1mdW5jdGlvbiBKbih1KXtyZXR1cm4gdX1sZXQgamkscmUsemUsR2k7Y29uc3QgcXM9TWF0aC5wb3coMiwzMik7ZnVuY3Rpb24gaGkodSl7cmV0dXJuImNvdW50ImluIHU/MToxK2hpKHUubGVmdCkraGkodS5yaWdodCl9ZnVuY3Rpb24gdnModSx0LGUpe3JldHVybiBqaT1uZXcgRmxvYXQzMkFycmF5KGUpLHJlPW5ldyBVaW50MzJBcnJheShlKSx6ZT1uZXcgVWludDE2QXJyYXkoZSksR2k9bmV3IFVpbnQ4QXJyYXkoZSksbGkodSx0KX1mdW5jdGlvbiBsaSh1LHQpe2NvbnN0IGU9dS80LGk9dS8yLHM9ImNvdW50ImluIHQsbj10LmJvdW5kaW5nRGF0YTtmb3IobGV0IHI9MDtyPDY7cisrKWppW2Urcl09bltyXTtpZihzKWlmKHQuYnVmZmVyKXtjb25zdCByPXQuYnVmZmVyO0dpLnNldChuZXcgVWludDhBcnJheShyKSx1KTtmb3IobGV0IGE9dSxvPXUrci5ieXRlTGVuZ3RoO2E8bzthKz1zZSl7Y29uc3QgaD1hLzI7WShoLHplKXx8KHJlW2EvNCs2XSs9ZSl9cmV0dXJuIHUrci5ieXRlTGVuZ3RofWVsc2V7Y29uc3Qgcj10Lm9mZnNldCxhPXQuY291bnQ7cmV0dXJuIHJlW2UrNl09cix6ZVtpKzE0XT1hLHplW2krMTVdPV9lLHUrc2V9ZWxzZXtjb25zdCByPXQubGVmdCxhPXQucmlnaHQsbz10LnNwbGl0QXhpcztsZXQgaDtpZihoPWxpKHUrc2UsciksaC80PnFzKXRocm93IG5ldyBFcnJvcigiTWVzaEJWSDogQ2Fubm90IHN0b3JlIGNoaWxkIHBvaW50ZXIgZ3JlYXRlciB0aGFuIDMyIGJpdHMuIik7cmV0dXJuIHJlW2UrNl09aC80LGg9bGkoaCxhKSxyZVtlKzddPW8saH19ZnVuY3Rpb24gV3ModSx0KXtjb25zdCBlPSh1LmluZGV4P3UuaW5kZXguY291bnQ6dS5hdHRyaWJ1dGVzLnBvc2l0aW9uLmNvdW50KS8zLGk9ZT4yKioxNixzPWk/NDoyLG49dD9uZXcgU2hhcmVkQXJyYXlCdWZmZXIoZSpzKTpuZXcgQXJyYXlCdWZmZXIoZSpzKSxyPWk/bmV3IFVpbnQzMkFycmF5KG4pOm5ldyBVaW50MTZBcnJheShuKTtmb3IobGV0IGE9MCxvPXIubGVuZ3RoO2E8bzthKyspclthXT1hO3JldHVybiByfWZ1bmN0aW9uIFhzKHUsdCxlLGkscyl7Y29uc3R7bWF4RGVwdGg6bix2ZXJib3NlOnIsbWF4TGVhZlRyaXM6YSxzdHJhdGVneTpvLG9uUHJvZ3Jlc3M6aCxpbmRpcmVjdDpjfT1zLGY9dS5faW5kaXJlY3RCdWZmZXIsbD11Lmdlb21ldHJ5LGQ9bC5pbmRleD9sLmluZGV4LmFycmF5Om51bGwscD1jP05zOlZzLHk9TnQobCkseD1uZXcgRmxvYXQzMkFycmF5KDYpO2xldCBtPSExO2NvbnN0IGc9bmV3IGNpO3JldHVybiBhaSh0LGUsaSxnLmJvdW5kaW5nRGF0YSx4KSxNKGcsZSxpLHgpLGc7ZnVuY3Rpb24gdyhiKXtoJiZoKGIveSl9ZnVuY3Rpb24gTShiLHosXyxTPW51bGwsQj0wKXtpZighbSYmQj49biYmKG09ITAsciYmKGNvbnNvbGUud2FybihgTWVzaEJWSDogTWF4IGRlcHRoIG9mICR7bn0gcmVhY2hlZCB3aGVuIGdlbmVyYXRpbmcgQlZILiBDb25zaWRlciBpbmNyZWFzaW5nIG1heERlcHRoLmApLGNvbnNvbGUud2FybihsKSkpLF88PWF8fEI+PW4pcmV0dXJuIHcoeitfKSxiLm9mZnNldD16LGIuY291bnQ9XyxiO2NvbnN0IFQ9SXMoYi5ib3VuZGluZ0RhdGEsUyx0LHosXyxvKTtpZihULmF4aXM9PT0tMSlyZXR1cm4gdyh6K18pLGIub2Zmc2V0PXosYi5jb3VudD1fLGI7Y29uc3QgQz1wKGYsZCx0LHosXyxUKTtpZihDPT09enx8Qz09PXorXyl3KHorXyksYi5vZmZzZXQ9eixiLmNvdW50PV87ZWxzZXtiLnNwbGl0QXhpcz1ULmF4aXM7Y29uc3QgUD1uZXcgY2ksRT16LEY9Qy16O2IubGVmdD1QLGFpKHQsRSxGLFAuYm91bmRpbmdEYXRhLHgpLE0oUCxFLEYseCxCKzEpO2NvbnN0IFU9bmV3IGNpLFI9QyxqPV8tRjtiLnJpZ2h0PVUsYWkodCxSLGosVS5ib3VuZGluZ0RhdGEseCksTShVLFIsaix4LEIrMSl9cmV0dXJuIGJ9fWZ1bmN0aW9uIE9zKHUsdCl7Y29uc3QgZT11Lmdlb21ldHJ5O3QuaW5kaXJlY3QmJih1Ll9pbmRpcmVjdEJ1ZmZlcj1XcyhlLHQudXNlU2hhcmVkQXJyYXlCdWZmZXIpLFJzKGUpJiYhdC52ZXJib3NlJiZjb25zb2xlLndhcm4oJ01lc2hCVkg6IFByb3ZpZGVkIGdlb21ldHJ5IGNvbnRhaW5zIGdyb3VwcyB0aGF0IGRvIG5vdCBmdWxseSBzcGFuIHRoZSB2ZXJ0ZXggY29udGVudHMgd2hpbGUgdXNpbmcgdGhlICJpbmRpcmVjdCIgb3B0aW9uLiBCVkggbWF5IGluY29ycmVjdGx5IHJlcG9ydCBpbnRlcnNlY3Rpb25zIG9uIHVucmVuZGVyZWQgcG9ydGlvbnMgb2YgdGhlIGdlb21ldHJ5LicpKSx1Ll9pbmRpcmVjdEJ1ZmZlcnx8VXMoZSx0KTtjb25zdCBpPXQudXNlU2hhcmVkQXJyYXlCdWZmZXI/U2hhcmVkQXJyYXlCdWZmZXI6QXJyYXlCdWZmZXIscz1rcyhlKSxuPXQuaW5kaXJlY3Q/WGkoZSk6T2koZSk7dS5fcm9vdHM9bi5tYXAocj0+e2NvbnN0IGE9WHModSxzLHIub2Zmc2V0LHIuY291bnQsdCksbz1oaShhKSxoPW5ldyBpKHNlKm8pO3JldHVybiB2cygwLGEsaCksaH0pfWNsYXNzIHh0e2NvbnN0cnVjdG9yKCl7dGhpcy5taW49MS8wLHRoaXMubWF4PS0xLzB9c2V0RnJvbVBvaW50c0ZpZWxkKHQsZSl7bGV0IGk9MS8wLHM9LTEvMDtmb3IobGV0IG49MCxyPXQubGVuZ3RoO248cjtuKyspe2NvbnN0IG89dFtuXVtlXTtpPW88aT9vOmkscz1vPnM/bzpzfXRoaXMubWluPWksdGhpcy5tYXg9c31zZXRGcm9tUG9pbnRzKHQsZSl7bGV0IGk9MS8wLHM9LTEvMDtmb3IobGV0IG49MCxyPWUubGVuZ3RoO248cjtuKyspe2NvbnN0IGE9ZVtuXSxvPXQuZG90KGEpO2k9bzxpP286aSxzPW8+cz9vOnN9dGhpcy5taW49aSx0aGlzLm1heD1zfWlzU2VwYXJhdGVkKHQpe3JldHVybiB0aGlzLm1pbj50Lm1heHx8dC5taW4+dGhpcy5tYXh9fXh0LnByb3RvdHlwZS5zZXRGcm9tQm94PWZ1bmN0aW9uKCl7Y29uc3QgdT1uZXcgQTtyZXR1cm4gZnVuY3Rpb24oZSxpKXtjb25zdCBzPWkubWluLG49aS5tYXg7bGV0IHI9MS8wLGE9LTEvMDtmb3IobGV0IG89MDtvPD0xO28rKylmb3IobGV0IGg9MDtoPD0xO2grKylmb3IobGV0IGM9MDtjPD0xO2MrKyl7dS54PXMueCpvK24ueCooMS1vKSx1Lnk9cy55Kmgrbi55KigxLWgpLHUuej1zLnoqYytuLnoqKDEtYyk7Y29uc3QgZj1lLmRvdCh1KTtyPU1hdGgubWluKGYsciksYT1NYXRoLm1heChmLGEpfXRoaXMubWluPXIsdGhpcy5tYXg9YX19KCk7Y29uc3QgWXM9ZnVuY3Rpb24oKXtjb25zdCB1PW5ldyBBLHQ9bmV3IEEsZT1uZXcgQTtyZXR1cm4gZnVuY3Rpb24ocyxuLHIpe2NvbnN0IGE9cy5zdGFydCxvPXUsaD1uLnN0YXJ0LGM9dDtlLnN1YlZlY3RvcnMoYSxoKSx1LnN1YlZlY3RvcnMocy5lbmQscy5zdGFydCksdC5zdWJWZWN0b3JzKG4uZW5kLG4uc3RhcnQpO2NvbnN0IGY9ZS5kb3QoYyksbD1jLmRvdChvKSxkPWMuZG90KGMpLHA9ZS5kb3QobykseD1vLmRvdChvKSpkLWwqbDtsZXQgbSxnO3ghPT0wP209KGYqbC1wKmQpL3g6bT0wLGc9KGYrbSpsKS9kLHIueD1tLHIueT1nfX0oKSx1aT1mdW5jdGlvbigpe2NvbnN0IHU9bmV3IHYsdD1uZXcgQSxlPW5ldyBBO3JldHVybiBmdW5jdGlvbihzLG4scixhKXtZcyhzLG4sdSk7bGV0IG89dS54LGg9dS55O2lmKG8+PTAmJm88PTEmJmg+PTAmJmg8PTEpe3MuYXQobyxyKSxuLmF0KGgsYSk7cmV0dXJufWVsc2UgaWYobz49MCYmbzw9MSl7aDwwP24uYXQoMCxhKTpuLmF0KDEsYSkscy5jbG9zZXN0UG9pbnRUb1BvaW50KGEsITAscik7cmV0dXJufWVsc2UgaWYoaD49MCYmaDw9MSl7bzwwP3MuYXQoMCxyKTpzLmF0KDEsciksbi5jbG9zZXN0UG9pbnRUb1BvaW50KHIsITAsYSk7cmV0dXJufWVsc2V7bGV0IGM7bzwwP2M9cy5zdGFydDpjPXMuZW5kO2xldCBmO2g8MD9mPW4uc3RhcnQ6Zj1uLmVuZDtjb25zdCBsPXQsZD1lO2lmKHMuY2xvc2VzdFBvaW50VG9Qb2ludChmLCEwLHQpLG4uY2xvc2VzdFBvaW50VG9Qb2ludChjLCEwLGUpLGwuZGlzdGFuY2VUb1NxdWFyZWQoZik8PWQuZGlzdGFuY2VUb1NxdWFyZWQoYykpe3IuY29weShsKSxhLmNvcHkoZik7cmV0dXJufWVsc2V7ci5jb3B5KGMpLGEuY29weShkKTtyZXR1cm59fX19KCksWnM9ZnVuY3Rpb24oKXtjb25zdCB1PW5ldyBBLHQ9bmV3IEEsZT1uZXcgVmksaT1uZXcgbXQ7cmV0dXJuIGZ1bmN0aW9uKG4scil7Y29uc3R7cmFkaXVzOmEsY2VudGVyOm99PW4se2E6aCxiOmMsYzpmfT1yO2lmKGkuc3RhcnQ9aCxpLmVuZD1jLGkuY2xvc2VzdFBvaW50VG9Qb2ludChvLCEwLHUpLmRpc3RhbmNlVG8obyk8PWF8fChpLnN0YXJ0PWgsaS5lbmQ9ZixpLmNsb3Nlc3RQb2ludFRvUG9pbnQobywhMCx1KS5kaXN0YW5jZVRvKG8pPD1hKXx8KGkuc3RhcnQ9YyxpLmVuZD1mLGkuY2xvc2VzdFBvaW50VG9Qb2ludChvLCEwLHUpLmRpc3RhbmNlVG8obyk8PWEpKXJldHVybiEwO2NvbnN0IHk9ci5nZXRQbGFuZShlKTtpZihNYXRoLmFicyh5LmRpc3RhbmNlVG9Qb2ludChvKSk8PWEpe2NvbnN0IG09eS5wcm9qZWN0UG9pbnQobyx0KTtpZihyLmNvbnRhaW5zUG9pbnQobSkpcmV0dXJuITB9cmV0dXJuITF9fSgpLEhzPTFlLTE1O2Z1bmN0aW9uIGZpKHUpe3JldHVybiBNYXRoLmFicyh1KTxIc31jbGFzcyBydCBleHRlbmRzIG50e2NvbnN0cnVjdG9yKC4uLnQpe3N1cGVyKC4uLnQpLHRoaXMuaXNFeHRlbmRlZFRyaWFuZ2xlPSEwLHRoaXMuc2F0QXhlcz1uZXcgQXJyYXkoNCkuZmlsbCgpLm1hcCgoKT0+bmV3IEEpLHRoaXMuc2F0Qm91bmRzPW5ldyBBcnJheSg0KS5maWxsKCkubWFwKCgpPT5uZXcgeHQpLHRoaXMucG9pbnRzPVt0aGlzLmEsdGhpcy5iLHRoaXMuY10sdGhpcy5zcGhlcmU9bmV3IEVpLHRoaXMucGxhbmU9bmV3IFZpLHRoaXMubmVlZHNVcGRhdGU9ITB9aW50ZXJzZWN0c1NwaGVyZSh0KXtyZXR1cm4gWnModCx0aGlzKX11cGRhdGUoKXtjb25zdCB0PXRoaXMuYSxlPXRoaXMuYixpPXRoaXMuYyxzPXRoaXMucG9pbnRzLG49dGhpcy5zYXRBeGVzLHI9dGhpcy5zYXRCb3VuZHMsYT1uWzBdLG89clswXTt0aGlzLmdldE5vcm1hbChhKSxvLnNldEZyb21Qb2ludHMoYSxzKTtjb25zdCBoPW5bMV0sYz1yWzFdO2guc3ViVmVjdG9ycyh0LGUpLGMuc2V0RnJvbVBvaW50cyhoLHMpO2NvbnN0IGY9blsyXSxsPXJbMl07Zi5zdWJWZWN0b3JzKGUsaSksbC5zZXRGcm9tUG9pbnRzKGYscyk7Y29uc3QgZD1uWzNdLHA9clszXTtkLnN1YlZlY3RvcnMoaSx0KSxwLnNldEZyb21Qb2ludHMoZCxzKSx0aGlzLnNwaGVyZS5zZXRGcm9tUG9pbnRzKHRoaXMucG9pbnRzKSx0aGlzLnBsYW5lLnNldEZyb21Ob3JtYWxBbmRDb3BsYW5hclBvaW50KGEsdCksdGhpcy5uZWVkc1VwZGF0ZT0hMX19cnQucHJvdG90eXBlLmNsb3Nlc3RQb2ludFRvU2VnbWVudD1mdW5jdGlvbigpe2NvbnN0IHU9bmV3IEEsdD1uZXcgQSxlPW5ldyBtdDtyZXR1cm4gZnVuY3Rpb24ocyxuPW51bGwscj1udWxsKXtjb25zdHtzdGFydDphLGVuZDpvfT1zLGg9dGhpcy5wb2ludHM7bGV0IGMsZj0xLzA7Zm9yKGxldCBsPTA7bDwzO2wrKyl7Y29uc3QgZD0obCsxKSUzO2Uuc3RhcnQuY29weShoW2xdKSxlLmVuZC5jb3B5KGhbZF0pLHVpKGUscyx1LHQpLGM9dS5kaXN0YW5jZVRvU3F1YXJlZCh0KSxjPGYmJihmPWMsbiYmbi5jb3B5KHUpLHImJnIuY29weSh0KSl9cmV0dXJuIHRoaXMuY2xvc2VzdFBvaW50VG9Qb2ludChhLHUpLGM9YS5kaXN0YW5jZVRvU3F1YXJlZCh1KSxjPGYmJihmPWMsbiYmbi5jb3B5KHUpLHImJnIuY29weShhKSksdGhpcy5jbG9zZXN0UG9pbnRUb1BvaW50KG8sdSksYz1vLmRpc3RhbmNlVG9TcXVhcmVkKHUpLGM8ZiYmKGY9YyxuJiZuLmNvcHkodSksciYmci5jb3B5KG8pKSxNYXRoLnNxcnQoZil9fSgpLHJ0LnByb3RvdHlwZS5pbnRlcnNlY3RzVHJpYW5nbGU9ZnVuY3Rpb24oKXtjb25zdCB1PW5ldyBydCx0PW5ldyBBcnJheSgzKSxlPW5ldyBBcnJheSgzKSxpPW5ldyB4dCxzPW5ldyB4dCxuPW5ldyBBLHI9bmV3IEEsYT1uZXcgQSxvPW5ldyBBLGg9bmV3IEEsYz1uZXcgbXQsZj1uZXcgbXQsbD1uZXcgbXQsZD1uZXcgQTtmdW5jdGlvbiBwKHkseCxtKXtjb25zdCBnPXkucG9pbnRzO2xldCB3PTAsTT0tMTtmb3IobGV0IGI9MDtiPDM7YisrKXtjb25zdHtzdGFydDp6LGVuZDpffT1jO3ouY29weShnW2JdKSxfLmNvcHkoZ1soYisxKSUzXSksYy5kZWx0YShyKTtjb25zdCBTPWZpKHguZGlzdGFuY2VUb1BvaW50KHopKTtpZihmaSh4Lm5vcm1hbC5kb3QocikpJiZTKXttLmNvcHkoYyksdz0yO2JyZWFrfWNvbnN0IEI9eC5pbnRlcnNlY3RMaW5lKGMsZCk7aWYoIUImJlMmJmQuY29weSh6KSwoQnx8UykmJiFmaShkLmRpc3RhbmNlVG8oXykpKXtpZih3PD0xKSh3PT09MT9tLnN0YXJ0Om0uZW5kKS5jb3B5KGQpLFMmJihNPXcpO2Vsc2UgaWYodz49Mil7KE09PT0xP20uc3RhcnQ6bS5lbmQpLmNvcHkoZCksdz0yO2JyZWFrfWlmKHcrKyx3PT09MiYmTT09PS0xKWJyZWFrfX1yZXR1cm4gd31yZXR1cm4gZnVuY3Rpb24oeCxtPW51bGwsZz0hMSl7dGhpcy5uZWVkc1VwZGF0ZSYmdGhpcy51cGRhdGUoKSx4LmlzRXh0ZW5kZWRUcmlhbmdsZT94Lm5lZWRzVXBkYXRlJiZ4LnVwZGF0ZSgpOih1LmNvcHkoeCksdS51cGRhdGUoKSx4PXUpO2NvbnN0IHc9dGhpcy5wbGFuZSxNPXgucGxhbmU7aWYoTWF0aC5hYnMody5ub3JtYWwuZG90KE0ubm9ybWFsKSk+MS0xZS0xMCl7Y29uc3QgYj10aGlzLnNhdEJvdW5kcyx6PXRoaXMuc2F0QXhlcztlWzBdPXguYSxlWzFdPXguYixlWzJdPXguYztmb3IobGV0IEI9MDtCPDQ7QisrKXtjb25zdCBUPWJbQl0sQz16W0JdO2lmKGkuc2V0RnJvbVBvaW50cyhDLGUpLFQuaXNTZXBhcmF0ZWQoaSkpcmV0dXJuITF9Y29uc3QgXz14LnNhdEJvdW5kcyxTPXguc2F0QXhlczt0WzBdPXRoaXMuYSx0WzFdPXRoaXMuYix0WzJdPXRoaXMuYztmb3IobGV0IEI9MDtCPDQ7QisrKXtjb25zdCBUPV9bQl0sQz1TW0JdO2lmKGkuc2V0RnJvbVBvaW50cyhDLHQpLFQuaXNTZXBhcmF0ZWQoaSkpcmV0dXJuITF9Zm9yKGxldCBCPTA7Qjw0O0IrKyl7Y29uc3QgVD16W0JdO2ZvcihsZXQgQz0wO0M8NDtDKyspe2NvbnN0IFA9U1tDXTtpZihuLmNyb3NzVmVjdG9ycyhULFApLGkuc2V0RnJvbVBvaW50cyhuLHQpLHMuc2V0RnJvbVBvaW50cyhuLGUpLGkuaXNTZXBhcmF0ZWQocykpcmV0dXJuITF9fXJldHVybiBtJiYoZ3x8Y29uc29sZS53YXJuKCJFeHRlbmRlZFRyaWFuZ2xlLmludGVyc2VjdHNUcmlhbmdsZTogVHJpYW5nbGVzIGFyZSBjb3BsYW5hciB3aGljaCBkb2VzIG5vdCBzdXBwb3J0IGFuIG91dHB1dCBlZGdlLiBTZXR0aW5nIGVkZ2UgdG8gMCwgMCwgMC4iKSxtLnN0YXJ0LnNldCgwLDAsMCksbS5lbmQuc2V0KDAsMCwwKSksITB9ZWxzZXtjb25zdCBiPXAodGhpcyxNLGYpO2lmKGI9PT0xJiZ4LmNvbnRhaW5zUG9pbnQoZi5lbmQpKXJldHVybiBtJiYobS5zdGFydC5jb3B5KGYuZW5kKSxtLmVuZC5jb3B5KGYuZW5kKSksITA7aWYoYiE9PTIpcmV0dXJuITE7Y29uc3Qgej1wKHgsdyxsKTtpZih6PT09MSYmdGhpcy5jb250YWluc1BvaW50KGwuZW5kKSlyZXR1cm4gbSYmKG0uc3RhcnQuY29weShsLmVuZCksbS5lbmQuY29weShsLmVuZCkpLCEwO2lmKHohPT0yKXJldHVybiExO2lmKGYuZGVsdGEoYSksbC5kZWx0YShvKSxhLmRvdChvKTwwKXtsZXQgRT1sLnN0YXJ0O2wuc3RhcnQ9bC5lbmQsbC5lbmQ9RX1jb25zdCBfPWYuc3RhcnQuZG90KGEpLFM9Zi5lbmQuZG90KGEpLEI9bC5zdGFydC5kb3QoYSksVD1sLmVuZC5kb3QoYSksQz1TPEIsUD1fPFQ7cmV0dXJuIF8hPT1UJiZCIT09UyYmQz09PVA/ITE6KG0mJihoLnN1YlZlY3RvcnMoZi5zdGFydCxsLnN0YXJ0KSxoLmRvdChhKT4wP20uc3RhcnQuY29weShmLnN0YXJ0KTptLnN0YXJ0LmNvcHkobC5zdGFydCksaC5zdWJWZWN0b3JzKGYuZW5kLGwuZW5kKSxoLmRvdChhKTwwP20uZW5kLmNvcHkoZi5lbmQpOm0uZW5kLmNvcHkobC5lbmQpKSwhMCl9fX0oKSxydC5wcm90b3R5cGUuZGlzdGFuY2VUb1BvaW50PWZ1bmN0aW9uKCl7Y29uc3QgdT1uZXcgQTtyZXR1cm4gZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuY2xvc2VzdFBvaW50VG9Qb2ludChlLHUpLGUuZGlzdGFuY2VUbyh1KX19KCkscnQucHJvdG90eXBlLmRpc3RhbmNlVG9UcmlhbmdsZT1mdW5jdGlvbigpe2NvbnN0IHU9bmV3IEEsdD1uZXcgQSxlPVsiYSIsImIiLCJjIl0saT1uZXcgbXQscz1uZXcgbXQ7cmV0dXJuIGZ1bmN0aW9uKHIsYT1udWxsLG89bnVsbCl7Y29uc3QgaD1hfHxvP2k6bnVsbDtpZih0aGlzLmludGVyc2VjdHNUcmlhbmdsZShyLGgpKXJldHVybihhfHxvKSYmKGEmJmguZ2V0Q2VudGVyKGEpLG8mJmguZ2V0Q2VudGVyKG8pKSwwO2xldCBjPTEvMDtmb3IobGV0IGY9MDtmPDM7ZisrKXtsZXQgbDtjb25zdCBkPWVbZl0scD1yW2RdO3RoaXMuY2xvc2VzdFBvaW50VG9Qb2ludChwLHUpLGw9cC5kaXN0YW5jZVRvU3F1YXJlZCh1KSxsPGMmJihjPWwsYSYmYS5jb3B5KHUpLG8mJm8uY29weShwKSk7Y29uc3QgeT10aGlzW2RdO3IuY2xvc2VzdFBvaW50VG9Qb2ludCh5LHUpLGw9eS5kaXN0YW5jZVRvU3F1YXJlZCh1KSxsPGMmJihjPWwsYSYmYS5jb3B5KHkpLG8mJm8uY29weSh1KSl9Zm9yKGxldCBmPTA7ZjwzO2YrKyl7Y29uc3QgbD1lW2ZdLGQ9ZVsoZisxKSUzXTtpLnNldCh0aGlzW2xdLHRoaXNbZF0pO2ZvcihsZXQgcD0wO3A8MztwKyspe2NvbnN0IHk9ZVtwXSx4PWVbKHArMSklM107cy5zZXQoclt5XSxyW3hdKSx1aShpLHMsdSx0KTtjb25zdCBtPXUuZGlzdGFuY2VUb1NxdWFyZWQodCk7bTxjJiYoYz1tLGEmJmEuY29weSh1KSxvJiZvLmNvcHkodCkpfX1yZXR1cm4gTWF0aC5zcXJ0KGMpfX0oKTtjbGFzcyBYe2NvbnN0cnVjdG9yKHQsZSxpKXt0aGlzLmlzT3JpZW50ZWRCb3g9ITAsdGhpcy5taW49bmV3IEEsdGhpcy5tYXg9bmV3IEEsdGhpcy5tYXRyaXg9bmV3IE4sdGhpcy5pbnZNYXRyaXg9bmV3IE4sdGhpcy5wb2ludHM9bmV3IEFycmF5KDgpLmZpbGwoKS5tYXAoKCk9Pm5ldyBBKSx0aGlzLnNhdEF4ZXM9bmV3IEFycmF5KDMpLmZpbGwoKS5tYXAoKCk9Pm5ldyBBKSx0aGlzLnNhdEJvdW5kcz1uZXcgQXJyYXkoMykuZmlsbCgpLm1hcCgoKT0+bmV3IHh0KSx0aGlzLmFsaWduZWRTYXRCb3VuZHM9bmV3IEFycmF5KDMpLmZpbGwoKS5tYXAoKCk9Pm5ldyB4dCksdGhpcy5uZWVkc1VwZGF0ZT0hMSx0JiZ0aGlzLm1pbi5jb3B5KHQpLGUmJnRoaXMubWF4LmNvcHkoZSksaSYmdGhpcy5tYXRyaXguY29weShpKX1zZXQodCxlLGkpe3RoaXMubWluLmNvcHkodCksdGhpcy5tYXguY29weShlKSx0aGlzLm1hdHJpeC5jb3B5KGkpLHRoaXMubmVlZHNVcGRhdGU9ITB9Y29weSh0KXt0aGlzLm1pbi5jb3B5KHQubWluKSx0aGlzLm1heC5jb3B5KHQubWF4KSx0aGlzLm1hdHJpeC5jb3B5KHQubWF0cml4KSx0aGlzLm5lZWRzVXBkYXRlPSEwfX1YLnByb3RvdHlwZS51cGRhdGU9ZnVuY3Rpb24oKXtyZXR1cm4gZnVuY3Rpb24oKXtjb25zdCB0PXRoaXMubWF0cml4LGU9dGhpcy5taW4saT10aGlzLm1heCxzPXRoaXMucG9pbnRzO2ZvcihsZXQgaD0wO2g8PTE7aCsrKWZvcihsZXQgYz0wO2M8PTE7YysrKWZvcihsZXQgZj0wO2Y8PTE7ZisrKXtjb25zdCBsPTEqaHwyKmN8NCpmLGQ9c1tsXTtkLng9aD9pLng6ZS54LGQueT1jP2kueTplLnksZC56PWY/aS56OmUueixkLmFwcGx5TWF0cml4NCh0KX1jb25zdCBuPXRoaXMuc2F0Qm91bmRzLHI9dGhpcy5zYXRBeGVzLGE9c1swXTtmb3IobGV0IGg9MDtoPDM7aCsrKXtjb25zdCBjPXJbaF0sZj1uW2hdLGw9MTw8aCxkPXNbbF07Yy5zdWJWZWN0b3JzKGEsZCksZi5zZXRGcm9tUG9pbnRzKGMscyl9Y29uc3Qgbz10aGlzLmFsaWduZWRTYXRCb3VuZHM7b1swXS5zZXRGcm9tUG9pbnRzRmllbGQocywieCIpLG9bMV0uc2V0RnJvbVBvaW50c0ZpZWxkKHMsInkiKSxvWzJdLnNldEZyb21Qb2ludHNGaWVsZChzLCJ6IiksdGhpcy5pbnZNYXRyaXguY29weSh0aGlzLm1hdHJpeCkuaW52ZXJ0KCksdGhpcy5uZWVkc1VwZGF0ZT0hMX19KCksWC5wcm90b3R5cGUuaW50ZXJzZWN0c0JveD1mdW5jdGlvbigpe2NvbnN0IHU9bmV3IHh0O3JldHVybiBmdW5jdGlvbihlKXt0aGlzLm5lZWRzVXBkYXRlJiZ0aGlzLnVwZGF0ZSgpO2NvbnN0IGk9ZS5taW4scz1lLm1heCxuPXRoaXMuc2F0Qm91bmRzLHI9dGhpcy5zYXRBeGVzLGE9dGhpcy5hbGlnbmVkU2F0Qm91bmRzO2lmKHUubWluPWkueCx1Lm1heD1zLngsYVswXS5pc1NlcGFyYXRlZCh1KXx8KHUubWluPWkueSx1Lm1heD1zLnksYVsxXS5pc1NlcGFyYXRlZCh1KSl8fCh1Lm1pbj1pLnosdS5tYXg9cy56LGFbMl0uaXNTZXBhcmF0ZWQodSkpKXJldHVybiExO2ZvcihsZXQgbz0wO288MztvKyspe2NvbnN0IGg9cltvXSxjPW5bb107aWYodS5zZXRGcm9tQm94KGgsZSksYy5pc1NlcGFyYXRlZCh1KSlyZXR1cm4hMX1yZXR1cm4hMH19KCksWC5wcm90b3R5cGUuaW50ZXJzZWN0c1RyaWFuZ2xlPWZ1bmN0aW9uKCl7Y29uc3QgdT1uZXcgcnQsdD1uZXcgQXJyYXkoMyksZT1uZXcgeHQsaT1uZXcgeHQscz1uZXcgQTtyZXR1cm4gZnVuY3Rpb24ocil7dGhpcy5uZWVkc1VwZGF0ZSYmdGhpcy51cGRhdGUoKSxyLmlzRXh0ZW5kZWRUcmlhbmdsZT9yLm5lZWRzVXBkYXRlJiZyLnVwZGF0ZSgpOih1LmNvcHkociksdS51cGRhdGUoKSxyPXUpO2NvbnN0IGE9dGhpcy5zYXRCb3VuZHMsbz10aGlzLnNhdEF4ZXM7dFswXT1yLmEsdFsxXT1yLmIsdFsyXT1yLmM7Zm9yKGxldCBsPTA7bDwzO2wrKyl7Y29uc3QgZD1hW2xdLHA9b1tsXTtpZihlLnNldEZyb21Qb2ludHMocCx0KSxkLmlzU2VwYXJhdGVkKGUpKXJldHVybiExfWNvbnN0IGg9ci5zYXRCb3VuZHMsYz1yLnNhdEF4ZXMsZj10aGlzLnBvaW50cztmb3IobGV0IGw9MDtsPDM7bCsrKXtjb25zdCBkPWhbbF0scD1jW2xdO2lmKGUuc2V0RnJvbVBvaW50cyhwLGYpLGQuaXNTZXBhcmF0ZWQoZSkpcmV0dXJuITF9Zm9yKGxldCBsPTA7bDwzO2wrKyl7Y29uc3QgZD1vW2xdO2ZvcihsZXQgcD0wO3A8NDtwKyspe2NvbnN0IHk9Y1twXTtpZihzLmNyb3NzVmVjdG9ycyhkLHkpLGUuc2V0RnJvbVBvaW50cyhzLHQpLGkuc2V0RnJvbVBvaW50cyhzLGYpLGUuaXNTZXBhcmF0ZWQoaSkpcmV0dXJuITF9fXJldHVybiEwfX0oKSxYLnByb3RvdHlwZS5jbG9zZXN0UG9pbnRUb1BvaW50PWZ1bmN0aW9uKCl7cmV0dXJuIGZ1bmN0aW9uKHQsZSl7cmV0dXJuIHRoaXMubmVlZHNVcGRhdGUmJnRoaXMudXBkYXRlKCksZS5jb3B5KHQpLmFwcGx5TWF0cml4NCh0aGlzLmludk1hdHJpeCkuY2xhbXAodGhpcy5taW4sdGhpcy5tYXgpLmFwcGx5TWF0cml4NCh0aGlzLm1hdHJpeCksZX19KCksWC5wcm90b3R5cGUuZGlzdGFuY2VUb1BvaW50PWZ1bmN0aW9uKCl7Y29uc3QgdT1uZXcgQTtyZXR1cm4gZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuY2xvc2VzdFBvaW50VG9Qb2ludChlLHUpLGUuZGlzdGFuY2VUbyh1KX19KCksWC5wcm90b3R5cGUuZGlzdGFuY2VUb0JveD1mdW5jdGlvbigpe2NvbnN0IHU9WyJ4IiwieSIsInoiXSx0PW5ldyBBcnJheSgxMikuZmlsbCgpLm1hcCgoKT0+bmV3IG10KSxlPW5ldyBBcnJheSgxMikuZmlsbCgpLm1hcCgoKT0+bmV3IG10KSxpPW5ldyBBLHM9bmV3IEE7cmV0dXJuIGZ1bmN0aW9uKHIsYT0wLG89bnVsbCxoPW51bGwpe2lmKHRoaXMubmVlZHNVcGRhdGUmJnRoaXMudXBkYXRlKCksdGhpcy5pbnRlcnNlY3RzQm94KHIpKXJldHVybihvfHxoKSYmKHIuZ2V0Q2VudGVyKHMpLHRoaXMuY2xvc2VzdFBvaW50VG9Qb2ludChzLGkpLHIuY2xvc2VzdFBvaW50VG9Qb2ludChpLHMpLG8mJm8uY29weShpKSxoJiZoLmNvcHkocykpLDA7Y29uc3QgYz1hKmEsZj1yLm1pbixsPXIubWF4LGQ9dGhpcy5wb2ludHM7bGV0IHA9MS8wO2ZvcihsZXQgeD0wO3g8ODt4Kyspe2NvbnN0IG09ZFt4XTtzLmNvcHkobSkuY2xhbXAoZixsKTtjb25zdCBnPW0uZGlzdGFuY2VUb1NxdWFyZWQocyk7aWYoZzxwJiYocD1nLG8mJm8uY29weShtKSxoJiZoLmNvcHkocyksZzxjKSlyZXR1cm4gTWF0aC5zcXJ0KGcpfWxldCB5PTA7Zm9yKGxldCB4PTA7eDwzO3grKylmb3IobGV0IG09MDttPD0xO20rKylmb3IobGV0IGc9MDtnPD0xO2crKyl7Y29uc3Qgdz0oeCsxKSUzLE09KHgrMiklMyxiPW08PHd8Zzw8TSx6PTE8PHh8bTw8d3xnPDxNLF89ZFtiXSxTPWRbel07dFt5XS5zZXQoXyxTKTtjb25zdCBUPXVbeF0sQz11W3ddLFA9dVtNXSxFPWVbeV0sRj1FLnN0YXJ0LFU9RS5lbmQ7RltUXT1mW1RdLEZbQ109bT9mW0NdOmxbQ10sRltQXT1nP2ZbUF06bFtDXSxVW1RdPWxbVF0sVVtDXT1tP2ZbQ106bFtDXSxVW1BdPWc/ZltQXTpsW0NdLHkrK31mb3IobGV0IHg9MDt4PD0xO3grKylmb3IobGV0IG09MDttPD0xO20rKylmb3IobGV0IGc9MDtnPD0xO2crKyl7cy54PXg/bC54OmYueCxzLnk9bT9sLnk6Zi55LHMuej1nP2wuejpmLnosdGhpcy5jbG9zZXN0UG9pbnRUb1BvaW50KHMsaSk7Y29uc3Qgdz1zLmRpc3RhbmNlVG9TcXVhcmVkKGkpO2lmKHc8cCYmKHA9dyxvJiZvLmNvcHkoaSksaCYmaC5jb3B5KHMpLHc8YykpcmV0dXJuIE1hdGguc3FydCh3KX1mb3IobGV0IHg9MDt4PDEyO3grKyl7Y29uc3QgbT10W3hdO2ZvcihsZXQgZz0wO2c8MTI7ZysrKXtjb25zdCB3PWVbZ107dWkobSx3LGkscyk7Y29uc3QgTT1pLmRpc3RhbmNlVG9TcXVhcmVkKHMpO2lmKE08cCYmKHA9TSxvJiZvLmNvcHkoaSksaCYmaC5jb3B5KHMpLE08YykpcmV0dXJuIE1hdGguc3FydChNKX19cmV0dXJuIE1hdGguc3FydChwKX19KCk7Y2xhc3MgZGl7Y29uc3RydWN0b3IodCl7dGhpcy5fZ2V0TmV3UHJpbWl0aXZlPXQsdGhpcy5fcHJpbWl0aXZlcz1bXX1nZXRQcmltaXRpdmUoKXtjb25zdCB0PXRoaXMuX3ByaW1pdGl2ZXM7cmV0dXJuIHQubGVuZ3RoPT09MD90aGlzLl9nZXROZXdQcmltaXRpdmUoKTp0LnBvcCgpfXJlbGVhc2VQcmltaXRpdmUodCl7dGhpcy5fcHJpbWl0aXZlcy5wdXNoKHQpfX1jbGFzcyAkcyBleHRlbmRzIGRpe2NvbnN0cnVjdG9yKCl7c3VwZXIoKCk9Pm5ldyBydCl9fWNvbnN0IHR0PW5ldyAkcztjbGFzcyBqc3tjb25zdHJ1Y3Rvcigpe3RoaXMuZmxvYXQzMkFycmF5PW51bGwsdGhpcy51aW50MTZBcnJheT1udWxsLHRoaXMudWludDMyQXJyYXk9bnVsbDtjb25zdCB0PVtdO2xldCBlPW51bGw7dGhpcy5zZXRCdWZmZXI9aT0+e2UmJnQucHVzaChlKSxlPWksdGhpcy5mbG9hdDMyQXJyYXk9bmV3IEZsb2F0MzJBcnJheShpKSx0aGlzLnVpbnQxNkFycmF5PW5ldyBVaW50MTZBcnJheShpKSx0aGlzLnVpbnQzMkFycmF5PW5ldyBVaW50MzJBcnJheShpKX0sdGhpcy5jbGVhckJ1ZmZlcj0oKT0+e2U9bnVsbCx0aGlzLmZsb2F0MzJBcnJheT1udWxsLHRoaXMudWludDE2QXJyYXk9bnVsbCx0aGlzLnVpbnQzMkFycmF5PW51bGwsdC5sZW5ndGghPT0wJiZ0aGlzLnNldEJ1ZmZlcih0LnBvcCgpKX19fWNvbnN0IGs9bmV3IGpzO2xldCB6dCxxdDtjb25zdCB2dD1bXSxTZT1uZXcgZGkoKCk9Pm5ldyBXKTtmdW5jdGlvbiBHcyh1LHQsZSxpLHMsbil7enQ9U2UuZ2V0UHJpbWl0aXZlKCkscXQ9U2UuZ2V0UHJpbWl0aXZlKCksdnQucHVzaCh6dCxxdCksay5zZXRCdWZmZXIodS5fcm9vdHNbdF0pO2NvbnN0IHI9cGkoMCx1Lmdlb21ldHJ5LGUsaSxzLG4pO2suY2xlYXJCdWZmZXIoKSxTZS5yZWxlYXNlUHJpbWl0aXZlKHp0KSxTZS5yZWxlYXNlUHJpbWl0aXZlKHF0KSx2dC5wb3AoKSx2dC5wb3AoKTtjb25zdCBhPXZ0Lmxlbmd0aDtyZXR1cm4gYT4wJiYocXQ9dnRbYS0xXSx6dD12dFthLTJdKSxyfWZ1bmN0aW9uIHBpKHUsdCxlLGkscz1udWxsLG49MCxyPTApe2NvbnN0e2Zsb2F0MzJBcnJheTphLHVpbnQxNkFycmF5Om8sdWludDMyQXJyYXk6aH09aztsZXQgYz11KjI7aWYoWShjLG8pKXtjb25zdCBsPSQodSxoKSxkPUooYyxvKTtyZXR1cm4gTCh1LGEsenQpLGkobCxkLCExLHIsbit1LHp0KX1lbHNle2xldCBUPWZ1bmN0aW9uKFApe2NvbnN0e3VpbnQxNkFycmF5OkUsdWludDMyQXJyYXk6Rn09aztsZXQgVT1QKjI7Zm9yKDshWShVLEUpOylQPVEoUCksVT1QKjI7cmV0dXJuICQoUCxGKX0sQz1mdW5jdGlvbihQKXtjb25zdHt1aW50MTZBcnJheTpFLHVpbnQzMkFycmF5OkZ9PWs7bGV0IFU9UCoyO2Zvcig7IVkoVSxFKTspUD1LKFAsRiksVT1QKjI7cmV0dXJuICQoUCxGKStKKFUsRSl9O2NvbnN0IGw9USh1KSxkPUsodSxoKTtsZXQgcD1sLHk9ZCx4LG0sZyx3O2lmKHMmJihnPXp0LHc9cXQsTChwLGEsZyksTCh5LGEsdykseD1zKGcpLG09cyh3KSxtPHgpKXtwPWQseT1sO2NvbnN0IFA9eDt4PW0sbT1QLGc9d31nfHwoZz16dCxMKHAsYSxnKSk7Y29uc3QgTT1ZKHAqMixvKSxiPWUoZyxNLHgscisxLG4rcCk7bGV0IHo7aWYoYj09PXZpKXtjb25zdCBQPVQocCksRj1DKHApLVA7ej1pKFAsRiwhMCxyKzEsbitwLGcpfWVsc2Ugej1iJiZwaShwLHQsZSxpLHMsbixyKzEpO2lmKHopcmV0dXJuITA7dz1xdCxMKHksYSx3KTtjb25zdCBfPVkoeSoyLG8pLFM9ZSh3LF8sbSxyKzEsbit5KTtsZXQgQjtpZihTPT09dmkpe2NvbnN0IFA9VCh5KSxGPUMoeSktUDtCPWkoUCxGLCEwLHIrMSxuK3ksdyl9ZWxzZSBCPVMmJnBpKHksdCxlLGkscyxuLHIrMSk7cmV0dXJuISFCfX1jb25zdCBvZT1uZXcgQSxtaT1uZXcgQTtmdW5jdGlvbiBKcyh1LHQsZT17fSxpPTAscz0xLzApe2NvbnN0IG49aSppLHI9cypzO2xldCBhPTEvMCxvPW51bGw7aWYodS5zaGFwZWNhc3Qoe2JvdW5kc1RyYXZlcnNlT3JkZXI6Yz0+KG9lLmNvcHkodCkuY2xhbXAoYy5taW4sYy5tYXgpLG9lLmRpc3RhbmNlVG9TcXVhcmVkKHQpKSxpbnRlcnNlY3RzQm91bmRzOihjLGYsbCk9Pmw8YSYmbDxyLGludGVyc2VjdHNUcmlhbmdsZTooYyxmKT0+e2MuY2xvc2VzdFBvaW50VG9Qb2ludCh0LG9lKTtjb25zdCBsPXQuZGlzdGFuY2VUb1NxdWFyZWQob2UpO3JldHVybiBsPGEmJihtaS5jb3B5KG9lKSxhPWwsbz1mKSxsPG59fSksYT09PTEvMClyZXR1cm4gbnVsbDtjb25zdCBoPU1hdGguc3FydChhKTtyZXR1cm4gZS5wb2ludD9lLnBvaW50LmNvcHkobWkpOmUucG9pbnQ9bWkuY2xvbmUoKSxlLmRpc3RhbmNlPWgsZS5mYWNlSW5kZXg9byxlfWNvbnN0IFd0PW5ldyBBLFh0PW5ldyBBLE90PW5ldyBBLEJlPW5ldyB2LFRlPW5ldyB2LFBlPW5ldyB2LEppPW5ldyBBLFFpPW5ldyBBLEtpPW5ldyBBLENlPW5ldyBBO2Z1bmN0aW9uIFFzKHUsdCxlLGkscyxuLHIsYSl7bGV0IG87aWYobj09PTE/bz11LmludGVyc2VjdFRyaWFuZ2xlKGksZSx0LCEwLHMpOm89dS5pbnRlcnNlY3RUcmlhbmdsZSh0LGUsaSxuIT09MixzKSxvPT09bnVsbClyZXR1cm4gbnVsbDtjb25zdCBoPXUub3JpZ2luLmRpc3RhbmNlVG8ocyk7cmV0dXJuIGg8cnx8aD5hP251bGw6e2Rpc3RhbmNlOmgscG9pbnQ6cy5jbG9uZSgpfX1mdW5jdGlvbiBLcyh1LHQsZSxpLHMsbixyLGEsbyxoLGMpe1d0LmZyb21CdWZmZXJBdHRyaWJ1dGUodCxuKSxYdC5mcm9tQnVmZmVyQXR0cmlidXRlKHQsciksT3QuZnJvbUJ1ZmZlckF0dHJpYnV0ZSh0LGEpO2NvbnN0IGY9UXModSxXdCxYdCxPdCxDZSxvLGgsYyk7aWYoZil7aSYmKEJlLmZyb21CdWZmZXJBdHRyaWJ1dGUoaSxuKSxUZS5mcm9tQnVmZmVyQXR0cmlidXRlKGksciksUGUuZnJvbUJ1ZmZlckF0dHJpYnV0ZShpLGEpLGYudXY9bnQuZ2V0SW50ZXJwb2xhdGlvbihDZSxXdCxYdCxPdCxCZSxUZSxQZSxuZXcgdikpLHMmJihCZS5mcm9tQnVmZmVyQXR0cmlidXRlKHMsbiksVGUuZnJvbUJ1ZmZlckF0dHJpYnV0ZShzLHIpLFBlLmZyb21CdWZmZXJBdHRyaWJ1dGUocyxhKSxmLnV2MT1udC5nZXRJbnRlcnBvbGF0aW9uKENlLFd0LFh0LE90LEJlLFRlLFBlLG5ldyB2KSksZSYmKEppLmZyb21CdWZmZXJBdHRyaWJ1dGUoZSxuKSxRaS5mcm9tQnVmZmVyQXR0cmlidXRlKGUsciksS2kuZnJvbUJ1ZmZlckF0dHJpYnV0ZShlLGEpLGYubm9ybWFsPW50LmdldEludGVycG9sYXRpb24oQ2UsV3QsWHQsT3QsSmksUWksS2ksbmV3IEEpLGYubm9ybWFsLmRvdCh1LmRpcmVjdGlvbik+MCYmZi5ub3JtYWwubXVsdGlwbHlTY2FsYXIoLTEpKTtjb25zdCBsPXthOm4sYjpyLGM6YSxub3JtYWw6bmV3IEEsbWF0ZXJpYWxJbmRleDowfTtudC5nZXROb3JtYWwoV3QsWHQsT3QsbC5ub3JtYWwpLGYuZmFjZT1sLGYuZmFjZUluZGV4PW59cmV0dXJuIGZ9ZnVuY3Rpb24gRWUodSx0LGUsaSxzLG4scil7Y29uc3QgYT1pKjM7bGV0IG89YSswLGg9YSsxLGM9YSsyO2NvbnN0IGY9dS5pbmRleDt1LmluZGV4JiYobz1mLmdldFgobyksaD1mLmdldFgoaCksYz1mLmdldFgoYykpO2NvbnN0e3Bvc2l0aW9uOmwsbm9ybWFsOmQsdXY6cCx1djE6eX09dS5hdHRyaWJ1dGVzLHg9S3MoZSxsLGQscCx5LG8saCxjLHQsbixyKTtyZXR1cm4geD8oeC5mYWNlSW5kZXg9aSxzJiZzLnB1c2goeCkseCk6bnVsbH1mdW5jdGlvbiBEKHUsdCxlLGkpe2NvbnN0IHM9dS5hLG49dS5iLHI9dS5jO2xldCBhPXQsbz10KzEsaD10KzI7ZSYmKGE9ZS5nZXRYKGEpLG89ZS5nZXRYKG8pLGg9ZS5nZXRYKGgpKSxzLng9aS5nZXRYKGEpLHMueT1pLmdldFkoYSkscy56PWkuZ2V0WihhKSxuLng9aS5nZXRYKG8pLG4ueT1pLmdldFkobyksbi56PWkuZ2V0WihvKSxyLng9aS5nZXRYKGgpLHIueT1pLmdldFkoaCksci56PWkuZ2V0WihoKX1mdW5jdGlvbiB0bih1LHQsZSxpLHMsbixyLGEpe2NvbnN0e2dlb21ldHJ5Om8sX2luZGlyZWN0QnVmZmVyOmh9PXU7Zm9yKGxldCBjPWksZj1pK3M7YzxmO2MrKylFZShvLHQsZSxjLG4scixhKX1mdW5jdGlvbiBlbih1LHQsZSxpLHMsbixyKXtjb25zdHtnZW9tZXRyeTphLF9pbmRpcmVjdEJ1ZmZlcjpvfT11O2xldCBoPTEvMCxjPW51bGw7Zm9yKGxldCBmPWksbD1pK3M7ZjxsO2YrKyl7bGV0IGQ7ZD1FZShhLHQsZSxmLG51bGwsbixyKSxkJiZkLmRpc3RhbmNlPGgmJihjPWQsaD1kLmRpc3RhbmNlKX1yZXR1cm4gY31mdW5jdGlvbiBzbih1LHQsZSxpLHMsbixyKXtjb25zdHtnZW9tZXRyeTphfT1lLHtpbmRleDpvfT1hLGg9YS5hdHRyaWJ1dGVzLnBvc2l0aW9uO2ZvcihsZXQgYz11LGY9dCt1O2M8ZjtjKyspe2xldCBsO2lmKGw9YyxEKHIsbCozLG8saCksci5uZWVkc1VwZGF0ZT0hMCxpKHIsbCxzLG4pKXJldHVybiEwfXJldHVybiExfWZ1bmN0aW9uIG5uKHUsdD1udWxsKXt0JiZBcnJheS5pc0FycmF5KHQpJiYodD1uZXcgU2V0KHQpKTtjb25zdCBlPXUuZ2VvbWV0cnksaT1lLmluZGV4P2UuaW5kZXguYXJyYXk6bnVsbCxzPWUuYXR0cmlidXRlcy5wb3NpdGlvbjtsZXQgbixyLGEsbyxoPTA7Y29uc3QgYz11Ll9yb290cztmb3IobGV0IGw9MCxkPWMubGVuZ3RoO2w8ZDtsKyspbj1jW2xdLHI9bmV3IFVpbnQzMkFycmF5KG4pLGE9bmV3IFVpbnQxNkFycmF5KG4pLG89bmV3IEZsb2F0MzJBcnJheShuKSxmKDAsaCksaCs9bi5ieXRlTGVuZ3RoO2Z1bmN0aW9uIGYobCxkLHA9ITEpe2NvbnN0IHk9bCoyO2lmKGFbeSsxNV09PT1fZSl7Y29uc3QgbT1yW2wrNl0sZz1hW3krMTRdO2xldCB3PTEvMCxNPTEvMCxiPTEvMCx6PS0xLzAsXz0tMS8wLFM9LTEvMDtmb3IobGV0IEI9MyptLFQ9MyoobStnKTtCPFQ7QisrKXtsZXQgQz1pW0JdO2NvbnN0IFA9cy5nZXRYKEMpLEU9cy5nZXRZKEMpLEY9cy5nZXRaKEMpO1A8dyYmKHc9UCksUD56JiYoej1QKSxFPE0mJihNPUUpLEU+XyYmKF89RSksRjxiJiYoYj1GKSxGPlMmJihTPUYpfXJldHVybiBvW2wrMF0hPT13fHxvW2wrMV0hPT1NfHxvW2wrMl0hPT1ifHxvW2wrM10hPT16fHxvW2wrNF0hPT1ffHxvW2wrNV0hPT1TPyhvW2wrMF09dyxvW2wrMV09TSxvW2wrMl09YixvW2wrM109eixvW2wrNF09XyxvW2wrNV09UywhMCk6ITF9ZWxzZXtjb25zdCBtPWwrOCxnPXJbbCs2XSx3PW0rZCxNPWcrZDtsZXQgYj1wLHo9ITEsXz0hMTt0P2J8fCh6PXQuaGFzKHcpLF89dC5oYXMoTSksYj0heiYmIV8pOih6PSEwLF89ITApO2NvbnN0IFM9Ynx8eixCPWJ8fF87bGV0IFQ9ITE7UyYmKFQ9ZihtLGQsYikpO2xldCBDPSExO0ImJihDPWYoZyxkLGIpKTtjb25zdCBQPVR8fEM7aWYoUClmb3IobGV0IEU9MDtFPDM7RSsrKXtjb25zdCBGPW0rRSxVPWcrRSxSPW9bRl0saj1vW0YrM10saHQ9b1tVXSxsdD1vW1UrM107b1tsK0VdPVI8aHQ/UjpodCxvW2wrRSszXT1qPmx0P2o6bHR9cmV0dXJuIFB9fX1mdW5jdGlvbiBTdCh1LHQsZSxpLHMpe2xldCBuLHIsYSxvLGgsYztjb25zdCBmPTEvZS5kaXJlY3Rpb24ueCxsPTEvZS5kaXJlY3Rpb24ueSxkPTEvZS5kaXJlY3Rpb24ueixwPWUub3JpZ2luLngseT1lLm9yaWdpbi55LHg9ZS5vcmlnaW4uejtsZXQgbT10W3VdLGc9dFt1KzNdLHc9dFt1KzFdLE09dFt1KzMrMV0sYj10W3UrMl0sej10W3UrMysyXTtyZXR1cm4gZj49MD8obj0obS1wKSpmLHI9KGctcCkqZik6KG49KGctcCkqZixyPShtLXApKmYpLGw+PTA/KGE9KHcteSkqbCxvPShNLXkpKmwpOihhPShNLXkpKmwsbz0ody15KSpsKSxuPm98fGE+cnx8KChhPm58fGlzTmFOKG4pKSYmKG49YSksKG88cnx8aXNOYU4ocikpJiYocj1vKSxkPj0wPyhoPShiLXgpKmQsYz0oei14KSpkKTooaD0oei14KSpkLGM9KGIteCkqZCksbj5jfHxoPnIpPyExOigoaD5ufHxuIT09bikmJihuPWgpLChjPHJ8fHIhPT1yKSYmKHI9Yyksbjw9cyYmcj49aSl9ZnVuY3Rpb24gcm4odSx0LGUsaSxzLG4scixhKXtjb25zdHtnZW9tZXRyeTpvLF9pbmRpcmVjdEJ1ZmZlcjpofT11O2ZvcihsZXQgYz1pLGY9aStzO2M8ZjtjKyspe2xldCBsPWg/aFtjXTpjO0VlKG8sdCxlLGwsbixyLGEpfX1mdW5jdGlvbiBvbih1LHQsZSxpLHMsbixyKXtjb25zdHtnZW9tZXRyeTphLF9pbmRpcmVjdEJ1ZmZlcjpvfT11O2xldCBoPTEvMCxjPW51bGw7Zm9yKGxldCBmPWksbD1pK3M7ZjxsO2YrKyl7bGV0IGQ7ZD1FZShhLHQsZSxvP29bZl06ZixudWxsLG4sciksZCYmZC5kaXN0YW5jZTxoJiYoYz1kLGg9ZC5kaXN0YW5jZSl9cmV0dXJuIGN9ZnVuY3Rpb24gYW4odSx0LGUsaSxzLG4scil7Y29uc3R7Z2VvbWV0cnk6YX09ZSx7aW5kZXg6b309YSxoPWEuYXR0cmlidXRlcy5wb3NpdGlvbjtmb3IobGV0IGM9dSxmPXQrdTtjPGY7YysrKXtsZXQgbDtpZihsPWUucmVzb2x2ZVRyaWFuZ2xlSW5kZXgoYyksRChyLGwqMyxvLGgpLHIubmVlZHNVcGRhdGU9ITAsaShyLGwscyxuKSlyZXR1cm4hMH1yZXR1cm4hMX1mdW5jdGlvbiBjbih1LHQsZSxpLHMsbixyKXtrLnNldEJ1ZmZlcih1Ll9yb290c1t0XSkseWkoMCx1LGUsaSxzLG4sciksay5jbGVhckJ1ZmZlcigpfWZ1bmN0aW9uIHlpKHUsdCxlLGkscyxuLHIpe2NvbnN0e2Zsb2F0MzJBcnJheTphLHVpbnQxNkFycmF5Om8sdWludDMyQXJyYXk6aH09ayxjPXUqMjtpZihZKGMsbykpe2NvbnN0IGw9JCh1LGgpLGQ9SihjLG8pO3RuKHQsZSxpLGwsZCxzLG4scil9ZWxzZXtjb25zdCBsPVEodSk7U3QobCxhLGksbixyKSYmeWkobCx0LGUsaSxzLG4scik7Y29uc3QgZD1LKHUsaCk7U3QoZCxhLGksbixyKSYmeWkoZCx0LGUsaSxzLG4scil9fWNvbnN0IGhuPVsieCIsInkiLCJ6Il07ZnVuY3Rpb24gbG4odSx0LGUsaSxzLG4pe2suc2V0QnVmZmVyKHUuX3Jvb3RzW3RdKTtjb25zdCByPXhpKDAsdSxlLGkscyxuKTtyZXR1cm4gay5jbGVhckJ1ZmZlcigpLHJ9ZnVuY3Rpb24geGkodSx0LGUsaSxzLG4pe2NvbnN0e2Zsb2F0MzJBcnJheTpyLHVpbnQxNkFycmF5OmEsdWludDMyQXJyYXk6b309aztsZXQgaD11KjI7aWYoWShoLGEpKXtjb25zdCBmPSQodSxvKSxsPUooaCxhKTtyZXR1cm4gZW4odCxlLGksZixsLHMsbil9ZWxzZXtjb25zdCBmPSRpKHUsbyksbD1obltmXSxwPWkuZGlyZWN0aW9uW2xdPj0wO2xldCB5LHg7cD8oeT1RKHUpLHg9Syh1LG8pKTooeT1LKHUsbykseD1RKHUpKTtjb25zdCBnPVN0KHkscixpLHMsbik/eGkoeSx0LGUsaSxzLG4pOm51bGw7aWYoZyl7Y29uc3QgYj1nLnBvaW50W2xdO2lmKHA/Yjw9clt4K2ZdOmI+PXJbeCtmKzNdKXJldHVybiBnfWNvbnN0IE09U3QoeCxyLGkscyxuKT94aSh4LHQsZSxpLHMsbik6bnVsbDtyZXR1cm4gZyYmTT9nLmRpc3RhbmNlPD1NLmRpc3RhbmNlP2c6TTpnfHxNfHxudWxsfX1jb25zdCBGZT1uZXcgVyxZdD1uZXcgcnQsWnQ9bmV3IHJ0LGFlPW5ldyBOLHRzPW5ldyBYLFVlPW5ldyBYO2Z1bmN0aW9uIHVuKHUsdCxlLGkpe2suc2V0QnVmZmVyKHUuX3Jvb3RzW3RdKTtjb25zdCBzPWdpKDAsdSxlLGkpO3JldHVybiBrLmNsZWFyQnVmZmVyKCksc31mdW5jdGlvbiBnaSh1LHQsZSxpLHM9bnVsbCl7Y29uc3R7ZmxvYXQzMkFycmF5Om4sdWludDE2QXJyYXk6cix1aW50MzJBcnJheTphfT1rO2xldCBvPXUqMjtpZihzPT09bnVsbCYmKGUuYm91bmRpbmdCb3h8fGUuY29tcHV0ZUJvdW5kaW5nQm94KCksdHMuc2V0KGUuYm91bmRpbmdCb3gubWluLGUuYm91bmRpbmdCb3gubWF4LGkpLHM9dHMpLFkobyxyKSl7Y29uc3QgYz10Lmdlb21ldHJ5LGY9Yy5pbmRleCxsPWMuYXR0cmlidXRlcy5wb3NpdGlvbixkPWUuaW5kZXgscD1lLmF0dHJpYnV0ZXMucG9zaXRpb24seT0kKHUsYSkseD1KKG8scik7aWYoYWUuY29weShpKS5pbnZlcnQoKSxlLmJvdW5kc1RyZWUpcmV0dXJuIEwodSxuLFVlKSxVZS5tYXRyaXguY29weShhZSksVWUubmVlZHNVcGRhdGU9ITAsZS5ib3VuZHNUcmVlLnNoYXBlY2FzdCh7aW50ZXJzZWN0c0JvdW5kczpnPT5VZS5pbnRlcnNlY3RzQm94KGcpLGludGVyc2VjdHNUcmlhbmdsZTpnPT57Zy5hLmFwcGx5TWF0cml4NChpKSxnLmIuYXBwbHlNYXRyaXg0KGkpLGcuYy5hcHBseU1hdHJpeDQoaSksZy5uZWVkc1VwZGF0ZT0hMDtmb3IobGV0IHc9eSozLE09KHgreSkqMzt3PE07dys9MylpZihEKFp0LHcsZixsKSxadC5uZWVkc1VwZGF0ZT0hMCxnLmludGVyc2VjdHNUcmlhbmdsZShadCkpcmV0dXJuITA7cmV0dXJuITF9fSk7Zm9yKGxldCBtPXkqMyxnPSh4K3kpKjM7bTxnO20rPTMpe0QoWXQsbSxmLGwpLFl0LmEuYXBwbHlNYXRyaXg0KGFlKSxZdC5iLmFwcGx5TWF0cml4NChhZSksWXQuYy5hcHBseU1hdHJpeDQoYWUpLFl0Lm5lZWRzVXBkYXRlPSEwO2ZvcihsZXQgdz0wLE09ZC5jb3VudDt3PE07dys9MylpZihEKFp0LHcsZCxwKSxadC5uZWVkc1VwZGF0ZT0hMCxZdC5pbnRlcnNlY3RzVHJpYW5nbGUoWnQpKXJldHVybiEwfX1lbHNle2NvbnN0IGM9dSs4LGY9YVt1KzZdO3JldHVybiBMKGMsbixGZSksISEocy5pbnRlcnNlY3RzQm94KEZlKSYmZ2koYyx0LGUsaSxzKXx8KEwoZixuLEZlKSxzLmludGVyc2VjdHNCb3goRmUpJiZnaShmLHQsZSxpLHMpKSl9fWNvbnN0IFJlPW5ldyBOLGJpPW5ldyBYLGNlPW5ldyBYLGZuPW5ldyBBLGRuPW5ldyBBLHBuPW5ldyBBLG1uPW5ldyBBO2Z1bmN0aW9uIHluKHUsdCxlLGk9e30scz17fSxuPTAscj0xLzApe3QuYm91bmRpbmdCb3h8fHQuY29tcHV0ZUJvdW5kaW5nQm94KCksYmkuc2V0KHQuYm91bmRpbmdCb3gubWluLHQuYm91bmRpbmdCb3gubWF4LGUpLGJpLm5lZWRzVXBkYXRlPSEwO2NvbnN0IGE9dS5nZW9tZXRyeSxvPWEuYXR0cmlidXRlcy5wb3NpdGlvbixoPWEuaW5kZXgsYz10LmF0dHJpYnV0ZXMucG9zaXRpb24sZj10LmluZGV4LGw9dHQuZ2V0UHJpbWl0aXZlKCksZD10dC5nZXRQcmltaXRpdmUoKTtsZXQgcD1mbix5PWRuLHg9bnVsbCxtPW51bGw7cyYmKHg9cG4sbT1tbik7bGV0IGc9MS8wLHc9bnVsbCxNPW51bGw7cmV0dXJuIFJlLmNvcHkoZSkuaW52ZXJ0KCksY2UubWF0cml4LmNvcHkoUmUpLHUuc2hhcGVjYXN0KHtib3VuZHNUcmF2ZXJzZU9yZGVyOmI9PmJpLmRpc3RhbmNlVG9Cb3goYiksaW50ZXJzZWN0c0JvdW5kczooYix6LF8pPT5fPGcmJl88cj8oeiYmKGNlLm1pbi5jb3B5KGIubWluKSxjZS5tYXguY29weShiLm1heCksY2UubmVlZHNVcGRhdGU9ITApLCEwKTohMSxpbnRlcnNlY3RzUmFuZ2U6KGIseik9PntpZih0LmJvdW5kc1RyZWUpcmV0dXJuIHQuYm91bmRzVHJlZS5zaGFwZWNhc3Qoe2JvdW5kc1RyYXZlcnNlT3JkZXI6Uz0+Y2UuZGlzdGFuY2VUb0JveChTKSxpbnRlcnNlY3RzQm91bmRzOihTLEIsVCk9PlQ8ZyYmVDxyLGludGVyc2VjdHNSYW5nZTooUyxCKT0+e2ZvcihsZXQgVD1TLEM9UytCO1Q8QztUKyspe0QoZCwzKlQsZixjKSxkLmEuYXBwbHlNYXRyaXg0KGUpLGQuYi5hcHBseU1hdHJpeDQoZSksZC5jLmFwcGx5TWF0cml4NChlKSxkLm5lZWRzVXBkYXRlPSEwO2ZvcihsZXQgUD1iLEU9Yit6O1A8RTtQKyspe0QobCwzKlAsaCxvKSxsLm5lZWRzVXBkYXRlPSEwO2NvbnN0IEY9bC5kaXN0YW5jZVRvVHJpYW5nbGUoZCxwLHgpO2lmKEY8ZyYmKHkuY29weShwKSxtJiZtLmNvcHkoeCksZz1GLHc9UCxNPVQpLEY8bilyZXR1cm4hMH19fX0pO3tjb25zdCBfPU50KHQpO2ZvcihsZXQgUz0wLEI9XztTPEI7UysrKXtEKGQsMypTLGYsYyksZC5hLmFwcGx5TWF0cml4NChlKSxkLmIuYXBwbHlNYXRyaXg0KGUpLGQuYy5hcHBseU1hdHJpeDQoZSksZC5uZWVkc1VwZGF0ZT0hMDtmb3IobGV0IFQ9YixDPWIrejtUPEM7VCsrKXtEKGwsMypULGgsbyksbC5uZWVkc1VwZGF0ZT0hMDtjb25zdCBQPWwuZGlzdGFuY2VUb1RyaWFuZ2xlKGQscCx4KTtpZihQPGcmJih5LmNvcHkocCksbSYmbS5jb3B5KHgpLGc9UCx3PVQsTT1TKSxQPG4pcmV0dXJuITB9fX19fSksdHQucmVsZWFzZVByaW1pdGl2ZShsKSx0dC5yZWxlYXNlUHJpbWl0aXZlKGQpLGc9PT0xLzA/bnVsbDooaS5wb2ludD9pLnBvaW50LmNvcHkoeSk6aS5wb2ludD15LmNsb25lKCksaS5kaXN0YW5jZT1nLGkuZmFjZUluZGV4PXcscyYmKHMucG9pbnQ/cy5wb2ludC5jb3B5KG0pOnMucG9pbnQ9bS5jbG9uZSgpLHMucG9pbnQuYXBwbHlNYXRyaXg0KFJlKSx5LmFwcGx5TWF0cml4NChSZSkscy5kaXN0YW5jZT15LnN1YihzLnBvaW50KS5sZW5ndGgoKSxzLmZhY2VJbmRleD1NKSxpKX1mdW5jdGlvbiB4bih1LHQ9bnVsbCl7dCYmQXJyYXkuaXNBcnJheSh0KSYmKHQ9bmV3IFNldCh0KSk7Y29uc3QgZT11Lmdlb21ldHJ5LGk9ZS5pbmRleD9lLmluZGV4LmFycmF5Om51bGwscz1lLmF0dHJpYnV0ZXMucG9zaXRpb247bGV0IG4scixhLG8saD0wO2NvbnN0IGM9dS5fcm9vdHM7Zm9yKGxldCBsPTAsZD1jLmxlbmd0aDtsPGQ7bCsrKW49Y1tsXSxyPW5ldyBVaW50MzJBcnJheShuKSxhPW5ldyBVaW50MTZBcnJheShuKSxvPW5ldyBGbG9hdDMyQXJyYXkobiksZigwLGgpLGgrPW4uYnl0ZUxlbmd0aDtmdW5jdGlvbiBmKGwsZCxwPSExKXtjb25zdCB5PWwqMjtpZihhW3krMTVdPT09X2Upe2NvbnN0IG09cltsKzZdLGc9YVt5KzE0XTtsZXQgdz0xLzAsTT0xLzAsYj0xLzAsej0tMS8wLF89LTEvMCxTPS0xLzA7Zm9yKGxldCBCPW0sVD1tK2c7QjxUO0IrKyl7Y29uc3QgQz0zKnUucmVzb2x2ZVRyaWFuZ2xlSW5kZXgoQik7Zm9yKGxldCBQPTA7UDwzO1ArKyl7bGV0IEU9QytQO0U9aT9pW0VdOkU7Y29uc3QgRj1zLmdldFgoRSksVT1zLmdldFkoRSksUj1zLmdldFooRSk7Rjx3JiYodz1GKSxGPnomJih6PUYpLFU8TSYmKE09VSksVT5fJiYoXz1VKSxSPGImJihiPVIpLFI+UyYmKFM9Uil9fXJldHVybiBvW2wrMF0hPT13fHxvW2wrMV0hPT1NfHxvW2wrMl0hPT1ifHxvW2wrM10hPT16fHxvW2wrNF0hPT1ffHxvW2wrNV0hPT1TPyhvW2wrMF09dyxvW2wrMV09TSxvW2wrMl09YixvW2wrM109eixvW2wrNF09XyxvW2wrNV09UywhMCk6ITF9ZWxzZXtjb25zdCBtPWwrOCxnPXJbbCs2XSx3PW0rZCxNPWcrZDtsZXQgYj1wLHo9ITEsXz0hMTt0P2J8fCh6PXQuaGFzKHcpLF89dC5oYXMoTSksYj0heiYmIV8pOih6PSEwLF89ITApO2NvbnN0IFM9Ynx8eixCPWJ8fF87bGV0IFQ9ITE7UyYmKFQ9ZihtLGQsYikpO2xldCBDPSExO0ImJihDPWYoZyxkLGIpKTtjb25zdCBQPVR8fEM7aWYoUClmb3IobGV0IEU9MDtFPDM7RSsrKXtjb25zdCBGPW0rRSxVPWcrRSxSPW9bRl0saj1vW0YrM10saHQ9b1tVXSxsdD1vW1UrM107b1tsK0VdPVI8aHQ/UjpodCxvW2wrRSszXT1qPmx0P2o6bHR9cmV0dXJuIFB9fX1mdW5jdGlvbiBnbih1LHQsZSxpLHMsbixyKXtrLnNldEJ1ZmZlcih1Ll9yb290c1t0XSksd2koMCx1LGUsaSxzLG4sciksay5jbGVhckJ1ZmZlcigpfWZ1bmN0aW9uIHdpKHUsdCxlLGkscyxuLHIpe2NvbnN0e2Zsb2F0MzJBcnJheTphLHVpbnQxNkFycmF5Om8sdWludDMyQXJyYXk6aH09ayxjPXUqMjtpZihZKGMsbykpe2NvbnN0IGw9JCh1LGgpLGQ9SihjLG8pO3JuKHQsZSxpLGwsZCxzLG4scil9ZWxzZXtjb25zdCBsPVEodSk7U3QobCxhLGksbixyKSYmd2kobCx0LGUsaSxzLG4scik7Y29uc3QgZD1LKHUsaCk7U3QoZCxhLGksbixyKSYmd2koZCx0LGUsaSxzLG4scil9fWNvbnN0IGJuPVsieCIsInkiLCJ6Il07ZnVuY3Rpb24gd24odSx0LGUsaSxzLG4pe2suc2V0QnVmZmVyKHUuX3Jvb3RzW3RdKTtjb25zdCByPV9pKDAsdSxlLGkscyxuKTtyZXR1cm4gay5jbGVhckJ1ZmZlcigpLHJ9ZnVuY3Rpb24gX2kodSx0LGUsaSxzLG4pe2NvbnN0e2Zsb2F0MzJBcnJheTpyLHVpbnQxNkFycmF5OmEsdWludDMyQXJyYXk6b309aztsZXQgaD11KjI7aWYoWShoLGEpKXtjb25zdCBmPSQodSxvKSxsPUooaCxhKTtyZXR1cm4gb24odCxlLGksZixsLHMsbil9ZWxzZXtjb25zdCBmPSRpKHUsbyksbD1ibltmXSxwPWkuZGlyZWN0aW9uW2xdPj0wO2xldCB5LHg7cD8oeT1RKHUpLHg9Syh1LG8pKTooeT1LKHUsbykseD1RKHUpKTtjb25zdCBnPVN0KHkscixpLHMsbik/X2koeSx0LGUsaSxzLG4pOm51bGw7aWYoZyl7Y29uc3QgYj1nLnBvaW50W2xdO2lmKHA/Yjw9clt4K2ZdOmI+PXJbeCtmKzNdKXJldHVybiBnfWNvbnN0IE09U3QoeCxyLGkscyxuKT9faSh4LHQsZSxpLHMsbik6bnVsbDtyZXR1cm4gZyYmTT9nLmRpc3RhbmNlPD1NLmRpc3RhbmNlP2c6TTpnfHxNfHxudWxsfX1jb25zdCBrZT1uZXcgVyxIdD1uZXcgcnQsJHQ9bmV3IHJ0LGhlPW5ldyBOLGVzPW5ldyBYLExlPW5ldyBYO2Z1bmN0aW9uIF9uKHUsdCxlLGkpe2suc2V0QnVmZmVyKHUuX3Jvb3RzW3RdKTtjb25zdCBzPU1pKDAsdSxlLGkpO3JldHVybiBrLmNsZWFyQnVmZmVyKCksc31mdW5jdGlvbiBNaSh1LHQsZSxpLHM9bnVsbCl7Y29uc3R7ZmxvYXQzMkFycmF5Om4sdWludDE2QXJyYXk6cix1aW50MzJBcnJheTphfT1rO2xldCBvPXUqMjtpZihzPT09bnVsbCYmKGUuYm91bmRpbmdCb3h8fGUuY29tcHV0ZUJvdW5kaW5nQm94KCksZXMuc2V0KGUuYm91bmRpbmdCb3gubWluLGUuYm91bmRpbmdCb3gubWF4LGkpLHM9ZXMpLFkobyxyKSl7Y29uc3QgYz10Lmdlb21ldHJ5LGY9Yy5pbmRleCxsPWMuYXR0cmlidXRlcy5wb3NpdGlvbixkPWUuaW5kZXgscD1lLmF0dHJpYnV0ZXMucG9zaXRpb24seT0kKHUsYSkseD1KKG8scik7aWYoaGUuY29weShpKS5pbnZlcnQoKSxlLmJvdW5kc1RyZWUpcmV0dXJuIEwodSxuLExlKSxMZS5tYXRyaXguY29weShoZSksTGUubmVlZHNVcGRhdGU9ITAsZS5ib3VuZHNUcmVlLnNoYXBlY2FzdCh7aW50ZXJzZWN0c0JvdW5kczpnPT5MZS5pbnRlcnNlY3RzQm94KGcpLGludGVyc2VjdHNUcmlhbmdsZTpnPT57Zy5hLmFwcGx5TWF0cml4NChpKSxnLmIuYXBwbHlNYXRyaXg0KGkpLGcuYy5hcHBseU1hdHJpeDQoaSksZy5uZWVkc1VwZGF0ZT0hMDtmb3IobGV0IHc9eSxNPXgreTt3PE07dysrKWlmKEQoJHQsMyp0LnJlc29sdmVUcmlhbmdsZUluZGV4KHcpLGYsbCksJHQubmVlZHNVcGRhdGU9ITAsZy5pbnRlcnNlY3RzVHJpYW5nbGUoJHQpKXJldHVybiEwO3JldHVybiExfX0pO2ZvcihsZXQgbT15LGc9eCt5O208ZzttKyspe2NvbnN0IHc9dC5yZXNvbHZlVHJpYW5nbGVJbmRleChtKTtEKEh0LDMqdyxmLGwpLEh0LmEuYXBwbHlNYXRyaXg0KGhlKSxIdC5iLmFwcGx5TWF0cml4NChoZSksSHQuYy5hcHBseU1hdHJpeDQoaGUpLEh0Lm5lZWRzVXBkYXRlPSEwO2ZvcihsZXQgTT0wLGI9ZC5jb3VudDtNPGI7TSs9MylpZihEKCR0LE0sZCxwKSwkdC5uZWVkc1VwZGF0ZT0hMCxIdC5pbnRlcnNlY3RzVHJpYW5nbGUoJHQpKXJldHVybiEwfX1lbHNle2NvbnN0IGM9dSs4LGY9YVt1KzZdO3JldHVybiBMKGMsbixrZSksISEocy5pbnRlcnNlY3RzQm94KGtlKSYmTWkoYyx0LGUsaSxzKXx8KEwoZixuLGtlKSxzLmludGVyc2VjdHNCb3goa2UpJiZNaShmLHQsZSxpLHMpKSl9fWNvbnN0IEllPW5ldyBOLEFpPW5ldyBYLGxlPW5ldyBYLE1uPW5ldyBBLEFuPW5ldyBBLHpuPW5ldyBBLFNuPW5ldyBBO2Z1bmN0aW9uIEJuKHUsdCxlLGk9e30scz17fSxuPTAscj0xLzApe3QuYm91bmRpbmdCb3h8fHQuY29tcHV0ZUJvdW5kaW5nQm94KCksQWkuc2V0KHQuYm91bmRpbmdCb3gubWluLHQuYm91bmRpbmdCb3gubWF4LGUpLEFpLm5lZWRzVXBkYXRlPSEwO2NvbnN0IGE9dS5nZW9tZXRyeSxvPWEuYXR0cmlidXRlcy5wb3NpdGlvbixoPWEuaW5kZXgsYz10LmF0dHJpYnV0ZXMucG9zaXRpb24sZj10LmluZGV4LGw9dHQuZ2V0UHJpbWl0aXZlKCksZD10dC5nZXRQcmltaXRpdmUoKTtsZXQgcD1Nbix5PUFuLHg9bnVsbCxtPW51bGw7cyYmKHg9em4sbT1Tbik7bGV0IGc9MS8wLHc9bnVsbCxNPW51bGw7cmV0dXJuIEllLmNvcHkoZSkuaW52ZXJ0KCksbGUubWF0cml4LmNvcHkoSWUpLHUuc2hhcGVjYXN0KHtib3VuZHNUcmF2ZXJzZU9yZGVyOmI9PkFpLmRpc3RhbmNlVG9Cb3goYiksaW50ZXJzZWN0c0JvdW5kczooYix6LF8pPT5fPGcmJl88cj8oeiYmKGxlLm1pbi5jb3B5KGIubWluKSxsZS5tYXguY29weShiLm1heCksbGUubmVlZHNVcGRhdGU9ITApLCEwKTohMSxpbnRlcnNlY3RzUmFuZ2U6KGIseik9PntpZih0LmJvdW5kc1RyZWUpe2NvbnN0IF89dC5ib3VuZHNUcmVlO3JldHVybiBfLnNoYXBlY2FzdCh7Ym91bmRzVHJhdmVyc2VPcmRlcjpTPT5sZS5kaXN0YW5jZVRvQm94KFMpLGludGVyc2VjdHNCb3VuZHM6KFMsQixUKT0+VDxnJiZUPHIsaW50ZXJzZWN0c1JhbmdlOihTLEIpPT57Zm9yKGxldCBUPVMsQz1TK0I7VDxDO1QrKyl7Y29uc3QgUD1fLnJlc29sdmVUcmlhbmdsZUluZGV4KFQpO0QoZCwzKlAsZixjKSxkLmEuYXBwbHlNYXRyaXg0KGUpLGQuYi5hcHBseU1hdHJpeDQoZSksZC5jLmFwcGx5TWF0cml4NChlKSxkLm5lZWRzVXBkYXRlPSEwO2ZvcihsZXQgRT1iLEY9Yit6O0U8RjtFKyspe2NvbnN0IFU9dS5yZXNvbHZlVHJpYW5nbGVJbmRleChFKTtEKGwsMypVLGgsbyksbC5uZWVkc1VwZGF0ZT0hMDtjb25zdCBSPWwuZGlzdGFuY2VUb1RyaWFuZ2xlKGQscCx4KTtpZihSPGcmJih5LmNvcHkocCksbSYmbS5jb3B5KHgpLGc9Uix3PUUsTT1UKSxSPG4pcmV0dXJuITB9fX19KX1lbHNle2NvbnN0IF89TnQodCk7Zm9yKGxldCBTPTAsQj1fO1M8QjtTKyspe0QoZCwzKlMsZixjKSxkLmEuYXBwbHlNYXRyaXg0KGUpLGQuYi5hcHBseU1hdHJpeDQoZSksZC5jLmFwcGx5TWF0cml4NChlKSxkLm5lZWRzVXBkYXRlPSEwO2ZvcihsZXQgVD1iLEM9Yit6O1Q8QztUKyspe2NvbnN0IFA9dS5yZXNvbHZlVHJpYW5nbGVJbmRleChUKTtEKGwsMypQLGgsbyksbC5uZWVkc1VwZGF0ZT0hMDtjb25zdCBFPWwuZGlzdGFuY2VUb1RyaWFuZ2xlKGQscCx4KTtpZihFPGcmJih5LmNvcHkocCksbSYmbS5jb3B5KHgpLGc9RSx3PVQsTT1TKSxFPG4pcmV0dXJuITB9fX19fSksdHQucmVsZWFzZVByaW1pdGl2ZShsKSx0dC5yZWxlYXNlUHJpbWl0aXZlKGQpLGc9PT0xLzA/bnVsbDooaS5wb2ludD9pLnBvaW50LmNvcHkoeSk6aS5wb2ludD15LmNsb25lKCksaS5kaXN0YW5jZT1nLGkuZmFjZUluZGV4PXcscyYmKHMucG9pbnQ/cy5wb2ludC5jb3B5KG0pOnMucG9pbnQ9bS5jbG9uZSgpLHMucG9pbnQuYXBwbHlNYXRyaXg0KEllKSx5LmFwcGx5TWF0cml4NChJZSkscy5kaXN0YW5jZT15LnN1YihzLnBvaW50KS5sZW5ndGgoKSxzLmZhY2VJbmRleD1NKSxpKX1mdW5jdGlvbiBUbigpe3JldHVybiB0eXBlb2YgU2hhcmVkQXJyYXlCdWZmZXI8InUifWNvbnN0IHVlPW5ldyBrLmNvbnN0cnVjdG9yLERlPW5ldyBrLmNvbnN0cnVjdG9yLEJ0PW5ldyBkaSgoKT0+bmV3IFcpLGp0PW5ldyBXLEd0PW5ldyBXLHppPW5ldyBXLFNpPW5ldyBXO2xldCBCaT0hMTtmdW5jdGlvbiBQbih1LHQsZSxpKXtpZihCaSl0aHJvdyBuZXcgRXJyb3IoIk1lc2hCVkg6IFJlY3Vyc2l2ZSBjYWxscyB0byBidmhjYXN0IG5vdCBzdXBwb3J0ZWQuIik7Qmk9ITA7Y29uc3Qgcz11Ll9yb290cyxuPXQuX3Jvb3RzO2xldCByLGE9MCxvPTA7Y29uc3QgaD1uZXcgTigpLmNvcHkoZSkuaW52ZXJ0KCk7Zm9yKGxldCBjPTAsZj1zLmxlbmd0aDtjPGY7YysrKXt1ZS5zZXRCdWZmZXIoc1tjXSksbz0wO2NvbnN0IGw9QnQuZ2V0UHJpbWl0aXZlKCk7TCgwLHVlLmZsb2F0MzJBcnJheSxsKSxsLmFwcGx5TWF0cml4NChoKTtmb3IobGV0IGQ9MCxwPW4ubGVuZ3RoO2Q8cCYmKERlLnNldEJ1ZmZlcihuW2NdKSxyPW90KDAsMCxlLGgsaSxhLG8sMCwwLGwpLERlLmNsZWFyQnVmZmVyKCksbys9bltkXS5sZW5ndGgsIXIpO2QrKyk7aWYoQnQucmVsZWFzZVByaW1pdGl2ZShsKSx1ZS5jbGVhckJ1ZmZlcigpLGErPXNbY10ubGVuZ3RoLHIpYnJlYWt9cmV0dXJuIEJpPSExLHJ9ZnVuY3Rpb24gb3QodSx0LGUsaSxzLG49MCxyPTAsYT0wLG89MCxoPW51bGwsYz0hMSl7bGV0IGYsbDtjPyhmPURlLGw9dWUpOihmPXVlLGw9RGUpO2NvbnN0IGQ9Zi5mbG9hdDMyQXJyYXkscD1mLnVpbnQzMkFycmF5LHk9Zi51aW50MTZBcnJheSx4PWwuZmxvYXQzMkFycmF5LG09bC51aW50MzJBcnJheSxnPWwudWludDE2QXJyYXksdz11KjIsTT10KjIsYj1ZKHcseSksej1ZKE0sZyk7bGV0IF89ITE7aWYoeiYmYiljP189cygkKHQsbSksSih0KjIsZyksJCh1LHApLEoodSoyLHkpLG8scit0LGEsbit1KTpfPXMoJCh1LHApLEoodSoyLHkpLCQodCxtKSxKKHQqMixnKSxhLG4rdSxvLHIrdCk7ZWxzZSBpZih6KXtjb25zdCBTPUJ0LmdldFByaW1pdGl2ZSgpO0wodCx4LFMpLFMuYXBwbHlNYXRyaXg0KGUpO2NvbnN0IEI9USh1KSxUPUsodSxwKTtMKEIsZCxqdCksTChULGQsR3QpO2NvbnN0IEM9Uy5pbnRlcnNlY3RzQm94KGp0KSxQPVMuaW50ZXJzZWN0c0JveChHdCk7Xz1DJiZvdCh0LEIsaSxlLHMscixuLG8sYSsxLFMsIWMpfHxQJiZvdCh0LFQsaSxlLHMscixuLG8sYSsxLFMsIWMpLEJ0LnJlbGVhc2VQcmltaXRpdmUoUyl9ZWxzZXtjb25zdCBTPVEodCksQj1LKHQsbSk7TChTLHgsemkpLEwoQix4LFNpKTtjb25zdCBUPWguaW50ZXJzZWN0c0JveCh6aSksQz1oLmludGVyc2VjdHNCb3goU2kpO2lmKFQmJkMpXz1vdCh1LFMsZSxpLHMsbixyLGEsbysxLGgsYyl8fG90KHUsQixlLGkscyxuLHIsYSxvKzEsaCxjKTtlbHNlIGlmKFQpaWYoYilfPW90KHUsUyxlLGkscyxuLHIsYSxvKzEsaCxjKTtlbHNle2NvbnN0IFA9QnQuZ2V0UHJpbWl0aXZlKCk7UC5jb3B5KHppKS5hcHBseU1hdHJpeDQoZSk7Y29uc3QgRT1RKHUpLEY9Syh1LHApO0woRSxkLGp0KSxMKEYsZCxHdCk7Y29uc3QgVT1QLmludGVyc2VjdHNCb3goanQpLFI9UC5pbnRlcnNlY3RzQm94KEd0KTtfPVUmJm90KFMsRSxpLGUscyxyLG4sbyxhKzEsUCwhYyl8fFImJm90KFMsRixpLGUscyxyLG4sbyxhKzEsUCwhYyksQnQucmVsZWFzZVByaW1pdGl2ZShQKX1lbHNlIGlmKEMpaWYoYilfPW90KHUsQixlLGkscyxuLHIsYSxvKzEsaCxjKTtlbHNle2NvbnN0IFA9QnQuZ2V0UHJpbWl0aXZlKCk7UC5jb3B5KFNpKS5hcHBseU1hdHJpeDQoZSk7Y29uc3QgRT1RKHUpLEY9Syh1LHApO0woRSxkLGp0KSxMKEYsZCxHdCk7Y29uc3QgVT1QLmludGVyc2VjdHNCb3goanQpLFI9UC5pbnRlcnNlY3RzQm94KEd0KTtfPVUmJm90KEIsRSxpLGUscyxyLG4sbyxhKzEsUCwhYyl8fFImJm90KEIsRixpLGUscyxyLG4sbyxhKzEsUCwhYyksQnQucmVsZWFzZVByaW1pdGl2ZShQKX19cmV0dXJuIF99Y29uc3QgVmU9bmV3IFgsaXM9bmV3IFcsQ249e3N0cmF0ZWd5OnFpLG1heERlcHRoOjQwLG1heExlYWZUcmlzOjEwLHVzZVNoYXJlZEFycmF5QnVmZmVyOiExLHNldEJvdW5kaW5nQm94OiEwLG9uUHJvZ3Jlc3M6bnVsbCxpbmRpcmVjdDohMSx2ZXJib3NlOiEwfTtjbGFzcyBOZXtzdGF0aWMgc2VyaWFsaXplKHQsZT17fSl7ZT17Y2xvbmVCdWZmZXJzOiEwLC4uLmV9O2NvbnN0IGk9dC5nZW9tZXRyeSxzPXQuX3Jvb3RzLG49dC5faW5kaXJlY3RCdWZmZXIscj1pLmdldEluZGV4KCk7bGV0IGE7cmV0dXJuIGUuY2xvbmVCdWZmZXJzP2E9e3Jvb3RzOnMubWFwKG89Pm8uc2xpY2UoKSksaW5kZXg6cj9yLmFycmF5LnNsaWNlKCk6bnVsbCxpbmRpcmVjdEJ1ZmZlcjpuP24uc2xpY2UoKTpudWxsfTphPXtyb290czpzLGluZGV4OnI/ci5hcnJheTpudWxsLGluZGlyZWN0QnVmZmVyOm59LGF9c3RhdGljIGRlc2VyaWFsaXplKHQsZSxpPXt9KXtpPXtzZXRJbmRleDohMCxpbmRpcmVjdDohIXQuaW5kaXJlY3RCdWZmZXIsLi4uaX07Y29uc3R7aW5kZXg6cyxyb290czpuLGluZGlyZWN0QnVmZmVyOnJ9PXQsYT1uZXcgTmUoZSx7Li4uaSxbb2ldOiEwfSk7aWYoYS5fcm9vdHM9bixhLl9pbmRpcmVjdEJ1ZmZlcj1yfHxudWxsLGkuc2V0SW5kZXgpe2NvbnN0IG89ZS5nZXRJbmRleCgpO2lmKG89PT1udWxsKXtjb25zdCBoPW5ldyBjdCh0LmluZGV4LDEsITEpO2Uuc2V0SW5kZXgoaCl9ZWxzZSBvLmFycmF5IT09cyYmKG8uYXJyYXkuc2V0KHMpLG8ubmVlZHNVcGRhdGU9ITApfXJldHVybiBhfWdldCBpbmRpcmVjdCgpe3JldHVybiEhdGhpcy5faW5kaXJlY3RCdWZmZXJ9Y29uc3RydWN0b3IodCxlPXt9KXtpZih0LmlzQnVmZmVyR2VvbWV0cnkpe2lmKHQuaW5kZXgmJnQuaW5kZXguaXNJbnRlcmxlYXZlZEJ1ZmZlckF0dHJpYnV0ZSl0aHJvdyBuZXcgRXJyb3IoIk1lc2hCVkg6IEludGVybGVhdmVkQnVmZmVyQXR0cmlidXRlIGlzIG5vdCBzdXBwb3J0ZWQgZm9yIHRoZSBpbmRleCBhdHRyaWJ1dGUuIil9ZWxzZSB0aHJvdyBuZXcgRXJyb3IoIk1lc2hCVkg6IE9ubHkgQnVmZmVyR2VvbWV0cmllcyBhcmUgc3VwcG9ydGVkLiIpO2lmKGU9T2JqZWN0LmFzc2lnbih7Li4uQ24sW29pXTohMX0sZSksZS51c2VTaGFyZWRBcnJheUJ1ZmZlciYmIVRuKCkpdGhyb3cgbmV3IEVycm9yKCJNZXNoQlZIOiBTaGFyZWRBcnJheUJ1ZmZlciBpcyBub3QgYXZhaWxhYmxlLiIpO3RoaXMuZ2VvbWV0cnk9dCx0aGlzLl9yb290cz1udWxsLHRoaXMuX2luZGlyZWN0QnVmZmVyPW51bGwsZVtvaV18fChPcyh0aGlzLGUpLCF0LmJvdW5kaW5nQm94JiZlLnNldEJvdW5kaW5nQm94JiYodC5ib3VuZGluZ0JveD10aGlzLmdldEJvdW5kaW5nQm94KG5ldyBXKSkpLHRoaXMucmVzb2x2ZVRyaWFuZ2xlSW5kZXg9ZS5pbmRpcmVjdD9pPT50aGlzLl9pbmRpcmVjdEJ1ZmZlcltpXTppPT5pfXJlZml0KHQ9bnVsbCl7cmV0dXJuKHRoaXMuaW5kaXJlY3Q/eG46bm4pKHRoaXMsdCl9dHJhdmVyc2UodCxlPTApe2NvbnN0IGk9dGhpcy5fcm9vdHNbZV0scz1uZXcgVWludDMyQXJyYXkoaSksbj1uZXcgVWludDE2QXJyYXkoaSk7cigwKTtmdW5jdGlvbiByKGEsbz0wKXtjb25zdCBoPWEqMixjPW5baCsxNV09PT1fZTtpZihjKXtjb25zdCBmPXNbYSs2XSxsPW5baCsxNF07dChvLGMsbmV3IEZsb2F0MzJBcnJheShpLGEqNCw2KSxmLGwpfWVsc2V7Y29uc3QgZj1hK3NlLzQsbD1zW2ErNl0sZD1zW2ErN107dChvLGMsbmV3IEZsb2F0MzJBcnJheShpLGEqNCw2KSxkKXx8KHIoZixvKzEpLHIobCxvKzEpKX19fXJheWNhc3QodCxlPTAsaT0wLHM9MS8wKXtjb25zdCBuPXRoaXMuX3Jvb3RzLHI9dGhpcy5nZW9tZXRyeSxhPVtdLG89ZS5pc01hdGVyaWFsLGg9QXJyYXkuaXNBcnJheShlKSxjPXIuZ3JvdXBzLGY9bz9lLnNpZGU6ZSxsPXRoaXMuaW5kaXJlY3Q/Z246Y247Zm9yKGxldCBkPTAscD1uLmxlbmd0aDtkPHA7ZCsrKXtjb25zdCB5PWg/ZVtjW2RdLm1hdGVyaWFsSW5kZXhdLnNpZGU6Zix4PWEubGVuZ3RoO2lmKGwodGhpcyxkLHksdCxhLGkscyksaCl7Y29uc3QgbT1jW2RdLm1hdGVyaWFsSW5kZXg7Zm9yKGxldCBnPXgsdz1hLmxlbmd0aDtnPHc7ZysrKWFbZ10uZmFjZS5tYXRlcmlhbEluZGV4PW19fXJldHVybiBhfXJheWNhc3RGaXJzdCh0LGU9MCxpPTAscz0xLzApe2NvbnN0IG49dGhpcy5fcm9vdHMscj10aGlzLmdlb21ldHJ5LGE9ZS5pc01hdGVyaWFsLG89QXJyYXkuaXNBcnJheShlKTtsZXQgaD1udWxsO2NvbnN0IGM9ci5ncm91cHMsZj1hP2Uuc2lkZTplLGw9dGhpcy5pbmRpcmVjdD93bjpsbjtmb3IobGV0IGQ9MCxwPW4ubGVuZ3RoO2Q8cDtkKyspe2NvbnN0IHk9bz9lW2NbZF0ubWF0ZXJpYWxJbmRleF0uc2lkZTpmLHg9bCh0aGlzLGQseSx0LGkscyk7eCE9bnVsbCYmKGg9PW51bGx8fHguZGlzdGFuY2U8aC5kaXN0YW5jZSkmJihoPXgsbyYmKHguZmFjZS5tYXRlcmlhbEluZGV4PWNbZF0ubWF0ZXJpYWxJbmRleCkpfXJldHVybiBofWludGVyc2VjdHNHZW9tZXRyeSh0LGUpe2xldCBpPSExO2NvbnN0IHM9dGhpcy5fcm9vdHMsbj10aGlzLmluZGlyZWN0P19uOnVuO2ZvcihsZXQgcj0wLGE9cy5sZW5ndGg7cjxhJiYoaT1uKHRoaXMscix0LGUpLCFpKTtyKyspO3JldHVybiBpfXNoYXBlY2FzdCh0KXtjb25zdCBlPXR0LmdldFByaW1pdGl2ZSgpLGk9dGhpcy5pbmRpcmVjdD9hbjpzbjtsZXR7Ym91bmRzVHJhdmVyc2VPcmRlcjpzLGludGVyc2VjdHNCb3VuZHM6bixpbnRlcnNlY3RzUmFuZ2U6cixpbnRlcnNlY3RzVHJpYW5nbGU6YX09dDtpZihyJiZhKXtjb25zdCBmPXI7cj0obCxkLHAseSx4KT0+ZihsLGQscCx5LHgpPyEwOmkobCxkLHRoaXMsYSxwLHksZSl9ZWxzZSByfHwoYT9yPShmLGwsZCxwKT0+aShmLGwsdGhpcyxhLGQscCxlKTpyPShmLGwsZCk9PmQpO2xldCBvPSExLGg9MDtjb25zdCBjPXRoaXMuX3Jvb3RzO2ZvcihsZXQgZj0wLGw9Yy5sZW5ndGg7ZjxsO2YrKyl7Y29uc3QgZD1jW2ZdO2lmKG89R3ModGhpcyxmLG4scixzLGgpLG8pYnJlYWs7aCs9ZC5ieXRlTGVuZ3RofXJldHVybiB0dC5yZWxlYXNlUHJpbWl0aXZlKGUpLG99YnZoY2FzdCh0LGUsaSl7bGV0e2ludGVyc2VjdHNSYW5nZXM6cyxpbnRlcnNlY3RzVHJpYW5nbGVzOm59PWk7Y29uc3Qgcj10dC5nZXRQcmltaXRpdmUoKSxhPXRoaXMuZ2VvbWV0cnkuaW5kZXgsbz10aGlzLmdlb21ldHJ5LmF0dHJpYnV0ZXMucG9zaXRpb24saD10aGlzLmluZGlyZWN0P3A9Pntjb25zdCB5PXRoaXMucmVzb2x2ZVRyaWFuZ2xlSW5kZXgocCk7RChyLHkqMyxhLG8pfTpwPT57RChyLHAqMyxhLG8pfSxjPXR0LmdldFByaW1pdGl2ZSgpLGY9dC5nZW9tZXRyeS5pbmRleCxsPXQuZ2VvbWV0cnkuYXR0cmlidXRlcy5wb3NpdGlvbixkPXQuaW5kaXJlY3Q/cD0+e2NvbnN0IHk9dC5yZXNvbHZlVHJpYW5nbGVJbmRleChwKTtEKGMseSozLGYsbCl9OnA9PntEKGMscCozLGYsbCl9O2lmKG4pe2NvbnN0IHA9KHkseCxtLGcsdyxNLGIseik9Pntmb3IobGV0IF89bSxTPW0rZztfPFM7XysrKXtkKF8pLGMuYS5hcHBseU1hdHJpeDQoZSksYy5iLmFwcGx5TWF0cml4NChlKSxjLmMuYXBwbHlNYXRyaXg0KGUpLGMubmVlZHNVcGRhdGU9ITA7Zm9yKGxldCBCPXksVD15K3g7QjxUO0IrKylpZihoKEIpLHIubmVlZHNVcGRhdGU9ITAsbihyLGMsQixfLHcsTSxiLHopKXJldHVybiEwfXJldHVybiExfTtpZihzKXtjb25zdCB5PXM7cz1mdW5jdGlvbih4LG0sZyx3LE0sYix6LF8pe3JldHVybiB5KHgsbSxnLHcsTSxiLHosXyk/ITA6cCh4LG0sZyx3LE0sYix6LF8pfX1lbHNlIHM9cH1yZXR1cm4gUG4odGhpcyx0LGUscyl9aW50ZXJzZWN0c0JveCh0LGUpe3JldHVybiBWZS5zZXQodC5taW4sdC5tYXgsZSksVmUubmVlZHNVcGRhdGU9ITAsdGhpcy5zaGFwZWNhc3Qoe2ludGVyc2VjdHNCb3VuZHM6aT0+VmUuaW50ZXJzZWN0c0JveChpKSxpbnRlcnNlY3RzVHJpYW5nbGU6aT0+VmUuaW50ZXJzZWN0c1RyaWFuZ2xlKGkpfSl9aW50ZXJzZWN0c1NwaGVyZSh0KXtyZXR1cm4gdGhpcy5zaGFwZWNhc3Qoe2ludGVyc2VjdHNCb3VuZHM6ZT0+dC5pbnRlcnNlY3RzQm94KGUpLGludGVyc2VjdHNUcmlhbmdsZTplPT5lLmludGVyc2VjdHNTcGhlcmUodCl9KX1jbG9zZXN0UG9pbnRUb0dlb21ldHJ5KHQsZSxpPXt9LHM9e30sbj0wLHI9MS8wKXtyZXR1cm4odGhpcy5pbmRpcmVjdD9Cbjp5bikodGhpcyx0LGUsaSxzLG4scil9Y2xvc2VzdFBvaW50VG9Qb2ludCh0LGU9e30saT0wLHM9MS8wKXtyZXR1cm4gSnModGhpcyx0LGUsaSxzKX1nZXRCb3VuZGluZ0JveCh0KXtyZXR1cm4gdC5tYWtlRW1wdHkoKSx0aGlzLl9yb290cy5mb3JFYWNoKGk9PntMKDAsbmV3IEZsb2F0MzJBcnJheShpKSxpcyksdC51bmlvbihpcyl9KSx0fX1vbm1lc3NhZ2U9KHtkYXRhOnV9KT0+e2xldCB0PXBlcmZvcm1hbmNlLm5vdygpO2Z1bmN0aW9uIGUocil7cj1NYXRoLm1pbihyLDEpO2NvbnN0IGE9cGVyZm9ybWFuY2Uubm93KCk7YS10Pj0xMCYmciE9PTEmJihwb3N0TWVzc2FnZSh7ZXJyb3I6bnVsbCxzZXJpYWxpemVkOm51bGwscG9zaXRpb246bnVsbCxwcm9ncmVzczpyfSksdD1hKX1jb25zdHtpbmRleDppLHBvc2l0aW9uOnMsb3B0aW9uczpufT11O3RyeXtjb25zdCByPW5ldyBzaTtpZihyLnNldEF0dHJpYnV0ZSgicG9zaXRpb24iLG5ldyBjdChzLDMsITEpKSxpJiZyLnNldEluZGV4KG5ldyBjdChpLDEsITEpKSxuLmluY2x1ZGVkUHJvZ3Jlc3NDYWxsYmFjayYmKG4ub25Qcm9ncmVzcz1lKSxuLmdyb3Vwcyl7Y29uc3QgYz1uLmdyb3Vwcztmb3IoY29uc3QgZiBpbiBjKXtjb25zdCBsPWNbZl07ci5hZGRHcm91cChsLnN0YXJ0LGwuY291bnQsbC5tYXRlcmlhbEluZGV4KX19Y29uc3QgYT1uZXcgTmUocixuKSxvPU5lLnNlcmlhbGl6ZShhLHtjb3B5SW5kZXhCdWZmZXI6ITF9KTtsZXQgaD1bcy5idWZmZXIsLi4uby5yb290c107by5pbmRleCYmaC5wdXNoKG8uaW5kZXguYnVmZmVyKSxoPWguZmlsdGVyKGM9PnR5cGVvZiBTaGFyZWRBcnJheUJ1ZmZlcj4idSJ8fCEoYyBpbnN0YW5jZW9mIFNoYXJlZEFycmF5QnVmZmVyKSksYS5faW5kaXJlY3RCdWZmZXImJmgucHVzaChvLmluZGlyZWN0QnVmZmVyLmJ1ZmZlcikscG9zdE1lc3NhZ2Uoe2Vycm9yOm51bGwsc2VyaWFsaXplZDpvLHBvc2l0aW9uOnMscHJvZ3Jlc3M6MX0saCl9Y2F0Y2gocil7cG9zdE1lc3NhZ2Uoe2Vycm9yOnIsc2VyaWFsaXplZDpudWxsLHBvc2l0aW9uOm51bGwscHJvZ3Jlc3M6MX0pfX19KSgpOwo=",z6=typeof window<"u"&&window.Blob&&new Blob([atob(G6)],{type:"text/javascript;charset=utf-8"});function EMe(){let n;try{if(n=z6&&(window.URL||window.webkitURL).createObjectURL(z6),!n)throw"";return new Worker(n)}catch{return new Worker("data:application/javascript;base64,"+G6)}finally{n&&(window.URL||window.webkitURL).revokeObjectURL(n)}}class TMe extends MMe{constructor(){super(new EMe),this.name="GenerateMeshBVHWorker"}runTask(e,i,s={}){return new Promise((r,o)=>{if(i.getAttribute("position").isInterleavedBufferAttribute||i.index&&i.index.isInterleavedBufferAttribute)throw new Error("GenerateMeshBVHWorker: InterleavedBufferAttribute are not supported for the geometry attributes.");e.onerror=h=>{o(new Error(`GenerateMeshBVHWorker: ${h.message}`))},e.onmessage=h=>{const{data:u}=h;if(u.error)o(new Error(u.error)),e.onmessage=null;else if(u.serialized){const{serialized:d,position:m}=u,f=Vy.deserialize(d,i,{setIndex:!1}),g=Object.assign({setBoundingBox:!0},s);if(i.attributes.position.array=m,d.index)if(i.index)i.index.array=d.index;else{const y=new qe(d.index,1,!1);i.setIndex(y)}g.setBoundingBox&&(i.boundingBox=f.getBoundingBox(new Wt)),s.onProgress&&s.onProgress(u.progress),r(f),e.onmessage=null}else s.onProgress&&s.onProgress(u.progress)};const a=i.index?i.index.array:null,l=i.attributes.position.array,c=[l];a&&c.push(a),e.postMessage({index:a,position:l,options:{...s,onProgress:null,includedProgressCallback:!!s.onProgress,groups:[...i.groups]}},c.map(h=>h.buffer).filter(h=>typeof SharedArrayBuffer>"u"||!(h instanceof SharedArrayBuffer)))})}}const RMe=Object.freeze(Object.defineProperty({__proto__:null,GenerateMeshBVHWorker:TMe},Symbol.toStringTag,{value:"Module"})),ol={node:"node",material:"material",camera:"camera",light:"light"},Cf="KHR_animation_pointer",IMe={CUBICSPLINE:void 0,LINEAR:ec,STEP:Mu},F6=Jt.findNode;let N6=!1;class LMe{constructor(e){this.parser=e,this.name=Cf,this.animationPointerResolver=null}setAnimationPointerResolver(e){return this.animationPointerResolver=e,this}_patchPropertyBindingFindNode(){N6||(N6=!0,Jt.findNode=function(e,i){if(i.startsWith(".materials.")){const s=i.substring(11).substring(i.indexOf(".")),r=s.indexOf("."),o=r<0?s:s.substring(0,r);let a=null;return e.traverse(l=>{a!==null||l.type!=="Mesh"&&l.type!=="SkinnedMesh"||l.material&&(l.material.uuid===o||l.material.name===o)&&(a=l.material,a!==null&&(s.endsWith(".map")?a=a.map:s.endsWith(".emissiveMap")&&(a=a.emissiveMap)))}),a}else if(i.startsWith(".nodes.")||i.startsWith(".lights.")||i.startsWith(".cameras.")){const s=i.split(".");let r;for(let o=1;o<s.length;o++){const a=s[o];if(a.length==36)r=e.getObjectByProperty("uuid",a);else if(r&&r[a]){const l=Number.parseInt(a);let c=a;l>=0&&(c=l),r=r[c]}else{const l=e.getObjectByName(a);l&&(r=l)}}if(!r){const o=F6(e,s[2]);return o||console.warn(Cf+": Property binding not found",i,e,e.name,s),o}return r}return F6(e,i)})}loadAnimationTargetFromChannel(e){const i=e.target,s=i.node!==void 0?i.node:i.id;return this.parser.getDependency("node",s)}loadAnimationTargetFromChannelWithAnimationPointer(e){this._havePatchedPropertyBindings||this._patchPropertyBindingFindNode();const i=e.target,s=i.extensions&&i.extensions[Cf]&&i.path&&i.path==="pointer";if(!s)return null;let r,o=ol.node,a;if(s){const c=i.extensions[Cf];let h=c.pointer;if(!h){console.warn("Invalid path",c,i);return}if(h.startsWith("/materials/")?o=ol.material:h.startsWith("/extensions/KHR_lights_punctual/lights/")?o=ol.light:h.startsWith("/cameras/")&&(o=ol.camera),a=this._tryResolveTargetId(h,o),a===null||isNaN(a)){console.warn("Failed resolving animation node id: "+a,h);return}switch(o){case ol.material:const d=("/materials/"+a.toString()+"/").length,m=h.substring(0,d);switch(r=h.substring(d),r){case"pbrMetallicRoughness/baseColorFactor":r="color";break;case"pbrMetallicRoughness/roughnessFactor":r="roughness";break;case"pbrMetallicRoughness/metallicFactor":r="metalness";break;case"emissiveFactor":r="emissive";break;case"alphaCutoff":r="alphaTest";break;case"occlusionTexture/strength":r="aoMapIntensity";break;case"normalTexture/scale":r="normalScale";break;case"pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale":r="map/repeat";break;case"pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset":r="map/offset";break;case"emissiveTexture/extensions/KHR_texture_transform/scale":r="emissiveMap/repeat";break;case"emissiveTexture/extensions/KHR_texture_transform/offset":r="emissiveMap/offset";break;case"extensions/KHR_materials_emissive_strength/emissiveStrength":r="emissiveIntensity";break;case"extensions/KHR_materials_transmission/transmissionFactor":r="transmission";break;case"extensions/KHR_materials_ior/ior":r="ior";break;case"extensions/KHR_materials_volume/thicknessFactor":r="thickness";break;case"extensions/KHR_materials_volume/attenuationColor":r="attenuationColor";break;case"extensions/KHR_materials_volume/attenuationDistance":r="attenuationDistance";break;case"extensions/KHR_materials_iridescence/iridescenceFactor":r="iridescence";break;case"extensions/KHR_materials_iridescence/iridescenceIor":r="iridescenceIOR";break;case"extensions/KHR_materials_iridescence/iridescenceThicknessMinimum":r="iridescenceThicknessRange[0]";break;case"extensions/KHR_materials_iridescence/iridescenceThicknessMaximum":r="iridescenceThicknessRange[1]";break;case"extensions/KHR_materials_clearcoat/clearcoatFactor":r="clearcoat";break;case"extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor":r="clearcoatRoughness";break;case"extensions/KHR_materials_sheen/sheenColorFactor":r="sheenColor";break;case"extensions/KHR_materials_sheen/sheenRoughnessFactor":r="sheenRoughness";break;case"extensions/KHR_materials_specular/specularFactor":r="specularIntensity";break;case"extensions/KHR_materials_specular/specularColorFactor":r="specularColor";break}h=m+r;break;case ol.node:const f=("/nodes/"+a.toString()+"/").length,g=h.substring(0,f);switch(r=h.substring(f),r){case"translation":r="position";break;case"rotation":r="quaternion";break;case"scale":r="scale";break;case"weights":r="morphTargetInfluences";break}h=g+r;break;case ol.light:const y=("/extensions/KHR_lights_punctual/lights/"+a.toString()+"/").length;switch(r=h.substring(y),r){case"color":break;case"intensity":break;case"spot/innerConeAngle":r="penumbra";break;case"spot/outerConeAngle":r="angle";break;case"range":r="distance";break}h="/lights/"+a.toString()+"/"+r;break;case ol.camera:const v=("/cameras/"+a.toString()+"/").length,b=h.substring(0,v);switch(r=h.substring(v),r){case"perspective/yfov":r="fov";break;case"perspective/znear":case"orthographic/znear":r="near";break;case"perspective/zfar":case"orthographic/zfar":r="far";break;case"perspective/aspect":r="aspect";break;case"orthographic/xmag":r="zoom";break;case"orthographic/ymag":r="zoom";break}h=b+r;break}const u=this.animationPointerResolver;u&&u.resolvePath&&(h=u.resolvePath(h)),i.extensions[Cf].pointer=h}if(a===null||isNaN(a)){console.warn("Failed resolving animation node id: "+a,i);return}let l;return o===ol.node?l=this.parser.getDependency("node",a):o===ol.material?l=this.parser.getDependency("material",a):o===ol.light?l=this.parser.getDependency("light",a):o===ol.camera?l=this.parser.getDependency("camera",a):console.error("Unhandled type",o),l}createAnimationTracksWithAnimationPointer(e,i,s,r,o){if(!(o.extensions&&o.extensions[Cf]&&o.path&&o.path==="pointer"))return null;let a=o.extensions[Cf].pointer;if(!a)return null;const l=[];a=a.replaceAll("/",".");const c=a.split(".");var h=e.name!==void 0&&e.name!==null?e.name:e.uuid;if(c[2]=h,c[3]==="morphTargetInfluences"&&e.type==="Group"){for(const d of e.children)d instanceof Eo&&d.morphTargetInfluences&&(c[3]=d.name,c[4]="morphTargetInfluences",u(this.parser));return l}u(this.parser);function u(d){a=c.join(".");let m;switch(s.itemSize){case 1:m=yh;break;case 2:case 3:m=nc;break;case 4:a.endsWith(".quaternion")?m=gl:m=Ww;break}const f=r.interpolation!==void 0?IMe[r.interpolation]:ec;let g=d._getArrayFromAccessor(s);a.endsWith(".fov")&&(g=g.map(v=>v/Math.PI*180));const y=new m(a,i.array,g,f);if(f==="CUBICSPLINE"&&d._createCubicSplineTrackInterpolant(y),l.push(y),a&&s.itemSize===4&&a.startsWith(".materials.")&&a.endsWith(".color")){const v=new Float32Array(g.length/4);for(let A=0,x=g.length/4;A<x;A+=1)v[A]=g[A*4+3];const b=new m(a.replace(".color",".opacity"),i.array,v,f);f==="CUBICSPLINE"&&d._createCubicSplineTrackInterpolant(y),l.push(b)}}return l}_tryResolveTargetId(e,i){let s="";return i==="node"?s=e.substring(7):i==="material"?s=e.substring(11):i==="light"?s=e.substring(39):i==="camera"&&(s=e.substring(9)),s=s.substring(0,s.indexOf("/")),Number.parseInt(s)}loadAnimation(e){const i=this,s=this.parser.json,r=this.parser,o=s.animations[e],a=o.name?o.name:"animation_"+e,l=[],c=[],h=[],u=[],d=[];for(let m=0,f=o.channels.length;m<f;m++){const g=o.channels[m],y=o.samplers[g.sampler],v=g.target,b=o.parameters!==void 0?o.parameters[y.input]:y.input,A=o.parameters!==void 0?o.parameters[y.output]:y.output;let x=i.loadAnimationTargetFromChannelWithAnimationPointer(g);x||(x=i.loadAnimationTargetFromChannel(g)),l.push(x),c.push(r.getDependency("accessor",b)),h.push(r.getDependency("accessor",A)),u.push(y),d.push(v)}return Promise.all([Promise.all(l),Promise.all(c),Promise.all(h),Promise.all(u),Promise.all(d)]).then(function(m){const f=m[0],g=m[1],y=m[2],v=m[3],b=m[4],A=[];for(let x=0,w=f.length;x<w;x++){const _=f[x],S=g[x],M=y[x],R=v[x],P=b[x];if(_===void 0)continue;_.updateMatrix&&(_.updateMatrix(),_.matrixAutoUpdate=!0);let C=i.createAnimationTracksWithAnimationPointer(_,S,M,R,P);if(C||(C=r._createAnimationTracks(_,S,M,R,P)),C)for(let L=0;L<C.length;L++)A.push(C[L])}return new to(a,void 0,A)})}}const PMe=Object.freeze(Object.defineProperty({__proto__:null,GLTFAnimationPointerExtension:LMe},Symbol.toStringTag,{value:"Module"}));export{jye as $physicsKey,bi as ActionBuilder,Yk as ActionCollection,na as ActionModel,b4 as Addressables,mA as AlignmentConstraint,f0 as AmbientMode,Fr as Animation,km as AnimationCurve,yA as AnimationExtension,cM as AnimationTrackHandler,d0 as AnimationUtils,rr as Animator,Md as AnimatorConditionMode,Sa as AnimatorController,Kk as AnimatorControllerParameterType,gA as AnimatorStateInfo,PA as Antialiasing,Uh as Application,yC as ApplicationEvents,p9 as AssetDatabase,ei as AssetReference,mp as AudioExtension,Pd as AudioListener,Sn as AudioSource,RA as AudioTrackHandler,Dd as Avatar,zm as AvatarBlink_Simple,B0 as AvatarEyeLook_Rotation,ED as AvatarLoader,lr as AvatarMarker,pM as AvatarModel,GA as Avatar_Brain_LookAt,NA as Avatar_MouthShapes,SD as Avatar_MustacheShake,Ic as Avatar_POI,M0 as Axes,k0 as AxesHelper,fL as BUILD_TIME,cl as BaseUIComponent,RD as BasicIKConstraint,fM as BehaviorExtension,Gs as BehaviorModel,Pe as Behaviour,Fm as BloomEffect,O0 as BoxCollider,Um as BoxGizmo,Ja as BoxHelperComponent,$h as Button,Xh as ButtonsFactory,SQ as CallDirection,Cc as CallInfo,Fi as Camera,SA as CameraTargetReachedEvent,cr as Canvas,Nd as CanvasGroup,qh as CapsuleCollider,F0 as ChangeMaterialOnClick,Wm as ChangeTransformOnClick,Qm as CharacterController,tu as CharacterControllerInput,YA as ChromaticAberration,Qo as CircularBuffer,Id as ClearFlags,Mc as ClipExtrapolation,ha as Collider,xQ as Collision,JC as CollisionDetectionMode,Xd as ColorAdjustments,Ym as ColorBySpeedModule,nx as ColorOverLifetimeModule,Pe as Component,Fb as ComponentEvents,Nb as ComponentLifecycleEvents,UH as ConnectionEvents,AQ as ContactPoint,Xl as ContactShadows,Pt as Context,tge as ContextArgs,wi as ContextEvent,yi as ContextRegistry,hM as ControlTrackHandler,Jd as CustomBranding,Ul as CustomShader,EC as DefaultReflectionMode,yO as Deletable,hx as DeleteBox,Wl as DepthOfField,KM as DeviceFlag,xt as DeviceUtilities,vO as DocumentExtension,Oo as DragControls,AO as DragMode,$d as DropListener,tf as Duplicatable,px as EffectWrapper,zc as EmissionModule,U0 as EmphasizeOnClick,Pk as EngineLoadingView,en as EventList,$C as EventListEvent,Ya as EventSystem,qM as EventTrigger,tO as FieldWithDefault,gC as FileReference,x4 as FileReferenceSerializer,wZ as FileSpawnModel,xZ as File_Event,MO as FixedJoint,EO as FlyControls,ey as Fog,Yi as FrameEvent,I_ as GENERATOR,ie as GameObject,ft as Gizmos,yx as GltfExport,BO as GltfExportBox,ff as GltfLoadEvent,sK as GltfLoadEventType,Wd as Gradient,Vm as Graphic,iM as GraphicRaycaster,Pa as Graphics,ny as GridHelper,UD as GridLayoutGroup,wc as GroundProjectedEnv,Hh as GroupActionModel,r4 as HideFlags,WD as HideOnStart,mx as HingeJoint,ND as HorizontalLayoutGroup,Tme as HostData,z0 as Image,mC as ImageReference,A4 as ImageReferenceSerializer,jd as InheritVelocityModule,mW as Input,ea as InputEventQueue,yn as InputEvents,nf as InputField,KA as InstanceHandle,Q0 as InstancingHandler,hl as InstancingUtil,E9 as InstantiateEvent,Es as InstantiateIdProvider,Jl as InstantiateOptions,gO as Interactable,rpe as JoinedRoomResponse,pde as KeyEventArgs,fo as Keyframe,bx as LODGroup,sf as LODModel,ope as LeftRoomResponse,Go as Light,W4 as LightData,as as LimitVelocityOverLifetimeModule,cge as LoadingElementOptions,GO as LogStats,Zo as LogType,rf as LookAt,Dm as LookAtConstraint,ur as MainModule,dD as MarkerType,HA as MaskableGraphic,tt as Mathf,Nm as MeshCollider,$A as MeshRenderer,gt as MinMaxCurve,vo as MinMaxGradient,mi as NEEDLE_progressive,Sb as NEKeyboardEvent,kh as NEPointerEvent,YG as NeedleButtonElement,yi as NeedleEngine,DG as NeedleEngineHTMLElement,PG as NeedleGltfLoader,Nc as NeedleMenu,O_ as NeedlePatchesKey,Ej as NeedleUSDZExporter,zP as NeedleXRController,Et as NeedleXRSession,WH as NeedleXRSync,a9 as NeedleXRUtils,rE as NestedGltf,XH as NetworkConnection,Lc as NetworkedStreamEvents,f1 as NetworkedStreams,ry as Networking,R9 as NewInstanceModel,Pi as NoiseModule,ra as ObjectRaycaster,dd as ObjectUtils,of as OffsetConstraint,S_ as OneEuroFilter,KI as OneEuroFilterXYZ,oy as OpenURL,Ei as OrbitControls,G0 as Outline,VH as OwnershipEvent,cB as OwnershipModel,zd as Padding,ix as ParticleBurst,xE as ParticleSubEmitter,cs as ParticleSystem,ip as ParticleSystemBaseBehaviour,el as ParticleSystemRenderer,kM as ParticleSystemShapeType,FA as PeerHandle,FH as PeerNetworking,NS as Physics,HM as PhysicsExtension,Us as PhysicsMaterialCombine,Rx as PixelationEffect,jm as PlayAnimationOnClick,Ud as PlayAudioOnClick,kd as PlayableDirector,Wy as PlayerColor,la as PlayerState,fQ as PlayerStateEvent,L0 as PlayerSync,F4 as PlayerView,N4 as PlayerViewManager,Uy as PointerEventData,_S as PointerType,Vs as PostProcessingEffect,wE as PostProcessingHandler,py as PostProcessingManager,V0 as PreliminaryAction,QA as PreliminaryTrigger,bm as PrimitiveType,ai as Progress,h_ as PromiseAllWithErrors,pI as PromiseErrorResult,Ii as RGBAColor,qx as RapierPhysics,bM as RawImage,yc as RaycastOptions,OD as Rect,Ur as RectTransform,W0 as ReflectionProbe,YC as RegisteredAnimationInfo,Yc as RemoteSkybox,C0 as RenderTexture,oQ as RenderTextureSerializer,kn as Renderer,X4 as RendererData,JA as RendererLightmap,Li as Rigidbody,jn as RigidbodyConstraints,Xt as RoomEvents,ma as RotationBySpeedModule,qa as RotationOverLifetimeModule,RM as SceneLightSettings,Cs as SceneSwitcher,sp as ScreenCapture,cu as ScreenSpaceAmbientOcclusion,Hl as ScreenSpaceAmbientOcclusionN8,Pl as SendQueue,jB as SerializationContext,Hm as SetActiveOnClick,Dx as ShadowCatcher,Tn as ShapeModule,Lx as SharpeningEffect,MA as SignalAsset,I0 as SignalReceiver,R0 as SignalReceiverEvent,IA as SignalTrackHandler,DD as Size,bo as SizeBySpeedModule,Hd as SizeOverLifetimeModule,iO as SkinnedMeshRenderer,rp as SmoothFollow,E0 as SpatialGrabRaycaster,Ox as SpatialHtml,Fx as SpatialTrigger,Kc as SpatialTriggerReceiver,EE as SpectatorCamera,D0 as SphereCollider,CB as SphereIntersection,wQ as SphereOverlapResult,Fc as Sprite,ou as SpriteData,Do as SpriteRenderer,Qd as SpriteSheet,c0e as StateMachineBehaviour,wD as StreamEndedEvent,_Q as StreamReceivedEvent,Tx as SubEmitterSystem,RE as SyncedCamera,jl as SyncedRoom,Sc as SyncedTransform,HD as TapGestureTrigger,XM as TeleportTarget,wG as TestRunner,DSe as TestSceneUtils,_G as TestSimulateUserData,Vr as Text,jM as TextBuilder,ax as TextExtension,dr as TextureSheetAnimationModule,Jc as TiltShiftEffect,j4 as Time,Vd as ToneMappingEffect,EA as TrackHandler,oa as TrackType,xn as TrailModule,Ns as TransformData,uf as TransformGizmo,zs as TriggerBuilder,wd as TriggerModel,Z as TypeStore,nM as UIRaycastUtils,wA as UIRootComponent,po as USDObject,Mj as USDWriter,Gn as USDZExporter,Kd as USDZText,QM as USDZUIExtension,nk as Upload_Result,aQ as UriSerializer,cx as UsageMarker,ape as UserJoinedOrLeftRoomModel,xl as VERSION,Zk as VariantAction,Rn as VelocityOverLifetimeModule,FD as VerticalLayoutGroup,Ms as VideoPlayer,Ad as ViewDevice,df as Vignette,ZA as VisibilityAction,Od as Voip,py as Volume,Je as VolumeParameter,LA as VolumeProfile,ffe as WaitForFrames,S4 as WaitForPromise,_4 as WaitForSeconds,gu as Watch,kE as WebARCameraBackground,au as WebARSessionRoot,On as WebXR,Km as WebXRButtonFactory,fy as WebXRImageTracking,qc as WebXRImageTrackingModel,hu as WebXRPlaneTracking,my as WebXRTrackedImage,uu as XRControllerFollow,Vc as XRControllerModel,fa as XRControllerMovement,ca as XRFlag,DE as XRRig,yo as XRState,Rc as XRStateFlag,EG as __Ignore,v9 as __internalNotifyObjectDestroyed,_h as activeInHierarchyFieldName,dU as addAttributeChangeCallback,ta as addComponent,mbe as addCustomExtensionPlugin,_Z as addFile,SZ as addFileFromUrl,aSe as addGltfLoadEventListener,Cm as addNewComponent,D_ as addPatch,oC as apply,bSe as applyHMRChanges,W9 as applyPrototypeExtensions,T9 as beginListenDestroy,CZ as beginListenFileSpawn,I9 as beginListenInstantiate,XP as binaryIdentifierCasts,ege as build_scene_functions,im as builtinComponentKeyName,Ik as calculateProgress01,AU as clearBalloonMessages,AU as clearOverlayMessages,G0e as colorSerializer,k9 as compareAssociation,eM as componentSerializer,P5 as copyTexture,BG as createLoader,Zj as createMotion,lo as debugNet,Bb as debugOwner,Dv as deepClone,oc as delay,a_ as delayForFrames,$S as deserializeObject,ia as destroy,t4 as destroyComponentInstance,Zi as disposeObjectResources,Pc as disposeStream,v4 as download,rk as download_file,Qv as editorGuidKeyName,dG as effectsOrder,tm as enableSpatialConsole,F0e as euler,X0e as eventListSerializer,USe as exportAsGLTF,tA as findByGuid,rC as findObjectOfType,s4 as findObjectsOfType,RB as findResourceUsers,k5 as fitObjectIntoVolume,Tm as foreachComponent,dC as foreachComponentEnumerator,Moe as forward,mU as generateQRCode,KS as generateSeed,Ba as getBoundingBox,w5 as getCameraController,Mm as getComponent,qb as getComponentInChildren,$b as getComponentInParent,Jb as getComponents,l0 as getComponentsInChildren,sC as getComponentsInParent,wj as getFormattedDate,sr as getIconElement,wk as getIconTexture,Lie as getIp,Pie as getIpAndLocation,Iie as getIpCloudflare,yl as getLoader,Kb as getOrAddComponent,te as getParam,Roe as getParentHierarchyPath,gie as getPath,tpe as getPeerOptions,GH as getPeerjsInstance,lme as getResourceUserCount,C5 as getTempColor,bl as getTempQuaternion,mt as getTempVector,kv as getUrlParams,B5 as getVisibleInCustomShadowRendering,sL as getWorldDirection,rL as getWorldEuler,zt as getWorldPosition,ki as getWorldQuaternion,Vv as getWorldRotation,Qi as getWorldScale,Wh as hasCommercialLicense,Ek as hasIndieLicense,qC as hasPointerEventComponent,xd as hasProLicense,sk as hash,F5 as hideDebugConsole,Pj as imageToCanvas,h0 as instantiate,eO as invokeAfterImportPluginHooks,dW as invokeXRSessionEnd,uW as invokeXRSessionStart,o4 as isActiveInHierarchy,c0 as isActiveSelf,wie as isAndroidDevice,L5 as isAnimationAction,bQ as isComponent,die as isDebugMode,vie as isDesktop,Em as isDestroyed,Ye as isDevEnvironment,ome as isDisposed,GSe as isExporting,sU as isHostedOnGlitch,fSe as isHotReloading,Aie as isIPad,Y4 as isIconElement,no as isLocalNetwork,Sie as isMacOS,bie as isMobileDevice,_ie as isMozillaXR,Eie as isQuest,f9 as isResourceTrackingEnabled,Mie as isSafari,cC as isUsingInstancing,Cie as isiOS,xie as isiPad,kG as loadSync,E_ as logHierarchy,boe as lookAtInverse,Uv as lookAtObject,mie as makeId,cU as makeIdFromRandomWords,zl as makeNameSafeForUSD,a4 as markAsInstancedRendered,Tie as microphonePermissionsGranted,uie as nameof,rU as nameofFactory,rQ as objectSerializer,rde as offXRSessionEnd,sde as offXRSessionStart,M0e as onAfterRender,iQ as onBeforeRender,S0e as onClear,C0e as onDestroy,_0e as onInitialized,tD as onStart,iD as onUpdate,GP as onXRSessionEnd,wS as onXRSessionStart,oK as parseSync,D5 as placeOnSurface,cL as postprocessFBXMaterials,T0e as prefix,oU as pushState,fie as randomNumber,WP as registerBinaryType,BC as registerComponent,JD as registerComponentExtension,Ka as registerCustomEffectType,$D as registerExportExtensions,qD as registerExtensions,gSe as registerHotReloadType,aI as registerLoader,P9 as registerPrefabProvider,H9 as registerPrototypeExtensions,Bme as registerType,uU as relativePathPrefix,pU as removeAttributeChangeCallback,qB as removeComponent,fbe as removeCustomImportExtensionType,lSe as removeGltfLoadEventListener,qle as removePatch,Vu as resolveUrl,hU as sanitizeString,NK as saveImage,OSe as screenshot,FK as screenshot2,FB as sendDestroyed,T as serializable,z9 as serializeObject,S0 as serializeable,eA as setActive,vU as setAllowBalloonMessages,Oie as setAllowOverlayMessages,$I as setAutoFitEnabled,JI as setCameraController,c4 as setDestroyed,Goe as setDevEnvironment,TB as setDisposable,ek as setDontDestroy,hI as setOrAddParamsToUrl,pie as setParam,o_ as setParamWithoutReload,ipe as setPeerOptions,rme as setResourceTrackingEnabled,uI as setState,lL as setVisibleInCustomShadowRendering,oL as setWorldEuler,bs as setWorldPosition,$p as setWorldPositionXYZ,La as setWorldQuaternion,nL as setWorldQuaternionXYZW,aL as setWorldRotation,Xv as setWorldRotationXYZ,vg as setWorldScale,R_ as showBalloonError,gn as showBalloonMessage,zi as showBalloonWarning,mL as showDebugConsole,voe as slerp,Wb as syncDestroy,bD as syncField,NB as syncInstantiate,Ioe as textureToCanvas,_W as tryCastBinary,tK as tryDetermineFileTypeFromBinary,eK as tryDetermineFileTypeFromURL,mg as tryFindObject,SW as tryGetGuid,ySe as unregisterHotReloadType,dI as unwatchWrite,y4 as upload_file,_5 as useForAutoFit,or as validate,c_ as watchWrite};
